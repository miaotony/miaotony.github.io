<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="DN42 | 入坑 DN42 实验网络, MiaoTony,blog">
    <meta name="description" content="最近几天入了DN42的坑，申请了ASN、IP、域名，搭建了VPN通信隧道，配置好BGP路由，完成了和其他网络的Peer。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159946730-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-159946730-1');
</script>


    <title>DN42 | 入坑 DN42 实验网络 | MiaoTony&#39;s小窝</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/favicon.ico">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/css/matery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/css/my.css">
	
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/jquery/jquery.min.js"></script>
    <script>
        //来个特效玩玩喵 20200123
        var titleTime;
        var OriginTitile = document.title;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '|ω·) 喵~快回来呀！';
                clearTimeout(titleTime);
            } else {
                document.title = '(/≧▽≦)/ Meow！';
                titleTime = setTimeout(function() {
        	    document.title = OriginTitile;
        }, 800);
    }
        });
    </script>
<meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="MiaoTony's小窝" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">MiaoTony&#39;s小窝</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">MiaoTony&#39;s小窝</div>
        <div class="logo-desc">
            
            喵~欢迎各位大佬的来访呀！
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/miaotony" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/miaotony" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">DN42 | 入坑 DN42 实验网络</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        min-width: 240px;
        padding-left: 15px;
        padding-bottom: 30px;
    }

    .toc-widget .toc-title {
        padding: 30px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
	    max-height: 450px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Tech/">
                                <span class="chip bg-color">Tech</span>
                            </a>
                        
                            <a href="/tags/Server/">
                                <span class="chip bg-color">Server</span>
                            </a>
                        
                            <a href="/tags/Configuration/">
                                <span class="chip bg-color">Configuration</span>
                            </a>
                        
                            <a href="/tags/DN42/">
                                <span class="chip bg-color">DN42</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Tech/" class="post-category">
                                Tech
                            </a>
                        
                            <a href="/categories/Tech/Server/" class="post-category">
                                Server
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-03-25
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    4.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    17 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>其实想玩 DN42 也有一段时间了，正好最近群友也在聊 DN42，动不动就「<strong>来 Peer！</strong>」。</p>
<p>那咱就来整一个好了！</p>
<p>请注意，本文<strong>不是</strong>一篇完整的介绍性文章，只是记录一下配置过程中遇到的坑啊什么的。</p>
<h2 id="0x01-What-is-DN42"><a href="#0x01-What-is-DN42" class="headerlink" title="0x01 What is DN42?"></a>0x01 What is DN42?</h2><p><img src="/2021/03/25/Server_DN42/dn42.png"></p>
<blockquote>
<p>dn42 is a big dynamic <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Virtual_private_network">VPN</a>, which employs Internet technologies (<a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Bgp">BGP</a>, whois database, <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Domain_Name_System">DNS</a>, etc).  Participants connect to each other using network tunnels (<a target="_blank" rel="noopener" href="https://dn42.eu/howto/GRE-on-FreeBSD">GRE</a>, <a target="_blank" rel="noopener" href="https://dn42.eu/howto/openvpn">OpenVPN</a>, <a target="_blank" rel="noopener" href="https://dn42.eu/howto/tinc">Tinc</a>, <a target="_blank" rel="noopener" href="https://dn42.eu/howto/IPsec-with-PublicKeys">IPsec</a>) and exchange routes thanks to the Border Gateway Protocol.  Network addresses are assigned in the <code>172.20.0.0/14</code> range and private AS numbers are used (see <a target="_blank" rel="noopener" href="https://dn42.eu/services/Whois">registry</a>) as well as IPv6 addresses from the ULA-Range (<code>fd00::/8</code>) - see <a target="_blank" rel="noopener" href="https://dn42.eu/FAQ#frequently-asked-questions_what-about-ipv6-in-dn42">FAQ</a>.</p>
<p>A number of services are provided on the network: see <a target="_blank" rel="noopener" href="https://dn42.eu/internal/Internal-Services">internal</a> (only available from within dn42).  Also, dn42 is interconnected with other networks, such as <a target="_blank" rel="noopener" href="http://wiki.hamburg.ccc.de/ChaosVPN">ChaosVPN</a> or some <a target="_blank" rel="noopener" href="http://en.wikipedia.org/wiki/Freifunk">Freifunk</a> networks.</p>
<p><em>Via <a target="_blank" rel="noopener" href="https://dn42.dev/Home">Official Wiki</a></em></p>
</blockquote>
<blockquote>
<p>DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 VPN 网络。但是与其它传统 VPN 不同的是，DN42 本身不提供 VPN 出口服务，即不提供规避网络审查、流媒体解锁等类似服务。相反，DN42 的目的是<strong>模拟一个互联网</strong>。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。</p>
<p>简而言之，DN42：</p>
<ul>
<li>不适合单纯想要保护隐私、规避网络审查的用户</li>
<li>不适合在网内消耗大量流量，例如用于解锁流媒体服务的用户</li>
<li>适合想要研究网络技术，练习服务器、路由器等网络设备配置，甚至后续在真实互联网建立 AS 的用户</li>
<li>适合拥有真实 AS，但担心自己<a target="_blank" rel="noopener" href="https://blog.cloudflare.com/how-verizon-and-a-bgp-optimizer-knocked-large-parts-of-the-internet-offline-today/">配置错误广播出错误路由、干掉半个互联网</a>，希望有个地方测试的用户。</li>
</ul>
<p><em>Via <a target="_blank" rel="noopener" href="https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian/">Lan Tian’s Blog</a></em></p>
</blockquote>
<p>其实就是说，DN42 是一个大型 VPN 网络，模拟了现实生活中的真实互联网。</p>
<p>目前 DN42 已经与 <a target="_blank" rel="noopener" href="https://neocloud.tw/">NeoNetwork</a>、<a target="_blank" rel="noopener" href="https://wiki.hamburg.ccc.de/ChaosVPN">ChaosVPN</a> 等网络实现了互联，加入就能体验到其他网络内的资源。</p>
<p><strong>那为什么要加入 DN42 呢？</strong></p>
<p><strong>当然是好玩啦 w</strong></p>
<p>你想想，只需要动动手动动脑，就能免费拥有属于自己的 ASN (Autonomous system number，自治系统编号)，能宣告一段 IPv4 和 IPv6，体验各种路由协议，还能和别人尽情地 <del>py</del> Peer（对接）。</p>
<p>这可比普通的计算机网络实验好玩多了！</p>
<p>当然，为了折腾 DN42，你至少需要一台能不间断联网的设备以及对它的 root 权限，当然还需要花不少时间……<em>（喵喵好菜啊，别骂了别骂了</em></p>
<h2 id="0x02-大概的步骤"><a href="#0x02-大概的步骤" class="headerlink" title="0x02 大概的步骤"></a>0x02 大概的步骤</h2><p><strong>TL;DR</strong></p>
<ol>
<li>在 Git 仓库申请账号，申请好你需要的 ASN，IP 段（，域名以及反向解析服务器），然后给仓库提PR</li>
<li>寻找一个可能的 Peer 节点，按照他留下的联系方式给他发邮件/IRC/Telegram/etc.</li>
<li>寻找一个延迟较低的节点，并和他约定好使用的 VPN 软件和路由协议</li>
<li>建立 VPN 通信隧道，确保能互相连通</li>
<li>建立路由（一般是 BGP）</li>
</ol>
<h2 id="0x03-注册过程"><a href="#0x03-注册过程" class="headerlink" title="0x03 注册过程"></a>0x03 注册过程</h2><p>这部分主要参考 Lan Tian 师祖的 <a target="_blank" rel="noopener" href="https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian/#%E6%B3%A8%E5%86%8C%E8%BF%87%E7%A8%8B">DN42 实验网络介绍及注册教程（2020-10-01 更新）</a> 一文进行。</p>
<p>目前 DN42 采用 git 仓库进行管理，可以参考 <a target="_blank" rel="noopener" href="https://dn42.dev/howto/Getting-started">DN42 官方 Wiki howto/Getting Started</a> 来进行配置。</p>
<p>也可以参考 <a target="_blank" rel="noopener" href="https://git.dn42.dev/dn42/registry/pulls/632">喵喵的 PR</a>，喵~ （需要登录 git）</p>
<hr>
<p>为了找空出来而且好看的 ASN，喵喵还专门写了个脚本……</p>
<p>具体就不说了，但吐槽几句。</p>
<p>这里有几个坑就是，需要用 Linux 系统来进行配置，<strong>一定不要用 Windows 系统</strong>，因为 win 的文件系统不支持带有 <code>:</code> 的文件名，于是 git 仓库都拉不下来。</p>
<p>如果想要用 win 的话，可以使用 WSL2。</p>
<p>另外就是，找 IP 段很容易碰到冲突，而且自己不容易发现……、</p>
<p>比如之前找了一段发现被人占了好大一块，又或者整个 /18 保留给 /24 - /21 了，人傻了。</p>
<p><img src="/2021/03/25/Server_DN42/image-20210325221707325.png"></p>
<p>再比如之前申请的一个段发现被 DN42 官方保留了。</p>
<pre class="line-numbers language-none"><code class="language-none">INFO: 172.22.222.0/26 (inetnum): Inetnum has different mntners than parent and policy of parent is reserved: [MIAOTONY-MNT] vs [DN42-MNT].<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/03/25/Server_DN42/image-20210325220553241.png"></p>
<p>找了半天才发现是有个 172.22.192.0/18，直接好家伙。</p>
<p><img src="/2021/03/25/Server_DN42/image-20210325220717750.png"></p>
<p>当然，如果有多个 commit 记录，记得先 squash 一下再 push，可以直接用目录下自带的脚本来 push。</p>
<p>不过其实也没啥关系，PR 上去之后有 CI 自动进行检测，按照要求更改就完事了。</p>
<h2 id="0x04-首先要进行的系统配置"><a href="#0x04-首先要进行的系统配置" class="headerlink" title="0x04 首先要进行的系统配置"></a>0x04 首先要进行的系统配置</h2><p><strong>在每一台要加入 DN42 的节点都需要进行以下配置！</strong></p>
<ol>
<li>打开 Linux 内核的数据包转发功能，即 <code>ip_forwarding</code>。</li>
<li>关闭 Linux 内核 <code>rp_filter</code> 的严格模式。</li>
<li>关掉 ufw 等帮助配置 iptables 防火墙的工具。（如有需要，手动配置 iptables</li>
</ol>
<p>前两条设置步骤如下。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/sysctl.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>新增以下几条配置</p>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">net.ipv4.ip_forward=1
net.ipv6.conf.default.forwarding=1
net.ipv6.conf.all.forwarding=1

net.ipv4.conf.default.rp_filter=2
net.ipv4.conf.all.rp_filter=2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后应用配置</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sysctl -p<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>


<h2 id="0x05-建立通信隧道"><a href="#0x05-建立通信隧道" class="headerlink" title="0x05 建立通信隧道"></a>0x05 建立通信隧道</h2><p>DN42 是基于 VPN 来建立通信连接的，为了方便，大多数用户都使用 WireGuard 来进行。</p>
<p>WireGuard 是 L3 层隧道，目前已经集成到了 Linux 内核中，它配置简单，占用资源少，安全性较高。</p>
<p>如果不是 OpenVZ 或者 LXC 虚拟化的话，其他应该都能用吧，不支持的话可能需要升级一下内核版本。</p>
<p>这里可以参考 <a target="_blank" rel="noopener" href="https://dn42.dev/howto/wireguard">官方 Wiki 的 howto/wireguard</a> 来进行。</p>
<blockquote>
<p>Wireguard is a Layer3 VPN. In theory it allows multiple peers to be served with one interface/port, but it does internal routing based on the peer’s public key. This means you will need one interface per peering on dn42 to allow your BGP daemon instead to do routing. This approach is  comparable to <a target="_blank" rel="noopener" href="https://dn42.dev/howto/openvpn">OpenVPN p2p tunnels</a>.</p>
</blockquote>
<p>意思是 wg 内部的路由是基于公钥来进行的，于是和不同的网络进行 peer，对于每个 peer 都需要建立一个新的接口，也就相当于多一个虚拟网卡。不过这个接口的 IP 可以都一样，不受影响。</p>
<p>首先 <strong>生成一对公钥和私钥</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wg genkey <span class="token operator">|</span> <span class="token function">tee</span> privatekey <span class="token operator">|</span> wg pubkey <span class="token operator">&gt;</span> publickey<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>不同于 Lan Tian 师祖的 <a target="_blank" rel="noopener" href="https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian/#%E9%9A%A7%E9%81%93%E6%90%AD%E5%BB%BA%EF%BC%9AWireGuard">sh 配置脚本</a>，此处喵喵 <strong>直接使用 <code>wg-quick</code> 来配置</strong>。</p>
<p>这是<strong>我的配置模板</strong>。一般是放在 <code>/etc/wireguard/xxx.conf</code>.</p>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">[Interface]
PrivateKey = &lt;自己的私钥&gt;
ListenPort = &lt;自己监听的端口，一般是对方ASN后五位&gt;
PostUp = ip addr add &lt;你的DN42 IPv4&gt;/32 peer &lt;对方的DN42 IPv4&gt;/32 dev %i
# 如果用 IPv6 ULA
# PostUp = ip addr add &lt;你的DN42 IPv6&gt;/128 peer &lt;对方的DN42 IPv6&gt;/128 dev %i
# 如果用 link-local（推荐）
PostUp = ip addr add &lt;link-local&gt;/64 dev %i
Table = off

[Peer]
PublicKey = &lt;对方的公钥&gt;
Endpoint = &lt;对方的公网地址&gt;:&lt;对方的端口，一般是自己ASN后五位&gt;
AllowedIPs = 0.0.0.0/0, ::/0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>如果 <code>[Interface]</code> 里写了 <code>Address</code> 的话需要在 <code>PostUp</code> 里先删掉 addr 再加上 <code>peer</code>，所以干脆就不配 <code>Address</code> 了。</p>
<p>注意这里 <code>Table = off</code> 要加上，不然所有的流量，包括公网上的流量就都转发给你的 peer 了，这样可能你就连自己的机器都连不上了。</p>
<p><img src="/2021/03/25/Server_DN42/image-20210327015332317.png"></p>
<p><em>然后喵喵配完 wg，一启动，SSH 连接断了，喵喵愣住了（还好服务商能起 VNC，然后上去把 wg 连接断了才重新连上 SSH…</em></p>
<p>这里一般推荐用 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Link-local_address">link-local 地址</a> 进行配置，除非双方约定好是用 ULA。</p>
<p>这是<strong>链路本地地址</strong>， IPv6 定义在 <strong>fe80::/10</strong> 地址块。一般就是 <code>fe80::&lt;你的ASN后四位&gt;</code>。</p>
<p>然后为了方便，参考 <a target="_blank" rel="noopener" href="https://cas7.moe/">@moecast</a> 大佬的配置脚本，一步配置 service。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /sbin/wgen
<span class="token comment">#!/bin/bash</span>
<span class="token assign-left variable">filename</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> -- $1 .conf<span class="token variable">)</span></span>"</span>
systemctl <span class="token builtin class-name">enable</span> wg-quick@<span class="token variable">$filename</span>.service
<span class="token function">service</span> wg-quick@<span class="token variable">$filename</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个脚本将启动隧道，并把配置注册到 service 中，实现开机自启。</p>
<p>把这个脚本放到 <code>/sbin/wgen</code>，然后 <code>chmod +x /sbin/wgen</code> 赋予执行权限。</p>
<p>需要用的时候直接 <code>wgen 文件名</code> 就行了。</p>
<p>最后看看连接建立了没有。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wg show 文件名
<span class="token comment"># 或者直接 wg</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>看到 <code>transfer</code> 里发送接收都有数据了说明就能连上了。</p>
<p><img src="/2021/03/25/Server_DN42/image-20210325233345851.png"></p>
<p>当然也可以 ping 一下对方。</p>
<p>WireGuard 接口名就是你配置的文件名。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ping 对方IP%WireGuard接口名</span>
<span class="token function">ping</span> fe80::xxxx%wg_424242xxxx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>当然了，也可以手写 systemd 来配 wg，参考 <a target="_blank" rel="noopener" href="https://dn42.dev/howto/wireguard">官方 Wiki</a> 就好了。</p>
<h2 id="0x06-建立-BGP-会话"><a href="#0x06-建立-BGP-会话" class="headerlink" title="0x06 建立 BGP 会话"></a>0x06 建立 BGP 会话</h2><p>BGP(Border Gateway Protocol，边界网关协议) 是一种路由协议，一般都使用这个来进行 peer。</p>
<p>路由的软件一般使用的是 <strong>BIRD Internet Routing Daemon (v2)</strong> 。</p>
<p>此处参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://wiki.dn42.us/howto/Bird2">DN42 Wiki 上的 Bird2 配置教程</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.dn42.us/howto/Bird">DN42 Wiki 上的 Bird1 配置教程</a></li>
</ul>
<h3 id="bird-conf-与-ROA"><a href="#bird-conf-与-ROA" class="headerlink" title="bird.conf 与 ROA"></a>bird.conf 与 ROA</h3><p>这里要注意 <strong>一定按照教程先配好 <code>/etc/bird/bird.conf</code>，或者 <code>/etc/bird.conf</code>！</strong></p>
<p>此处使用的是 wiki 上的模板，比如喵喵的 Variable header 如下。</p>
<p><code>OWNIP</code> 和 <code>OWNIPv6</code> 是你本机要分配的地址，<code>OWNNETSET</code> 和 <code>OWNNETSETv6</code> 不用漏了结尾的 <code>+</code>。</p>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">################################################
#               Variable header                #
################################################

define OWNAS =  4242422688;
define OWNIP =  172.23.6.6;
define OWNIPv6 = fd00:feed:ca7::6;
define OWNNET = 172.23.6.0/26;
define OWNNETv6 = fd00:feed:ca7::/48;
define OWNNETSET = [172.23.6.0/26+];
define OWNNETSETv6 = [fd00:feed:ca7::/48+];

################################################
#                 Header end                   #
################################################<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后把 ROA (Route Origin Authorization) 配好。</p>
<p>一般路径在 <code>/etc/bird/roa_dn42{,_v6}.conf</code></p>
<p>可以写个 crontab 定期自动下载更新。注意 <code>bird.conf</code> 里的 <code>roa</code> 路径要配的一致。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># crontab -e</span>
*/15 * * * * <span class="token function">curl</span> -sfSLR -o /etc/bird/roa_dn42.conf https://dn42.burble.com/roa/dn42_roa_bird2_4.conf <span class="token operator">&amp;&amp;</span> <span class="token function">curl</span> -sfSLR -o /etc/bird/roa_dn42_v6.conf https://dn42.burble.com/roa/dn42_roa_bird2_6.conf <span class="token operator">&amp;&amp;</span> /usr/sbin/birdc configure <span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>可以先执行一次让文件存在，不然后面启动 bird 的时候可能会有问题。</p>
<h3 id="Peers-文件"><a href="#Peers-文件" class="headerlink" title="Peers 文件"></a>Peers 文件</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> -p /etc/bird/peers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>每一个 peer 建一个文件 <code>/etc/bird/peers/&lt;NEIGHBOR_NAME&gt;.conf</code>。</p>
<p>下面是 Lan Tian 师祖的模板。</p>
<pre class="line-numbers language-none"><code class="language-none">protocol bgp dn42_[PEER_NAME]_v4 from dnpeers {
    neighbor [YOUR_DN42_IP] as [YOUR_ASN];
    direct;
    # 下面这段是在 IPv4 BGP 中禁用 IPv6 路由传递，强烈推荐；查看下文以决定你要不要这样做（保留下面的内容）
    ipv6 {
        import none;
        export none;
    };
};

protocol bgp dn42_[PEER_NAME]_v6 from dnpeers {
    neighbor [YOUR_LINK_LOCAL_IP] % 'dn42-[PEER_NAME]' as [YOUR_ASN];
    direct;
    # 下面这段是在 IPv6 BGP 中禁用 IPv4 路由传递；查看下文以决定你要不要这样做（保留下面的内容）
    ipv4 {
        import none;
        export none;
    };
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<blockquote>
<ul>
<li>MY 指的是你自己，而 YOUR 指的是你将要 Peer 的那个人。</li>
<li>BIRD 中配置的是 DN42 内的 IP 而非公网 IP。</li>
<li>相比 DN42 Wiki 上的配置，我加了一行 <code>direct;</code>，原因是我发现如果缺少这行，路由信息有可能无法被正确的导入系统路由表。<ul>
<li>BIRD 默认会根据系统路由表查找要将数据包转发到哪个网络设备，以此设置系统路由表，但有时查找会失败（表现为 <code>ip route</code> 中出现大片 <code>unreachable</code>）。</li>
<li>此时指定 <code>direct</code>，让 BIRD 将数据包直接转发到 BGP 连接所在的网卡上。</li>
<li><code>direct</code> 的含义是连接双方直接连接（即中间没有间隔其它的路由器）。</li>
</ul>
</li>
<li>PEER_NAME 是对方的昵称，这里设置的是 Linux 下的网络设备名，与隧道保持一致。注意整个网络设备名不能超过 15 个字符，否则会被截断。</li>
<li>在 IPv6 Peering 时，我推荐使用 Link-local IP。<ul>
<li>直接使用对方整个节点的 IPv6 地址（指 <code>fd00::/8</code> 范围中的那个）时，部分系统不会自动添加到对端的路由，需要手动添加一条；见 <code>隧道搭建：WireGuard</code> 一节。</li>
</ul>
</li>
<li>在 BIRDv2 中，强烈推荐在 IPv4 BGP 会话中禁用 IPv6 的路由传递，同时可以在 IPv6 BGP 中禁用 IPv4 路由传递。<ul>
<li>BIRDv2 支持在一个 BGP 会话中同时传递 IPv4 和 IPv6 的路由。</li>
<li>在 IPv4 BGP 会话中，BIRDv2 难以正确判断 IPv6 数据包转发目标的地址（Next Hop），会导致 <code>ip -6 route</code> 中出现大片 <code>unreachable</code>。<ul>
<li>因此直接禁用就好了。</li>
</ul>
</li>
<li>在 IPv6 BGP 会话中传递 IPv4 路由时，如果双方使用特定的 BGP 软件组合，一方或双方的日志中会出现大片 <code>Invalid NEXT_HOP Attribute</code>，指 Next Hop 判断出错。<ul>
<li>但 IPv6 BGP 中同时传递 IPv4 和 IPv6 路由的应用还比较广泛，因此一般建议不要禁用 IPv4 路由传递，除非出现了问题。</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p>BIRD2 是支持 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Multiprotocol_BGP">Multiprotocol BGP</a> 的，也就是可以在单独一个 IPv4/IPv6 BGP session 里建立 v4 和 v6 两条 channel。<em>（大概意思是这样，不知道说的准不准确</em></p>
<p>于是<strong>如果双方都支持 MP-BGP 的话，一般是用 link-local 建立一条 v6 的 BGP session 就好了。</strong></p>
<p>由于 link-local 只是在连接双方的接口进行的，需要指定好接口。</p>
<p>可以参考 <strong>喵喵的模板</strong>。</p>
<pre class="line-numbers language-conf" data-language="conf"><code class="language-conf">protocol bgp dn42_424242xxxx_v6 from dnpeers {
    neighbor fe80::xxxx % 'wg_424242xxxx' as 424242xxxx;
    direct;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意 <code>fe80::xxxx</code> 是对方的 link-local address，<code>wg_424242xxxx</code> 是你网络接口的名字。</p>
<p>之后启动 BIRD，或者重新加载配置。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> bird start <span class="token comment"># 如果没启动的话</span>
birdc c  <span class="token comment"># 即 birdc configure</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>然后可以看看连接状态了。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">birdc s p <span class="token comment"># 即 birdc show protocol </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/2021/03/25/Server_DN42/image-20210326001444531.png"></p>
<p>如果显示的是 <code>Established</code>，那么连接就建立好了。</p>
<p><strong>Peer 成功！</strong></p>
<p>当然还可以查看某条路由配置的详细信息。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">birdc s p a dn42_424242xxxx_v6 <span class="token comment"># 即 birdc show protocol all dn42_424242xxxx_v6</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>然后就能 ping 一下 DN42 内的服务了，比如 172.20.0.53 之类的。</p>
<h3 id="一点点扩展"><a href="#一点点扩展" class="headerlink" title="一点点扩展"></a>一点点扩展</h3><p><strong>2021.3.21 新发布的 BIRD v2.0.8</strong> 新增了许多特性。</p>
<p>其中有一个是支持了 extended next hop，可以实现 IPv4 流量在 IPv6-only 网络上的转发。<em>（反正群友说的我也懒得考证了</em></p>
<p>参考 BIRD 文档里的 <a target="_blank" rel="noopener" href="https://bird.network.cz/?get_doc&amp;v=20&amp;f=bird-6.html#ss6.3">BGP extended next hop</a> </p>
<p><img src="/2021/03/25/Server_DN42/image-20210326003544763.png"></p>
<p>在 <code>dnpeers</code> 里的 <code>ipv4</code> 中加入 <code>extended next hop on;</code> 即可使用这一特性。</p>
<p><img src="/2021/03/25/Server_DN42/image-20210326004515058.png"></p>
<p>于是和别人 peer 的时候，WireGuard 只需要 peer 一个 IPv6 link-local address 就完事了，连 DN42 IPv4 都不需要了。</p>
<p>当然还需要加一个 dummy 接口来写本机的地址，类似于</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> dummy1 <span class="token builtin class-name">type</span> dummy
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token operator">&lt;</span>你的DN42 IPv<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>/32 dev dummy1
<span class="token function">ip</span> addr <span class="token function">add</span> <span class="token operator">&lt;</span>你的DN42 IPv<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>/128 dev dummy1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>不然路由表有可能写入不到内核中。</p>
<p>为了持久化，需要写到配置文件中。Ubuntu 下用的是 netplan。</p>
<p>在 <code>/etc/netplan/</code> 目录下新建一个文件，内容如下。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> 01-dummy0.yaml
network:
  version: <span class="token number">2</span>
  renderer: networkd
  bridges:
    dummy0:
      dhcp4: no
      dhcp6: no
      accept-ra: no
      interfaces: <span class="token punctuation">[</span> <span class="token punctuation">]</span>
      addresses:
        - <span class="token operator">&lt;</span>你的DN42 IPv<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>/32
        - <span class="token operator">&lt;</span>你的DN42 IPv<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>/128<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其他系统的话可以配置 <code>/etc/network/interfaces</code>。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">auto dummy0
iface dummy0 inet static
        pre-up <span class="token function">ip</span> <span class="token function">link</span> del dummy0 <span class="token operator">||</span> <span class="token boolean">true</span>
        pre-up <span class="token function">ip</span> <span class="token function">link</span> <span class="token function">add</span> dummy0 <span class="token builtin class-name">type</span> dummy <span class="token operator">||</span> <span class="token boolean">true</span>
        address <span class="token operator">&lt;</span>你的DN42 IPv<span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span>/32
        post-up <span class="token function">ip</span> addr <span class="token function">add</span> <span class="token operator">&lt;</span>你的DN42 IPv<span class="token operator"><span class="token file-descriptor important">6</span>&gt;</span>/128 dev dummy0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>然后重启之后就能自动配上这个 dummy 接口了。</p>
<p>BTW，喵喵觉得一个一个手动配太麻烦了，于是自己用 Python 糊了个小脚本，只需要输入必要的信息，就能自动生成配置文件，并建立 WireGuard 连接，重新加载 BIRD 配置了，贼舒服！</p>
<p>（不过脚本太丑了而且是自己用的，就不放出来了吧</p>
<h2 id="0x07-一些好玩的东西"><a href="#0x07-一些好玩的东西" class="headerlink" title="0x07 一些好玩的东西"></a>0x07 一些好玩的东西</h2><p>大佬们给节点做了可视化，比如以下几个。</p>
<p><a target="_blank" rel="noopener" href="https://map42.0x7f.cc/">https://map42.0x7f.cc/</a></p>
<p><img src="/2021/03/25/Server_DN42/image-20210326002100613.png"></p>
<p><a target="_blank" rel="noopener" href="https://map.meson.cc/">https://map.meson.cc/</a></p>
<p><img src="/2021/03/25/Server_DN42/image-20210325215319450.png"></p>
<p><a target="_blank" rel="noopener" href="https://nixnodes.net/dn42/graph/">https://nixnodes.net/dn42/graph/</a></p>
<p><img src="/2021/03/25/Server_DN42/image-20210325201121252.png"></p>
<p><a target="_blank" rel="noopener" href="https://bgp42.strexp.net/map2">https://bgp42.strexp.net/map2</a></p>
<p><img src="/2021/03/25/Server_DN42/image-20210326010204433.png"></p>
<p>啊啊啊，毛线好多缠住喵喵了<em>（大雾</em></p>
<br>

<hr>
<p>当然还有很多 dn42 / NeoNetwork NOC 的 looking glass，比如：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://lg.burble.com/">https://lg.burble.com/</a></li>
<li><a target="_blank" rel="noopener" href="https://lg.strexp.net/">https://lg.strexp.net/</a></li>
<li><a target="_blank" rel="noopener" href="https://lg.lantian.pub/">https://lg.lantian.pub/</a></li>
<li><a target="_blank" rel="noopener" href="https://lg.lss233.com/">https://lg.lss233.com/</a></li>
</ul>
<p>以及 DN42 里的服务 <a target="_blank" rel="noopener" href="https://wiki.dn42.dev/internal/Internal-Services">internal/Internal Services</a></p>
<p>Burble 老师的服务 <a target="_blank" rel="noopener" href="https://dn42.burble.com/services/public/">https://dn42.burble.com/services/public/</a></p>
<p>当然还可以绑定 .dn42 域名，设置反向解析 rDNS，当然还有 .dn42 的 CA 证书……</p>
<p>为了给自己的多个设备组网，还可以 iBGP、iGP、Babel、OSPF 等路由协议综合来使用。</p>
<p>反正还能慢慢玩呢（</p>
<h2 id="0x08-Peer-with-MeowNet"><a href="#0x08-Peer-with-MeowNet" class="headerlink" title="0x08 Peer with MeowNet"></a>0x08 Peer with MeowNet</h2><p>什么？你想和我 Peer 了？<strong>快来 Peer！</strong></p>
<p><strong>AS4242422688</strong><br><strong>MeowNet</strong><br><em>MiaoTony’s DN42 Network</em></p>
<p><strong>DN42 IP:</strong></p>
<p>172.23.6.0/26<br>fd00:feed:ca7::/48</p>
<p><strong>Nodes:</strong></p>
<ul>
<li>LV1 - Las Vegas, US, <a target="_blank" rel="noopener" href="https://my.frantech.ca/aff.php?aff=4525">BuyVM</a></li>
<li>To be continued…</li>
</ul>
<p><strong>WireGuard and Multiprotocol BGP are preferred.</strong></p>
<p>I prefer to use link-local IPv6 address to set up multiprotocol BGP session (with extended next hop enabled).</p>
<p><strong>Welcome to peer with me!</strong></p>
<p><strong>Telegram: (Recommended)</strong> Just PM <a target="_blank" rel="noopener" href="https://t.me/meow_portal_bot">@meow_portal_bot</a> and tell me you are from DN42.</p>
<p><strong>Email:</strong> dn42@miaotony.xyz</p>
<hr>
<p><strong>You should send me some info like follows.</strong></p>
<ul>
<li>Your ASN</li>
<li>Public IP <ul>
<li>IPv4 is preferred, but you can send v4/v6 both</li>
</ul>
</li>
<li>DN42 IPv4 and IPv6 <ul>
<li>Link-local address is preferred</li>
</ul>
</li>
<li>Your WireGuard Port <ul>
<li>22688 by default</li>
<li>I will use <code>2&lt;Your last 4-digit ASN&gt;</code> for you</li>
</ul>
</li>
<li>Is Multiprotocol BGP supported? <ul>
<li>If yes, I will just use the link-local IPv6 address to set up v4+v6 BGP session</li>
<li>Yes by default</li>
</ul>
</li>
<li>Something else you want to share with me <ul>
<li>Extended next hop enabled? </li>
<li>etc.</li>
</ul>
</li>
</ul>
<p>或者看下面也行。</p>
<p><img src="/2021/03/25/Server_DN42/image-20210326010342272.png"></p>
<h2 id="0x09-小结"><a href="#0x09-小结" class="headerlink" title="0x09 小结"></a>0x09 小结</h2><p>这篇文章对申请 ASN、IP、域名，搭建 VPN 通信隧道，配置 BGP 路由，完成和其他网络的 Peer 等内容进行了介绍。</p>
<p>但要注意的是本文<strong>并不是</strong>一篇完整的介绍，还需要参考其他教程来综合进行配置。</p>
<p>不过刚来玩 DN42，还有很多不熟悉的地方，还得感谢群里的大佬们 Orz。</p>
<p>如果有错误欢迎指出，喵！</p>
<h2 id="0xFF-References-amp-Extensive-Reading"><a href="#0xFF-References-amp-Extensive-Reading" class="headerlink" title="0xFF References &amp; Extensive Reading"></a>0xFF References &amp; Extensive Reading</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dn42.dev/howto/Getting-started">DN42 官方 Wiki howto/Getting Started</a></li>
<li>Lan Tian 师祖的 <a target="_blank" rel="noopener" href="https://lantian.pub/article/modify-website/dn42-experimental-network-2020.lantian">DN42 实验网络介绍及注册教程（2020-10-01 更新）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.outv.im/2020/dn42-neonetwork-guide/">接入 dn42 及 NeoNetwork</a></li>
<li><a target="_blank" rel="noopener" href="https://www.wsfnk.com/archives/category/dn42">辣条①号 的 DN42 系列</a></li>
<li><a target="_blank" rel="noopener" href="https://ithelp.ithome.com.tw/users/20119484/ironman/3438">什麼，透過BGP從小型網路到真正的網際網路！？ 系列</a></li>
<li><a target="_blank" rel="noopener" href="https://soha.moe/post/bird-bgp-kickstart.html">BIRD 与 BGP 的新手开场</a></li>
<li><a target="_blank" rel="noopener" href="https://weiti.org/dn42/2018/01/13/ibgp-bgp-within-as4242423905">iBGP - BGP within AS4242423905</a></li>
<li>etc.</li>
</ul>
<br>

<p>喵呜！终于扯完这篇文章了！</p>
<p>好久没写技术文章了，喵喵累死了（</p>
<p><em>（溜了喵</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz" rel="external nofollow noreferrer">MiaoTony</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz/2021/03/25/Server_DN42/">https://miaotony.xyz/2021/03/25/Server_DN42/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特别声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://miaotony.xyz" target="_blank">MiaoTony</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Tech/">
                                    <span class="chip bg-color">Tech</span>
                                </a>
                            
                                <a href="/tags/Server/">
                                    <span class="chip bg-color">Server</span>
                                </a>
                            
                                <a href="/tags/Configuration/">
                                    <span class="chip bg-color">Configuration</span>
                                </a>
                            
                                <a href="/tags/DN42/">
                                    <span class="chip bg-color">DN42</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">打赏一下让我来点好吃好玩的呗~</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <!-- 
                            <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li> 
                        -->
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <!-- 
                        <div id="alipay">
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/" class="reward-img" alt="支付宝打赏二维码">
                        </div> 
                -->
                    <div id="wechat">
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/gitalk/gitalk.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '116343b4650fce4789b6',
        clientSecret: '3e9be2ad6c9b693af1753290c7c059b1e4f34d5d',
        repo: 'miaotony.github.io',
        owner: 'miaotony',
        admin: "miaotony",
        id: '2021-03-25T21-20-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/04/04/CTF_2021HFCTF/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/medias/featureimages/16.jpg" class="responsive-img" alt="CTF | 2021 数字中国创新大赛虎符网络安全赛道 WriteUp">
                        
                        <span class="card-title">CTF | 2021 数字中国创新大赛虎符网络安全赛道 WriteUp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            貌似有一段时间没打CTF了，手有点生了。今年的虎符来的有点早，还赶上了清明假期，就来随意看看题好了吧。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-04-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/WriteUp/">
                        <span class="chip bg-color">WriteUp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/03/15/CTF_2021VNCTF/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/medias/featureimages/4.jpg" class="responsive-img" alt="CTF | 2021 V&amp;NCTF 公开赛 WriteUp">
                        
                        <span class="card-title">CTF | 2021 V&amp;NCTF 公开赛 WriteUp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            周末有个V&NCTF，题目是V&N战队中大一大二的小师傅们出的，比赛结束前来看了一眼，做了几个题玩玩。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-03-15
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/WriteUp/">
                        <span class="chip bg-color">WriteUp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('200')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: MiaoTony&#39;s小窝<br />'
            + '文章作者: MiaoTony<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者MiaoTony所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
        <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <a href="/about" target="_blank">MiaoTony</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
                        &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">308.6k</span>&nbsp;字
                                                                                    <span id="busuanzi_container_site_pv">
			|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
                                    <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
                        <br>
                        <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "11";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
                        <br>
                    </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://t.me/MiaoTonyChannel" class="tooltipped" target="_blank" data-tooltip="关注我的TelegramChannel: @MiaoTonyChannel" data-position="top" data-delay="50">
        <i class="fab fa-telegram"></i>
    </a>



    <a href="https://github.com/miaotony" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:miaotony@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    var cnt = 1;
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title != '' && data_content != '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i == 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + String(cnt) + ". " + data_title + "</a>";
                            cnt += 1;
    
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 150 characters
                                var start = first_occur - 20;
                                if (start < 0) {
                                    start = 0;
                                }
                                var match_content = content.substr(start, 150);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });
    
                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    str = "<p class=\"search-result-summary\">共找到" + String(cnt-1) + "条结果</p>"  + str;
                    $resultContent.innerHTML = str;
                });
            }
        });
    }

    searchFunc('https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/js/matery.min.js"></script>

    

    
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?40e312a1eec109cf96e30988cf3bfe70";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io@master/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
